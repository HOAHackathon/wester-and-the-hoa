{"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAI,WAAW;AAAK,IAAI,WAAW;AAAK,IAAI,aAAa;AAAM,IAAI,eAAe;AAAmB,IAAI,cAAc;AAAM,OAAO,MAAM,CAAC,aAAa,GAAG;AAAmB;AAE9K,8JAA8J,GAC9J;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA,GACA,IAAI,aAAa;AACjB,IAAI,YAAY,OAAO,MAAM,CAAC,MAAM;AACpC,SAAS,OAAO,UAAU;IACxB,UAAU,IAAI,CAAC,IAAI,EAAE;IACrB,IAAI,CAAC,GAAG,GAAG;QACT,MAAM,OAAO,MAAM,CAAC,OAAO,CAAC,WAAW;QACvC,kBAAkB,EAAE;QACpB,mBAAmB,EAAE;QACrB,QAAQ,SAAU,EAAE;YAClB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,YAAa;QAChD;QACA,SAAS,SAAU,EAAE;YACnB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC;QAC9B;IACF;IACA,OAAO,MAAM,CAAC,OAAO,CAAC,WAAW,GAAG;AACtC;AACA,OAAO,MAAM,CAAC,MAAM,GAAG;AACvB,OAAO,MAAM,CAAC,OAAO,GAAG,CAAC;AACzB,IAAI,cAAc,0BAA0B,KAAI,eAAe,0BAA0B,KAAI,gBAAgB,mCAAmC,KAAI,eAAe,mCAAmC;AACtM,SAAS;IACP,OAAO,YAAa,CAAA,SAAS,QAAQ,CAAC,OAAO,CAAC,YAAY,IAAI,SAAS,QAAQ,GAAG,WAAU;AAC9F;AACA,SAAS;IACP,OAAO,YAAY,SAAS,IAAI;AAClC;AAEA,wCAAwC;AACxC,IAAI,SAAS,OAAO,MAAM,CAAC,MAAM;AACjC,IAAI,AAAC,CAAA,CAAC,UAAU,CAAC,OAAO,eAAe,AAAD,KAAM,OAAO,cAAc,aAAa;IAC5E,IAAI,WAAW;IACf,IAAI,OAAO;IACX,IAAI,WAAW,cAAc,SAAS,QAAQ,IAAI,YAAY,CAAC;QAAC;QAAa;QAAa;KAAU,CAAC,QAAQ,CAAC,YAAY,QAAQ;IAClI,IAAI;IACJ,IAAI,aACF,KAAK,IAAI,YAAY;SAErB,IAAI;QACF,KAAK,IAAI,UAAU,WAAW,QAAQ,WAAY,CAAA,OAAO,MAAM,OAAO,EAAC,IAAK;IAC9E,EAAE,OAAO,KAAK;QACZ,IAAI,IAAI,OAAO,EACb,QAAQ,KAAK,CAAC,IAAI,OAAO;QAE3B,KAAK,CAAC;IACR;IAGF,wBAAwB;IACxB,IAAI,SAAS,OAAO,YAAY,cAAc,OAAO,WAAW,cAAc,OAAO,SAAS;IAE9F,oDAAoD;IACpD,0DAA0D;IAC1D,IAAI,oBAAoB;IACxB,IAAI;QACD,CAAA,GAAG,IAAG,EAAG;IACZ,EAAE,OAAO,KAAK;QACZ,oBAAoB,IAAI,KAAK,CAAC,QAAQ,CAAC;IACzC;IAEA,aAAa;IACb,GAAG,SAAS,GAAG,eAAgB,MAAM,wBAAwB,GAAzB;QAClC,gBAAgB,CAAC,EAAE,0BAA0B;QAC7C,iBAAiB,CAAC,EAAE,0BAA0B;QAC9C,iBAAiB,EAAE;QACnB,kBAAkB,EAAE;QACpB,IAAI,KAAK,eAAe,MAAK,KAAK,KAAK,CAAC,MAAM,IAAI;QAClD,IAAI,KAAK,IAAI,KAAK,UAChB;aACK,IAAI,KAAK,IAAI,KAAK,UAAU;YACjC,uCAAuC;YACvC,IAAI,OAAO,aAAa,aACtB;YAEF,IAAI,SAAS,KAAK,MAAM,CAAC,MAAM,CAAC,CAAA,QAAS,MAAM,OAAO,KAAK;YAE3D,oBAAoB;YACpB,IAAI,UAAU,OAAO,KAAK,CAAC,CAAA;gBACzB,OAAO,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,KAAK,QAAQ,eAAe,OAAO,MAAM,CAAC,IAAI,EAAE,MAAM,EAAE,EAAE,MAAM,YAAY;YACvH;YACA,IAAI,SAAS;gBACX,QAAQ,KAAK;gBAEb,yEAAyE;gBACzE,IAAI,OAAO,WAAW,eAAe,OAAO,gBAAgB,aAC1D,OAAO,aAAa,CAAC,IAAI,YAAY;gBAEvC,MAAM,gBAAgB;gBACtB;gBAEA,8FAA8F;gBAC9F,IAAI,kBAAkB,CAAC;gBACvB,IAAK,IAAI,IAAI,GAAG,IAAI,eAAe,MAAM,EAAE,IAAK;oBAC9C,IAAI,KAAK,cAAc,CAAC,EAAE,CAAC,EAAE;oBAC7B,IAAI,CAAC,eAAe,CAAC,GAAG,EAAE;wBACxB,UAAU,cAAc,CAAC,EAAE,CAAC,EAAE,EAAE;wBAChC,eAAe,CAAC,GAAG,GAAG;oBACxB;gBACF;YACF,OAAO;QACT;QACA,IAAI,KAAK,IAAI,KAAK,SAAS;YACzB,+BAA+B;YAC/B,KAAK,IAAI,kBAAkB,KAAK,WAAW,CAAC,IAAI,CAAE;gBAChD,IAAI,QAAQ,eAAe,SAAS,GAAG,eAAe,SAAS,GAAG,eAAe,KAAK;gBACtF,QAAQ,KAAK,CAAC,4BAAkB,eAAe,OAAO,GAAG,OAAO,QAAQ,SAAS,eAAe,KAAK,CAAC,IAAI,CAAC;YAC7G;YACA,IAAI,OAAO,aAAa,aAAa;gBACnC,gCAAgC;gBAChC;gBACA,IAAI,UAAU,mBAAmB,KAAK,WAAW,CAAC,IAAI;gBACtD,aAAa;gBACb,SAAS,IAAI,CAAC,WAAW,CAAC;YAC5B;QACF;IACF;IACA,IAAI,cAAc,WAAW;QAC3B,GAAG,OAAO,GAAG,SAAU,CAAC;YACtB,IAAI,EAAE,OAAO,EACX,QAAQ,KAAK,CAAC,EAAE,OAAO;QAE3B;QACA,GAAG,OAAO,GAAG;YACX,QAAQ,IAAI,CAAC;QACf;IACF;AACF;AACA,SAAS;IACP,IAAI,UAAU,SAAS,cAAc,CAAC;IACtC,IAAI,SAAS;QACX,QAAQ,MAAM;QACd,QAAQ,GAAG,CAAC;IACd;AACF;AACA,SAAS,mBAAmB,WAAW;IACrC,IAAI,UAAU,SAAS,aAAa,CAAC;IACrC,QAAQ,EAAE,GAAG;IACb,IAAI,YAAY;IAChB,KAAK,IAAI,cAAc,YAAa;QAClC,IAAI,QAAQ,WAAW,MAAM,CAAC,MAAM,GAAG,WAAW,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG;YAClE,OAAO,GAAG,EAAE;sCACoB,EAAE,mBAAmB,MAAM,QAAQ,EAAE,2FAA2F,EAAE,MAAM,QAAQ,CAAC;AACvL,EAAE,MAAM,IAAI,EAAE;QACV,GAAG,MAAM,WAAW,KAAK;QACzB,aAAa;AACjB;AACA;AACA,oBAAa,EAAE,WAAW,OAAO,CAAC;;aAErB,EAAE,MAAM;;UAEX,EAAE,WAAW,KAAK,CAAC,GAAG,CAAC,CAAA,OAAQ,uBAAa,OAAO,UAAU,IAAI,CAAC,IAAI;;QAExE,EAAE,WAAW,aAAa,GAAG,CAAC,8CAAuC,EAAE,WAAW,aAAa,CAAC,sCAAsC,CAAC,GAAG,GAAG;;IAEjJ,CAAC;IACH;IACA,aAAa;IACb,QAAQ,SAAS,GAAG;IACpB,OAAO;AACT;AACA,SAAS;IACP,IAAI,YAAY,UACd,SAAS,MAAM;SACV,IAAI,UAAU,OAAO,OAAO,IAAI,OAAO,OAAO,CAAC,MAAM,EAC1D,OAAO,OAAO,CAAC,MAAM;AAEzB;AACA,SAAS,WAAW,MAAM,EAAE,EAAE,EAAE,mCAAmC;IACjE,IAAI,UAAU,OAAO,OAAO;IAC5B,IAAI,CAAC,SACH,OAAO,EAAE;IAEX,IAAI,UAAU,EAAE;IAChB,IAAI,GAAG,GAAG;IACV,IAAK,KAAK,QACR,IAAK,KAAK,OAAO,CAAC,EAAE,CAAC,EAAE,CAAE;QACvB,MAAM,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;QACtB,IAAI,QAAQ,MAAM,MAAM,OAAO,CAAC,QAAQ,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,KAAK,IAC9D,QAAQ,IAAI,CAAC;YAAC;YAAQ;SAAE;IAE5B;IAEF,IAAI,OAAO,MAAM,EACf,UAAU,QAAQ,MAAM,CAAC,WAAW,OAAO,MAAM,EAAE;IAErD,OAAO;AACT;AACA,SAAS,WAAW,IAAI;IACtB,IAAI,OAAO,KAAK,YAAY,CAAC;IAC7B,IAAI,CAAC,MACH;IAEF,IAAI,UAAU,KAAK,SAAS;IAC5B,QAAQ,MAAM,GAAG;QACf,IAAI,KAAK,UAAU,KAAK,MACtB,aAAa;QACb,KAAK,UAAU,CAAC,WAAW,CAAC;IAEhC;IACA,QAAQ,YAAY,CAAC,QACrB,aAAa;IACb,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,MAAM,KAAK,GAAG;IACnC,aAAa;IACb,KAAK,UAAU,CAAC,YAAY,CAAC,SAAS,KAAK,WAAW;AACxD;AACA,IAAI,aAAa;AACjB,SAAS;IACP,IAAI,YACF;IAEF,aAAa,WAAW;QACtB,IAAI,QAAQ,SAAS,gBAAgB,CAAC;QACtC,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,IAAK;YACrC,gCAAgC;YAChC,IAAI,KAAK,WAAW,MAAK,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC;YAC/C,IAAI,WAAW;YACf,IAAI,sBAAsB,aAAa,cAAc,IAAI,OAAO,mDAAmD,WAAW,IAAI,CAAC,QAAQ,KAAK,OAAO,CAAC,WAAW,MAAM;YACzK,IAAI,WAAW,gBAAgB,IAAI,CAAC,SAAS,KAAK,OAAO,CAAC,SAAS,MAAM,MAAM,KAAK,CAAC;YACrF,IAAI,CAAC,UACH,WAAW,KAAK,CAAC,EAAE;QAEvB;QACA,aAAa;IACf,GAAG;AACL;AACA,SAAS,YAAY,KAAK;IACxB,IAAI,MAAM,IAAI,KAAK,MAAM;QACvB,IAAI,OAAO,aAAa,aAAa;YACnC,IAAI,SAAS,SAAS,aAAa,CAAC;YACpC,OAAO,GAAG,GAAG,MAAM,GAAG,GAAG,QAAQ,KAAK,GAAG;YACzC,IAAI,MAAM,YAAY,KAAK,YACzB,OAAO,IAAI,GAAG;YAEhB,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,IAAI;gBACJ,OAAO,MAAM,GAAG,IAAM,QAAQ;gBAC9B,OAAO,OAAO,GAAG;gBAChB,CAAA,iBAAiB,SAAS,IAAI,AAAD,MAAO,QAAQ,mBAAmB,KAAK,KAAK,eAAe,WAAW,CAAC;YACvG;QACF,OAAO,IAAI,OAAO,kBAAkB,YAAY;YAC9C,iBAAiB;YACjB,IAAI,MAAM,YAAY,KAAK,YACzB,OAAO,OAAmB,MAAM,GAAG,GAAG,QAAQ,KAAK,GAAG;iBAEtD,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,IAAI;oBACF,cAA0B,MAAM,GAAG,GAAG,QAAQ,KAAK,GAAG;oBACtD;gBACF,EAAE,OAAO,KAAK;oBACZ,OAAO;gBACT;YACF;QAEJ;IACF;AACF;AACA,eAAe,gBAAgB,MAAM;IACnC,OAAO,eAAe,GAAG,OAAO,MAAM,CAAC;IACvC,IAAI;IACJ,IAAI;QACF,kEAAkE;QAClE,gEAAgE;QAChE,gEAAgE;QAChE,mDAAmD;QACnD,iDAAiD;QACjD,mDAAmD;QACnD,IAAI,CAAC,mBAAmB;YACtB,IAAI,WAAW,OAAO,GAAG,CAAC,CAAA;gBACxB,IAAI;gBACJ,OAAO,AAAC,CAAA,eAAe,YAAY,MAAK,MAAO,QAAQ,iBAAiB,KAAK,IAAI,KAAK,IAAI,aAAa,KAAK,CAAC,CAAA;oBAC3G,oBAAoB;oBACpB,IAAI,UAAU,OAAO,OAAO,IAAI,OAAO,OAAO,CAAC,WAAW,GAAG,gBAAgB,IAAI,KAAK,OAAO,4BAA4B,eAAe,kBAAkB,0BAA0B;wBAClL,OAAO,OAAO,CAAC,MAAM;wBACrB;oBACF;oBACA,MAAM;gBACR;YACF;YACA,kBAAkB,MAAM,QAAQ,GAAG,CAAC;QACtC;QACA,OAAO,OAAO,CAAC,SAAU,KAAK;YAC5B,SAAS,OAAO,MAAM,CAAC,IAAI,EAAE;QAC/B;IACF,SAAU;QACR,OAAO,OAAO,eAAe;QAC7B,IAAI,iBACF,gBAAgB,OAAO,CAAC,CAAA;YACtB,IAAI,QAAQ;gBACV,IAAI;gBACH,CAAA,kBAAkB,SAAS,IAAI,AAAD,MAAO,QAAQ,oBAAoB,KAAK,KAAK,gBAAgB,WAAW,CAAC;YAC1G;QACF;IAEJ;AACF;AACA,SAAS,SAAS,OAAO,kBAAkB,GAAnB,EAAuB,MAAM,cAAc,GAAf;IAClD,IAAI,UAAU,OAAO,OAAO;IAC5B,IAAI,CAAC,SACH;IAEF,IAAI,MAAM,IAAI,KAAK,OACjB;SACK,IAAI,MAAM,IAAI,KAAK,MAAM;QAC9B,IAAI,OAAO,MAAM,YAAY,CAAC,OAAO,aAAa,CAAC;QACnD,IAAI,MAAM;YACR,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE;gBACrB,iEAAiE;gBACjE,oHAAoH;gBACpH,IAAI,UAAU,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE;gBAClC,IAAK,IAAI,OAAO,QACd,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,CAAC,IAAI,EAAE;oBAC5C,IAAI,KAAK,OAAO,CAAC,IAAI;oBACrB,IAAI,UAAU,WAAW,OAAO,MAAM,CAAC,IAAI,EAAE;oBAC7C,IAAI,QAAQ,MAAM,KAAK,GACrB,UAAU,OAAO,MAAM,CAAC,IAAI,EAAE;gBAElC;YAEJ;YACA,IAAI,mBAGF,AAFA,4DAA4D;YAC5D,+CAA+C;YAC9C,CAAA,GAAG,IAAG,EAAG,MAAM,MAAM;YAGxB,aAAa;YACb,IAAI,KAAK,OAAO,eAAe,CAAC,MAAM,EAAE,CAAC;YACzC,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG;gBAAC;gBAAI;aAAK;QAChC;QAEA,8FAA8F;QAC9F,0GAA0G;QAC1G,IAAI,OAAO,MAAM,EACf,SAAS,OAAO,MAAM,EAAE;IAE5B;AACF;AACA,SAAS,UAAU,MAAM,EAAE,EAAE;IAC3B,IAAI,UAAU,OAAO,OAAO;IAC5B,IAAI,CAAC,SACH;IAEF,IAAI,OAAO,CAAC,GAAG,EAAE;QACf,8EAA8E;QAC9E,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,EAAE;QACzB,IAAI,UAAU,EAAE;QAChB,IAAK,IAAI,OAAO,KAAM;YACpB,IAAI,UAAU,WAAW,OAAO,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI;YACtD,IAAI,QAAQ,MAAM,KAAK,GACrB,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI;QAE1B;QAEA,sGAAsG;QACtG,OAAO,OAAO,CAAC,GAAG;QAClB,OAAO,OAAO,KAAK,CAAC,GAAG;QAEvB,0BAA0B;QAC1B,QAAQ,OAAO,CAAC,CAAA;YACd,UAAU,OAAO,MAAM,CAAC,IAAI,EAAE;QAChC;IACF,OAAO,IAAI,OAAO,MAAM,EACtB,UAAU,OAAO,MAAM,EAAE;AAE7B;AACA,SAAS,eAAe,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ,EAAgB,aAAa,uCAAuC,GAAxC;IACjF,IAAI,kBAAkB,QAAQ,IAAI,eAChC,OAAO;IAGT,uGAAuG;IACvG,IAAI,UAAU,WAAW,OAAO,MAAM,CAAC,IAAI,EAAE;IAC7C,IAAI,WAAW;IACf,MAAO,QAAQ,MAAM,GAAG,EAAG;QACzB,IAAI,IAAI,QAAQ,KAAK;QACrB,IAAI,IAAI,kBAAkB,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE;QACtC,IAAI,GACF,+EAA+E;QAC/E,WAAW;aACN;YACL,yDAAyD;YACzD,IAAI,IAAI,WAAW,OAAO,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE;YAC3C,IAAI,EAAE,MAAM,KAAK,GAAG;gBAClB,kFAAkF;gBAClF,WAAW;gBACX;YACF;YACA,QAAQ,IAAI,IAAI;QAClB;IACF;IACA,OAAO;AACT;AACA,SAAS,kBAAkB,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ,EAAgB,aAAa,uCAAuC,GAAxC;IACpF,IAAI,UAAU,OAAO,OAAO;IAC5B,IAAI,CAAC,SACH;IAEF,IAAI,gBAAgB,CAAC,YAAY,CAAC,OAAO,aAAa,CAAC,EAAE;QACvD,2EAA2E;QAC3E,yEAAyE;QACzE,IAAI,CAAC,OAAO,MAAM,EAChB,OAAO;QAET,OAAO,eAAe,OAAO,MAAM,EAAE,IAAI;IAC3C;IACA,IAAI,aAAa,CAAC,GAAG,EACnB,OAAO;IAET,aAAa,CAAC,GAAG,GAAG;IACpB,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,gBAAgB,IAAI,CAAC;QAAC;QAAQ;KAAG;IACjC,IAAI,CAAC,UAAU,OAAO,GAAG,IAAI,OAAO,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE;QAC/D,eAAe,IAAI,CAAC;YAAC;YAAQ;SAAG;QAChC,OAAO;IACT;AACF;AACA,SAAS;IACP,0BAA0B;IAC1B,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,MAAM,EAAE,IAAK;QAC/C,IAAI,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;QAC9B,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE;YACvB,WAAW,eAAe,CAAC,EAAE,CAAC,EAAE,EAAE;YAClC,cAAc,CAAC,GAAG,GAAG;QACvB;IACF;IACA,kBAAkB,EAAE;AACtB;AACA,SAAS,WAAW,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ;IACjD,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,OAAO,OAAO,CAAC,GAAG,GAAG,CAAC;IACtB,IAAI,UAAU,OAAO,GAAG,EACtB,OAAO,GAAG,CAAC,IAAI,GAAG,OAAO,OAAO,CAAC,GAAG;IAEtC,IAAI,UAAU,OAAO,GAAG,IAAI,OAAO,GAAG,CAAC,iBAAiB,CAAC,MAAM,EAC7D,OAAO,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,SAAU,EAAE;QAC/C,GAAG,OAAO,OAAO,CAAC,GAAG;IACvB;IAEF,OAAO,OAAO,KAAK,CAAC,GAAG;AACzB;AACA,SAAS,UAAU,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ;IAChD,sBAAsB;IACtB,OAAO;IAEP,6DAA6D;IAC7D,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,IAAI,UAAU,OAAO,GAAG,IAAI,OAAO,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE;QAC9D,IAAI,qBAAqB,EAAE;QAC3B,OAAO,GAAG,CAAC,gBAAgB,CAAC,OAAO,CAAC,SAAU,EAAE;YAC9C,IAAI,mBAAmB,GAAG;gBACxB,OAAO,WAAW,OAAO,MAAM,CAAC,IAAI,EAAE;YACxC;YACA,IAAI,MAAM,OAAO,CAAC,qBAAqB,iBAAiB,MAAM,EAC5D,mBAAmB,IAAI,IAAI;QAE/B;QACA,IAAI,mBAAmB,MAAM,EAAE;YAC7B,IAAI,UAAU,mBAAmB,KAAK,CAAC,SAAU,CAAC;gBAChD,OAAO,eAAe,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE;YAClC;YACA,IAAI,CAAC,SACH,OAAO;YAET;QACF;IACF;AACF;;;ACpgBA,UAAU;AACV;AACA;AACA;AAEA,MAAM,OAAO,IAAI,CAAA,GAAA,iBAAM,AAAD,EAAE;IACpB,iBAAiB,CAAA,GAAA,gBAAK,AAAD,EAAE,OAAO,CAAC;IAC/B,UAAU;IACV,aAAa;IACb,YAAY;IACZ,aAAa,CAAA,GAAA,sBAAW,AAAD,EAAE,SAAS;AAEtC;AAEA,MAAM,SAAS,IAAI,CAAA,GAAA,cAAM,AAAD,EAAE;AAE1B,KAAK,YAAY,CAAC,GAAG,CAAC;AAEtB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,IAEpB,KAAK,YAAY,CAAC,GAAG,CAAC,IAAI,CAAA,GAAA,YAAK,AAAD,EAC1B,CAAA,GAAA,iBAAM,AAAD,EAAE,SAAS,CAAC,KAAK,MAAM,KAAG,KAAK,EAAE,GAAC,GAAG,UAAU,CAAC,MAAI,KAAK,MAAM,KAAG,KAAK,GAAG,CAC3E,CAAA,GAAA,cAAG,AAAD,EAAE,KAAK,MAAM,CAAC,KAAK,GAAC,GAAG,KAAK,MAAM,CAAC,MAAM,GAAC;AAKxD,KAAK,KAAK;;;A,oE,GE3BV,CAAA,SAA2CA,CAAAA,EAAMC,CAAAA;IAE/CE,OAAOD,OAAAA,GAAUD;AAOlB,EAAEK,MAAM,IACT,AAAA,CAAA;QAAA;QAAA,IAAA,IAAA;YAAA,KAAA,CAAA,GAAA,GAAA;gBAAA,EAAA,CAAA,CAAA,GAAA;oBAAA,GAAA,IAAA;gBAAA;gBAAA,IAAA,IAAA,EAAA,IAAA,IAAA,EAAA,CAAA,CAAA,IAAA,IAAA,EAAA,MCPIC,IAAAA,EAAAA,CAAAA,CAAAA,KAAsD;gBAE1DA,EAAwBC,IAAAA,CAAK;oBAACL,EAAOM,EAAAA;oBAAI;oBA4HtC;oBAAG;wBAAC,SAAU;wBAAE,SAAU;4BAAC;yBAAA;wBAAmC,OAAQ,EAAA;wBAAG,UAAW;wBAA29B,gBAAiB;4BAAC;yBAAA;wBAA8gF,YAAa;oBAAA;iBAAA;gBAE/lH,MAAA,IAAA;YAAA;YAAA,KAAA,CAAA,GAAA,GAAA;gBAAA,EAAA,CAAA,CAAA,GAAA;oBAAA,GAAA,IAAA;gBAAA;gBAAA,IAAA,IAAA,EAAA,IAAA,IAAA,EAAA,CAAA,CAAA,IAAA,IAAA,EAAA,MChIIF,IAAAA,EAAAA,CAAAA,CAAAA,KAAsD;gBAE1DA,EAAwBC,IAAAA,CAAK;oBAACL,EAAOM,EAAAA;oBAAI;oBA0BtC;oBAAG;wBAAC,SAAU;wBAAE,SAAU;4BAAC;yBAAA;wBAAgC,OAAQ,EAAA;wBAAG,UAAW;wBAAqO,gBAAiB;4BAAC;yBAAA;wBAA0gB,YAAa;oBAAA;iBAAA;gBAEl2B,MAAA,IAAA;YAAA;YAAA,KAAA,CAAA;gBC3BAN,EAAOD,OAAAA,GAAU,SAAUQ,CAAAA;oBACzB,IAAIC,IAAO,EAAA;oBA4EX,OAzEAA,EAAKC,QAAAA,GAAW;wBACd,OAAOC,IAAAA,CAAKC,GAAAA,CAAI,SAAUC,CAAAA;4BACxB,IAAIC,IAAU,IACVC,IAAAA,KAA+B,MAAZF,CAAAA,CAAK,EAAA;4BAoB5B,OAnBIA,CAAAA,CAAK,EAAA,IACPC,CAAAA,KAAW,cAAcE,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,MAAA,GAEvCA,CAAAA,CAAK,EAAA,IACPC,CAAAA,KAAW,UAAUE,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,KAAA,GAEnCE,KACFD,CAAAA,KAAW,SAASE,MAAAA,CAAOH,CAAAA,CAAK,EAAA,CAAGI,MAAAA,GAAS,IAAI,IAAID,MAAAA,CAAOH,CAAAA,CAAK,EAAA,IAAM,IAAI,KAAA,GAE5EC,KAAWN,EAAuBK,IAC9BE,KACFD,CAAAA,KAAW,GAAA,GAETD,CAAAA,CAAK,EAAA,IACPC,CAAAA,KAAW,GAAA,GAETD,CAAAA,CAAK,EAAA,IACPC,CAAAA,KAAW,GAAA,GAENA;wBACT,GAAGI,IAAAA,CAAK;oBACV,GAGAT,EAAKU,CAAAA,GAAI,SAAWC,CAAAA,EAASC,CAAAA,EAAOC,CAAAA,EAAQC,CAAAA,EAAUC,CAAAA;wBAC7B,YAAA,OAAZJ,KACTA,CAAAA,IAAU;4BAAC;gCAAC;gCAAMA;gCAAAA,KAASK;6BAAAA;yBAAAA,AAAAA;wBAE7B,IAAIC,IAAyB,CAAC;wBAC9B,IAAIJ,GACF,IAAK,IAAIK,IAAI,GAAGA,IAAIhB,IAAAA,CAAKM,MAAAA,EAAQU,IAAK;4BACpC,IAAIpB,IAAKI,IAAAA,CAAKgB,EAAAA,CAAG,EAAA;4BACP,QAANpB,KACFmB,CAAAA,CAAAA,CAAuBnB,EAAAA,GAAAA,CAAM,CAAA;wBAEjC;wBAEF,IAAK,IAAIqB,IAAK,GAAGA,IAAKR,EAAQH,MAAAA,EAAQW,IAAM;4BAC1C,IAAIf,IAAO,EAAA,CAAGG,MAAAA,CAAOI,CAAAA,CAAQQ,EAAAA;4BACzBN,KAAUI,CAAAA,CAAuBb,CAAAA,CAAK,EAAA,CAAA,IAAA,CAAA,KAGrB,MAAVW,KAAAA,CAAAA,KACc,MAAZX,CAAAA,CAAK,EAAA,IAGdA,CAAAA,CAAAA,CAAK,EAAA,GAAK,SAASG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,CAAGI,MAAAA,GAAS,IAAI,IAAID,MAAAA,CAAOH,CAAAA,CAAK,EAAA,IAAM,IAAI,MAAMG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,IAAA,GAF/FA,CAAAA,CAAK,EAAA,GAAKW,CAAAA,GAMVH,KACGR,CAAAA,CAAAA,CAAK,EAAA,GAGRA,CAAAA,CAAAA,CAAK,EAAA,GAAK,UAAUG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,MAAMG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,MAC1DA,CAAAA,CAAK,EAAA,GAAKQ,CAAAA,IAHVR,CAAAA,CAAK,EAAA,GAAKQ,CAAAA,GAMVE,KACGV,CAAAA,CAAAA,CAAK,EAAA,GAGRA,CAAAA,CAAAA,CAAK,EAAA,GAAK,cAAcG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,OAAOG,MAAAA,CAAOH,CAAAA,CAAK,EAAA,EAAI,MAC/DA,CAAAA,CAAK,EAAA,GAAKU,CAAAA,IAHVV,CAAAA,CAAK,EAAA,GAAK,GAAGG,MAAAA,CAAOO,EAAAA,GAMxBd,EAAKH,IAAAA,CAAKO,EAAAA;wBACZ;oBACF,GACOJ;gBACT;YAAA;YAAA,GAAA,CAAA;gBClFAR,EAAOD,OAAAA,GAAU,SAAUa,CAAAA;oBACzB,IAAIC,IAAUD,CAAAA,CAAK,EAAA,EACfgB,IAAahB,CAAAA,CAAK,EAAA;oBACtB,IAAA,CAAKgB,GACH,OAAOf;oBAET,IAAoB,cAAA,OAATgB,MAAqB;wBAC9B,IAAIC,IAASD,KAAKE,SAASC,mBAAmBC,KAAKC,SAAAA,CAAUN,OACzDO,IAAO,+DAA+DpB,MAAAA,CAAOe,IAC7EM,IAAgB,OAAOrB,MAAAA,CAAOoB,GAAM;wBACxC,OAAO;4BAACtB;yBAAAA,CAASE,MAAAA,CAAO;4BAACqB;yBAAAA,EAAgBnB,IAAAA,CAAK;oBAChD;oBACA,OAAO;wBAACJ;qBAAAA,CAASI,IAAAA,CAAK;gBACxB;YAAA;QAAA,GCdIoB,IAA2B,CAAC;QAGhC,SAASC,EAAoBC,CAAAA;YAE5B,IAAIC,IAAeH,CAAAA,CAAyBE,EAAAA;YAC5C,IAAA,KAAqBf,MAAjBgB,GACH,OAAOA,EAAazC,OAAAA;YAGrB,IAAIC,IAASqC,CAAAA,CAAyBE,EAAAA,GAAY;gBACjDjC,IAAIiC;gBAEJxC,SAAS,CAAC;YAAA;YAOX,OAHA0C,CAAAA,CAAoBF,EAAAA,CAAUvC,GAAQA,EAAOD,OAAAA,EAASuC,IAG/CtC,EAAOD,OACf;QAAA;QCrBAuC,EAAoBI,CAAAA,GAAK1C,CAAAA;YACxB,IAAI2C,IAAS3C,KAAUA,EAAO4C,UAAAA,GAC7B,IAAO5C,EAAiB,OAAA,GACxB,IAAM;YAEP,OADAsC,EAAoBO,CAAAA,CAAEF,GAAQ;gBAAEG,GAAGH;YAAAA,IAC5BA;QAAM,GCLdL,EAAoBO,CAAAA,GAAI,CAAC9C,GAASgD;YACjC,IAAI,IAAIC,KAAOD,EACXT,EAAoBW,CAAAA,CAAEF,GAAYC,MAAAA,CAASV,EAAoBW,CAAAA,CAAElD,GAASiD,MAC5EE,OAAOC,cAAAA,CAAepD,GAASiD,GAAK;gBAAEI,YAAAA,CAAY;gBAAMC,KAAKN,CAAAA,CAAWC,EAAAA;YAAAA;QAE1E,GCNDV,EAAoBW,CAAAA,GAAI,CAACK,GAAKC,IAAUL,OAAOM,SAAAA,CAAUC,cAAAA,CAAeC,IAAAA,CAAKJ,GAAKC,ICClFjB,EAAoBqB,CAAAA,GAAK5D,CAAAA;YACH,eAAA,OAAX6D,UAA0BA,OAAOC,WAAAA,IAC1CX,OAAOC,cAAAA,CAAepD,GAAS6D,OAAOC,WAAAA,EAAa;gBAAEC,OAAO;YAAA,IAE7DZ,OAAOC,cAAAA,CAAepD,GAAS,cAAc;gBAAE+D,OAAAA,CAAO;YAAA;QAAO;QAAA,IAAA,IAAA,CAAA;QAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAA;YAAA,qBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,aAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,eAAA,IAAA;YAAA,OAAA,IAAA;YAAA,aAAA,IAAA;YAAA,UAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,WAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,aAAA,IAAA;YAAA,OAAA,IAAA;YAAA,eAAA,IAAA;YAAA,aAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,SAAA,IAAA;YAAA,QAAA,IAAA;YAAA,cAAA,IAAA;YAAA,QAAA,IAAA;YAAA,QAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,sBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,uBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,yBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,OAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,6BAAA,IAAA;YAAA,WAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,WAAA,IAAA;YAAA,SAAA,IAAA;YAAA,SAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,aAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,WAAA,IAAA;YAAA,yBAAA,IAAA;YAAA,iCAAA,IAAA;YAAA,eAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,UAAA,IAAA;YAAA,KAAA,IAAA;YAAA,WAAA,IAAA;YAAA,UAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,aAAA,IAAA;YAAA,+BAAA,IAAA;YAAA,YAAA,IAAA;YAAA,QAAA,IAAA;YAAA,QAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,QAAA,IAAA;YAAA,cAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,YAAA,IAAA;YAAA,QAAA,IAAA;YAAA,YAAA,IAAA;YAAA,kCAAA,IAAA;YAAA,+BAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,OAAA,IAAA;YAAA,OAAA,IAAA;YAAA,QAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,YAAA,IAAA;YAAA,WAAA,IAAA;YAAA,UAAA,IAAA;YAAA,YAAA,IAAA;YAAA,YAAA,IAAA;YAAA,QAAA,IAAA;YAAA,WAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,SAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,KAAA,IAAA;YAAA,WAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,SAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,aAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,+BAAA,IAAA;YAAA,eAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,WAAA,IAAA;YAAA,aAAA,IAAA;YAAA,0BAAA,IAAA;YAAA,uBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,UAAA,IAAA;YAAA,UAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,OAAA,IAAA;YAAA,2BAAA,IAAA;YAAA,MAAA,IAAA;YAAA,aAAA,IAAA;YAAA,QAAA,IAAA;YAAA,cAAA,IAAA;YAAA,+BAAA,IAAA;YAAA,2BAAA,IAAA;YAAA,UAAA,IAAA;YAAA,QAAA,IAAA;YAAA,UAAA,IAAA;YAAA,QAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,MAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,QAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,2BAAA,IAAA;YAAA,WAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,YAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,cAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,sBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,aAAA,IAAA;YAAA,SAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,cAAA,IAAA;YAAA,uBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,OAAA,IAAA;YAAA,cAAA,IAAA;YAAA,2BAAA,IAAA;YAAA,QAAA,IAAA;YAAA,QAAA,IAAA;YAAA,KAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,WAAA,IAAA;YAAA,aAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,eAAA,IAAA;YAAA,YAAA,IAAA;YAAA,UAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,SAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,SAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,aAAA,IAAA;YAAA,QAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,cAAA,IAAA;YAAA,sBAAA,IAAA;YAAA,WAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,OAAA,IAAA;YAAA,MAAA,IAAA;YAAA,OAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,aAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,kCAAA,IAAA;YAAA,0BAAA,IAAA;YAAA,QAAA,IAAA;YAAA,YAAA,IAAA;YAAA,aAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,QAAA,IAAA;YAAA,eAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,UAAA,IAAA;YAAA,WAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,eAAA,IAAA;YAAA,MAAA,IAAA;YAAA,SAAA,IAAA;YAAA,eAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,OAAA,IAAA;YAAA,SAAA,IAAA;YAAA,WAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,UAAA,IAAA;YAAA,SAAA,IAAA;YAAA,eAAA,IAAA;YAAA,OAAA,IAAA;YAAA,MAAA,IAAA;YAAA,QAAA,IAAA;YAAA,YAAA,IAAA;YAAA,cAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,UAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,OAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,QAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,WAAA,IAAA;YAAA,UAAA,IAAA;YAAA,MAAA,IAAA;YAAA,yBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,aAAA,IAAA;YAAA,YAAA,IAAA;YAAA,SAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,YAAA,IAAA;YAAA,aAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,SAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,YAAA,IAAA;YAAA,aAAA,IAAA;YAAA,cAAA,IAAA;YAAA,UAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,OAAA,IAAA;YAAA,OAAA,IAAA;YAAA,aAAA,IAAA;YAAA,sBAAA,IAAA;YAAA,MAAA,IAAA;YAAA,WAAA,IAAA;YAAA,WAAA,IAAA;YAAA,KAAA,IAAA;YAAA,OAAA,IAAA;QAAA;QAAA,IAAA,IAAA,CAAA;QAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAA;YAAA,2BAAA,IAAA;YAAA,yBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,qBAAA,IAAA;QAAA;QAAA,IAAA,IAAA,CAAA;QAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAA;YAAA,QAAA,IAAA;YAAA,MAAA,IAAA;YAAA,OAAA,IAAA;YAAA,WAAA,IAAA;YAAA,QAAA,IAAA;QAAA;QAAA,IAAA,IAAA,CAAA;QAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAA;YAAA,qBAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,UAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,yBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,YAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,WAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,kBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,qBAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,WAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,oBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,eAAA,IAAA;YAAA,wBAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,mBAAA,IAAA;YAAA,cAAA,IAAA;YAAA,eAAA,IAAA;YAAA,cAAA,IAAA;YAAA,uBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,aAAA,IAAA;YAAA,cAAA,IAAA;QAAA;QAAA,ICDlDC,GCDAC,GAAAA,IAAAA,CAAAA;QCAL,SAASC;YA4Bd,IA1BsB,eAAA,OAAXC,UACTA,CAAAA,SAAc;gBACZC,cAAc,YAEd;YAAA,CAAA,GAIkB,eAAA,OAAXD,UAA2BA,OAAOE,qBAAAA,IACrCF,CAAAA,OAAQE,qBAAAA,GACNF,OAAQG,2BAAAA,IACRH,OAAQI,wBAAAA,IACd,SAAUC,CAAAA;gBACRL,OAAOM,WAAAA,CAAYD,GAAU,MAAO;YACtC,CAAA,GAGkB,eAAA,OAAXL,UAA2BA,OAAOO,oBAAAA,IACrCP,CAAAA,OAAQO,oBAAAA,GACNP,OAAQQ,0BAAAA,IACRR,OAAQS,uBAAAA,IACd,YAEA,CAAA,GAGkB,eAAA,OAAXT,UAAAA,CAAiCA,OAAQU,YAAAA,EAAc;gBAChE,IAAUV,OAAQW,kBAAAA,EAAoB;oBACpC,MACMC,IADYZ,OAAQW,kBAAAA,CACJrB,SAAAA,CAAUuB,eAAAA;oBAC1Bb,OAAQW,kBAAAA,CAAmBrB,SAAAA,CAAUuB,eAAAA,GAAkB,SAAUC,CAAAA;wBACrE,OAAO,IAAIC,QAAQ,CAACC,GAASC;4BAC3BL,EAAUpB,IAAAA,CAAKhD,IAAAA,EAAMsE,GAAaE,GAASC;wBAAO;oBAEtD;gBACF;gBAEMjB,OAAQU,YAAAA,GACNV,OAAQU,YAAAA,IACRV,OAAQW,kBAAAA,IACRX,OAAQkB,eAAAA,IACRlB,OAAQmB,cAAAA,IACRnB,OAAQoB,aAClB;YAAA;YAGsB,eAAA,OAAXpB,UAAiCA,OAAQqB,gBAAAA,IAC5CrB,CAAAA,OAAQqB,gBAAAA,GAAmBrB,OAAOqB,gBAAAA,IAAoB,CAAA,GAIxC,eAAA,OAAXrB,UAA4BA,OAAesB,mBAAAA,IAEnDtB,CAAAA,OAAesB,mBAAAA,GACdtB,OAAOsB,mBAAAA,IACP,SAAUC,CAAAA;gBACR,MAAMC,IAAQC,KAAKC,GAAAA;gBACnB,OAAOC,WAAW;oBAChBJ,EAAG;wBACDK,YAAAA,CAAY;wBACZC,eAAe;4BACb,OAAOC,KAAKC,GAAAA,CAAI,GAAG,KAAMN,CAAAA,KAAKC,GAAAA,KAAQF,CAAAA;wBACxC;oBAAA;gBAEJ,GAAG;YACL,GAEDxB,OAAegC,kBAAAA,GACdhC,OAAOgC,kBAAAA,IACP,SAAU5F,CAAAA;gBACR6F,aAAa7F;YACf,CAAA;QAEN;QAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAA;YAAA,iBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,iBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,QAAA,IAAA;YAAA,YAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,gBAAA,IAAA;YAAA,UAAA,IAAA;YAAA,OAAA,IAAA;YAAA,MAAA,IAAA;YAAA,aAAA,IAAA;YAAA,UAAA,IAAA;YAAA,WAAA,IAAA;YAAA,MAAA,IAAA;YAAA,qBAAA,IAAA;QAAA;QCxEO,MAAM8F;YAQJ,OAAA,2BAAOC;gBACZD,EAAME,MAAAA,CAAO;YACf;YAKO,OAAA,yBAAOC;gBACZH,EAAME,MAAAA,CAAO;YACf;YAKO,OAAA,SAAOE;gBACZJ,EAAMK,OAAAA,GAAAA,CAAU;YAClB;YAQO,OAAA,SAAOC;gBACZN,EAAMK,OAAAA,GAAAA,CAAU,GAChBL,EAAMO,MAAAA,GAAS,CAAC;YAClB;YAKO,OAAA,OAAcC,CAAAA,EAAAA;gBACnB,IAAIlG,IAAAA,CAAK+F,OAAAA,EACP,MAAMI,MAAM;gBAEdT,EAAMO,MAAAA,CAAOC,EAAAA,GAAAA,CAAY;YAC3B;YAMO,OAAA,QAAeA,CAAAA,EAAAA;gBACpB,IAAIlG,IAAAA,CAAK+F,OAAAA,EACP,MAAMI,MAAM;gBAEdT,EAAMO,MAAAA,CAAOC,EAAAA,GAAAA,CAAY;YAC3B;YAMO,OAAA,UAAiBA,CAAAA,EAAAA;gBACtB,OAAA,CAAA,CAASR,EAAMO,MAAAA,CAAOC,EACxB;YAAA;YAKO,OAAA,OAAOI;gBACZ,OAAO9D,OAAO+D,IAAAA,CAAKb,EAAMO,MAAAA;YAC3B;QAAA;QCrEK,SAASO,EAA2BC,CAAAA,EAASrD,CAAAA;YAClD,OAAO;gBAAEqD,MAAAA;gBAAMrD,OAAAA;YAAAA;QACjB;QDHiB,EAAA2C,OAAAA,GAAAA,CAAU,GACV,EAAAE,MAAAA,GAAkC,CAAC;QEL7C,MAAMS;YAMX,aAAAC;gBAFQ,IAAA,CAAAC,YAAAA,GAAAA,CAAwB,GAG9B5G,IAAAA,CAAK6G,OAAAA,GAAU,IAAItC,QAAQ,CAACC,GAASC;oBACnCzE,IAAAA,CAAK8G,SAAAA,GAAYtC,GACjBxE,IAAAA,CAAK+G,SAAAA,GAAYtC;gBAAM;YAE3B;YAIA,IAAA,cAAWuC;gBACT,OAAOhH,IAAAA,CAAK4G,YACd;YAAA;YAEO,QAAQxD,CAAAA,EAAAA;gBACTpD,IAAAA,CAAK4G,YAAAA,IAGT5G,CAAAA,IAAAA,CAAK4G,YAAAA,GAAAA,CAAe,GACpB5G,IAAAA,CAAK8G,SAAAA,CAAU1D,EAAAA;YACjB;YAEO,OAAO6D,CAAAA,EAAAA;gBACRjH,IAAAA,CAAK4G,YAAAA,IAGT5G,CAAAA,IAAAA,CAAK4G,YAAAA,GAAAA,CAAe,GACpB5G,IAAAA,CAAK+G,SAAAA,CAAUE,EAAAA;YACjB;QAAA;QCnBK,MAAMC;YAAb,aAAA;gBACU,IAAA,CAAAC,OAAAA,GAAAA,CAAU,GACV,IAAA,CAAAC,MAAAA,GAAAA,CAAS,GACT,IAAA,CAAAC,UAAAA,GAA6C,CAAC,GAC9C,IAAA,CAAAC,cAAAA,GAAiD,CAAC,GAClD,IAAA,CAAAC,MAAAA,GAA8B,EAwHxC;YAAA;YAnHE,QAAAC;gBACExH,IAAAA,CAAKqH,UAAAA,GAAa,CAAC,GACnBrH,IAAAA,CAAKsH,cAAAA,GAAiB,CAAC,GACvBtH,IAAAA,CAAKuH,MAAAA,CAAOjH,MAAAA,GAAS,GACrBN,IAAAA,CAAKoH,MAAAA,GAAAA,CAAS;YAChB;YAIA,GAAoDM,CAAAA,EAAuBC,CAAAA,EAAAA;gBAAAA,IAAAA;gBAIzE,OAHA3H,IAAAA,CAAKoH,MAAAA,GAAAA,CAAS,GACdpH,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA,GAAuC,SAA1B,CAAA,IAAA1H,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,EAAA,EAC3D1H,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA,CAAW/H,IAAAA,CAAKgI,IACzB;oBACLC,OAAO,IAAM5H,IAAAA,CAAK6H,GAAAA,CAAIH,GAAWC;gBAAAA;YAErC;YAIA,KAAsDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAAAA,IAAAA;gBAI3E,OAHA3H,IAAAA,CAAKoH,MAAAA,GAAAA,CAAS,GACdpH,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,GAA2C,SAA9B,CAAA,IAAA1H,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,EAAA,EACnE1H,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,CAAW/H,IAAAA,CAAKgI,IAC7B;oBACLC,OAAO,IAAM5H,IAAAA,CAAK6H,GAAAA,CAAIH,GAAWC;gBAAAA;YAErC;YAKA,IAAqDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAC1E,IAAIA,GAAS;oBACX,MAAMI,IAAyC,SAA1B,CAAA,IAAA/H,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEM,MAAAA,CAAQC,CAAAA,IAAMA,MAAMN;oBACrE3H,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA,GAAaK;oBAE7B,MAAMG,IAAiD,SAA9B,CAAA,IAAAlI,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEM,MAAAA,CAAQC,CAAAA,IAAMA,MAAMN;oBAC7E3H,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,GAAaQ;gBACnC,OAAA,OACSlI,IAAAA,CAAKqH,UAAAA,CAAWK,EAE3B;YAAA;YAIA,KAAsDA,CAAAA,EAAuBU,CAAAA,EAAAA;gBAC3E,IAAIpI,IAAAA,CAAKoH,MAAAA,EACP;gBAEF,IAAIpH,IAAAA,CAAKmH,OAAAA,EACP;gBAEF,MAAMkB,IAAYrI,IAAAA,CAAKqH,UAAAA,CAAWK,EAAAA;gBAClC,IAAIW,GACF,IAAK,IAAI7H,IAAI,GAAGA,IAAI6H,EAAU/H,MAAAA,EAAQE,IACpC6H,CAAAA,CAAU7H,EAAAA,CAAG4H;gBAGjB,MAAME,IAAQtI,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA;gBAElC,IADA1H,IAAAA,CAAKsH,cAAAA,CAAeI,EAAAA,GAAa,EAAA,EAC7BY,GACF,IAAK,IAAI9H,IAAI,GAAGA,IAAI8H,EAAMhI,MAAAA,EAAQE,IAChC8H,CAAAA,CAAM9H,EAAAA,CAAG4H;gBAGb,IAAK,IAAI5H,IAAI,GAAGA,IAAIR,IAAAA,CAAKuH,MAAAA,CAAOjH,MAAAA,EAAQE,IACtCR,IAAAA,CAAKuH,MAAAA,CAAO/G,EAAAA,CAAG2H,IAAAA,CAAKT,GAAWU;YAEnC;YAMA,KAAKI,CAAAA,EAAAA;gBACH,IAAIxI,IAAAA,KAASwI,GACX,MAAMrC,MAAM;gBAId,OAFAnG,IAAAA,CAAKoH,MAAAA,GAAAA,CAAS,GACdpH,IAAAA,CAAKuH,MAAAA,CAAO5H,IAAAA,CAAK6I,IACV;oBACLZ,OAAO;wBACL,MAAMpH,IAAIR,IAAAA,CAAKuH,MAAAA,CAAOkB,OAAAA,CAAQD;wBAC1BhI,IAAAA,MACFR,IAAAA,CAAKuH,MAAAA,CAAOmB,MAAAA,CAAOlI,GAAG;oBACxB;gBAAA;YAGN;YAMA,OAAOgI,CAAAA,EAAAA;gBACL,MAAMhI,IAAIR,IAAAA,CAAKuH,MAAAA,CAAOkB,OAAAA,CAAQD;gBAC1BhI,IAAAA,MACFR,IAAAA,CAAKuH,MAAAA,CAAOmB,MAAAA,CAAOlI,GAAG;YAE1B;YAKA,QAAAoI;gBACE5I,IAAAA,CAAKmH,OAAAA,GAAAA,CAAU;YACjB;YAKA,UAAA0B;gBACE7I,IAAAA,CAAKmH,OAAAA,GAAAA,CAAU;YACjB;QAAA;QAAA,CNzIF,SAAY9D,CAAAA;YAKV,EAAA,MAAA,GAAA,UAKA,EAAA,QAAA,GAAA;QACD,EAXWA,KAAAA,CAAAA,IAAY,CAAA,CAAA,ICDxB,SAAYC,CAAAA;YAKV,EAAA,YAAA,GAAA,iBAKA,EAAA,WAAA,GAAA,gBAKA,EAAA,SAAA,GAAA,aAKA,EAAA,gBAAA,GAAA;QACD,EArBWA,KAAAA,CAAAA,IAAY,CAAA,CAAA;QMSxB,MAAMwF,IAAoB;QAUnB,MAAMC;YAgCX,YAAmBC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,IAAAA,GAAAA,GA9BX,IAAA,CAAAC,UAAAA,GAAqB,YACrB,IAAA,CAAAC,UAAAA,GAAqB,YAGrB,IAAA,CAAAC,EAAAA,GAAa,IAGb,IAAA,CAAAC,EAAAA,GAAa,KAGb,IAAA,CAAAC,EAAAA,GAAa,KAEb,IAAA,CAAAC,EAAAA,GAAa,YAGb,IAAA,CAAAC,EAAAA,GAAa,IACb,IAAA,CAAAC,EAAAA,GAAa,GACb,IAAA,CAAAC,EAAAA,GAAa,YACb,IAAA,CAAAC,EAAAA,GAAa,IACb,IAAA,CAAAC,EAAAA,GAAa,YACb,IAAA,CAAAC,EAAAA,GAAa,IACb,IAAA,CAAAC,EAAAA,GAAa,YAUnB7J,IAAAA,CAAK8J,GAAAA,GAAM,IAAIC,MAAc/J,IAAAA,CAAKoJ,EAAAA,GAElCpJ,IAAAA,CAAK8J,GAAAA,CAAI,EAAA,GAAA,AAAMd,CAAAA,KAAQ/D,KAAKC,GAAAA,EAAAA,MAAW;gBAEvC,IAAK,IAAI1E,IAAI,GAAGA,IAAIR,IAAAA,CAAKoJ,EAAAA,EAAI5I,IAAK;oBAChC,MAAMwJ,IAAIhK,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAI,EAAA,GAAMR,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAI,EAAA,KAAQR,IAAAA,CAAKmJ,EAAAA,GAAK;oBAE5DnJ,IAAAA,CAAK8J,GAAAA,CAAItJ,EAAAA,GAAAA,AAAQR,CAAAA,IAAAA,CAAK6J,EAAAA,GAAAA,CAAAA,AAAW,CAAA,aAAJG,CAAAA,MAAoB,EAAA,KAAQ,EAAA,IAAMhK,IAAAA,CAAK6J,EAAAA,GAAU,CAAA,QAAJG,CAAAA,IAAcxJ,MAAO;gBACjG;gBACAR,IAAAA,CAAKiK,MAAAA,GAASjK,IAAAA,CAAKoJ,EACrB;YAAA;YAKQ,SAAAc;gBACN,MAAMC,IAAQ;oBAAC;oBAAKnK,IAAAA,CAAKsJ,EAAAA;iBAAAA;gBACzB,IAAIc,IAAI,GACN5J,IAAI;gBACN,MAAOA,IAAIR,IAAAA,CAAKoJ,EAAAA,GAAKpJ,IAAAA,CAAKqJ,EAAAA,EAAI7I,IAC5B4J,IAAKpK,IAAAA,CAAK8J,GAAAA,CAAItJ,EAAAA,GAAKR,IAAAA,CAAKkJ,UAAAA,GAAelJ,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAI,EAAA,GAAKR,IAAAA,CAAKiJ,UAAAA,EAC9DjJ,IAAAA,CAAK8J,GAAAA,CAAItJ,EAAAA,GAAKR,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAIR,IAAAA,CAAKqJ,EAAAA,CAAAA,GAAOe,MAAM,IAAMD,CAAAA,CAAU,IAAJC,EAAAA,GAAWtB;gBAEtE,MAAOtI,IAAIR,IAAAA,CAAKoJ,EAAAA,GAAK,GAAG5I,IACtB4J,IAAKpK,IAAAA,CAAK8J,GAAAA,CAAItJ,EAAAA,GAAKR,IAAAA,CAAKkJ,UAAAA,GAAelJ,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAI,EAAA,GAAKR,IAAAA,CAAKiJ,UAAAA,EAC9DjJ,IAAAA,CAAK8J,GAAAA,CAAItJ,EAAAA,GAAKR,IAAAA,CAAK8J,GAAAA,CAAItJ,IAAKR,CAAAA,IAAAA,CAAKqJ,EAAAA,GAAKrJ,IAAAA,CAAKoJ,EAAAA,AAAAA,EAAAA,GAAQgB,MAAM,IAAMD,CAAAA,CAAU,IAAJC,EAAAA,GAAWtB;gBAElFsB,IAAKpK,IAAAA,CAAK8J,GAAAA,CAAI9J,IAAAA,CAAKoJ,EAAAA,GAAK,EAAA,GAAKpJ,IAAAA,CAAKkJ,UAAAA,GAAelJ,IAAAA,CAAK8J,GAAAA,CAAI,EAAA,GAAK9J,IAAAA,CAAKiJ,UAAAA,EACpEjJ,IAAAA,CAAK8J,GAAAA,CAAI9J,IAAAA,CAAKoJ,EAAAA,GAAK,EAAA,GAAKpJ,IAAAA,CAAK8J,GAAAA,CAAI9J,IAAAA,CAAKqJ,EAAAA,GAAK,EAAA,GAAMe,MAAM,IAAMD,CAAAA,CAAU,IAAJC,EAAAA,GAAWtB,GAE9E9I,IAAAA,CAAKiK,MAAAA,GAAS;YAChB;YAKO,UAAAI;gBACDrK,IAAAA,CAAKiK,MAAAA,IAAUjK,IAAAA,CAAKoJ,EAAAA,IACtBpJ,IAAAA,CAAKkK,MAAAA;gBAGP,IAAIE,IAAIpK,IAAAA,CAAK8J,GAAAA,CAAI9J,IAAAA,CAAKiK,MAAAA,GAAAA;gBAOtB,OALAG,KAAKA,MAAMpK,IAAAA,CAAKuJ,EAAAA,EAChBa,KAAMA,KAAKpK,IAAAA,CAAKwJ,EAAAA,GAAMxJ,IAAAA,CAAKyJ,EAAAA,EAC3BW,KAAMA,KAAKpK,IAAAA,CAAK0J,EAAAA,GAAM1J,IAAAA,CAAK2J,EAAAA,EAC3BS,KAAKA,MAAMpK,IAAAA,CAAK4J,EAAAA,EAETQ,MAAM;YACf;YAKO,OAAAE;gBACL,OAAOtK,IAAAA,CAAKqK,OAAAA,KAAa,CAAA,IAAM,UAAA;YACjC;YAKO,SAASG,CAAAA,EAAajF,CAAAA,EAAAA;gBAC3B,OAAA,AAAQA,CAAAA,IAAMiF,CAAAA,IAAOxK,IAAAA,CAAKsK,IAAAA,KAASE;YACrC;YAMO,QAAQA,CAAAA,EAAajF,CAAAA,EAAAA;gBAC1B,OAAOD,KAAKoF,KAAAA,CAAAA,AAAOnF,CAAAA,IAAMiF,IAAM,CAAA,IAAKxK,IAAAA,CAAKsK,IAAAA,KAASE;YACpD;YAOO,KAAKI,IAAqB,EAAA,EAAA;gBAC/B,OAAO5K,IAAAA,CAAKsK,IAAAA,MAAUM;YACxB;YAKO,QAAWE,CAAAA,EAAAA;gBAChB,OAAOA,CAAAA,CAAM9K,IAAAA,CAAKyK,OAAAA,CAAQ,GAAGK,EAAMxK,MAAAA,GAAS,GAC9C;YAAA;YASO,QAAWwK,CAAAA,EAAiBE,CAAAA,EAAkBC,IAAAA,CAA2B,CAAA,EAAA;gBAC9E,OAAIA,IACKjL,IAAAA,CAAKkL,sBAAAA,CAAuBJ,GAAOE,KAEnChL,IAAAA,CAAKmL,yBAAAA,CAA0BL,GAAOE;YAEjD;YAOQ,0BAA6BF,CAAAA,EAAiBE,CAAAA,EAAAA;gBACpD,IAAIA,IAAWF,EAAMxK,MAAAA,IAAU0K,IAAW,GACxC,MAAM,IAAI7E,MAAM;gBAElB,IAAI6E,MAAaF,EAAMxK,MAAAA,EACrB,OAAOwK;gBAGT,MAAMM,IAAmB,IAAIrB,MAASiB;gBACtC,IAAIK,IAAc;gBAClB,MAAMC,IAAYR,EAAMS,KAAAA,CAAM;gBAC9B,MAAOF,IAAcL,GAAU;oBAC7B,MAAMQ,IAAQxL,IAAAA,CAAKyK,OAAAA,CAAQ,GAAGa,EAAUhL,MAAAA,GAAS;oBACjD8K,CAAAA,CAAOC,IAAAA,GAAiBC,CAAAA,CAAUE,EAAAA,EAClCF,EAAU5C,MAAAA,CAAO8C,GAAO;gBAC1B;gBAEA,OAAOJ;YACT;YAOQ,uBAA0BN,CAAAA,EAAiBE,CAAAA,EAAAA;gBAEjD,IAAIA,IAAW,GACb,MAAM,IAAI7E,MAAM;gBAElB,MAAMiF,IAAS,IAAIrB,MAASiB;gBAC5B,IAAK,IAAIxK,IAAI,GAAGA,IAAIwK,GAAUxK,IAC5B4K,CAAAA,CAAO5K,EAAAA,GAAKR,IAAAA,CAAK6K,OAAAA,CAAQC;gBAE3B,OAAOM;YACT;YAMO,QAAWN,CAAAA,EAAAA;gBAChB,MAAMQ,IAAYR,EAAMS,KAAAA,CAAM;gBAC9B,IAAIG;gBACJ,IAAK,IAAIlL,IAAI,GAAGA,IAAI8K,EAAUhL,MAAAA,GAAS,GAAGE,IAAK;oBAC7C,MAAMmL,IAAc3L,IAAAA,CAAKyK,OAAAA,CAAQjK,GAAG8K,EAAUhL,MAAAA,GAAS;oBACvDoL,IAAOJ,CAAAA,CAAU9K,EAAAA,EACjB8K,CAAAA,CAAU9K,EAAAA,GAAK8K,CAAAA,CAAUK,EAAAA,EACzBL,CAAAA,CAAUK,EAAAA,GAAeD;gBAC3B;gBAEA,OAAOJ;YACT;YAQO,MAAMhL,CAAAA,EAAgBkK,CAAAA,EAAajF,CAAAA,EAAAA;gBACxC,MAAM6F,IAAwB,IAAIrB,MAAMzJ;gBACxC,IAAK,IAAIE,IAAI,GAAGA,IAAIF,GAAQE,IAC1B4K,CAAAA,CAAO5K,EAAAA,GAAKR,IAAAA,CAAKyK,OAAAA,CAAQD,GAAKjF;gBAEhC,OAAO6F;YACT;YAKO,KAAAS;gBACL,OAAO7L,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;YAKO,KAAAqB;gBACL,OAAO9L,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;YAKO,KAAAsB;gBACL,OAAO/L,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;YAKO,MAAAuB;gBACL,OAAOhM,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;YAKO,MAAAwB;gBACL,OAAOjM,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;YAKO,MAAAyB;gBACL,OAAOlM,IAAAA,CAAKyK,OAAAA,CAAQ,GAAG;YACzB;QAAA;QC3QK,MAAM0B,IAA0B,IAAV7G,KAAK8G,EAAAA;QAM3B,SAASC,EAAKC,CAAAA;YACnB,OAAIA,KAAK,IACAA,IAAIhH,KAAKoF,KAAAA,CAAM4B,KAEfA,IAAIhH,KAAKiH,IAAAA,CAAKD;QAEzB;QAKO,SAASE,EAAKC,CAAAA;YACnB,OAAY,MAARA,IACK,IAEFA,IAAM,IAAA,KAAS;QACxB;QAKO,SAASC,EAAMD,CAAAA,EAAajC,CAAAA,EAAajF,CAAAA;YAC9C,OAAOD,KAAKkF,GAAAA,CAAIlF,KAAKC,GAAAA,CAAIiF,GAAKiC,IAAMlH;QACtC;QAKO,SAASoH,EAAmBC,CAAAA,EAAcC,CAAAA,EAAcC,CAAAA;YAE7D,OAAOxH,KAAKyH,GAAAA,CAAIH,IAAOC,KAAQC;QACjC;QAKO,SAASE,EAAkBC,CAAAA;YAChC,IAAIC,IAAWD;YACf,IAAIA,KAASd,GACX,MAAOe,KAAYf,GACjBe,KAAYf;YAIhB,IAAIc,IAAQ,GACV,MAAOC,IAAW,GAChBA,KAAYf;YAGhB,OAAOe;QACT;QAKO,SAASC,EAAUC,CAAAA;YACxB,OAAQ,MAAM9H,KAAK8G,EAAAA,GAAMgB;QAC3B;QAKO,SAASC,EAAUC,CAAAA;YACxB,OAAQA,IAAU,MAAOhI,KAAK8G,EAChC;QAAA;QAQO,MAAMR,IAAQ,CAAC2B,GAAcC,IAAezD,MAAMwD,IAAAA,CAAK,IAAIxD,MAAMyD,IAAKD,IAAO,IAAI,CAACE,GAAIjN,IAAMA,IAAI+M;QAKhG,SAASG,EAAclD,CAAAA,EAAajF,CAAAA,EAAaoI,IAAiB,IAAI5E,CAAAA;YAC3E,OAAO4E,IAASA,EAAOpD,QAAAA,CAASC,GAAKjF,KAAOiF,IAAMlF,KAAKqI,MAAAA,KAAYpI,CAAAA,IAAMiF,CAAAA;QAC3E;QAKO,SAASoD,EAAiBpD,CAAAA,EAAajF,CAAAA,EAAaoI,IAAiB,IAAI5E,CAAAA;YAC9E,OAAO4E,IAASA,EAAOlD,OAAAA,CAAQD,GAAKjF,KAAOD,KAAKuI,KAAAA,CAAMH,EAAclD,GAAKjF;QAC3E;QCzFO,MAAMuI;YAQJ,WAAA,OAAWC;gBAChB,OAAO,IAAID,EAAO,GAAG;YACvB;YAKO,WAAA,MAAWE;gBAChB,OAAO,IAAIF,EAAO,GAAG;YACvB;YAKO,WAAA,OAAWG;gBAChB,OAAO,IAAIH,EAAO,IAAK;YACzB;YAKO,WAAA,KAAWI;gBAChB,OAAO,IAAIJ,EAAO,GAAA;YACpB;YAKO,WAAA,OAAWK;gBAChB,OAAO,IAAIL,EAAO,GAAG;YACvB;YAKO,WAAA,OAAWM;gBAChB,OAAO,IAAIN,EAAAA,IAAW;YACxB;YAIO,WAAA,QAAWO;gBAChB,OAAO,IAAIP,EAAO,GAAG;YACvB;YAMO,OAAA,UAAiBb,CAAAA,EAAAA;gBACtB,OAAO,IAAIa,EAAOxI,KAAKiJ,GAAAA,CAAItB,IAAQ3H,KAAKkJ,GAAAA,CAAIvB;YAC9C;YAKO,OAAA,QAAeyB,CAAAA,EAAAA;gBACpB,OAAIA,QAAAA,KAAAA,CAGAC,MAAMD,EAAIpC,CAAAA,KAAAA,CAAMqC,MAAMD,EAAItE,CAAAA,KAI1BsE,EAAIpC,CAAAA,KAAMsC,IAAAA,KAAYF,EAAItE,CAAAA,KAAMwE,IAAAA,KAAYF,EAAIpC,CAAAA,KAAAA,KAAOsC,KAAYF,EAAItE,CAAAA,KAAAA,KAAOwE;YAKpF;YAOO,OAAA,SAAgBE,CAAAA,EAAcC,CAAAA,EAAAA;gBACnC,OAAOzJ,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIH,EAAKxC,CAAAA,GAAIyC,EAAKzC,CAAAA,EAAG,KAAKhH,KAAK2J,GAAAA,CAAIH,EAAK1E,CAAAA,GAAI2E,EAAK3E,CAAAA,EAAG;YAC5E;YAEO,OAAA,IAAW0E,CAAAA,EAAcC,CAAAA,EAAAA;gBAC9B,OAAO,IAAIjB,EAAOxI,KAAKkF,GAAAA,CAAIsE,EAAKxC,CAAAA,EAAGyC,EAAKzC,CAAAA,GAAIhH,KAAKkF,GAAAA,CAAIsE,EAAK1E,CAAAA,EAAG2E,EAAK3E,CAAAA;YACpE;YAEO,OAAA,IAAW0E,CAAAA,EAAcC,CAAAA,EAAAA;gBAC9B,OAAO,IAAIjB,EAAOxI,KAAKC,GAAAA,CAAIuJ,EAAKxC,CAAAA,EAAGyC,EAAKzC,CAAAA,GAAIhH,KAAKC,GAAAA,CAAIuJ,EAAK1E,CAAAA,EAAG2E,EAAK3E,CAAAA;YACpE;YAMA,YAAYkC,CAAAA,EAAWlC,CAAAA,CAAAA;gBAKb,IAAA,CAAAqD,EAAAA,GAAK,GAgBL,IAAA,CAAAyB,EAAAA,GAAK,GApBblP,IAAAA,CAAKyN,EAAAA,GAAKnB,GACVtM,IAAAA,CAAKkP,EAAAA,GAAK9E;YACZ;YAMA,IAAA,IAAWkC;gBACT,OAAOtM,IAAAA,CAAKyN,EACd;YAAA;YAMA,IAAA,EAAahB,CAAAA,EAAAA;gBACXzM,IAAAA,CAAKyN,EAAAA,GAAKhB;YACZ;YAMA,IAAA,IAAWrC;gBACT,OAAOpK,IAAAA,CAAKkP,EACd;YAAA;YAMA,IAAA,EAAazC,CAAAA,EAAAA;gBACXzM,IAAAA,CAAKkP,EAAAA,GAAKzC;YACZ;YAMA,MAAMH,CAAAA,EAAWlC,CAAAA,EAAAA;gBACdpK,IAAAA,CAAKsM,CAAAA,GAAeA,GACpBtM,IAAAA,CAAKoK,CAAAA,GAAeA;YACvB;YAOO,OAAOiF,CAAAA,EAAgBvC,IAAoBgB,EAAOwB,cAAAA,EAAAA;gBACvD,OAAOhK,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKsM,CAAAA,GAAI+C,EAAO/C,CAAAA,KAAMQ,KAAaxH,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKoK,CAAAA,GAAIiF,EAAOjF,CAAAA,KAAM0C;YACpF;YAMO,SAASyC,CAAAA,EAAAA;gBACd,IAAA,CAAKA,GACH,OAAOjK,KAAK0J,IAAAA,CAAKhP,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA;gBAEnD,MAAMoF,IAASxP,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EACpBmD,IAASzP,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA;gBAC1B,OAAO9E,KAAK0J,IAAAA,CAAKQ,IAASA,IAASC,IAASA;YAC9C;YAEO,eAAeF,CAAAA,EAAAA;gBACfA,KACHA,CAAAA,IAAIzB,EAAOC,IAAAA,AAAAA;gBAEb,MAAMyB,IAASxP,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EACpBmD,IAASzP,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA;gBAC1B,OAAOoF,IAASA,IAASC,IAASA;YACpC;YAMO,eAAeG,CAAAA,EAAAA;gBACpB,MACMC,IAAUnD,EADH1M,IAAAA,CAAK4P,SAAAA,EACU,GAAGA;gBAE/B,OADA5P,IAAAA,CAAK4P,SAAAA,GAAYC,GACV7P,IACT;YAAA;YAMA,IAAA,OAAW8P;gBACT,OAAO9P,IAAAA,CAAK6O,QAAAA;YACd;YAOA,IAAA,KAAgBkB,CAAAA,EAAAA;gBACd,MAAMR,IAAIvP,IAAAA,CAAKgQ,SAAAA,GAAYC,KAAAA,CAAMF;gBACjC/P,IAAAA,CAAKmP,KAAAA,CAAMI,EAAEjD,CAAAA,EAAGiD,EAAEnF,CAAAA;YACpB;YAKA,IAAA,YAAWwF;gBACT,OAAO5P,IAAAA,CAAK6O,QAAAA;YACd;YAMA,IAAA,UAAqBqB,CAAAA,EAAAA;gBACnBlQ,IAAAA,CAAKgQ,SAAAA,GAAYC,KAAAA,CAAMC,GAAclQ,IAAAA;YACvC;YAKO,YAAAgQ;gBACL,MAAMnB,IAAW7O,IAAAA,CAAK6O,QAAAA;gBACtB,OAAiB,MAAbA,IACKf,EAAOC,IAAAA,GAGT,IAAID,EAAO9N,IAAAA,CAAKsM,CAAAA,GAAIuC,GAAU7O,IAAAA,CAAKoK,CAAAA,GAAIyE;YAChD;YAKO,QAAQH,CAAAA,EAAAA;gBACb,OAAO1O,IAAAA,CAAKoQ,GAAAA,CAAI1B,GAAKuB,KAAAA,CAAM;YAC7B;YASO,MAAMI,CAAAA,EAA8BC,CAAAA,EAAAA;gBACzC,MAAMlF,IAASkF,KAAQ,IAAIxC,EAAO,GAAG;gBAQrC,OAPIuC,aAAuBvC,IACzB1C,CAAAA,EAAOkB,CAAAA,GAAItM,IAAAA,CAAKsM,CAAAA,GAAI+D,EAAY/D,CAAAA,EAChClB,EAAOhB,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA,GAAIiG,EAAYjG,CAAAA,AAAAA,IAEhCgB,CAAAA,EAAOkB,CAAAA,GAAItM,IAAAA,CAAKsM,CAAAA,GAAI+D,GACpBjF,EAAOhB,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA,GAAIiG,CAAAA,GAEfjF;YACT;YAOO,IAAImE,CAAAA,EAAWe,CAAAA,EAAAA;gBACpB,OAAIA,IACFA,CAAAA,EAAKhE,CAAAA,GAAItM,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EACpBgE,EAAKlG,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA,EACbkG,CAAAA,IAEF,IAAIxC,EAAO9N,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EAAGtM,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA;YAC7C;YAMO,IAAImF,CAAAA,EAAWe,CAAAA,EAAAA;gBACpB,MAAMlF,IAASkF,KAAQ,IAAIxC,EAAO,GAAG,IAC/BxB,IAAItM,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EACflC,IAAIpK,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA;gBAGrB,OAFAgB,EAAOkB,CAAAA,GAAIA,GACXlB,EAAOhB,CAAAA,GAAIA,GACJgB;YACT;YAOO,SAASmE,CAAAA,EAAAA;gBAEd,OADAvP,IAAAA,CAAKmP,KAAAA,CAAMnP,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EAAGtM,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA,GAC7BpK,IACT;YAAA;YAOO,SAASuP,CAAAA,EAAAA;gBAEd,OADAvP,IAAAA,CAAKmP,KAAAA,CAAMnP,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,EAAGtM,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CAAAA,GAC7BpK,IACT;YAAA;YAMO,WAAW8P,CAAAA,EAAAA;gBAEhB,OADA9P,IAAAA,CAAKmP,KAAAA,CAAMnP,IAAAA,CAAKsM,CAAAA,GAAIwD,GAAM9P,IAAAA,CAAKoK,CAAAA,GAAI0F,IAC5B9P,IACT;YAAA;YAMO,IAAIuP,CAAAA,EAAAA;gBACT,OAAOvP,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEjD,CAAAA,GAAItM,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEnF,CACnC;YAAA;YAYO,MAAMmF,CAAAA,EAAAA;gBACX,OAAIA,aAAazB,IACR9N,IAAAA,CAAKsM,CAAAA,GAAIiD,EAAEnF,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA,GAAImF,EAAEjD,CAAAA,GACX,YAAA,OAANiD,IACT,IAAIzB,EAAOyB,IAAIvP,IAAAA,CAAKoK,CAAAA,EAAAA,CAAImF,IAAIvP,IAAAA,CAAKsM,CAAAA,IAAAA,KADnC;YAGT;YAEA,OAAA,MAAauE,CAAAA,EAAanC,CAAAA,EAAAA;gBACxB,OAAO,IAAIZ,EAAAA,CAAQ+C,IAAMnC,EAAItE,CAAAA,EAAGyG,IAAMnC,EAAIpC,CAAAA;YAC5C;YAKO,gBAAAwE;gBACL,OAAO,IAAIhD,EAAO9N,IAAAA,CAAKoK,CAAAA,EAAAA,CAAIpK,IAAAA,CAAKsM,CAAAA;YAClC;YAKO,SAAAyE;gBACL,OAAO/Q,IAAAA,CAAK8Q,aAAAA,GAAgBd,SAAAA;YAC9B;YAKO,SAAAgB;gBACL,OAAOhR,IAAAA,CAAKiQ,KAAAA,CAAAA;YACd;YAKO,UAAAgB;gBACL,OAAOjE,EAAkB1H,KAAK4L,KAAAA,CAAMlR,IAAAA,CAAKoK,CAAAA,EAAGpK,IAAAA,CAAKsM,CAAAA;YACnD;YASO,aAAaW,CAAAA,EAAemE,CAAAA,EAAAA;gBACjC,MAAMC,IAAoBrR,IAAAA,CAAKiR,OAAAA,IACzBK,IAAkBtE,EAAkBC;gBAC1C,IAAIsE,IAAoB,GACpBC,IAAwB;gBAO5B,OALED,IADED,IAAkBD,IACAC,IAAkBD,IAAAA,AAEjBlF,CAAAA,IAAQkF,IAAoBC,CAAAA,IAAmBnF,GAEtEqF,IAAAA,AAAyBD,CAAAA,IAAoBpF,CAAAA,IAASA,GAC9CiF;oBACN,KAAK9N,EAAamO,YAAAA;wBAChB,OAAInM,KAAKyH,GAAAA,CAAIwE,KAAqBjM,KAAKyH,GAAAA,CAAIyE,KAClCD,IAEAC;oBAEX,KAAKlO,EAAaoO,WAAAA;wBAChB,OAAIpM,KAAKyH,GAAAA,CAAIwE,KAAqBjM,KAAKyH,GAAAA,CAAIyE,KAClCD,IAEAC;oBAEX,KAAKlO,EAAaqO,SAAAA;wBAChB,OAAOJ;oBACT,KAAKjO,EAAasO,gBAAAA;wBAChB,OAAOJ;gBAAAA;YAEb;YAMO,OAAOvE,CAAAA,EAAe6E,CAAAA,EAAiBxB,CAAAA,EAAAA;gBAC5C,MAAMlF,IAASkF,KAAQ,IAAIxC,EAAO,GAAG;gBAChCgE,KACHA,CAAAA,IAAS,IAAIhE,EAAO,GAAG,EAAA;gBAEzB,MAAMiE,IAAWzM,KAAKkJ,GAAAA,CAAIvB,IACpB+E,IAAW1M,KAAKiJ,GAAAA,CAAItB,IACpBX,IAAI0F,IAAYhS,CAAAA,IAAAA,CAAKsM,CAAAA,GAAIwF,EAAOxF,CAAAA,AAAAA,IAAKyF,IAAY/R,CAAAA,IAAAA,CAAKoK,CAAAA,GAAI0H,EAAO1H,CAAAA,AAAAA,IAAK0H,EAAOxF,CAAAA,EAC7ElC,IAAI2H,IAAY/R,CAAAA,IAAAA,CAAKsM,CAAAA,GAAIwF,EAAOxF,CAAAA,AAAAA,IAAK0F,IAAYhS,CAAAA,IAAAA,CAAKoK,CAAAA,GAAI0H,EAAO1H,CAAAA,AAAAA,IAAK0H,EAAO1H,CAAAA;gBAGnF,OAFAgB,EAAOkB,CAAAA,GAAIA,GACXlB,EAAOhB,CAAAA,GAAIA,GACJgB;YACT;YAKO,MAAMkF,CAAAA,EAAAA;gBACX,MAAMf,IAAIe,QAAAA,IAAAA,IAAQ,IAAIxC,EAAO,GAAG;gBAGhC,OAFAyB,EAAEjD,CAAAA,GAAItM,IAAAA,CAAKsM,CAAAA,EACXiD,EAAEnF,CAAAA,GAAIpK,IAAAA,CAAKoK,CAAAA,EACJmF;YACT;YAKO,SAAS2C,CAAAA,EAAAA;gBACd,OAAIA,IACK,CAAA,CAAA,EAAIlS,IAAAA,CAAKsM,CAAAA,CAAE6F,OAAAA,CAAQD,GAAAA,EAAAA,EAAWlS,IAAAA,CAAKoK,CAAAA,CAAE+H,OAAAA,CAAQD,GAAAA,CAAAA,CAAAA,GAE/C,CAAA,CAAA,EAAIlS,IAAAA,CAAKsM,CAAAA,CAAAA,EAAAA,EAAMtM,IAAAA,CAAKoK,CAAAA,CAAAA,CAAAA,CAC7B;YAAA;QAAA;QASK,SAASsE,EAAIpC,CAAAA,EAAWlC,CAAAA;YAC7B,OAAO,IAAI0D,EAAOxB,GAAGlC;QACvB;QAtcgB,EAAAkF,cAAAA,GAAiB;QCP1B,MAAM8C;YAsCX,YAAYnP,CAAAA,EAAWoP,CAAAA,EAAWC,CAAAA,EAAWlQ,CAAAA,CAAAA;gBAC3CpC,IAAAA,CAAKiD,CAAAA,GAAIA,GACTjD,IAAAA,CAAKqS,CAAAA,GAAIA,GACTrS,IAAAA,CAAKsS,CAAAA,GAAIA,GACTtS,IAAAA,CAAKoC,CAAAA,GAAS,QAALA,IAAYA,IAAI;YAC3B;YASO,OAAA,QAAea,CAAAA,EAAWoP,CAAAA,EAAWC,CAAAA,EAAWlQ,CAAAA,EAAAA;gBACrD,OAAO,IAAIgQ,EAAMnP,GAAGoP,GAAGC,GAAGlQ;YAC5B;YAMO,OAAA,cAAqBqQ,CAAAA,EAAAA;gBAE1B,IAAIC,IAAQ;gBACZ,IAAKA,IAAQD,EAAOC,KAAAA,CAFM,+DAEa;oBACrC,MAAMzP,IAAI0P,SAASD,CAAAA,CAAM,EAAA,EAAI,KACvBL,IAAIM,SAASD,CAAAA,CAAM,EAAA,EAAI,KACvBJ,IAAIK,SAASD,CAAAA,CAAM,EAAA,EAAI;oBAC7B,IAAItQ,IAAI;oBAIR,OAHIsQ,CAAAA,CAAM,EAAA,IACRtQ,CAAAA,IAAIwQ,WAAWF,CAAAA,CAAM,EAAA,CAAA,GAEhB,IAAIN,EAAMnP,GAAGoP,GAAGC,GAAGlQ;gBAC5B;gBACE,MAAM,IAAI+D,MAAM,2BAA2BsM;YAE/C;YAMO,OAAA,QAAeK,CAAAA,EAAAA;gBAEpB,IAAIJ,IAAQ;gBACZ,IAAKA,IAAQI,EAAIJ,KAAAA,CAFQ,+DAEU;oBACjC,MAAMzP,IAAI0P,SAASD,CAAAA,CAAM,EAAA,EAAI,KACvBL,IAAIM,SAASD,CAAAA,CAAM,EAAA,EAAI,KACvBJ,IAAIK,SAASD,CAAAA,CAAM,EAAA,EAAI;oBAC7B,IAAItQ,IAAI;oBAIR,OAHIsQ,CAAAA,CAAM,EAAA,IACRtQ,CAAAA,IAAIuQ,SAASD,CAAAA,CAAM,EAAA,EAAI,MAAM,GAAA,GAExB,IAAIN,EAAMnP,GAAGoP,GAAGC,GAAGlQ;gBAC5B;gBACE,MAAM,IAAI+D,MAAM,yBAAyB2M;YAE7C;YASO,OAAA,QAAe7K,CAAAA,EAAW+B,CAAAA,EAAWgJ,CAAAA,EAAW5Q,IAAY,CAAA,EAAA;gBAEjE,OADa,IAAI6Q,EAAShL,GAAG+B,GAAGgJ,GAAG5Q,GACvB8Q,MAAAA;YACd;YAMO,QAAQE,IAAiB,EAAA,EAAA;gBAC9B,MAAMC,IAAOJ,EAASK,QAAAA,CAAStT,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA;gBAE5D,OADAiR,EAAKL,CAAAA,IAAAA,AAAM,CAAA,IAAIK,EAAKL,CAAAA,AAAAA,IAAKI,GAClBC,EAAKH,MAAAA;YACd;YAMO,OAAOE,IAAiB,EAAA,EAAA;gBAC7B,MAAMC,IAAOJ,EAASK,QAAAA,CAAStT,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA;gBAE5D,OADAiR,EAAKL,CAAAA,IAAKK,EAAKL,CAAAA,GAAII,GACZC,EAAKH,MAAAA;YACd;YAMO,SAASE,IAAiB,EAAA,EAAA;gBAC/B,MAAMC,IAAOJ,EAASK,QAAAA,CAAStT,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA;gBAE5D,OADAiR,EAAKrJ,CAAAA,IAAKqJ,EAAKrJ,CAAAA,GAAIoJ,GACZC,EAAKH,MAAAA;YACd;YAMO,WAAWE,IAAiB,EAAA,EAAA;gBACjC,MAAMC,IAAOJ,EAASK,QAAAA,CAAStT,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA;gBAE5D,OADAiR,EAAKrJ,CAAAA,IAAKqJ,EAAKrJ,CAAAA,GAAIoJ,GACZC,EAAKH,MAAAA;YACd;YAMO,SAASS,CAAAA,EAAAA;gBACd,MAAMC,IAAUD,EAAM1Q,CAAAA,GAAI,MAAOjD,IAAAA,CAAKiD,CAAAA,GAAK,MAAO,KAC5C4Q,IAAUF,EAAMtB,CAAAA,GAAI,MAAOrS,IAAAA,CAAKqS,CAAAA,GAAK,MAAO,KAC5CyB,IAAUH,EAAMrB,CAAAA,GAAI,MAAOtS,IAAAA,CAAKsS,CAAAA,GAAK,MAAO,KAC5CyB,IAAOJ,EAAMvR,CAAAA,GAAIpC,IAAAA,CAAKoC,CAAAA;gBAC5B,OAAO,IAAIgQ,EAAMwB,GAAMC,GAAMC,GAAMC;YACrC;YAMO,OAAOJ,CAAAA,EAAAA;gBACZ,MAAMM,IAASN,EAAMO,MAAAA,IACfC,IAASR,EAAMO,MAAAA;gBACrB,OAAOD,EAAOP,QAAAA,CAASS,GAAQD,MAAAA;YACjC;YAKO,SAAAA;gBACL,OAAO,IAAI9B,EAAM,MAAMpS,IAAAA,CAAKiD,CAAAA,EAAG,MAAMjD,IAAAA,CAAKqS,CAAAA,EAAG,MAAMrS,IAAAA,CAAKsS,CAAAA,EAAG,IAAMtS,IAAAA,CAAKoC,CAAAA;YACxE;YAMO,QAAQuR,CAAAA,EAAAA;gBACb,MAAMC,IAAAA,AAAQD,CAAAA,EAAM1Q,CAAAA,GAAIjD,IAAAA,CAAKiD,CAAAA,AAAAA,IAAK,GAC5B4Q,IAAAA,AAAQF,CAAAA,EAAMtB,CAAAA,GAAIrS,IAAAA,CAAKqS,CAAAA,AAAAA,IAAK,GAC5ByB,IAAAA,AAAQH,CAAAA,EAAMrB,CAAAA,GAAItS,IAAAA,CAAKsS,CAAAA,AAAAA,IAAK,GAC5ByB,IAAAA,AAAQJ,CAAAA,EAAMvR,CAAAA,GAAIpC,IAAAA,CAAKoC,CAAAA,AAAAA,IAAK;gBAClC,OAAO,IAAIgQ,EAAMwB,GAAMC,GAAMC,GAAMC;YACrC;YAEO,MAAMJ,CAAAA,EAAAA;gBACX,OAAO3T,IAAAA,CAAKD,QAAAA,OAAe4T,EAAM5T,QAAAA;YACnC;YAMO,SAASsU,IAAgC,KAAA,EAAA;gBAC9C,OAAQA;oBACN,KAAK;wBACH,OAAOrU,IAAAA,CAAKkT,MAAAA;oBACd,KAAK;wBACH,OAAOlT,IAAAA,CAAKsU,MAAAA;oBACd,KAAK;wBACH,OAAOtU,IAAAA,CAAKuU,KAAAA;oBACd;wBACE,MAAM,IAAIpO,MAAM;gBAAA;YAEtB;YAOQ,gBAAgBsO,CAAAA,EAAAA;gBAEtB,MAAM3B,IAAMxN,KAAKC,GAAAA,CAAID,KAAKuI,KAAAA,CAAM4G,IAAI,GAAG1U,QAAAA,CAAS;gBAChD,OAAsB,MAAf+S,EAAIxS,MAAAA,GAAe,MAAMwS,IAAMA;YACxC;YAKO,QAAAyB;gBACL,IAAIG,IAAoB,MAAM1U,IAAAA,CAAKwU,eAAAA,CAAgBxU,IAAAA,CAAKiD,CAAAA,IAAKjD,IAAAA,CAAKwU,eAAAA,CAAgBxU,IAAAA,CAAKqS,CAAAA,IAAKrS,IAAAA,CAAKwU,eAAAA,CAAgBxU,IAAAA,CAAKsS,CAAAA;gBAItH,OAHe,MAAXtS,IAAAA,CAAKoC,CAAAA,IACPsS,CAAAA,KAAqB1U,IAAAA,CAAKwU,eAAAA,CAAyB,MAATxU,IAAAA,CAAKoC,CAAAA,CAAAA,GAE1CsS;YACT;YAKO,SAAAxB;gBACL,MAAM9H,IAASuJ,OAAO3U,IAAAA,CAAKiD,CAAAA,CAAEkP,OAAAA,CAAQ,MAAM,OAAOwC,OAAO3U,IAAAA,CAAKqS,CAAAA,CAAEF,OAAAA,CAAQ,MAAM,OAAOwC,OAAO3U,IAAAA,CAAKsS,CAAAA,CAAEH,OAAAA,CAAQ;gBAC3G,OAAA,KAAerR,MAAXd,IAAAA,CAAKoC,CAAAA,IAA8B,SAAXpC,IAAAA,CAAKoC,CAAAA,GACxB,UAAUgJ,IAAS,OAAOuJ,OAAO3U,IAAAA,CAAKoC,CAAAA,IAAK,MAE7C,SAASgJ,IAAS;YAC3B;YAKO,SAAAkJ;gBACL,OAAOrB,EAASK,QAAAA,CAAStT,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA,EAAGrC,QAAAA;YAC3D;YAKO,YAAA6U;gBACL,OAAO5U,IAAAA,CAAKD,QAAAA;YACd;YAKO,MAAMuQ,CAAAA,EAAAA;gBACX,MAAMlF,IAASkF,KAAQ,IAAI8B,EAAMpS,IAAAA,CAAKiD,CAAAA,EAAGjD,IAAAA,CAAKqS,CAAAA,EAAGrS,IAAAA,CAAKsS,CAAAA,EAAGtS,IAAAA,CAAKoC,CAAAA;gBAK9D,OAJAgJ,EAAOnI,CAAAA,GAAIjD,IAAAA,CAAKiD,CAAAA,EAChBmI,EAAOiH,CAAAA,GAAIrS,IAAAA,CAAKqS,CAAAA,EAChBjH,EAAOkH,CAAAA,GAAItS,IAAAA,CAAKsS,CAAAA,EAChBlH,EAAOhJ,CAAAA,GAAIpC,IAAAA,CAAKoC,CAAAA,EACTgJ;YACT;YAKO,WAAA,QAAWyJ;gBAChB,OAAOzC,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,QAAWiC;gBAChB,OAAO1C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAWkC;gBAChB,OAAO3C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,YAAWmC;gBAChB,OAAO5C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,WAAWoC;gBAChB,OAAO7C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,SAAWqC;gBAChB,OAAO9C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,SAAWsC;gBAChB,OAAO/C,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,MAAWuC;gBAChB,OAAOhD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,YAAWwC;gBAChB,OAAOjD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAWyC;gBAChB,OAAOlD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAW0C;gBAChB,OAAOnD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,UAAW2C;gBAChB,OAAOpD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,SAAW4C;gBAChB,OAAOrD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,SAAW6C;gBAChB,OAAOtD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAW8C;gBAChB,OAAOvD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,QAAW+C;gBAChB,OAAOxD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAWgD;gBAChB,OAAOzD,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,WAAWiD;gBAChB,OAAO1D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,OAAWkD;gBAChB,OAAO3D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,QAAWmD;gBAChB,OAAO5D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,aAAWoD;gBAChB,OAAO7D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,cAAWqD;gBAChB,OAAO9D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,gBAAWsD;gBAChB,OAAO/D,EAAMS,OAAAA,CAAQ;YACvB;YAKO,WAAA,QAAWuD;gBAChB,OAAOhE,EAAMS,OAAAA,CAAQ;YACvB;QAAA;QASF,MAAMI;YACJ,YACShL,CAAAA,EACA+B,CAAAA,EACAgJ,CAAAA,EACA5Q,CAAAA,CAAAA;gBAHA,IAAA,CAAA6F,CAAAA,GAAAA,GACA,IAAA,CAAA+B,CAAAA,GAAAA,GACA,IAAA,CAAAgJ,CAAAA,GAAAA,GACA,IAAA,CAAA5Q,CAAAA,GAAAA;YACN;YAEI,OAAA,QAAekU,CAAAA,EAAWC,CAAAA,EAAWC,CAAAA,EAAAA;gBAO1C,OANIA,IAAI,KACNA,CAAAA,KAAK,CAAA,GAEHA,IAAI,KACNA,CAAAA,KAAK,CAAA,GAEHA,IAAI,IAAI,IACHF,IAAc,IAATC,CAAAA,IAAID,CAAAA,IAASE,IAEvBA,IAAI,KACCD,IAELC,IAAI,IAAI,IACHF,IAAAA,AAAKC,CAAAA,IAAID,CAAAA,IAAM,CAAA,IAAI,IAAIE,CAAAA,IAAK,IAE9BF;YACT;YAEO,OAAA,SAAgBrT,CAAAA,EAAWoP,CAAAA,EAAWC,CAAAA,EAAWlQ,CAAAA,EAAAA;gBACtDa,KAAK,KACLoP,KAAK,KACLC,KAAK;gBACL,MAAM/M,IAAMD,KAAKC,GAAAA,CAAItC,GAAGoP,GAAGC,IACzB9H,IAAMlF,KAAKkF,GAAAA,CAAIvH,GAAGoP,GAAGC;gBACvB,IAAIrK,GAAG+B;gBACP,MAAMgJ,IAAAA,AAAKzN,CAAAA,IAAMiF,CAAAA,IAAO;gBAExB,IAAIjF,MAAQiF,GACVvC,IAAI+B,IAAI;qBACH;oBACL,MAAM7H,IAAIoD,IAAMiF;oBAEhB,OADAR,IAAIgJ,IAAI,KAAM7Q,IAAK,CAAA,IAAIoD,IAAMiF,CAAAA,IAAOrI,IAAKoD,CAAAA,IAAMiF,CAAAA,GACvCjF;wBACN,KAAKtC;4BACHgF,IAAAA,AAAKoK,CAAAA,IAAIC,CAAAA,IAAKnQ,IAAKkQ,CAAAA,IAAIC,IAAI,IAAI,CAAA;4BAC/B;wBACF,KAAKD;4BACHpK,IAAAA,AAAKqK,CAAAA,IAAIrP,CAAAA,IAAKd,IAAI;4BAClB;wBACF,KAAKmQ;4BACHrK,IAAAA,AAAKhF,CAAAA,IAAIoP,CAAAA,IAAKlQ,IAAI;oBAAA;oBAGtB8F,KAAK;gBACP;gBAEA,OAAO,IAAIgL,EAAShL,GAAG+B,GAAGgJ,GAAG5Q;YAC/B;YAEO,SAAA8Q;gBACL,IAAIjQ,GAAWoP,GAAWC;gBAE1B,IAAe,MAAXtS,IAAAA,CAAKgK,CAAAA,EACP/G,IAAIoP,IAAIC,IAAItS,IAAAA,CAAKgT,CAAAA;qBACZ;oBACL,MAAMuD,IAAIvW,IAAAA,CAAKgT,CAAAA,GAAI,KAAMhT,IAAAA,CAAKgT,CAAAA,GAAK,CAAA,IAAIhT,IAAAA,CAAKgK,CAAAA,AAAAA,IAAKhK,IAAAA,CAAKgT,CAAAA,GAAIhT,IAAAA,CAAKgK,CAAAA,GAAIhK,IAAAA,CAAKgT,CAAAA,GAAIhT,IAAAA,CAAKgK,CAAAA,EAC3EsM,IAAI,IAAItW,IAAAA,CAAKgT,CAAAA,GAAIuD;oBACvBtT,IAAIgQ,EAASoD,OAAAA,CAAQC,GAAGC,GAAGvW,IAAAA,CAAKiI,CAAAA,GAAI,IAAI,IACxCoK,IAAIY,EAASoD,OAAAA,CAAQC,GAAGC,GAAGvW,IAAAA,CAAKiI,CAAAA,GAChCqK,IAAIW,EAASoD,OAAAA,CAAQC,GAAGC,GAAGvW,IAAAA,CAAKiI,CAAAA,GAAI,IAAI;gBAC1C;gBAEA,OAAO,IAAImK,EAAU,MAAJnP,GAAa,MAAJoP,GAAa,MAAJC,GAAStS,IAAAA,CAAKoC,CAAAA;YACnD;YAEO,WAAArC;gBAKL,OAAO,CAAA,KAAA,EAJGC,IAAAA,CAAKiI,CAAAA,CAAEkK,OAAAA,CAAQ,GAAA,EAAA,EACnBnS,IAAAA,CAAKgK,CAAAA,CAAEmI,OAAAA,CAAQ,GAAA,EAAA,EACfnS,IAAAA,CAAKgT,CAAAA,CAAEb,OAAAA,CAAQ,GAAA,EAAA,EACfnS,IAAAA,CAAKoC,CAAAA,CAAE+P,OAAAA,CAAQ,GAAA,CAAA,CAEvB;YAAA;QAAA;QC1gBF,IAAYsE,GCJAC,GCDAC;QAAAA,CFKZ,SAAYF,CAAAA;YACV,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SACA,CAAA,CAAA,EAAA,IAAA,GAAA,EAAA,GAAA,QACA,CAAA,CAAA,EAAA,IAAA,GAAA,EAAA,GAAA,QACA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SACA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA;QACD,EANWA,KAAAA,CAAAA,IAAQ,CAAA,CAAA;QAab,MAAMG;YAIX,aAAAjQ;gBACE,IAHM,IAAA,CAAAkQ,UAAAA,GAAyB,EAAA,EAgB1B,IAAA,CAAAC,YAAAA,GAAyBL,EAASM,IAAAA,EA6CjC,IAAA,CAAAC,WAAAA,GAAc,IAAIC,KA1DpBL,EAAOM,SAAAA,EACT,MAAM,IAAI/Q,MAAM;gBAKlB,OAHAyQ,EAAOM,SAAAA,GAAYlX,IAAAA,EAEnB4W,EAAOM,SAAAA,CAAUC,WAAAA,CAAY,IAAIC,IAC1BR,EAAOM,SAChB;YAAA;YAWO,OAAA,cAAOG;gBAIZ,OAHwB,QAApBT,EAAOM,SAAAA,IACTN,CAAAA,EAAOM,SAAAA,GAAY,IAAIN,CAAAA,GAElBA,EAAOM,SAChB;YAAA;YAKO,YAAYI,CAAAA,EAAAA;gBACjBtX,IAAAA,CAAK6W,UAAAA,CAAWlX,IAAAA,CAAK2X;YACvB;YAKO,iBAAAC;gBACLvX,IAAAA,CAAK6W,UAAAA,CAAWvW,MAAAA,GAAS;YAC3B;YAOQ,KAAKmX,CAAAA,EAAiBC,CAAAA,EAAAA;gBACf,QAATD,KACFA,CAAAA,IAAQzX,IAAAA,CAAK8W,YAAAA,AAAAA;gBAGf,MAAMa,IAAM3X,IAAAA,CAAK6W,UAAAA,CAAWvW,MAAAA;gBAE5B,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IACnBiX,KAASzX,IAAAA,CAAK8W,YAAAA,IAChB9W,IAAAA,CAAK6W,UAAAA,CAAWrW,EAAAA,CAAGoX,GAAAA,CAAIH,GAAOC;YAGpC;YAGQ,SAASD,CAAAA,EAAiBC,CAAAA,EAAAA;gBAChC,MAAMI,IAAaL,IAAQC,EAAKnX,IAAAA,CAAK;gBACjCP,IAAAA,CAAKgX,WAAAA,CAAYe,GAAAA,CAAID,MAGvB9X,CAAAA,IAAAA,CAAKgX,WAAAA,CAAY5G,GAAAA,CAAI0H,IACrB9X,IAAAA,CAAKwX,IAAAA,CAAKC,GAAOC,EAAAA;YAErB;YAMO,MAAAM,GAASN,CAAAA,EAAAA;gBACd1X,IAAAA,CAAKwX,IAAAA,CAAKf,EAASwB,KAAAA,EAAOP;YAC5B;YAMO,UAAAQ,GAAaR,CAAAA,EAAAA;gBAClB1X,IAAAA,CAAK6X,QAAAA,CAASpB,EAASwB,KAAAA,EAAOP;YAChC;YAMO,KAAAS,GAAQT,CAAAA,EAAAA;gBACb1X,IAAAA,CAAKwX,IAAAA,CAAKf,EAASM,IAAAA,EAAMW;YAC3B;YAMO,SAAAU,GAAYV,CAAAA,EAAAA;gBACjB1X,IAAAA,CAAK6X,QAAAA,CAASpB,EAASM,IAAAA,EAAMW;YAC/B;YAMO,KAAAW,GAAQX,CAAAA,EAAAA;gBACb1X,IAAAA,CAAKwX,IAAAA,CAAKf,EAAS6B,IAAAA,EAAMZ;YAC3B;YAMO,SAAAa,GAAYb,CAAAA,EAAAA;gBACjB1X,IAAAA,CAAK6X,QAAAA,CAASpB,EAAS6B,IAAAA,EAAMZ;YAC/B;YAMO,MAAAzQ,GAASyQ,CAAAA,EAAAA;gBACd1X,IAAAA,CAAKwX,IAAAA,CAAKf,EAAStQ,KAAAA,EAAOuR;YAC5B;YAMO,UAAAc,GAAad,CAAAA,EAAAA;gBAClB1X,IAAAA,CAAK6X,QAAAA,CAASpB,EAAStQ,KAAAA,EAAOuR;YAChC;YAMO,MAAAe,GAASf,CAAAA,EAAAA;gBACd1X,IAAAA,CAAKwX,IAAAA,CAAKf,EAASiC,KAAAA,EAAOhB;YAC5B;YAMO,UAAAiB,GAAajB,CAAAA,EAAAA;gBAClB1X,IAAAA,CAAK6X,QAAAA,CAASpB,EAASiC,KAAAA,EAAOhB;YAChC;QAAA;QAvJe,EAAAR,SAAAA,GAAoB;QAyK9B,MAAME;YAMJ,IAAIK,CAAAA,EAAiBC,CAAAA,EAAAA;gBAE1B,IAAA,CAAKkB,WAAAA,CAAYA,QAAQhB,GAAAA,IAAOgB,QAAQP,IAAAA,IAAQO,QAAQ3R,KAAAA,EAEtD;gBAIF,MAAM4R,IAAqB,EAAA;gBAC3BA,EAAYC,OAAAA,CAAQC,KAAAA,CAAMF,GAAanB,IACvCmB,EAAYC,OAAAA,CAAQ,MAAMrC,CAAAA,CAASgB,EAAAA,GAAS,SAExCA,IAAQhB,EAAS6B,IAAAA,GAEfM,QAAQhB,GAAAA,CAAImB,KAAAA,GAEdH,QAAQhB,GAAAA,CAAImB,KAAAA,CAAMH,SAASC,KAE3BD,QAAQhB,GAAAA,CAAIiB,EAAYtY,IAAAA,CAAK,QAEtBkX,IAAQhB,EAAStQ,KAAAA,GAEtByS,QAAQP,IAAAA,CAAKU,KAAAA,GACfH,QAAQP,IAAAA,CAAKU,KAAAA,CAAMH,SAASC,KAE5BD,QAAQP,IAAAA,CAAKQ,EAAYtY,IAAAA,CAAK,QAI5BqY,QAAQ3R,KAAAA,CAAM8R,KAAAA,GAChBH,QAAQ3R,KAAAA,CAAM8R,KAAAA,CAAMH,SAASC,KAE7BD,QAAQ3R,KAAAA,CAAM4R,EAAYtY,IAAAA,CAAK;YAGrC;QAAA;QA8BK,MAAMyY;YAOX,YAAYC,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBANJ,IAAA,CAAAC,SAAAA,GAAsB,EAAA,EAGtB,IAAA,CAAAC,IAAAA,GAAO,IACP,IAAA,CAAAC,MAAAA,GAAShH,EAAMyC,KAAAA,EAGrB7U,IAAAA,CAAKqZ,QAAAA,GAAWJ,GAChBjZ,IAAAA,CAAKsZ,MAAAA,GAA4BC,SAASC,aAAAA,CAAc,WACxDxZ,IAAAA,CAAKyZ,IAAAA,GAAOzZ,IAAAA,CAAKsZ,MAAAA,CAAOI,UAAAA,CAAW,OACnC1Z,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMC,QAAAA,GAAW,YAC7B5Z,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAME,MAAAA,GAAmC,SAA1B,CAAA,IAAc,SAAd,CAAA,IAAAZ,EAAQY,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAE9Z,QAAAA,EAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,MACzDwZ,SAASO,IAAAA,CAAKC,WAAAA,CAAY/Z,IAAAA,CAAKsZ,MAAAA,GAC/BtZ,IAAAA,CAAKga,6BAAAA,IACLf,EAAQgB,MAAAA,CAAOjG,MAAAA,CAAOkG,MAAAA,CAAOzS,EAAAA,CAAG,UAAU;oBACxCzH,IAAAA,CAAKga,6BAAAA;gBAA+B;YAExC;YAEQ,gCAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACN,MAAMf,IAAUjZ,IAAAA,CAAKqZ,QAAAA;gBACrBrZ,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAqB,SAAb,CAAA,IAAAlB,EAAQkB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIlB,EAAQgB,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EACtEna,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAAuB,SAAd,CAAA,IAAApB,EAAQoB,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIpB,EAAQgB,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA,EACxEra,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMC,QAAAA,GAAW;gBAC7B,MAAMU,IAAUrB,EAAQgB,MAAAA,CAAOjG,MAAAA,CAAOuG,uBAAAA,CAAwB7L,EAAI,GAAG;gBACrE1O,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMa,IAAAA,GAAOF,EAAQhO,CAAAA,GAAI,MACrCtM,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMc,GAAAA,GAAMH,EAAQlQ,CAAAA,GAAI,MACpCpK,IAAAA,CAAKmZ,IAAAA,GAAmB,SAAZ,CAAA,IAAAF,EAAQyB,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI1a,IAAAA,CAAKmZ,IAAAA,EACjCnZ,IAAAA,CAAKoZ,MAAAA,GAAsB,SAAb,CAAA,IAAAH,EAAQtF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3T,IAAAA,CAAKoZ,MACtC;YAAA;YAOO,IAAI3B,CAAAA,EAAiBC,CAAAA,EAAAA;gBAC1B,MAAMiD,IAAUjD,EAAKnX,IAAAA,CAAK;gBAE1BP,IAAAA,CAAKyZ,IAAAA,CAAKmB,SAAAA,CAAU,GAAG,GAAG5a,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,EAAOna,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAEzDra,IAAAA,CAAKkZ,SAAAA,CAAUJ,OAAAA,CAAQ,MAAMrC,CAAAA,CAASgB,EAAAA,GAAS,SAASkD;gBAExD,IAAIE,IAAM;gBAEV7a,IAAAA,CAAKkZ,SAAAA,GAAYlZ,IAAAA,CAAKkZ,SAAAA,CAAU3N,KAAAA,CAAM,GAAG;gBACzC,IAAK,IAAI/K,IAAI,GAAGA,IAAIR,IAAAA,CAAKkZ,SAAAA,CAAU5Y,MAAAA,EAAQE,IACzCR,IAAAA,CAAKyZ,IAAAA,CAAK7E,SAAAA,GAAY5U,IAAAA,CAAKoZ,MAAAA,CAAOlG,MAAAA,IAClClT,IAAAA,CAAKyZ,IAAAA,CAAKqB,QAAAA,CAAS9a,IAAAA,CAAKkZ,SAAAA,CAAU1Y,EAAAA,EAAIR,IAAAA,CAAKmZ,IAAAA,EAAM0B,IACjDA,KAAO;YAEX;QAAA;QAAA,CCtTF,SAAYnE,CAAAA;YACV,EAAA,IAAA,GAAA,QACA,EAAA,GAAA,GAAA,OACA,EAAA,MAAA,GAAA,UACA,EAAA,IAAA,GAAA,QACA,EAAA,KAAA,GAAA;QACD,EANWA,KAAAA,CAAAA,IAAI,CAAA,CAAA,IAQhB,SAAcA,CAAAA;YAII,EAAAqE,WAAAA,GAAhB,SAA4BC,CAAAA;gBAC1B,OAAIA,MAAStE,EAAKuE,GAAAA,GACTvE,EAAKwE,MAAAA,GAEVF,MAAStE,EAAKwE,MAAAA,GACTxE,EAAKuE,GAAAA,GAEVD,MAAStE,EAAKtI,IAAAA,GACTsI,EAAKrI,KAAAA,GAEV2M,MAAStE,EAAKrI,KAAAA,GACTqI,EAAKtI,IAAAA,GAGPsI,EAAKyE,IACd;YAAA,GAKgB,EAAAC,aAAAA,GAAhB,SAA8BC,CAAAA;gBAC5B,OAAI/V,KAAKyH,GAAAA,CAAIsO,EAAU/O,CAAAA,KAAMhH,KAAKyH,GAAAA,CAAIsO,EAAUjR,CAAAA,IAC1CiR,EAAU/O,CAAAA,IAAK,IACVoK,EAAKtI,IAAAA,GAGPsI,EAAKrI,KAAAA,GAGVgN,EAAUjR,CAAAA,IAAK,IACVsM,EAAKuE,GAAAA,GAGPvE,EAAKwE,MACd;YAAA;QACD,EAvCaxE,KAAAA,CAAAA,IAAI,CAAA,CAAA;QEIX,MAAM4E;YAeX,YAAYC,IAA6C,CAAA,EAAGd,IAAc,CAAA,EAAGe,IAAgB,CAAA,EAAGC,IAAiB,CAAA,CAAA;gBAuNzG,IAAA,CAAAC,OAAAA,GAAoB,EAAA,EAtNG,YAAA,OAAlBH,IACTvb,CAAAA,IAAAA,CAAKwa,IAAAA,GAAOe,EAAcf,IAAAA,EAC1Bxa,IAAAA,CAAKya,GAAAA,GAAMc,EAAcd,GAAAA,EACzBza,IAAAA,CAAKwb,KAAAA,GAAQD,EAAcC,KAAAA,EAC3Bxb,IAAAA,CAAKyb,MAAAA,GAASF,EAAcE,MAAAA,AAAAA,IACM,YAAA,OAAlBF,KAChBvb,CAAAA,IAAAA,CAAKwa,IAAAA,GAAOe,GACZvb,IAAAA,CAAKya,GAAAA,GAAMA,GACXza,IAAAA,CAAKwb,KAAAA,GAAQA,GACbxb,IAAAA,CAAKyb,MAAAA,GAASA,CAAAA;YAElB;YAKO,MAAMnL,CAAAA,EAAAA;gBACX,MAAMlF,IAASkF,KAAQ,IAAIgL,EAAY,GAAG,GAAG,GAAG;gBAKhD,OAJAlQ,EAAOoP,IAAAA,GAAOxa,IAAAA,CAAKwa,IAAAA,EACnBpP,EAAOoQ,KAAAA,GAAQxb,IAAAA,CAAKwb,KAAAA,EACpBpQ,EAAOqP,GAAAA,GAAMza,IAAAA,CAAKya,GAAAA,EAClBrP,EAAOqQ,MAAAA,GAASzb,IAAAA,CAAKyb,MAAAA,EACdrQ;YACT;YAKO,QAAAuQ;gBACL3b,IAAAA,CAAKwa,IAAAA,GAAO,GACZxa,IAAAA,CAAKya,GAAAA,GAAM,GACXza,IAAAA,CAAKyb,MAAAA,GAAS,GACdzb,IAAAA,CAAKwb,KAAAA,GAAQ;YACf;YAMO,OAAA,wBAA+BK,CAAAA,EAAAA;gBACpC,OAAKA,KAGDA,IACEvW,KAAKyH,GAAAA,CAAI8O,EAAavP,CAAAA,IAAKhH,KAAKyH,GAAAA,CAAI8O,EAAazR,CAAAA,IAC/CyR,EAAavP,CAAAA,GAAI,IACZoK,EAAKrI,KAAAA,GAEPqI,EAAKtI,IAAAA,GAERyN,EAAazR,CAAAA,GAAI,IACZsM,EAAKwE,MAAAA,GAEPxE,EAAKuE,GAAAA,GAZPvE,EAAKyE,IAgBhB;YAAA;YAEO,OAAA,WAAkBY,CAAAA,EAAAA;gBACvB,IAAIC,IAAOpN,IAAAA,GACPqN,IAAOrN,IAAAA,GACPsN,IAAAA,KAAQtN,GACRuN,IAAAA,KAAQvN;gBACZ,IAAK,IAAIpO,IAAI,GAAGA,IAAIub,EAAOzb,MAAAA,EAAQE,IAC7Bub,CAAAA,CAAOvb,EAAAA,CAAG8L,CAAAA,GAAI0P,KAChBA,CAAAA,IAAOD,CAAAA,CAAOvb,EAAAA,CAAG8L,CAAAA,AAAAA,GAEfyP,CAAAA,CAAOvb,EAAAA,CAAG8L,CAAAA,GAAI4P,KAChBA,CAAAA,IAAOH,CAAAA,CAAOvb,EAAAA,CAAG8L,CAAAA,AAAAA,GAEfyP,CAAAA,CAAOvb,EAAAA,CAAG4J,CAAAA,GAAI6R,KAChBA,CAAAA,IAAOF,CAAAA,CAAOvb,EAAAA,CAAG4J,CAAAA,AAAAA,GAEf2R,CAAAA,CAAOvb,EAAAA,CAAG4J,CAAAA,GAAI+R,KAChBA,CAAAA,IAAOJ,CAAAA,CAAOvb,EAAAA,CAAG4J,CAAAA,AAAAA;gBAGrB,OAAO,IAAIkR,EAAYU,GAAMC,GAAMC,GAAMC;YAC3C;YASO,OAAA,cAAqBhC,CAAAA,EAAeE,CAAAA,EAAgBvI,IAAiBhE,EAAOG,IAAAA,EAAM4M,IAAc/M,EAAOC,IAAAA,EAAAA;gBAC5G,OAAO,IAAIuN,EAAAA,CACRnB,IAAQrI,EAAOxF,CAAAA,GAAIuO,EAAIvO,CAAAA,EAAAA,CACvB+N,IAASvI,EAAO1H,CAAAA,GAAIyQ,EAAIzQ,CAAAA,EACzB+P,IAAQA,IAAQrI,EAAOxF,CAAAA,GAAIuO,EAAIvO,CAAAA,EAC/B+N,IAASA,IAASvI,EAAO1H,CAAAA,GAAIyQ,EAAIzQ,CAAAA;YAErC;YAKA,IAAA,QAAW+P;gBACT,OAAOna,IAAAA,CAAKwb,KAAAA,GAAQxb,IAAAA,CAAKwa,IAC3B;YAAA;YAKA,IAAA,SAAWH;gBACT,OAAOra,IAAAA,CAAKyb,MAAAA,GAASzb,IAAAA,CAAKya,GAC5B;YAAA;YAKO,oBAAA4B;gBACL,OAAsB,MAAfrc,IAAAA,CAAKma,KAAAA,IAA+B,MAAhBna,IAAAA,CAAKqa,MAClC;YAAA;YAKA,IAAA,SAAWiC;gBACT,OAAO,IAAIxO,EAAAA,AAAQ9N,CAAAA,IAAAA,CAAKwa,IAAAA,GAAOxa,IAAAA,CAAKwb,KAAAA,AAAAA,IAAS,GAAA,AAAIxb,CAAAA,IAAAA,CAAKya,GAAAA,GAAMza,IAAAA,CAAKyb,MAAAA,AAAAA,IAAU;YAC7E;YAEA,IAAA,UAAWc;gBACT,OAAO,IAAIzO,EAAO9N,IAAAA,CAAKwa,IAAAA,EAAMxa,IAAAA,CAAKya,GAAAA;YACpC;YAEA,IAAA,cAAW+B;gBACT,OAAO,IAAI1O,EAAO9N,IAAAA,CAAKwb,KAAAA,EAAOxb,IAAAA,CAAKyb,MAAAA;YACrC;YAEA,IAAA,WAAWgB;gBACT,OAAO,IAAI3O,EAAO9N,IAAAA,CAAKwb,KAAAA,EAAOxb,IAAAA,CAAKya,GAAAA;YACrC;YAEA,IAAA,aAAWiC;gBACT,OAAO,IAAI5O,EAAO9N,IAAAA,CAAKwa,IAAAA,EAAMxa,IAAAA,CAAKyb,MAAAA;YACpC;YAEO,UAAUZ,CAAAA,EAAAA;gBACf,OAAO,IAAIS,EAAYtb,IAAAA,CAAKwa,IAAAA,GAAOK,EAAIvO,CAAAA,EAAGtM,IAAAA,CAAKya,GAAAA,GAAMI,EAAIzQ,CAAAA,EAAGpK,IAAAA,CAAKwb,KAAAA,GAAQX,EAAIvO,CAAAA,EAAGtM,IAAAA,CAAKyb,MAAAA,GAASZ,EAAIzQ,CAAAA;YACpG;YAMO,OAAO6C,CAAAA,EAAe2P,IAAgB9O,EAAOC,IAAAA,EAAAA;gBAClD,MAAMgO,IAAS/b,IAAAA,CAAK6c,SAAAA,GAAY5c,GAAAA,CAAKqW,CAAAA,IAAMA,EAAEzE,MAAAA,CAAO5E,GAAO2P;gBAC3D,OAAOtB,EAAYQ,UAAAA,CAAWC;YAChC;YAOO,MAAM9L,CAAAA,EAAe2M,IAAgB9O,EAAOC,IAAAA,EAAAA;gBACjD,MAAM+O,IAAU9c,IAAAA,CAAK2c,SAAAA,CAAUC;gBAC/B,OAAO,IAAItB,EAAYwB,EAAQtC,IAAAA,GAAOvK,EAAM3D,CAAAA,EAAGwQ,EAAQrC,GAAAA,GAAMxK,EAAM7F,CAAAA,EAAG0S,EAAQtB,KAAAA,GAAQvL,EAAM3D,CAAAA,EAAGwQ,EAAQrB,MAAAA,GAASxL,EAAM7F,CAAAA;YACxH;YAMO,UAAU4S,CAAAA,EAAAA;gBAIf,MAAMC,IAAMD,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKwa,IAAAA,EAC5B0C,IAAMF,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKwa,IAAAA,EAG5B2C,IAAMH,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKwb,KAAAA,EAC5B4B,IAAMJ,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKwb,KAAAA,EAI5B6B,IAAML,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKya,GAAAA,EAC5B6C,IAAMN,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKya,GAAAA,EAG5B8C,IAAMP,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyb,MAAAA,EAC5B+B,IAAMR,EAAOvb,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyb,MAAAA,EAE5BgC,IAAYT,EAAOU,WAAAA,IAGnBlD,IAAOlV,KAAKkF,GAAAA,CAAIyS,GAAKE,KAAO7X,KAAKkF,GAAAA,CAAI6S,GAAKE,KAAOE,EAAUnR,CAAAA,EAC3DmO,IAAMnV,KAAKkF,GAAAA,CAAI0S,GAAKE,KAAO9X,KAAKkF,GAAAA,CAAI8S,GAAKE,KAAOC,EAAUrT,CAAAA,EAC1DoR,IAAQlW,KAAKC,GAAAA,CAAI0X,GAAKE,KAAO7X,KAAKC,GAAAA,CAAI8X,GAAKE,KAAOE,EAAUnR,CAAAA,EAC5DmP,IAASnW,KAAKC,GAAAA,CAAI2X,GAAKE,KAAO9X,KAAKC,GAAAA,CAAI+X,GAAKE,KAAOC,EAAUrT,CAAAA;gBAEnE,OAAO,IAAIkR,EAAY;oBACrBd,MAAAA;oBACAC,KAAAA;oBACAe,OAAAA;oBACAC,QAAAA;gBAAAA;YAEJ;YAKO,eAAAkC;gBAGL,OAAO,IAFI3d,CAAAA,IAAAA,CAAKma,KAAAA,GACLna,IAAAA,CAAKqa,MAAAA,AAAAA;YAElB;YAYO,YAAAwC;gBAYL,OAXI7c,IAAAA,CAAK4d,KAAAA,KAAU5d,IAAAA,CAAKwa,IAAAA,IAAQxa,IAAAA,CAAK6d,MAAAA,KAAW7d,IAAAA,CAAKwb,KAAAA,IAASxb,IAAAA,CAAK8d,IAAAA,KAAS9d,IAAAA,CAAKya,GAAAA,IAAOza,IAAAA,CAAK+d,OAAAA,KAAY/d,IAAAA,CAAKyb,MAAAA,IAC5Gzb,CAAAA,IAAAA,CAAK0b,OAAAA,CAAQpb,MAAAA,GAAS,GACtBN,IAAAA,CAAK0b,OAAAA,CAAQ/b,IAAAA,CAAK,IAAImO,EAAO9N,IAAAA,CAAKwa,IAAAA,EAAMxa,IAAAA,CAAKya,GAAAA,IAC7Cza,IAAAA,CAAK0b,OAAAA,CAAQ/b,IAAAA,CAAK,IAAImO,EAAO9N,IAAAA,CAAKwb,KAAAA,EAAOxb,IAAAA,CAAKya,GAAAA,IAC9Cza,IAAAA,CAAK0b,OAAAA,CAAQ/b,IAAAA,CAAK,IAAImO,EAAO9N,IAAAA,CAAKwb,KAAAA,EAAOxb,IAAAA,CAAKyb,MAAAA,IAC9Czb,IAAAA,CAAK0b,OAAAA,CAAQ/b,IAAAA,CAAK,IAAImO,EAAO9N,IAAAA,CAAKwa,IAAAA,EAAMxa,IAAAA,CAAKyb,MAAAA,IAC7Czb,IAAAA,CAAK4d,KAAAA,GAAQ5d,IAAAA,CAAKwa,IAAAA,EAClBxa,IAAAA,CAAK6d,MAAAA,GAAS7d,IAAAA,CAAKwb,KAAAA,EACnBxb,IAAAA,CAAK8d,IAAAA,GAAO9d,IAAAA,CAAKya,GAAAA,EACjBza,IAAAA,CAAK+d,OAAAA,GAAU/d,IAAAA,CAAKyb,MAAAA,AAAAA,GAEfzb,IAAAA,CAAK0b,OACd;YAAA;YAKO,QAAQuC,CAAAA,EAAUC,IAAkBtP,IAAAA,CAAAA,EAAAA;gBAEzC,IAAIuP,IAAAA,KAAQvP,GACRwP,IAAQxP,IAAAA;gBAEZ,MAAMyP,IAAqB,MAAdJ,EAAIK,GAAAA,CAAIhS,CAAAA,GAAUiS,OAAOC,SAAAA,GAAY,IAAIP,EAAIK,GAAAA,CAAIhS,CAAAA,EACxDmS,IAAqB,MAAdR,EAAIK,GAAAA,CAAIlU,CAAAA,GAAUmU,OAAOC,SAAAA,GAAY,IAAIP,EAAIK,GAAAA,CAAIlU,CAAAA,EAExDsU,IAAAA,AAAO1e,CAAAA,IAAAA,CAAKwa,IAAAA,GAAOyD,EAAIpD,GAAAA,CAAIvO,CAAAA,AAAAA,IAAK+R,GAChCM,IAAAA,AAAO3e,CAAAA,IAAAA,CAAKwb,KAAAA,GAAQyC,EAAIpD,GAAAA,CAAIvO,CAAAA,AAAAA,IAAK+R;gBACvCF,IAAO7Y,KAAKkF,GAAAA,CAAIkU,GAAKC,IACrBP,IAAO9Y,KAAKC,GAAAA,CAAImZ,GAAKC;gBAErB,MAAMC,IAAAA,AAAO5e,CAAAA,IAAAA,CAAKya,GAAAA,GAAMwD,EAAIpD,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAKqU,GAC/BI,IAAAA,AAAO7e,CAAAA,IAAAA,CAAKyb,MAAAA,GAASwC,EAAIpD,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAKqU;gBAIxC,OAHAN,IAAO7Y,KAAKC,GAAAA,CAAI4Y,GAAM7Y,KAAKkF,GAAAA,CAAIoU,GAAKC,KACpCT,IAAO9Y,KAAKkF,GAAAA,CAAI4T,GAAM9Y,KAAKC,GAAAA,CAAIqZ,GAAKC,KAE7BT,KAAQ9Y,KAAKC,GAAAA,CAAI,GAAG4Y,MAASA,IAAOD;YAC7C;YAEO,YAAYD,CAAAA,EAAUC,IAAkBtP,IAAAA,CAAAA,EAAAA;gBAE7C,IAAIuP,IAAAA,KAAQvP,GACRwP,IAAQxP,IAAAA;gBAEZ,MAAMyP,IAAqB,MAAdJ,EAAIK,GAAAA,CAAIhS,CAAAA,GAAUiS,OAAOC,SAAAA,GAAY,IAAIP,EAAIK,GAAAA,CAAIhS,CAAAA,EACxDmS,IAAqB,MAAdR,EAAIK,GAAAA,CAAIlU,CAAAA,GAAUmU,OAAOC,SAAAA,GAAY,IAAIP,EAAIK,GAAAA,CAAIlU,CAAAA,EAExDsU,IAAAA,AAAO1e,CAAAA,IAAAA,CAAKwa,IAAAA,GAAOyD,EAAIpD,GAAAA,CAAIvO,CAAAA,AAAAA,IAAK+R,GAChCM,IAAAA,AAAO3e,CAAAA,IAAAA,CAAKwb,KAAAA,GAAQyC,EAAIpD,GAAAA,CAAIvO,CAAAA,AAAAA,IAAK+R;gBACvCF,IAAO7Y,KAAKkF,GAAAA,CAAIkU,GAAKC,IACrBP,IAAO9Y,KAAKC,GAAAA,CAAImZ,GAAKC;gBAErB,MAAMC,IAAAA,AAAO5e,CAAAA,IAAAA,CAAKya,GAAAA,GAAMwD,EAAIpD,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAKqU,GAC/BI,IAAAA,AAAO7e,CAAAA,IAAAA,CAAKyb,MAAAA,GAASwC,EAAIpD,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAKqU;gBAIxC,OAHAN,IAAO7Y,KAAKC,GAAAA,CAAI4Y,GAAM7Y,KAAKkF,GAAAA,CAAIoU,GAAKC,KACpCT,IAAO9Y,KAAKkF,GAAAA,CAAI4T,GAAM9Y,KAAKC,GAAAA,CAAIqZ,GAAKC,KAEhCT,KAAQ9Y,KAAKC,GAAAA,CAAI,GAAG4Y,MAASA,IAAOD,IAC/BC,IAAAA;YAGX;YAaO,SAAS1R,CAAAA,EAAAA;gBACd,OAAIA,aAAeqB,IACV9N,IAAAA,CAAKwa,IAAAA,IAAQ/N,EAAIH,CAAAA,IAAKtM,IAAAA,CAAKya,GAAAA,IAAOhO,EAAIrC,CAAAA,IAAKqC,EAAIrC,CAAAA,IAAKpK,IAAAA,CAAKyb,MAAAA,IAAUhP,EAAIH,CAAAA,IAAKtM,IAAAA,CAAKwb,KAAAA,GAC/E/O,aAAe6O,KACjBtb,IAAAA,CAAKwa,IAAAA,IAAQ/N,EAAI+N,IAAAA,IAAQxa,IAAAA,CAAKya,GAAAA,IAAOhO,EAAIgO,GAAAA,IAAOhO,EAAIgP,MAAAA,IAAUzb,IAAAA,CAAKyb,MAAAA,IAAUhP,EAAI+O,KAAAA,IAASxb,IAAAA,CAAKwb,KAAAA;YAG1G;YAMO,QAAQyD,CAAAA,EAAoB3O,CAAAA,EAAAA;gBACjC,MAAM4O,IAAc5O,KAAQ,IAAIgL,EAAY,GAAG,GAAG,GAAG,IAC/Cd,IAAOlV,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKwa,IAAAA,EAAMyE,EAAMzE,IAAAA,GACjCC,IAAMnV,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKya,GAAAA,EAAKwE,EAAMxE,GAAAA,GAC/Be,IAAQlW,KAAKC,GAAAA,CAAIvF,IAAAA,CAAKwb,KAAAA,EAAOyD,EAAMzD,KAAAA,GACnCC,IAASnW,KAAKC,GAAAA,CAAIvF,IAAAA,CAAKyb,MAAAA,EAAQwD,EAAMxD,MAAAA;gBAK3C,OAJAyD,EAAY1E,IAAAA,GAAOA,GACnB0E,EAAYzE,GAAAA,GAAMA,GAClByE,EAAY1D,KAAAA,GAAQA,GACpB0D,EAAYzD,MAAAA,GAASA,GACdyD;YACT;YAEA,IAAA,aAAWC;gBACT,OAAO,IAAIrR,EAAO9N,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA;YACrC;YAQO,SAAS4E,CAAAA,EAAoBI,CAAAA,EAAAA;gBAClC,MAAMC,IAAID,KAAW;gBACrB,IAAIJ,EAAM5C,iBAAAA,IACR,OAAOrc,IAAAA,CAAK+e,QAAAA,CAASE;gBAEvB,IAAIjf,IAAAA,CAAKqc,iBAAAA,IACP,OAAO4C,EAAMF,QAAAA,CAAS/e,IAAAA;gBAExB,MAAMuf,IAAmBvf,IAAAA,CAAKgf,OAAAA,CAAQC;gBACtC,OAAOM,EAAiBpF,KAAAA,GAAQmF,IAAIL,EAAM9E,KAAAA,GAAQna,IAAAA,CAAKma,KAAAA,IAASoF,EAAiBlF,MAAAA,GAASiF,IAAIL,EAAM5E,MAAAA,GAASra,IAAAA,CAAKqa,MACpH;YAAA;YASO,UAAU4E,CAAAA,EAAAA;gBACf,MAAMM,IAAmBvf,IAAAA,CAAKgf,OAAAA,CAAQC;gBAGtC,IACEM,EAAiBpF,KAAAA,GAAQ8E,EAAM9E,KAAAA,GAAQna,IAAAA,CAAKma,KAAAA,IAC5CoF,EAAiBlF,MAAAA,GAAS4E,EAAM5E,MAAAA,GAASra,IAAAA,CAAKqa,MAAAA,IAAAA,CAC7CkF,EAAiBJ,UAAAA,CAAW/P,MAAAA,CAAO6P,EAAME,UAAAA,KAAAA,CACzCI,EAAiBJ,UAAAA,CAAW/P,MAAAA,CAAOpP,IAAAA,CAAKmf,UAAAA,GACzC;oBAEA,IAAIM,IAAW;oBAabA,IADEzf,IAAAA,CAAKwb,KAAAA,IAASyD,EAAMzE,IAAAA,IAAQxa,IAAAA,CAAKwb,KAAAA,IAASyD,EAAMzD,KAAAA,GACvCyD,EAAMzE,IAAAA,GAAOxa,IAAAA,CAAKwb,KAAAA,GAalByD,EAAMzD,KAAAA,GAAQxb,IAAAA,CAAKwa,IAAAA;oBAGhC,IAAIkF,IAAW;oBAyBf,OAdEA,IADE1f,IAAAA,CAAKya,GAAAA,IAAOwE,EAAMxD,MAAAA,IAAUzb,IAAAA,CAAKya,GAAAA,IAAOwE,EAAMxE,GAAAA,GACrCwE,EAAMxD,MAAAA,GAASzb,IAAAA,CAAKya,GAAAA,GAWpBwE,EAAMxE,GAAAA,GAAMza,IAAAA,CAAKyb,MAAAA,EAG1BnW,KAAKyH,GAAAA,CAAI0S,KAAYna,KAAKyH,GAAAA,CAAI2S,KACzB,IAAI5R,EAAO2R,GAAU,KAErB,IAAI3R,EAAO,GAAG4R;gBAGzB;gBAAO,IAAIH,EAAiBJ,UAAAA,CAAW/P,MAAAA,CAAO6P,EAAME,UAAAA,KAAeI,EAAiBJ,UAAAA,CAAW/P,MAAAA,CAAOpP,IAAAA,CAAKmf,UAAAA,GAAa;oBACtH,IAAIM,IAAW;oBAKXA,IAHAzf,IAAAA,CAAKma,KAAAA,GAAQ8E,EAAM9E,KAAAA,IAAS,IAE1Bna,IAAAA,CAAKwb,KAAAA,GAAQyD,EAAMzD,KAAAA,IAASyD,EAAMzE,IAAAA,GAAOxa,IAAAA,CAAKwa,IAAAA,GACrCyE,EAAMzE,IAAAA,GAAOxa,IAAAA,CAAKwb,KAAAA,GAGlByD,EAAMzD,KAAAA,GAAQxb,IAAAA,CAAKwa,IAAAA,GAK5ByE,EAAMzD,KAAAA,GAAQxb,IAAAA,CAAKwb,KAAAA,IAASxb,IAAAA,CAAKwa,IAAAA,GAAOyE,EAAMzE,IAAAA,GACrCxa,IAAAA,CAAKwa,IAAAA,GAAOyE,EAAMzD,KAAAA,GAGlBxb,IAAAA,CAAKwb,KAAAA,GAAQyD,EAAMzE,IAAAA;oBAIlC,IAAIkF,IAAW;oBAmBf,OAdIA,IAHA1f,IAAAA,CAAKqa,MAAAA,GAAS4E,EAAM5E,MAAAA,IAAU,IAE5Bra,IAAAA,CAAKyb,MAAAA,GAASwD,EAAMxD,MAAAA,IAAUwD,EAAMxE,GAAAA,GAAMza,IAAAA,CAAKya,GAAAA,GACtCwE,EAAMxE,GAAAA,GAAMza,IAAAA,CAAKyb,MAAAA,GAEjBwD,EAAMxD,MAAAA,GAASzb,IAAAA,CAAKya,GAAAA,GAK7BwE,EAAMxD,MAAAA,GAASzb,IAAAA,CAAKyb,MAAAA,IAAUzb,IAAAA,CAAKya,GAAAA,GAAMwE,EAAMxE,GAAAA,GACtCza,IAAAA,CAAKya,GAAAA,GAAMwE,EAAMxD,MAAAA,GAEjBzb,IAAAA,CAAKyb,MAAAA,GAASwD,EAAMxE,GAAAA,EAI/BnV,KAAKyH,GAAAA,CAAI0S,KAAYna,KAAKyH,GAAAA,CAAI2S,KACzB,IAAI5R,EAAO2R,GAAU,KAErB,IAAI3R,EAAO,GAAG4R;gBAEzB;gBACE,OAAO;YAEX;YAMO,kBAAkBE,CAAAA,EAAAA;gBACvB,MAAMJ,IAAYxf,IAAAA,CAAKwf,SAAAA,CAAUI;gBACjC,OAAOtE,EAAYM,uBAAAA,CAAwB4D;YAC7C;YAOO,KAAKM,CAAAA,EAA8BnM,IAAevB,EAAM8C,MAAAA,EAAAA;gBAC7D4K,EAAG9H,KAAAA,CAAM+H,QAAAA,CAAS/f,IAAAA,CAAKwa,IAAAA,EAAMxa,IAAAA,CAAKya,GAAAA,EAAKza,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ;oBAAE1G,OAAAA;gBAAAA;YACpE;QAAA;QCpgBK,SAAS+J,EAAYsC,CAAAA;YAE1B,IAAIA,KAAMA,EAAGC,qBAAAA,EAAuB;gBAClC,MAAMC,IAAOF,EAAGC,qBAAAA;gBAChB,OAAOvR,EAAIwR,EAAK5T,CAAAA,GAAI9I,OAAO2c,OAAAA,EAASD,EAAK9V,CAAAA,GAAI5G,OAAO4c,OAAAA;YACtD;YACA,OAAOtS,EAAOC,IAChB;QAAA;QAMO,SAASsS,EAAkBngB,CAAAA,EAAS4K,CAAAA;YACzC,OAAA,OAAIA,EAAMrC,OAAAA,CAAQvI,MAChB4K,CAAAA,EAAMnL,IAAAA,CAAKO,IAAAA,CACJ,CAAA;QAGX;QAMO,SAASogB,EAAuBpgB,CAAAA,EAAS4K,CAAAA;YAC9C,IAAIU,IAAAA;YACJ,OAAA,AAAKA,CAAAA,IAAQV,EAAMrC,OAAAA,CAAQvI,EAAAA,IAAAA,MACzB4K,CAAAA,EAAMpC,MAAAA,CAAO8C,GAAO,IAAA,CACb,CAAA;QAIX;QAKO,SAASuT,EAASjU,CAAAA,EAAmBlI,CAAAA;YAC1C,IAAK,IAAIpC,IAAI,GAAGA,IAAIsK,EAAMxK,MAAAA,EAAQE,IAChC,IAAIsK,CAAAA,CAAMtK,EAAAA,KAAOoC,GACf,OAAA,CAAO;YAGX,OAAA,CAAO;QACT;QAKO,SAAS2d,EAAK5F,CAAAA;YACnB,MAAM,IAAIxU,MAAMwU;QAClB;QAUO,SAAS6F,EAAMC,CAAAA,EAAsBC,CAAAA;YAAAA,IAAAA;YAC1C,MAAMC,IAAS,IAAIja;YAKnB,OAAA,AAJ4C,CAAA,SAA3B,CAAA,IAAAga,QAAAA,IAAAA,KAAK,IAALA,EAAOE,QAAAA,CAASC,IAAAA,CAAKH,EAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIvb,UAAAA,EACvC;gBACPwb,EAAOnc,OAAAA;YAAS,GACfic,IACIE,EAAO9Z,OAChB;QAAA;QAOO,SAASia,EAAyDC,CAAAA,EAAiBxa,CAAAA;YACxF,MAAMya,IAA8B,CAAC;YACrC,IAAK,MAAM1e,KAAOye,EACXxa,EAAK0a,QAAAA,CAAS3e,MAChB0e,CAAAA,CAAAA,CAAe1e,EAAAA,GAAOye,CAAAA,CAAOze,EAAAA,AAAAA;YAGlC,OAAO0e;QACT;QAMO,SAASE,EAAShhB,CAAAA;YACvB,OAAOA,KAAwB,YAAA,OAATA,KAAAA,CAAsB6J,MAAMoX,OAAAA,CAAQjhB;QAC5D;QAOO,SAASkhB,EAA4BC,CAAAA,EAAAA,GAAcC,CAAAA;YACxD,IAAA,CAAKA,EAAQhhB,MAAAA,EACX,OAAO+gB;YAET,MAAME,IAASD,EAAQE,KAAAA;YAEvB,IAAIN,EAASG,MAAWH,EAASK,IAC/B,IAAK,MAAMjf,KAAOif,EACZL,EAASK,CAAAA,CAAOjf,EAAAA,IACb+e,CAAAA,CAAAA,CAAO/e,EAAAA,IACVE,OAAOif,MAAAA,CAAOJ,GAAQ;gBAAE,CAAC/e,EAAAA,EAAM,CAAC;YAAA,IAElC8e,EAAUC,CAAAA,CAAO/e,EAAAA,EAAaif,CAAAA,CAAOjf,EAAAA,CAAAA,IAErCE,OAAOif,MAAAA,CAAOJ,GAAQ;gBAAE,CAAC/e,EAAAA,EAAMif,CAAAA,CAAOjf,EAAAA;YAAAA;YAK5C,OAAO8e,EAAUC,MAAWC;QAC9B;QAAA,CF1HA,SAAY3K,CAAAA;YACV,CAAA,CAAA,EAAA,CAAA,GAAA,GAAA,GAAA,KACA,CAAA,CAAA,EAAA,CAAA,GAAA,GAAA,GAAA;QACD,EAHWA,KAAAA,CAAAA,IAAe,CAAA,CAAA;QAUpB,MAAM+K;YAAb,aAAA;gBAYS,IAAA,CAAAjgB,IAAAA,GAAqB,IAAIkgB,aAAa,KAwZrC,IAAA,CAAAC,OAAAA,GAAU,GACV,IAAA,CAAAC,WAAAA,GAAc,GAcd,IAAA,CAAAC,OAAAA,GAAU,GACV,IAAA,CAAAC,WAAAA,GAAc;YA0FxB;YAtfS,OAAA,MAAavH,CAAAA,EAAcgB,CAAAA,EAAeC,CAAAA,EAAgBhB,CAAAA,EAAawH,CAAAA,EAAcC,CAAAA,EAAAA;gBAC1F,MAAMC,IAAM,IAAIT;gBAoBhB,OAnBAS,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,IAAK+Z,CAAAA,IAAQhB,CAAAA,GAC3B2H,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,IAAKgZ,CAAAA,IAAMgB,CAAAA,GACzB0G,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAA,KAAYygB,CAAAA,IAAMD,CAAAA,GAC3BE,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GAEf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAA,CAAQ+Z,CAAAA,IAAQhB,CAAAA,IAASgB,CAAAA,IAAQhB,CAAAA,GAC1C2H,EAAI1gB,IAAAA,CAAK,GAAA,GAAA,CAAQgZ,CAAAA,IAAMgB,CAAAA,IAAWhB,CAAAA,IAAMgB,CAAAA,GACxC0G,EAAI1gB,IAAAA,CAAK,GAAA,GAAA,CAAQygB,CAAAA,IAAMD,CAAAA,IAASC,CAAAA,IAAMD,CAAAA,GACtCE,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACR0gB;YACT;YAKO,MAAM7R,CAAAA,EAAAA;gBACX,MAAM6R,IAAM7R,KAAQ,IAAIoR;gBAoBxB,OAnBAS,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAExB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAExB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAEzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAClB0gB;YACT;YAQO,cAAAC;gBACL,OAAO,IAAIC,UAAU;uBAAIriB,IAAAA,CAAKyB,IAAAA;iBAAAA;YAChC;YAEO,OAAA,iBAAwBA,CAAAA,EAAAA;gBAC7B,MAAMub,IAAS,IAAI0E;gBAEnB,OADA1E,EAAOvb,IAAAA,GAAOA,GACPub;YACT;YAKO,OAAA,WAAOuF;gBACZ,MAAMJ,IAAM,IAAIT;gBAoBhB,OAnBAS,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GAEf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACR0gB;YACT;YAMO,QAAAxG;gBACL,MAAMwG,IAAMniB,IAAAA;gBAoBZ,OAnBAmiB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GAEf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACR0gB;YACT;YAOO,OAAA,YAAmB7V,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnC,MAAM+X,IAAMT,EAAOa,QAAAA;gBAGnB,OAFAJ,EAAI1gB,IAAAA,CAAK,GAAA,GAAM6K,GACf6V,EAAI1gB,IAAAA,CAAK,GAAA,GAAM2I,GACR+X;YACT;YAOO,OAAA,MAAaM,CAAAA,EAAYC,CAAAA,EAAAA;gBAC9B,MAAMP,IAAMT,EAAOa,QAAAA;gBAKnB,OAJAJ,EAAI1gB,IAAAA,CAAK,EAAA,GAAKghB,GACdN,EAAI1gB,IAAAA,CAAK,EAAA,GAAKihB,GACdP,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACR0gB;YACT;YAMO,OAAA,SAAgBlV,CAAAA,EAAAA;gBACrB,MAAMkV,IAAMT,EAAOa,QAAAA;gBAKnB,OAJAJ,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAItB,IACvBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAA,CAAM6D,KAAKkJ,GAAAA,CAAIvB,IACxBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKkJ,GAAAA,CAAIvB,IACvBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAItB,IAChBkV;YACT;YAcA,SAASS,CAAAA,EAAiCtS,CAAAA,EAAAA;gBACxC,IAAIsS,aAA0B9U,GAAQ;oBACpC,MAAM1C,IAAUkF,KAAmB,IAAIxC,EAAO,GAAG,IAC3CuB,IAASuT,GAETC,IAAUxT,EAAO/C,CAAAA,GAAItM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK4N,EAAOjF,CAAAA,GAAIpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACxEqhB,IAAUzT,EAAO/C,CAAAA,GAAItM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK4N,EAAOjF,CAAAA,GAAIpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA;oBAI9E,OAFA2J,EAAOkB,CAAAA,GAAIuW,GACXzX,EAAOhB,CAAAA,GAAI0Y,GACJ1X;gBACT;gBAAO;oBACL,MAAMA,IAAUkF,KAAmB,IAAIoR,GACjCzC,IAAQ2D,GACRG,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBwhB,IAAMjjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChByhB,IAAMljB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB4hB,IAAMrjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB6hB,IAAMtjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB8hB,IAAMvjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB+hB,IAAMxjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBgiB,IAAMzjB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBiiB,IAAM1jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAEhBkiB,IAAM3jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBmiB,IAAM5jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBoiB,IAAM7jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBqiB,IAAM9jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAEhBsiB,IAAM9E,EAAMxd,IAAAA,CAAK,EAAA,EACjBuiB,IAAM/E,EAAMxd,IAAAA,CAAK,EAAA,EACjBwiB,IAAMhF,EAAMxd,IAAAA,CAAK,EAAA,EACjByiB,IAAMjF,EAAMxd,IAAAA,CAAK,EAAA,EAEjB0iB,IAAMlF,EAAMxd,IAAAA,CAAK,EAAA,EACjB2iB,IAAMnF,EAAMxd,IAAAA,CAAK,EAAA,EACjB4iB,IAAMpF,EAAMxd,IAAAA,CAAK,EAAA,EACjB6iB,IAAMrF,EAAMxd,IAAAA,CAAK,EAAA,EAEjB8iB,IAAMtF,EAAMxd,IAAAA,CAAK,EAAA,EACjB+iB,IAAMvF,EAAMxd,IAAAA,CAAK,EAAA,EACjBgjB,IAAMxF,EAAMxd,IAAAA,CAAK,GAAA,EACjBijB,IAAMzF,EAAMxd,IAAAA,CAAK,GAAA,EAEjBkjB,IAAM1F,EAAMxd,IAAAA,CAAK,GAAA,EACjBmjB,IAAM3F,EAAMxd,IAAAA,CAAK,GAAA,EACjBojB,IAAM5F,EAAMxd,IAAAA,CAAK,GAAA,EACjBqjB,IAAM7F,EAAMxd,IAAAA,CAAK,GAAA;oBAEvB2J,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMgB,IAAMZ,IAAMa,IAAMT,IAAMU,IAAMN,IAAMO,GAC3D9Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMe,IAAMX,IAAMY,IAAMR,IAAMS,IAAML,IAAMM,GAC3D9Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKwhB,IAAMc,IAAMV,IAAMW,IAAMP,IAAMQ,IAAMJ,IAAMK,GAC3D9Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKyhB,IAAMa,IAAMT,IAAMU,IAAMN,IAAMO,IAAMH,IAAMI,GAE3D9Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMoB,IAAMhB,IAAMiB,IAAMb,IAAMc,IAAMV,IAAMW,GAC3DlZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMmB,IAAMf,IAAMgB,IAAMZ,IAAMa,IAAMT,IAAMU,GAC3DlZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKwhB,IAAMkB,IAAMd,IAAMe,IAAMX,IAAMY,IAAMR,IAAMS,GAC3DlZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKyhB,IAAMiB,IAAMb,IAAMc,IAAMV,IAAMW,IAAMP,IAAMQ,GAE3DlZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMwB,IAAMpB,IAAMqB,IAAMjB,IAAMkB,IAAMd,IAAMe,GAC3DtZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMuB,IAAMnB,IAAMoB,IAAMhB,IAAMiB,IAAMb,IAAMc,GAC3DtZ,EAAO3J,IAAAA,CAAK,GAAA,GAAMwhB,IAAMsB,IAAMlB,IAAMmB,IAAMf,IAAMgB,IAAMZ,IAAMa,GAC5DtZ,EAAO3J,IAAAA,CAAK,GAAA,GAAMyhB,IAAMqB,IAAMjB,IAAMkB,IAAMd,IAAMe,IAAMX,IAAMY,GAE5DtZ,EAAO3J,IAAAA,CAAK,GAAA,GAAMshB,IAAM4B,IAAMxB,IAAMyB,IAAMrB,IAAMsB,IAAMlB,IAAMmB,GAC5D1Z,EAAO3J,IAAAA,CAAK,GAAA,GAAMuhB,IAAM2B,IAAMvB,IAAMwB,IAAMpB,IAAMqB,IAAMjB,IAAMkB,GAC5D1Z,EAAO3J,IAAAA,CAAK,GAAA,GAAMwhB,IAAM0B,IAAMtB,IAAMuB,IAAMnB,IAAMoB,IAAMhB,IAAMiB,GAC5D1Z,EAAO3J,IAAAA,CAAK,GAAA,GAAMyhB,IAAMyB,IAAMrB,IAAMsB,IAAMlB,IAAMmB,IAAMf,IAAMgB;oBAE5D,MAAM9a,IAAIhK,IAAAA,CAAK+kB,QAAAA;oBAIf,OAHA3Z,EAAOyW,WAAAA,GAAcrV,EAAKxC,EAAEsC,CAAAA,IAAKE,EAAKpB,EAAOyW,WAAAA,GAC7CzW,EAAO2W,WAAAA,GAAcvV,EAAKxC,EAAEI,CAAAA,IAAKoC,EAAKpB,EAAO2W,WAAAA,GAEtC3W;gBACT;YACF;YAOA,UAAUkB,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnB,MAAM2Y,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBwhB,IAAMjjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChByhB,IAAMljB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB4hB,IAAMrjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB6hB,IAAMtjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB8hB,IAAMvjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB+hB,IAAMxjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBgiB,IAAMzjB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBiiB,IAAM1jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAEhBkiB,IAAM3jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBmiB,IAAM5jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBoiB,IAAM7jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAChBqiB,IAAM9jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA;gBAUtB,OALAzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAMshB,IAAMzW,IAAI6W,IAAM/Y,IAFtB,IAE0BmZ,IAD1B,IACoCI,GAC9C3jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAMuhB,IAAM1W,IAAI8W,IAAMhZ,IAHtB,IAG0BoZ,IAF1B,IAEoCI,GAC9C5jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAMwhB,IAAM3W,IAAI+W,IAAMjZ,IAJtB,IAI0BqZ,IAH1B,IAGoCI,GAC9C7jB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAMyhB,IAAM5W,IAAIgX,IAAMlZ,IALtB,IAK0BsZ,IAJ1B,IAIoCI,GAEvC9jB,IACT;YAAA;YAEO,YAAYsM,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC5BpK,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAM6K,GAChBtM,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,GAAM2I;YAClB;YAEO,cAAAsT;gBACL,OAAOhP,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA;YACtC;YAMA,OAAOwL,CAAAA,EAAAA;gBACL,MAAM8V,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBwhB,IAAMjjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChByhB,IAAMljB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB4hB,IAAMrjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB6hB,IAAMtjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhBwjB,IAAO3f,KAAKkJ,GAAAA,CAAIvB,IAChBiY,IAAS5f,KAAKiJ,GAAAA,CAAItB;gBAYxB,OAVAjN,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASnC,IAAMkC,IAAO9B,GACrCnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASlC,IAAMiC,IAAO7B,GACrCpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASjC,IAAMgC,IAAO5B,GACrCrjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAShC,IAAM+B,IAAO3B,GAErCtjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS/B,IAAM8B,IAAOlC,GACrC/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS9B,IAAM6B,IAAOjC,GACrChjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS7B,IAAM4B,IAAOhC,GACrCjjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS5B,IAAM2B,IAAO/B,GAE9BljB,IACT;YAAA;YAOA,MAAMsM,CAAAA,EAAWlC,CAAAA,EAAAA;gBACf,MAAM2Y,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBwhB,IAAMjjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChByhB,IAAMljB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB4hB,IAAMrjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB6hB,IAAMtjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBAYtB,OAVAzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKshB,IAAMzW,GACrBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKuhB,IAAM1W,GACrBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKwhB,IAAM3W,GACrBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyhB,IAAM5W,GAErBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK0hB,IAAM/Y,GACrBpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK2hB,IAAMhZ,GACrBpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK4hB,IAAMjZ,GACrBpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK6hB,IAAMlZ,GAEdpK,IACT;YAAA;YAEO,YAAYiN,CAAAA,EAAAA;gBACjB,MAAMmY,IAAeplB,IAAAA,CAAK+kB,QAAAA,IACpBE,IAAO3f,KAAKkJ,GAAAA,CAAIvB,IAChBiY,IAAS5f,KAAKiJ,GAAAA,CAAItB;gBAExBjN,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASE,EAAa9Y,CAAAA,EACrCtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKwjB,IAAOG,EAAahb,CAAAA,EACnCpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAA,CAAMwjB,IAAOG,EAAa9Y,CAAAA,EACpCtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASE,EAAahb,CACvC;YAAA;YAEO,cAAAib;gBAEL,OAAOrY,EADO1H,KAAK4L,KAAAA,CAAMlR,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKslB,SAAAA,IAAatlB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKulB,SAAAA;YAEhF;YAEO,YAAAA;gBAEL,MAAMC,IAAS9W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAAIzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAAImO,SAAAA;gBAC/C,OAAO5P,IAAAA,CAAK6hB,WAAAA,GAAc2D;YAC5B;YAEO,YAAAF;gBAEL,MAAMG,IAAS/W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAAIzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAAImO,SAAAA;gBAC/C,OAAO5P,IAAAA,CAAK+hB,WAAAA,GAAc0D;YAC5B;YAKO,WAAAV;gBACL,OAAOrW,EAAI1O,IAAAA,CAAKulB,SAAAA,IAAavlB,IAAAA,CAAKslB,SAAAA;YACpC;YAIO,UAAU7Y,CAAAA,EAAAA;gBACf,IAAIzM,IAAAA,CAAK4hB,OAAAA,KAAYnV,GACnB;gBAGFzM,IAAAA,CAAK6hB,WAAAA,GAAcrV,EAAKC;gBAExB,MAAM+Y,IAAS9W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK6hB,WAAAA,EAAa7hB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK6hB,WAAAA,EAAa7R,SAAAA;gBACrFhQ,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK+jB,EAAOlZ,CAAAA,GAAIG,GAC1BzM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK+jB,EAAOpb,CAAAA,GAAIqC,GAC1BzM,IAAAA,CAAK4hB,OAAAA,GAAUnV;YACjB;YAIO,UAAUA,CAAAA,EAAAA;gBACf,IAAIzM,IAAAA,CAAK8hB,OAAAA,KAAYrV,GACnB;gBAEFzM,IAAAA,CAAK+hB,WAAAA,GAAcvV,EAAKC;gBAExB,MAAMgZ,IAAS/W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK+hB,WAAAA,EAAa/hB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK+hB,WAAAA,EAAa/R,SAAAA;gBACrFhQ,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKgkB,EAAOnZ,CAAAA,GAAIG,GAC1BzM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKgkB,EAAOrb,CAAAA,GAAIqC,GAC1BzM,IAAAA,CAAK8hB,OAAAA,GAAUrV;YACjB;YAEO,SAASwD,CAAAA,EAAAA;gBACdjQ,IAAAA,CAAK0lB,SAAAA,CAAUzV,EAAM3D,CAAAA,GACrBtM,IAAAA,CAAK2lB,SAAAA,CAAU1V,EAAM7F,CAAAA;YACvB;YAKO,sBAAAyb;gBACL,OAAO7lB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAChE;YAAA;YAQO,iBAAiB4f,CAAAA,EAAAA;gBAMtB,MACM0E,IAAa,IADP/lB,IAAAA,CAAK6lB,mBAAAA,IAEXzjB,IAAIpC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACd6Q,IAAItS,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACdgT,IAAIzU,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACdU,IAAInC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEdukB,IAAI3E,KAAUK,EAAOa,QAAAA;gBAE3ByD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKU,IAAI4jB,GAChBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAMgT,IAAIsR,GACjBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAM6Q,IAAIyT,GACjBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAKW,IAAI2jB;gBAEhB,MAAME,IAAKjmB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,EACfykB,IAAKlmB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA;gBAMrB,OAHAukB,EAAEvkB,IAAAA,CAAK,GAAA,GAAA,CAAQwkB,CAAAA,IAAKD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKykB,IAAKF,EAAEvkB,IAAAA,CAAK,EAAA,AAAA,GAC5CukB,EAAEvkB,IAAAA,CAAK,GAAA,GAAA,CAAQwkB,CAAAA,IAAKD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKykB,IAAKF,EAAEvkB,IAAAA,CAAK,EAAA,AAAA,GAErCukB;YACT;YAEO,aAAAG;gBACL,OACmB,MAAjBnmB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACO,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,IACQ,MAAlBzB,IAAAA,CAAKyB,IAAAA,CAAK,GAEd;YAAA;YAEO,WAAA1B;gBACL,OAAO,CAAA,GAAA,EACRC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,IAAA,EAC1DzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,IAAA,EAC1DzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,CAAA,EAAOzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,IAAA,EAC3DzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,CAAA,EAAOzB,IAAAA,CAAKyB,IAAAA,CAAK,GAAA,CAAA,GAAA,CAE5D;YAAA;QAAA;QGvhBK,MAAM2kB;YAAb,aAAA;gBAQS,IAAA,CAAA3kB,IAAAA,GAAO,IAAI4kB,aAAa,IA+VvB,IAAA,CAAAC,MAAAA,GAAS,IAAID,aAAa;oBAAC;oBAAG;iBAAA,GAC9B,IAAA,CAAAxE,WAAAA,GAAc,GAad,IAAA,CAAAE,WAAAA,GAAc;YA8DxB;YAnaS,cAAAK;gBACL,OAAO,IAAIC,UAAU;uBAAIriB,IAAAA,CAAKyB,IAAAA;iBAAAA;YAChC;YAEO,OAAA,WAAO8gB;gBACZ,MAAMJ,IAAM,IAAIiE;gBAShB,OARAjE,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACP0gB;YACT;YAOO,OAAA,YAAmB7V,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnC,MAAM+X,IAAMiE,EAAa7D,QAAAA;gBAGzB,OAFAJ,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6K,GACd6V,EAAI1gB,IAAAA,CAAK,EAAA,GAAK2I,GACP+X;YACT;YAOO,OAAA,MAAaM,CAAAA,EAAYC,CAAAA,EAAAA;gBAC9B,MAAMP,IAAMiE,EAAa7D,QAAAA;gBAKzB,OAJAJ,EAAI1gB,IAAAA,CAAK,EAAA,GAAKghB,GACdN,EAAI1gB,IAAAA,CAAK,EAAA,GAAKihB,GACdP,EAAImE,MAAAA,CAAO,EAAA,GAAK7D,GAChBN,EAAImE,MAAAA,CAAO,EAAA,GAAK5D,GACTP;YACT;YAMO,OAAA,SAAgBlV,CAAAA,EAAAA;gBACrB,MAAMkV,IAAMiE,EAAa7D,QAAAA;gBAKzB,OAJAJ,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAItB,IACvBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKkJ,GAAAA,CAAIvB,IACvBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAA,CAAM6D,KAAKkJ,GAAAA,CAAIvB,IACxBkV,EAAI1gB,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAItB,IAChBkV;YACT;YAEO,YAAY7V,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC5BpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK6K,GACftM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK2I;YACjB;YAEO,cAAAsT;gBACL,OAAOhP,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAAIzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;YACrC;YAMA,OAAOwL,CAAAA,EAAAA;gBACL,MAAM8V,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhBwjB,IAAO3f,KAAKkJ,GAAAA,CAAIvB,IAChBiY,IAAS5f,KAAKiJ,GAAAA,CAAItB;gBAQxB,OANAjN,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASnC,IAAMkC,IAAO9B,GACrCnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASlC,IAAMiC,IAAO7B,GAErCpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS/B,IAAM8B,IAAOlC,GACrC/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAAS9B,IAAM6B,IAAOjC,GAE9BhjB,IACT;YAAA;YAOA,UAAUsM,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnB,MAAM2Y,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAGhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAGhB8hB,IAAMvjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB+hB,IAAMxjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBAOtB,OAHAzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKshB,IAAMzW,IAAI6W,IAAM/Y,IAAImZ,GACnCvjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKuhB,IAAM1W,IAAI8W,IAAMhZ,IAAIoZ,GAE5BxjB,IACT;YAAA;YAOA,MAAMsM,CAAAA,EAAWlC,CAAAA,EAAAA;gBACf,MAAM2Y,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBAYtB,OAVAzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKshB,IAAMzW,GACrBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKuhB,IAAM1W,GAErBtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK0hB,IAAM/Y,GACrBpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK2hB,IAAMhZ,GAErBpK,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,GAAKha,GACjBtM,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,GAAKlc,GACjBpK,IAAAA,CAAK6hB,WAAAA,GAAcrV,EAAKF,IACxBtM,IAAAA,CAAK+hB,WAAAA,GAAcvV,EAAKpC,IACjBpK,IACT;YAAA;YAEO,cAAAumB;gBACL,OAAOvmB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAChE;YAAA;YAQO,QAAQ4f,CAAAA,EAAAA;gBAMb,MAAMoF,IAAMzmB,IAAAA,CAAKumB,WAAAA;gBACjB,IAAIR,IAAaU;gBACL,MAARA,KACFV,CAAAA,IAAa,IAAIU,CAAAA;gBAEnB,MAAMrkB,IAAIpC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACd6Q,IAAItS,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACdgT,IAAIzU,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACdU,IAAInC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAEdukB,IAAI3E,KAAU+E,EAAa7D,QAAAA;gBAEjCyD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKU,IAAI4jB,GAChBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAMgT,IAAIsR,GACjBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAM6Q,IAAIyT,GACjBC,EAAEvkB,IAAAA,CAAK,EAAA,GAAKW,IAAI2jB;gBAEhB,MAAME,IAAKjmB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACfykB,IAAKlmB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBAMrB,OAHAukB,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAOwkB,CAAAA,IAAKD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKykB,IAAKF,EAAEvkB,IAAAA,CAAK,EAAA,AAAA,GAC3CukB,EAAEvkB,IAAAA,CAAK,EAAA,GAAA,CAAOwkB,CAAAA,IAAKD,EAAEvkB,IAAAA,CAAK,EAAA,GAAKykB,IAAKF,EAAEvkB,IAAAA,CAAK,EAAA,AAAA,GAEpCukB;YACT;YAcA,SAASpD,CAAAA,EAAuCtS,CAAAA,EAAAA;gBAC9C,IAAIsS,aAA0B9U,GAAQ;oBACpC,MAAM1C,IAAUkF,KAAmB,IAAIxC,EAAO,GAAG,IAC3CuB,IAASuT,GAETC,IAAUxT,EAAO/C,CAAAA,GAAItM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK4N,EAAOjF,CAAAA,GAAIpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxEqhB,IAAUzT,EAAO/C,CAAAA,GAAItM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK4N,EAAOjF,CAAAA,GAAIpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;oBAI9E,OAFA2J,EAAOkB,CAAAA,GAAIuW,GACXzX,EAAOhB,CAAAA,GAAI0Y,GACJ1X;gBACT;gBAAO;oBACL,MAAMA,IAAUkF,KAAyB,IAAI8V,GACvCnH,IAAQ2D,GACRG,IAAM/iB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChBuhB,IAAMhjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAGhB0hB,IAAMnjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB2hB,IAAMpjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAGhB8hB,IAAMvjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChB+hB,IAAMxjB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAGhBsiB,IAAM9E,EAAMxd,IAAAA,CAAK,EAAA,EACjBuiB,IAAM/E,EAAMxd,IAAAA,CAAK,EAAA,EAGjB0iB,IAAMlF,EAAMxd,IAAAA,CAAK,EAAA,EACjB2iB,IAAMnF,EAAMxd,IAAAA,CAAK,EAAA,EAGjB8iB,IAAMtF,EAAMxd,IAAAA,CAAK,EAAA,EACjB+iB,IAAMvF,EAAMxd,IAAAA,CAAK,EAAA;oBAGvB2J,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMgB,IAAMZ,IAAMa,GACnC5Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMe,IAAMX,IAAMY,GAEnC5Y,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMoB,IAAMhB,IAAMiB,GACnChZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMmB,IAAMf,IAAMgB,GAEnChZ,EAAO3J,IAAAA,CAAK,EAAA,GAAKshB,IAAMwB,IAAMpB,IAAMqB,IAAMjB,GACzCnY,EAAO3J,IAAAA,CAAK,EAAA,GAAKuhB,IAAMuB,IAAMnB,IAAMoB,IAAMhB;oBAEzC,MAAMkD,IAAQ1mB,IAAAA,CAAK6hB,WAAAA,EACb8E,IAAQ3mB,IAAAA,CAAK+hB,WAAAA;oBAInB,OAHA3W,EAAOyW,WAAAA,GAAc6E,IAAQla,EAAKpB,EAAOyW,WAAAA,GACzCzW,EAAO2W,WAAAA,GAAc4E,IAAQna,EAAKpB,EAAO2W,WAAAA,GAElC3W;gBACT;YACF;YAOA,oBAAoByb,CAAAA,EAAAA;gBAClB,MAAMC,IAAiBD,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAC7EslB,IAAiBF,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACnFolB,CAAAA,CAAK,EAAA,GAAKC,GACVD,CAAAA,CAAK,EAAA,GAAKE;gBAEV,MAAMC,IAAkBH,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAC9EwlB,IAAkBJ,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACpFolB,CAAAA,CAAK,EAAA,GAAKG,GACVH,CAAAA,CAAK,EAAA,GAAKI;gBAEV,MAAMC,IAAoBL,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EAChF0lB,IAAoBN,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACtFolB,CAAAA,CAAK,EAAA,GAAKK,GACVL,CAAAA,CAAK,EAAA,GAAKM;gBAEV,MAAMC,IAAqBP,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACjF4lB,IAAqBR,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKolB,CAAAA,CAAK,EAAA,GAAK7mB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACvFolB,CAAAA,CAAK,EAAA,GAAKO,GACVP,CAAAA,CAAK,EAAA,GAAKQ;YACZ;YAEA,QAAAC;gBACE,MAAMnF,IAAM,IAAIT;gBAoBhB,OAnBAS,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GAEf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACzB0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACf0gB,EAAI1gB,IAAAA,CAAK,GAAA,GAAM,GACR0gB;YACT;YAEO,YAAYlV,CAAAA,EAAAA;gBACjB,MAAMmY,IAAeplB,IAAAA,CAAK+kB,QAAAA,IACpBE,IAAO3f,KAAKkJ,GAAAA,CAAIvB,IAChBiY,IAAS5f,KAAKiJ,GAAAA,CAAItB;gBAExBjN,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASE,EAAa9Y,CAAAA,EACrCtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKwjB,IAAOG,EAAahb,CAAAA,EACnCpK,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAA,CAAMwjB,IAAOG,EAAa9Y,CAAAA,EACpCtM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKyjB,IAASE,EAAahb,CACvC;YAAA;YAEO,cAAAib;gBAEL,OAAOrY,EADO1H,KAAK4L,KAAAA,CAAMlR,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKslB,SAAAA,IAAatlB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKulB,SAAAA;YAEhF;YAEO,YAAAA;gBAEL,MAAMgC,IAAWvnB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACxE,OAAiB,MAAb8lB,IAEKvnB,IAAAA,CAAK6hB,WAAAA,GAEP7hB,IAAAA,CAAK6hB,WAAAA,GAAcvc,KAAK0J,IAAAA,CAAKuY;YACtC;YAEO,YAAAjC;gBAEL,MAAMkC,IAAWxnB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA;gBACxE,OAAiB,MAAb+lB,IAEKxnB,IAAAA,CAAK+hB,WAAAA,GAEP/hB,IAAAA,CAAK+hB,WAAAA,GAAczc,KAAK0J,IAAAA,CAAKwY;YACtC;YAKO,WAAAzC;gBACL,OAAOrW,EAAI1O,IAAAA,CAAKulB,SAAAA,IAAavlB,IAAAA,CAAKslB,SAAAA;YACpC;YAIO,UAAU7Y,CAAAA,EAAAA;gBACf,IAAIA,MAAQzM,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,EACtB;gBAEFtmB,IAAAA,CAAK6hB,WAAAA,GAAcrV,EAAKC;gBAExB,MAAM+Y,IAAS9W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK6hB,WAAAA,EAAa7hB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK6hB,WAAAA,EAAa7R,SAAAA;gBACrFhQ,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK+jB,EAAOlZ,CAAAA,GAAIG,GAC1BzM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAK+jB,EAAOpb,CAAAA,GAAIqC,GAC1BzM,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,GAAK7Z;YACnB;YAGO,UAAUA,CAAAA,EAAAA;gBACf,IAAIA,MAAQzM,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,EACtB;gBAEFtmB,IAAAA,CAAK+hB,WAAAA,GAAcvV,EAAKC;gBAExB,MAAMgZ,IAAS/W,EAAI1O,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK+hB,WAAAA,EAAa/hB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAK+hB,WAAAA,EAAa/R,SAAAA;gBACrFhQ,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKgkB,EAAOnZ,CAAAA,GAAIG,GAC1BzM,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,GAAKgkB,EAAOrb,CAAAA,GAAIqC,GAC1BzM,IAAAA,CAAKsmB,MAAAA,CAAO,EAAA,GAAK7Z;YACnB;YAEO,SAASwD,CAAAA,EAAAA;gBACdjQ,IAAAA,CAAK0lB,SAAAA,CAAUzV,EAAM3D,CAAAA,GACrBtM,IAAAA,CAAK2lB,SAAAA,CAAU1V,EAAM7F,CAAAA;YACvB;YAEO,aAAA+b;gBACL,OAAwB,MAAjBnmB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IAA6B,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IAA6B,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IAA6B,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IAA6B,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,IAA6B,MAAjBzB,IAAAA,CAAKyB,IAAAA,CAAK,EACjI;YAAA;YAMO,QAAAka;gBACL,MAAMwG,IAAMniB,IAAAA;gBASZ,OARAmiB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GAEd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACd0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAK,GACP0gB;YACT;YAKO,MAAM7R,CAAAA,EAAAA;gBACX,MAAM6R,IAAM7R,KAAQ,IAAI8V;gBASxB,OARAjE,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAI1gB,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,EACxB0gB,EAAIN,WAAAA,GAAc7hB,IAAAA,CAAK6hB,WAAAA,EACvBM,EAAIJ,WAAAA,GAAc/hB,IAAAA,CAAK+hB,WAAAA,EAChBI;YACT;YAEO,WAAApiB;gBACL,OAAO,CAAA,GAAA,EACRC,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,IAAA,EAC1CzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,CAAA,EAAMzB,IAAAA,CAAKyB,IAAAA,CAAK,EAAA,CAAA,YAAA,CAG3C;YAAA;QAAA;QCtbK,MAAMgmB;YAGX,YACSC,CAAAA,EACAC,CAAAA,EACPC,IAAsB,CAAA,CAAA;gBAFf,IAAA,CAAAF,OAAAA,GAAAA,GACA,IAAA,CAAAC,OAAAA,GAAAA,GAJD,IAAA,CAAAE,KAAAA,GAAa,EAAA,EACb,IAAA,CAAAC,KAAAA,GAAgB,GAMtB9nB,IAAAA,CAAK+nB,IAAAA,CAAKH;YACZ;YAMA,KAAKI,CAAAA,EAAAA;gBACH,IAAIA,IAAS,GAAG;oBACdhoB,IAAAA,CAAK8nB,KAAAA,IAASE;oBACd,IAAK,IAAIxnB,IAAI,GAAGA,IAAIwnB,GAAQxnB,IAC1BR,IAAAA,CAAK6nB,KAAAA,CAAMloB,IAAAA,CAAKK,IAAAA,CAAK0nB,OAAAA;gBAEzB;YACF;YAQA,KAAKQ,IAAAA,CAAiB,CAAA,EAAA;gBAKpB,OAJ0B,MAAtBloB,IAAAA,CAAK6nB,KAAAA,CAAMvnB,MAAAA,IACbN,IAAAA,CAAK+nB,IAAAA,CAAK/nB,IAAAA,CAAK8nB,KAAAA,GAGVI,IAAQloB,IAAAA,CAAK2nB,OAAAA,CAAQ3nB,IAAAA,CAAK6nB,KAAAA,CAAMM,GAAAA,MAASnoB,IAAAA,CAAK6nB,KAAAA,CAAMM,GAAAA;YAC7D;YAMA,OAAOpH,CAAAA,EAAAA;gBACL/gB,IAAAA,CAAK6nB,KAAAA,CAAMloB,IAAAA,CAAKohB;YAClB;QAAA;QCzCK,MAAMqH;YAAb,aAAA;gBACU,IAAA,CAAAP,KAAAA,GAAQ,IAAIJ,EAClB,IAAMrB,EAAa7D,QAAAA,IAClBJ,CAAAA,IAAQA,EAAIxG,KAAAA,IACb,MAEM,IAAA,CAAA0M,WAAAA,GAA8B,EAAA,EAE9B,IAAA,CAAAC,iBAAAA,GAAkCtoB,IAAAA,CAAK6nB,KAAAA,CAAMI,IAAAA,CAAAA,CAAK;YAmC5D;YAjCS,OAAAM;gBACLvoB,IAAAA,CAAKqoB,WAAAA,CAAY1oB,IAAAA,CAAKK,IAAAA,CAAKsoB,iBAAAA,GAC3BtoB,IAAAA,CAAKsoB,iBAAAA,GAAoBtoB,IAAAA,CAAKsoB,iBAAAA,CAAkBrW,KAAAA,CAAMjS,IAAAA,CAAK6nB,KAAAA,CAAMI,IAAAA;YACnE;YAEO,UAAAO;gBACLxoB,IAAAA,CAAK6nB,KAAAA,CAAMY,MAAAA,CAAOzoB,IAAAA,CAAKsoB,iBAAAA,GACvBtoB,IAAAA,CAAKsoB,iBAAAA,GAAoBtoB,IAAAA,CAAKqoB,WAAAA,CAAYF,GAAAA;YAC5C;YAEO,UAAU7b,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC1B,OAAOpK,IAAAA,CAAKsoB,iBAAAA,CAAkB3L,SAAAA,CAAUrQ,GAAGlC;YAC7C;YAEO,OAAO6C,CAAAA,EAAAA;gBACZ,OAAOjN,IAAAA,CAAKsoB,iBAAAA,CAAkBzW,MAAAA,CAAO5E;YACvC;YAEO,MAAMX,CAAAA,EAAWlC,CAAAA,EAAAA;gBACtB,OAAOpK,IAAAA,CAAKsoB,iBAAAA,CAAkBrY,KAAAA,CAAM3D,GAAGlC;YACzC;YAEO,QAAAuR;gBACL3b,IAAAA,CAAKsoB,iBAAAA,CAAkB3M,KAAAA;YACzB;YAEA,IAAA,QAAmBqB,CAAAA,EAAAA;gBACjBhd,IAAAA,CAAKsoB,iBAAAA,GAAoBtL;YAC3B;YAEA,IAAA,UAAW0L;gBACT,OAAO1oB,IAAAA,CAAKsoB,iBACd;YAAA;QAAA;QCxCK,MAAMK;YAAb,aAAA;gBACE,IAAA,CAAAC,OAAAA,GAAkB,GAClB,IAAA,CAAAC,CAAAA,GAAY,GACZ,IAAA,CAAAC,IAAAA,GAAiC1W,EAAM0C,KAAAA,EACvC,IAAA,CAAAiU,QAAAA,GAAwC;YAC1C;QAAA;QAEO,MAAMC;YAAb,aAAA;gBACU,IAAA,CAAAnB,KAAAA,GAAQ,IAAIJ,EAClB,IAAM,IAAIkB,GACT3e,CAAAA,IACCA,CAAAA,EAAE4e,OAAAA,GAAU,GACZ5e,EAAE6e,CAAAA,GAAI,GACN7e,EAAE8e,IAAAA,GAAO1W,EAAM0C,KAAAA,EACf9K,EAAE+e,QAAAA,GAAW,MACN/e,CAAAA,GAET,MAEK,IAAA,CAAA0e,OAAAA,GAAyC1oB,IAAAA,CAAK6nB,KAAAA,CAAMI,IAAAA,CAAAA,CAAK,IACxD,IAAA,CAAAgB,OAAAA,GAA2C,EAmBrD;YAAA;YAjBU,YAAY3Y,CAAAA,EAAAA;gBAAAA,IAAAA;gBAKlB,OAJAA,EAAKsY,OAAAA,GAAU5oB,IAAAA,CAAK0oB,OAAAA,CAAQE,OAAAA,EAC5BtY,EAAKuY,CAAAA,GAAI7oB,IAAAA,CAAK0oB,OAAAA,CAAQG,CAAAA,EACtBvY,EAAKwY,IAAAA,GAAwB,SAAjB,CAAA,IAAA9oB,IAAAA,CAAK0oB,OAAAA,CAAQI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAE7W,KAAAA,IAC/B3B,EAAKyY,QAAAA,GAAW/oB,IAAAA,CAAK0oB,OAAAA,CAAQK,QAAAA,EACtBzY;YACT;YAEO,OAAAiY;gBACLvoB,IAAAA,CAAKipB,OAAAA,CAAQtpB,IAAAA,CAAKK,IAAAA,CAAK0oB,OAAAA,GACvB1oB,IAAAA,CAAK0oB,OAAAA,GAAU1oB,IAAAA,CAAKkpB,WAAAA,CAAYlpB,IAAAA,CAAK6nB,KAAAA,CAAMI,IAAAA;YAC7C;YAEO,UAAAO;gBACLxoB,IAAAA,CAAK6nB,KAAAA,CAAMY,MAAAA,CAAOzoB,IAAAA,CAAK0oB,OAAAA,GACvB1oB,IAAAA,CAAK0oB,OAAAA,GAAU1oB,IAAAA,CAAKipB,OAAAA,CAAQd,GAAAA;YAC9B;QAAA;QC/BK,MAAMgB,KAAiB;YAC5BC,UAAU;YACVC,MAAM;YACNC,WAAW;YACXC,UAAU;YACVpjB,OAAO;QAAA;QAOF,MAAMqjB;YAUX,YACSC,CAAAA,EACAC,CAAAA,EACAC,IAAAA,CAAqB,CAAA,CAAA;gBAFrB,IAAA,CAAAF,IAAAA,GAAAA,GACA,IAAA,CAAAC,YAAAA,GAAAA,GACA,IAAA,CAAAC,SAAAA,GAAAA,GAZF,IAAA,CAAAloB,IAAAA,GAAU,MACV,IAAA,CAAAmoB,MAAAA,GAAiBhT,EAAOS,WAAAA,IACxB,IAAA,CAAA6C,MAAAA,GAAS,IAAIhT;YAWjB;YAMI,WAAA2iB;gBACL,OAAqB,SAAd7pB,IAAAA,CAAKyB,IACd;YAAA;YAEQ,WAAWsoB,CAAAA,EAAAA;gBAOjB,OANsB,YACZC,IAAAA,CAAKD,KACbA,KAAO,SAAS9kB,KAAKC,GAAAA,KAErB6kB,KAAO,SAAS9kB,KAAKC,GAAAA,IAEhB6kB;YACT;YAIO,OAAAE;gBACL,OAAO,IAAI1lB,QAAQ,CAACC,GAASC;oBAE3B,IAAkB,SAAdzE,IAAAA,CAAKyB,IAAAA,EAIP,OAHAzB,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,kCAAkChY,IAAAA,CAAKypB,IAAAA,GACzDzpB,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,YAAYnI,IAAAA,CAAKyB,IAAAA,GAAAA,KAClC+C,EAAQxE,IAAAA,CAAKyB,IAAAA;oBAIf,MAAMyoB,IAAU,IAAIC;oBACpBD,EAAQE,IAAAA,CAAK,OAAOpqB,IAAAA,CAAK2pB,SAAAA,GAAY3pB,IAAAA,CAAK8pB,UAAAA,CAAW9pB,IAAAA,CAAKypB,IAAAA,IAAQzpB,IAAAA,CAAKypB,IAAAA,EAAAA,CAAM,IAC7ES,EAAQR,YAAAA,GAAe1pB,IAAAA,CAAK0pB,YAAAA,EAC5BQ,EAAQG,gBAAAA,CAAiB,aAAc/K,CAAAA,IAAMtf,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,aAAamX,KAC3E4K,EAAQG,gBAAAA,CAAiB,YAAa/K,CAAAA,IAAMtf,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,YAAYmX,KACzE4K,EAAQG,gBAAAA,CAAiB,SAAU/K,CAAAA,IAAMtf,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAASmX,KACnE4K,EAAQG,gBAAAA,CAAiB,QAAS/K,CAAAA,IAAMtf,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQmX,KACjE4K,EAAQG,gBAAAA,CAAiB,QAAQ;wBAE/B,IAAuB,MAAnBH,EAAQI,MAAAA,IAAmC,QAAnBJ,EAAQI,MAAAA,EAIlC,OAHAtqB,IAAAA,CAAK4pB,MAAAA,CAAO3iB,KAAAA,CAAM,4BAA4BjH,IAAAA,CAAKypB,IAAAA,EAAM,qCAAqCS,EAAQI,MAAAA,GACtGtqB,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS+hB,EAAQK,QAAAA,GAAAA,KAClC9lB,EAAO,IAAI0B,MAAM+jB,EAAQM,UAAAA;wBAI3B,IAAIN,EAAQK,QAAAA,YAAoBE,QAAkC,gBAA1BP,EAAQK,QAAAA,CAAS9jB,IAAAA,EAAsB;4BAC7E,MAAMikB,IAAY,CAAA,gEAAA,EAAmE1qB,IAAAA,CAAKypB,IAAAA,CAAAA,gIAAAA,CAAAA;4BAK1F,OAFAzpB,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS+hB,EAAQK,QAAAA,GAAAA,KAClC9lB,EAAO,IAAI0B,MAAMukB;wBAEnB;wBAEA1qB,IAAAA,CAAKyB,IAAAA,GAAOyoB,EAAQK,QAAAA,EACpBvqB,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,YAAYnI,IAAAA,CAAKyB,IAAAA,GAClCzB,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,8BAA8BhY,IAAAA,CAAKypB,IAAAA,GACrDjlB,EAAQxE,IAAAA,CAAKyB,IAAAA;oBAAK,IAEpByoB,EAAQS,IAAAA;gBAAM;YAElB;QAAA;QCnGK,SAASC,GAAwBnkB,CAAAA,EAASokB,CAAAA;YAC/C,OAAKpkB,KAAAA,KAG2B3F,MAA3B2F,EAAaqkB,SAAAA,GAET,IAAIC,MAAMtkB,GAAM;gBACrBukB,KAAK,CAACpoB,GAAKC,GAAMO,IAEVR,CAAAA,CAAAA,CAAYC,EAAAA,KAAUO,KACxBR,CAAAA,CAAAA,CAAYC,EAAAA,GAAQO,GAED,YAAA,OAATP,KACO,QAAZA,CAAAA,CAAK,EAAA,IACPgoB,EAAOjoB,EAAAA,GAAAA,CAKN,CAAA;gBAETD,KAAK,CAACC,GAAKC,IACI,gBAATA,KACMD,CAAAA,CAAYC,EAAAA;YAAAA,KArBnB4D;QA4BX;QAEA,MAAMwkB,KAAgB,CAAIxB,IAAiB,EAAA,EAAIoB,GAA0BK,IAAgB,CAAA;gBACvFvoB,KAAK,CAAC0e,GAAW/e,IACH,gBAARA,KAGgC,CAAA,YAAA,OAAxB+e,CAAAA,CAAe/e,EAAAA,IAA6C,QAAvB+e,CAAAA,CAAe/e,EAAAA,GACvD,IAAIyoB,MAAO1J,CAAAA,CAAe/e,EAAAA,EAAM2oB,GAAmB;2BAAIxB;wBAAMnnB;qBAAAA,EAAgBuoB,GAAQK,MAEtF7J,CAAAA,CAAe/e,EAAAA,AAAAA;gBAEzB0oB,KAAK,CAAC3J,GAAW/e,GAAac,IACT,CAAA,YAAA,OAARd,KACM,QAAXA,CAAAA,CAAI,EAAA,IACNuoB,EAAOK,IAGV7J,CAAAA,CAAe/e,EAAAA,GAAOc,GAAAA,CAChB,CAAA;YAAA,CAAA;QCEJ,MAAe+nB;YAQb,UAAAC;gBACL,OAAOprB,IAAAA,CAAKqrB,eACd;YAAA;YAWA,IAAA,iBAAWC;gBACT,OAAOtrB,IAAAA,CAAKurB,eACd;YAAA;YAEA,IAAA,eAA0BnoB,CAAAA,EAAAA;gBACxBpD,IAAAA,CAAKurB,eAAAA,GAAkBnoB,GACvBpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAMA,IAAA,eAAWG;gBACT,OAAOxrB,IAAAA,CAAKyrB,aACd;YAAA;YAEA,IAAA,aAAwBroB,CAAAA,EAAAA;gBACtBpD,IAAAA,CAAKyrB,aAAAA,GAAgBroB,GACrBpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAMA,IAAA,WAAW1I;gBACT,OAAO3iB,IAAAA,CAAK0rB,SACd;YAAA;YAEA,IAAA,SAAoBtoB,CAAAA,EAAAA;gBAClBpD,IAAAA,CAAK0rB,SAAAA,GAAYtoB,GACjBpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAWA,IAAA,QAAWpb;gBACT,OAAOjQ,IAAAA,CAAKsmB,MACd;YAAA;YAEA,IAAA,MAAiBljB,CAAAA,EAAAA;gBACfpD,IAAAA,CAAKsmB,MAAAA,GAASsE,GAAMxnB,GAAO;oBACzBpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;gBAAI,IAE7BrrB,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAMA,IAAA,SAAWM;gBACT,OAAO3rB,IAAAA,CAAK4rB,OACd;YAAA;YAEA,IAAA,OAAkBxoB,CAAAA,EAAAA;gBACZA,KACFpD,CAAAA,IAAAA,CAAK4rB,OAAAA,GAAUhB,GAAMxnB,GAAO;oBAC1BpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;gBAAI,EAAA,GAG/BrrB,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAEA,YAAYpS,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBA3FH,IAAA,CAAArZ,EAAAA,GAAKurB,GAAQU,GAAAA,IAEf,IAAA,CAAA9O,SAAAA,GAA0BqJ,EAAa7D,QAAAA,IAGtC,IAAA,CAAA8I,eAAAA,GAAAA,CAAkB,GAQnB,IAAA,CAAAS,SAAAA,GAAAA,CAAqB,GAEpB,IAAA,CAAAP,eAAAA,GAAAA,CAAkB,GAalB,IAAA,CAAAE,aAAAA,GAAAA,CAAgB,GAahB,IAAA,CAAAC,SAAAA,GAAY,GAgBb,IAAA,CAAA9C,OAAAA,GAAkB,GAEjB,IAAA,CAAAtC,MAAAA,GAASxY,EAAOE,GAAAA,EAiEhB,IAAA,CAAA+d,MAAAA,GAAiB,GASjB,IAAA,CAAAC,OAAAA,GAAkB,GAzCpB/S,KACFjZ,CAAAA,IAAAA,CAAK2rB,MAAAA,GAAuB,SAAd,CAAA,IAAA1S,EAAQ0S,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI3rB,IAAAA,CAAK2rB,MAAAA,EACrC3rB,IAAAA,CAAKsrB,cAAAA,GAAuC,SAAtB,CAAA,IAAArS,EAAQqS,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAItrB,IAAAA,CAAKsrB,cAAAA,EACrDtrB,IAAAA,CAAKwrB,YAAAA,GAAmC,SAApB,CAAA,IAAAvS,EAAQuS,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAIxrB,IAAAA,CAAKwrB,YAAAA,EACjDxrB,IAAAA,CAAK2iB,QAAAA,GAA2B,SAAhB,CAAA,IAAA1J,EAAQ0J,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI3iB,IAAAA,CAAK2iB,QAAAA,EACzC3iB,IAAAA,CAAK4oB,OAAAA,GAAyB,SAAf,CAAA,IAAA3P,EAAQ2P,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI5oB,IAAAA,CAAK4oB,OAAAA,EACvC5oB,IAAAA,CAAKiQ,KAAAA,GAAqB,SAAb,CAAA,IAAAgJ,EAAQhJ,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIjQ,IAAAA,CAAKiQ,KAAAA,EACnCjQ,IAAAA,CAAK8oB,IAAAA,GAAmB,SAAZ,CAAA,IAAA7P,EAAQ6P,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI9oB,IAAAA,CAAK8oB,IAAAA,EAC7B7P,EAAQkB,KAAAA,IACVna,CAAAA,IAAAA,CAAK+rB,MAAAA,GAAS9S,EAAQkB,KAAAA,AAAAA,GAGpBlB,EAAQoB,MAAAA,IACVra,CAAAA,IAAAA,CAAKgsB,OAAAA,GAAU/S,EAAQoB,MAAAA,AAAAA,CAAAA;YAG7B;YAEO,sBAAA4R;gBACL,OAAO;oBACL9R,OAAOna,IAAAA,CAAKma,KAAAA,GAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;oBAC/B+N,QAAQra,IAAAA,CAAKqa,MAAAA,GAASra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;oBACjCuhB,QAAQ3rB,IAAAA,CAAK2rB,MAAAA,GAAS3rB,IAAAA,CAAK2rB,MAAAA,CAAO1Z,KAAAA,KAAAA,KAAUnR;oBAC5CwqB,gBAAgBtrB,IAAAA,CAAKsrB,cAAAA;oBACrBE,cAAcxrB,IAAAA,CAAKwrB,YAAAA;oBACnB7I,UAAU3iB,IAAAA,CAAK2iB,QAAAA;oBACfiG,SAAS5oB,IAAAA,CAAK4oB,OAAAA;oBACd3Y,OAAOjQ,IAAAA,CAAKiQ,KAAAA,GAAQjQ,IAAAA,CAAKiQ,KAAAA,CAAMgC,KAAAA,KAAAA,KAAUnR;oBACzCgoB,MAAM9oB,IAAAA,CAAK8oB,IAAAA,GAAO9oB,IAAAA,CAAK8oB,IAAAA,CAAK7W,KAAAA,KAAAA,KAAUnR;gBAAAA;YAE1C;YAOA,IAAA,QAAWqZ;gBACT,OAAO7U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK+rB,MAAAA,GAAS/rB,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;YAC3C;YAOA,IAAA,SAAW+N;gBACT,OAAO/U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKgsB,OAAAA,GAAUhsB,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;YAC5C;YAEA,IAAA,MAAiBhH,CAAAA,EAAAA;gBACfpD,IAAAA,CAAK+rB,MAAAA,GAAS3oB,GACdpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAEA,IAAA,OAAkBjoB,CAAAA,EAAAA;gBAChBpD,IAAAA,CAAKgsB,OAAAA,GAAU5oB,GACfpD,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB;YACzB;YAKA,IAAA,cAAWa;gBACT,OAAO5Q,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQvM,EAAOC,IAAAA;YACnE;YAQO,KAAK+R,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnDpK,IAAAA,CAAKmsB,QAAAA,CAASrM,GAAIxT,GAAGlC,IACrBpK,IAAAA,CAAKosB,UAAAA,CAAWtM,GAAI,GAAG,IACvB9f,IAAAA,CAAKqsB,SAAAA,CAAUvM;YACjB;YAkBU,SAASA,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC1D0V,EAAGyI,IAAAA,IACHzI,EAAGnD,SAAAA,CAAUrQ,GAAGlC,IACZpK,IAAAA,CAAKqrB,eAAAA,IACPrrB,CAAAA,IAAAA,CAAK+c,SAAAA,CAAUpB,KAAAA,IACf3b,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,CAAM3K,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAAIhH,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,IACjEpK,IAAAA,CAAKssB,OAAAA,CAAQtsB,IAAAA,CAAK+c,SAAAA,GAClB/c,IAAAA,CAAKusB,KAAAA,CAAMvsB,IAAAA,CAAK+c,SAAAA,GAChB/c,IAAAA,CAAKqrB,eAAAA,GAAAA,CAAkB,CAAA,GAEzBvL,EAAGpM,QAAAA,CAAS1T,IAAAA,CAAK+c,SAAAA,GAEjB+C,EAAG8I,OAAAA,GAAU9I,EAAG8I,OAAAA,GAAU5oB,IAAAA,CAAK4oB,OAAAA,EAC3B5oB,IAAAA,CAAK8oB,IAAAA,IACPhJ,CAAAA,EAAGgJ,IAAAA,GAAO9oB,IAAAA,CAAK8oB,IAAAA,AAAAA;YAEnB;YAEU,QAAQhJ,CAAAA,EAAAA;gBAAAA,IAAAA;gBAChB,MAAM0M,IAAYxsB,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAAI,IAAI,IAAA,IAC/BmgB,IAAYzsB,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GAAI,IAAI,IAAA,IAC/BuhB,IAAoB,SAAX,CAAA,IAAA3rB,IAAAA,CAAK2rB,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIjd,EAAI1O,IAAAA,CAAKma,KAAAA,GAAQ,GAAGna,IAAAA,CAAKqa,MAAAA,GAAS;gBAChEyF,EAAGnD,SAAAA,CAAUgP,EAAOrf,CAAAA,EAAGqf,EAAOvhB,CAAAA,GAC9B0V,EAAGjO,MAAAA,CAAO7R,IAAAA,CAAK2iB,QAAAA,GAEf7C,EAAG7P,KAAAA,CAAMuc,GAAWC,IACpB3M,EAAGnD,SAAAA,CAAAA,CAAWgP,EAAOrf,CAAAA,EAAAA,CAAIqf,EAAOvhB,CAAAA;YAClC;YAEU,MAAM0V,CAAAA,EAAAA;gBACV9f,IAAAA,CAAKsrB,cAAAA,IACPxL,CAAAA,EAAGnD,SAAAA,CAAU3c,IAAAA,CAAKma,KAAAA,GAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAG,IACxCwT,EAAG7P,KAAAA,CAAAA,IAAU,EAAA,GAGXjQ,IAAAA,CAAKwrB,YAAAA,IACP1L,CAAAA,EAAGnD,SAAAA,CAAU,GAAG3c,IAAAA,CAAKqa,MAAAA,GAASra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GACzC0V,EAAG7P,KAAAA,CAAM,GAAA,GAAI;YAEjB;YAMU,UAAU6P,CAAAA,EAAAA;gBACd9f,IAAAA,CAAK8rB,SAAAA,IACPhM,EAAG9H,KAAAA,CAAM+H,QAAAA,CAAS,GAAG,GAAG/f,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,GAE3CyF,EAAG0I,OAAAA;YACL;QAAA;QA9Oe,GAAAqD,GAAAA,GAAc;QChCxB,MAAMa,WAAevB;YAOnB,OAAA,KAAYwB,CAAAA,EAAoB1T,CAAAA,EAAAA;gBACrC,OAAO,IAAIyT,GAAO;oBAChBC,OAAAA;oBAAAA,GACG1T,CAAAA;gBAAAA;YAEP;YAEA,YAAYA,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACV2T,KAAAA,CAAM3T,IAdA,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAIjB,IAAA,CAAAyV,MAAAA,GAAAA,CAAS,GAWf9sB,IAAAA,CAAK2sB,KAAAA,GAAQ1T,EAAQ0T,KAAAA;gBACrB,MAAA,EAAM,OAAExS,CAAAA,EAAK,QAAEE,CAAAA,EAAAA,GAAWpB;gBAC1BjZ,IAAAA,CAAK+sB,UAAAA,GAA+B,SAAlB,CAAA,IAAA9T,EAAQ8T,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI;oBAAEzgB,GAAG;oBAAGlC,GAAG;oBAAG+P,OAAOA,QAAAA,IAAAA,IAAS;oBAAGE,QAAQA,QAAAA,IAAAA,IAAU;gBAAA,GAC3Fra,IAAAA,CAAKgtB,QAAAA,GAA2B,SAAhB,CAAA,IAAA/T,EAAQ+T,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI;oBAAE7S,OAAOA,QAAAA,IAAAA,IAAS;oBAAGE,QAAQA,QAAAA,IAAAA,IAAU;gBAAA,GAC3Era,IAAAA,CAAKitB,uBAAAA,IAGLjtB,IAAAA,CAAK2sB,KAAAA,CAAMO,KAAAA,CAAMC,IAAAA,CAAK;oBACpBntB,IAAAA,CAAKitB,uBAAAA;gBAAyB;YAElC;YAEA,IAAA,QAAoB9S;gBAClB,OAAO7U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,GAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;YACnD;YAEA,IAAA,SAAoB+N;gBAClB,OAAO/U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,GAASra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;YACpD;YAEA,IAAA,MAA0BgjB,CAAAA,EAAAA;gBACxBA,KAAY9nB,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAChCtM,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,GAAQiT,GACtBR,KAAAA,CAAMzS,QAAQ7U,KAAKiH,IAAAA,CAAKvM,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA;YACxC;YAEA,IAAA,OAA2BkT,CAAAA,EAAAA;gBACzBA,KAAa/nB,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GACjCpK,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,GAASgT,GACvBT,KAAAA,CAAMvS,SAAS/U,KAAKiH,IAAAA,CAAKvM,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA;YACzC;YAEQ,0BAAA4S;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACN,MAAA,EAAQ9S,OAAOmT,CAAAA,EAAajT,QAAQkT,CAAAA,EAAAA,GAAiBvtB,IAAAA,CAAK2sB,KAAAA;gBAG1D3sB,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,GAAAA,AAAuB,CAAA,SAAf,CAAA,IAAAna,IAAAA,CAAK+sB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE5S,KAAAA,AAAAA,KAASmT,GAClDttB,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA,GAAAA,AAAwB,CAAA,SAAf,CAAA,IAAAra,IAAAA,CAAK+sB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE1S,MAAAA,AAAAA,KAAUkT,GAGpDvtB,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,GAAAA,AAAqB,CAAA,SAAb,CAAA,IAAAna,IAAAA,CAAKgtB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAE7S,KAAAA,AAAAA,KAAwB,CAAA,SAAf,CAAA,IAAAna,IAAAA,CAAK+sB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE5S,KAAAA,AAAAA,KAASmT,GACxEttB,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,GAAAA,AAAsB,CAAA,SAAb,CAAA,IAAAra,IAAAA,CAAKgtB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAE3S,MAAAA,AAAAA,KAAyB,CAAA,SAAf,CAAA,IAAAra,IAAAA,CAAK+sB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE1S,MAAAA,AAAAA,KAAUkT,GAE3EvtB,IAAAA,CAAKma,KAAAA,GAAQ7U,KAAKiH,IAAAA,CAAKvM,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,IAASna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EACzDtM,IAAAA,CAAKqa,MAAAA,GAAS/U,KAAKiH,IAAAA,CAAKvM,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,IAAUra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAC7D;YAAA;YAEU,SAAS0V,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBACtDpK,IAAAA,CAAK2sB,KAAAA,CAAM9C,QAAAA,MAAc7pB,IAAAA,CAAK8sB,MAAAA,IAChC9sB,CAAAA,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS,GACd9sB,IAAAA,CAAKitB,uBAAAA,EAAAA,GAEPL,KAAAA,CAAMT,SAASrM,GAAIxT,GAAGlC;YACxB;YAEO,WAAW0V,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBACrDpK,IAAAA,CAAK2sB,KAAAA,CAAM9C,QAAAA,KACb/J,EAAG0N,SAAAA,CACDxtB,IAAAA,CAAK2sB,KAAAA,CAAMA,KAAAA,EACX3sB,IAAAA,CAAK+sB,UAAAA,CAAWzgB,CAAAA,EAChBtM,IAAAA,CAAK+sB,UAAAA,CAAW3iB,CAAAA,EAChBpK,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,EAChBna,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA,EAChB/N,GACAlC,GACApK,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,EACdna,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,IAGhBra,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,CAAA,YAAA,EAAevY,IAAAA,CAAK2sB,KAAAA,CAAMlD,IAAAA,CAAAA,yJAAAA,CAAAA;YAKhC;YAEO,QAAAxX;gBACL,OAAO,IAAIya,GAAO;oBAChBC,OAAO3sB,IAAAA,CAAK2sB,KAAAA;oBACZI,YAAY;wBAAA,GAAK/sB,IAAAA,CAAK+sB,UAAAA;oBAAAA;oBACtBC,UAAU;wBAAA,GAAKhtB,IAAAA,CAAKgtB,QAAAA;oBAAAA;oBAAAA,GACjBhtB,IAAAA,CAAKisB,mBAAAA,EAAAA;gBAAAA;YAEZ;QAAA;QCxHF,IAAYwB,ICAAC;QDiBL,SAASC,GAAoBlhB,CAAAA;YAClC,OAAQA;gBACN,KAAKghB,GAAeG,KAAAA;oBAClB,OAAOH,GAAeG,KAAAA;gBACxB,KAAKH,GAAeI,OAAAA;oBAClB,OAAOJ,GAAeI,OAAAA;gBACxB;oBACE;YAAA;QAEN;QCfO,SAASC,GAAmBrhB,CAAAA;YACjC,OAAQA;gBACN,KAAKihB,GAAcK,KAAAA;oBACjB,OAAOL,GAAcK,KAAAA;gBACvB,KAAKL,GAAcM,MAAAA;oBACjB,OAAON,GAAcM,MAAAA;gBACvB,KAAKN,GAAcO,MAAAA;oBACjB,OAAOP,GAAcO,MAAAA;gBACvB;oBACE,OAAOP,GAAcK,KAAAA;YAAAA;QAE3B;QAAA,CDtBA,SAAYN,CAAAA;YAMV,EAAA,KAAA,GAAA,SAKA,EAAA,OAAA,GAAA;QACD,EAZWA,MAAAA,CAAAA,KAAc,CAAA,CAAA,ICA1B,SAAYC,CAAAA;YACV,EAAA,KAAA,GAAA,SAEA,EAAA,MAAA,GAAA,UAEA,EAAA,MAAA,GAAA;QACD,EANWA,MAAAA,CAAAA,KAAa,CAAA,CAAA;QCOlB,MAAMQ;YAGX,YACEC,CAAAA,EACQC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAAA,IAAA,CAAAA,iBAAAA,GAAAA,GA6BF,IAAA,CAAAC,WAAAA,GAAc,IAAIC,KAkKlB,IAAA,CAAAC,QAAAA,GAAY5B,CAAAA;oBAAAA,IAAAA;oBAClB,IAAI3sB,IAAAA,CAAKwuB,GAAAA,EAAK;wBACZ,MAAMC,IAAgC,SAAzB,CAAA,IAAA9B,EAAM+B,OAAAA,CAAQC,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIhC,EAAMhmB,WAAAA,CAAY8nB,IAAAA;wBAG5D,OAFAP,GAAcU,OAAAA,CAAQ5W,KAAAA,CAAM,CAAA,kBAAA,EAAqByW,EAAAA,UAAAA,CAAAA,GACjDzuB,IAAAA,CAAK6uB,MAAAA,CAAOlC,IAAAA,CACL;oBACT;oBACA,OAAA,CAAO;gBAAK,GAjMZ3sB,IAAAA,CAAKwuB,GAAAA,GAAML,GACXD,GAAcY,iBAAAA,GAAoBX,EAAGY,YAAAA,CAAaZ,EAAGa,gBAAAA,GACjDhvB,IAAAA,CAAKouB,iBAAAA,IACPF,CAAAA,GAAcU,OAAAA,CAAQ5W,KAAAA,CAAM,sCAAsChY,IAAAA,CAAKouB,iBAAAA,CAAkBa,kBAAAA,GAClD,SAAvC,CAAA,IAAAjvB,IAAAA,CAAKouB,iBAAAA,CAAkBc,gBAAAA,AAAAA,KAAAA,KAAgB,MAAA,KAAA,EAAEC,iBAAAA,CAAkB,WAAWnvB,IAAAA,CAAKouB,iBAAAA,CAAkBa,kBAAAA,EAAoBjvB,IAAAA,CAAKuuB,QAAAA,CAAAA;YAE1H;YAEO,UAAAa;gBACL,KAAK,MAAA,CAAOzC,EAAAA,IAAU3sB,IAAAA,CAAKquB,WAAAA,CACzBruB,IAAAA,CAAK6uB,MAAAA,CAAOlC;gBAEd3sB,IAAAA,CAAKquB,WAAAA,CAAY7mB,KAAAA,IACjBxH,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAkBO,IAAI7B,CAAAA,EAAAA;gBACT,OAAO3sB,IAAAA,CAAKquB,WAAAA,CAAY1rB,GAAAA,CAAIgqB;YAC9B;YAMO,IAAIA,CAAAA,EAAAA;gBACT,OAAO3sB,IAAAA,CAAKquB,WAAAA,CAAYtW,GAAAA,CAAI4U;YAC9B;YAQO,KAAKA,CAAAA,EAAwB1T,CAAAA,EAA8BoW,IAAAA,CAAc,CAAA,EAAA;gBAAA,IAAA,GAAA;gBAE9E,MAAMlB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChB,IAAA,CAAKL,GACH,OAAO;gBAGT,MAAA,EAAM,WAAEmB,CAAAA,EAAS,UAAEC,CAAAA,EAAAA,GAAa;oBAAA,GAAKtW,CAAAA;gBAAAA;gBAErC,IA0BIuW,GA1BAC,IAA2B;gBAO/B,IALIzvB,IAAAA,CAAK+X,GAAAA,CAAI4U,MACX8C,CAAAA,IAAMzvB,IAAAA,CAAK2C,GAAAA,CAAIgqB,EAAAA,GAIb8C,GAMF,OALIJ,KACFlB,CAAAA,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYF,IAC9BtB,EAAGyB,UAAAA,CAAWzB,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM1B,EAAG0B,IAAAA,EAAM1B,EAAG2B,aAAAA,EAAenD,EAAAA,GAEhD,SAAtB,CAAA,IAAA3sB,IAAAA,CAAKouB,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,KAAA,EAAEc,gBAAAA,CAAiBa,KAAAA,CAAMpD,IACxC8C;gBAITA,IAAMtB,EAAG6B,aAAAA,IAGT9B,GAAc+B,6BAAAA,CAA8BtD,IAE5CwB,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYF,IAE9BtB,EAAG+B,WAAAA,CAAY/B,EAAGgC,8BAAAA,EAAAA,CAAgC,IAG9CZ,KAEAC,CAAAA,IADsB,YAAA,OAAbD,IACQ;oBACfjjB,GAAGijB;oBACHnlB,GAAGmlB;gBAAAA,IAGY;oBACfjjB,GAAGijB,EAASjjB,CAAAA;oBACZlC,GAAGmlB,EAASnlB,CAAAA;gBAAAA,CAAAA;gBAIlB,MAAA,EAAQkC,GAAG8jB,CAAAA,EAAOhmB,GAAGimB,CAAAA,EAAAA,GAAUb,QAAAA,IAAAA,IAAkBtB,GAAcqB,QAAAA;gBAC/D,OAAQa;oBACN,KAAK1C,GAAcK,KAAAA;wBACjBI,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGqC,aAAAA;wBACtD;oBACF,KAAK9C,GAAcM,MAAAA;wBACjBG,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGsC,MAAAA;wBACtD;oBACF,KAAK/C,GAAcO,MAAAA;wBACjBE,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGuC,eAAAA;wBACtD;oBACF;wBACEvC,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGqC,aAAAA;gBAAAA;gBAE1D,OAAQH;oBACN,KAAK3C,GAAcK,KAAAA;wBACjBI,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGqC,aAAAA;wBACtD;oBACF,KAAK9C,GAAcM,MAAAA;wBACjBG,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGsC,MAAAA;wBACtD;oBACF,KAAK/C,GAAcO,MAAAA;wBACjBE,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGuC,eAAAA;wBACtD;oBACF;wBACEvC,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGqC,aAAAA;gBAAAA;gBAI1D,MAAMI,IAAatB,QAAAA,IAAAA,IAAapB,GAAcoB,SAAAA;gBAS9C,OAPAnB,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG0C,kBAAAA,EAAoBD,MAAenD,GAAeG,KAAAA,GAAQO,EAAG2C,OAAAA,GAAU3C,EAAG4C,MAAAA,GAC7G5C,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG6C,kBAAAA,EAAoBJ,MAAenD,GAAeG,KAAAA,GAAQO,EAAG2C,OAAAA,GAAU3C,EAAG4C,MAAAA,GAE7G5C,EAAGyB,UAAAA,CAAWzB,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM1B,EAAG0B,IAAAA,EAAM1B,EAAG2B,aAAAA,EAAenD,IAEpE3sB,IAAAA,CAAKquB,WAAAA,CAAYrD,GAAAA,CAAI2B,GAAO8C,IACN,SAAtB,CAAA,IAAAzvB,IAAAA,CAAKouB,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,KAAA,EAAEc,gBAAAA,CAAiB+B,sBAAAA,CAAuB,WAAWtE,IACpE8C;YACT;YAEO,OAAO9C,CAAAA,EAAAA;gBAEZ,MAAMwB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChB,IAAKL,KAIDnuB,IAAAA,CAAK+X,GAAAA,CAAI4U,IAAQ;oBACnB,MAAMuE,IAAUlxB,IAAAA,CAAK2C,GAAAA,CAAIgqB;oBACrBuE,KACFlxB,CAAAA,IAAAA,CAAKquB,WAAAA,CAAYQ,MAAAA,CAAOlC,IACxBwB,EAAGgD,aAAAA,CAAcD,EAAAA;gBAErB;YACF;YAOO,OAAA,8BAAqCvE,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC1C,MAAMgC,IAAuC,SAAzB,CAAA,IAAAhC,EAAM+B,OAAAA,CAAQC,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI;gBACjD,OAAIhC,EAAMxS,KAAAA,GAAQ+T,GAAcY,iBAAAA,IAAqBnC,EAAMtS,MAAAA,GAAS6T,GAAcY,iBAAAA,GAChFZ,CAAAA,GAAcU,OAAAA,CAAQ3nB,KAAAA,CACpB,CAAA,WAAA,EAAc0nB,EAAAA,+EAAAA,EACRT,GAAcY,iBAAAA,CAAAA,CAAAA,EAAqBZ,GAAcY,iBAAAA,CAAAA,2OAAAA,CAAAA,GAAAA,CAIlD,CAAA,IAAA,CAAA,AACEnC,CAAAA,EAAMxS,KAAAA,GAAQ,QAAQwS,EAAMtS,MAAAA,GAAS,IAAA,KAE9C6T,GAAcU,OAAAA,CAAQvW,IAAAA,CACpB,CAAA,WAAA,EAAcsW,EAAAA,6UAAAA,CAAAA,GAAAA,CAMX,CAAA;YACT;QAAA;QA9Le,GAAAC,OAAAA,GAAUhY,EAAOS,WAAAA,IA4BlB,GAAAiY,SAAAA,GAA4B7B,GAAeI,OAAAA,EAC3C,GAAA0B,QAAAA,GAAmC;YAAEjjB,GAAGohB,GAAcK,KAAAA;YAAO3jB,GAAGsjB,GAAcK,KAAAA;QAAAA,GAM7E,GAAAe,iBAAAA,GAA4B;QCzBtC,MAAMsC,KAAgC;YAC3CC,WAAW;YACXC,WAAW;YACXC,WAAW;QAAA;QAGN,MAAMC;YASX,IAAA,QAAWrX;gBACT,OAAOna,IAAAA,CAAK2sB,KAAAA,CAAM8E,YACpB;YAAA;YAKA,IAAA,SAAWpX;gBACT,OAAOra,IAAAA,CAAK2sB,KAAAA,CAAM+E,aACpB;YAAA;YAOO,WAAA7H;gBAKL,OAJK7pB,IAAAA,CAAK2xB,IAAAA,IAER3xB,CAAAA,IAAAA,CAAK2xB,IAAAA,GAAO3xB,IAAAA,CAAKyB,IAAAA,CAAKmwB,GAAAA,AAAAA,GAAAA,CAAAA,CAEf5xB,IAAAA,CAAK2xB,IAChB;YAAA;YAMA,IAAA,QAAWhF;gBACT,OAAO3sB,IAAAA,CAAKyB,IACd;YAAA;YAuBA,YAAYowB,CAAAA,EAAsBC,CAAAA,EAA8DxC,CAAAA,CAAAA;gBA7DxF,IAAA,CAAAzC,OAAAA,GAAUjW,EAAOS,WAAAA,IAmClB,IAAA,CAAA5V,IAAAA,GAAyB,IAAIswB,OAK5B,IAAA,CAAAC,YAAAA,GAAe,IAAItrB,GAIpB,IAAA,CAAAwmB,KAAAA,GAAmCltB,IAAAA,CAAKgyB,YAAAA,CAAanrB,OAAAA,EAkB1D7G,IAAAA,CAAKypB,IAAAA,GAAOoI;gBACZ,IACItC,GADA5F,IAAAA,CAAiC;gBAEH,aAAA,OAAvBmI,IACTnI,IAAYmI,IAAAA,EAETxC,WAAAA,CAAAA,EAAWC,UAAAA,CAAAA,EAAU5F,WAAAA,CAAAA,EAAAA,GAAc;oBAAA,GAAKmI,CAAAA;gBAAAA,GAE7C9xB,IAAAA,CAAKiyB,SAAAA,GAAY,IAAIzI,GAASqI,GAAc,QAAQlI,IACpD3pB,IAAAA,CAAKsvB,SAAAA,GAAYA,QAAAA,IAAAA,IAAatvB,IAAAA,CAAKsvB,SAAAA,EAEjCtvB,IAAAA,CAAKuvB,QAAAA,GADiB,YAAA,OAAbA,IACO;oBACdjjB,GAAGijB;oBACHnlB,GAAGmlB;gBAAAA,IAGWA,QAAAA,IAAAA,IAAYvvB,IAAAA,CAAKuvB,QAAAA,EAE/BsC,EAAaK,QAAAA,CAAS,WACxBlyB,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,kEAAA,EAAqEwZ,EAAAA,2DAAAA,CAAAA;YAG3E;YAMA,OAAA,qBAA4BlF,CAAAA,EAAyB1T,CAAAA,EAAAA;gBACnD,MAAMmZ,IAAc,IAAIZ,GAAY;gBAWpC,IAVAY,EAAYT,IAAAA,GAAO,iBACnBS,EAAY3wB,IAAAA,GAAOkrB,GACnByF,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAa,qBAAqB,kBAAA,AAE/CpZ,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASqW,SAAAA,AAAAA,IACX8C,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BC,SAAAA,EAAWpY,QAAAA,IAAAA,KAAO,IAAPA,EAASqW,SAAAA,IAEhF8C,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BC,SAAAA,EAAW5D,GAAeI,OAAAA,GAGpF5U,QAAAA,IAAAA,KAAO,IAAPA,EAASsW,QAAAA,EAAU;oBACrB,IAAIA;oBAEFA,IAD8B,YAAA,OAArBtW,EAAQsW,QAAAA,GACN;wBACTjjB,GAAG2M,EAAQsW,QAAAA;wBACXnlB,GAAG6O,EAAQsW,QAAAA;oBAAAA,IAGF;wBACTjjB,GAAG2M,EAAQsW,QAAAA,CAASjjB,CAAAA;wBACpBlC,GAAG6O,EAAQsW,QAAAA,CAASnlB,CAAAA;oBAAAA,GAGxBgoB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BE,SAAAA,EAAW/B,EAASjjB,CAAAA,GAChF8lB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BG,SAAAA,EAAWhC,EAASnlB,CAAAA;gBAClF,OACEgoB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BE,SAAAA,EAAW5D,GAAcK,KAAAA,GACrFqE,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BG,SAAAA,EAAW7D,GAAcK,KAAAA;gBAKvF,OAFAG,GAAc+B,6BAAAA,CAA8BtD,IAC5CyF,EAAYJ,YAAAA,CAAaxtB,OAAAA,CAAQmoB,IAC1ByF;YACT;YAEA,OAAA,sBAA6BzF,CAAAA,EAA0B1T,CAAAA,EAAAA;gBACrD,MAAMmZ,IAAc,IAAIZ,GAAY;gBAUpC,IATAY,EAAYT,IAAAA,GAAO,uBACnBS,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAa,qBAAqB,wBAAA,AAE/CpZ,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASqW,SAAAA,AAAAA,IACX8C,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BC,SAAAA,EAAWpY,QAAAA,IAAAA,KAAO,IAAPA,EAASqW,SAAAA,IAEhF8C,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BC,SAAAA,EAAW5D,GAAeI,OAAAA,GAGpF5U,QAAAA,IAAAA,KAAO,IAAPA,EAASsW,QAAAA,EAAU;oBACrB,IAAIA;oBAEFA,IAD8B,YAAA,OAArBtW,EAAQsW,QAAAA,GACN;wBACTjjB,GAAG2M,EAAQsW,QAAAA;wBACXnlB,GAAG6O,EAAQsW,QAAAA;oBAAAA,IAGF;wBACTjjB,GAAG2M,EAAQsW,QAAAA,CAASjjB,CAAAA;wBACpBlC,GAAG6O,EAAQsW,QAAAA,CAASnlB,CAAAA;oBAAAA,GAGxBgoB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BE,SAAAA,EAAW/B,EAASjjB,CAAAA,GAChF8lB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BG,SAAAA,EAAWhC,EAASnlB,CAAAA;gBAClF,OACEgoB,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BE,SAAAA,EAAW5D,GAAcK,KAAAA,GACrFqE,EAAY3wB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BG,SAAAA,EAAW7D,GAAcK,KAAAA;gBAiBvF,OAdAG,GAAc+B,6BAAAA,CAA8BtD,IAE5CA,EAAM4F,MAAAA,CAAQC,CAAAA;oBAEZ,MAAMC,IAAMC,IAAIC,eAAAA,CAAgBH;oBAChCJ,EAAYzF,KAAAA,CAAMiG,MAAAA,GAAS;wBAEzBF,IAAIG,eAAAA,CAAgBJ,IACpBL,EAAY3wB,IAAAA,GAAO2wB,EAAYzF,KAAAA,EAC/ByF,EAAYJ,YAAAA,CAAaxtB,OAAAA,CAAQ4tB,EAAYzF,KAAAA;oBAAM,GAErDyF,EAAYzF,KAAAA,CAAMiF,GAAAA,GAAMa;gBAAG,IAGtBL;YACT;YAEA,OAAA,cAAqBW,CAAAA,EAAmB9Z,CAAAA,EAAAA;gBACtC,MAAMuZ,IAAO,IAAI/H,KAAK;oBAACsI;iBAAAA,EAAY;oBAAEtsB,MAAM;gBAAA,IACrCgsB,IAAMC,IAAIC,eAAAA,CAAgBH;gBAChC,OAAO,IAAIhB,GAAYiB,GAAKxZ;YAC9B;YAMA,IAAA,YAAW0Q;gBACT,OAAO3pB,IAAAA,CAAKiyB,SAAAA,CAAUtI,SACxB;YAAA;YAEA,IAAA,UAAqBld,CAAAA,EAAAA;gBACnBzM,IAAAA,CAAKiyB,SAAAA,CAAUtI,SAAAA,GAAYld;YAC7B;YAKA,MAAA,OAAMwd;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACJ,IAAIjqB,IAAAA,CAAK6pB,QAAAA,IACP,OAAO7pB,IAAAA,CAAKyB,IAAAA;gBAEd,IAAA;oBAEE,IAAIgxB;oBACJ,IAAKzyB,IAAAA,CAAKypB,IAAAA,CAAKxI,QAAAA,CAAS,gBAItBwR,IAAMzyB,IAAAA,CAAKypB,IAAAA;yBAJ2B;wBACtC,MAAM+I,IAAAA,MAAaxyB,IAAAA,CAAKiyB,SAAAA,CAAUhI,IAAAA;wBAClCwI,IAAMC,IAAIC,eAAAA,CAAgBH;oBAC5B;oBAKA,MAAM7F,IAAQ,IAAIoF,OAIZiB,IAAe,IAAItsB;oBACzBimB,EAAMiG,MAAAA,GAAS,IAAMI,EAAaxuB,OAAAA,IAClCmoB,EAAMiF,GAAAA,GAAMa,GACZ9F,EAAM0F,YAAAA,CAAa,qBAAqBryB,IAAAA,CAAKypB,IAAAA,GAAAA,MAEvCuJ,EAAansB,OAAAA,EAMnB7G,IAAAA,CAAKyB,IAAAA,GAAOkrB,GAGZuB,GAAc+B,6BAAAA,CAA8BjwB,IAAAA,CAAKyB,IAAAA;gBACnD,EAAE,OAAOwF,GAAAA;oBACP,MAAM,CAAA,qCAAA,EAAwCjH,IAAAA,CAAKypB,IAAAA,CAAAA,cAAAA,EAAqBxiB,EAAM0T,OAAAA,CAAAA,CAAAA,CAChF;gBAAA;gBAQA,OANA3a,IAAAA,CAAKyB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BC,SAAAA,EAAWrxB,IAAAA,CAAKsvB,SAAAA,GACrEtvB,IAAAA,CAAKyB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BE,SAAAA,EAA2B,SAAhB,CAAA,IAAa,SAAb,CAAA,IAAAtxB,IAAAA,CAAKuvB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEjjB,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAIohB,GAAcK,KAAAA,GAClG/tB,IAAAA,CAAKyB,IAAAA,CAAK4wB,YAAAA,CAAajB,GAA8BG,SAAAA,EAA2B,SAAhB,CAAA,IAAa,SAAb,CAAA,IAAAvxB,IAAAA,CAAKuvB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEnlB,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAIsjB,GAAcK,KAAAA,GAGlG/tB,IAAAA,CAAKgyB,YAAAA,CAAaxtB,OAAAA,CAAQxE,IAAAA,CAAKyB,IAAAA,GACxBzB,IAAAA,CAAKyB,IACd;YAAA;YAKO,SAASwX,CAAAA,EAAAA;gBACd,OAAOyT,GAAOnf,IAAAA,CAAKvN,IAAAA,EAAMiZ;YAC3B;YAKA,SAAAia;gBACElzB,IAAAA,CAAKyB,IAAAA,GAAO,IAAIswB;YAClB;QAAA;QCvPK,MAAMoB,WAAmBhI;YAY9B,YAAYlS,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM3T,IAZA,IAAA,CAAAma,KAAAA,GAAgB,IACjB,IAAA,CAAAC,QAAAA,GAAmB,IAGnB,IAAA,CAAAC,MAAAA,GAAAA,KAA8BxyB,GAC9B,IAAA,CAAAyyB,eAAAA,GAAAA,CAAkB,GAClB,IAAA,CAAAC,OAAAA,GAAkB,GAClB,IAAA,CAAAC,UAAAA,GAAAA,KAAiC3yB,GAEhC,IAAA,CAAA+rB,OAAAA,GAAUjW,EAAOS,WAAAA;gBAIvB,MAAA,EAAM,UAAEgc,CAAAA,EAAQ,aAAEK,CAAAA,EAAW,iBAAEH,CAAAA,EAAe,SAAEC,CAAAA,EAAO,QAAEF,CAAAA,EAAM,YAAEG,CAAAA,EAAAA,GAAexa;gBAChFjZ,IAAAA,CAAKqzB,QAAAA,GAAWA,GAChBrzB,IAAAA,CAAK0zB,WAAAA,GAAcA,GACnB1zB,IAAAA,CAAKuzB,eAAAA,GAAkBA,QAAAA,IAAAA,IAAmBvzB,IAAAA,CAAKuzB,eAAAA,EAC/CvzB,IAAAA,CAAKwzB,OAAAA,GAAUA,QAAAA,IAAAA,IAAWxzB,IAAAA,CAAKwzB,OAAAA,EAC/BxzB,IAAAA,CAAKszB,MAAAA,GAASA,QAAAA,IAAAA,IAAUtzB,IAAAA,CAAKszB,MAAAA,EAC7BtzB,IAAAA,CAAKyzB,UAAAA,GAAaA,QAAAA,IAAAA,IAAczzB,IAAAA,CAAKyzB,UACvC;YAAA;YAEQ,qBAAqBG,CAAAA,EAAAA;gBAC3B,MAAMC,IAAoB,EAAA,EAEpBC,IAAe9zB,IAAAA,CAAKuzB,eAAAA,GAAkBK,EAAKG,iBAAAA,KAAsBH,GACjEP,IAAWrzB,IAAAA,CAAKuzB,eAAAA,GAAkBvzB,IAAAA,CAAKqzB,QAAAA,CAASU,iBAAAA,KAAsB/zB,IAAAA,CAAKqzB,QAAAA;gBAGjF,IAAK,IAAIW,IAAc,GAAGA,IAAcF,EAAaxzB,MAAAA,EAAQ0zB,IAAe;oBAE1E,MAAMC,IAASH,CAAAA,CAAaE,EAAAA;oBAC5B,IAAIE,IAAcb,EAAS5qB,OAAAA,CAAQwrB;oBAAAA,OAC/BC,KACFA,CAAAA,IAAc,GACdl0B,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,CAAA,iCAAA,EAAoC0b,EAAAA,0BAAAA,EAAmCZ,EAAAA,EAAAA,CAAAA,GAC7FrzB,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,qGAAA;oBAGxB,MAAM4b,IAAen0B,IAAAA,CAAK0zB,WAAAA,CAAYU,OAAAA,CAAQF,EAAAA;oBAC1CC,IACFN,EAAQl0B,IAAAA,CAAKw0B,KAEbn0B,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,CAAA,qCAAA,EAAwC0b,EAAAA,YAAAA,EAAqBC,EAAAA,2BAAAA,CAAAA,GACnFl0B,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,qGAAA;gBAE1B;gBACA,OAAOsb;YACT;YAEO,YAAYD,CAAAA,EAAcU,CAAAA,EAAAA;gBAC/B,MAAMC,IAAQv0B,IAAAA,CAAKw0B,iBAAAA,CAAkBZ,GAAMU,IACrCG,IAAeF,EAAMG,MAAAA,CAAO,CAACtyB,GAAGkQ,IAC7BlQ,EAAE9B,MAAAA,GAASgS,EAAEhS,MAAAA,GAAS8B,IAAIkQ,IAE7B8hB,IAAUp0B,IAAAA,CAAK2zB,oBAAAA,CAAqBc;gBAC1C,IAAIta,IAAQ,GACRE,IAAS;gBACb,KAAK,MAAMsa,KAAUP,EACnBja,KAASwa,EAAOxa,KAAAA,GAAQna,IAAAA,CAAKwzB,OAAAA,EAC7BnZ,IAAS/U,KAAKC,GAAAA,CAAI8U,GAAQsa,EAAOta,MAAAA;gBAEnC,OAAOiB,EAAYc,aAAAA,CAAcjC,IAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAG+N,IAASka,EAAMj0B,MAAAA,GAASN,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,EAAG0D,EAAOC,IAAAA;YACtG;YAEU,WAAW+R,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAWkqB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACvE,IAAIM,IAAU,GACVC,IAAU,GACVxa,IAAS;gBACb,MAAMka,IAAQv0B,IAAAA,CAAKw0B,iBAAAA,CAAkBx0B,IAAAA,CAAKozB,KAAAA,EAAOkB;gBACjD,KAAK,MAAMQ,KAAQP,EAAO;oBACxB,KAAK,MAAMI,KAAU30B,IAAAA,CAAK2zB,oBAAAA,CAAqBmB,GAE7CH,EAAO9U,IAAAA,CAAKC,GAAIxT,IAAIsoB,GAASxqB,IAAIyqB,IACjCD,KAAWD,EAAOxa,KAAAA,GAAQna,IAAAA,CAAKwzB,OAAAA,EAC/BnZ,IAAS/U,KAAKC,GAAAA,CAAI8U,GAAQsa,EAAOta,MAAAA;oBAEnCua,IAAU,GACVC,KAA0B,SAAf,CAAA,IAAA70B,IAAAA,CAAKyzB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAIpZ;gBAChC;YACF;YAEA,OAAOyF,CAAAA,EAA8B8T,CAAAA,EAAcxa,CAAAA,EAAa9M,CAAAA,EAAWlC,CAAAA,EAAWkqB,CAAAA,EAAAA;gBAEpFt0B,IAAAA,CAAKozB,KAAAA,GAAQQ;gBACb,MAAMoB,IAASh1B,IAAAA,CAAKq0B,WAAAA,CAAYT,GAAMU;gBACtCt0B,IAAAA,CAAKma,KAAAA,GAAQ6a,EAAO7a,KAAAA,EACpBna,IAAAA,CAAKqa,MAAAA,GAAS2a,EAAO3a,MAAAA,EACjBra,IAAAA,CAAKszB,MAAAA,IACPxT,CAAAA,EAAGyI,IAAAA,IACHzI,EAAGnD,SAAAA,CAAU3c,IAAAA,CAAKszB,MAAAA,CAAO2B,MAAAA,CAAO3oB,CAAAA,EAAGtM,IAAAA,CAAKszB,MAAAA,CAAO2B,MAAAA,CAAO7qB,CAAAA,GACtDpK,IAAAA,CAAKmsB,QAAAA,CAASrM,GAAIxT,GAAGlC,IACrBpK,IAAAA,CAAKosB,UAAAA,CAAWtM,GAAI,GAAG,GAAGwU,IAC1Bt0B,IAAAA,CAAKqsB,SAAAA,CAAUvM,IACfA,EAAG0I,OAAAA,EAAAA,GAGLxoB,IAAAA,CAAKmsB,QAAAA,CAASrM,GAAIxT,GAAGlC,IACrBpK,IAAAA,CAAKosB,UAAAA,CAAWtM,GAAI,GAAG,GAAGwU,IAC1Bt0B,IAAAA,CAAKqsB,SAAAA,CAAUvM;YACjB;YAEA,QAAA7N;gBACE,OAAO,IAAIkhB,GAAW;oBACpBE,UAAUrzB,IAAAA,CAAKqzB,QAAAA;oBACfK,aAAa1zB,IAAAA,CAAK0zB,WAAAA;oBAClBF,SAASxzB,IAAAA,CAAKwzB,OAAAA;gBAAAA;YAElB;YAUQ,kBAAkBI,CAAAA,EAAcU,CAAAA,EAAAA;gBAAAA,IAAAA;gBACtC,IAAIt0B,IAAAA,CAAKk1B,WAAAA,KAAgBtB,KAAQ5zB,IAAAA,CAAKm1B,kBAAAA,KAAuBb,KAA6B,CAAA,SAAjB,CAAA,IAAAt0B,IAAAA,CAAKo1B,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,KAAA,IAAA,EAAE90B,MAAAA,AAAAA,GAC1F,OAAON,IAAAA,CAAKo1B,YAAAA;gBAGd,MAAMb,IAAQX,EAAKyB,KAAAA,CAAM;gBAEzB,IAAgB,QAAZf,GACF,OAAOC;gBAIT,IAAK,IAAI/zB,IAAI,GAAGA,IAAI+zB,EAAMj0B,MAAAA,EAAQE,IAAK;oBACrC,IAAIs0B,IAAOP,CAAAA,CAAM/zB,EAAAA,EACb80B,IAAU;oBAEd,IAAIt1B,IAAAA,CAAKq0B,WAAAA,CAAYS,GAAM3a,KAAAA,GAAQma,GAAU;wBAC3C,MAAOt0B,IAAAA,CAAKq0B,WAAAA,CAAYS,GAAM3a,KAAAA,GAAQma,GACpCgB,IAAUR,CAAAA,CAAKA,EAAKx0B,MAAAA,GAAS,EAAA,GAAKg1B,GAClCR,IAAOA,EAAKvpB,KAAAA,CAAM,GAAA;wBAIpBgpB,CAAAA,CAAM/zB,EAAAA,GAAKs0B,GACXP,CAAAA,CAAM/zB,IAAI,EAAA,GAAK80B;oBACjB;gBACF;gBAMA,OAJAt1B,IAAAA,CAAKk1B,WAAAA,GAActB,GACnB5zB,IAAAA,CAAKo1B,YAAAA,GAAeb,GACpBv0B,IAAAA,CAAKm1B,kBAAAA,GAAqBb,GAEnBC;YACT;QAAA;QC9JK,MAAMgB,WAAoB7I;YAI/B,YAAYzT,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM;oBACJD,OAAO1T,EAAQ0T,KAAAA;oBACfI,YAAY9T,EAAQ8T,UAAAA;oBACpBC,UAAU;wBAAE7S,OAAOlB,EAAQkB,KAAAA;wBAAOE,QAAQpB,EAAQoB,MAAAA;oBAAAA;oBAClDiR,gBAAgBrS,EAAQqS,cAAAA;oBACxBE,cAAcvS,EAAQuS,YAAAA;oBACtB7I,UAAU1J,EAAQ0J,QAAAA;oBAClB1S,OAAOgJ,EAAQhJ,KAAAA;oBACf2Y,SAAS3P,EAAQ2P,OAAAA;oBACjBE,MAAM7P,EAAQ6P,IAAAA;oBACd6C,QAAQ1S,EAAQ0S,MAAAA;gBAAAA,IAdZ,IAAA,CAAA6J,MAAAA,GAAS,IAAI9uB,GACd,IAAA,CAAAwmB,KAAAA,GAAQltB,IAAAA,CAAKw1B,MAAAA,CAAO3uB,OAAAA,EAezB7G,IAAAA,CAAKqZ,QAAAA,GAAWJ,GAEZjZ,IAAAA,CAAK2sB,KAAAA,CAAM9C,QAAAA,KACb7pB,IAAAA,CAAKy1B,YAAAA,KAELz1B,IAAAA,CAAK2sB,KAAAA,CAAMO,KAAAA,CAAMC,IAAAA,CAAK,IAAMntB,IAAAA,CAAKy1B,YAAAA;YAErC;YAEO,OAAA,WAAkBd,CAAAA,EAAgB1b,CAAAA,EAAAA;gBACvC,OAAO,IAAIsc,GAAY;oBACrBxI,YAAY;wBAAA,GAAK4H,EAAO5H,UAAAA;oBAAAA;oBACxB5S,OAAOwa,EAAOxa,KAAAA;oBACdE,QAAQsa,EAAOta,MAAAA;oBAAAA,GACZpB,CAAAA;oBACH0T,OAAOgI,EAAOhI,KAAAA;gBAAAA;YAElB;YAEQ,eAAA8I;gBACN,MAAA,EAAM,OAAEtb,CAAAA,EAAK,QAAEE,CAAAA,EAAM,WAAEiV,CAAAA,EAAS,UAAEC,CAAAA,EAAAA,GAAa;oBAAA,GAAKvvB,IAAAA,CAAKqZ,QAAAA;gBAAAA,GACnDsc,IAAepc,SAASC,aAAAA,CAAc;gBAC5Cmc,EAAaxb,KAAAA,GAAQna,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,EACrCwb,EAAatb,MAAAA,GAASra,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA;gBACpBsb,EAAajc,UAAAA,CAAW,MAEhC8T,SAAAA,CACNxtB,IAAAA,CAAK2sB,KAAAA,CAAMA,KAAAA,EACX3sB,IAAAA,CAAK+sB,UAAAA,CAAWzgB,CAAAA,EAAGtM,IAAAA,CAAK+sB,UAAAA,CAAW3iB,CAAAA,EACnCpK,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,EAAOna,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA,EACvC,GAAG,GACHra,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,EAAOna,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA;gBAG3C,MAAMub,IAAmBpE,GAAYc,qBAAAA,CAAsBqD,GAAc;oBACrEpG,UAAUA,QAAAA,IAAAA,IAAY7B,GAAcM,MAAAA;oBACpCsB,WAAAA;gBAAAA;gBAEAnV,KACFna,CAAAA,IAAAA,CAAKgtB,QAAAA,CAAS7S,KAAAA,GAAQA,GACtBna,IAAAA,CAAK+sB,UAAAA,CAAW5S,KAAAA,GAAQA,CAAAA,GAEtBE,KACFra,CAAAA,IAAAA,CAAKgtB,QAAAA,CAAS3S,MAAAA,GAASA,GACvBra,IAAAA,CAAK+sB,UAAAA,CAAW1S,MAAAA,GAASA,CAAAA,GAE3Bra,IAAAA,CAAK+sB,UAAAA,CAAWzgB,CAAAA,GAAI,GACpBtM,IAAAA,CAAK+sB,UAAAA,CAAW3iB,CAAAA,GAAI,GACpBpK,IAAAA,CAAK2sB,KAAAA,GAAQiJ,GAEb51B,IAAAA,CAAK2sB,KAAAA,CAAMO,KAAAA,CAAMC,IAAAA,CAAK,IAAMntB,IAAAA,CAAKw1B,MAAAA,CAAOhxB,OAAAA;YAC1C;QAAA;QCVK,MAAMqxB;YAWX,YAAY5c,CAAAA,CAAAA;gBAVI,IAAA,CAAAmb,OAAAA,GAAoB,EAAA;gBAWlC,MAAA,EAAM,SAAEA,CAAAA,EAAO,MAAE0B,CAAAA,EAAI,SAAEC,CAAAA,EAAAA,GAAY9c;gBACnCjZ,IAAAA,CAAKo0B,OAAAA,GAAUA,GACfp0B,IAAAA,CAAK81B,IAAAA,GAAOA,QAAAA,IAAAA,IAAQ,GACpB91B,IAAAA,CAAK+1B,OAAAA,GAAUA,QAAAA,IAAAA,IAAW/1B,IAAAA,CAAKo0B,OAAAA,CAAQ9zB,MACzC;YAAA;YAQO,UAAUgM,CAAAA,EAAWlC,CAAAA,EAAW6O,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACrC,IAAI3M,KAAKtM,IAAAA,CAAK+1B,OAAAA,IAAWzpB,IAAI,GAC3B,MAAMnG,MAAM,CAAA,wCAAA,EAA2CmG,EAAAA,EAAAA,EAAMlC,EAAAA,MAAAA,EAAUkC,EAAAA,yBAAAA,EAA6BtM,IAAAA,CAAK+1B,OAAAA,GAAU,EAAA,QAAA,CAAA;gBAErH,IAAI3rB,KAAKpK,IAAAA,CAAK81B,IAAAA,IAAQ1rB,IAAI,GACxB,MAAMjE,MAAM,CAAA,wCAAA,EAA2CmG,EAAAA,EAAAA,EAAMlC,EAAAA,MAAAA,EAAUA,EAAAA,yBAAAA,EAA6BpK,IAAAA,CAAK81B,IAAAA,GAAO,EAAA,KAAA,CAAA;gBAElH,MAAM5B,IAAc5nB,IAAIlC,IAAIpK,IAAAA,CAAK+1B,OAAAA,EAC3BpB,IAAS30B,IAAAA,CAAKo0B,OAAAA,CAAQF,EAAAA;gBAC5B,IAAIS,GAAQ;oBACV,IAAI1b,GAAS;wBACX,MAAMgd,IAAoBtB,EAAO1iB,KAAAA;wBAUjC,OATAgkB,EAAkB3K,cAAAA,GAAuC,SAAtB,CAAA,IAAArS,EAAQqS,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAI2K,EAAkB3K,cAAAA,EAC/E2K,EAAkBzK,YAAAA,GAAmC,SAApB,CAAA,IAAAvS,EAAQuS,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAIyK,EAAkBzK,YAAAA,EAC3EyK,EAAkB9b,KAAAA,GAAqB,SAAb,CAAA,IAAAlB,EAAQkB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI8b,EAAkB9b,KAAAA,EAC7D8b,EAAkB5b,MAAAA,GAAuB,SAAd,CAAA,IAAApB,EAAQoB,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI4b,EAAkB5b,MAAAA,EAC/D4b,EAAkBtT,QAAAA,GAA2B,SAAhB,CAAA,IAAA1J,EAAQ0J,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAIsT,EAAkBtT,QAAAA,EACnEsT,EAAkBhmB,KAAAA,GAAqB,SAAb,CAAA,IAAAgJ,EAAQhJ,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIgmB,EAAkBhmB,KAAAA,EAC7DgmB,EAAkBrN,OAAAA,GAAyB,SAAf,CAAA,IAAA3P,EAAQ2P,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIqN,EAAkBrN,OAAAA,EACjEqN,EAAkBnN,IAAAA,GAAmB,SAAZ,CAAA,IAAA7P,EAAQ6P,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAImN,EAAkBnN,IAAAA,EAC3DmN,EAAkBtK,MAAAA,GAAuB,SAAd,CAAA,IAAA1S,EAAQ0S,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIsK,EAAkBtK,MAAAA,EACxDsK;oBACT;oBACA,OAAOtB;gBACT;gBACA,MAAMxuB,MAAM,CAAA,4BAAA,EAA+BmG,EAAAA,EAAAA,EAAMlC,EAAAA,CAAAA,CAAAA;YACnD;YAuBO,eAAekC,CAAAA,EAAWlC,CAAAA,EAAW6O,CAAAA,EAAAA;gBAC1C,IAAI3M,KAAKtM,IAAAA,CAAK+1B,OAAAA,IAAWzpB,IAAI,GAC3B,MAAMnG,MAAM,CAAA,wCAAA,EAA2CmG,EAAAA,EAAAA,EAAMlC,EAAAA,MAAAA,EAAUkC,EAAAA,yBAAAA,EAA6BtM,IAAAA,CAAK+1B,OAAAA,GAAU,EAAA,QAAA,CAAA;gBAErH,IAAI3rB,KAAKpK,IAAAA,CAAK81B,IAAAA,IAAQ1rB,IAAI,GACxB,MAAMjE,MAAM,CAAA,wCAAA,EAA2CmG,EAAAA,EAAAA,EAAMlC,EAAAA,MAAAA,EAAUA,EAAAA,yBAAAA,EAA6BpK,IAAAA,CAAK81B,IAAAA,GAAO,EAAA,KAAA,CAAA;gBAElH,MAAM5B,IAAc5nB,IAAIlC,IAAIpK,IAAAA,CAAK+1B,OAAAA,EAC3BpB,IAAS30B,IAAAA,CAAKo0B,OAAAA,CAAQF,EAAAA;gBAC5B,IAAIS,GACF,OAAOY,GAAYG,UAAAA,CAAWf,GAAQ1b;gBAExC,MAAM9S,MAAM,CAAA,4BAAA,EAA+BmG,EAAAA,EAAAA,EAAMlC,EAAAA,CAAAA,CAAAA;YACnD;YAMO,OAAA,+BAAsC6O,CAAAA,EAAAA;gBAC3C,MAAMmb,IAAoBnb,EAAQmd,WAAAA,CAAYn2B,GAAAA,CAAK8sB,CAAAA,IAC1C,IAAIL,GAAO;wBAChBC,OAAO1T,EAAQ0T,KAAAA;wBACfI,YAAAA;oBAAAA;gBAGJ,OAAO,IAAI8I,GAAY;oBAAEzB,SAAAA;gBAAAA;YAC3B;YAgCO,OAAA,gBAAuBnb,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC5B,MAAMmb,IAAoB,EAAA;gBAC1Bnb,EAAQua,OAAAA,GAAyB,SAAf,CAAA,IAAAva,EAAQua,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,CAAC;gBACtC,MAAA,EAAM,OACJ7G,CAAAA,EACA2J,MAAAA,EAAM,MAAER,CAAAA,EAAMC,SAASQ,CAAAA,EAAI,aAAEC,CAAAA,EAAW,cAAEC,CAAAA,EAAAA,EAC1CjD,SAAAA,EAAS,cAAEkD,CAAAA,EAAY,QAAEC,CAAAA,EAAAA,EAAAA,GACvB1d,GACE2d,IAAiB;oBAAEtqB,GAAG;oBAAGlC,GAAG;oBAAA,GAAMssB,CAAAA;gBAAAA,GAClCG,IAAiB;oBAAEvqB,GAAG;oBAAGlC,GAAG;oBAAA,GAAMusB,CAAAA;gBAAAA;gBACxC,IAAK,IAAIrqB,IAAI,GAAGA,IAAIiqB,GAAMjqB,IACxB,IAAK,IAAIlC,IAAI,GAAGA,IAAI0rB,GAAM1rB,IACxBgqB,CAAAA,CAAQ9nB,IAAIlC,IAAImsB,EAAAA,GAAQ,IAAI7J,GAAO;oBACjCC,OAAOA;oBACPI,YAAY;wBACVzgB,GAAGA,IAAIkqB,IAAcK,EAAevqB,CAAAA,GAAIA,IAAIsqB,EAAetqB,CAAAA;wBAC3DlC,GAAGA,IAAIqsB,IAAeI,EAAezsB,CAAAA,GAAIA,IAAIwsB,EAAexsB,CAAAA;wBAC5D+P,OAAOqc;wBACPnc,QAAQoc;oBAAAA;oBAEVzJ,UAAU;wBAAE3S,QAAQoc;wBAActc,OAAOqc;oBAAAA;gBAAAA;gBAI/C,OAAO,IAAIX,GAAY;oBACrBzB,SAASA;oBACT0B,MAAMA;oBACNC,SAASQ;gBAAAA;YAEb;YAEO,QAAAtkB;gBACL,OAAO,IAAI4jB,GAAY;oBACrBzB,SAASp0B,IAAAA,CAAKo0B,OAAAA,CAAQn0B,GAAAA,CAAK00B,CAAAA,IAAWA,EAAO1iB,KAAAA;oBAC7C6jB,MAAM91B,IAAAA,CAAK81B,IAAAA;oBACXC,SAAS/1B,IAAAA,CAAK+1B,OAAAA;gBAAAA;YAElB;QAAA;QCxPK,MAAMe;YACX,aAAAnwB;gBASgB,IAAA,CAAAowB,SAAAA,GCpBlB,suEDqBS,IAAA,CAAAjnB,IAAAA,GAAe,IAPpB9P,IAAAA,CAAKiqB,IAAAA;YACP;YAUO,OAAAA;gBAEL,OADAjqB,IAAAA,CAAKg3B,YAAAA,GAAe,IAAIxF,GAAYxxB,IAAAA,CAAK+2B,SAAAA,GAClC/2B,IAAAA,CAAKg3B,YAAAA,CAAa/M,IAAAA,GAAOkD,IAAAA,CAAK;oBACnCntB,IAAAA,CAAKi3B,YAAAA,GAAepB,GAAYQ,eAAAA,CAAgB;wBAC9C1J,OAAO3sB,IAAAA,CAAKg3B,YAAAA;wBACZV,MAAM;4BACJR,MAAM;4BACNC,SAAS;4BACTS,aAAa;4BACbC,cAAc;wBAAA;oBAAA,IAGlBz2B,IAAAA,CAAKk3B,WAAAA,GAAc,IAAI/D,GAAW;wBAChCE,UAAU;wBACVE,iBAAAA,CAAiB;wBACjBG,aAAa1zB,IAAAA,CAAKi3B,YAAAA;wBAClBzD,SAAAA;oBAAU;gBACV;YAEN;YAQO,MAAM4D,CAAAA,EAA+BxD,CAAAA,EAAc/Y,CAAAA,EAAAA;gBACpD7a,IAAAA,CAAKg3B,YAAAA,CAAanN,QAAAA,MACpB7pB,IAAAA,CAAKk3B,WAAAA,CAAYnC,MAAAA,CAAOqC,GAAKxD,GAAM,MAAM/Y,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA;YAExD;QAAA;QExDK,MAAMitB;YACX,YACU7I,CAAAA,EACA8I,CAAAA,CAAAA;gBADA,IAAA,CAAA9I,GAAAA,GAAAA,GACA,IAAA,CAAA8I,QAAAA,GAAAA;YACP;YAEI,MAAAC;gBACL,MAAMpJ,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GACpBtJ,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAKs3B,QAAAA;YACrC;YAEO,UAAAlxB;gBACL,MAAM+nB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY;YAChC;QAAA;QCeK,MAAM+H;YAQX,YAAYze,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBAJZ,IAAA,CAAA0e,SAAAA,GAAAA,CAAqB,GACrB,IAAA,CAAAC,OAAAA,GAAkB,GAIhB53B,IAAAA,CAAKwuB,GAAAA,GAAMvV,EAAQkV,EAAAA,EACnBnuB,IAAAA,CAAKma,KAAAA,GAAQlB,EAAQkB,KAAAA,EACrBna,IAAAA,CAAKqa,MAAAA,GAASpB,EAAQoB,MAAAA,EACtBra,IAAAA,CAAK63B,YAAAA,GAAe5e,EAAQ4e,YAAAA,EAC5B73B,IAAAA,CAAK23B,SAAAA,GAA6B,SAAjB,CAAA,IAAA1e,EAAQ0e,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI33B,IAAAA,CAAK23B,SAAAA,EAC3C33B,IAAAA,CAAK43B,OAAAA,GAAyB,SAAf,CAAA,IAAA3e,EAAQ2e,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI53B,IAAAA,CAAKwuB,GAAAA,CAAIO,YAAAA,CAAa/uB,IAAAA,CAAKwuB,GAAAA,CAAIsJ,WAAAA;gBAEjE,MAAM3J,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEZL,EAAG4J,mBAAAA,GACL/3B,IAAAA,CAAKg4B,YAAAA,GAAe7J,EAAG4J,mBAAAA,GAInB/3B,IAAAA,CAAK63B,YAAAA,GACP73B,IAAAA,CAAKg4B,YAAAA,GAAe7J,EAAG8J,KAAAA,GAEvBj4B,IAAAA,CAAKg4B,YAAAA,GAAe7J,EAAG+J,IAAAA,EAI3Bl4B,IAAAA,CAAKm4B,kBAAAA,IACLn4B,IAAAA,CAAKo4B,iBAAAA;YACP;YAEA,cAAcje,CAAAA,EAAeE,CAAAA,EAAAA;gBAC3B,MAAM8T,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAKma,KAAAA,GAAQA,GACbna,IAAAA,CAAKqa,MAAAA,GAASA,GAGd8T,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAKs4B,aAAAA,GACnCnK,EAAGyB,UAAAA,CAAWzB,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM7vB,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG8T,EAAG0B,IAAAA,EAAM1B,EAAG2B,aAAAA,EAAe,OAG5F9vB,IAAAA,CAAKu4B,aAAAA,IACPpK,CAAAA,EAAGqK,gBAAAA,CAAiBrK,EAAGsK,YAAAA,EAAcz4B,IAAAA,CAAKu4B,aAAAA,GAC1CpK,EAAGuK,8BAAAA,CACDvK,EAAGsK,YAAAA,EACHnzB,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAK43B,OAAAA,EAASzJ,EAAGY,YAAAA,CAAaZ,EAAG2J,WAAAA,IAC1C93B,IAAAA,CAAKg4B,YAAAA,EACLh4B,IAAAA,CAAKma,KAAAA,EACLna,IAAAA,CAAKqa,MAAAA,CAAAA;YAGX;YAGA,IAAA,eAAWse;gBACT,OAAO34B,IAAAA,CAAKu4B,aACd;YAAA;YAEA,IAAA,oBAAWK;gBACT,OAAO54B,IAAAA,CAAK64B,kBACd;YAAA;YAGA,IAAA,cAAWC;gBACT,OAAO94B,IAAAA,CAAK+4B,YACd;YAAA;YAEA,IAAA,eAAWC;gBACT,OAAOh5B,IAAAA,CAAKs4B,aACd;YAAA;YAEQ,qBAAAH;gBACN,IAAIn4B,IAAAA,CAAK23B,SAAAA,EAAW;oBAClB,MAAMxJ,IAAKnuB,IAAAA,CAAKwuB,GAAAA;oBAEhBxuB,IAAAA,CAAKu4B,aAAAA,GAAgBpK,EAAG8K,kBAAAA,IACxBj5B,IAAAA,CAAK64B,kBAAAA,GAAqB1K,EAAG+K,iBAAAA,IAC7B/K,EAAGqK,gBAAAA,CAAiBrK,EAAGsK,YAAAA,EAAcz4B,IAAAA,CAAKu4B,aAAAA,GAC1CpK,EAAGuK,8BAAAA,CACDvK,EAAGsK,YAAAA,EACHnzB,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAK43B,OAAAA,EAASzJ,EAAGY,YAAAA,CAAaZ,EAAG2J,WAAAA,IAC1C93B,IAAAA,CAAKg4B,YAAAA,EACLh4B,IAAAA,CAAKma,KAAAA,EACLna,IAAAA,CAAKqa,MAAAA,GAEP8T,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAap5B,IAAAA,CAAK64B,kBAAAA,GACxC1K,EAAGkL,uBAAAA,CAAwBlL,EAAGiL,WAAAA,EAAajL,EAAGmL,iBAAAA,EAAmBnL,EAAGsK,YAAAA,EAAcz4B,IAAAA,CAAKu4B,aAAAA;gBACzF;YACF;YAEQ,oBAAAH;gBAEN,MAAMjK,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAKs4B,aAAAA,GAAgBnK,EAAG6B,aAAAA,IACxB7B,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAKs4B,aAAAA,GACnCnK,EAAGyB,UAAAA,CAAWzB,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM7vB,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG8T,EAAG0B,IAAAA,EAAM1B,EAAG2B,aAAAA,EAAe,OAGhG3B,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG0C,kBAAAA,EAAoB1C,EAAG2C,OAAAA,GAC1D3C,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG6C,kBAAAA,EAAoB7C,EAAG2C,OAAAA,GAC1D3C,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGqC,aAAAA,GACtDrC,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGqC,aAAAA;gBAGtD,MAAM+I,IAAkBpL,EAAGmL,iBAAAA;gBAG3Bt5B,IAAAA,CAAK+4B,YAAAA,GAAe5K,EAAG+K,iBAAAA,IACvB/K,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAap5B,IAAAA,CAAK+4B,YAAAA,GACxC5K,EAAGqL,oBAAAA,CAAqBrL,EAAGiL,WAAAA,EAAaG,GAAiBpL,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAKs4B,aAAAA,EAAe,IAG5Ft4B,IAAAA,CAAKoG,OAAAA;YACP;YAEO,iBAAAqzB;gBACDz5B,IAAAA,CAAK24B,YAAAA,IACP34B,IAAAA,CAAK05B,6BAAAA;gBAGP,OADe,IAAIrC,GAAar3B,IAAAA,CAAKwuB,GAAAA,EAAKxuB,IAAAA,CAAKs4B,aAAAA;YAEjD;YAEO,eAAAqB;gBACL,MAAMxL,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEZxuB,IAAAA,CAAKu4B,aAAAA,GACPpK,CAAAA,EAAGgL,eAAAA,CAAgBhL,EAAGyL,gBAAAA,EAAkB55B,IAAAA,CAAK44B,iBAAAA,GAC7CzK,EAAGgL,eAAAA,CAAgBhL,EAAG0L,gBAAAA,EAAkB,OACxC1L,EAAG2L,aAAAA,CAAc3L,EAAG4L,KAAAA,EAAO,GAAG;oBAAC;oBAAK;oBAAK;oBAAK;iBAAA,GAC9C5L,EAAG6L,eAAAA,CAAgB,GAAG,GAAGh6B,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG,GAAGra,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ8T,EAAG8L,gBAAAA,EAAkB9L,EAAG4C,MAAAA,CAAAA,IAEzG5C,CAAAA,EAAGgL,eAAAA,CAAgBhL,EAAGyL,gBAAAA,EAAkB55B,IAAAA,CAAK84B,WAAAA,GAC7C3K,EAAGgL,eAAAA,CAAgBhL,EAAG0L,gBAAAA,EAAkB,OACxC1L,EAAG2L,aAAAA,CAAc3L,EAAG4L,KAAAA,EAAO,GAAG;oBAAC;oBAAK;oBAAK;oBAAK;iBAAA,GAC9C5L,EAAG6L,eAAAA,CAAgB,GAAG,GAAGh6B,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG,GAAGra,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ8T,EAAG8L,gBAAAA,EAAkB9L,EAAG4C,MAAAA,CAAAA;YAE7G;YAEO,gCAAA2I;gBACL,IAAI15B,IAAAA,CAAKu4B,aAAAA,EAAe;oBACtB,MAAMpK,IAAKnuB,IAAAA,CAAKwuB,GAAAA;oBAChBL,EAAGgL,eAAAA,CAAgBhL,EAAGyL,gBAAAA,EAAkB55B,IAAAA,CAAK44B,iBAAAA,GAC7CzK,EAAGgL,eAAAA,CAAgBhL,EAAG0L,gBAAAA,EAAkB75B,IAAAA,CAAK84B,WAAAA,GAC7C3K,EAAG2L,aAAAA,CAAc3L,EAAG4L,KAAAA,EAAO,GAAG;wBAAC;wBAAK;wBAAK;wBAAK;qBAAA,GAC9C5L,EAAG6L,eAAAA,CAAgB,GAAG,GAAGh6B,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG,GAAGra,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ8T,EAAG8L,gBAAAA,EAAkB9L,EAAG4C,MAAAA;gBAC3G;YACF;YAEO,cAAcG,CAAAA,EAAAA;gBACnB,MAAM/C,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBACZxuB,IAAAA,CAAKu4B,aAAAA,IACPv4B,IAAAA,CAAK05B,6BAAAA,IAEPvL,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAap5B,IAAAA,CAAK+4B,YAAAA,GACxC5K,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYuB,IAC9B/C,EAAGgM,cAAAA,CAAehM,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM,GAAG,GAAG7vB,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ;YAC9E;YAKO,MAAAkd;gBACL,MAAMpJ,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBACZxuB,IAAAA,CAAK23B,SAAAA,GACPxJ,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAap5B,IAAAA,CAAK64B,kBAAAA,IAExC1K,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAap5B,IAAAA,CAAK+4B,YAAAA,GAI1C5K,EAAGiM,QAAAA,CAAS,GAAG,GAAGp6B,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA;YACrC;YAKO,UAAAjU;gBACL,MAAM+nB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEhBL,EAAGgL,eAAAA,CAAgBhL,EAAGiL,WAAAA,EAAa,OACnCjL,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY;YAChC;QAAA;QClNK,SAAS0K,GAAmBlM,CAAAA,EAA2B1nB,CAAAA;YAC5D,OAAQA;gBACN,KAAK0nB,EAAGmM,GAAAA;gBACR,KAAKnM,EAAGoM,YAAAA;gBACR,KAAKpM,EAAGqM,KAAAA;oBACN,OAAO;gBACT,KAAKrM,EAAGsM,KAAAA;gBAER,KAAKtM,EAAGuM,cAAAA;oBACN,OAAO;gBACT,KAAKvM,EAAGwM,IAAAA;gBAER,KAAKxM,EAAG2B,aAAAA;gBAER;oBACE,OAAO;YAAA;QAEb;QAKO,SAAS8K,GAAoBrZ,CAAAA,EAAgBsZ,CAAAA;YAClD,MAEMC,IADQ,IAAIC,OADa,CAAA,sBAAA,EAAyBF,EAAAA,CAAAA,CAAAA,EACP,KAC3BG,IAAAA,CAAKzZ;YAC3B,OAAA,AAAOuZ,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASx6B,MAAAA,AAAAA,IAAU;QAC5B;QAQO,SAAS26B,GAAoB9M,CAAAA,EAA2B5M,CAAAA,EAAgBsZ,CAAAA;YAAAA,IAAAA;YAC7E,MAEMC,IADQ,IAAIC,OADa,CAAA,sBAAA,EAAyBF,EAAAA,CAAAA,CAAAA,EACP,KAC3BG,IAAAA,CAAKzZ;YAG3B,OAF4B,SAAf,CAAA,IAAAuZ,QAAAA,IAAAA,KAAO,IAAPA,EAASI,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEz0B,IAAAA;gBAG5B,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;gBAyBL;oBACE,OAAO0nB,EAAGqM,KAAAA;gBAxBZ,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;oBACH,OAAOrM,EAAGmM,GAAAA;gBACZ,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;oBACH,OAAOnM,EAAGoM,YAAAA;gBACZ,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;oBACH,OAAOpM,EAAGgN,IAAAA;gBACZ,KAAK;oBACH,OAAOhN,EAAGsM,KAAAA;gBACZ,KAAK;oBACH,OAAOtM,EAAGuM,cAAAA;gBACZ,KAAK;oBACH,OAAOvM,EAAG2B,aAAAA;gBACZ,KAAK;oBACH,OAAO3B,EAAGwM,IAAAA;YAAAA;QAIhB;QASO,SAASS,GAA0BjN,CAAAA,EAA2B1nB,CAAAA;YACnE,OAAQA;gBACN,KAAK0nB,EAAGkN,SAAAA;gBACR,KAAKlN,EAAGmN,UAAAA;gBACR,KAAKnN,EAAGqM,KAAAA;oBACN,OAAO;gBACT,KAAKrM,EAAGoN,UAAAA;oBACN,OAAO;gBACT,KAAKpN,EAAGqN,UAAAA;oBACN,OAAO;gBACT,KAAKrN,EAAGsN,UAAAA;oBACN,OAAO;gBACT,KAAKtN,EAAGwM,IAAAA;gBAER,KAAKxM,EAAG2B,aAAAA;gBAER,KAAK3B,EAAGuM,cAAAA;gBACR,KAAKvM,EAAGsM,KAAAA;gBAER;oBACE,OAAO;YAAA;QAEb;QAQO,SAASiB,GAAwBvN,CAAAA,EAA2B1nB,CAAAA;YACjE,OAAQA;gBACN,KAAK0nB,EAAGkN,SAAAA;gBACR,KAAKlN,EAAGmN,UAAAA;gBACR,KAAKnN,EAAGqM,KAAAA;gBACR,KAAKrM,EAAGoN,UAAAA;gBACR,KAAKpN,EAAGqN,UAAAA;gBACR,KAAKrN,EAAGsN,UAAAA;oBACN,OAAOtN,EAAGqM,KAAAA;gBACZ,KAAKrM,EAAGwM,IAAAA;oBACN,OAAOxM,EAAGwM,IAAAA;gBACZ,KAAKxM,EAAG2B,aAAAA;oBACN,OAAO3B,EAAG2B,aAAAA;gBACZ,KAAK3B,EAAGsM,KAAAA;oBACN,OAAOtM,EAAGsM,KAAAA;gBACZ,KAAKtM,EAAGuM,cAAAA;oBACN,OAAOvM,EAAGuM,cAAAA;gBACZ;oBACE,OAAOvM,EAAGqM,KAAAA;YAAAA;QAEhB;QAKO,SAASmB,GAAuBxN,CAAAA,EAA4ByN,CAAAA;YACjE,MAAMC,IAAsBD,CAAAA;gBAC1B,MAAME,IAAa;gBAOnB,IAAIC,IAAiB;gBACrB,IAAK,IAAIv7B,IAAI,GAAGA,IAAIo7B,GAAQp7B,IAExBu7B,KADQ,MAANv7B,IACgB,CAAA,aAAA,EAAgBA,EAAAA,OAAAA,CAAAA,GAEhB,CAAA,qBAAA,EAAwBA,EAAAA,OAAAA,CAAAA,EAG5Cu7B,KAAkB,kCAClBA,KAAkB;gBAEpB,OAAOD,EAAWE,OAAAA,CAAQ,kBAAkBD;YAAe;YAG7D,IAAIE,IAAAA,CAAa;YACjB,GAAG;gBACD,MAAMjS,IAAO6R,EAAmBD,IAE1BM,IAAS/N,EAAGgO,YAAAA,CAAahO,EAAGiO,eAAAA;gBAClCjO,EAAGkO,YAAAA,CAAaH,GAAQlS,IACxBmE,EAAGmO,aAAAA,CAAcJ,IAEjBD,IAAa9N,EAAGoO,kBAAAA,CAAmBL,GAAQ/N,EAAGqO,cAAAA,GACzCP,KACHL,CAAAA,IAAUA,IAAS,IAAK,CAAA;YAE5B,QAAA,CAAUK,GACV;YAAA,OAAOL;QACT;QCvFO,MAAMa;YAaX,IAAA,WAAWC;gBACT,OAAO18B,IAAAA,CAAK28B,SACd;YAAA;YAMA,YAAY1jB,CAAAA,CAAAA;gBAnBJ,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAGlB,IAAA,CAAAulB,QAAAA,GAA0D,CAAC,GAC3D,IAAA,CAAAC,UAAAA,GAAoE,CAAC,GACpE,IAAA,CAAAF,SAAAA,GAAAA,CAAY;gBAelB,MAAA,EAAM,IAAExO,CAAAA,EAAE,cAAE2O,CAAAA,EAAY,gBAAEC,CAAAA,EAAc,WAAEC,CAAAA,EAAS,eAAEC,CAAAA,EAAAA,GAAkBhkB;gBACvEjZ,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAK88B,YAAAA,GAAeA,GACpB98B,IAAAA,CAAK+8B,cAAAA,GAAiBA,GACtB/8B,IAAAA,CAAKk9B,UAAAA,GAAaF,GAClBh9B,IAAAA,CAAKm9B,cAAAA,GAAiBF;YACxB;YAEA,UAAA7N;gBACapvB,IAAAA,CAAKwuB,GAAAA,CACb4O,aAAAA,CAAcp9B,IAAAA,CAAKq9B,OAAAA,GACtBr9B,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAKA,MAAA+I;gBACav3B,IAAAA,CAAKwuB,GAAAA,CACb8O,UAAAA,CAAWt9B,IAAAA,CAAKq9B,OAAAA,GACnBZ,GAAOc,uBAAAA,GAA0Bv9B,IACnC;YAAA;YAEA,mBAAAw9B;gBACE,OAAOf,GAAOc,uBAAAA,KAA4Bv9B,IAC5C;YAAA;YAKA,UAAAy9B;gBACE,MAAMtP,IAAKnuB,IAAAA,CAAKwuB,GAAAA,EACVkP,IAAe19B,IAAAA,CAAK29B,cAAAA,CAAexP,GAAInuB,IAAAA,CAAK88B,YAAAA,EAAc3O,EAAGyP,aAAAA,GAC7DC,IAAiB79B,IAAAA,CAAK29B,cAAAA,CAAexP,GAAInuB,IAAAA,CAAK+8B,cAAAA,EAAgB5O,EAAGiO,eAAAA;gBACvEp8B,IAAAA,CAAKq9B,OAAAA,GAAUr9B,IAAAA,CAAK89B,cAAAA,CAAe3P,GAAIuP,GAAcG;gBAErD,MAAMhB,IAAa78B,IAAAA,CAAK+9B,aAAAA;gBACxB,KAAK,MAAMC,KAAanB,EACtB78B,IAAAA,CAAK68B,UAAAA,CAAWmB,EAAUvP,IAAAA,CAAAA,GAAQuP;gBAEpC,MAAMpB,IAAW58B,IAAAA,CAAKi+B,WAAAA;gBACtB,KAAK,MAAMC,KAAWtB,EACpB58B,IAAAA,CAAK48B,QAAAA,CAASsB,EAAQzP,IAAAA,CAAAA,GAAQyP;gBAOhC,OAJAl+B,IAAAA,CAAK28B,SAAAA,GAAAA,CAAY,GACb38B,IAAAA,CAAKm9B,cAAAA,IACPn9B,IAAAA,CAAKm9B,cAAAA,CAAen9B,IAAAA,GAEfA,IAAAA,CAAKq9B,OACd;YAAA;YAEA,cAAAY;gBACE,MAAM9P,IAAKnuB,IAAAA,CAAKwuB,GAAAA,EACV2P,IAAehQ,EAAGiQ,mBAAAA,CAAoBp+B,IAAAA,CAAKq9B,OAAAA,EAASlP,EAAGkQ,eAAAA,GACvDzB,IAAgC,EAAA;gBACtC,IAAK,IAAIp8B,IAAI,GAAGA,IAAI29B,GAAc39B,IAAK;oBACrC,MAAM09B,IAAU/P,EAAGmQ,gBAAAA,CAAiBt+B,IAAAA,CAAKq9B,OAAAA,EAAS78B,IAC5C+9B,IAAkBpQ,EAAGqQ,kBAAAA,CAAmBx+B,IAAAA,CAAKq9B,OAAAA,EAASa,EAAQzP,IAAAA;oBACpEmO,EAASj9B,IAAAA,CAAK;wBACZ8uB,MAAMyP,EAAQzP,IAAAA;wBACdgQ,QAAQP,EAAQz3B,IAAAA;wBAChBi4B,UAAUH;oBAAAA;gBAEd;gBACA,OAAO3B;YACT;YAEA,gBAAAmB;gBACE,MAAM5P,IAAKnuB,IAAAA,CAAKwuB,GAAAA,EACVmQ,IAAiBxQ,EAAGiQ,mBAAAA,CAAoBp+B,IAAAA,CAAKq9B,OAAAA,EAASlP,EAAGyQ,iBAAAA,GACzD/B,IAA0C,EAAA;gBAChD,IAAK,IAAIr8B,IAAI,GAAGA,IAAIm+B,GAAgBn+B,IAAK;oBACvC,MAAMw9B,IAAY7P,EAAG0Q,eAAAA,CAAgB7+B,IAAAA,CAAKq9B,OAAAA,EAAS78B,IAC7Cs+B,IAAoB3Q,EAAG4Q,iBAAAA,CAAkB/+B,IAAAA,CAAKq9B,OAAAA,EAASW,EAAUvP,IAAAA;oBACvEoO,EAAWl9B,IAAAA,CAAK;wBACd8uB,MAAMuP,EAAUvP,IAAAA;wBAChBgQ,QAAQ/C,GAAwBvN,GAAI6P,EAAUv3B,IAAAA;wBAC9CqJ,MAAMsrB,GAA0BjN,GAAI6P,EAAUv3B,IAAAA;wBAC9Ci4B,UAAUI;wBACVE,YAAAA,CAAY;oBAAA;gBAEhB;gBACA,OAAOnC;YACT;YAOA,WAAWqC,CAAAA,EAAoBhO,CAAAA,EAAAA;gBAC7B,MAAM/C,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAWyH,IAC/B/Q,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYuB;YAChC;YASA,cAAczC,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC1BpD,IAAAA,CAAKo/B,UAAAA,CAAW,aAAa3Q,GAAAA,CAAAA,CAAQrrB;YACvC;YASA,iBAAiBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC7B,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,aAAa7Q,GAAAA,CAAAA,CAAQrrB;YACjD;YASA,mBAAmBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC/BpD,IAAAA,CAAKo/B,UAAAA,CAAW,cAAc3Q,GAAMrrB;YACtC;YASA,sBAAsBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAClC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,cAAc7Q,GAAMrrB;YAChD;YASA,kBAAkBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC9BpD,IAAAA,CAAKo/B,UAAAA,CAAW,aAAa3Q,GAAMrrB,IAAQ,IAAI;YACjD;YASA,qBAAqBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACjC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,aAAa7Q,GAAMrrB,IAAQ,IAAI;YAC3D;YASA,gBAAgBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC5BpD,IAAAA,CAAKo/B,UAAAA,CAAW,aAAa3Q,GAAMrrB;YACrC;YASA,mBAAmBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC/B,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,aAAa7Q,GAAMrrB;YAC/C;YASA,qBAAqBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACjCpD,IAAAA,CAAKo/B,UAAAA,CAAW,cAAc3Q,GAAMrrB;YACtC;YAQA,wBAAwBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACpC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,cAAc7Q,GAAMrrB;YAChD;YASA,sBAAsBqrB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAClCpD,IAAAA,CAAKo/B,UAAAA,CAAW,aAAa3Q,GAAMrrB,EAAMkJ,CAAAA,EAAGlJ,EAAMgH,CAAAA;YACpD;YASA,yBAAyBqkB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACrC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,aAAa7Q,GAAMrrB,EAAMkJ,CAAAA,EAAGlJ,EAAMgH,CAAAA;YAC9D;YASA,qBAAqBqkB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACjCpD,IAAAA,CAAKo/B,UAAAA,CAAW,aAAa3Q,GAAMrrB,EAAMH,CAAAA,GAAI,KAAKG,EAAMiP,CAAAA,GAAI,KAAKjP,EAAMkP,CAAAA,GAAI,KAAKlP,EAAMhB,CAAAA;YACxF;YASA,wBAAwBqsB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACpC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,aAAa7Q,GAAMrrB,EAAMH,CAAAA,GAAI,KAAKG,EAAMiP,CAAAA,GAAI,KAAKjP,EAAMkP,CAAAA,GAAI,KAAKlP,EAAMhB,CAAAA;YAClG;YASA,iBAAiBqsB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC7BpD,IAAAA,CAAKo/B,UAAAA,CAAW,oBAAoB3Q,GAAAA,CAAM,GAAOrrB,EAAM3B,IAAAA;YACzD;YAEA,uBAAuBgtB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACnCpD,IAAAA,CAAKo/B,UAAAA,CAAW,oBAAoB3Q,GAAAA,CAAM,GAAO;oBAC/CrrB,EAAM3B,IAAAA,CAAK,EAAA;oBACX2B,EAAM3B,IAAAA,CAAK,EAAA;oBACX;oBACA;oBAEA2B,EAAM3B,IAAAA,CAAK,EAAA;oBACX2B,EAAM3B,IAAAA,CAAK,EAAA;oBACX;oBACA;oBAEA;oBACA;oBACA;oBACA;oBAEA2B,EAAM3B,IAAAA,CAAK,EAAA;oBACX2B,EAAM3B,IAAAA,CAAK,EAAA;oBACX;oBACA;iBAAA;YAEJ;YASA,oBAAoBgtB,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAChC,OAAOpD,IAAAA,CAAKs/B,aAAAA,CAAc,oBAAoB7Q,GAAAA,CAAM,GAAOrrB,EAAM3B,IAAAA;YACnE;YAOA,WAAkD6+B,CAAAA,EAA2B7R,CAAAA,EAAAA,GAAiBrrB,CAAAA,EAAAA;gBAC5F,IAAA,CAAKpD,IAAAA,CAAK28B,SAAAA,EACR,MAAMx2B,MAAM,CAAA,6CAAA,EAAgDm6B,EAAAA,CAAAA,EAAe7R,GAAAA;gBAE7E,IAAA,CAAKzuB,IAAAA,CAAKw9B,gBAAAA,IACR,MAAMr3B,MACJ;gBAIJ,MACMu4B,IADK1+B,IAAAA,CAAKwuB,GAAAA,CACIgQ,kBAAAA,CAAmBx+B,IAAAA,CAAKq9B,OAAAA,EAAS5O;gBACrD,IAAA,CAAIiQ,GAIF,MAAMv4B,MACJ,CAAA,QAAA,EAAWm6B,EAAAA,CAAAA,EAAe7R,EAAAA,4GAAAA,CAAAA;gBALhB;oBACZ,MAAM/W,IAAO;wBAACgnB;2BAAat7B;qBAAAA;oBAC1BpD,IAAAA,CAAKwuB,GAAAA,CAAY8R,EAAAA,CAAavnB,KAAAA,CAAM/Y,IAAAA,CAAKwuB,GAAAA,EAAK9W;gBACjD;YAMF;YAWA,cACE4oB,CAAAA,EACA7R,CAAAA,EAAAA,GACGrrB,CAAAA,EAAAA;gBAEH,IAAA,CAAKpD,IAAAA,CAAK28B,SAAAA,EAER,OADA38B,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,6CAAA,EAAgDioB,EAAAA,CAAAA,EAAe7R,GAAAA,GAAAA,CAC1E;gBAET,IAAA,CAAKzuB,IAAAA,CAAKw9B,gBAAAA,IAKR,OAJAx9B,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,mIAAA,CAGK;gBAET,MACMqmB,IADK1+B,IAAAA,CAAKwuB,GAAAA,CACIgQ,kBAAAA,CAAmBx+B,IAAAA,CAAKq9B,OAAAA,EAAS5O;gBACrD,IAAA,CAAIiQ,GAIF,OAAA,CAAO;gBAJK;oBACZ,MAAMhnB,IAAO;wBAACgnB;2BAAat7B;qBAAAA;oBAC1BpD,IAAAA,CAAKwuB,GAAAA,CAAY8R,EAAAA,CAAavnB,KAAAA,CAAM/Y,IAAAA,CAAKwuB,GAAAA,EAAK9W;gBACjD;gBAGA,OAAA,CAAO;YACT;YAEQ,eAAeyW,CAAAA,EAA2BuP,CAAAA,EAA2BG,CAAAA,EAAAA;gBAC3E,MAAMR,IAAUlP,EAAGoS,aAAAA;gBACnB,IAAgB,SAAZlD,GACF,MAAMl3B,MAAM;gBAIdgoB,EAAGqS,YAAAA,CAAanD,GAASK,IACzBvP,EAAGqS,YAAAA,CAAanD,GAASQ,IAErB79B,IAAAA,CAAKk9B,UAAAA,IACPl9B,IAAAA,CAAKk9B,UAAAA,CAAWG,IAIlBlP,EAAGsS,WAAAA,CAAYpD;gBAGf,IAAA,CADgBlP,EAAGiQ,mBAAAA,CAAoBf,GAASlP,EAAGuS,WAAAA,GAEjD,MAAMv6B,MAAM,CAAA,6BAAA,EAAgCgoB,EAAGwS,iBAAAA,CAAkBtD,GAAAA,CAAAA,CAAAA;gBAGnE,OAAOA;YACT;YAEQ,eAAelP,CAAAA,EAA2B5M,CAAAA,EAAgB9a,CAAAA,EAAAA;gBAChE,MAAMm6B,IAAWzS,EAAGyP,aAAAA,KAAkBn3B,IAAO,WAAW,YAClDy1B,IAAS/N,EAAGgO,YAAAA,CAAa11B;gBAC/B,IAAe,SAAXy1B,GACF,MAAM/1B,MAAM,CAAA,yBAAA,EAA4Bob,EAAAA,CAAAA,CAAAA;gBAG1C4M,EAAGkO,YAAAA,CAAaH,GAAQ3a,IACxB4M,EAAGmO,aAAAA,CAAcJ;gBAGjB,IAAA,CADgB/N,EAAGoO,kBAAAA,CAAmBL,GAAQ/N,EAAGqO,cAAAA,GACnC;oBACZ,MAAMqE,IAAY1S,EAAG2S,gBAAAA,CAAiB5E;oBACtC,MAAM/1B,MAAM,CAAA,kBAAA,EAAqBy6B,EAAAA,YAAAA,EAAuBC,IAAY7gC,IAAAA,CAAK+gC,sBAAAA,CAAuBxf,GAAQsf,IAAAA;gBAC1G;gBACA,OAAO3E;YACT;YAEQ,uBAAuB3a,CAAAA,EAAgBsf,CAAAA,EAAAA;gBAC7C,IAAA,CAAKtf,GACH,OAAOsf;gBAET,MAAMtM,IAAQhT,EAAO8T,KAAAA,CAAM,OACrB2L,IAAiBH,EAAUI,MAAAA,CAAO,UAClCC,IAAeL,EAAUp4B,OAAAA,CAAQ,KAAKu4B,IAAAA,CACrCG,GAAGC,EAAAA,GAAUP,EACjBt1B,KAAAA,CAAMy1B,GAAgBE,GACtB7L,KAAAA,CAAM,KACNp1B,GAAAA,CAAKsP,CAAAA,IAAMgP,OAAOhP;gBACrB,IAAK,IAAI/O,IAAI,GAAGA,IAAI+zB,EAAMj0B,MAAAA,EAAQE,IAChC+zB,CAAAA,CAAM/zB,EAAAA,GAAK,GAAGA,IAAI,EAAA,EAAA,EAAM+zB,CAAAA,CAAM/zB,EAAAA,GAAK4gC,MAAW5gC,IAAI,IAAI,mBAAmB,IAAA;gBAG3E,OAAO,kBAAkB+zB,EAAMh0B,IAAAA,CAAK;YACtC;QAAA;QAxbe,GAAAg9B,uBAAAA,GAAyC;QChEnD,MAAM8D;YAmBX,YAAYpoB,CAAAA,CAAAA;gBAFL,IAAA,CAAAxS,IAAAA,GAA6B;gBAGlC,MAAA,EAAM,IAAE0nB,CAAAA,EAAE,MAAEre,CAAAA,EAAI,MAAErJ,CAAAA,EAAI,MAAEhF,CAAAA,EAAAA,GAASwX;gBAGjC,IAFAjZ,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKshC,MAAAA,GAASthC,IAAAA,CAAKwuB,GAAAA,CAAI+S,YAAAA,IAAAA,CAClB9/B,KAAAA,CAASqO,GACZ,MAAM3J,MAAM;gBAMZnG,IAAAA,CAAKwhC,UAAAA,GAHF//B,KACe,IAAIkgB,aAAa7R,IAIrC9P,IAAAA,CAAKyG,IAAAA,GAAOA,QAAAA,IAAAA,IAAQzG,IAAAA,CAAKyG,IAAAA,EAEzB0nB,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKshC,MAAAA,GACpCnT,EAAGqT,UAAAA,CAAWrT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKwhC,UAAAA,EAA0B,aAAdxhC,IAAAA,CAAKyG,IAAAA,GAAoB0nB,EAAGwT,WAAAA,GAAcxT,EAAGyT,YAAAA;YAC/F;YAKA,OAAA/gB;gBACE,MAAMsN,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKshC,MAAAA;YACtC;YAEA,SAAAO;gBACE,MAAM1T,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc;YACjC;YAKA,OAAOK,CAAAA,EAAAA;gBACL,MAAM5T,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKshC,MAAAA,GAChCS,IACF5T,EAAG6T,aAAAA,CAAc7T,EAAGuT,YAAAA,EAAc,GAAG1hC,IAAAA,CAAKwhC,UAAAA,EAAY,GAAGO,KAGzD5T,EAAGqT,UAAAA,CAAWrT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKwhC,UAAAA,EAA0B,aAAdxhC,IAAAA,CAAKyG,IAAAA,GAAoB0nB,EAAGwT,WAAAA,GAAcxT,EAAGyT,YAAAA;YAEjG;YAEA,UAAAxS;gBACapvB,IAAAA,CAAKwuB,GAAAA,CACbyT,YAAAA,CAAajiC,IAAAA,CAAKshC,MAAAA,GACrBthC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;QAAA;QCtDK,MAAM0T;YAUX,IAAA,eAAWC;gBACT,OAAOniC,IAAAA,CAAKoiC,aACd;YAAA;YAEA,IAAA,aAAWvF;gBACT,OAAO78B,IAAAA,CAAKqiC,WACd;YAAA;YAEA,YAAYppB,CAAAA,CAAAA;gBAhBJ,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IACjB,IAAA,CAAAirB,iBAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAAC,OAAAA,GAAuC,EAAA,EACvC,IAAA,CAAAF,WAAAA,GAA+F,EAAA,EAwB/F,IAAA,CAAAG,qBAAAA,GAAwB,GAmBxB,IAAA,CAAAC,YAAAA,GAAAA,CAAe;gBA9BrB,MAAA,EAAM,IAAEtU,CAAAA,EAAE,QAAE+N,CAAAA,EAAM,cAAEiG,CAAAA,EAAY,YAAEtF,CAAAA,EAAU,kBAAE6F,CAAAA,EAAAA,GAAqBzpB;gBACnEjZ,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKoiC,aAAAA,GAAgBD,GACrBniC,IAAAA,CAAKqiC,WAAAA,GAAcxF,GACnB78B,IAAAA,CAAK2iC,OAAAA,GAAUzG,GACfl8B,IAAAA,CAAKsiC,iBAAAA,GAAoBI,GACrBxG,KACFl8B,IAAAA,CAAK4iC,UAAAA;YAET;YAMA,IAAA,uBAAWC;gBACT,OAAO7iC,IAAAA,CAAKwiC,qBACd;YAAA;YAEA,IAAA,OAAkBtG,CAAAA,EAAAA;gBACZA,KAAUl8B,IAAAA,CAAK2iC,OAAAA,KAAYzG,KAC7Bl8B,CAAAA,IAAAA,CAAK2iC,OAAAA,GAAUzG,GACfl8B,IAAAA,CAAK4iC,UAAAA,EAAAA;YAET;YAEA,IAAA,SAAW1G;gBACT,OAAOl8B,IAAAA,CAAK2iC,OACd;YAAA;YAOA,aAAAC;gBACE,IAAI5iC,IAAAA,CAAKyiC,YAAAA,EACP;gBAEF,IAAA,CAAKziC,IAAAA,CAAK2iC,OAAAA,EACR;gBAGF,IAAA,CAAK3iC,IAAAA,CAAK2iC,OAAAA,CAAQjG,QAAAA,EAChB,MAAMv2B,MAAM;gBAEdnG,IAAAA,CAAKwiC,qBAAAA,GAAwB,GAC7BxiC,IAAAA,CAAKuiC,OAAAA,CAAQjiC,MAAAA,GAAS;gBACtB,MAAMwiC,IAAmB9iC,IAAAA,CAAK2iC,OAAAA,CAAQ9F,UAAAA;gBACtC,KAAK,MAAMmB,KAAah+B,IAAAA,CAAKqiC,WAAAA,CAAa;oBACxC,MAAMU,IAASD,CAAAA,CAAiB9E,CAAAA,CAAU,EAAA,CAAA;oBAC1C,IAAA,CAAK+E,GAAQ;wBACX,IAAA,CAAKnI,GAAoB56B,IAAAA,CAAK2iC,OAAAA,CAAQ7F,YAAAA,EAAckB,CAAAA,CAAU,EAAA,GAC5D,MAAM73B,MACJ,CAAA,qBAAA,EAAwB63B,CAAAA,CAAU,EAAA,CAAA,MAAA,EAAWA,CAAAA,CAAU,EAAA,CAAA,wCAAA,EACVh+B,IAAAA,CAAK2iC,OAAAA,CAAQ7F,YAAAA,EAAAA;wBAIzD98B,IAAAA,CAAKsiC,iBAAAA,IACRtiC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,qBAAA,EAAwB2lB,CAAAA,CAAU,EAAA,CAAA,MAAA,EAAWA,CAAAA,CAAU,EAAA,CAAA,sHAAA,EAEQA,CAAAA,CAAU,EAAA,CAAA,sHAAA,EAEnCA,CAAAA,CAAU,EAAA,CAAA,oFAAA,CAAA;wBAKpD,MAAMS,IAASxD,GAAoBj7B,IAAAA,CAAKwuB,GAAAA,EAAKxuB,IAAAA,CAAK2iC,OAAAA,CAAQ7F,YAAAA,EAAckB,CAAAA,CAAU,EAAA;wBAGlFh+B,IAAAA,CAAKuiC,OAAAA,CAAQ5iC,IAAAA,CAAK;4BAChB8uB,MAAMuP,CAAAA,CAAU,EAAA;4BAChBS,QAAAA;4BACA3uB,MAAMkuB,CAAAA,CAAU,EAAA;4BAChBU,UAAAA;4BACAM,YAAAA,CAAY;wBAAA;oBAEhB;oBACA,IAAI+D,GAAQ;wBACV,IAAIA,EAAOjzB,IAAAA,KAASkuB,CAAAA,CAAU,EAAA,EAC5B,MAAM73B,MACJ,CAAA,6CAAA,EAAgD63B,CAAAA,CAAU,EAAA,CAAA,EAAA,EAAOA,CAAAA,CAAU,EAAA,CAAA,oCAAA,EACnC+E,EAAOjzB,IAAAA,CAAAA,IAAAA,EAAW9P,IAAAA,CAAK2iC,OAAAA,CAAQ7F,YAAAA,EAAAA;wBAG3E98B,IAAAA,CAAKuiC,OAAAA,CAAQ5iC,IAAAA,CAAKojC;oBACpB;gBACF;gBAGA,IAAIC,IAAsB;gBAC1B,KAAK,MAAMC,KAAiBjjC,IAAAA,CAAKuiC,OAAAA,CAAS;oBACxC,MAAMW,IAAW7I,GAAmBr6B,IAAAA,CAAKwuB,GAAAA,EAAKyU,EAAcxE,MAAAA;oBAC5Dz+B,IAAAA,CAAKwiC,qBAAAA,IAAyBU,IAAWD,EAAcnzB,IAAAA,EACvDkzB,KAAuBC,EAAcnzB,IACvC;gBAAA;gBAEI9P,IAAAA,CAAKoiC,aAAAA,CAAcZ,UAAAA,CAAWlhC,MAAAA,GAAS0iC,KAAwB,KACjEhjC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,2BAAA,EAA8B2qB,EAAAA,4DAAAA,EACvBhjC,IAAAA,CAAKoiC,aAAAA,CAAcZ,UAAAA,CAAWlhC,MAAAA,CAAAA,CAAAA,CAAAA;gBAKzC,MAAM6tB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAKmjC,IAAAA,GAAOhV,EAAGiV,iBAAAA,IACfjV,EAAGkV,eAAAA,CAAgBrjC,IAAAA,CAAKmjC,IAAAA,GACxBnjC,IAAAA,CAAKoiC,aAAAA,CAAcvhB,IAAAA;gBAEnB,IAAIoU,IAAS;gBACb,KAAK,MAAMqO,KAAQtjC,IAAAA,CAAKuiC,OAAAA,CAAAA,OAElBe,EAAK5E,QAAAA,IACH4E,CAAAA,EAAK7E,MAAAA,KAAWtQ,EAAGmM,GAAAA,GACrBnM,EAAGoV,oBAAAA,CAAqBD,EAAK5E,QAAAA,EAAU4E,EAAKxzB,IAAAA,EAAMwzB,EAAK7E,MAAAA,EAAQz+B,IAAAA,CAAK6iC,oBAAAA,EAAsB5N,KAE1F9G,EAAGqV,mBAAAA,CAAoBF,EAAK5E,QAAAA,EAAU4E,EAAKxzB,IAAAA,EAAMwzB,EAAK7E,MAAAA,EAAQ6E,EAAKtE,UAAAA,EAAYh/B,IAAAA,CAAK6iC,oBAAAA,EAAsB5N,IAE5G9G,EAAGsV,uBAAAA,CAAwBH,EAAK5E,QAAAA,CAAAA,GAElCzJ,KAAUoF,GAAmBlM,GAAImV,EAAK7E,MAAAA,IAAU6E,EAAKxzB,IAAAA;gBAEvDqe,EAAGkV,eAAAA,CAAgB,OACnBrjC,IAAAA,CAAKoiC,aAAAA,CAAcP,MAAAA,IAEnB7hC,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe;YACtB;YAMA,IAAIiB,IAAAA,CAAe,CAAA,EAAO3B,CAAAA,EAAAA;gBACxB,IAAA,CAAK/hC,IAAAA,CAAK2iC,OAAAA,EACR,MAAMx8B,MAAM;gBAGd,MAAMgoB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChB,IAAA,CAAKxuB,IAAAA,CAAK2iC,OAAAA,CAAQnF,gBAAAA,IAChB,MAAMr3B,MAAM;gBAEdnG,IAAAA,CAAKoiC,aAAAA,CAAcvhB,IAAAA,IACf6iB,KACF1jC,IAAAA,CAAKoiC,aAAAA,CAAcN,MAAAA,CAAOC,IAE5B5T,EAAGkV,eAAAA,CAAgBrjC,IAAAA,CAAKmjC,IAAAA;YAC1B;QAAA;QCrNK,MAAMQ;YAGJ,OAAA,QAAOn8B;gBACZm8B,GAAoBC,aAAAA,GAAgB,GACpCD,GAAoBE,gBAAAA,GAAmB;YACzC;QAAA;QALc,GAAAD,aAAAA,GAAwB,GACxB,GAAAC,gBAAAA,GAA2B;QCYpC,MAAMC;YAAb,aAAA;gBACkB,IAAA,CAAAr9B,IAAAA,GAAO,WAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAIlB,IAAA,CAAAC,SAAAA,GAAoB,OAGpB,IAAA,CAAAC,YAAAA,GAAe,GACf,IAAA,CAAAC,UAAAA,GAAa,GAsCb,IAAA,CAAAC,aAAAA,GAAgBz1B,EAAI,GAAG,IACvB,IAAA,CAAA01B,WAAAA,GAAc11B,EAAI,GAAG;YA+D/B;YArGE,WAAWyf,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAChBrkC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA2O,cC9BN;oBD+BMC,gBE/BN;gBAAA,IFiCI/8B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IACbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAEbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAExDhiB,IAAAA,CAAKoiC,aAAAA,GAAgB,IAAIf,GAAa;oBACpClT,IAAAA;oBACAre,MAAM,KAAQ9P,IAAAA,CAAKgkC,SAAAA;oBACnBv9B,MAAM;gBAAA,IAGRzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACAgU,cAAcniC,IAAAA,CAAKoiC,aAAAA;oBACnBlG,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACb9F,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAW;yBAAA;qBAAA;gBAAA;YAGlB;YAEO,UAAAzN;gBACLpvB,IAAAA,CAAKoiC,aAAAA,CAAchT,OAAAA,IACnBpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAIA,KAAKxpB,CAAAA,EAAeu/B,CAAAA,EAAa5wB,CAAAA,EAAAA;gBAE3B3T,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAGPzkC,IAAAA,CAAKkkC,UAAAA;gBAEL,MAAMnnB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1BC,IAAa5nB,EAAUrJ,QAAAA,CAAS1O,GAAOhF,IAAAA,CAAKmkC,aAAAA,GAC5CS,IAAW7nB,EAAUrJ,QAAAA,CAAS6wB,GAAKvkC,IAAAA,CAAKokC,WAAAA,GAExCjC,IAAeniC,IAAAA,CAAKoiC,aAAAA,CAAcZ,UAAAA;gBAExCW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBU,EAAWr4B,CAAAA,EAC/C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBU,EAAWv6B,CAAAA,EAC/C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAG1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBW,EAASt4B,CAAAA,EAC7C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBW,EAASx6B,CAAAA,EAC7C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAC5C;YAAA;YAEQ,UAAAoiC;gBACN,OAAIxkC,IAAAA,CAAKkkC,UAAAA,IAAclkC,IAAAA,CAAKgkC,SAI9B;YAAA;YAEA,kBAAAa;gBACE,OAA2B,MAApB7kC,IAAAA,CAAKkkC,UACd;YAAA;YAEA,QAAAO;gBAEE,IAAwB,MAApBzkC,IAAAA,CAAKkkC,UAAAA,EACP;gBAGF,MAAM/V,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,IAEjBv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAExDmM,EAAG2W,UAAAA,CAAW3W,EAAG4W,KAAAA,EAAO,GAAqB,IAAlB/kC,IAAAA,CAAKkkC,UAAAA,GAEhCP,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAKkkC,UAAAA,EAC7CP,GAAoBC,aAAAA,IAGpB5jC,IAAAA,CAAKikC,YAAAA,GAAe,GACpBjkC,IAAAA,CAAKkkC,UAAAA,GAAa;YACpB;QAAA;QGlHK,MAAMc;YAAb,aAAA;gBACkB,IAAA,CAAAv+B,IAAAA,GAAO,YAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAElB,IAAA,CAAAkB,UAAAA,GAAqB,OAKrB,IAAA,CAAAC,WAAAA,GAAsB,GACtB,IAAA,CAAAjB,YAAAA,GAAuB;YAiGjC;YAhGE,WAAW9V,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAChBrkC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA2O,cC3BN;oBD4BMC,gBE5BN;gBAAA,IF8BI/8B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IACbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GACxDhiB,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACAre,MAAM,IAAI9P,IAAAA,CAAKilC,UAAAA;oBACfx+B,MAAM;gBAAA,IAGRzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAW;yBAAA;wBACZ;4BAAC;4BAAU;yBAAA;qBAAA;gBAAA;YAGjB;YAEO,UAAAzN;gBACLpvB,IAAAA,CAAKmlC,OAAAA,CAAQ/V,OAAAA,IACbpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEA,KAAK5R,CAAAA,EAAejJ,CAAAA,EAAc7D,CAAAA,EAAAA;gBAE5B9P,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAGPzkC,IAAAA,CAAKklC,WAAAA;gBAEL,MAAMnoB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EACxBwc,IAAcplC,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA,EAE5BC,IAAatoB,EAAUrJ,QAAAA,CAASkJ;gBAElCwoB,KACFC,CAAAA,EAAW/4B,CAAAA,GAAAA,CAAAA,CAAO+4B,CAAAA,EAAW/4B,CAAAA,GAAIg5B,EAAAA,GACjCD,EAAWj7B,CAAAA,GAAAA,CAAAA,CAAOi7B,CAAAA,EAAWj7B,CAAAA,GAAIk7B,EAAAA,CAAAA;gBAGnC,MAAMnD,IAAeniC,IAAAA,CAAKmlC,OAAAA,CAAQ3D,UAAAA;gBAClCW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoB,EAAW/4B,CAAAA,EAC/C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoB,EAAWj7B,CAAAA,EAC/C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,GAAIwmB,GAC9CuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBn0B,IAAOxK,KAAKC,GAAAA,CAAIwX,EAAUwI,SAAAA,IAAaxI,EAAUuI,SAAAA;YACvF;YAEQ,UAAAkf;gBACN,OAAIxkC,IAAAA,CAAKklC,WAAAA,IAAellC,IAAAA,CAAKilC,UAI/B;YAAA;YAEA,kBAAAJ;gBACE,OAA4B,MAArB7kC,IAAAA,CAAKklC,WACd;YAAA;YAEA,QAAAT;gBAEE,IAAyB,MAArBzkC,IAAAA,CAAKklC,WAAAA,EACP;gBAGF,MAAM/W,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,IAEjBv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAExDmM,EAAG2W,UAAAA,CAAW3W,EAAGoX,MAAAA,EAAQ,GAAGvlC,IAAAA,CAAKklC,WAAAA,GAEjCvB,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAKklC,WAAAA,EAC7CvB,GAAoBC,aAAAA,IAEpB5jC,IAAAA,CAAKklC,WAAAA,GAAc,GACnBllC,IAAAA,CAAKikC,YAAAA,GAAe;YACtB;QAAA;QG3GK,MAAMuB;YAKX,YAAYrX,CAAAA,CAAAA;gBACVnuB,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA2O,cCnBN;oBDoBMC,gBEpBN;gBAAA,IFsBI/8B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAEbz9B,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACA1nB,MAAM;oBAENhF,MAAM,IAAIkgB,aAAa;wBAAA;wBACpB;wBAAO;wBAAG;wBAAA;wBAAO;wBAAG;wBAAG;wBAAG;wBAAA;wBAAO;wBAAG;wBAErC;wBAAA;wBAAO;wBAAG;wBAAA;wBAAO;wBAAG;wBAAG;wBAAG;wBAAG;wBAAG;wBAAG;qBAAA;gBAAA,IAGvC3hB,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAc;yBAAA;qBAAA;gBAAA,IAGnB78B,IAAAA,CAAKmlC,OAAAA,CAAQrD,MAAAA;YACf;YAEA,wBAAwB4D,CAAAA,EAAAA;gBACtB,MAAMvX,IAAKnuB,IAAAA,CAAKwuB,GAAAA,EACV0N,IAASwJ,EAAcC,SAAAA;gBAC7BzJ,EAAO3E,GAAAA,IACPmO,EAAcE,SAAAA,GAAYrO,GAAAA,IAC1BpJ,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GACpByE,EAAOmD,gBAAAA,CAAiB,WAAW,IAC/BqG,EAAcG,MAAAA,IAChBH,EAAcG,MAAAA,IAEhB1X,EAAG2W,UAAAA,CAAW3W,EAAG2X,SAAAA,EAAW,GAAG;YACjC;YAEA,iBAAAC;gBACE,MAAM5X,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,IACbpJ,EAAG2W,UAAAA,CAAW3W,EAAG2X,SAAAA,EAAW,GAAG;YACjC;QAAA;QGxDK,MAAME;YAqBX,YAAY7X,CAAAA,EAA4B8X,CAAAA,EAAuBC,CAAAA,CAAAA;gBAnBvD,IAAA,CAAArZ,OAAAA,GAAkBjW,EAAOS,WAAAA,IAoB/BrX,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKshC,MAAAA,GAASnT,EAAGoT,YAAAA,IACjBpT,EAAGsT,UAAAA,CAAWtT,EAAGgY,oBAAAA,EAAsBnmC,IAAAA,CAAKshC,MAAAA;gBAE5C,MAAM8E,IAAgC,IAAhBH;gBAEtB,IAAKC,GAEE;oBAEL,MAAMG,IAAY,OACZC,IAAiBhhC,KAAKoF,KAAAA,CAAAA,AAAO27B,CAAAA,IAAY,CAAA,IAAK;oBAEpDrmC,IAAAA,CAAKumC,YAAAA,GAAepY,EAAGuM,cAAAA,EACvB16B,IAAAA,CAAKwhC,UAAAA,GAAa,IAAIgF,YAAYJ,IAE9BH,IAAgBK,KAClBtmC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,8DAAA,EAAiEiuB,EAAAA,kBAAAA,EAAmCL,EAAAA,CAAAA,CAAAA;gBAG1G,OAdEjmC,IAAAA,CAAKwhC,UAAAA,GAAa,IAAIiF,YAAYL;gBAgBpC,IAAIM,IAAc;gBAClB,IAAK,IAAIlmC,IAAI,GAAGA,IAAI4lC,GAAe5lC,KAAK,EAEtCR,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GACvC1mC,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GACvC1mC,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GAEvC1mC,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GACvC1mC,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GACvC1mC,IAAAA,CAAKwhC,UAAAA,CAAWhhC,IAAI,EAAA,GAAKkmC,IAAc,GACvCA,KAAe;gBAEjBvY,EAAGqT,UAAAA,CAAWrT,EAAGgY,oBAAAA,EAAsBnmC,IAAAA,CAAKwhC,UAAAA,EAAYrT,EAAGwT,WAAAA;YAC7D;YAEA,IAAA,OAAW7xB;gBACT,OAAO9P,IAAAA,CAAKwhC,UAAAA,CAAWlhC,MACzB;YAAA;YAKO,SAAAwhC;gBACL,MAAM3T,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGsT,UAAAA,CAAWtT,EAAGgY,oBAAAA,EAAsBnmC,IAAAA,CAAKshC,MAAAA,GAC5CnT,EAAGqT,UAAAA,CAAWrT,EAAGgY,oBAAAA,EAAsBnmC,IAAAA,CAAKwhC,UAAAA,EAAYrT,EAAGwT,WAAAA;YAC7D;YAKO,OAAA9gB;gBACL,MAAMsN,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAChBL,EAAGsT,UAAAA,CAAWtT,EAAGgY,oBAAAA,EAAsBnmC,IAAAA,CAAKshC,MAAAA;YAC9C;YAEO,UAAAlS;gBACMpvB,IAAAA,CAAKwuB,GAAAA,CACbyT,YAAAA,CAAajiC,IAAAA,CAAKshC,MAAAA,GACrBthC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;QAAA;QCvEK,MAAMmY;YAyBX,YAAY1tB,CAAAA,CAAAA;gBAxBI,IAAA,CAAAxS,IAAAA,GAAO,YAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAKlB,IAAA,CAAA6C,UAAAA,GAAqB,OACrB,IAAA,CAAAC,YAAAA,GAAuB,GAUvB,IAAA,CAAAC,WAAAA,GAAsB,GACtB,IAAA,CAAAC,SAAAA,GAA4B,EAAA,EAC5B,IAAA,CAAAC,aAAAA,GAAgB,GAChB,IAAA,CAAAC,eAAAA,GAAkB,IAAI3Y,KACtB,IAAA,CAAA4Y,OAAAA,GAAU,IAAIjwB,KACd,IAAA,CAAAgtB,YAAAA,GAAuB,GAwIvB,IAAA,CAAAkD,aAAAA,GAAgB,IAAI7Y,KAUpB,IAAA,CAAA8Y,cAAAA,GAAiB,IAAI9Y,KAUrB,IAAA,CAAA+Y,KAAAA,GAAQ;oBAAC;oBAAG;oBAAG;oBAAG;iBAAA,EAClB,IAAA,CAAAC,KAAAA,GAAQ;oBAAC;oBAAG;iBAAA,EACZ,IAAA,CAAAC,KAAAA,GAAQ;oBAAC;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;iBAAA,EAC9B,IAAA,CAAAC,YAAAA,GAAep1B,EAAM0C,KAAAA,EA5J3B9U,IAAAA,CAAKynC,eAAAA,GAAkBxuB,EAAQwuB,eAAAA,EAC/BznC,IAAAA,CAAK0nC,SAAAA,GAAYzuB,EAAQyuB,SAC3B;YAAA;YAEA,WAAWvZ,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD;gBAGhB,MAAMsD,IAAaxZ,EAAGY,YAAAA,CAAaZ,EAAGyZ,uBAAAA,GAChCC,IAAgBlM,GAAuBxN,GAAIwZ;gBACjD3nC,IAAAA,CAAK6mC,YAAAA,GAAevhC,KAAKkF,GAAAA,CAAIm9B,GAAYE;gBACzC,MAAMC,IAAkB9nC,IAAAA,CAAK+nC,wBAAAA,CC5DjC,4rCD4DgE/nC,IAAAA,CAAK6mC,YAAAA;gBAEjE7mC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA4O,gBAAgB+K;oBAChBhL,cEjEN;gBAAA,IFmEI98B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAGbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYkE,EAAQriB,KAAAA,GAElDhiB,IAAAA,CAAK2iC,OAAAA,CAAQpD,kBAAAA,CACX,cACA;uBAAIx1B,MAAM/J,IAAAA,CAAK6mC,YAAAA;iBAAAA,CAAe5mC,GAAAA,CAAI,CAACkhC,GAAG3gC,IAAMA,KAI9CR,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACAre,MAAM,KAAS9P,IAAAA,CAAK4mC,UAAAA;oBACpBngC,MAAM;gBAAA,IAERzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAa;yBAAA;wBACd;4BAAC;4BAAS;yBAAA;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAkB;yBAAA;wBACnB;4BAAC;4BAAU;yBAAA;qBAAA;gBAAA,IAKf78B,IAAAA,CAAKgoC,MAAAA,GAAS,IAAIhC,GAAgB7X,GAAInuB,IAAAA,CAAK4mC,UAAAA,EAAAA,CAAY;YACzD;YAEO,UAAAxX;gBACLpvB,IAAAA,CAAKmlC,OAAAA,CAAQ/V,OAAAA,IACbpvB,IAAAA,CAAKgoC,MAAAA,CAAO5Y,OAAAA,IACZpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,GAAS,GACxBN,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEQ,yBAAyBjN,CAAAA,EAAgB0mB,CAAAA,EAAAA;gBAC/C,IAAIC,IAAY3mB,EAAOya,OAAAA,CAAQ,aAAaiM,EAAYloC,QAAAA,KACpDooC,IAAuB;gBAC3B,IAAK,IAAI3nC,IAAI,GAAGA,IAAIynC,GAAaznC,IAE7B2nC,KADQ,MAAN3nC,IACsB,CAAA,sBAAA,EAAyBA,EAAAA,OAAAA,CAAAA,GAEzB,CAAA,8BAAA,EAAiCA,EAAAA,OAAAA,CAAAA,EAE3D2nC,KAAwB,yEACxBA,KAAwB,CAAA,iCAAA,EAAoC3nC,EAAAA,SAAAA,CAAAA,EAC5D2nC,KAAwB;gBAG1B,OADAD,IAAYA,EAAUlM,OAAAA,CAAQ,sBAAsBmM,IAC7CD;YACT;YAEQ,mBAAmBvb,CAAAA,EAAAA;gBACzB,IAAI3sB,IAAAA,CAAKknC,OAAAA,CAAQnvB,GAAAA,CAAI4U,IACnB;gBAEF,MAAM0b,IAAiB1b,EAAM2b,YAAAA,CAAalX,GAA8BC,SAAAA,GAClE/B,IAAY+Y,IAAiB1a,GAAoB0a,KAAAA,KAAkBvnC,GACnEynC,IAAQza,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BE,SAAAA,IAC5EkX,IAAQ1a,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BG,SAAAA,IAE5EkX,IAA8C,WAAtC9b,EAAM2b,YAAAA,CAAa,gBAC3BpX,IAAUlxB,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAcze,IAAAA,CAC1C0C,GACA;oBACE2C,WAAAA;oBACAC,UAAU;wBAAEjjB,GAAGi8B;wBAAOn+B,GAAGo+B;oBAAAA;gBAAAA,GAE3BC;gBAGF9b,EAAMgc,eAAAA,CAAgB,gBAAA,OAClB3oC,IAAAA,CAAK+mC,SAAAA,CAAUt+B,OAAAA,CAAQyoB,MACzBlxB,CAAAA,IAAAA,CAAK+mC,SAAAA,CAAUpnC,IAAAA,CAAKuxB,IACpBlxB,IAAAA,CAAKinC,eAAAA,CAAgBjc,GAAAA,CAAIkG,GAASlxB,IAAAA,CAAKgnC,aAAAA,KACvChnC,IAAAA,CAAKknC,OAAAA,CAAQ92B,GAAAA,CAAIuc,EAAAA;YAErB;YAEQ,cAAcwB,CAAAA,EAAAA;gBAEpB,IAAK,IAAI3tB,IAAI,GAAGA,IAAIR,IAAAA,CAAK6mC,YAAAA,EAAcrmC,IACrC2tB,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAWj3B,IAC/B2tB,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAK+mC,SAAAA,CAAUvmC,EAAAA,IAAMR,IAAAA,CAAK+mC,SAAAA,CAAU,EAAA;YAEtE;YAEQ,sBAAsBpa,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC5B,IAAIA,GAAO;oBACT,MAAMmc,IAAe9oC,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAc/lC,GAAAA,CAAIgqB;oBACrD,OAA6C,SAAtC,CAAA,IAAA3sB,IAAAA,CAAKinC,eAAAA,CAAgBtkC,GAAAA,CAAImmC,EAAAA,KAAAA,KAAa,MAAA,IAAA,IAAA;gBAC/C;gBACA,OAAA;YACF;YAEQ,UAAAtE;gBACN,OAAIxkC,IAAAA,CAAK8mC,WAAAA,IAAe9mC,IAAAA,CAAK4mC,UAAAA,IAGzB5mC,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,IAAUN,IAAAA,CAAK6mC,YAIpC;YAAA;YAGQ,eAAela,CAAAA,EAAAA;gBACrB,IAAIqc,IAAahpC,IAAAA,CAAKmnC,aAAAA,CAAcxkC,GAAAA,CAAIgqB;gBAKxC,OAAA,KAJmB7rB,MAAfkoC,KACFA,CAAAA,IAAarc,EAAMxS,KAAAA,EACnBna,IAAAA,CAAKmnC,aAAAA,CAAcnc,GAAAA,CAAI2B,GAAOqc,EAAAA,GAEzBA;YACT;YAGQ,gBAAgBrc,CAAAA,EAAAA;gBACtB,IAAIuc,IAAclpC,IAAAA,CAAKonC,cAAAA,CAAezkC,GAAAA,CAAIgqB;gBAK1C,OAAA,KAJoB7rB,MAAhBooC,KACFA,CAAAA,IAAcvc,EAAMtS,MAAAA,EACpBra,IAAAA,CAAKonC,cAAAA,CAAepc,GAAAA,CAAI2B,GAAOuc,EAAAA,GAE1BA;YACT;YAMA,KACEvc,CAAAA,EACAlK,CAAAA,EACAC,CAAAA,EACAymB,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAGIxpC,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAGPzkC,IAAAA,CAAK8mC,WAAAA,IAEL9mC,IAAAA,CAAKooC,kBAAAA,CAAmBzb;gBACxB,MAAM8c,IAAkBzpC,IAAAA,CAAK+oC,cAAAA,CAAepc,IACtC+c,IAAmB1pC,IAAAA,CAAKipC,eAAAA,CAAgBtc;gBAE9C,IAAIxS,IAAQsvB,KAAmBN,KAAU,GACrC9uB,IAASqvB,KAAoBN,KAAW;gBAC5CppC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK,GAChBrnC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK,GAChBrnC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAA8B,SAAzB,CAAA,IAAA8B,QAAAA,IAAAA,IAAUM,CAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI,GAC7CzpC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAgC,SAA3B,CAAA,IAAA+B,QAAAA,IAAAA,IAAWM,CAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAI,GAC/C1pC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK7kB,QAAAA,IAAAA,IAAM,GACtBziB,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK5kB,QAAAA,IAAAA,IAAM,GAAA,KAEX5hB,MAAPuoC,KAAAA,KAA2BvoC,MAAPwoC,KAAAA,KAA+BxoC,MAAXyoC,KAAAA,KAAoCzoC,MAAZ0oC,KAClExpC,CAAAA,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK5kB,QAAAA,IAAAA,IAAM,GACtBziB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK3kB,QAAAA,IAAAA,IAAM,GACtB1iB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAA8B,SAAzB,CAAA,IAAA8B,QAAAA,IAAAA,IAAUM,CAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI,GAC7CzpC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAgC,SAA3B,CAAA,IAAA+B,QAAAA,IAAAA,IAAWM,CAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAI,GAC/C1pC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK+B,GAChBrpC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKgC,GAChBnvB,IAAQovB,GACRlvB,IAASmvB,CAAAA,GAGX/mB,IAAKziB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAChB3kB,IAAK1iB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA;gBAChB,MAAMsC,IAAK3pC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAChBuC,IAAK5pC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAGhBtqB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EACxBwc,IAAcplC,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA;gBAGlCplC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAC3BtnC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAG3BtnC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKntB,GAChCna,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAG3BtnC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAC3BtnC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKjtB,GAGhCra,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKntB,GAChCna,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAKvnC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKjtB,GAEhC0C,EAAU6J,mBAAAA,CAAoB5mB,IAAAA,CAAKunC,KAAAA,GAE/BnC,KACFplC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GACzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GAEzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GACzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GAEzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GACzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GAEzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,GACzDtlC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQvnC,CAAAA,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,GAAK/6B,EAAKxM,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,IAAMjC,EAAAA,CAAAA;gBAG3D,MAAMxc,IAAO9oB,IAAAA,CAAKskC,QAAAA,CAASxb,IAAAA,IAAQ9oB,IAAAA,CAAKwnC,YAAAA,EAElCqC,IAAY7pC,IAAAA,CAAK6oC,qBAAAA,CAAsBlc,IACvCmd,IAAaL,KAAmBtvB,GAChC4vB,IAAcL,KAAoBrvB,GAElC2vB,IAAAA,AAAQvnB,CAAAA,IAAKziB,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaoC,GAC/BG,IAAAA,AAAQvnB,CAAAA,IAAK1iB,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaqC,GAC/BG,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK3pC,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaoC,GACpCK,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK5pC,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaqC,GAEpCK,IAAUX,GACVY,IAAWX,GAGXvH,IAAeniC,IAAAA,CAAKuiC,OAAAA,CAAQJ,YAAAA,CAAaX,UAAAA;gBAG/CW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmG,GACpCjI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoG,GACpClI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB+F,GACpC7H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgG,GACpC9H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB4F,GACpC1H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK7lB,CAAAA,GAAI,KAC7Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKzW,CAAAA,GAAI,KAC7C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKxW,CAAAA,GAAI,KAC7C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK1mB,CAAAA,EAGzC+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmG,GACpCjI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoG,GACpClI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB+F,GACpC7H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBkG,GACpChI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB4F,GACpC1H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK7lB,CAAAA,GAAI,KAC7Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKzW,CAAAA,GAAI,KAC7C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKxW,CAAAA,GAAI,KAC7C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK1mB,CAAAA,EAGzC+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmG,GACpCjI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoG,GACpClI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBiG,GACpC/H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgG,GACpC9H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB4F,GACpC1H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK7lB,CAAAA,GAAI,KAC7Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKzW,CAAAA,GAAI,KAC7C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKxW,CAAAA,GAAI,KAC7C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK1mB,CAAAA,EAGzC+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKunC,KAAAA,CAAM,EAAA,EAC/CpF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmG,GACpCjI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoG,GACpClI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBiG,GACpC/H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBkG,GACpChI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB4F,GACpC1H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK7lB,CAAAA,GAAI,KAC7Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKzW,CAAAA,GAAI,KAC7C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKxW,CAAAA,GAAI,KAC7C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK1mB,CAC3C;YAAA;YAEA,kBAAAyiC;gBACE,OAA4B,MAArB7kC,IAAAA,CAAK8mC,WACd;YAAA;YAEA,QAAArC;gBAEE,IAAyB,MAArBzkC,IAAAA,CAAK8mC,WAAAA,EACP;gBAGF,MAAM3Y,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEhBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAGbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,GAAM,KAASv3B,IAAAA,CAAK8mC,WAAAA,GAGrC9mC,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAGxDhiB,IAAAA,CAAK2iC,OAAAA,CAAQlD,iBAAAA,CAAkB,cAAcz/B,IAAAA,CAAKynC,eAAAA,GAGlDznC,IAAAA,CAAK4oC,aAAAA,CAAcza,IAGnBnuB,IAAAA,CAAKgoC,MAAAA,CAAOnnB,IAAAA,IAGZsN,EAAGmc,YAAAA,CAAanc,EAAG2X,SAAAA,EAA8B,IAAnB9lC,IAAAA,CAAK8mC,WAAAA,EAAiB9mC,IAAAA,CAAKgoC,MAAAA,CAAOzB,YAAAA,EAAc,IAE9E5C,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAK8mC,WAAAA,EAC7CnD,GAAoBC,aAAAA,IAGpB5jC,IAAAA,CAAK8mC,WAAAA,GAAc,GACnB9mC,IAAAA,CAAKikC,YAAAA,GAAe,GACpBjkC,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,GAAS,GACxBN,IAAAA,CAAKgnC,aAAAA,GAAgB,GACrBhnC,IAAAA,CAAKinC,eAAAA,CAAgBz/B,KAAAA,IACrBxH,IAAAA,CAAKknC,OAAAA,CAAQ1/B,KAAAA,IACbxH,IAAAA,CAAKmnC,aAAAA,CAAc3/B,KAAAA,IACnBxH,IAAAA,CAAKonC,cAAAA,CAAe5/B,KAAAA;YACtB;QAAA;QG1YK,MAAM+iC;YAAb,aAAA;gBACkB,IAAA,CAAA9jC,IAAAA,GAAO,gBAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAElB,IAAA,CAAAyG,cAAAA,GAAyB,OAQzB,IAAA,CAAAC,eAAAA,GAA0B,GAC1B,IAAA,CAAAxG,YAAAA,GAAuB,GA+DvB,IAAA,CAAAyG,YAAAA,GAAet4B,EAAM8D,WAAAA,EACrB,IAAA,CAAAy0B,SAAAA,GAAYj8B,EAAI,GAAG,IACnB,IAAA,CAAAk8B,SAAAA,GAAYl8B,EAAI,GAAG,IACnB,IAAA,CAAAm8B,SAAAA,GAAYn8B,EAAI,GAAG,IACnB,IAAA,CAAAo8B,SAAAA,GAAYp8B,EAAI,GAAG;YAyR7B;YA1VE,WAAWyf,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAEhBrkC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA4O,gBClCN;oBDmCMD,cEnCN;gBAAA,IFqCI98B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAGbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYkE,EAAQriB,KAAAA,GAElDhiB,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACAre,MAAM,KAAS9P,IAAAA,CAAKwqC,cAAAA;oBACpB/jC,MAAM;gBAAA,IAGRzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAQ;yBAAA;wBACT;4BAAC;4BAAU;yBAAA;wBACX;4BAAC;4BAAa;yBAAA;wBACd;4BAAC;4BAAW;yBAAA;wBACZ;4BAAC;4BAAiB;yBAAA;wBAClB;4BAAC;4BAAqB;yBAAA;qBAAA;gBAAA,IAG1B78B,IAAAA,CAAKgoC,MAAAA,GAAS,IAAIhC,GAAgB7X,GAAInuB,IAAAA,CAAKwqC,cAAAA,EAAAA,CAAgB;YAC7D;YAEO,UAAApb;gBACLpvB,IAAAA,CAAKmlC,OAAAA,CAAQ/V,OAAAA,IACbpvB,IAAAA,CAAKgoC,MAAAA,CAAO5Y,OAAAA,IACZpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEQ,UAAAgW;gBACN,OAAIxkC,IAAAA,CAAKyqC,eAAAA,IAAmBzqC,IAAAA,CAAKwqC,cAInC;YAAA;YAEA,KAAA3qB,GAAQnI,CAAAA,EAAAA;gBACFA,CAAAA,CAAK,EAAA,YAAc5J,KAAU4J,CAAAA,CAAK,EAAA,YAAc5J,IAClD9N,IAAAA,CAAK+qC,QAAAA,CAAShyB,KAAAA,CAAM/Y,IAAAA,EAAM0X,KAE1B1X,IAAAA,CAAKgrC,aAAAA,CAAcjyB,KAAAA,CAAM/Y,IAAAA,EAAM0X;YAEnC;YAOA,SAAS1S,CAAAA,EAAeu/B,CAAAA,EAAa5wB,CAAAA,EAAcs3B,IAAoB,CAAA,EAAA;gBACjEjrC,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAEPzkC,IAAAA,CAAKyqC,eAAAA;gBAGL,MAAM1tB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EACxBwc,IAAcplC,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA,EAE5B9mB,IAAMimB,EAAIh0B,GAAAA,CAAIvL,IACd1E,IAASge,EAAI1O,SAAAA,EACbmB,IAASuN,EAAItO,SAAAA,GAAYc,aAAAA,IACzBo6B,IAAYD,IAAY,GASxBE,IAAWpuB,EAAUrJ,QAAAA,CAAS3C,EAAOd,KAAAA,CAAMi7B,GAAWlrC,IAAAA,CAAK2qC,SAAAA,EAAWv6B,GAAAA,CAAIpL,GAAOhF,IAAAA,CAAK2qC,SAAAA,GAAY3qC,IAAAA,CAAK2qC,SAAAA,GACvGS,IAAcruB,EAAUrJ,QAAAA,CAAS3C,EAAOd,KAAAA,CAAAA,CAAOi7B,GAAWlrC,IAAAA,CAAK4qC,SAAAA,EAAWx6B,GAAAA,CAAIpL,GAAOhF,IAAAA,CAAK4qC,SAAAA,GAAY5qC,IAAAA,CAAK4qC,SAAAA,GAC3GS,IAAStuB,EAAUrJ,QAAAA,CAAS3C,EAAOd,KAAAA,CAAMi7B,GAAWlrC,IAAAA,CAAK6qC,SAAAA,EAAWz6B,GAAAA,CAAIm0B,GAAKvkC,IAAAA,CAAK6qC,SAAAA,GAAY7qC,IAAAA,CAAK6qC,SAAAA,GACnGS,IAAYvuB,EAAUrJ,QAAAA,CAAS3C,EAAOd,KAAAA,CAAAA,CAAOi7B,GAAWlrC,IAAAA,CAAK8qC,SAAAA,EAAW16B,GAAAA,CAAIm0B,GAAKvkC,IAAAA,CAAK8qC,SAAAA,GAAY9qC,IAAAA,CAAK8qC,SAAAA;gBAEzG1F,KACF+F,CAAAA,EAAS7+B,CAAAA,GAAAA,CAAAA,CAAO6+B,CAAAA,EAAS7+B,CAAAA,GAAIg5B,EAAAA,GAC7B6F,EAAS/gC,CAAAA,GAAAA,CAAAA,CAAO+gC,CAAAA,EAAS/gC,CAAAA,GAAIk7B,EAAAA,GAE7B+F,EAAO/+B,CAAAA,GAAAA,CAAAA,CAAO++B,CAAAA,EAAO/+B,CAAAA,GAAIg5B,EAAAA,GACzB+F,EAAOjhC,CAAAA,GAAAA,CAAAA,CAAOihC,CAAAA,EAAOjhC,CAAAA,GAAIk7B,EAAAA,GAEzB8F,EAAY9+B,CAAAA,GAAAA,CAAAA,CAAO8+B,CAAAA,EAAY9+B,CAAAA,GAAIg5B,EAAAA,GACnC8F,EAAYhhC,CAAAA,GAAAA,CAAAA,CAAOghC,CAAAA,EAAYhhC,CAAAA,GAAIk7B,EAAAA,GAEnCgG,EAAUh/B,CAAAA,GAAAA,CAAAA,CAAOg/B,CAAAA,EAAUh/B,CAAAA,GAAIg5B,EAAAA,GAC/BgG,EAAUlhC,CAAAA,GAAAA,CAAAA,CAAOkhC,CAAAA,EAAUlhC,CAAAA,GAAIk7B,EAAAA,CAAAA;gBAIjC,MAKMiG,IAASvrC,IAAAA,CAAK0qC,YAAAA,EAKdvI,IAAeniC,IAAAA,CAAKuiC,OAAAA,CAAQJ,YAAAA,CAAaX,UAAAA;gBAG/CW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBkH,EAAS7+B,CAAAA,EAC7C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBkH,EAAS/gC,CAAAA,EAC7C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAfL,GAgBb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAfL,GAgBb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB3jC,GACpC6hC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgH,GACpC9I,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmH,EAAY9+B,CAAAA,EAChD61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmH,EAAYhhC,CAAAA,EAChD+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAjCL,GAkCb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA/BL,GAgCb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB3jC,GACpC6hC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgH,GACpC9I,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoH,EAAO/+B,CAAAA,EAC3C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoH,EAAOjhC,CAAAA,EAC3C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAjDL,GAkDb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAnDL,GAoDb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB3jC,GACpC6hC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgH,GACpC9I,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBqH,EAAUh/B,CAAAA,EAC9C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBqH,EAAUlhC,CAAAA,EAC9C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAnEL,GAoEb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAnEL,GAoEb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB3jC,GACpC6hC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgH,GACpC9I,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH;YACtC;YAEA,cACE3wB,CAAAA,EACAV,CAAAA,EACAE,CAAAA,EACA1G,CAAAA,EACA43B,IAAgBn5B,EAAM8D,WAAAA,EACtBs1B,IAA0B,CAAA,EAAA;gBAEtBxrC,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAEPzkC,IAAAA,CAAKyqC,eAAAA;gBAGL,MAAM1tB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EACxBwc,IAAcplC,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA,EAE5B7oB,IAAUQ,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAI,GAAG,MAC5C+N,IAAWM,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAIyL,GAAO,MACjDqC,IAAcO,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAIyL,GAAOE,MACpDqC,IAAaK,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAI,GAAG2L;gBAEjD+qB,KACF7oB,CAAAA,EAAQjQ,CAAAA,GAAAA,CAAAA,CAAOiQ,CAAAA,EAAQjQ,CAAAA,GAAIg5B,EAAAA,GAC3B/oB,EAAQnS,CAAAA,GAAAA,CAAAA,CAAOmS,CAAAA,EAAQnS,CAAAA,GAAIk7B,EAAAA,GAE3B7oB,EAASnQ,CAAAA,GAAAA,CAAAA,CAAOmQ,CAAAA,EAASnQ,CAAAA,GAAIg5B,EAAAA,GAC7B7oB,EAASrS,CAAAA,GAAAA,CAAAA,CAAOqS,CAAAA,EAASrS,CAAAA,GAAIk7B,EAAAA,GAE7B5oB,EAAWpQ,CAAAA,GAAAA,CAAAA,CAAOoQ,CAAAA,EAAWpQ,CAAAA,GAAIg5B,EAAAA,GACjC5oB,EAAWtS,CAAAA,GAAAA,CAAAA,CAAOsS,CAAAA,EAAWtS,CAAAA,GAAIk7B,EAAAA,GAEjC9oB,EAAYlQ,CAAAA,GAAAA,CAAAA,CAAOkQ,CAAAA,EAAYlQ,CAAAA,GAAIg5B,EAAAA,GACnC9oB,EAAYpS,CAAAA,GAAAA,CAAAA,CAAOoS,CAAAA,EAAYpS,CAAAA,GAAIk7B,EAAAA,CAAAA;gBAIrC,MAMMnD,IAAeniC,IAAAA,CAAKuiC,OAAAA,CAAQJ,YAAAA,CAAaX,UAAAA;gBAG/CW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB1nB,EAAQjQ,CAAAA,EAC5C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB1nB,EAAQnS,CAAAA,EAC5C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAXL,GAYb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAXL,GAYb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB9pB,GACpCgoB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB5pB,GACpC8nB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBvnB,EAAWpQ,CAAAA,EAC/C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBvnB,EAAWtS,CAAAA,EAC/C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA7BL,GA8Bb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA3BL,GA4Bb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB9pB,GACpCgoB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB5pB,GACpC8nB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBxnB,EAASnQ,CAAAA,EAC7C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBxnB,EAASrS,CAAAA,EAC7C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA7CL,GA8Cb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA/CL,GAgDb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB9pB,GACpCgoB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB5pB,GACpC8nB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,GAGpCrJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBznB,EAAYlQ,CAAAA,EAChD61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBznB,EAAYpS,CAAAA,EAChD+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA/DL,GAgEb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA/DL,GAgEb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB9pB,GACpCgoB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB5pB,GACpC8nB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH;YACtC;YAEA,kBAAA3G;gBACE,OAAgC,MAAzB7kC,IAAAA,CAAKyqC,eACd;YAAA;YAEA,QAAAhG;gBAEE,IAA6B,MAAzBzkC,IAAAA,CAAKyqC,eAAAA,EACP;gBAGF,MAAMtc,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEhBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAGbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,IAGjBv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAGxDhiB,IAAAA,CAAKgoC,MAAAA,CAAOnnB,IAAAA,IAGZsN,EAAGmc,YAAAA,CAAanc,EAAG2X,SAAAA,EAAkC,IAAvB9lC,IAAAA,CAAKyqC,eAAAA,EAAqBzqC,IAAAA,CAAKgoC,MAAAA,CAAOzB,YAAAA,EAAc,IAElF5C,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAKyqC,eAAAA,EAC7C9G,GAAoBC,aAAAA,IAGpB5jC,IAAAA,CAAKyqC,eAAAA,GAAkB,GACvBzqC,IAAAA,CAAKikC,YAAAA,GAAe;YACtB;QAAA;QGxWK,MAAMwH;YAAb,aAAA;gBACkB,IAAA,CAAAhlC,IAAAA,GAAO,aAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAElB,IAAA,CAAA2H,WAAAA,GAAsB,OAStB,IAAA,CAAAC,YAAAA,GAAuB,GACvB,IAAA,CAAA1H,YAAAA,GAAuB;YA+LjC;YA7LE,WAAW9V,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAChBrkC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA4O,gBClCN;oBDmCMD,cEnCN;gBAAA,IFqCI98B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAGbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYkE,EAAQriB,KAAAA,GAElDhiB,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACAre,MAAM,KAAS9P,IAAAA,CAAK0rC,WAAAA;oBACpBjlC,MAAM;gBAAA,IAGRzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAQ;yBAAA;wBACT;4BAAC;4BAAa;yBAAA;wBACd;4BAAC;4BAAW;yBAAA;wBACZ;4BAAC;4BAAiB;yBAAA;wBAClB;4BAAC;4BAAqB;yBAAA;qBAAA;gBAAA,IAI1B78B,IAAAA,CAAKgoC,MAAAA,GAAS,IAAIhC,GAAgB7X,GAAInuB,IAAAA,CAAK0rC,WAAAA,EAAAA,CAAa;YAC1D;YAEO,UAAAtc;gBACLpvB,IAAAA,CAAKmlC,OAAAA,CAAQ/V,OAAAA,IACbpvB,IAAAA,CAAKgoC,MAAAA,CAAO5Y,OAAAA,IACZpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEQ,UAAAgW;gBACN,OAAIxkC,IAAAA,CAAK2rC,YAAAA,IAAgB3rC,IAAAA,CAAK0rC,WAIhC;YAAA;YAEA,KAAK7wB,CAAAA,EAAa+wB,CAAAA,EAAgBj4B,CAAAA,EAAc43B,IAAgBn5B,EAAM8D,WAAAA,EAAas1B,IAA0B,CAAA,EAAA;gBACvGxrC,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAEPzkC,IAAAA,CAAK2rC,YAAAA;gBAGL,MAAM5uB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EACxBwc,IAAcplC,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA,EAE5B7oB,IAAUQ,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAAA,CAAKk9B,GAAAA,CAASA,MACnDnvB,IAAWM,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAIk9B,GAAAA,CAASA,MACnDpvB,IAAcO,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAIk9B,GAAQA,MACrDlvB,IAAaK,EAAUrJ,QAAAA,CAASmH,EAAIzK,GAAAA,CAAI1B,EAAAA,CAAKk9B,GAAQA;gBAEvDxG,KACF7oB,CAAAA,EAAQjQ,CAAAA,GAAAA,CAAAA,CAAOiQ,CAAAA,EAAQjQ,CAAAA,GAAIg5B,EAAAA,GAC3B/oB,EAAQnS,CAAAA,GAAAA,CAAAA,CAAOmS,CAAAA,EAAQnS,CAAAA,GAAIk7B,EAAAA,GAE3B7oB,EAASnQ,CAAAA,GAAAA,CAAAA,CAAOmQ,CAAAA,EAASnQ,CAAAA,GAAIg5B,EAAAA,GAC7B7oB,EAASrS,CAAAA,GAAAA,CAAAA,CAAOqS,CAAAA,EAASrS,CAAAA,GAAIk7B,EAAAA,GAE7B5oB,EAAWpQ,CAAAA,GAAAA,CAAAA,CAAOoQ,CAAAA,EAAWpQ,CAAAA,GAAIg5B,EAAAA,GACjC5oB,EAAWtS,CAAAA,GAAAA,CAAAA,CAAOsS,CAAAA,EAAWtS,CAAAA,GAAIk7B,EAAAA,GAEjC9oB,EAAYlQ,CAAAA,GAAAA,CAAAA,CAAOkQ,CAAAA,EAAYlQ,CAAAA,GAAIg5B,EAAAA,GACnC9oB,EAAYpS,CAAAA,GAAAA,CAAAA,CAAOoS,CAAAA,EAAYpS,CAAAA,GAAIk7B,EAAAA,CAAAA;gBAIrC,MAMMnD,IAAeniC,IAAAA,CAAKuiC,OAAAA,CAAQJ,YAAAA,CAAaX,UAAAA;gBAG/CW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB1nB,EAAQjQ,CAAAA,EAC5C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB1nB,EAAQnS,CAAAA,EAC5C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAXL,GAYb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAXL,GAYb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,IAAkBI,GAGtDzJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBvnB,EAAWpQ,CAAAA,EAC/C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBvnB,EAAWtS,CAAAA,EAC/C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA3BL,GA4Bb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAzBL,GA0Bb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,IAAkBI,GAGtDzJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBxnB,EAASnQ,CAAAA,EAC7C61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBxnB,EAASrS,CAAAA,EAC7C+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAzCL,GA0Cb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GA3CL,GA4Cb9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,IAAkBI,GAGtDzJ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBznB,EAAYlQ,CAAAA,EAChD61B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBznB,EAAYpS,CAAAA,EAChD+3B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAzDL,GA0Db9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAzDL,GA0Db9B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAM1Q,CAAAA,GAAI,KAC9Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMtB,CAAAA,GAAI,KAC9C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMrB,CAAAA,GAAI,KAC9C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBtwB,EAAMvR,CAAAA,EAC1C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOtoC,CAAAA,GAAI,KAC/Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOl5B,CAAAA,GAAI,KAC/C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOj5B,CAAAA,GAAI,KAC/C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBsH,EAAOnpC,CAAAA,EAC3C+/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBuH,IAAkBI;YACxD;YAEA,kBAAA/G;gBACE,OAA6B,MAAtB7kC,IAAAA,CAAK2rC,YACd;YAAA;YAEA,QAAAlH;gBAEE,IAA0B,MAAtBzkC,IAAAA,CAAK2rC,YAAAA,EACP;gBAGF,MAAMxd,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEhBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAGbv3B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,IAGjBv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAGxDhiB,IAAAA,CAAKgoC,MAAAA,CAAOnnB,IAAAA,IAGZsN,EAAGmc,YAAAA,CAAanc,EAAG2X,SAAAA,EAA+B,IAApB9lC,IAAAA,CAAK2rC,YAAAA,EAAkB3rC,IAAAA,CAAKgoC,MAAAA,CAAOzB,YAAAA,EAAc,IAE/E5C,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAK2rC,YAAAA,EAC7ChI,GAAoBC,aAAAA,IAGpB5jC,IAAAA,CAAK2rC,YAAAA,GAAe,GACpB3rC,IAAAA,CAAKikC,YAAAA,GAAe;YACtB;QAAA;QGxNK,MAAM4H;YAOX,YACSnkB,CAAAA,EACAokB,CAAAA,EACAC,IAAqB,GAAA,CAAA;gBAFrB,IAAA,CAAArkB,OAAAA,GAAAA,GACA,IAAA,CAAAokB,QAAAA,GAAAA,GACA,IAAA,CAAAC,UAAAA,GAAAA,GATF,IAAA,CAAAC,gBAAAA,GAAmB,GACnB,IAAA,CAAAxgC,KAAAA,GAAQ,GACR,IAAA,CAAAygC,OAAAA,GAAkB,EAAA,EAClB,IAAA,CAAAC,eAAAA,GAAAA,CAAkB,GACjB,IAAA,CAAArf,OAAAA,GAAUjW,EAAOS,WAAAA;YAMtB;YAEH,UAAA+X;gBACEpvB,IAAAA,CAAKisC,OAAAA,CAAQ3rC,MAAAA,GAAS;YACxB;YAEA,cAAA6rC;gBACE,IAAK,IAAI3rC,IAAI,GAAGA,IAAIR,IAAAA,CAAK+rC,UAAAA,EAAYvrC,IACnCR,IAAAA,CAAKisC,OAAAA,CAAQzrC,EAAAA,GAAKR,IAAAA,CAAK0nB,OAAAA;YAE3B;YAQA,MAAM2c,CAAAA,EAAAA;gBACJ,MAAMj5B,IAASi5B,EAAQrkC,IAAAA;gBACvB,OAAIoL,IACKpL,IAAAA,CAAKqsC,IAAAA,IAAQjhC,KAEfpL,IAAAA,CAAKqsC,IAAAA;YACd;YAMA,OAAOhI,CAAAA,EAAAA;gBAELA,EADerkC,IAAAA,CAAK2C,GAAAA,KAEpB3C,IAAAA,CAAKwL,KAAAA;YACP;YAKA,MAAA7I;gBAQE,IAPI3C,IAAAA,CAAKwL,KAAAA,KAAUxL,IAAAA,CAAK+rC,UAAAA,IACjB/rC,CAAAA,IAAAA,CAAKksC,eAAAA,IACRlsC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,+DAEpBrY,IAAAA,CAAK+rC,UAAAA,GAA+B,IAAlB/rC,IAAAA,CAAK+rC,UAAAA,AAAAA,GAGrB/rC,IAAAA,CAAKisC,OAAAA,CAAQjsC,IAAAA,CAAKwL,KAAAA,CAAAA,EAEpB,OAAIxL,IAAAA,CAAK8rC,QAAAA,GACA9rC,IAAAA,CAAK8rC,QAAAA,CAAS9rC,IAAAA,CAAKisC,OAAAA,CAAQjsC,IAAAA,CAAKwL,KAAAA,GAAAA,IAElCxL,IAAAA,CAAKisC,OAAAA,CAAQjsC,IAAAA,CAAKwL,KAAAA,GAAAA;gBAGzBxL,IAAAA,CAAKgsC,gBAAAA;gBAEL,OADgBhsC,IAAAA,CAAKisC,OAAAA,CAAQjsC,IAAAA,CAAKwL,KAAAA,GAAAA,GAAWxL,IAAAA,CAAK0nB,OAAAA;YAGtD;YAWA,KAAA2kB,GAAQJ,CAAAA,EAAAA;gBAENjsC,IAAAA,CAAKwL,KAAAA,GAAQ;gBACb,KAAK,MAAMuV,KAAUkrB,EAAS;oBAC5B,MAAMM,IAAYvsC,IAAAA,CAAKisC,OAAAA,CAAQxjC,OAAAA,CAAQsY;oBAEvC/gB,IAAAA,CAAKisC,OAAAA,CAAQM,EAAAA,GAAcvsC,IAAAA,CAAa0nB,OAAAA,IACxC1nB,IAAAA,CAAKgsC,gBAAAA;gBACP;gBACA,OAAOC;YACT;QAAA;QCxFK,MAAMO;YAAb,aAAA;gBACS,IAAA,CAAA3jB,CAAAA,GAAY,GACZ,IAAA,CAAAkb,QAAAA,GAAmB,GACnB,IAAA,CAAA0I,QAAAA,GAAmB,IACnB,IAAA,CAAA1vB,SAAAA,GAA0BqJ,EAAa7D,QAAAA,IACvC,IAAA,CAAAmqB,KAAAA,GAAuC;oBAC5C7jB,GAAG;oBACHD,SAAS;oBACTE,MAAM1W,EAAM0C,KAAAA;oBACZiU,UAAU;gBAAA,GAEL,IAAA,CAAArR,IAAAA,GAAc,IAAI3N,MAAM;YACjC;QAAA;QCyFO,MAAM4iC;YAcX,YAAY1zB,CAAAA,CAAAA;gBAbJ,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAGjB,IAAA,CAAA+B,MAAAA,GAAgBhH,EAAM8D,WAAAA,EACtB,IAAA,CAAAusB,YAAAA,GAAAA,CAAe,GAIf,IAAA,CAAAyE,OAAAA,GAAU,IAAI5Y,KACd,IAAA,CAAAyY,SAAAA,GAAY,IAAIzY;gBAKtB,MAAA,EAAM,OAAE3a,CAAAA,EAAK,MAAE8a,CAAAA,EAAI,cAAEqO,CAAAA,EAAY,gBAAEC,CAAAA,EAAc,iBAAE6P,CAAAA,EAAe,QAAEC,CAAAA,EAAAA,GAAW5zB;gBAK/E,IAJAjZ,IAAAA,CAAK8sC,KAAAA,GAAQre,QAAAA,IAAAA,IAAQ,sBACrBzuB,IAAAA,CAAK+sC,aAAAA,GAAgBjQ,QAAAA,IAAAA,IA3CG,6aA4CxB98B,IAAAA,CAAKgtC,eAAAA,GAAkBjQ,GACvB/8B,IAAAA,CAAKoZ,MAAAA,GAASzF,QAAAA,IAAAA,IAAS3T,IAAAA,CAAKoZ,MAAAA,EAAAA,CACvBwzB,GACH,MAAMzmC,MAAM,CAAA,SAAA,EAAYsoB,EAAAA,qDAAAA,CAAAA;gBAS1B,IAPIme,aAA2BK,KAC7BjtC,CAAAA,IAAAA,CAAKktC,gBAAAA,GAAmBN,GACxB5sC,IAAAA,CAAKmtC,WAAAA,CAAYP,EAAAA,IAEjB5sC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,SAAA,EAAYoW,EAAAA,iEAAAA,CAAAA,GAG5Boe,GACF,IAAK,MAAMvqC,KAAOuqC,EAChB7sC,IAAAA,CAAKotC,cAAAA,CAAe9qC,GAAKuqC,CAAAA,CAAOvqC,EAAAA;YAGtC;YAEQ,YAAY+qC,CAAAA,EAAAA;gBAClB,IAAIrtC,IAAAA,CAAKyiC,YAAAA,EACP;gBAEF,MAAMtU,IAAKkf,EAAqBC,IAAAA;gBAEhCttC,IAAAA,CAAKutC,gBAAAA,GAAmBpf,EAAGY,YAAAA,CAAaZ,EAAGyZ,uBAAAA,IAA2B,GACtE5nC,IAAAA,CAAK2iC,OAAAA,GAAU0K,EAAqBlR,YAAAA,CAAa;oBAC/CW,cAAc98B,IAAAA,CAAK+sC,aAAAA;oBACnBhQ,gBAAgB/8B,IAAAA,CAAKgtC,eAAAA;gBAAAA,IAEvBhtC,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IACbz9B,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe;YACtB;YAEA,IAAA,QAAI9uB;gBACF,OAAO3T,IAAAA,CAAKoZ,MACd;YAAA;YAEA,IAAA,MAAU3E,CAAAA,EAAAA;gBACRzU,IAAAA,CAAKoZ,MAAAA,GAAS3E;YAChB;YAEA,IAAA,OAAIga;gBAAAA,IAAAA;gBACF,OAAiB,SAAV,CAAA,IAAAzuB,IAAAA,CAAK8sC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI;YACvB;YAEA,IAAA,uBAAIU;gBACF,OAAOxtC,IAAAA,CAAKgtC,eAAAA,CAAgB/rB,QAAAA,CAAS;YACvC;YAEA,OAAOpd,CAAAA,EAAAA;gBACD7D,IAAAA,CAAK2iC,OAAAA,IACP3iC,CAAAA,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACb1zB,EAAS7D,IAAAA,CAAK2iC,OAAAA,CAAAA;YAElB;YAEA,YAAAgD;gBACE,OAAO3lC,IAAAA,CAAK2iC,OACd;YAAA;YAEA,eAAe+K,CAAAA,EAA4B/gB,CAAAA,EAAAA;gBACrC3sB,IAAAA,CAAKknC,OAAAA,CAAQp3B,IAAAA,GAAO9P,IAAAA,CAAKutC,gBAAAA,GAC3BvtC,IAAAA,CAAKknC,OAAAA,CAAQlc,GAAAA,CAAI0iB,GAAoB/gB,KAErC3sB,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,yBAAA,EAA4BrY,IAAAA,CAAKutC,gBAAAA,CAAAA,iCAAAA,EAAoDvtC,IAAAA,CAAKyuB,IAAAA,CAAAA,iEAAAA,CAAAA;YAIhG;YAEA,kBAAkBmf,CAAAA,EAAAA;gBAChB,MAAMjhB,IAAQ3sB,IAAAA,CAAKknC,OAAAA,CAAQvkC,GAAAA,CAAIirC;gBAC/B5tC,IAAAA,CAAKktC,gBAAAA,CAAiBxE,aAAAA,CAAc7Z,MAAAA,CAAOlC,EAAOA,KAAAA,GAClD3sB,IAAAA,CAAKknC,OAAAA,CAAQrY,MAAAA,CAAO+e;YACtB;YAEQ,iBAAiBjhB,CAAAA,EAAAA;gBACvB,MAAMmhB,IAAenhB,EAAMA,KAAAA,EACrB0b,IAAiByF,EAAaxF,YAAAA,CAAalX,GAA8BC,SAAAA,GACzE/B,IAAY+Y,IAAiB1a,GAAoB0a,KAAAA,KAAkBvnC,GACnEynC,IAAQza,GAAmBggB,EAAaxF,YAAAA,CAAalX,GAA8BE,SAAAA,IACnFkX,IAAQ1a,GAAmBggB,EAAaxF,YAAAA,CAAalX,GAA8BG,SAAAA,IAEnFkX,IAAqD,WAA7CqF,EAAaxF,YAAAA,CAAa,gBAClCpX,IAAUlxB,IAAAA,CAAKktC,gBAAAA,CAAiBxE,aAAAA,CAAcze,IAAAA,CAClD6jB,GACA;oBACExe,WAAAA;oBACAC,UAAU;wBAAEjjB,GAAGi8B;wBAAOn+B,GAAGo+B;oBAAAA;gBAAAA,GAE3BC;gBAQF,OALAqF,EAAanF,eAAAA,CAAgB,gBACxB3oC,IAAAA,CAAK+mC,SAAAA,CAAUhvB,GAAAA,CAAI4U,MACtB3sB,IAAAA,CAAK+mC,SAAAA,CAAU/b,GAAAA,CAAI2B,GAAOuE,IAGrBA;YACT;YAEA,cAAc/C,CAAAA,EAA4B6f,IAA8B,CAAA,EAAA;gBACtE,IAAIC,IAAcD;gBAClB,KAAK,MAAA,CAAOJ,GAAajhB,EAAAA,IAAU3sB,IAAAA,CAAKknC,OAAAA,CAAQgH,OAAAA,GAAW;oBACzD,IAAA,CAAKvhB,EAAM9C,QAAAA,IAAY;wBACrB7pB,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,CAAA,YAAA,EAAeq1B,EAAAA,aAAAA,EAA2B5tC,IAAAA,CAAKyuB,IAAAA,CAAAA,kIAAAA,CAAAA;wBAGjD;oBACF;oBACA,MAAMyC,IAAUlxB,IAAAA,CAAK6tC,gBAAAA,CAAiBlhB;oBAEtCwB,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAWwW,IAC/B9f,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYuB,IAC9BlxB,IAAAA,CAAK2iC,OAAAA,CAAQtD,gBAAAA,CAAiBuO,GAAaK,IAE3CA;gBACF;YACF;YAEA,MAAA1W;gBACE,IAAA,CAAIv3B,IAAAA,CAAKyiC,YAAAA,EAMP,MAAMt8B,MAAM,CAAA,SAAA,EAAYnG,IAAAA,CAAKyuB,IAAAA,CAAAA,4FAAAA,CAAAA;gBAJ7BzuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAEbv3B,IAAAA,CAAK2iC,OAAAA,CAAQzC,uBAAAA,CAAwB,WAAWlgC,IAAAA,CAAKoZ,MAAAA;YAIzD;QAAA;QCnPK,MAAM+0B;YAAb,aAAA;gBACkB,IAAA,CAAA1nC,IAAAA,GAAe,eACxB,IAAA,CAAAs9B,QAAAA,GAAmB,GAIlB,IAAA,CAAAgD,SAAAA,GAA4B,EA+NtC;YAAA;YA3NE,WAAW5Y,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAGhBrkC,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACAre,MAAM;oBACNrJ,MAAM;gBAAA,IAIRzG,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACAgU,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAQ;yBAAA;wBACT;4BAAC;4BAAc;yBAAA;qBAAA;oBAEjB6F,kBAAAA,CAAkB;gBAAA,IAIpB1iC,IAAAA,CAAKgoC,MAAAA,GAAS,IAAIhC,GAAgB7X,GAAI,GAAA,CAAG;YAC3C;YAEO,UAAAiB;gBACLpvB,IAAAA,CAAKmlC,OAAAA,CAAQ/V,OAAAA,IACbpvB,IAAAA,CAAKgoC,MAAAA,CAAO5Y,OAAAA,IACZpvB,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,GAAS,GACxBN,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEA,KACE7B,CAAAA,EACAlK,CAAAA,EACAC,CAAAA,EACAymB,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAEA,MAAMrb,IAAKnuB,IAAAA,CAAKwuB,GAAAA,EAGVzF,IAAW/oB,IAAAA,CAAKskC,QAAAA,CAASvb,QAAAA;gBAC/B,IAAA,CAAKA,GACH;gBAGF,MAAMhM,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA,EAGxBsT,IAASnT,EAAS4c,SAAAA,IAKlBxD,IAAeniC,IAAAA,CAAKuiC,OAAAA,CAAQJ,YAAAA,CAAaX,UAAAA;gBAC/C,IAAI4M,IAAc,GAEdj0B,IAAAA,AAAQwS,CAAAA,QAAAA,IAAAA,KAAK,IAALA,EAAOxS,KAAAA,AAAAA,KAASgvB,KAAU,GAClC9uB,IAAAA,AAASsS,CAAAA,QAAAA,IAAAA,KAAK,IAALA,EAAOtS,MAAAA,AAAAA,KAAU+uB,KAAW,GACrCiF,IAAO;oBAAC;oBAAG;oBAAyB,SAAtB,CAAA,IAAAlF,QAAAA,IAAAA,IAAUxc,QAAAA,IAAAA,KAAK,IAALA,EAAOxS,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI;oBAA2B,SAAxB,CAAA,IAAAivB,QAAAA,IAAAA,IAAWzc,QAAAA,IAAAA,KAAK,IAALA,EAAOtS,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;iBAAA,EACvE/J,IAAO;oBAACmS,QAAAA,IAAAA,IAAM;oBAAGC,QAAAA,IAAAA,IAAM;iBAAA;gBAAA,KAEhB5hB,MAAPuoC,KAAAA,KAA2BvoC,MAAPwoC,KAAAA,KAA+BxoC,MAAXyoC,KAAAA,KAAoCzoC,MAAZ0oC,KAClE6E,CAAAA,IAAO;oBAAC5rB,QAAAA,IAAAA,IAAM;oBAAGC,QAAAA,IAAAA,IAAM;oBAAyB,SAAtB,CAAA,IAAAymB,QAAAA,IAAAA,IAAUxc,QAAAA,IAAAA,KAAK,IAALA,EAAOxS,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI;oBAA2B,SAAxB,CAAA,IAAAivB,QAAAA,IAAAA,IAAWzc,QAAAA,IAAAA,KAAK,IAALA,EAAOtS,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;iBAAA,EACnF/J,IAAO;oBAAC+4B;oBAAIC;iBAAAA,EACZnvB,IAAQovB,GACRlvB,IAASmvB,CAAAA,GAGX/mB,IAAK4rB,CAAAA,CAAK,EAAA,EACV3rB,IAAK2rB,CAAAA,CAAK,EAAA;gBACV,MAAM1E,IAAK0E,CAAAA,CAAK,EAAA,EACVzE,IAAKyE,CAAAA,CAAK,EAAA,EAEV9xB,IAAU7N,EAAI4B,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,GAC5BmM,IAAW/N,EAAI4B,CAAAA,CAAK,EAAA,GAAK6J,GAAO7J,CAAAA,CAAK,EAAA,GACrCoM,IAAahO,EAAI4B,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,GAAK+J,IACpCmC,IAAc9N,EAAI4B,CAAAA,CAAK,EAAA,GAAK6J,GAAO7J,CAAAA,CAAK,EAAA,GAAK+J,IAE7CyvB,IAAand,EAAMxS,KAAAA,IAASA,GAC5B4vB,IAAcpd,EAAMtS,MAAAA,IAAUA,GAE9B2vB,IAAOvnB,IAAKqnB,GACZG,IAAOvnB,IAAKqnB,GACZG,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK,GAAA,IAAQG,GAC1BK,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK,GAAA,IAAQG,GAE1BuE,IAAgBvxB,EAAUW,WAAAA,IAC1B6wB,IAAoBD,EAAcl+B,GAAAA,CAAIoM,IACtCgyB,IAAaF,EAAchiC,CAAAA,GAAItM,IAAAA,CAAKskC,QAAAA,CAASnqB,KAAAA,EAC7Cs0B,IAAaH,EAAclkC,CAAAA,GAAIpK,IAAAA,CAAKskC,QAAAA,CAASjqB,MAAAA,EAC7Cq0B,IAAaH,EAAkBjiC,CAAAA,GAAItM,IAAAA,CAAKskC,QAAAA,CAASnqB,KAAAA,EACjDw0B,IAAaJ,EAAkBnkC,CAAAA,GAAIpK,IAAAA,CAAKskC,QAAAA,CAASjqB,MAAAA;gBAGvD8nB,CAAAA,CAAaiM,IAAAA,GAAiB7xB,EAAQjQ,CAAAA,EACtC61B,CAAAA,CAAaiM,IAAAA,GAAiB7xB,EAAQnS,CAAAA,EACtC+3B,CAAAA,CAAaiM,IAAAA,GAAiBpE,GAC9B7H,CAAAA,CAAaiM,IAAAA,GAAiBnE,GAC9B9H,CAAAA,CAAaiM,IAAAA,GAAiBI,GAC9BrM,CAAAA,CAAaiM,IAAAA,GAAiBK,GAG9BtM,CAAAA,CAAaiM,IAAAA,GAAiB1xB,EAAWpQ,CAAAA,EACzC61B,CAAAA,CAAaiM,IAAAA,GAAiB1xB,EAAWtS,CAAAA,EACzC+3B,CAAAA,CAAaiM,IAAAA,GAAiBpE,GAC9B7H,CAAAA,CAAaiM,IAAAA,GAAiBjE,GAC9BhI,CAAAA,CAAaiM,IAAAA,GAAiBI,GAC9BrM,CAAAA,CAAaiM,IAAAA,GAAiBO,GAG9BxM,CAAAA,CAAaiM,IAAAA,GAAiB3xB,EAASnQ,CAAAA,EACvC61B,CAAAA,CAAaiM,IAAAA,GAAiB3xB,EAASrS,CAAAA,EACvC+3B,CAAAA,CAAaiM,IAAAA,GAAiBlE,GAC9B/H,CAAAA,CAAaiM,IAAAA,GAAiBnE,GAC9B9H,CAAAA,CAAaiM,IAAAA,GAAiBM,GAC9BvM,CAAAA,CAAaiM,IAAAA,GAAiBK,GAG9BtM,CAAAA,CAAaiM,IAAAA,GAAiB5xB,EAAYlQ,CAAAA,EAC1C61B,CAAAA,CAAaiM,IAAAA,GAAiB5xB,EAAYpS,CAAAA,EAC1C+3B,CAAAA,CAAaiM,IAAAA,GAAiBlE,GAC9B/H,CAAAA,CAAaiM,IAAAA,GAAiBjE,GAC9BhI,CAAAA,CAAaiM,IAAAA,GAAiBM,GAC9BvM,CAAAA,CAAaiM,IAAAA,GAAiBO;gBAG9B,MAAMzd,IAAUlxB,IAAAA,CAAKooC,kBAAAA,CAAmBzb;gBAGxC5D,EAASwO,GAAAA,IAETv3B,IAAAA,CAAKuiC,OAAAA,CAAQrG,MAAAA,GAASA,GAEtBl8B,IAAAA,CAAKuiC,OAAAA,CAAQhL,GAAAA,CAAAA,CAAI,IAGjB2E,EAAO0D,kBAAAA,CAAmB,aAAagP,YAAY1pC,GAAAA,KAGnDg3B,EAAO0D,kBAAAA,CAAmB,aAAahX,IAGvCsT,EAAO8D,wBAAAA,CAAyB,gBAAgBtxB,EAAI1O,IAAAA,CAAKskC,QAAAA,CAASnqB,KAAAA,EAAOna,IAAAA,CAAKskC,QAAAA,CAASjqB,MAAAA,IAGvF6hB,EAAO8D,wBAAAA,CAAyB,wBAAwBtxB,EAAIo7B,GAAYC,KAGxE7N,EAAO8D,wBAAAA,CAAyB,UAAUtxB,EAAIi7B,GAAIC,KAGlD1N,EAAOmE,mBAAAA,CAAoB,YAAYrgC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAGrDka,EAAOmE,mBAAAA,CAAoB,eAAetjB,EAAUuK,KAAAA,KAGpD6G,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAW,IAC/BtJ,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYuB,IAC9BgL,EAAOmD,gBAAAA,CAAiB,aAAa,IAGrClR,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAW,IAC/BtJ,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAKskC,QAAAA,CAASuK,qBAAAA,GAC5C3S,EAAOmD,gBAAAA,CAAiB,oBAAoB,IAG5CtW,EAASglB,aAAAA,CAAc5f,IAGvBnuB,IAAAA,CAAKgoC,MAAAA,CAAOnnB,IAAAA,IAGZsN,EAAGmc,YAAAA,CAAanc,EAAG2X,SAAAA,EAAW,GAAG9lC,IAAAA,CAAKgoC,MAAAA,CAAOzB,YAAAA,EAAc,IAE3D5C,GAAoBE,gBAAAA,IACpBF,GAAoBC,aAAAA;YACtB;YAEQ,mBAAmBjX,CAAAA,EAAAA;gBACzB,MAAM0b,IAAiB1b,EAAM2b,YAAAA,CAAalX,GAA8BC,SAAAA,GAClE/B,IAAY+Y,IAAiB1a,GAAoB0a,KAAAA,KAAkBvnC,GACnEynC,IAAQza,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BE,SAAAA,IAC5EkX,IAAQ1a,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BG,SAAAA,IAE5EkX,IAA8C,WAAtC9b,EAAM2b,YAAAA,CAAa,gBAC3BpX,IAAUlxB,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAcze,IAAAA,CAC1C0C,GACA;oBACE2C,WAAAA;oBACAC,UAAU;wBAAEjjB,GAAGi8B;wBAAOn+B,GAAGo+B;oBAAAA;gBAAAA,GAE3BC;gBAQF,OALA9b,EAAMgc,eAAAA,CAAgB,gBAAA,OAClB3oC,IAAAA,CAAK+mC,SAAAA,CAAUt+B,OAAAA,CAAQyoB,MACzBlxB,IAAAA,CAAK+mC,SAAAA,CAAUpnC,IAAAA,CAAKuxB,IAGfA;YACT;YAEA,kBAAA2T;gBACE,OAAA,CAAO;YACT;YACA,QAAAJ,CAEA;QAAA;QC7OF,IAAYqK,ICaAC,IAWAC;QAAAA,CDxBZ,SAAYF,CAAAA;YAKV,EAAA,KAAA,GAAA,SAKA,EAAA,MAAA,GAAA;QACD,EAXWA,MAAAA,CAAAA,KAAU,CAAA,CAAA;QEKf,MAAMG,WAAmBnhC;YAK9B,YAAYmL,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM,GAAG,IACT5sB,IAAAA,CAAKkvC,KAAAA,GAAQj2B,EAAQk2B,IAAAA,EACrBnvC,IAAAA,CAAKovC,KAAAA,GAAQn2B,EAAQo2B,IAAAA,EACrBrvC,IAAAA,CAAKsvC,KAAAA,GAAQr2B,EAAQs2B,IAAAA,EACrBvvC,IAAAA,CAAKwvC,KAAAA,GAAQv2B,EAAQw2B,IACvB;YAAA;YACA,IAAA,IAAWnjC;gBACT,OAAQtM,IAAAA,CAAKyN,EAAAA,GAAKzN,IAAAA,CAAKkvC,KAAAA;YACzB;YAEA,IAAA,EAAaziC,CAAAA,EAAAA;gBACXzM,IAAAA,CAAKsvC,KAAAA,CAAM7iC,IACXzM,IAAAA,CAAKyN,EAAAA,GAAKhB;YACZ;YAEA,IAAA,IAAWrC;gBACT,OAAQpK,IAAAA,CAAKkP,EAAAA,GAAKlP,IAAAA,CAAKovC,KAAAA;YACzB;YACA,IAAA,EAAa3iC,CAAAA,EAAAA;gBACXzM,IAAAA,CAAKwvC,KAAAA,CAAM/iC,IACXzM,IAAAA,CAAKkP,EAAAA,GAAKzC;YACZ;QAAA;QC9BK,MAAMijC,WAAoB5hC;YAC/B,YACS6hC,CAAAA,EACA9kB,CAAAA,CAAAA;gBAEP+B,KAAAA,CAAM+iB,EAASrjC,CAAAA,EAAGqjC,EAASvlC,CAAAA,GAHpB,IAAA,CAAAulC,QAAAA,GAAAA,GACA,IAAA,CAAA9kB,MAAAA,GAAAA;YAGT;YACA,IAAA,IAAWve;gBACT,OAAQtM,IAAAA,CAAKyN,EAAAA,GAAKzN,IAAAA,CAAK2vC,QAAAA,CAASrjC,CAClC;YAAA;YAEA,IAAA,EAAasjC,CAAAA,EAAAA;gBACPA,MAAS5vC,IAAAA,CAAKyN,EAAAA,IAChBzN,CAAAA,IAAAA,CAAK6qB,MAAAA,CAAO+kB,GAAM5vC,IAAAA,CAAKkP,EAAAA,GACvBlP,IAAAA,CAAKyN,EAAAA,GAAKzN,IAAAA,CAAK2vC,QAAAA,CAASrjC,CAAAA,GAAIsjC,CAAAA;YAEhC;YAEA,IAAA,IAAWxlC;gBACT,OAAQpK,IAAAA,CAAKkP,EAAAA,GAAKlP,IAAAA,CAAK2vC,QAAAA,CAASvlC,CAClC;YAAA;YAEA,IAAA,EAAaylC,CAAAA,EAAAA;gBACPA,MAAS7vC,IAAAA,CAAKkP,EAAAA,IAChBlP,CAAAA,IAAAA,CAAK6qB,MAAAA,CAAO7qB,IAAAA,CAAKyN,EAAAA,EAAIoiC,IACrB7vC,IAAAA,CAAKkP,EAAAA,GAAKlP,IAAAA,CAAK2vC,QAAAA,CAASvlC,CAAAA,GAAIylC,CAAAA;YAEhC;YAES,MAAMvjC,CAAAA,EAAWlC,CAAAA,EAAAA;gBACxBpK,IAAAA,CAAKsM,CAAAA,GAAIA,GACTtM,IAAAA,CAAKoK,CAAAA,GAAIA;YACX;QAAA;QC/BK,MAAM;YAAb,aAAA;gBACU,IAAA,CAAA0lC,OAAAA,GAA4B,MAoB5B,IAAA,CAAAC,SAAAA,GAAyB,EAAA,EAEzB,IAAA,CAAA52B,IAAAA,GAAe,IAAIu2B,GAAYhhC,EAAI,GAAG,IAAI;oBAChD1O,IAAAA,CAAKgwC,SAAAA;gBAAW,IAoBV,IAAA,CAAAC,UAAAA,GAAa,IAAIhB,GAAW;oBAClCE,MAAM,IAAMnvC,IAAAA,CAAKgd,MAAAA,CAAOvb,IAAAA,CAAK,EAAA;oBAC7B4tC,MAAM,IAAMrvC,IAAAA,CAAKgd,MAAAA,CAAOvb,IAAAA,CAAK,EAAA;oBAC7B8tC,MAAOjjC,CAAAA;wBACL,IAAItM,IAAAA,CAAKkwC,MAAAA,EAAQ;4BACf,MAAA,EAAQ5jC,GAAGsjC,CAAAA,EAAAA,GAAS5vC,IAAAA,CAAKkwC,MAAAA,CAAO1pB,OAAAA,CAAQ9S,QAAAA,CAAShF,EAAIpC,GAAGtM,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA;4BACjEpK,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,GAAIsjC;wBACf,OACE5vC,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,GAAIA;wBAEXA,MAAMtM,IAAAA,CAAKgd,MAAAA,CAAOvb,IAAAA,CAAK,EAAA,IACzBzB,IAAAA,CAAKgwC,SAAAA;oBACP;oBAEFP,MAAOrlC,CAAAA;wBACL,IAAIpK,IAAAA,CAAKkwC,MAAAA,EAAQ;4BACf,MAAA,EAAQ9lC,GAAGylC,CAAAA,EAAAA,GAAS7vC,IAAAA,CAAKkwC,MAAAA,CAAO1pB,OAAAA,CAAQ9S,QAAAA,CAAShF,EAAI1O,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,EAAGlC;4BACjEpK,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,GAAIylC;wBACf,OACE7vC,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,GAAIA;wBAEXA,MAAMpK,IAAAA,CAAKgd,MAAAA,CAAOvb,IAAAA,CAAK,EAAA,IACzBzB,IAAAA,CAAKgwC,SAAAA;oBACP;gBAAA,IAOI,IAAA,CAAAtkB,SAAAA,GAAoB,GA+BpB,IAAA,CAAApF,MAAAA,GAAiB,IAAIopB,GAAYhhC,EAAI,GAAG,IAAI;oBAClD1O,IAAAA,CAAKgwC,SAAAA;gBAAW,IAkBV,IAAA,CAAAG,YAAAA,GAAe,IAAIlB,GAAW;oBACpCE,MAAM,IAAOnvC,IAAAA,CAAKkwC,MAAAA,GAASlwC,IAAAA,CAAKgd,MAAAA,CAAOuI,SAAAA,KAAcvlB,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;oBAChE+iC,MAAM,IAAOrvC,IAAAA,CAAKkwC,MAAAA,GAASlwC,IAAAA,CAAKgd,MAAAA,CAAOsI,SAAAA,KAActlB,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;oBAChEmlC,MAAOjjC,CAAAA;wBACL,IAAItM,IAAAA,CAAKkwC,MAAAA,EAAQ;4BACf,MAAME,IAAepwC,IAAAA,CAAKkwC,MAAAA,CAAOG,WAAAA,CAAY/jC,CAAAA;4BAC7CtM,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAAIA,IAAI8jC;wBACrB,OACEpwC,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAAIA;oBACjB;oBAEFmjC,MAAOrlC,CAAAA;wBACL,IAAIpK,IAAAA,CAAKkwC,MAAAA,EAAQ;4BACf,MAAMI,IAAetwC,IAAAA,CAAKkwC,MAAAA,CAAOG,WAAAA,CAAYjmC,CAAAA;4BAC7CpK,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GAAIA,IAAIkmC;wBACrB,OACEtwC,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GAAIA;oBACjB;gBAAA,IAOI,IAAA,CAAAmmC,EAAAA,GAAa,GA0Bb,IAAA,CAAAC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAC,eAAAA,GAAAA,CAAkB,GAClB,IAAA,CAAAC,OAAAA,GAAUtqB,EAAa7D,QAAAA,IACvB,IAAA,CAAAouB,QAAAA,GAAWvqB,EAAa7D,QAAAA,IA+BxB,IAAA,CAAAquB,QAAAA,GAAWxqB,EAAa7D,QAAAA;YA+ElC;YA7RE,IAAA,SAAI2tB;gBACF,OAAOlwC,IAAAA,CAAK8vC,OACd;YAAA;YACA,IAAA,OAAW/yB,CAAAA,EAAAA;gBACT,IAAI/c,IAAAA,CAAK8vC,OAAAA,EAAS;oBAChB,MAAMtkC,IAAQxL,IAAAA,CAAK8vC,OAAAA,CAAQC,SAAAA,CAAUtnC,OAAAA,CAAQzI,IAAAA;oBACzCwL,IAAAA,MACFxL,IAAAA,CAAK8vC,OAAAA,CAAQC,SAAAA,CAAUrnC,MAAAA,CAAO8C,GAAO;gBAEzC;gBACAxL,IAAAA,CAAK8vC,OAAAA,GAAU/yB,GACX/c,IAAAA,CAAK8vC,OAAAA,IACP9vC,IAAAA,CAAK8vC,OAAAA,CAAQC,SAAAA,CAAUpwC,IAAAA,CAAKK,IAAAA,GAE9BA,IAAAA,CAAKgwC,SAAAA;YACP;YACA,IAAA,WAAIa;gBACF,OAAO7wC,IAAAA,CAAK+vC,SACd;YAAA;YAMA,IAAA,IAAQxgC,CAAAA,EAAAA;gBACNvP,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,GAAIiD,EAAEjD,CAAAA,EAChBtM,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,GAAImF,EAAEnF,CAClB;YAAA;YACA,IAAA,MAAIyQ;gBACF,OAAO7a,IAAAA,CAAKmZ,IACd;YAAA;YAEA,IAAA,UAAc5J,CAAAA,EAAAA;gBACZ,IAAIwhC,IAAWxhC,EAAE0C,KAAAA;gBACbjS,IAAAA,CAAKkwC,MAAAA,IACPa,CAAAA,IAAW/wC,IAAAA,CAAKkwC,MAAAA,CAAO1pB,OAAAA,CAAQ9S,QAAAA,CAASnE,EAAAA,GAErCwhC,EAAS3hC,MAAAA,CAAOpP,IAAAA,CAAKmZ,IAAAA,KACxBnZ,CAAAA,IAAAA,CAAKmZ,IAAAA,GAAO43B,GACZ/wC,IAAAA,CAAKgwC,SAAAA,EAAAA;YAET;YA2BA,IAAA,YAAIc;gBACF,OAAO9wC,IAAAA,CAAKiwC,UACd;YAAA;YAGA,IAAA,SAAattB,CAAAA,EAAAA;gBACX,MAAMquB,IAAgBhkC,EAAkB2V;gBACpCquB,MAAkBhxC,IAAAA,CAAK0rB,SAAAA,IACzB1rB,IAAAA,CAAKgwC,SAAAA,IAEPhwC,IAAAA,CAAK0rB,SAAAA,GAAYslB;YACnB;YACA,IAAA,WAAIruB;gBACF,OAAO3iB,IAAAA,CAAK0rB,SACd;YAAA;YAEA,IAAA,eAAmB/I,CAAAA,EAAAA;gBACjB,IAAIuuB,IAAkB;gBAClBlxC,IAAAA,CAAKkwC,MAAAA,IACPgB,CAAAA,IAAkBlxC,IAAAA,CAAKkwC,MAAAA,CAAOe,cAAAA,AAAAA;gBAEhC,MAAMD,IAAgBhkC,EAAkB2V,IAAWuuB;gBAC/CF,MAAkBhxC,IAAAA,CAAK0rB,SAAAA,IACzB1rB,IAAAA,CAAKgwC,SAAAA,IAEPhwC,IAAAA,CAAK0rB,SAAAA,GAAYslB;YACnB;YAEA,IAAA,iBAAIC;gBACF,OAAIjxC,IAAAA,CAAKkwC,MAAAA,GACAlwC,IAAAA,CAAKgd,MAAAA,CAAOqI,WAAAA,KAEdrlB,IAAAA,CAAK2iB,QACd;YAAA;YAKA,IAAA,MAAUpT,CAAAA,EAAAA;gBACRvP,IAAAA,CAAKsmB,MAAAA,CAAOha,CAAAA,GAAIiD,EAAEjD,CAAAA,EAClBtM,IAAAA,CAAKsmB,MAAAA,CAAOlc,CAAAA,GAAImF,EAAEnF,CACpB;YAAA;YACA,IAAA,QAAI6F;gBACF,OAAOjQ,IAAAA,CAAKsmB,MACd;YAAA;YAEA,IAAA,YAAgB/W,CAAAA,EAAAA;gBACd,IAAI4hC,IAAeziC,EAAI,GAAG;gBACtB1O,IAAAA,CAAKkwC,MAAAA,IACPiB,CAAAA,IAAenxC,IAAAA,CAAKkwC,MAAAA,CAAOG,WAAAA,AAAAA,GAE7BrwC,IAAAA,CAAKiQ,KAAAA,GAAQV,EAAEU,KAAAA,CAAMvB,EAAI,IAAIyiC,EAAa7kC,CAAAA,EAAG,IAAI6kC,EAAa/mC,CAAAA;YAChE;YAsBA,IAAA,cAAIimC;gBACF,OAAOrwC,IAAAA,CAAKmwC,YACd;YAAA;YAIA,IAAA,EAAMtnB,CAAAA,EAAAA;gBACJ7oB,IAAAA,CAAKuwC,EAAAA,GAAK1nB,GACV7oB,IAAAA,CAAKgwC,SAAAA;YACP;YAEA,IAAA,IAAInnB;gBACF,OAAO7oB,IAAAA,CAAKuwC,EACd;YAAA;YAEA,IAAA,QAAY1nB,CAAAA,EAAAA;gBACN7oB,IAAAA,CAAKkwC,MAAAA,GACPlwC,IAAAA,CAAK6oB,CAAAA,GAAIA,IAAI7oB,IAAAA,CAAKkwC,MAAAA,CAAOkB,OAAAA,GAEzBpxC,IAAAA,CAAK6oB,CAAAA,GAAIA;YAEb;YAEA,IAAA,UAAIuoB;gBACF,OAAIpxC,IAAAA,CAAKkwC,MAAAA,GACAlwC,IAAAA,CAAK6oB,CAAAA,GAAI7oB,IAAAA,CAAKkwC,MAAAA,CAAOkB,OAAAA,GAEvBpxC,IAAAA,CAAK6oB,CACd;YAAA;YAaA,IAAA,SAAW7L;gBAST,OARIhd,IAAAA,CAAKwwC,QAAAA,IACa,CAAA,SAAhBxwC,IAAAA,CAAKkwC,MAAAA,GACPlwC,IAAAA,CAAKqxC,gBAAAA,GAAmBp/B,KAAAA,CAAMjS,IAAAA,CAAK0wC,OAAAA,IAEnC1wC,IAAAA,CAAKkwC,MAAAA,CAAOlzB,MAAAA,CAAOtJ,QAAAA,CAAS1T,IAAAA,CAAKqxC,gBAAAA,IAAoBp/B,KAAAA,CAAMjS,IAAAA,CAAK0wC,OAAAA,GAElE1wC,IAAAA,CAAKwwC,QAAAA,GAAAA,CAAW,CAAA,GAEXxwC,IAAAA,CAAK0wC,OACd;YAAA;YAKA,IAAA,UAAWlqB;gBAKT,OAJIxmB,IAAAA,CAAKywC,eAAAA,IACPzwC,CAAAA,IAAAA,CAAKgd,MAAAA,CAAOwJ,OAAAA,CAAQxmB,IAAAA,CAAK2wC,QAAAA,GACzB3wC,IAAAA,CAAKywC,eAAAA,GAAAA,CAAkB,CAAA,GAElBzwC,IAAAA,CAAK2wC,QACd;YAAA;YAGQ,mBAAAU;gBAQN,OAPArxC,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAIvO,IAAAA,CAAK0rB,SAAAA,GACtC1rB,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAK6D,KAAKkJ,GAAAA,CAAIxO,IAAAA,CAAK0rB,SAAAA,GACtC1rB,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAA,CAAM6D,KAAKkJ,GAAAA,CAAIxO,IAAAA,CAAK0rB,SAAAA,GACvC1rB,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAK6D,KAAKiJ,GAAAA,CAAIvO,IAAAA,CAAK2iB,QAAAA,GACtC3iB,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,EAClCtM,IAAAA,CAAK4wC,QAAAA,CAASnvC,IAAAA,CAAK,EAAA,GAAKzB,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,EAClCpK,IAAAA,CAAK4wC,QAAAA,CAAS3gC,KAAAA,CAAMjQ,IAAAA,CAAKsmB,MAAAA,CAAOha,CAAAA,EAAGtM,IAAAA,CAAKsmB,MAAAA,CAAOlc,CAAAA,GACxCpK,IAAAA,CAAK4wC,QACd;YAAA;YAEO,YAAAZ;gBACLhwC,IAAAA,CAAKwwC,QAAAA,GAAAA,CAAW,GAChBxwC,IAAAA,CAAKywC,eAAAA,GAAAA,CAAkB;gBACvB,IAAK,IAAIjwC,IAAI,GAAGA,IAAIR,IAAAA,CAAK+vC,SAAAA,CAAUzvC,MAAAA,EAAQE,IACzCR,IAAAA,CAAK+vC,SAAAA,CAAUvvC,EAAAA,CAAGwvC,SAAAA;YAEtB;YAEO,MAAMpzB,CAAAA,EAAAA;gBACX,OAAO5c,IAAAA,CAAKgd,MAAAA,CAAOtJ,QAAAA,CAASkJ;YAC9B;YAEO,aAAaA,CAAAA,EAAAA;gBAClB,OAAO5c,IAAAA,CAAKwmB,OAAAA,CAAQ9S,QAAAA,CAASkJ;YAC/B;YAEO,aAAa/B,CAAAA,EAAa8H,CAAAA,EAAkB1S,CAAAA,EAAAA;gBACjDjQ,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,GAAIuO,EAAIvO,CAAAA,EAClBtM,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,GAAIyQ,EAAIzQ,CAAAA,EAClBpK,IAAAA,CAAK0rB,SAAAA,GAAY1e,EAAkB2V,IACnC3iB,IAAAA,CAAKsmB,MAAAA,CAAOha,CAAAA,GAAI2D,EAAM3D,CAAAA,EACtBtM,IAAAA,CAAKsmB,MAAAA,CAAOlc,CAAAA,GAAI6F,EAAM7F,CAAAA,EACtBpK,IAAAA,CAAKgwC,SAAAA;YACP;YAKO,aAAAwB;gBAIL,OAAA,CAAA,CAHiBhlC,CAAAA,EAAKxM,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,MAAO,KACvBE,EAAKxM,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,MAAO,EAAA;YAG1C;YAOO,MAAMkG,CAAAA,EAAAA;gBACX,MAAM+Q,IAAS/Q,QAAAA,IAAAA,IAAQ,IAAI;gBAM3B,OALAtQ,IAAAA,CAAKmZ,IAAAA,CAAKlH,KAAAA,CAAMoP,EAAOlI,IAAAA,GACvBkI,EAAOkvB,EAAAA,GAAKvwC,IAAAA,CAAKuwC,EAAAA,EACjBlvB,EAAOqK,SAAAA,GAAY1rB,IAAAA,CAAK0rB,SAAAA,EACxB1rB,IAAAA,CAAKsmB,MAAAA,CAAOrU,KAAAA,CAAMoP,EAAOiF,MAAAA,GACzBjF,EAAO2uB,SAAAA,IACA3uB;YACT;YAKO,gBAAgB/Q,CAAAA,EAAAA;gBACrB,MAAM+Q,IAAS/Q,QAAAA,IAAAA,IAAQ,IAAI;gBAO3B,OANAtQ,IAAAA,CAAKmZ,IAAAA,CAAKlH,KAAAA,CAAMoP,EAAOlI,IAAAA,GACvBkI,EAAOkvB,EAAAA,GAAKvwC,IAAAA,CAAKuwC,EAAAA,EACjBlvB,EAAOqK,SAAAA,GAAY1rB,IAAAA,CAAK0rB,SAAAA,EACxB1rB,IAAAA,CAAKsmB,MAAAA,CAAOrU,KAAAA,CAAMoP,EAAOiF,MAAAA,GACzBjF,EAAO6uB,MAAAA,GAASlwC,IAAAA,CAAKkwC,MAAAA,EACrB7uB,EAAO2uB,SAAAA,IACA3uB;YACT;YAEO,WAAAthB;gBACL,OAAOC,IAAAA,CAAKgd,MAAAA,CAAOjd,QAAAA;YACrB;QAAA;QC1RK,SAAS2xC,GAAgBtuC,CAAAA;YAC9B,OAAA,CAAA,CAASA,KAAAA,CAAAA,CAAWA,EAAMN,SAAAA,IAAAA,CAAAA,CAAeM,EAAMN,SAAAA,CAAU6D,WAC3D;QAAA;QAsBO,MAAegrC;YAAtB,aAAA;gBAcE,IAAA,CAAAC,KAAAA,GAAAA,KAAiB9wC;YA6BnB;YAxBE,QAAAmR;gBACE,MAAM4/B,IAAe,IAAK7xC,IAAAA,CAAK2G,WAAAA;gBAC/B,IAAK,MAAM9D,KAAQ7C,IAAAA,CACjB,IAAIA,IAAAA,CAAK+C,cAAAA,CAAeF,IAAO;oBAC7B,MAAM4J,IAAMzM,IAAAA,CAAK6C,EAAAA;oBAtCdyJ,CAAAA,QADOA,CAAAA,IAwCGG,CAAAA,IAAAA,KAvCT,IAADH,EAAG2F,KAAAA,AAAAA,KAuCwB,YAATpP,KAA6B,YAATA,IACvCgvC,CAAAA,CAAahvC,EAAAA,GAAQ4J,EAAIwF,KAAAA,KAEzB4/B,CAAAA,CAAahvC,EAAAA,GAAQ4J;gBAEzB;gBA7CN,IAAkBH;gBA+Cd,OAAOulC;YACT;QAAA;QCzCK,MAAMC;YAAb,aAAA;gBACS,IAAA,CAAAC,SAAAA,GAA2B,EAAA,EAC3B,IAAA,CAAAC,aAAAA,GAAqC,EA8D9C;YAAA;YAxDE,SAASE,CAAAA,EAAAA;gBACPlyC,IAAAA,CAAK+xC,SAAAA,CAAUpyC,IAAAA,CAAKuyC;YACtB;YAMA,UAAUE,CAAAA,EAAAA;gBACRpyC,IAAAA,CAAKgyC,aAAAA,CAAcryC,IAAAA,CAAKyyC;YAC1B;YAMA,WAAWF,CAAAA,EAAAA;gBACT,MAAM1xC,IAAIR,IAAAA,CAAK+xC,SAAAA,CAAUtpC,OAAAA,CAAQypC;gBAAAA,OAC7B1xC,KACFR,IAAAA,CAAK+xC,SAAAA,CAAUrpC,MAAAA,CAAOlI,GAAG;YAE7B;YAMA,YAAY4xC,CAAAA,EAAAA;gBACV,MAAM5xC,IAAIR,IAAAA,CAAKgyC,aAAAA,CAAcvpC,OAAAA,CAAQ2pC;gBAAAA,OACjC5xC,KACFR,IAAAA,CAAKgyC,aAAAA,CAActpC,MAAAA,CAAOlI,GAAG;YAEjC;YAMA,UAAUma,CAAAA,EAAAA;gBACR,MAAM63B,IAAkBxyC,IAAAA,CAAK+xC,SAAAA,CAAUzxC,MAAAA;gBACvC,IAAK,IAAIE,IAAI,GAAGA,IAAIgyC,GAAiBhyC,IACnCR,IAAAA,CAAK+xC,SAAAA,CAAUvxC,EAAAA,CAAGiyC,MAAAA,CAAO93B;gBAE3B,MAAM+3B,IAAsB1yC,IAAAA,CAAKgyC,aAAAA,CAAc1xC,MAAAA;gBAC/C,IAAK,IAAIE,IAAI,GAAGA,IAAIkyC,GAAqBlyC,IACvCR,IAAAA,CAAKgyC,aAAAA,CAAcxxC,EAAAA,CAAGma;YAE1B;YAKA,QAAAnT;gBACExH,IAAAA,CAAK+xC,SAAAA,CAAUzxC,MAAAA,GAAS,GACxBN,IAAAA,CAAKgyC,aAAAA,CAAc1xC,MAAAA,GAAS;YAC9B;QAAA;QChFK,MAAMqyC,WAA2BhB;YAAxC,aAAA;gBAAA,KAAA,IAAA,YACU,IAAA,CAAA9kB,OAAAA,GAAUjW,EAAOS,WAAAA,IACjB,IAAA,CAAAu7B,gBAAAA,GAA8C,MAC9C,IAAA,CAAAC,UAAAA,GAAa,IAAI,IAKjB,IAAA,CAAAC,kBAAAA,GAAsBC,CAAAA;oBAC5B,MAAMC,IAAmBD,EAAMpwC,GAAAA,CAAIgwC;oBAC/BK,KACFA,CAAAA,EAAiBH,UAAAA,CAAW3C,MAAAA,GAASlwC,IAAAA,CAAK6yC,UAAAA,EAC1CG,EAAiBJ,gBAAAA,GAAmB5yC,IAAAA,AAAAA;gBACtC,GAuBK,IAAA,CAAAizC,cAAAA,GAAiB,IAAInB,IA0BpB,IAAA,CAAAoB,WAAAA,GAAcpE,GAAWqE,KA4EnC;YAAA;YAtIS,MAAAxwC;gBACL,OAAO3C,IAAAA,CAAK6yC,UACd;YAAA;YASA,MAAMjB,CAAAA,EAAAA;gBACJ,KAAK,MAAMmB,KAASnB,EAAMf,QAAAA,CACxB7wC,IAAAA,CAAK8yC,kBAAAA,CAAmBC;gBAE1BnB,EAAMyB,cAAAA,CAAelB,SAAAA,CAAWY,CAAAA,IAAU/yC,IAAAA,CAAK8yC,kBAAAA,CAAmBC,KAClEnB,EAAM0B,gBAAAA,CAAiBnB,SAAAA,CAAWY,CAAAA;oBAChC,MAAMC,IAAmBD,EAAMpwC,GAAAA,CAAIgwC;oBAC/BK,KACFA,CAAAA,EAAiBH,UAAAA,CAAW3C,MAAAA,GAAS,MACrC8C,EAAiBJ,gBAAAA,GAAmB,IAAA;gBACtC;YAEJ;YACA,SAASY,CAAAA,EAAAA;gBACPxzC,IAAAA,CAAK6yC,UAAAA,CAAW3C,MAAAA,GAAS,MACzBlwC,IAAAA,CAAK4yC,gBAAAA,GAAmB;YAC1B;YAWA,IAAA,IAAW/pB;gBACT,OAAO7oB,IAAAA,CAAK6yC,UAAAA,CAAWhqB,CACzB;YAAA;YAEA,IAAA,EAAapc,CAAAA,EAAAA;gBACX,MAAMgnC,IAAOzzC,IAAAA,CAAK6yC,UAAAA,CAAWhqB,CAAAA;gBAC7B7oB,IAAAA,CAAK6yC,UAAAA,CAAWhqB,CAAAA,GAAIpc,GAChBgnC,MAAShnC,KACXzM,IAAAA,CAAKizC,cAAAA,CAAeV,SAAAA,CAAU9lC;YAElC;YAEA,IAAA,UAAW2kC;gBACT,OAAOpxC,IAAAA,CAAK6yC,UAAAA,CAAWzB,OACzB;YAAA;YAEA,IAAA,QAAmBvoB,CAAAA,EAAAA;gBACjB7oB,IAAAA,CAAK6yC,UAAAA,CAAWzB,OAAAA,GAAUvoB;YAC5B;YAMA,IAAA,aAAW6qB;gBACT,OAAI1zC,IAAAA,CAAK4yC,gBAAAA,GACA5yC,IAAAA,CAAK4yC,gBAAAA,CAAiBc,UAAAA,GAExB1zC,IAAAA,CAAKkzC,WACd;YAAA;YAEA,IAAA,WAAsB9vC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACfpD,IAAAA,CAAK4yC,gBAAAA,GAGR5yC,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,4CAAA,EAAyD,SAAV,CAAA,IAAArY,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEnjB,IAAAA,CAAAA,6DAAAA,CAAAA,IAH7DzuB,IAAAA,CAAKkzC,WAAAA,GAAc9vC;YAMvB;YAEA,IAAA,MAAIyX;gBACF,OAAO7a,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GACzB;YAAA;YACA,IAAA,IAAQtL,CAAAA,EAAAA;gBACNvP,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,GAAMtL;YACxB;YAEA,IAAA,YAAIuhC;gBACF,OAAO9wC,IAAAA,CAAK6yC,UAAAA,CAAW/B,SACzB;YAAA;YACA,IAAA,UAAcvhC,CAAAA,EAAAA;gBACZvP,IAAAA,CAAK6yC,UAAAA,CAAW/B,SAAAA,GAAYvhC;YAC9B;YAEA,IAAA,WAAIoT;gBACF,OAAO3iB,IAAAA,CAAK6yC,UAAAA,CAAWlwB,QACzB;YAAA;YACA,IAAA,SAAaA,CAAAA,EAAAA;gBACX3iB,IAAAA,CAAK6yC,UAAAA,CAAWlwB,QAAAA,GAAWA;YAC7B;YAEA,IAAA,iBAAIsuB;gBACF,OAAOjxC,IAAAA,CAAK6yC,UAAAA,CAAW5B,cACzB;YAAA;YACA,IAAA,eAAmBtuB,CAAAA,EAAAA;gBACjB3iB,IAAAA,CAAK6yC,UAAAA,CAAW5B,cAAAA,GAAiBtuB;YACnC;YAEA,IAAA,QAAI1S;gBACF,OAAOjQ,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KACzB;YAAA;YACA,IAAA,MAAUV,CAAAA,EAAAA;gBACRvP,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,GAAQV;YAC1B;YAEA,IAAA,cAAI8gC;gBACF,OAAOrwC,IAAAA,CAAK6yC,UAAAA,CAAWxC,WACzB;YAAA;YACA,IAAA,YAAgB9gC,CAAAA,EAAAA;gBACdvP,IAAAA,CAAK6yC,UAAAA,CAAWxC,WAAAA,GAAc9gC;YAChC;YAEA,aAAaA,CAAAA,EAAAA;gBACX,OAAOvP,IAAAA,CAAK6yC,UAAAA,CAAWvB,YAAAA,CAAa/hC;YACtC;YAEA,MAAMA,CAAAA,EAAAA;gBACJ,OAAOvP,IAAAA,CAAK6yC,UAAAA,CAAW95B,KAAAA,CAAMxJ;YAC/B;YAEA,QAAA0C;gBACE,MAAM0hC,IAAY,IAAIhB;gBAEtB,OADAgB,EAAUd,UAAAA,GAAa7yC,IAAAA,CAAK6yC,UAAAA,CAAW5gC,KAAAA,IAChC0hC;YACT;QAAA;QAAA,CNjIF,SAAY5E,CAAAA;YAIV,EAAA,OAAA,GAAA,WAIA,EAAA,QAAA,GAAA;QACD,EATWA,MAAAA,CAAAA,KAAkB,CAAA,CAAA,IAW9B,SAAYC,CAAAA;YAIV,EAAA,GAAA,GAAA,OAIA,EAAA,IAAA,GAAA,QAIA,EAAA,QAAA,GAAA,YAIA,EAAA,MAAA,GAAA;QACD,EAjBWA,MAAAA,CAAAA,KAAiB,CAAA,CAAA;QA2EtB,MAAM4E,KAAkB;YAC7BC,OAAO;YACPC,MAAM;YACNC,KAAK;QAAA;QA8CA,MAAMC,WAAkB7oB;YAiB7B,YAAYlS,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,CAAM3T,IAhBD,IAAA,CAAAiB,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAA+sC,MAAAA,GAAkB,EAAA,EAClB,IAAA,CAAAC,QAAAA,GAA8BlF,GAAkB8E,IAAAA,EAChD,IAAA,CAAAK,aAAAA,GAAwB,KAEvB,IAAA,CAAAC,iBAAAA,GAAAA,IAEA,IAAA,CAAAC,UAAAA,GAAAA,CAAa,GACb,IAAA,CAAAC,aAAAA,GAAgB,GAChB,IAAA,CAAAC,gBAAAA,GAAmB,GACnB,IAAA,CAAAC,kBAAAA,GAAqB,GACrB,IAAA,CAAAC,KAAAA,GAAAA,CAAQ,GACR,IAAA,CAAAC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAC,MAAAA,GAAS,GAwLT,IAAA,CAAAC,SAAAA,GAAAA,CAAY,GApLlB50C,IAAAA,CAAKi0C,MAAAA,GAASh7B,EAAQg7B,MAAAA,EACtBj0C,IAAAA,CAAK60C,KAAAA,GAAqB,SAAb,CAAA,IAAA57B,EAAQ47B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI70C,IAAAA,CAAK60C,KAAAA,EACnC70C,IAAAA,CAAKk0C,QAAAA,GAA2B,SAAhB,CAAA,IAAAj7B,EAAQi7B,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAIl0C,IAAAA,CAAKk0C,QAAAA,EACzCl0C,IAAAA,CAAKm0C,aAAAA,GAAgBl7B,EAAQ67B,aAAAA,GAAgB77B,EAAQ67B,aAAAA,GAAgB90C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,GAA8B,SAArB,CAAA,IAAA2Y,EAAQk7B,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAIn0C,IAAAA,CAAKm0C,aAAAA,EACpHl7B,EAAQ87B,OAAAA,IACV/0C,IAAAA,CAAK+0C,OAAAA,IAEP/0C,IAAAA,CAAKg1C,SAAAA,CAAU;YACjB;YAEO,QAAA/iC;gBACL,OAAO,IAAI+hC,GAAU;oBACnBC,QAAQj0C,IAAAA,CAAKi0C,MAAAA,CAAOh0C,GAAAA,CAAKg1C,CAAAA,IAAM,CAAA;4BAAA,GAAMA,CAAAA;wBAAAA,CAAAA;oBACrCd,eAAen0C,IAAAA,CAAKm0C,aAAAA;oBACpBU,OAAO70C,IAAAA,CAAK60C,KAAAA;oBACZE,SAAS/0C,IAAAA,CAAK40C,SAAAA;oBACdV,UAAUl0C,IAAAA,CAAKk0C,QAAAA;oBAAAA,GACZl0C,IAAAA,CAAKisB,mBAAAA,EAAAA;gBAAAA;YAEZ;YAEA,IAAA,QAAoB9R;gBAClB,MAAM+6B,IAAal1C,IAAAA,CAAKm1C,YAAAA;gBACxB,OAAID,KAAcA,EAAWE,OAAAA,GACpB9vC,KAAKyH,GAAAA,CAAImoC,EAAWE,OAAAA,CAAQj7B,KAAAA,GAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,IAEjD;YACT;YAEA,IAAA,SAAoB+N;gBAClB,MAAM66B,IAAal1C,IAAAA,CAAKm1C,YAAAA;gBACxB,OAAID,KAAcA,EAAWE,OAAAA,GACpB9vC,KAAKyH,GAAAA,CAAImoC,EAAWE,OAAAA,CAAQ/6B,MAAAA,GAASra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,IAElD;YACT;YAiBO,OAAA,gBACLspB,CAAAA,EACA4hB,CAAAA,EACAC,CAAAA,EACArB,IAA8BlF,GAAkB8E,IAAAA,EAAAA;gBAEhD,MAAM0B,IAAW9hB,EAAYU,OAAAA,CAAQ9zB,MAAAA,GAAS,GACxCm1C,IAAiBH,EAAiBttC,MAAAA,CAAQwD,CAAAA,IAAUA,IAAQ,KAAKA,IAAQgqC;gBAM/E,OALIC,EAAen1C,MAAAA,IACjB0zC,GAAUplB,OAAAA,CAAQvW,IAAAA,CAChB,CAAA,yDAAA,EAA6Do9B,EAAel1C,IAAAA,CAAK,KAAA,uBAAA,CAAA,GAG9E,IAAIyzC,GAAU;oBACnBC,QAAQvgB,EAAYU,OAAAA,CACjBpsB,MAAAA,CAAO,CAACm5B,GAAG31B,IAAU8pC,EAAiB7sC,OAAAA,CAAQ+C,KAAAA,IAC9CvL,GAAAA,CAAKg1C,CAAAA,IAAM,CAAA;4BACVG,SAASH;4BACTS,UAAUH;wBAAAA,CAAAA;oBAEdrB,UAAUA;gBAAAA;YAEd;YAuBO,OAAA,2BAAkCj7B,CAAAA,EAAAA;gBAAAA,IAAAA;gBACvC,MAAA,EAAM,aAAEya,CAAAA,EAAW,kBAAEkiB,CAAAA,EAAgB,kBAAEL,CAAAA,EAAgB,oBAAEM,CAAAA,EAAkB,OAAEhB,CAAAA,EAAK,UAAEX,CAAAA,EAAQ,SAAEa,CAAAA,EAAAA,GAAY97B,GACpG68B,IAAwD,SAAtC,CAAA,IAAAP,QAAAA,IAAAA,IAAoBM,CAAAA,KAAAA,KAAkB,MAAA,IAAA,IAAI,KAC5D5B,IAAkB,EAAA;gBACxB,KAAK,MAAM8B,KAASH,EAAkB;oBACpC,MAAA,EAAM,GAAEtpC,CAAAA,EAAC,GAAElC,CAAAA,EAAC,UAAEsrC,CAAAA,EAAQ,SAAEz8B,CAAAA,EAAAA,GAAY88B,GAC9BphB,IAASjB,EAAYsC,SAAAA,CAAU1pB,GAAGlC,GAAG6O;oBACvC0b,IACFsf,EAAOt0C,IAAAA,CAAK;wBACVy1C,SAASzgB;wBACT+gB,UAAUA,QAAAA,IAAAA,IAAYI;oBAAAA,KAGxB9B,GAAUplB,OAAAA,CAAQvW,IAAAA,CAChB,CAAA,sDAAA,EAAyD/L,EAAAA,EAAAA,EAAMlC,EAAAA,8DAAAA,CAAAA;gBAGrE;gBAEA,OAAO,IAAI4pC,GAAU;oBACnBC,QAAAA;oBACAC,UAAAA;oBACAW,OAAAA;oBACAE,SAAAA;gBAAAA;YAEJ;YAQA,IAAA,QAAWF;gBACT,OAAO70C,IAAAA,CAAK20C,MACd;YAAA;YAQA,IAAA,MAAiBloC,CAAAA,EAAAA;gBACfzM,IAAAA,CAAK20C,MAAAA,GAASjoC,EAAMpH,KAAKyH,GAAAA,CAAIN,IAAM,GAAGmC,IAAAA;YACxC;YAQA,IAAA,eAAWumC;gBACT,OAAIn1C,IAAAA,CAAKs0C,aAAAA,IAAiB,KAAKt0C,IAAAA,CAAKs0C,aAAAA,GAAgBt0C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,GACvDN,IAAAA,CAAKi0C,MAAAA,CAAOj0C,IAAAA,CAAKs0C,aAAAA,CAAAA,GAEnB;YACT;YAOA,IAAA,oBAAW0B;gBACT,OAAOh2C,IAAAA,CAAKs0C,aACd;YAAA;YAKA,IAAA,uBAAW2B;gBACT,OAAOj2C,IAAAA,CAAKu0C,gBACd;YAAA;YAKA,IAAA,YAAW2B;gBACT,OAAOl2C,IAAAA,CAAK00C,QACd;YAAA;YAIA,IAAA,aAAWyB;gBACT,OAAOn2C,IAAAA,CAAK40C,SACd;YAAA;YAKO,UAAAG;gBAEL/0C,IAAAA,CAAKi0C,MAAAA,GAASj0C,IAAAA,CAAKi0C,MAAAA,CAAO1oC,KAAAA,GAAQwpC,OAAAA,IAClC/0C,IAAAA,CAAK40C,SAAAA,GAAAA,CAAa50C,IAAAA,CAAK40C,SACzB;YAAA;YAKA,IAAA,YAAWv5B;gBAIT,OAAA,CAAA,CAAA,CADiBrb,IAAAA,CAAK40C,SAAAA,IAAyC,MAA5B50C,IAAAA,CAAKw0C,kBAAAA,AAAAA,IACtBzF,GAAmBqH,QAAAA,GAAWrH,GAAmBsH,OACrE;YAAA;YAKO,OAAAC;gBACLt2C,IAAAA,CAAK00C,QAAAA,GAAAA,CAAW;YAClB;YAKO,QAAA9rC;gBACL5I,IAAAA,CAAK00C,QAAAA,GAAAA,CAAW,GAChB10C,IAAAA,CAAKq0C,UAAAA,GAAAA,CAAa;YACpB;YAKO,QAAA14B;gBACL3b,IAAAA,CAAKy0C,KAAAA,GAAAA,CAAQ,GACbz0C,IAAAA,CAAKq0C,UAAAA,GAAAA,CAAa,GAClBr0C,IAAAA,CAAKs0C,aAAAA,GAAgB,GACrBt0C,IAAAA,CAAKu0C,gBAAAA,GAAmBv0C,IAAAA,CAAKm0C,aAAAA;gBAC7B,MAAMe,IAAal1C,IAAAA,CAAKi0C,MAAAA,CAAOj0C,IAAAA,CAAKs0C,aAAAA,CAAAA;gBAChCY,KACFl1C,CAAAA,IAAAA,CAAKu0C,gBAAAA,GAAAA,AAAmBW,CAAAA,QAAAA,IAAAA,KAAU,IAAVA,EAAYQ,QAAAA,AAAAA,KAAY11C,IAAAA,CAAKm0C,aAAAA,AAAAA;YAEzD;YAKA,IAAA,YAAWoC;gBACT,OAAQv2C,IAAAA,CAAKk0C,QAAAA;oBACX,KAAKlF,GAAkB+E,GAAAA;oBACvB,KAAK/E,GAAkBwH,MAAAA;wBACrB,OAAA,CAAO;oBAET;wBACE,OAAA,CAAO;gBAAA;YAGb;YAQA,IAAA,OAAWnK;gBACT,OAAOrsC,IAAAA,CAAKy0C,KACd;YAAA;YAUO,UAAUgC,CAAAA,EAAqBf,CAAAA,EAAAA;gBACpC11C,IAAAA,CAAKs0C,aAAAA,GAAgBmC,GACrBz2C,IAAAA,CAAKu0C,gBAAAA,GAAmBmB,QAAAA,IAAAA,IAAY11C,IAAAA,CAAKm0C,aAAAA;gBACzC,MAAMe,IAAal1C,IAAAA,CAAKi0C,MAAAA,CAAOj0C,IAAAA,CAAKs0C,aAAAA,CAAAA;gBAChCY,KAAAA,CAAel1C,IAAAA,CAAKy0C,KAAAA,IACtBz0C,CAAAA,IAAAA,CAAKu0C,gBAAAA,GAAmBmB,QAAAA,IAAAA,IAAAA,AAAaR,CAAAA,QAAAA,IAAAA,KAAU,IAAVA,EAAYQ,QAAAA,AAAAA,KAAY11C,IAAAA,CAAKm0C,aAAAA,EAClEn0C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS;oBAAA,GAAK+sC,CAAAA;oBAAYwB,YAAY12C,IAAAA,CAAKg2C,iBAAAA;gBAAAA,EAAAA;YAEhE;YAEQ,aAAAW;gBACN,MAAMxB,IAAen1C,IAAAA,CAAKs0C,aAAAA;gBAC1B,IAAIt0C,IAAAA,CAAKy0C,KAAAA,EACP,OAAOU;gBAET,IAAI7qC,IAAAA;gBAEJ,OAAQtK,IAAAA,CAAKk0C,QAAAA;oBACX,KAAKlF,GAAkB8E,IAAAA;wBACrBxpC,IAAAA,AAAQ6qC,CAAAA,IAAe,CAAA,IAAKn1C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,EAC3B,MAATgK,KACFtK,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQnI,IAAAA;wBAE3B;oBAEF,KAAKgvC,GAAkB+E,GAAAA;wBACrBzpC,IAAO6qC,IAAe,GAClB7qC,KAAQtK,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,IACtBN,CAAAA,IAAAA,CAAKy0C,KAAAA,GAAAA,CAAQ,GACbz0C,IAAAA,CAAKs0C,aAAAA,GAAgBt0C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,EACjCN,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,OAAOnI,IAAAA,CAAAA;wBAE1B;oBAEF,KAAKgvC,GAAkBwH,MAAAA;wBACrBlsC,IAAOoC,EAAMyoC,IAAe,GAAG,GAAGn1C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,GAAS,IACnDgK,KAAQtK,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,GAAS,KAC/BN,CAAAA,IAAAA,CAAKy0C,KAAAA,GAAAA,CAAQ,GACbz0C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,OAAOnI,IAAAA,CAAAA;wBAE1B;oBAEF,KAAKgvC,GAAkB4H,QAAAA;wBACjBzB,IAAen1C,IAAAA,CAAKw0C,kBAAAA,IAAsBx0C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,IACxDN,CAAAA,IAAAA,CAAKw0C,kBAAAA,GAAAA,IACLx0C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQnI,IAAAA,CAAAA,GAGvBm1C,IAAen1C,IAAAA,CAAKw0C,kBAAAA,GAAqB,KAC3Cx0C,CAAAA,IAAAA,CAAKw0C,kBAAAA,GAAqB,GAC1Bx0C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQnI,IAAAA,CAAAA,GAG3BsK,IAAO6qC,IAAgBn1C,IAAAA,CAAKw0C,kBAAAA,GAAqBx0C,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA;gBAAAA;gBAIjE,OAAOgK;YACT;YAOO,KAAKwsC,CAAAA,EAAiBC,IAA2B,CAAA,EAAA;gBAClD/2C,IAAAA,CAAKo0C,iBAAAA,KAAsB2C,KAG/B/2C,CAAAA,IAAAA,CAAKo0C,iBAAAA,GAAoB2C,GACpB/2C,IAAAA,CAAK00C,QAAAA,IAKN10C,CAAAA,IAAAA,CAAKq0C,UAAAA,IACPr0C,CAAAA,IAAAA,CAAKq0C,UAAAA,GAAAA,CAAa,GAClBr0C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS;oBAAA,GAAKnI,IAAAA,CAAKm1C,YAAAA;oBAAcuB,YAAY12C,IAAAA,CAAKg2C,iBAAAA;gBAAAA,EAAAA,GAGrEh2C,IAAAA,CAAKu0C,gBAAAA,IAAoBuC,IAAU92C,IAAAA,CAAK20C,MAAAA,EACpC30C,IAAAA,CAAKu0C,gBAAAA,IAAoB,KAC3Bv0C,IAAAA,CAAKg1C,SAAAA,CAAUh1C,IAAAA,CAAK22C,UAAAA,GAAAA,CAAAA;YAExB;YAEU,WAAWvf,CAAAA,EAA+B9qB,CAAAA,EAAWlC,CAAAA,EAAAA;gBACzDpK,IAAAA,CAAKm1C,YAAAA,IAAgBn1C,IAAAA,CAAKm1C,YAAAA,CAAaC,OAAAA,IACzCp1C,IAAAA,CAAKm1C,YAAAA,CAAaC,OAAAA,CAAQv1B,IAAAA,CAAKuX,GAAK9qB,GAAGlC;YAE3C;QAAA;QAvXe,GAAAwkB,OAAAA,GAAUhY,EAAOS,WAAAA;QOvH3B,MAAM2/B,WAAsB7rB;YAKjC,YAAYlS,CAAAA,CAAAA;gBAAAA,IAAAA;gBACV2T,KAAAA,CAAM3T,IALA,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAClB,IAAA,CAAA4/B,SAAAA,GAAAA,CAAqB,GACrB,IAAA,CAAAC,OAAAA,GAA0C,EAAA,EAI/Cl3C,IAAAA,CAAKk3C,OAAAA,GAAUj+B,EAAQi+B,OAAAA,EACvBl3C,IAAAA,CAAKi3C,SAAAA,GAA6B,SAAjB,CAAA,IAAAh+B,EAAQg+B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIj3C,IAAAA,CAAKi3C,SAAAA,EAC3Cj3C,IAAAA,CAAKm3C,iBAAAA;YACP;YAEO,QAAAllC;gBACL,OAAO,IAAI+kC,GAAc;oBACvBE,SAAS;2BAAIl3C,IAAAA,CAAKk3C,OAAAA;qBAAAA;oBAAAA,GACfl3C,IAAAA,CAAKisB,mBAAAA,EAAAA;gBAAAA;YAEZ;YAEQ,oBAAAkrB;gBACN,MAAMv3B,IAAK5f,IAAAA,CAAKksB,WAAAA;gBAGhB,OAFAlsB,IAAAA,CAAKma,KAAAA,GAAQyF,EAAGzF,KAAAA,EAChBna,IAAAA,CAAKqa,MAAAA,GAASuF,EAAGvF,MAAAA,EACVuF;YACT;YAEA,IAAA,cAAWsM;gBACT,MAAMtM,IAAK,IAAItE;gBACf,KAAK,MAAM87B,KAAUp3C,IAAAA,CAAKk3C,OAAAA,CACxB,IAAIE,aAAkBjsB,IACpBisB,EAAOlrB,WAAAA,CAAYlN,OAAAA,CAAQY,GAAIA;qBAC1B;oBACL,MAAA,EAAM,SAAEw1B,CAAAA,EAASngB,QAAQpa,CAAAA,EAAG,WAAEw8B,CAAAA,EAAAA,GAAcD;oBAExChC,IAAAA,AAAAA,CAAAA,KADkCt0C,MAAdu2C,KAAiCA,CAAAA,KAGrDjC,EAAQlpB,WAAAA,CAAYvP,SAAAA,CAAU9B,GAAKmE,OAAAA,CAAQY,GAAIA,KAGjD5f,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,CAAA,2EAAA,EAA8EhX,KAAKC,SAAAA,CAAU41C,GAAAA,CAAAA,CAAAA;gBAEvH;gBAEF,OAAOx3B;YACT;YAEQ,oBAAoBw1B,CAAAA,EAAAA;gBAC1B,OAAOA,aAAmBpB,MAAaoB,aAAmB4B;YAC5D;YAEO,KAAKF,CAAAA,EAAiBC,CAAAA,EAAAA;gBAC3B,KAAK,MAAMK,KAAUp3C,IAAAA,CAAKk3C,OAAAA,CAAS;oBACjC,IAAI9B;oBAEFA,IADEgC,aAAkBjsB,KACVisB,IAEAA,EAAOhC,OAAAA,EAEfp1C,IAAAA,CAAKs3C,mBAAAA,CAAoBlC,MAC3BA,EAAQyB,IAAAA,CAAKC,GAASC;gBAE1B;YACF;YAEO,QAAAp7B;gBACL,KAAK,MAAMy7B,KAAUp3C,IAAAA,CAAKk3C,OAAAA,CAAS;oBACjC,IAAI9B;oBAEFA,IADEgC,aAAkBjsB,KACVisB,IAEAA,EAAOhC,OAAAA,EAEfp1C,IAAAA,CAAKs3C,mBAAAA,CAAoBlC,MAC3BA,EAAQz5B,KAAAA;gBAEZ;YACF;YAEU,SAASmE,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC1DpK,IAAAA,CAAKm3C,iBAAAA,IACLvqB,KAAAA,CAAMT,SAASrM,GAAI9f,IAAAA,CAAKi3C,SAAAA,GAAY3qC,IAAI,GAAGtM,IAAAA,CAAKi3C,SAAAA,GAAY7sC,IAAI;YAClE;YAEU,WAAW0V,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC5D,MAAMyQ,IAAM/M,EAAOC,IAAAA;gBACnB,KAAK,MAAMqpC,KAAUp3C,IAAAA,CAAKk3C,OAAAA,CAAS;oBACjC,IAAI9B;oBACAgC,aAAkBjsB,KACpBiqB,IAAUgC,IAEVhC,CAAAA,IAAUgC,EAAOhC,OAAAA,EACjBgC,EAAOniB,MAAAA,CAAOhjB,KAAAA,CAAM4I,EAAAA,GAEjBu6B,KAGLt1B,CAAAA,EAAGyI,IAAAA,IACHzI,EAAGnD,SAAAA,CAAUrQ,GAAGlC,IAChBgrC,EAAQv1B,IAAAA,CAAKC,GAAIjF,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA,GACxBpK,IAAAA,CAAK8rB,SAAAA,IAEPhM,EAAG9H,KAAAA,CAAM+H,QAAAA,CAAS,GAAG,GAAG/f,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,GAE3CyF,EAAG0I,OAAAA,EAAAA;gBACL;YACF;QAAA;QCtEK,MAAe+uB,WAAepsB;YASnC,YAAYlS,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,CAAM9L,EAAK;oBAAA,GAAK7H,CAAAA;gBAAAA,GAAW;oBAAC;oBAAS;iBAAA,IARhC,IAAA,CAAAu+B,OAAAA,GAAuC,QACvC,IAAA,CAAAC,OAAAA,GAAkB,GAIjB,IAAA,CAAA3qB,MAAAA,GAAAA,CAAkB,GA4GlB,IAAA,CAAA4qB,UAAAA,GAAAA,CAAsB,GAatB,IAAA,CAAAt+B,MAAAA,GAAgBwR,GAAMxY,EAAMyC,KAAAA,EAAO,IAAM7U,IAAAA,CAAKgwC,SAAAA,KA4B9C,IAAA,CAAA2H,UAAAA,GAAqB,GAarB,IAAA,CAAAC,SAAAA,GAAsB,EAAA,EAUtB,IAAA,CAAAC,QAAAA,GAAmB,GAxKrB5+B,KACFjZ,CAAAA,IAAAA,CAAKy3C,OAAAA,GAAyB,SAAf,CAAA,IAAAx+B,EAAQw+B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIz3C,IAAAA,CAAKy3C,OAAAA,EACvCz3C,IAAAA,CAAK2T,KAAAA,GAAqB,SAAb,CAAA,IAAAsF,EAAQtF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIvB,EAAMyC,KAAAA,EACpC7U,IAAAA,CAAK83C,WAAAA,GAAc7+B,QAAAA,IAAAA,KAAO,IAAPA,EAAS6+B,WAAAA,EAC5B93C,IAAAA,CAAK+3C,SAAAA,GAA6B,SAAjB,CAAA,IAAA9+B,EAAQ8+B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI/3C,IAAAA,CAAK+3C,SAAAA,EAC3C/3C,IAAAA,CAAKg4C,SAAAA,GAA6B,SAAjB,CAAA,IAAA/+B,EAAQ++B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIh4C,IAAAA,CAAKg4C,SAAAA,EAC3Ch4C,IAAAA,CAAKi4C,QAAAA,GAA2B,SAAhB,CAAA,IAAAh/B,EAAQg/B,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAIj4C,IAAAA,CAAKi4C,QAAAA,EACzCj4C,IAAAA,CAAKw3C,OAAAA,GAAyB,SAAf,CAAA,IAAAv+B,EAAQu+B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIx3C,IAAAA,CAAKw3C,OAAAA,EACvCx3C,IAAAA,CAAKk4C,OAAAA,GAAyB,SAAf,CAAA,IAAAj/B,EAAQi/B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIl4C,IAAAA,CAAKk4C,OAAAA,EACvCl4C,IAAAA,CAAKsvB,SAAAA,GAA6B,SAAjB,CAAA,IAAArW,EAAQqW,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAItvB,IAAAA,CAAKsvB,SAAAA,AAAAA,GAE7CtvB,IAAAA,CAAKm4C,OAAAA,GAAU5+B,SAASC,aAAAA,CAAc;gBAEtC,MAAM4+B,IAA4B,SAAd,CAAA,IAAAn/B,QAAAA,IAAAA,KAAO,IAAPA,EAASkB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIna,IAAAA,CAAKm4C,OAAAA,CAAQh+B,KAAAA,EAC7Ck+B,IAA8B,SAAf,CAAA,IAAAp/B,QAAAA,IAAAA,KAAO,IAAPA,EAASoB,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIra,IAAAA,CAAKm4C,OAAAA,CAAQ99B,MAAAA;gBACrDra,IAAAA,CAAKma,KAAAA,GAAQi+B,GACbp4C,IAAAA,CAAKqa,MAAAA,GAASg+B;gBACd,MAAMC,IAAWt4C,IAAAA,CAAKm4C,OAAAA,CAAQz+B,UAAAA,CAAW;gBACzC,IAAA,CAAK4+B,GAEH,MAAM,IAAInyC,MAAM;gBAEhBnG,IAAAA,CAAKyZ,IAAAA,GAAO6+B;YAEhB;YAEO,qBAAAC;gBACL,OAAO;oBACL5kC,OAAO3T,IAAAA,CAAK2T,KAAAA,GAAQ3T,IAAAA,CAAK2T,KAAAA,CAAM1B,KAAAA,KAAAA,KAAUnR;oBACzCg3C,aAAa93C,IAAAA,CAAK83C,WAAAA,GAAc93C,IAAAA,CAAK83C,WAAAA,CAAY7lC,KAAAA,KAAAA,KAAUnR;oBAC3Di3C,WAAW/3C,IAAAA,CAAK+3C,SAAAA;oBAChBC,WAAWh4C,IAAAA,CAAKg4C,SAAAA;oBAChBC,UAAUj4C,IAAAA,CAAKi4C,QAAAA;oBACfT,SAASx3C,IAAAA,CAAKw3C,OAAAA;oBACdC,SAASz3C,IAAAA,CAAKy3C,OAAAA;oBACdS,SAASl4C,IAAAA,CAAKk4C,OAAAA;gBAAAA;YAElB;YAKA,IAAA,QAAWM;gBACT,OAAOx4C,IAAAA,CAAK8sB,MACd;YAAA;YAMO,YAAAkjB;gBACLhwC,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS;YAChB;YASA,IAAA,QAAW3S;gBACT,OAAO7U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKy4C,cAAAA,KAAmBz4C,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;YACrD;YACA,IAAA,MAAiBlJ,CAAAA,EAAAA;gBACfA,KAASkC,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,GAC7BtM,IAAAA,CAAKm4C,OAAAA,CAAQh+B,KAAAA,GAAQ/W,GACrBpD,IAAAA,CAAK04C,cAAAA,GAAiBt1C,GACtBpD,IAAAA,CAAKgwC,SAAAA;YACP;YASA,IAAA,SAAW31B;gBACT,OAAO/U,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK24C,eAAAA,KAAoB34C,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;YACtD;YAEA,IAAA,OAAkBhH,CAAAA,EAAAA;gBAChBA,KAASkC,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GAC7BpK,IAAAA,CAAKm4C,OAAAA,CAAQ99B,MAAAA,GAASjX,GACtBpD,IAAAA,CAAK44C,eAAAA,GAAkBx1C,GACvBpD,IAAAA,CAAKgwC,SAAAA;YACP;YAEQ,iBAAAyI;gBAAAA,IAAAA;gBACN,OAA0E,IAAA,CAAA,AAA9C,CAAA,SAAnB,CAAA,IAAAz4C,IAAAA,CAAK04C,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAI14C,IAAAA,CAAKm4C,OAAAA,CAAQh+B,KAAAA,AAAAA,IAAwB,IAAfna,IAAAA,CAAKk4C,OAAAA,AAAAA;YAC7D;YAEQ,kBAAAS;gBAAAA,IAAAA;gBACN,OAA4E,IAAA,CAAA,AAA/C,CAAA,SAApB,CAAA,IAAA34C,IAAAA,CAAK44C,eAAAA,AAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI54C,IAAAA,CAAKm4C,OAAAA,CAAQ99B,MAAAA,AAAAA,IAAyB,IAAfra,IAAAA,CAAKk4C,OAAAA,AAAAA;YAC/D;YAKA,IAAA,cAAWhsB;gBACT,OAAO5Q,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKy4C,cAAAA,KAAmBz4C,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAGtM,IAAAA,CAAK24C,eAAAA,KAAoB34C,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,EAAG0D,EAAOC,IAAAA;YACvH;YAOA,IAAA,YAAWgqC;gBACT,OAAO/3C,IAAAA,CAAK03C,UACd;YAAA;YACA,IAAA,UAAqBt0C,CAAAA,EAAAA;gBACnBpD,IAAAA,CAAK03C,UAAAA,GAAat0C,GAClBpD,IAAAA,CAAKgwC,SAAAA;YACP;YAOA,IAAA,QAAWr8B;gBACT,OAAO3T,IAAAA,CAAKoZ,MACd;YAAA;YACA,IAAA,MAAiBhW,CAAAA,EAAAA;gBACfpD,IAAAA,CAAKgwC,SAAAA,IACLhwC,IAAAA,CAAKoZ,MAAAA,GAASwR,GAAMxnB,GAAO,IAAMpD,IAAAA,CAAKgwC,SAAAA;YACxC;YAOA,IAAA,cAAW8H;gBACT,OAAO93C,IAAAA,CAAK64C,YACd;YAAA;YACA,IAAA,YAAuBz1C,CAAAA,EAAAA;gBACrBpD,IAAAA,CAAKgwC,SAAAA,IACD5sC,KACFpD,CAAAA,IAAAA,CAAK64C,YAAAA,GAAejuB,GAAMxnB,GAAO,IAAMpD,IAAAA,CAAKgwC,SAAAA,GAAAA;YAEhD;YAOA,IAAA,YAAWgI;gBACT,OAAOh4C,IAAAA,CAAK23C,UACd;YAAA;YACA,IAAA,UAAqBv0C,CAAAA,EAAAA;gBACnBpD,IAAAA,CAAK23C,UAAAA,GAAav0C,GAClBpD,IAAAA,CAAKgwC,SAAAA;YACP;YAGA,IAAA,WAAWiI;gBACT,OAAOj4C,IAAAA,CAAK43C,SACd;YAAA;YAEA,IAAA,SAAoBx0C,CAAAA,EAAAA;gBAClBpD,IAAAA,CAAK43C,SAAAA,GAAYx0C,GACjBpD,IAAAA,CAAKgwC,SAAAA;YACP;YAGA,IAAA,UAAWkI;gBACT,OAAOl4C,IAAAA,CAAK63C,QACd;YAAA;YAEA,IAAA,QAAmBz0C,CAAAA,EAAAA;gBACjBpD,IAAAA,CAAK63C,QAAAA,GAAWz0C,GAChBpD,IAAAA,CAAKgwC,SAAAA;YACP;YAMO,YAAA8I;gBACL94C,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS,GACd9sB,IAAAA,CAAKyZ,IAAAA,CAAKmB,SAAAA,CAAU,GAAG,GAAG5a,IAAAA,CAAKy4C,cAAAA,IAAkBz4C,IAAAA,CAAK24C,eAAAA,KACtD34C,IAAAA,CAAKyZ,IAAAA,CAAK8O,IAAAA,IACVvoB,IAAAA,CAAK+4C,sBAAAA,CAAuB/4C,IAAAA,CAAKyZ,IAAAA,GACjCzZ,IAAAA,CAAKg5C,OAAAA,CAAQh5C,IAAAA,CAAKyZ,IAAAA,GAClBzZ,IAAAA,CAAKyZ,IAAAA,CAAK+O,OAAAA;YACZ;YAEU,uBAAuB4O,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAC/Bp3B,IAAAA,CAAKm4C,OAAAA,CAAQh+B,KAAAA,GAAQna,IAAAA,CAAKy4C,cAAAA,KAAmBz4C,IAAAA,CAAKy3C,OAAAA,EAClDz3C,IAAAA,CAAKm4C,OAAAA,CAAQ99B,MAAAA,GAASra,IAAAA,CAAK24C,eAAAA,KAAoB34C,IAAAA,CAAKy3C,OAAAA,EAEpDz3C,IAAAA,CAAKm4C,OAAAA,CAAQ9lB,YAAAA,CAAa,aAAaryB,IAAAA,CAAKsvB,SAAAA,GAC5CtvB,IAAAA,CAAKm4C,OAAAA,CAAQ9lB,YAAAA,CAAa,eAAe,SACzC+E,EAAInnB,KAAAA,CAAMjQ,IAAAA,CAAKy3C,OAAAA,EAASz3C,IAAAA,CAAKy3C,OAAAA,GAC7BrgB,EAAIza,SAAAA,CAAU3c,IAAAA,CAAKk4C,OAAAA,EAASl4C,IAAAA,CAAKk4C,OAAAA,GACjC9gB,EAAI6hB,qBAAAA,GAAwBj5C,IAAAA,CAAK+3C,SAAAA,EACjC3gB,EAAI4gB,SAAAA,GAAYh4C,IAAAA,CAAKg4C,SAAAA,EACrB5gB,EAAI8hB,WAAAA,CAAyB,SAAb,CAAA,IAAAl5C,IAAAA,CAAKi4C,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI7gB,EAAI+hB,WAAAA,KACrC/hB,EAAIogB,OAAAA,GAAUx3C,IAAAA,CAAKw3C,OAAAA,EACnBpgB,EAAIgiB,WAAAA,GAA0C,SAA5B,CAAA,IAAgB,SAAhB,CAAA,IAAAp5C,IAAAA,CAAK83C,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE/3C,QAAAA,EAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,IAClDq3B,EAAIxiB,SAAAA,GAAsB,SAAV,CAAA,IAAA5U,IAAAA,CAAK2T,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE5T,QAAAA;YAC9B;YAEU,WAAW+f,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBACxDpK,IAAAA,CAAK8sB,MAAAA,IACP9sB,IAAAA,CAAK84C,SAAAA,IAEPh5B,EAAG7P,KAAAA,CAAM,IAAIjQ,IAAAA,CAAKy3C,OAAAA,EAAS,IAAIz3C,IAAAA,CAAKy3C,OAAAA,GACpC33B,EAAG0N,SAAAA,CAAUxtB,IAAAA,CAAKm4C,OAAAA,EAAS7rC,GAAGlC;YAChC;QAAA;QC3RF,IAAYivC,IA0BAC,IA4BAC,IAoCAC,IASAC,IC5FAC;QCKL,SAAS5kB,GACdsC,CAAAA,EACAzjB,IAAevB,EAAMgD,GAAAA,EACrBukC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACA7O,IAAoB,CAAA,EACpB8O,IAAoB,MAAA;YAEpB3iB,EAAI7O,IAAAA,IACJ6O,EAAI4iB,SAAAA,IACJ5iB,EAAI4gB,SAAAA,GAAY/M,GAChB7T,EAAIogB,OAAAA,GAAUuC,GACd3iB,EAAIgiB,WAAAA,GAAczlC,EAAM5T,QAAAA,IACxBq3B,EAAI6iB,MAAAA,CAAON,GAAIC,IACfxiB,EAAI8iB,MAAAA,CAAOL,GAAIC,IACf1iB,EAAI+iB,SAAAA,IACJ/iB,EAAImU,MAAAA,IACJnU,EAAI5O,OAAAA;QACN;QAMO,SAAS5L,GAAMwa,CAAAA,EAA+BzjB,IAAevB,EAAMgD,GAAAA,EAAKwH,CAAAA;YAC7Ewa,EAAI4iB,SAAAA,IACJ5iB,EAAIgiB,WAAAA,GAAczlC,EAAM5T,QAAAA,IACxBq3B,EAAIgjB,GAAAA,CAAIx9B,EAAMtQ,CAAAA,EAAGsQ,EAAMxS,CAAAA,EAAG,GAAG,GAAa,IAAV9E,KAAK8G,EAAAA,GACrCgrB,EAAI+iB,SAAAA,IACJ/iB,EAAImU,MAAAA;QACN;QASO,SAASl8B,GAAO+nB,CAAAA,EAA+BzjB,CAAAA,EAAcgY,CAAAA,EAAgBtc,CAAAA,EAAgBY,IAAgB,CAAA;YAClH,MAAMwE,IAAId,IAAQA,EAAM5T,QAAAA,KAAa,QAC/BwP,IAAIF,EAAOY,KAAAA,CAAMA;YACvBmnB,EAAI4iB,SAAAA,IACJ5iB,EAAIgiB,WAAAA,GAAc3kC,GAClB2iB,EAAI6iB,MAAAA,CAAOtuB,EAAOrf,CAAAA,EAAGqf,EAAOvhB,CAAAA,GAC5BgtB,EAAI8iB,MAAAA,CAAOvuB,EAAOrf,CAAAA,GAAIiD,EAAEjD,CAAAA,EAAGqf,EAAOvhB,CAAAA,GAAImF,EAAEnF,CAAAA,GACxCgtB,EAAI+iB,SAAAA,IACJ/iB,EAAImU,MAAAA;QACN;QAmCO,SAAS8O,GACdjjB,CAAAA,EACA9qB,CAAAA,EACAlC,CAAAA,EACA+P,CAAAA,EACAE,CAAAA,EACAuxB,IAAgC,CAAA,EAChCL,IAAuBn5B,EAAM0C,KAAAA,EAC7BwlC,IAAqB,IAAA;YAErB,IAAIC;YAEJ,IAAsB,YAAA,OAAX3O,GACT2O,IAAK;gBAAEC,IAAI5O;gBAAQ6O,IAAI7O;gBAAQ2O,IAAI3O;gBAAQ8O,IAAI9O;YAAAA;iBAC1C;gBACL,MAAM+O,IAA8B;oBAAEH,IAAI;oBAAGC,IAAI;oBAAGF,IAAI;oBAAGG,IAAI;gBAAA;gBAE/D,IAAK,MAAM73C,KAAQ83C,EACjB,IAAIA,EAAc53C,cAAAA,CAAeF,IAAO;oBACtC,MAAMmY,IAA2BnY;oBACjC03C,CAAAA,CAAGv/B,EAAAA,GAAQ4wB,CAAAA,CAAO5wB,EAAAA,IAAS2/B,CAAAA,CAAc3/B,EAC3C;gBAAA;YAEJ;YAEAoc,EAAI4iB,SAAAA,IACJ5iB,EAAI6iB,MAAAA,CAAO3tC,IAAIiuC,EAAGC,EAAAA,EAAIpwC,IACtBgtB,EAAI8iB,MAAAA,CAAO5tC,IAAI6N,IAAQogC,EAAGE,EAAAA,EAAIrwC,IAC9BgtB,EAAIwjB,gBAAAA,CAAiBtuC,IAAI6N,GAAO/P,GAAGkC,IAAI6N,GAAO/P,IAAImwC,EAAGE,EAAAA,GACrDrjB,EAAI8iB,MAAAA,CAAO5tC,IAAI6N,GAAO/P,IAAIiQ,IAASkgC,EAAGA,EAAAA,GACtCnjB,EAAIwjB,gBAAAA,CAAiBtuC,IAAI6N,GAAO/P,IAAIiQ,GAAQ/N,IAAI6N,IAAQogC,EAAGA,EAAAA,EAAInwC,IAAIiQ,IACnE+c,EAAI8iB,MAAAA,CAAO5tC,IAAIiuC,EAAGG,EAAAA,EAAItwC,IAAIiQ,IAC1B+c,EAAIwjB,gBAAAA,CAAiBtuC,GAAGlC,IAAIiQ,GAAQ/N,GAAGlC,IAAIiQ,IAASkgC,EAAGG,EAAAA,GACvDtjB,EAAI8iB,MAAAA,CAAO5tC,GAAGlC,IAAImwC,EAAGC,EAAAA,GACrBpjB,EAAIwjB,gBAAAA,CAAiBtuC,GAAGlC,GAAGkC,IAAIiuC,EAAGC,EAAAA,EAAIpwC,IACtCgtB,EAAI+iB,SAAAA,IAEAG,KACFljB,CAAAA,EAAIxiB,SAAAA,GAAY0lC,EAAKv6C,QAAAA,IACrBq3B,EAAIkjB,IAAAA,EAAAA,GAGF/O,KACFnU,CAAAA,EAAIgiB,WAAAA,GAAc7N,EAAOxrC,QAAAA,IACzBq3B,EAAImU,MAAAA,EAAAA;QAER;QAKO,SAASsP,GACdzjB,CAAAA,EACA9qB,CAAAA,EACAlC,CAAAA,EACAwhC,CAAAA,EACAL,IAAgBn5B,EAAM0C,KAAAA,EACtBwlC,IAAc,IAAA;YAEdljB,EAAI4iB,SAAAA,IACJ5iB,EAAIgjB,GAAAA,CAAI9tC,GAAGlC,GAAGwhC,GAAQ,GAAa,IAAVtmC,KAAK8G,EAAAA,GAC9BgrB,EAAI+iB,SAAAA,IAEAG,KACFljB,CAAAA,EAAIxiB,SAAAA,GAAY0lC,EAAKv6C,QAAAA,IACrBq3B,EAAIkjB,IAAAA,EAAAA,GAGF/O,KACFnU,CAAAA,EAAIgiB,WAAAA,GAAc7N,EAAOxrC,QAAAA,IACzBq3B,EAAImU,MAAAA,EAAAA;QAER;QAAA,CFzKA,SAAY8N,CAAAA;YAIV,EAAA,EAAA,GAAA,MAIA,EAAA,GAAA,GAAA,OAIA,EAAA,EAAA,GAAA,MAIA,EAAA,EAAA,GAAA,MAIA,EAAA,OAAA,GAAA;QACD,EArBWA,MAAAA,CAAAA,KAAQ,CAAA,CAAA,IA0BpB,SAAYC,CAAAA;YAIV,EAAA,IAAA,GAAA,QAIA,EAAA,KAAA,GAAA,SAIA,EAAA,MAAA,GAAA,UAKA,EAAA,KAAA,GAAA,SAKA,EAAA,GAAA,GAAA;QACD,EAvBWA,MAAAA,CAAAA,KAAS,CAAA,CAAA,IA4BrB,SAAYC,CAAAA;YAIV,EAAA,GAAA,GAAA,OAKA,EAAA,OAAA,GAAA,WAIA,EAAA,MAAA,GAAA,UAIA,EAAA,UAAA,GAAA,cAOA,EAAA,WAAA,GAAA,eAMA,EAAA,MAAA,GAAA;QACD,EA/BWA,MAAAA,CAAAA,KAAS,CAAA,CAAA,IAoCrB,SAAYC,CAAAA;YACV,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,OAAA,GAAA;QACD,EAJWA,MAAAA,CAAAA,KAAS,CAAA,CAAA,IASrB,SAAYC,CAAAA;YACV,EAAA,WAAA,GAAA,OACA,EAAA,WAAA,GAAA;QACD,EAHWA,MAAAA,CAAAA,KAAS,CAAA,CAAA;QGrGd,MAAMqB;YAQX,YACkBC,CAAAA,EACAnnB,CAAAA,EACAjgB,CAAAA,EACA2gB,CAAAA,CAAAA;gBAHA,IAAA,CAAAymB,IAAAA,GAAAA,GACA,IAAA,CAAAnnB,IAAAA,GAAAA,GACA,IAAA,CAAAjgB,KAAAA,GAAAA,GACA,IAAA,CAAA2gB,QAAAA,GAAAA,GATV,IAAA,CAAA0mB,cAAAA,GAAwE,EAAA,EAEzE,IAAA,CAAAC,QAAAA,GAAAA,CAAoB,GAuLnB,IAAA,CAAAnuB,MAAAA,GAAAA,CAAS,GA9Kf9sB,IAAAA,CAAKsZ,MAAAA,GAASC,SAASC,aAAAA,CAAc;gBACrC,MAAM4d,IAAMp3B,IAAAA,CAAKsZ,MAAAA,CAAOI,UAAAA,CAAW;gBACnC,IAAA,CAAK0d,GACH,MAAM,IAAIjxB,MAAM;gBAElBnG,IAAAA,CAAKo3B,GAAAA,GAAMA,GACXp3B,IAAAA,CAAKmf,UAAAA,GAAanf,IAAAA,CAAKq0B,WAAAA,CAAYT,IACnC5zB,IAAAA,CAAKk7C,aAAAA,CAAcl7C,IAAAA,CAAKmf,UAAAA,EAAYnf,IAAAA,CAAKo3B,GAAAA,GACzCp3B,IAAAA,CAAKm7C,aAAAA,GAAgBn7C,IAAAA,CAAKo7C,WAAAA;YAC5B;YAEA,YAAYxnB,CAAAA,EAAcU,CAAAA,EAAAA;gBACxB,IAAIt0B,IAAAA,CAAKi7C,QAAAA,EACP,MAAM90C,MAAM,uCAAuCnG,IAAAA,CAAK4zB,IAAAA;gBAE1D,IAAIW,IAAQ;gBAEVA,IADc,QAAZD,IACMt0B,IAAAA,CAAKw0B,iBAAAA,CAAkBZ,GAAMU,KAE7BV,EAAKyB,KAAAA,CAAM;gBAGrB,MAAMZ,IAAeF,EAAMG,MAAAA,CAAO,CAACtyB,GAAGkQ,IAC7BlQ,EAAE9B,MAAAA,GAASgS,EAAEhS,MAAAA,GAAS8B,IAAIkQ;gBAGnCtS,IAAAA,CAAKq7C,UAAAA,CAAWr7C,IAAAA,CAAKo3B,GAAAA;gBACrB,MAAMkkB,IAAUt7C,IAAAA,CAAKo3B,GAAAA,CAAI/C,WAAAA,CAAYI;gBACrC,IAAI8mB,IAAaj2C,KAAKyH,GAAAA,CAAIuuC,EAAQE,uBAAAA,IAA2Bl2C,KAAKyH,GAAAA,CAAIuuC,EAAQG,wBAAAA;gBAG9E,MAAMC,IAAqBH,IAAahnB,EAAMj0B,MAAAA;gBAC9Ci7C,IAAaG;gBACb,MAAMC,IAAeD,IAAqBp2C,KAAKyH,GAAAA,CAAIuuC,EAAQE,uBAAAA;gBAU3D,OAPoB,IAAIlgC,EAAY;oBAClCd,MAHQ,IAGElV,KAAKyH,GAAAA,CAAIuuC,EAAQM,qBAAAA,IAAyB57C,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA;oBAC9Dz9B,KAHQ,IAGCnV,KAAKyH,GAAAA,CAAIuuC,EAAQE,uBAAAA,IAA2Bx7C,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA;oBAC/Dz8B,QAJQ,IAIIkgC,IAAe37C,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA;oBACrC18B,OANQ,IAMGlW,KAAKyH,GAAAA,CAAIuuC,EAAQO,sBAAAA,IAA0B77C,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA;gBAAAA;YAIpE;YAEQ,cAAc4D,CAAAA,EAAyBC,CAAAA,EAAAA;gBAC7C,IAAIC,IAAkB;gBAClBh8C,IAAAA,CAAK+6C,IAAAA,CAAKtnB,UAAAA,IACZuoB,CAAAA,IAAkBh8C,IAAAA,CAAK+6C,IAAAA,CAAKtnB,UAAAA,GAAazzB,IAAAA,CAAK+6C,IAAAA,CAAKjrC,IAAAA,AAAAA,GAKrDisC,EAAOziC,MAAAA,CAAOa,KAAAA,GAAqD,IAA5C2hC,CAAAA,EAAW3hC,KAAAA,GAA4B,IAApBna,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,AAAAA,IAAmBl4C,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,EACjFsE,EAAOziC,MAAAA,CAAOe,MAAAA,GAAuD,IAA7CyhC,CAAAA,EAAWzhC,MAAAA,GAA6B,IAApBra,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,AAAAA,IAAmBl4C,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GAAUuE;YAC/F;YAEO,OAAA,YAAmBjB,CAAAA,EAAYnnB,CAAAA,EAAcjgB,CAAAA,EAAAA;gBAAAA,IAAAA;gBAiBlD,OAfEigB,IACA,iBACAmnB,EAAKkB,UAAAA,GACLlB,EAAKjvB,SAAAA,GACLivB,EAAKmB,SAAAA,GACLnB,EAAKoB,SAAAA,GACLpB,EAAK1/B,SAAAA,GACL0/B,EAAKtnB,UAAAA,GACLlyB,KAAKC,SAAAA,CAAUu5C,EAAKznB,MAAAA,IACnBynB,CAAAA,EAAK7C,OAAAA,CAAQn4C,QAAAA,KACZg7C,EAAKhD,SAAAA,CAAUh4C,QAAAA,KACfg7C,EAAK/C,SAAAA,CAAUj4C,QAAAA,KACfg7C,EAAK9C,QAAAA,CAASl4C,QAAAA,KACE,CAAA,SAAhB,CAAA,IAAAg7C,EAAKjD,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE/3C,QAAAA,EAAAA,IACjB4T,CAAAA,IAAQA,EAAM5T,QAAAA,KAAag7C,EAAKpnC,KAAAA,CAAM5T,QAAAA,EAAAA,CAAAA;YAE7C;YAEA,YAAYq8C,IAAAA,CAAwB,CAAA,EAAA;gBAClC,OAAOtB,GAAiBM,WAAAA,CAAYp7C,IAAAA,CAAK+6C,IAAAA,EAAM/6C,IAAAA,CAAK4zB,IAAAA,EAAMwoB,IAAep8C,IAAAA,CAAK2T,KAAAA,GAAAA,KAAQ7S;YACxF;YAEU,uBAAuBs2B,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBAC/BA,EAAIza,SAAAA,CAAU3c,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,EAASl4C,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,GAC3C9gB,EAAI6hB,qBAAAA,GAAwBj5C,IAAAA,CAAK+6C,IAAAA,CAAKhD,SAAAA,EACtC3gB,EAAI4gB,SAAAA,GAAYh4C,IAAAA,CAAK+6C,IAAAA,CAAK/C,SAAAA,EAC1B5gB,EAAI8hB,WAAAA,CAA8B,SAAlB,CAAA,IAAAl5C,IAAAA,CAAK+6C,IAAAA,CAAK9C,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI7gB,EAAI+hB,WAAAA,KAC1C/hB,EAAIgiB,WAAAA,GAA+C,SAAjC,CAAA,IAAqB,SAArB,CAAA,IAAAp5C,IAAAA,CAAK+6C,IAAAA,CAAKjD,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE/3C,QAAAA,EAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,IACvDq3B,EAAIxiB,SAAAA,GAAY5U,IAAAA,CAAK2T,KAAAA,CAAM5T,QAAAA;YAC7B;YAEQ,WAAWq3B,CAAAA,EAAAA;gBACjBA,EAAIilB,cAAAA,IACJjlB,EAAIza,SAAAA,CAAU3c,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,GAAU9gB,EAAI9d,MAAAA,CAAOa,KAAAA,GAAQ,GAAGna,IAAAA,CAAK+6C,IAAAA,CAAK7C,OAAAA,GAAU9gB,EAAI9d,MAAAA,CAAOe,MAAAA,GAAS,IAChG+c,EAAInnB,KAAAA,CAAMjQ,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,EAASz3C,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GACvCrgB,EAAI8kB,SAAAA,GAAYl8C,IAAAA,CAAK+6C,IAAAA,CAAKmB,SAAAA,EAC1B9kB,EAAIklB,YAAAA,GAAet8C,IAAAA,CAAK+6C,IAAAA,CAAKoB,SAAAA,EAC7B/kB,EAAI2jB,IAAAA,GAAO/6C,IAAAA,CAAK+6C,IAAAA,CAAKkB,UAAAA,EACrB7kB,EAAI/b,SAAAA,GAAYrb,IAAAA,CAAK+6C,IAAAA,CAAK1/B,SAAAA,EAEtBrb,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,IACRtzB,CAAAA,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAO3f,KAAAA,IACnByjB,CAAAA,EAAImlB,WAAAA,GAAcv8C,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAO3f,KAAAA,CAAM5T,QAAAA,EAAAA,GAEvCC,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAOkpB,IAAAA,IACnBplB,CAAAA,EAAIqlB,UAAAA,GAAaz8C,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAOkpB,IAAAA,AAAAA,GAEhCx8C,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAO2B,MAAAA,IACnBmC,CAAAA,EAAIslB,aAAAA,GAAgB18C,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAO2B,MAAAA,CAAO3oB,CAAAA,EAC5C8qB,EAAIulB,aAAAA,GAAgB38C,IAAAA,CAAK+6C,IAAAA,CAAKznB,MAAAA,CAAO2B,MAAAA,CAAO7qB,CAAAA,AAAAA,CAAAA;YAGlD;YAEQ,UAAUgtB,CAAAA,EAA+B7C,CAAAA,EAAiBd,CAAAA,EAAAA;gBAChEzzB,IAAAA,CAAK+4C,sBAAAA,CAAuB3hB,IAC5Bp3B,IAAAA,CAAKq7C,UAAAA,CAAWjkB;gBAEhB,IAAK,IAAI52B,IAAI,GAAGA,IAAI+zB,EAAMj0B,MAAAA,EAAQE,IAAK;oBACrC,MAAMs0B,IAAOP,CAAAA,CAAM/zB,EAAAA;oBACfR,IAAAA,CAAK2T,KAAAA,IACPyjB,EAAItc,QAAAA,CAASga,GAAM,GAAGt0B,IAAIizB,IAGxBzzB,IAAAA,CAAK+6C,IAAAA,CAAKjD,WAAAA,IACZ1gB,EAAIylB,UAAAA,CAAW/nB,GAAM,GAAGt0B,IAAIizB;gBAEhC;gBAEIzzB,IAAAA,CAAK+6C,IAAAA,CAAKjvB,SAAAA,IAGZgJ,CAAAA,GAAKsC,GAAKhlB,EAAM4D,KAAAA,EAAAA,CAAQohB,EAAI9d,MAAAA,CAAOa,KAAAA,GAAQ,GAAG,GAAGid,EAAI9d,MAAAA,CAAOa,KAAAA,GAAQ,GAAG,GAAG,IAG1E2a,GAAKsC,GAAKhlB,EAAMgD,GAAAA,EAAK,GAAA,CAAIgiB,EAAI9d,MAAAA,CAAOe,MAAAA,GAAS,GAAG,GAAG+c,EAAI9d,MAAAA,CAAOe,MAAAA,GAAS,GAAG,EAAA;YAE9E;YAEQ,iBAAiB0hC,CAAAA,EAAAA;gBACvB,MAAMgB,IAAoE,EAAA;gBAC1E,IAAIC,IAAW,GACXC,IAAW;gBAEf,MAAM9iC,IAAQ7U,KAAKkF,GAAAA,CAAI,MAAMuxC,EAAOziC,MAAAA,CAAOa,KAAAA,GACrCE,IAAS/U,KAAKkF,GAAAA,CAAI,MAAMuxC,EAAOziC,MAAAA,CAAOe,MAAAA;gBAG5C,MAAO2iC,IAAWjB,EAAOziC,MAAAA,CAAOa,KAAAA,EAAO;oBACrC,MAAO8iC,IAAWlB,EAAOziC,MAAAA,CAAOe,MAAAA,EAAQ;wBAEtC,MAAMf,IAASC,SAASC,aAAAA,CAAc;wBACtCF,EAAOa,KAAAA,GAAQA,GACfb,EAAOe,MAAAA,GAASA;wBAChB,MAAM+c,IAAM9d,EAAOI,UAAAA,CAAW;wBAC9B,IAAA,CAAK0d,GACH,MAAM,IAAIjxB,MAAM;wBAIlBixB,EAAI5J,SAAAA,CAAUuuB,EAAOziC,MAAAA,EAAQ0jC,GAAUC,GAAU9iC,GAAOE,GAAQ,GAAG,GAAGF,GAAOE,IAE7E0iC,EAAWp9C,IAAAA,CAAK;4BAAE2M,GAAG0wC;4BAAU5yC,GAAG6yC;4BAAU3jC,QAAAA;wBAAAA,IAC5C2jC,KAAY5iC;oBACd;oBACA2iC,KAAY7iC,GACZ8iC,IAAW;gBACb;gBACA,OAAOF;YACT;YAEO,YAAA/M;gBACLhwC,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS;YAChB;YAGO,OAAOhN,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAWkqB,CAAAA,EAAAA;gBAAAA,IAAAA;gBAChE,IAAIt0B,IAAAA,CAAKi7C,QAAAA,EACP,MAAM90C,MAAM,uCAAuCnG,IAAAA,CAAK4zB,IAAAA;gBAE1D5zB,IAAAA,CAAKk9C,GAAAA,GAAMp9B;gBACX,MAAMq9B,IAAWn9C,IAAAA,CAAKo7C,WAAAA;gBAMtB,IALIp7C,IAAAA,CAAKm7C,aAAAA,KAAkBgC,KACzBn9C,CAAAA,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS,CAAA,GAIZ9sB,IAAAA,CAAK8sB,MAAAA,EAAQ;oBACf9sB,IAAAA,CAAKmf,UAAAA,GAAanf,IAAAA,CAAKq0B,WAAAA,CAAYr0B,IAAAA,CAAK4zB,IAAAA,EAAMU,IAC9Ct0B,IAAAA,CAAKk7C,aAAAA,CAAcl7C,IAAAA,CAAKmf,UAAAA,EAAYnf,IAAAA,CAAKo3B,GAAAA;oBACzC,MAAM7C,IAAQv0B,IAAAA,CAAKw0B,iBAAAA,CAAkBx0B,IAAAA,CAAK4zB,IAAAA,EAAMU,IAC1Cb,IAAiC,SAApB,CAAA,IAAAzzB,IAAAA,CAAK+6C,IAAAA,CAAKtnB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAIzzB,IAAAA,CAAKmf,UAAAA,CAAW9E,MAAAA,GAASka,EAAMj0B,MAAAA;oBAM1E,IAHAN,IAAAA,CAAK48C,SAAAA,CAAU58C,IAAAA,CAAKo3B,GAAAA,EAAK7C,GAAOd,IAG5B3T,aAAcmtB,IAChB,KAAK,MAAMmQ,KAAQp9C,IAAAA,CAAKg7C,cAAAA,CACtBl7B,EAAG4oB,aAAAA,CAAc7Z,MAAAA,CAAOuuB,EAAK9jC,MAAAA;oBAOjC,IAFAtZ,IAAAA,CAAKg7C,cAAAA,GAAiBh7C,IAAAA,CAAK88C,gBAAAA,CAAiB98C,IAAAA,CAAKo3B,GAAAA,GAE7CtX,aAAcmtB,IAChB,KAAK,MAAMmQ,KAAQp9C,IAAAA,CAAKg7C,cAAAA,CACtBl7B,EAAG4oB,aAAAA,CAAcze,IAAAA,CAAKmzB,EAAK9jC,MAAAA,EAAQ;wBAAEgW,WAAWtvB,IAAAA,CAAK+6C,IAAAA,CAAKzrB,SAAAA;oBAAAA,GAAAA,CAAa;oBAG3EtvB,IAAAA,CAAKm7C,aAAAA,GAAgBgC,GACrBn9C,IAAAA,CAAK8sB,MAAAA,GAAAA,CAAS;gBAChB;gBAGA,KAAK,MAAMswB,KAAQp9C,IAAAA,CAAKg7C,cAAAA,CACtBl7B,EAAG0N,SAAAA,CACD4vB,EAAK9jC,MAAAA,EACL,GACA,GACA8jC,EAAK9jC,MAAAA,CAAOa,KAAAA,EACZijC,EAAK9jC,MAAAA,CAAOe,MAAAA,EACZ+iC,EAAK9wC,CAAAA,GAAItM,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GAAUnrC,IAAItM,IAAAA,CAAKo3B,GAAAA,CAAI9d,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GAAU,GAC7E2F,EAAKhzC,CAAAA,GAAIpK,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GAAUrtC,IAAIpK,IAAAA,CAAKo3B,GAAAA,CAAI9d,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,GAAU,GAC9E2F,EAAK9jC,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA,EAC9B2F,EAAK9jC,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAK+6C,IAAAA,CAAKtD,OAAAA;YAGrC;YAEA,UAAAroB;gBAKE,IAJApvB,IAAAA,CAAKi7C,QAAAA,GAAAA,CAAW,GAChBj7C,IAAAA,CAAKmf,UAAAA,GAAAA,KAAare,GAClBd,IAAAA,CAAKsZ,MAAAA,GAAAA,KAASxY,GACdd,IAAAA,CAAKo3B,GAAAA,GAAAA,KAAMt2B,GACPd,IAAAA,CAAKk9C,GAAAA,YAAejQ,IACtB,KAAK,MAAMmQ,KAAQp9C,IAAAA,CAAKg7C,cAAAA,CACtBh7C,IAAAA,CAAKk9C,GAAAA,CAAIxU,aAAAA,CAAc7Z,MAAAA,CAAOuuB,EAAK9jC,MAAAA;gBAGvCtZ,IAAAA,CAAKg7C,cAAAA,CAAe16C,MAAAA,GAAS;YAC/B;YAUQ,kBAAkBszB,CAAAA,EAAcU,CAAAA,EAAAA;gBAAAA,IAAAA;gBACtC,IAAIt0B,IAAAA,CAAKk1B,WAAAA,KAAgBtB,KAAQ5zB,IAAAA,CAAKm1B,kBAAAA,KAAuBb,KAA6B,CAAA,SAAjB,CAAA,IAAAt0B,IAAAA,CAAKo1B,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,KAAA,IAAA,EAAE90B,MAAAA,AAAAA,GAC1F,OAAON,IAAAA,CAAKo1B,YAAAA;gBAGd,MAAMb,IAAQX,EAAKyB,KAAAA,CAAM;gBAEzB,IAAgB,QAAZf,GACF,OAAOC;gBAIT,IAAK,IAAI/zB,IAAI,GAAGA,IAAI+zB,EAAMj0B,MAAAA,EAAQE,IAAK;oBACrC,IAAIs0B,IAAOP,CAAAA,CAAM/zB,EAAAA,EACb80B,IAAU;oBACd,IAAIt1B,IAAAA,CAAKq0B,WAAAA,CAAYS,GAAM3a,KAAAA,GAAQma,GAAU;wBAC3C,MAAOt0B,IAAAA,CAAKq0B,WAAAA,CAAYS,GAAM3a,KAAAA,GAAQma,GACpCgB,IAAUR,CAAAA,CAAKA,EAAKx0B,MAAAA,GAAS,EAAA,GAAKg1B,GAClCR,IAAOA,EAAKvpB,KAAAA,CAAM,GAAA;wBAIpBgpB,CAAAA,CAAM/zB,EAAAA,GAAKs0B,GACXP,CAAAA,CAAM/zB,IAAI,EAAA,GAAK80B;oBACjB;gBACF;gBAMA,OAJAt1B,IAAAA,CAAKk1B,WAAAA,GAActB,GACnB5zB,IAAAA,CAAKo1B,YAAAA,GAAeb,GACpBv0B,IAAAA,CAAKm1B,kBAAAA,GAAqBb,GAEnBC;YACT;QAAA;QC3SK,MAAM8oB;YAOX,OAAA,YAAmBzpB,CAAAA,EAAcmnB,CAAAA,EAAYzmB,CAAAA,EAAAA;gBAC3C,MAAMgpB,IAAOxC,GAAiBM,WAAAA,CAAYL,GAAMnnB;gBAChD,IAAIypB,GAAUE,cAAAA,CAAexlC,GAAAA,CAAIulC,IAC/B,OAAOD,GAAUE,cAAAA,CAAe56C,GAAAA,CAAI26C;gBAEtCD,GAAUzuB,OAAAA,CAAQ5W,KAAAA,CAAM;gBACxB,MAAMwlC,IAAczC,EAAK0C,uBAAAA,CAAwB7pB,GAAMU;gBAEvD,OADA+oB,GAAUE,cAAAA,CAAevyB,GAAAA,CAAIsyB,GAAME,IAC5BA;YACT;YAEA,OAAA,gBAAuB5pB,CAAAA,EAAcmnB,CAAAA,EAAYpnC,CAAAA,EAAAA;gBAC/C,MAAM2pC,IAAOxC,GAAiBM,WAAAA,CAAYL,GAAMnnB,GAAMjgB;gBACtD,IAAIgqC,IAAeN,GAAUO,WAAAA,CAAYj7C,GAAAA,CAAI26C;gBAU7C,OATKK,KACHA,CAAAA,IAAe,IAAI7C,GAAiBC,GAAMnnB,GAAMjgB,IAChD0pC,GAAUO,WAAAA,CAAY5yB,GAAAA,CAAIsyB,GAAMK,IAChCN,GAAUzuB,OAAAA,CAAQ5W,KAAAA,CAAM,gCAAA,GAI1BqlC,GAAUQ,WAAAA,CAAY7yB,GAAAA,CAAI2yB,GAAc/O,YAAY1pC,GAAAA,KAE7Cy4C;YACT;YAEA,OAAA,qBAAOG;gBACL,MAAMC,IAA+B,EAAA,EAC/BC,IAAmB,IAAI/mC;gBAC7B,KAAK,MAAA,CAAO0mC,GAAcM,EAAAA,IAASZ,GAAUQ,WAAAA,CAAY3P,OAAAA,GAEvD,IAAI+P,IAAOZ,GAAUa,YAAAA,GAAetP,YAAY1pC,GAAAA,IAC9Cm4C,GAAUzuB,OAAAA,CAAQ5W,KAAAA,CAAM,CAAA,2BAAA,EAA8B2lC,EAAa/pB,IAAAA,EAAAA,GACnEmqB,EAASp+C,IAAAA,CAAKg+C,IACdA,EAAavuB,OAAAA;qBACR;oBACL,MAAMkuB,IAAOK,EAAavC,WAAAA,CAAAA,CAAY;oBACtC4C,EAAiB5tC,GAAAA,CAAIktC;gBACvB;gBAGFS,EAASI,OAAAA,CAAS3nC,CAAAA;oBAChB6mC,GAAUQ,WAAAA,CAAYhvB,MAAAA,CAAOrY;gBAAE,IAIjCxW,IAAAA,CAAK49C,WAAAA,CAAYp2C,KAAAA;gBACjB,KAAK,MAAA,CAAOm2C,EAAAA,IAAiB39C,IAAAA,CAAK69C,WAAAA,CAAY3P,OAAAA,GAC5CluC,IAAAA,CAAK49C,WAAAA,CAAY5yB,GAAAA,CAAI2yB,EAAavC,WAAAA,IAAeuC;gBAInD,MAAMS,IAA0B,IAAI9vB;gBACpC,KAAK,MAAM5F,KAAWs1B,EAChBX,GAAUE,cAAAA,CAAexlC,GAAAA,CAAI2Q,MAC/B01B,EAAwBpzB,GAAAA,CAAItC,GAAS20B,GAAUE,cAAAA,CAAe56C,GAAAA,CAAI+lB;gBAGtE1oB,IAAAA,CAAKu9C,cAAAA,CAAe/1C,KAAAA,IACpBxH,IAAAA,CAAKu9C,cAAAA,GAAiBa;YACxB;YAEO,WAAA,YAAWC;gBAChB,OAAOhB,GAAUQ,WAAAA,CAAY/tC,IAC/B;YAAA;YAKO,OAAA,aAAOwuC;gBACZ,KAAK,MAAA,CAAOX,EAAAA,IAAiBN,GAAUQ,WAAAA,CAAY3P,OAAAA,GACjDyP,EAAavuB,OAAAA;gBAEfiuB,GAAUQ,WAAAA,CAAYr2C,KAAAA,IACtB61C,GAAUO,WAAAA,CAAYp2C,KAAAA,IACtB61C,GAAUE,cAAAA,CAAe/1C,KAAAA;YAC3B;QAAA;QAlFc,GAAA02C,YAAAA,GAAe,KACd,GAAAtvB,OAAAA,GAAUhY,EAAOS,WAAAA,IACjB,GAAAwmC,WAAAA,GAAc,IAAIvvB,KAClB,GAAAsvB,WAAAA,GAAc,IAAItvB,KAClB,GAAAivB,cAAAA,GAAiB,IAAIjvB;QCM/B,MAAMiwB,WAAapzB;YAOxB,YAAYlS,IAAwD,CAAC,CAAA,CAAA;gBAAA,IAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA;gBACnE2T,KAAAA,CAAM3T,IAFD,IAAA,CAAAqW,SAAAA,GAA4B7B,GAAeI,OAAAA,EA6D3C,IAAA,CAAA4pB,OAAAA,GAAU,GAGV,IAAA,CAAAS,OAAAA,GAAU,GACV,IAAA,CAAAH,SAAAA,GAAAA,CAAY,GACZ,IAAA,CAAAC,SAAAA,GAAY,GACZ,IAAA,CAAAC,QAAAA,GAAqB,EAAA,EACrB,IAAA,CAAAtkC,KAAAA,GAAevB,EAAMyC,KAAAA,EAGrB,IAAA,CAAA2pC,MAAAA,GAAiB,cACjB,IAAA,CAAA7kC,KAAAA,GAAmB6/B,GAAUiF,MAAAA,EAC7B,IAAA,CAAAC,IAAAA,GAAAA,CAAgB,GAChB,IAAA,CAAAC,IAAAA,GAAiBtF,GAASuF,EAAAA,EAC1B,IAAA,CAAA1C,SAAAA,GAAuB5C,GAAUlrC,IAAAA,EACjC,IAAA,CAAA+tC,SAAAA,GAAuB5C,GAAUt+B,GAAAA,EACjC,IAAA,CAAAI,SAAAA,GAAuBo+B,GAAUoF,WAAAA,EAIjC,IAAA,CAAAprB,UAAAA,GAAAA,KAAiC3yB,GACjC,IAAA,CAAAgP,IAAAA,GAAe,IAOd,IAAA,CAAAgvC,WAAAA,GAA2B,IAAIxjC,GA8B/B,IAAA,CAAAyjC,gBAAAA,GAAmB,IAAIjE,GAAiB96C,IAAAA,EAAM,IAAIoS,EAAMyC,KAAAA,GAlH9D7U,IAAAA,CAAK+3C,SAAAA,GAA8B,SAAlB,CAAA,IAAA9+B,QAAAA,IAAAA,KAAO,IAAPA,EAAS8+B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI/3C,IAAAA,CAAK+3C,SAAAA,EAC5C/3C,IAAAA,CAAKk4C,OAAAA,GAA0B,SAAhB,CAAA,IAAAj/B,QAAAA,IAAAA,KAAO,IAAPA,EAASi/B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIl4C,IAAAA,CAAKk4C,OAAAA,EACxCl4C,IAAAA,CAAK2T,KAAAA,GAAsB,SAAd,CAAA,IAAAsF,QAAAA,IAAAA,KAAO,IAAPA,EAAStF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3T,IAAAA,CAAK2T,KAAAA,EACpC3T,IAAAA,CAAK83C,WAAAA,GAAkC,SAApB,CAAA,IAAA7+B,QAAAA,IAAAA,KAAO,IAAPA,EAAS6+B,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI93C,IAAAA,CAAK83C,WAAAA,EAChD93C,IAAAA,CAAKi4C,QAAAA,GAA4B,SAAjB,CAAA,IAAAh/B,QAAAA,IAAAA,KAAO,IAAPA,EAASg/B,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAIj4C,IAAAA,CAAKi4C,QAAAA,EAC1Cj4C,IAAAA,CAAKg4C,SAAAA,GAA8B,SAAlB,CAAA,IAAA/+B,QAAAA,IAAAA,KAAO,IAAPA,EAAS++B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIh4C,IAAAA,CAAKg4C,SAAAA,EAC5Ch4C,IAAAA,CAAKsvB,SAAAA,GAA8B,SAAlB,CAAA,IAAArW,QAAAA,IAAAA,KAAO,IAAPA,EAASqW,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAItvB,IAAAA,CAAKsvB,SAAAA,EAG5CtvB,IAAAA,CAAKw+C,MAAAA,GAAwB,SAAf,CAAA,IAAAvlC,QAAAA,IAAAA,KAAO,IAAPA,EAASulC,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIx+C,IAAAA,CAAKw+C,MAAAA,EACtCx+C,IAAAA,CAAK2Z,KAAAA,GAAsB,SAAd,CAAA,IAAAV,QAAAA,IAAAA,KAAO,IAAPA,EAASU,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3Z,IAAAA,CAAK2Z,KAAAA,EACpC3Z,IAAAA,CAAK0+C,IAAAA,GAAoB,SAAb,CAAA,IAAAzlC,QAAAA,IAAAA,KAAO,IAAPA,EAASylC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI1+C,IAAAA,CAAK0+C,IAAAA,EAClC1+C,IAAAA,CAAK8P,IAAAA,GAAoB,SAAb,CAAA,IAAAmJ,QAAAA,IAAAA,KAAO,IAAPA,EAASnJ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI9P,IAAAA,CAAK8P,IAAAA,EAClC9P,IAAAA,CAAK2+C,IAAAA,GAAoB,SAAb,CAAA,IAAA1lC,QAAAA,IAAAA,KAAO,IAAPA,EAAS0lC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI3+C,IAAAA,CAAK2+C,IAAAA,EAClC3+C,IAAAA,CAAKk8C,SAAAA,GAA8B,SAAlB,CAAA,IAAAjjC,QAAAA,IAAAA,KAAO,IAAPA,EAASijC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIl8C,IAAAA,CAAKk8C,SAAAA,EAC5Cl8C,IAAAA,CAAKm8C,SAAAA,GAA8B,SAAlB,CAAA,IAAAljC,QAAAA,IAAAA,KAAO,IAAPA,EAASkjC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIn8C,IAAAA,CAAKm8C,SAAAA,EAC5Cn8C,IAAAA,CAAKqb,SAAAA,GAA8B,SAAlB,CAAA,IAAApC,QAAAA,IAAAA,KAAO,IAAPA,EAASoC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIrb,IAAAA,CAAKqb,SAAAA,EAC5Crb,IAAAA,CAAKyzB,UAAAA,GAAgC,SAAnB,CAAA,IAAAxa,QAAAA,IAAAA,KAAO,IAAPA,EAASwa,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAIzzB,IAAAA,CAAKyzB,UAAAA,EAC9CzzB,IAAAA,CAAKy3C,OAAAA,GAA0B,SAAhB,CAAA,IAAAx+B,QAAAA,IAAAA,KAAO,IAAPA,EAASw+B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIz3C,IAAAA,CAAKy3C,OAAAA,EAAAA,AACpCx+B,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASqa,MAAAA,AAAAA,KACXtzB,CAAAA,IAAAA,CAAKszB,MAAAA,GAAS,CAAC,GACftzB,IAAAA,CAAKszB,MAAAA,CAAOkpB,IAAAA,GAA0B,SAAnB,CAAA,IAAAvjC,EAAQqa,MAAAA,CAAOkpB,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAIx8C,IAAAA,CAAKszB,MAAAA,CAAOkpB,IAAAA,EACtDx8C,IAAAA,CAAKszB,MAAAA,CAAO2B,MAAAA,GAA8B,SAArB,CAAA,IAAAhc,EAAQqa,MAAAA,CAAO2B,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIj1B,IAAAA,CAAKszB,MAAAA,CAAO2B,MAAAA,EAC1Dj1B,IAAAA,CAAKszB,MAAAA,CAAO3f,KAAAA,GAA4B,SAApB,CAAA,IAAAsF,EAAQqa,MAAAA,CAAO3f,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3T,IAAAA,CAAKszB,MAAAA,CAAO3f,KAAAA,AAAAA;YAE5D;YAEO,QAAA1B;gBACL,OAAO,IAAIssC,GAAK;oBAAA,GACXv+C,IAAAA,CAAKisB,mBAAAA,EAAAA;oBACRnc,MAAM9P,IAAAA,CAAK8P,IAAAA;oBACX6uC,MAAM3+C,IAAAA,CAAK2+C,IAAAA;oBACXH,QAAQx+C,IAAAA,CAAKw+C,MAAAA;oBACb7kC,OAAO3Z,IAAAA,CAAK2Z,KAAAA;oBACZ+kC,MAAM1+C,IAAAA,CAAK0+C,IAAAA;oBACXxC,WAAWl8C,IAAAA,CAAKk8C,SAAAA;oBAChBC,WAAWn8C,IAAAA,CAAKm8C,SAAAA;oBAChB9gC,WAAWrb,IAAAA,CAAKqb,SAAAA;oBAChBiY,QAAQtzB,IAAAA,CAAKszB,MAAAA,GACT;wBACEkpB,MAAMx8C,IAAAA,CAAKszB,MAAAA,CAAOkpB,IAAAA;wBAClBvnB,QAAQj1B,IAAAA,CAAKszB,MAAAA,CAAO2B,MAAAA;wBACpBthB,OAAO3T,IAAAA,CAAKszB,MAAAA,CAAO3f,KAAAA;oBAAAA,IAAAA,KAErB7S;gBAAAA;YAER;YAkCA,IAAA,aAAWm7C;gBACT,OAAO,GAAGj8C,IAAAA,CAAK2Z,KAAAA,CAAAA,CAAAA,EAAS3Z,IAAAA,CAAK0+C,IAAAA,GAAO,SAAS,GAAA,CAAA,EAAM1+C,IAAAA,CAAK8P,IAAAA,GAAO9P,IAAAA,CAAK2+C,IAAAA,CAAAA,CAAAA,EAAQ3+C,IAAAA,CAAKw+C,MAAAA,EACnF;YAAA;YAIA,IAAA,cAAWtyB;gBACT,OAAOlsB,IAAAA,CAAK8+C,WACd;YAAA;YAEU,WAAW5B,CAAAA,EAA+BzvC,CAAAA,EAAYyB,CAAAA,EAAAA,CAEhE;YAEU,QAAQ4Q,CAAAA,EAAAA;gBAAAA,IAAAA;gBAEhB,MAAM6L,IAAoB,SAAX,CAAA,IAAA3rB,IAAAA,CAAK2rB,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI3rB,IAAAA,CAAK8+C,WAAAA,CAAYxiC,MAAAA;gBAC/CwD,EAAGnD,SAAAA,CAAUgP,EAAOrf,CAAAA,EAAGqf,EAAOvhB,CAAAA,GAC9B0V,EAAGjO,MAAAA,CAAO7R,IAAAA,CAAK2iB,QAAAA,GACf7C,EAAGnD,SAAAA,CAAAA,CAAWgP,EAAOrf,CAAAA,EAAAA,CAAIqf,EAAOvhB,CAAAA;YAClC;YAEU,MAAM0V,CAAAA,EAAAA;gBACV9f,IAAAA,CAAKsrB,cAAAA,IACPxL,CAAAA,EAAGnD,SAAAA,CAAU3c,IAAAA,CAAK8+C,WAAAA,CAAY3kC,KAAAA,GAAQna,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAG,IACpDwT,EAAG7P,KAAAA,CAAAA,IAAU,EAAA,GAGXjQ,IAAAA,CAAKwrB,YAAAA,IACP1L,CAAAA,EAAGnD,SAAAA,CAAU,GAAA,CAAI3c,IAAAA,CAAK8+C,WAAAA,CAAYzkC,MAAAA,GAAS,IAAIra,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,GAC1D0V,EAAG7P,KAAAA,CAAM,GAAA,GAAI;YAEjB;YAIO,wBAAwB2jB,CAAAA,EAAcU,CAAAA,EAAAA;gBAC3C,OAAOt0B,IAAAA,CAAK++C,gBAAAA,CAAiB1qB,WAAAA,CAAYT,GAAMU;YACjD;YASO,YAAYV,CAAAA,EAAcU,CAAAA,EAAAA;gBAC/B,OAAO+oB,GAAUhpB,WAAAA,CAAYT,GAAM5zB,IAAAA,EAAMs0B;YAC3C;YAEU,UAAUxU,CAAAA,EAAAA;gBAClBA,EAAG0I,OAAAA;YACL;YAEO,OAAO1I,CAAAA,EAA8B8T,CAAAA,EAAcorB,CAAAA,EAAsB1yC,CAAAA,EAAWlC,CAAAA,EAAWkqB,CAAAA,EAAAA;gBACpG,MAAMqpB,IAAeN,GAAUK,eAAAA,CAAgB9pB,GAAM5zB,IAAAA,EAAMg/C;gBAG3Dh/C,IAAAA,CAAK8+C,WAAAA,GAAcnB,EAAax+B,UAAAA,EAChCnf,IAAAA,CAAKmsB,QAAAA,CAASrM,GAAIxT,GAAGlC,IAErBuzC,EAAa5oB,MAAAA,CAAOjV,GAAIxT,GAAGlC,GAAGkqB,IAE9Bt0B,IAAAA,CAAKqsB,SAAAA,CAAUvM;YACjB;QAAA;QC3IK,MAAMm/B,WAAa9zB;YAGxB,YAAYlS,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACV2T,KAAAA,CAAM3T,IAiBA,IAAA,CAAAma,KAAAA,GAAgB,IAkBhB,IAAA,CAAA8rB,UAAAA,GAAqB,GASrB,IAAA,CAAAC,WAAAA,GAAsB,GA1C5Bn/C,IAAAA,CAAK+6C,IAAAA,GAAmB,SAAZ,CAAA,IAAA9hC,EAAQ8hC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,IAAIwD,IAChCv+C,IAAAA,CAAK2T,KAAAA,GAAqB,SAAb,CAAA,IAAAsF,EAAQtF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3T,IAAAA,CAAK2T,KAAAA,EACnC3T,IAAAA,CAAK4zB,IAAAA,GAAO3a,EAAQ2a,IAAAA,EACpB5zB,IAAAA,CAAKs0B,QAAAA,GAAWrb,EAAQqb,QAC1B;YAAA;YAEO,QAAAriB;gBAAAA,IAAAA,GAAAA;gBACL,OAAO,IAAIgtC,GAAK;oBACdrrB,MAAM5zB,IAAAA,CAAK4zB,IAAAA,CAAKroB,KAAAA;oBAChBoI,OAA0B,SAAnB,CAAA,IAAU,SAAV,CAAA,IAAA3T,IAAAA,CAAK2T,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE1B,KAAAA,EAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIG,EAAMyC,KAAAA;oBACpCkmC,MAAM/6C,IAAAA,CAAK+6C,IAAAA,CAAK9oC,KAAAA;oBAChBqiB,UAAUt0B,IAAAA,CAAKs0B,QAAAA;gBAAAA;YAEnB;YAGA,IAAA,OAAWV;gBACT,OAAO5zB,IAAAA,CAAKozB,KACd;YAAA;YAEA,IAAA,KAAgBhwB,CAAAA,EAAAA;gBACdpD,IAAAA,CAAKozB,KAAAA,GAAQhwB,GACbpD,IAAAA,CAAKo/C,mBAAAA;YACP;YAGA,IAAA,OAAWrE;gBACT,OAAO/6C,IAAAA,CAAKq/C,KACd;YAAA;YACA,IAAA,KAAgBtE,CAAAA,EAAAA;gBACd/6C,IAAAA,CAAKq/C,KAAAA,GAAQtE;YACf;YAIA,IAAA,QAAW5gC;gBAIT,OAHwB,MAApBna,IAAAA,CAAKk/C,UAAAA,IACPl/C,IAAAA,CAAKo/C,mBAAAA,IAEAp/C,IAAAA,CAAKk/C,UAAAA,GAAal/C,IAAAA,CAAKiQ,KAAAA,CAAM3D,CACtC;YAAA;YAGA,IAAA,SAAW+N;gBAIT,OAHyB,MAArBra,IAAAA,CAAKm/C,WAAAA,IACPn/C,IAAAA,CAAKo/C,mBAAAA,IAEAp/C,IAAAA,CAAKm/C,WAAAA,GAAcn/C,IAAAA,CAAKiQ,KAAAA,CAAM7F,CACvC;YAAA;YAEQ,sBAAAg1C;gBACN,MAAA,EAAM,OAAEjlC,CAAAA,EAAK,QAAEE,CAAAA,EAAAA,GAAWra,IAAAA,CAAK+6C,IAAAA,CAAK1mB,WAAAA,CAAYr0B,IAAAA,CAAKozB,KAAAA,EAAOpzB,IAAAA,CAAKs0B,QAAAA;gBACjEt0B,IAAAA,CAAKk/C,UAAAA,GAAa/kC,GAClBna,IAAAA,CAAKm/C,WAAAA,GAAc9kC;YACrB;YAEA,IAAA,cAAW6R;gBACT,OAAOlsB,IAAAA,CAAK+6C,IAAAA,CAAK1mB,WAAAA,CAAYr0B,IAAAA,CAAKozB,KAAAA,EAAOpzB,IAAAA,CAAKs0B,QAAAA,EAAUrkB,KAAAA,CAAMjQ,IAAAA,CAAKiQ,KAAAA;YACrE;YAEmB,QAAQitC,CAAAA,EAAAA,CAG3B;YAEmB,MAAMA,CAAAA,EAAAA,CAGzB;YAEmB,SAASp9B,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC/DpK,CAAAA,IAAAA,CAAKorB,OAAAA,MAAaprB,IAAAA,CAAK+6C,IAAAA,CAAK3vB,OAAAA,EAAAA,KAC9BprB,CAAAA,IAAAA,CAAK+6C,IAAAA,CAAKzvB,cAAAA,GAAiBtrB,IAAAA,CAAKsrB,cAAAA,EAChCtrB,IAAAA,CAAK+6C,IAAAA,CAAKvvB,YAAAA,GAAexrB,IAAAA,CAAKwrB,YAAAA,EAC9BxrB,IAAAA,CAAK+6C,IAAAA,CAAKp4B,QAAAA,GAAW3iB,IAAAA,CAAK2iB,QAAAA,EAC1B3iB,IAAAA,CAAK+6C,IAAAA,CAAKpvB,MAAAA,GAAS3rB,IAAAA,CAAK2rB,MAAAA,EACxB3rB,IAAAA,CAAK+6C,IAAAA,CAAKnyB,OAAAA,GAAU5oB,IAAAA,CAAK4oB,OAAAA,AAAAA,GAE3B5oB,IAAAA,CAAK+6C,IAAAA,CAAKjyB,IAAAA,GAAO9oB,IAAAA,CAAK8oB,IAAAA,EACtB8D,KAAAA,CAAMT,SAASrM,GAAIxT,GAAGlC;YACxB;YAEmB,WAAW0V,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACrE,IAAIuJ,IAAQvB,EAAMyC,KAAAA;gBACd7U,IAAAA,CAAK+6C,IAAAA,YAAgBwD,MACvB5qC,CAAAA,IAAkB,SAAV,CAAA,IAAA3T,IAAAA,CAAK2T,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI3T,IAAAA,CAAK+6C,IAAAA,CAAKpnC,KAAAA,AAAAA;gBAGlC,MAAA,EAAM,OAAEwG,CAAAA,EAAK,QAAEE,CAAAA,EAAAA,GAAWra,IAAAA,CAAK+6C,IAAAA,CAAK1mB,WAAAA,CAAYr0B,IAAAA,CAAKozB,KAAAA,EAAOpzB,IAAAA,CAAKs0B,QAAAA;gBACjEt0B,IAAAA,CAAKk/C,UAAAA,GAAa/kC,GAClBna,IAAAA,CAAKm/C,WAAAA,GAAc9kC,GAEnBra,IAAAA,CAAK+6C,IAAAA,CAAKhmB,MAAAA,CAAOjV,GAAI9f,IAAAA,CAAKozB,KAAAA,EAAOzf,GAAOrH,GAAGlC,GAAGpK,IAAAA,CAAKs0B,QAAAA,GAE/Ct0B,IAAAA,CAAK+6C,IAAAA,CAAKjvB,SAAAA,IACZhM,CAAAA,EAAG9H,KAAAA,CAAM+H,QAAAA,CAASzT,IAAI6N,GAAO/P,IAAIiQ,GAAgB,IAARF,GAAoB,IAATE,IAC/B,QAAjBra,IAAAA,CAAKs0B,QAAAA,IACPxU,EAAG9H,KAAAA,CAAM+H,QAAAA,CAASzT,GAAGlC,GAAGpK,IAAAA,CAAKs0B,QAAAA,EAAUt0B,IAAAA,CAAKqa,MAAAA,EAAQ;oBAClD1G,OAAOvB,EAAM8C,MAAAA;gBAAAA,EAAAA;YAIrB;QAAA;QC3HK,SAASoqC,GAAgBlK,CAAAA;YAC9B,OAAA,CAAA,CAAUA,EAA+ByB,IAC3C;QAAA;QA8DO,MAAM0I,WAA0B5N;YAkCrC,IAAA,UAAW6N;gBACT,OAAOx/C,IAAAA,CAAKy/C,SACd;YAAA;YAMA,IAAA,QAAmBhzC,CAAAA,EAAAA;gBACjBzM,IAAAA,CAAKy/C,SAAAA,GAAYhzC;YACnB;YAsBA,IAAA,SAAWwoB;gBACT,OAAOj1B,IAAAA,CAAK0/C,OACd;YAAA;YACA,IAAA,OAAkBt8C,CAAAA,EAAAA;gBAChBpD,IAAAA,CAAK0/C,OAAAA,GAAU,IAAIhQ,GAAYtsC,GAAO,IAAMpD,IAAAA,CAAK2/C,iBAAAA,KACjD3/C,IAAAA,CAAK2/C,iBAAAA;YACP;YAOA,IAAA,SAAW7tC;gBACT,OAAO9R,IAAAA,CAAK4/C,OACd;YAAA;YACA,IAAA,OAAkBx8C,CAAAA,EAAAA;gBAChBpD,IAAAA,CAAK4/C,OAAAA,GAAU,IAAIlQ,GAAYtsC,GAAO,IAAMpD,IAAAA,CAAK2/C,iBAAAA,KACjD3/C,IAAAA,CAAK2/C,iBAAAA;YACP;YAKA,IAAA,QAAWhsC;gBACT,OAAO3T,IAAAA,CAAKoZ,MACd;YAAA;YACA,IAAA,MAAiB7J,CAAAA,EAAAA;gBACf,IAAIA,GAAG;oBACLvP,IAAAA,CAAKoZ,MAAAA,GAAS7J,EAAE0C,KAAAA;oBAChB,MAAM4tC,IAAiB7/C,IAAAA,CAAK8/C,QAAAA,CAASp3B,OAAAA;oBACjCm3B,CAAAA,aAA0BtI,MAAUsI,aAA0BZ,EAAAA,KAChEY,CAAAA,EAAelsC,KAAAA,GAAQ3T,IAAAA,CAAKoZ,MAAAA,AAAAA;gBAEhC;YACF;YAkBA,YAAYH,CAAAA,CAAAA;gBACV2T,KAAAA,IAvHM,IAAA,CAAAC,OAAAA,GAAUjW,EAAOS,WAAAA,IAEjB,IAAA,CAAA0oC,QAAAA,GAAmB,WACnB,IAAA,CAAAC,SAAAA,GAAqC,CAAC,GACtC,IAAA,CAAA3mC,QAAAA,GAA4D,CAAC,GAE9D,IAAA,CAAA0P,QAAAA,GAA4B,MA0C5B,IAAA,CAAA02B,SAAAA,GAAAA,CAAqB,GAKrB,IAAA,CAAAQ,aAAAA,GAAAA,CAAyB,GAKzB,IAAA,CAAAr3B,OAAAA,GAAkB,GAEjB,IAAA,CAAA82B,OAAAA,GAAkB,IAAIhQ,GAAY5hC,EAAOC,IAAAA,EAAM,IAAM/N,IAAAA,CAAK2/C,iBAAAA,KAa1D,IAAA,CAAAC,OAAAA,GAAkB,IAAIlQ,GAAY5hC,EAAOG,IAAAA,EAAM,IAAMjO,IAAAA,CAAK2/C,iBAAAA,KAgC3D,IAAA,CAAAr0B,cAAAA,GAAAA,CAA0B,GAK1B,IAAA,CAAAE,YAAAA,GAAAA,CAAwB,GAMxB,IAAA,CAAA00B,YAAAA,GAAAA,CAAwB,GAK7BjnC,IAAU;oBACRumC,SAASx/C,IAAAA,CAAKy/C,SAAAA;oBACdK,UAAU,CAAC;oBAAA,GACR7mC,CAAAA;gBAAAA;gBAGL,MAAA,EAAM,SACJyP,CAAAA,EAAO,QACP5W,CAAAA,EAAM,OACN6B,CAAAA,EAAK,SACLiV,CAAAA,EAAO,SACP42B,CAAAA,EAAO,UACPM,CAAAA,EAAQ,QACR7qB,CAAAA,EAAM,cACNirB,CAAAA,EAAY,WACZC,CAAAA,EAAS,YACTC,CAAAA,EAAU,oBACVC,CAAAA,EAAkB,qBAClBC,CAAAA,EAAAA,GACErnC;gBAEJ,KAAK,MAAA,CAAO3W,GAAKi+C,EAAAA,IAAqB/9C,OAAO0rC,OAAAA,CAAQ4R,GAC/CS,aAA4Bp1B,KAC9BnrB,IAAAA,CAAKggD,SAAAA,CAAU19C,EAAAA,GAAOi+C,IAEtBvgD,CAAAA,IAAAA,CAAKggD,SAAAA,CAAU19C,EAAAA,GAAOi+C,EAAiBnL,OAAAA,EACvCp1C,IAAAA,CAAKqZ,QAAAA,CAAS/W,EAAAA,GAAOi+C,EAAiBtnC,OAAAA,AAAAA;gBAI1CjZ,IAAAA,CAAKi1B,MAAAA,GAASA,QAAAA,IAAAA,IAAUj1B,IAAAA,CAAKi1B,MAAAA,EAC7Bj1B,IAAAA,CAAK4oB,OAAAA,GAAUA,QAAAA,IAAAA,IAAW5oB,IAAAA,CAAK4oB,OAAAA,EAC/B5oB,IAAAA,CAAK8R,MAAAA,GAASA,QAAAA,IAAAA,IAAU9R,IAAAA,CAAK8R,MAAAA,EAC7B9R,IAAAA,CAAK2T,KAAAA,GAAQA,QAAAA,IAAAA,IAAS3T,IAAAA,CAAK2T,KAAAA,EAC3B3T,IAAAA,CAAKkgD,YAAAA,GAAeA,QAAAA,IAAAA,IAAgBlgD,IAAAA,CAAKkgD,YAAAA,EACzClgD,IAAAA,CAAKmgD,SAAAA,GAAYA,QAAAA,IAAAA,IAAangD,IAAAA,CAAKmgD,SAAAA,EACnCngD,IAAAA,CAAKogD,UAAAA,GAAaA,QAAAA,IAAAA,IAAcpgD,IAAAA,CAAKogD,UAAAA,EACrCpgD,IAAAA,CAAKmgD,SAAAA,GAAYE,QAAAA,IAAAA,IAAsBrgD,IAAAA,CAAKqgD,kBAAAA,EAC5CrgD,IAAAA,CAAKsgD,mBAAAA,GAAsBA,QAAAA,IAAAA,IAAuBtgD,IAAAA,CAAKsgD,mBAAAA,EACvDtgD,IAAAA,CAAKy/C,SAAAA,GAAAA,CAAAA,CAAcD,GACnBx/C,IAAAA,CAAK+/C,QAAAA,GAAWr3B,QAAAA,IAAAA,IAAW1oB,IAAAA,CAAK+/C,QAAAA,EAC5Br3B,KAAW1oB,IAAAA,CAAKggD,SAAAA,CAAUt3B,EAAAA,IAC5B1oB,IAAAA,CAAKu3B,GAAAA,CAAI7O;YAEb;YAEO,WAAW+F,CAAAA,EAAAA;gBAChB,OAAOzuB,IAAAA,CAAKggD,SAAAA,CAAUvxB,EACxB;YAAA;YACO,WAAWA,CAAAA,EAAAA;gBAChB,OAAOzuB,IAAAA,CAAKqZ,QAAAA,CAASoV,EACvB;YAAA;YAKO,WAAAiyB;gBACL,OAAOl+C,OAAO+D,IAAAA,CAAKvG,IAAAA,CAAKggD,SAAAA;YAC1B;YAKA,IAAA,UAAWt3B;gBACT,OAAO1oB,IAAAA,CAAKggD,SAAAA,CAAUhgD,IAAAA,CAAK+/C,QAAAA,CAC7B;YAAA;YAKA,IAAA,iBAAWY;gBACT,OAAO3gD,IAAAA,CAAKqZ,QAAAA,CAASrZ,IAAAA,CAAK+/C,QAAAA,CAC5B;YAAA;YAKA,IAAA,WAAWD;gBACT,OAAO9/C,IAAAA,CAAKggD,SACd;YAAA;YAKA,IAAA,UAAW/mC;gBACT,OAAOjZ,IAAAA,CAAKqZ,QACd;YAAA;YAQO,IAAIunC,CAAAA,EAAiCL,CAAAA,EAAkDtnC,CAAAA,EAAAA;gBAC5F,IAEI4nC,GAFApyB,IAAO,WACPqyB,IAA+B;gBAYnC,IAV6B,YAAA,OAAlBF,KAA8BL,aAA4Bp1B,MACnEsD,CAAAA,IAAOmyB,GACPE,IAAeP,GACfM,IAAe5nC,CAAAA,GAEb2nC,aAAyBz1B,MAAAA,CAAao1B,CAAAA,aAA4Bp1B,EAAAA,KACpE21B,CAAAA,IAAeF,GACfC,IAAeN,CAAAA,GAAAA,CAGZO,GACH,MAAM,IAAI36C,MAAM;gBAOlB,OALAnG,IAAAA,CAAKggD,SAAAA,CAAUvxB,EAAAA,GAAQzuB,IAAAA,CAAKkgD,YAAAA,GAAeY,EAAa7uC,KAAAA,KAAU6uC,GAClE9gD,IAAAA,CAAKqZ,QAAAA,CAASoV,EAAAA,GAAQzuB,IAAAA,CAAKkgD,YAAAA,GAAe;oBAAA,GAAKW,CAAAA;gBAAAA,IAAiBA,GACnD,cAATpyB,KACFzuB,IAAAA,CAAKu3B,GAAAA,CAAI,YAEJupB;YACT;YAMO,OAAOryB,CAAAA,EAAAA;gBAAAA,OACLzuB,IAAAA,CAAKggD,SAAAA,CAAUvxB,EAAAA,EAAAA,OACfzuB,IAAAA,CAAKqZ,QAAAA,CAASoV,EAAAA,EACjBzuB,IAAAA,CAAK+/C,QAAAA,KAAatxB,KACpBzuB,CAAAA,IAAAA,CAAK+/C,QAAAA,GAAW,WAChB//C,IAAAA,CAAK2/C,iBAAAA,EAAAA;YAET;YASO,IAAiCiB,CAAAA,EAA2B3nC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACjE,IAAI2nC,aAAyBz1B,IAAS;oBACpC,IAAIiqB,IAAUwL;oBACV5gD,IAAAA,CAAKkgD,YAAAA,IACP9K,CAAAA,IAAUwL,EAAc3uC,KAAAA,EAAAA,GAE1BjS,IAAAA,CAAK+/C,QAAAA,GAAW,WAChB//C,IAAAA,CAAKggD,SAAAA,CAAUhgD,IAAAA,CAAK+/C,QAAAA,CAAAA,GAAY3K,GAChCp1C,IAAAA,CAAKqZ,QAAAA,CAASrZ,IAAAA,CAAK+/C,QAAAA,CAAAA,GAAY9mC;gBACjC,OACEjZ,IAAAA,CAAK+/C,QAAAA,GAAWa,GAChB5gD,IAAAA,CAAKqZ,QAAAA,CAASrZ,IAAAA,CAAK+/C,QAAAA,CAAAA,GAAY9mC,GACzBjZ,IAAAA,CAAK+/C,QAAAA,IAAY//C,IAAAA,CAAKggD,SAAAA,IAC1BhgD,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,QAAA,EAAWrY,IAAAA,CAAK+/C,QAAAA,CAAAA,wDAAAA,EAA6E,SAAV,CAAA,IAAA//C,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEnjB,IAAAA,CAAAA,wBAAAA,CAAAA;gBAKrG,OADAzuB,IAAAA,CAAK2/C,iBAAAA,IACE3/C,IAAAA,CAAK0oB,OACd;YAAA;YAKO,OAAAs4B;gBACLhhD,IAAAA,CAAK+/C,QAAAA,GAAW;YAClB;YAGA,IAAA,YAAuB/qB,CAAAA,EAAAA;gBACrBh1B,IAAAA,CAAKihD,YAAAA,GAAejsB;YACtB;YAEO,oBAAA2qB;gBACL,IAAI//B,IAAK,IAAItE;gBACb,MAAM85B,IAAUp1C,IAAAA,CAAKggD,SAAAA,CAAUhgD,IAAAA,CAAK+/C,QAAAA,CAAAA,EAC9B9mC,IAAUjZ,IAAAA,CAAKqZ,QAAAA,CAASrZ,IAAAA,CAAK+/C,QAAAA,CAAAA;gBAEnC,IAAA,CAAK3K,GAEH,OAAA,KADAp1C,CAAAA,IAAAA,CAAKihD,YAAAA,GAAerhC,CAAAA;gBAItB,IAAI9N,IAAS9R,IAAAA,CAAK8R,MAAAA,EACdmjB,IAASj1B,IAAAA,CAAKi1B,MAAAA;gBACdhc,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASnH,MAAAA,AAAAA,KACXA,CAAAA,IAASmH,EAAQnH,MAAAA,AAAAA,GAAAA,AAEfmH,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASgc,MAAAA,AAAAA,KACXA,CAAAA,IAAShc,EAAQgc,MAAAA,AAAAA;gBAEnB,MAAMD,IAASogB,EAAQlpB,WAAAA,EACjBg1B,IAAAA,CAAWlsB,EAAO7a,KAAAA,GAAQrI,EAAOxF,CAAAA,GAAI2oB,EAAO3oB,CAAAA,EAC5C60C,IAAAA,CAAWnsB,EAAO3a,MAAAA,GAASvI,EAAO1H,CAAAA,GAAI6qB,EAAO7qB,CAAAA;gBAEjDwV,IADEw1B,aAAmB4B,MAAAA,CAAkB5B,EAAQ6B,SAAAA,GAC1C7B,QAAAA,IAAAA,KAAO,IAAPA,EAASlpB,WAAAA,CAAYlN,OAAAA,CAAQY,KAE7Bw1B,QAAAA,IAAAA,KAAO,IAAPA,EAASlpB,WAAAA,CAAYvP,SAAAA,CAAUjO,EAAIwyC,GAASC,IAAUniC,OAAAA,CAAQY,IAErE5f,IAAAA,CAAKihD,YAAAA,GAAerhC;YACtB;YAKA,IAAA,cAAWsM;gBAIT,OAHKlsB,IAAAA,CAAKihD,YAAAA,IAAAA,CAAgBjhD,IAAAA,CAAKihD,YAAAA,CAAa5kC,iBAAAA,MAC1Crc,IAAAA,CAAK2/C,iBAAAA,IAEA3/C,IAAAA,CAAKihD,YACd;YAAA;YAKA,IAAA,SAAWjsB;gBACT,IAAIA,IAASh1B,IAAAA,CAAKksB,WAAAA;gBAClB,IAAIlsB,IAAAA,CAAK4xC,KAAAA,EAAO;oBACd,MAAM3rB,IAAKjmB,IAAAA,CAAK4xC,KAAAA,CAAMjvC,GAAAA,CAAIgwC;oBACtB1sB,KACF+O,CAAAA,IAASA,EAAOjY,SAAAA,CAAUkJ,EAAGtjB,GAAAA,GAAMqa,MAAAA,CAAAA;gBAEvC;gBACA,OAAOgY;YACT;YAOO,OAAO8hB,CAAAA,EAAiBC,IAA2B,CAAA,EAAA;gBACxD,MAAM3B,IAAUp1C,IAAAA,CAAK0oB,OAAAA;gBACjB0sB,KAAWkK,GAAgBlK,MAC7BA,EAAQyB,IAAAA,CAAKC,GAASC;YAE1B;YAEO,QAAA9kC;gBACL,MAAM6tC,IAAW,IAAIP;gBAcrB,OAbAO,EAASE,SAAAA,GAAY;oBAAA,GAAKhgD,IAAAA,CAAKggD,SAAAA;gBAAAA,GAC/BF,EAASzmC,QAAAA,GAAW;oBAAA,GAAKrZ,IAAAA,CAAKqZ,QAAAA;gBAAAA,GAC9BymC,EAAS7qB,MAAAA,GAASj1B,IAAAA,CAAKi1B,MAAAA,CAAOhjB,KAAAA,IAC1BjS,IAAAA,CAAK2T,KAAAA,IACPmsC,CAAAA,EAASnsC,KAAAA,GAAQ3T,IAAAA,CAAK2T,KAAAA,CAAM1B,KAAAA,EAAAA,GAE9B6tC,EAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK4oB,OAAAA,EACxBk3B,EAAShuC,MAAAA,GAAS9R,IAAAA,CAAK8R,MAAAA,CAAOG,KAAAA,IAC9B6tC,EAASI,YAAAA,GAAelgD,IAAAA,CAAKkgD,YAAAA,EAC7BJ,EAASK,SAAAA,GAAYngD,IAAAA,CAAKmgD,SAAAA,EAC1BL,EAASM,UAAAA,GAAapgD,IAAAA,CAAKogD,UAAAA,EAC3BN,EAASL,SAAAA,GAAYz/C,IAAAA,CAAKy/C,SAAAA,EAEnBK;YACT;QAAA;QAAA,CN3bF,SAAYpG,CAAAA;YACV,EAAA,IAAA,GAAA,QACA,EAAA,OAAA,GAAA,WACA,EAAA,QAAA,GAAA,YAEA,EAAA,OAAA,GAAA,WACA,EAAA,QAAA,GAAA,YAEA,EAAA,YAAA,GAAA,gBACA,EAAA,aAAA,GAAA,iBAEA,EAAA,SAAA,GAAA,aACA,EAAA,UAAA,GAAA,cAEA,EAAA,QAAA,GAAA,YACA,EAAA,SAAA,GAAA,aAEA,EAAA,YAAA,GAAA,gBACA,EAAA,cAAA,GAAA,kBACA,EAAA,YAAA,GAAA,gBACA,EAAA,aAAA,GAAA,iBAEA,EAAA,UAAA,GAAA,cACA,EAAA,QAAA,GAAA,YACA,EAAA,UAAA,GAAA,cAEA,EAAA,YAAA,GAAA,gBACA,EAAA,aAAA,GAAA,iBAEA,EAAA,WAAA,GAAA,QACA,EAAA,YAAA,GAAA,SAEA,EAAA,OAAA,GAAA,WACA,EAAA,UAAA,GAAA,cACA,EAAA,MAAA,GAAA,UACA,EAAA,IAAA,GAAA,QAEA,EAAA,OAAA,GAAA,WACA,EAAA,MAAA,GAAA,UACA,EAAA,KAAA,GAAA,SACA,EAAA,IAAA,GAAA,QAEA,EAAA,SAAA,GAAA,aACA,EAAA,WAAA,GAAA,eACA,EAAA,WAAA,GAAA,eACA,EAAA,YAAA,GAAA,gBACA,EAAA,YAAA,GAAA,gBACA,EAAA,aAAA,GAAA,iBACA,EAAA,YAAA,GAAA,gBAEA,EAAA,EAAA,GAAA,MACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,KAAA,GAAA,SACA,EAAA,KAAA,GAAA,SACA,EAAA,MAAA,GAAA,UACA,EAAA,KAAA,GAAA,SAEA,EAAA,KAAA,GAAA,SACA,EAAA,OAAA,GAAA,WACA,EAAA,IAAA,GAAA,QAEA,EAAA,gBAAA,GAAA,oBACA,EAAA,cAAA,GAAA,kBACA,EAAA,gBAAA,GAAA,oBACA,EAAA,gBAAA,GAAA,oBACA,EAAA,eAAA,GAAA,mBAEA,EAAA,WAAA,GAAA,eACA,EAAA,cAAA,GAAA,kBAEA,EAAA,GAAA,GAAA,OACA,EAAA,MAAA,GAAA;QACD,EAzEWA,MAAAA,CAAAA,KAAU,CAAA,CAAA;QA2Jf,MAAM0H;YAAb,aAAA;gBASS,IAAA,CAAAniC,KAAAA,GAAkB,MAcjB,IAAA,CAAAoiC,QAAAA,GAAAA,CAAoB;YAO9B;YAfE,IAAA,UAAWC;gBACT,OAAOthD,IAAAA,CAAKqhD,QACd;YAAA;YAEA,IAAA,QAAmBj+C,CAAAA,EAAAA;gBACjBpD,IAAAA,CAAKqhD,QAAAA,GAAWj+C;YAClB;YAMO,kBAAAm+C;gBACLvhD,IAAAA,CAAKshD,OAAAA,GAAAA,CAAU;YACjB;QAAA;QAMK,MAAME,WAAkBJ;YAC7B,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMgiD,WAAqBL;YAChC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMiiD,WAAsBN;YACjC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMkiD,WAAuBP;YAClC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMmiD,WAAsBR;YACjC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAQK,MAAMoiD,WAAqBT;YAChC,YACShqB,CAAAA,EACA0f,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA0f,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAQK,MAAMqiD,WAAsBV;YACjC,YACShqB,CAAAA,EACA0f,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA0f,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QASK,MAAMsiD,WAA8BX;YACzC,YACShqB,CAAAA,EACA0f,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA0f,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAQK,MAAMuiD,WAA+BZ;YAC1C,YACShqB,CAAAA,EACA0f,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA0f,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMwiD,WAA0Bb;YACrC,YACShqB,CAAAA,EACA33B,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA33B,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMyiD,WAA2Bd;YACtC,YACShqB,CAAAA,EACA33B,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAwK,GAAAA,GAAAA,GACA,IAAA,CAAA33B,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM0iD,WAAuDf;YAClE,YACSnnC,CAAAA,EACA68B,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAA68B,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM2iD,WAAyDhB;YACpE,YACSnnC,CAAAA,EACA68B,CAAAA,EACAr3C,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAJO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAA68B,OAAAA,GAAAA,GACA,IAAA,CAAAr3C,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM4iD,WAAsBjB;YACjC,YACSnnC,CAAAA,EACAqoC,CAAAA,CAAAA;gBAEP11B,KAAAA,IAHO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAAqoC,SAAAA,GAAAA,GAGPtiD,IAAAA,CAAKqhB,MAAAA,GAASpH;YAChB;QAAA;QAMK,MAAMsoC,WAAuBnB;YAClC,YACSnnC,CAAAA,EACAuoC,CAAAA,CAAAA;gBAEP51B,KAAAA,IAHO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAAuoC,KAAAA,GAAAA,GAGPxiD,IAAAA,CAAKqhB,MAAAA,GAASpH;YAChB;QAAA;QAMK,MAAMwoC,WAA4BrB;YACvC,YACS51C,CAAAA,EACAk3C,CAAAA,CAAAA;gBAEP91B,KAAAA,IAHO,IAAA,CAAAphB,KAAAA,GAAAA,GACA,IAAA,CAAAk3C,OAAAA,GAAAA,GAGP1iD,IAAAA,CAAKqhB,MAAAA,GAASqhC;YAChB;QAAA;QAMK,MAAMC,WAA+BvB;YAC1C,YACS51C,CAAAA,EACAk3C,CAAAA,CAAAA;gBAEP91B,KAAAA,IAHO,IAAA,CAAAphB,KAAAA,GAAAA,GACA,IAAA,CAAAk3C,OAAAA,GAAAA,GAGP1iD,IAAAA,CAAKqhB,MAAAA,GAASqhC;YAChB;QAAA;QAMK,MAAME,WAA2BxB;YAOtC,YAISyB,CAAAA,EAIAr3C,CAAAA,EAIApI,CAAAA,EAIA3D,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAdO,IAAA,CAAAi2B,MAAAA,GAAAA,GAIA,IAAA,CAAAr3C,KAAAA,GAAAA,GAIA,IAAA,CAAApI,KAAAA,GAAAA,GAIA,IAAA,CAAA3D,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMqjD,WAAyB1B;YAMpC,YAIS2B,CAAAA,EAIA3/C,CAAAA,EAIA3D,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAVO,IAAA,CAAAm2B,IAAAA,GAAAA,GAIA,IAAA,CAAA3/C,KAAAA,GAAAA,GAIA,IAAA,CAAA3D,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMujD,WAAqB5B;YAChC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMwjD,WAAoB7B;YAC/B,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMyjD,WAAyD9B;YAOpE,YACS3hD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAa,CAAAA,EACAsnC,CAAAA,CAAAA;gBAEPv2B,KAAAA,IANO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAa,YAAAA,GAAAA,GACA,IAAA,CAAAsnC,OAAAA,GAAAA,GAGPnjD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM2jD,WAA0DhC;YAOrE,YACS3hD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAa,CAAAA,EACAsnC,CAAAA,CAAAA;gBAEPv2B,KAAAA,IANO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAa,YAAAA,GAAAA,GACA,IAAA,CAAAsnC,OAAAA,GAAAA,GAGPnjD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAGK,MAAM4jD;YACX,YACS5jD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAmoC,CAAAA,CAAAA;gBAHA,IAAA,CAAA1jD,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAmoC,OAAAA,GAAAA;YACN;QAAA;QAGE,MAAMG;YACX,YACS7jD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAuoC,CAAAA,CAAAA;gBAHA,IAAA,CAAA9jD,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAuoC,WAAAA,GAAAA;YACN;QAAA;QAGE,MAAMC;YACX,YACS/jD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAa,CAAAA,EACAsnC,CAAAA,CAAAA;gBAJA,IAAA,CAAA1jD,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAa,YAAAA,GAAAA,GACA,IAAA,CAAAsnC,OAAAA,GAAAA;YACN;QAAA;QAGE,MAAMM;YACX,YACShkD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAa,CAAAA,EACAsnC,CAAAA,CAAAA;gBAJA,IAAA,CAAA1jD,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAa,YAAAA,GAAAA,GACA,IAAA,CAAAsnC,OAAAA,GAAAA;YACN;QAAA;QAME,MAAMO,WAA2DtC;YAQtE,YACS3hD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAmoC,CAAAA,CAAAA;gBAEPv2B,KAAAA,IALO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAmoC,OAAAA,GAAAA,GAGPnjD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMkkD,WAAyDvC;YAIpE,YACS3hD,CAAAA,EACAwf,CAAAA,EACAjE,CAAAA,EACAuoC,CAAAA,CAAAA;gBAEP32B,KAAAA,IALO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAwf,KAAAA,GAAAA,GACA,IAAA,CAAAjE,IAAAA,GAAAA,GACA,IAAA,CAAAuoC,WAAAA,GAAAA,GAGPvjD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMmkD,WAAyDxC;YAIpE,YACSnnC,CAAAA,EACAxa,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAAxa,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMokD,WAAyCzC;YAIpD,YACS/c,CAAAA,EACA5kC,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAyX,OAAAA,GAAAA,GACA,IAAA,CAAA5kC,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMqkD,WAAwB1C;YAInC,YACS/c,CAAAA,EACA5kC,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAyX,OAAAA,GAAAA,GACA,IAAA,CAAA5kC,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMskD,WAA0B3C;YACrC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAMukD,WAA2B5C;YACtC,YAAmB3hD,CAAAA,CAAAA;gBACjBmtB,KAAAA,IADiB,IAAA,CAAAntB,IAAAA,GAAAA,GAEjBO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAGK,MAAMwkD,WAA0B7C;YACrC,YACS3hD,CAAAA,EACAykD,CAAAA,CAAAA;gBAEPt3B,KAAAA,IAHO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAykD,MAAAA,GAAAA,GAGPlkD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAGK,MAAM0kD,WAAyB/C;YACpC,YACS3hD,CAAAA,EACAykD,CAAAA,CAAAA;gBAEPt3B,KAAAA,IAHO,IAAA,CAAAntB,IAAAA,GAAAA,GACA,IAAA,CAAAykD,MAAAA,GAAAA,GAGPlkD,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM2kD,WAAyBhD;YACpC,YACSiD,CAAAA,EACA5kD,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAy3B,MAAAA,GAAAA,GACA,IAAA,CAAA5kD,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM6kD,WAA4BlD;YACvC,YACSiD,CAAAA,EACA5kD,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAAy3B,MAAAA,GAAAA,GACA,IAAA,CAAA5kD,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM8kD,WAAkCnD;YAC7C,YACSnnC,CAAAA,EACAxa,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAAxa,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QAMK,MAAM+kD,WAAwCpD;YACnD,YACSnnC,CAAAA,EACAxa,CAAAA,CAAAA;gBAEPmtB,KAAAA,IAHO,IAAA,CAAA3S,MAAAA,GAAAA,GACA,IAAA,CAAAxa,IAAAA,GAAAA,GAGPO,IAAAA,CAAKqhB,MAAAA,GAAS5hB;YAChB;QAAA;QOpuBK,MAAMglD;YAEX,YAAmBhjD,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,IAAAA,GAAAA,GADV,IAAA,CAAAgF,IAAAA,GAA0B;YACQ;QAAA;QAMtC,SAASi+C,GAAiBp4C,CAAAA;YAC/B,OAAA,CAAA,CAASA,KAAgB,sBAAXA,EAAE7F,IAClB;QAAA;QAKO,MAAMk+C;YAEX,YAAmBljD,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,IAAAA,GAAAA,GADV,IAAA,CAAAgF,IAAAA,GAA4B;YACM;QAAA;QAMtC,SAASm+C,GAAmBt4C,CAAAA;YACjC,OAAA,CAAA,CAASA,KAAgB,wBAAXA,EAAE7F,IAClB;QAAA;QAgBO,MAAMo+C,KAAe;YAC1BC,KAAK;YACLC,QAAQ;YACRC,YAAY;YACZC,WAAW;YACXC,YAAY;YACZC,MAAM;QAAA;QAoBD,MAAMC;YA+BX,YAAYC,CAAAA,EAA4E52B,CAAAA,CAAAA;gBACtF,IAAI62B,GACAC;gBA5BC,IAAA,CAAA3lD,EAAAA,GAAawlD,GAAOv5B,GAAAA,IAEpB,IAAA,CAAA4C,IAAAA,GAAO,CAAA,OAAA,EAAUzuB,IAAAA,CAAKJ,EAAAA,EAAAA,EAKtB,IAAA,CAAAsa,MAAAA,GAAS,IAAIhT,GACZ,IAAA,CAAAs+C,KAAAA,GAAQ,IAAIvuC,KACb,IAAA,CAAAwuC,eAAAA,GAAkB,IAAI3T,IACtB,IAAA,CAAA4T,iBAAAA,GAAoB,IAAI5T,IACxB,IAAA,CAAA6T,SAAAA,GAAY,IAAI7T,IAChB,IAAA,CAAA8T,WAAAA,GAAc,IAAI9T,IAQT,IAAA,CAAA+T,UAAAA,GAAa,IAAIv3B,KAC1B,IAAA,CAAAw3B,eAAAA,GAA+B,EAAA,EAC9B,IAAA,CAAAC,mBAAAA,GAAuC,EAAA,EAwCxC,IAAA,CAAAC,KAAAA,GAAsB,MAqBtB,IAAA,CAAAC,QAAAA,GAAAA,CAAoB,GAmGnB,IAAA,CAAAnW,OAAAA,GAAyB,MAK1B,IAAA,CAAAuD,cAAAA,GAAiB,IAAIvB,IACrB,IAAA,CAAAwB,gBAAAA,GAAmB,IAAIxB,IAEtB,IAAA,CAAA/B,SAAAA,GAAsB,EAAA,EA6OtB,IAAA,CAAAmW,cAAAA,GAAAA,CAAiB,GACjB,IAAA,CAAAC,QAAAA,GAAAA,CAAW;gBA/YjB,IAAIC,IAAAA,CAAU;gBACd,IAAIr8C,MAAMoX,OAAAA,CAAQkkC,IAChBC,IAAkBD,GAClBE,IAAY92B;qBACP,IAAI42B,KAAsD,YAAA,OAAxBA,GAAkC;oBACzE,MAAA,EAAM,YAAEQ,CAAAA,EAAU,MAAEp3B,CAAAA,EAAI,iBAAE43B,CAAAA,EAAAA,GAAoBhB;oBAC9CC,IAAkBO,QAAAA,IAAAA,IAAc,EAAA,EAChCN,IAAY92B,GACZ23B,IAAAA,CAAAA,CAAYC;gBACd;gBAIA,IAHId,KACFvlD,CAAAA,IAAAA,CAAKyuB,IAAAA,GAAO82B,CAAAA,GAEVD,GACF,KAAK,MAAM3R,KAAa2R,EACtBtlD,IAAAA,CAAKsmD,YAAAA,CAAa3S;YAaxB;YAWA,IAAA,SAAW4S;gBACT,OAAOvmD,IAAAA,CAAKimD,QACd;YAAA;YAMA,IAAA,OAAkBx5C,CAAAA,EAAAA;gBAChBzM,IAAAA,CAAKimD,QAAAA,GAAWx5C;YAClB;YAWO,OAAA+5C;gBACDxmD,IAAAA,CAAKimD,QAAAA,IACPjmD,CAAAA,IAAAA,CAAKimD,QAAAA,GAAAA,CAAW,GAChBjmD,IAAAA,CAAKymD,QAAAA,EAAAA,GAEPzmD,IAAAA,CAAKmI,IAAAA,CAAK,QAAQ,IAAIq5C,GAAUxhD,IAAAA;YAClC;YAEO,WAAA0mD;gBACL,OAAA,CAAQ1mD,IAAAA,CAAKimD,QACf;YAAA;YAKA,IAAA,OAAWU;gBACT,OAAO3mD,IAAAA,CAAKwlD,KACd;YAAA;YAMO,OAAOqB,CAAAA,EAAAA;gBACZ,OAAO7mD,IAAAA,CAAKwlD,KAAAA,CAAMztC,GAAAA,CAAI8uC;YACxB;YAMO,OAAOA,CAAAA,EAAAA;gBAGZ,OAFA7mD,IAAAA,CAAKwlD,KAAAA,CAAMp1C,GAAAA,CAAIy2C,IACf7mD,IAAAA,CAAK2lD,SAAAA,CAAUpT,SAAAA,CAAUsU,IAClB7mD,IACT;YAAA;YAQO,UAAU6mD,CAAAA,EAAAA;gBAGf,OAFA7mD,IAAAA,CAAKwlD,KAAAA,CAAM32B,MAAAA,CAAOg4B,IAClB7mD,IAAAA,CAAK4lD,WAAAA,CAAYrT,SAAAA,CAAUsU,IACpB7mD,IACT;YAAA;YAKA,IAAA,QAAWgnD;gBACT,OAAOj9C,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK6lD,UAAAA,CAAWt/C,IAAAA;YACpC;YAKO,gBAAA0gD;gBACL,OAAOl9C,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK6lD,UAAAA,CAAWqB,MAAAA;YACpC;YAMA,OAAqCE,CAAAA,EAAAA;gBACnC,IAAK,IAAI5mD,IAAI,GAAGA,IAAI4mD,EAAc9mD,MAAAA,EAAQE,IACxC,IAAA,CAAKR,IAAAA,CAAK6lD,UAAAA,CAAW9tC,GAAAA,CAAIqvC,CAAAA,CAAc5mD,EAAAA,GACrC,OAAA,CAAO;gBAGX,OAAA,CAAO;YACT;YAMA,WAAW8mD,CAAAA,EAAAA;gBACT,IAAK,IAAI9mD,IAAI,GAAGA,IAAI8mD,EAAahnD,MAAAA,EAAQE,IACvC,IAAA,CAAKR,IAAAA,CAAK2mD,IAAAA,CAAK5uC,GAAAA,CAAIuvC,CAAAA,CAAa9mD,EAAAA,GAC9B,OAAA,CAAO;gBAGX,OAAA,CAAO;YACT;YAEA,IAAkCiG,CAAAA,EAAAA;gBAChC,OAAOzG,IAAAA,CAAK6lD,UAAAA,CAAWljD,GAAAA,CAAI8D;YAC7B;YAGA,IAAA,SAAWypC;gBACT,OAAOlwC,IAAAA,CAAK8vC,OACd;YAAA;YASA,IAAA,WAAWe;gBACT,OAAO7wC,IAAAA,CAAK+vC,SACd;YAAA;YAKO,WAAA0W;gBACDzmD,IAAAA,CAAK8vC,OAAAA,IACP9vC,CAAAA,IAAAA,CAAK8vC,OAAAA,CAAQyX,WAAAA,CAAYvnD,IAAAA,GACzBA,IAAAA,CAAK8vC,OAAAA,GAAU,IAAA;YAEnB;YAMO,SAASoU,CAAAA,EAAAA;gBACd,IAAsB,SAAlBA,EAAOhU,MAAAA,EAQT,MAAM,IAAI/pC,MAAM;gBAPhB,IAAInG,IAAAA,CAAKynD,YAAAA,GAAexmC,QAAAA,CAASijC,IAC/B,MAAM,IAAI/9C,MAAM;gBAQpB,OANEnG,IAAAA,CAAK+vC,SAAAA,CAAUpwC,IAAAA,CAAKukD,IACpBA,EAAOpU,OAAAA,GAAU9vC,IAAAA,EACjBA,IAAAA,CAAKqzC,cAAAA,CAAed,SAAAA,CAAU2R,IAIzBlkD,IACT;YAAA;YAMO,YAAYkkD,CAAAA,EAAAA;gBAMjB,OALIA,EAAOhU,MAAAA,KAAWlwC,IAAAA,IACpBsgB,CAAAA,EAAoB4jC,GAAQlkD,IAAAA,CAAK+vC,SAAAA,GACjCmU,EAAOpU,OAAAA,GAAU,MACjB9vC,IAAAA,CAAKszC,gBAAAA,CAAiBf,SAAAA,CAAU2R,EAAAA,GAE3BlkD,IACT;YAAA;YAKO,oBAAA0nD;gBAEL,IAAK,IAAIlnD,IAAIR,IAAAA,CAAK6wC,QAAAA,CAASvwC,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAC7CR,IAAAA,CAAKunD,WAAAA,CAAYvnD,IAAAA,CAAK6wC,QAAAA,CAASrwC,EAAAA;gBAEjC,OAAOR,IACT;YAAA;YAKO,eAAAynD;gBACL,MAAMr8C,IAAmB;oBAACpL,IAAAA;iBAAAA;gBAC1B,IAAI0oB,IAAU1oB,IAAAA,CAAKkwC,MAAAA;gBACnB,MAAOxnB,GACLtd,EAAOzL,IAAAA,CAAK+oB,IACZA,IAAUA,EAAQwnB,MAAAA;gBAEpB,OAAO9kC,EAAO2pC,OAAAA;YAChB;YAKO,iBAAA4S;gBACL,IAAIv8C,IAAmB;oBAACpL,IAAAA;iBAAAA,EACpB4nD,IAAkB;oBAAC5nD,IAAAA;iBAAAA;gBACvB,MAAO4nD,EAAMtnD,MAAAA,GAAS,GAAG;oBACvB,MAAMunD,IAAOD,EAAMz/B,GAAAA;oBACf0/B,KACFD,CAAAA,IAAQA,EAAMvnD,MAAAA,CAAOwnD,EAAKhX,QAAAA,GAC1BzlC,IAASA,EAAO/K,MAAAA,CAAOwnD,EAAKhX,QAAAA,CAAAA;gBAEhC;gBACA,OAAOzlC;YACT;YAKO,QAAA6G;gBACL,MAAM61C,IAAY,IAAI1C;gBACtB,KAAK,MAAM3wC,KAAKzU,IAAAA,CAAKgnD,KAAAA,CAAO;oBAC1B,MAAMe,IAAoB/nD,IAAAA,CAAK2C,GAAAA,CAAI8R;oBAC/BszC,KACFD,EAAUxB,YAAAA,CAAayB,EAAkB91C,KAAAA;gBAE7C;gBACA,KAAK,MAAM8gC,KAAS/yC,IAAAA,CAAK6wC,QAAAA,CACvBiX,EAAUN,QAAAA,CAASzU,EAAM9gC,KAAAA;gBAE3B,OAAO61C;YACT;YAOO,YAAYG,CAAAA,EAAwBxf,IAAAA,CAAiB,CAAA,EAAA;gBAC1D,KAAK,MAAMh0B,KAAKwzC,EAAehB,aAAAA,GAC7BjnD,IAAAA,CAAKsmD,YAAAA,CAAa7xC,EAAExC,KAAAA,IAASw2B;gBAE/B,KAAK,MAAMsK,KAASkV,EAAepX,QAAAA,CACjC7wC,IAAAA,CAAKwnD,QAAAA,CAASzU,EAAM9gC,KAAAA,GAAQ+1C,WAAAA,CAAYjV;gBAE1C,OAAO/yC,IACT;YAAA;YAEQ,uBAAuBmoD,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAC7B,IAAIz/B,IAAUy/B,GACVjY,IAAiD,SAAxC,CAAA,IAAA1tC,OAAO4lD,cAAAA,CAAe1/B,EAAQ5lB,SAAAA,CAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE6D,WAAAA;gBAEvD,MAAOupC,KAAUA,MAAW1tC,UAAU0tC,MAAWyB,IAC/CjpB,IAAUwnB,GACVA,IAAiD,SAAxC,CAAA,IAAA1tC,OAAO4lD,cAAAA,CAAe1/B,EAAQ5lB,SAAAA,CAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAE6D,WAAAA;gBAErD,OAAO+hB;YACT;YAOO,aAA2CirB,CAAAA,EAAuBlL,IAAAA,CAAiB,CAAA,EAAA;gBAExF,IAAIzoC,IAAAA,CAAK+X,GAAAA,CAAI47B,EAAUhtC,WAAAA,GAA+B;oBACpD,IAAA,CAAI8hC,GAKF,OAAOzoC,IAAAA;oBAHPA,IAAAA,CAAKqoD,eAAAA,CAAgB1U,EAAUhtC,WAAAA,EAAAA,CAA8B;gBAKjE;gBAGA,IAAIgtC,EAAU2U,YAAAA,IAAgB3U,EAAU2U,YAAAA,CAAahoD,MAAAA,EACnD,KAAK,MAAMioD,KAAQ5U,EAAU2U,YAAAA,CAC3BtoD,IAAAA,CAAKsmD,YAAAA,CAAa,IAAIiC;gBAI1B5U,EAAU/B,KAAAA,GAAQ5xC,IAAAA;gBAClB,MAAMwoD,IAAgBxoD,IAAAA,CAAKkoD,sBAAAA,CAAuBvU,EAAUhtC,WAAAA;gBAS5D,OARA3G,IAAAA,CAAK6lD,UAAAA,CAAW76B,GAAAA,CAAIw9B,GAAe7U,IACnC3zC,IAAAA,CAAK6lD,UAAAA,CAAW76B,GAAAA,CAAI2oB,EAAUhtC,WAAAA,EAAagtC,IAC3C3zC,IAAAA,CAAK8lD,eAAAA,CAAgBnmD,IAAAA,CAAKg0C,IACtBA,EAAUP,KAAAA,IACZO,EAAUP,KAAAA,CAAMpzC,IAAAA,GAGlBA,IAAAA,CAAKylD,eAAAA,CAAgBlT,SAAAA,CAAUoB,IACxB3zC,IACT;YAAA;YASO,gBACLyoD,CAAAA,EACAhgB,IAAAA,CAAQ,CAAA,EAAA;gBAER,IAAIhiC;gBAOJ,IALEA,IADEirC,GAAgB+W,KACXA,IAEAA,EAAe9hD,WAAAA,EAGpB8hC,GAAO;oBACT,MAAMigB,IAAoB1oD,IAAAA,CAAK6lD,UAAAA,CAAWljD,GAAAA,CAAI8D;oBAC9C,IAAIiiD,GAAmB;wBACrB1oD,IAAAA,CAAK0lD,iBAAAA,CAAkBnT,SAAAA,CAAUmW,IACjCA,EAAkB9W,KAAAA,GAAAA,KAAQ9wC,GACtB4nD,EAAkBnV,QAAAA,IACpBmV,EAAkBnV,QAAAA,CAASvzC,IAAAA;wBAE7B,MAAM2oD,IAAiB3oD,IAAAA,CAAK8lD,eAAAA,CAAgBr9C,OAAAA,CAAQigD;wBAChDC,IAAAA,MACF3oD,IAAAA,CAAK8lD,eAAAA,CAAgBp9C,MAAAA,CAAOigD,GAAgB;oBAEhD;oBAEA,MAAMH,IAAgBxoD,IAAAA,CAAKkoD,sBAAAA,CAAuBzhD;oBAClDzG,IAAAA,CAAK6lD,UAAAA,CAAWh3B,MAAAA,CAAO25B,IACvBxoD,IAAAA,CAAK6lD,UAAAA,CAAWh3B,MAAAA,CAAOpoB;gBACzB,OACEzG,IAAAA,CAAK+lD,mBAAAA,CAAoBpmD,IAAAA,CAAK8G;gBAGhC,OAAOzG,IACT;YAAA;YAEO,kBAAA4oD;gBACL,MAAM/C,IAAa7lD,IAAAA,CAAKgnD,KAAAA;gBACxB,KAAK,MAAMvyC,KAAKoxC,EACd7lD,IAAAA,CAAKqoD,eAAAA,CAAgB5zC;YAEzB;YAMO,0BAAAo0C;gBACL,KAAK,MAAMpiD,KAAQzG,IAAAA,CAAK+lD,mBAAAA,CACtB/lD,IAAAA,CAAKqoD,eAAAA,CAAgB5hD,GAAAA,CAAM;gBAE7BzG,IAAAA,CAAK+lD,mBAAAA,CAAoBzlD,MAAAA,GAAS;YACpC;YAMO,IAAkCmG,CAAAA,EAAAA;gBACvC,OAAOzG,IAAAA,CAAK6lD,UAAAA,CAAW9tC,GAAAA,CAAItR;YAC7B;YAQA,IAAA,gBAAWqiD;gBACT,OAAO9oD,IAAAA,CAAKkmD,cACd;YAAA;YAEA,IAAA,UAAW6C;gBACT,OAAO/oD,IAAAA,CAAKmmD,QACd;YAAA;YAQO,YAAYlsC,CAAAA,EAAAA;gBACZja,IAAAA,CAAK8oD,aAAAA,IACR9oD,CAAAA,IAAAA,CAAKgpD,YAAAA,CAAa/uC,IAClBja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIy7C,GAAgB3pC,GAAQja,IAAAA,IAC3DA,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB,CAAA;YAE1B;YAQO,KAAKjsC,CAAAA,EAAAA;gBAAAA,CACLja,IAAAA,CAAK+oD,OAAAA,IAAW/oD,IAAAA,CAAKimD,QAAAA,IACxBjmD,CAAAA,IAAAA,CAAKozC,KAAAA,CAAMn5B,IACXja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,OAAO,IAAIo8C,GAAStqC,GAAQja,IAAAA,IAC7CA,IAAAA,CAAKmmD,QAAAA,GAAAA,CAAW,CAAA;YAEpB;YAQO,QAAQlsC,CAAAA,EAAAA;gBACTja,IAAAA,CAAK+oD,OAAAA,IAAAA,CAAY/oD,IAAAA,CAAKimD,QAAAA,IACxBjmD,CAAAA,IAAAA,CAAKuzC,QAAAA,CAASt5B,IACdja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU,IAAIq8C,GAAYvqC,GAAQja,IAAAA,IACnDA,IAAAA,CAAKmmD,QAAAA,GAAAA,CAAW,CAAA;YAEpB;YAQO,WAAWlsC,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAChC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,aAAa,IAAIg6C,GAAeloC,GAAQ68B,GAAS92C,IAAAA,IAClEA,IAAAA,CAAKopD,WAAAA,CAAYnvC,GAAQ68B;YAC3B;YAQO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACjC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBnoC,GAAQ68B,GAAS92C,IAAAA,IACpEA,IAAAA,CAAKspD,YAAAA,CAAarvC,GAAQ68B;YAC5B;YAQO,aAAa78B,CAAAA,EAAAA,CAEpB;YAQO,MAAMA,CAAAA,EAAAA,CAEb;YAQO,SAASA,CAAAA,EAAAA,CAEhB;YAOO,YAAYA,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEnC;YAOO,aAAa78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEpC;YASO,OAAO78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAC5B92C,IAAAA,CAAKmtC,WAAAA,CAAYlzB,IACjBja,IAAAA,CAAKipD,IAAAA,CAAKhvC,IACVja,IAAAA,CAAKmpD,UAAAA,CAAWlvC,GAAQ68B;gBACxB,KAAK,MAAM/D,KAAS/yC,IAAAA,CAAK6wC,QAAAA,CACvBkC,EAAMtF,MAAAA,CAAOxzB,GAAQ68B;gBAEvB92C,IAAAA,CAAKqpD,WAAAA,CAAYpvC,GAAQ68B,IACzB92C,IAAAA,CAAKkpD,OAAAA,CAAQjvC;YACf;YAIO,KAAyDvS,CAAAA,EAAuBU,CAAAA,EAAAA;gBACrFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAuDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAChFA,IACF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC,KAE3B3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH;YAEpB;QAAA;QA1lBe,GAAAmkB,GAAAA,GAAM;QCzDhB,MAAM09B,WAAwB5X;YAArC,aAAA;gBAAA,KAAA,IAAA,YAIS,IAAA,CAAA6X,GAAAA,GAAc17C,EAAOC,IAAAA,EAKrB,IAAA,CAAA07C,GAAAA,GAAc37C,EAAOC,IAAAA,EAKrB,IAAA,CAAA27C,WAAAA,GAAsB57C,EAAOC,IAAAA,EAK7B,IAAA,CAAA47C,eAAAA,GAAkB,GAKlB,IAAA,CAAAC,MAAAA,GAAiB,GAKjB,IAAA,CAAAC,OAAAA,GAAkB;YAC3B;QAAA;QC7DO,MAAMC;YAUX,OAAA,UAAiB/sC,CAAAA,EAA+BitC,CAAAA,EAAyBC,CAAAA,EAAkBnT,CAAAA,EAAAA;gBACzF,MAAMoT,IAAUpT,IAAU;gBAG1BkT,EAAOR,GAAAA,CAAIh5C,QAAAA,CAASy5C,EAASh6C,KAAAA,CAAMi6C,GAASJ,GAAgBK,IAAAA,IAC5DptC,EAAUlC,GAAAA,CACPzK,GAAAA,CAAI45C,EAAOR,GAAAA,CAAIv5C,KAAAA,CAAMi6C,GAASJ,GAAgBM,IAAAA,GAAON,GAAgBO,IAAAA,EACrE75C,QAAAA,CAASy5C,EAASh6C,KAAAA,CAAM,KAAMi6C,IAAUA,GAASJ,GAAgBQ,QAAAA,IAEpEN,EAAOL,eAAAA,IAAmBK,EAAOJ,MAAAA,GAAU,CAAA,IAAMI,EAAOH,OAAAA,AAAAA,IAAWK;gBACnE,MAAMvnC,IAAW5F,EAAU4F,QAAAA,GAAWqnC,EAAOL,eAAAA,GAAkBO;gBAE/DntC,EAAU9M,KAAAA,CAAMG,GAAAA,CAAI45C,EAAON,WAAAA,CAAYz5C,KAAAA,CAAMi6C,GAASlqD,IAAAA,CAAKuqD,aAAAA,GAAgBT,GAAgBU,MAAAA;gBAChFztC,EAAUpa,GAAAA,GAClB4uC,YAAAA,CAAauY,GAAgBO,IAAAA,EAAM1nC,GAAUmnC,GAAgBU,MAAAA;YAClE;QAAA;QAvBe,GAAAH,IAAAA,GAAO,IAAIv8C,EAAO,GAAG,IACrB,GAAA08C,MAAAA,GAAS,IAAI18C,EAAO,GAAG,IAEvB,GAAAq8C,IAAAA,GAAO,IAAIr8C,EAAO,GAAG,IACrB,GAAAs8C,IAAAA,GAAO,IAAIt8C,EAAO,GAAG,IACrB,GAAAw8C,QAAAA,GAAW,IAAIx8C,EAAO,GAAG,IACzB,GAAAy8C,aAAAA,GAAgB,IAAIz8C,EAAO,GAAG;QCOxC,MAAM28C,WAAiBrF;YA6C5B,YAAYnsC,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM;oBAAEy5B,iBAAAA,CAAiB;gBAAA,IAhCpB,IAAA,CAAAqE,UAAAA,GAAoBt4C,EAAM0C,KAAAA,EAC1B,IAAA,CAAA61C,QAAAA,GAAkBv4C,EAAM0C,KAAAA,EAGxB,IAAA,CAAA81C,IAAAA,GAAe,KACf,IAAA,CAAAC,IAAAA,GAAAA,CAAgB,GAGf,IAAA,CAAAC,MAAAA,GAAiB,GACjB,IAAA,CAAAC,MAAAA,GAAiB,GACjB,IAAA,CAAAC,MAAAA,GAAiB,GACjB,IAAA,CAAAC,MAAAA,GAAiB,GACjB,IAAA,CAAAC,aAAAA,GAAuB94C,EAAM0C,KAAAA,EAE9B,IAAA,CAAAhF,IAAAA,GAAe,GAKf,IAAA,CAAAq7C,QAAAA,GAAmB,GAEnB,IAAA,CAAA3L,OAAAA,GAAAA,CAAU,GACV,IAAA,CAAA4L,WAAAA,GAAAA,CAAc,GAKd,IAAA,CAAAC,iBAAAA,GAAoBC,GAAkBC,MAAAA,EAEtC,IAAA,CAAA98B,IAAAA,GAAO,CAAA,SAAA,EAAYzuB,IAAAA,CAAKJ,EAAAA,EAAAA,EAI7BI,IAAAA,CAAKsmD,YAAAA,CAActmD,IAAAA,CAAK+c,SAAAA,GAAY,IAAI41B,KACxC3yC,IAAAA,CAAKsmD,YAAAA,CAActmD,IAAAA,CAAKgqD,MAAAA,GAAS,IAAIT,KACrCvpD,IAAAA,CAAKsmD,YAAAA,CAActmD,IAAAA,CAAK8/C,QAAAA,GAAW,IAAIP,KACvCv/C,IAAAA,CAAKwrD,SAAAA,CAAUvyC;YACjB;YAGA,gBAAgBzQ,CAAAA,EAAAA;gBAEd,IADAxI,IAAAA,CAAK0rD,QAAAA,GAAWljD,GACZxI,IAAAA,CAAKqrD,iBAAAA,KAAsBC,GAAkBC,MAAAA,EAAQ;oBACvD,MAAMza,IAAY9wC,IAAAA,CAAK0rD,QAAAA,CAAS3uC,SAAAA,CAAU+zB,SAAAA;oBAC1C9wC,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAM7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,CAAIzK,GAAAA,CAAI0gC,IAC5C9wC,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,GAAMxpD,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,CAAI33C,MAAAA,CAAO7R,IAAAA,CAAK0rD,QAAAA,CAAS3uC,SAAAA,CAAUk0B,cAAAA;gBACnE;YACF;YAEA,UAAUh4B,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACRjZ,IAAAA,CAAKqrD,iBAAAA,GAAqC,SAAjB,CAAA,IAAApyC,EAAQ8D,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI/c,IAAAA,CAAKqrD,iBAAAA,EACnDrrD,IAAAA,CAAK4qD,IAAAA,GAAmB,SAAZ,CAAA,IAAA3xC,EAAQ2xC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI5qD,IAAAA,CAAK4qD,IAAAA,EACjC5qD,IAAAA,CAAK6qD,IAAAA,GAAmB,SAAZ,CAAA,IAAA5xC,EAAQ4xC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI7qD,IAAAA,CAAK6qD,IAAAA,EACjC7qD,IAAAA,CAAK8P,IAAAA,GAAmB,SAAZ,CAAA,IAAAmJ,EAAQnJ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI9P,IAAAA,CAAK8P,IAAAA,EACjC9P,IAAAA,CAAK2qD,QAAAA,GAA2B,SAAhB,CAAA,IAAA1xC,EAAQ0xC,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI3qD,IAAAA,CAAK2qD,QAAAA,CAAS14C,KAAAA,IAClDjS,IAAAA,CAAK0qD,UAAAA,GAA+B,SAAlB,CAAA,IAAAzxC,EAAQyxC,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI1qD,IAAAA,CAAK0qD,UAAAA,CAAWz4C,KAAAA,IACxDjS,IAAAA,CAAKkrD,aAAAA,GAAgBlrD,IAAAA,CAAK0qD,UAAAA,CAAWz4C,KAAAA,IAErCjS,IAAAA,CAAKo1C,OAAAA,GAAUn8B,EAAQm8B,OAAAA,EACvBp1C,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAyB,SAAf,CAAA,IAAA3P,EAAQ2P,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI5oB,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,EACzD5oB,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAiB,SAAX,CAAA,IAAA5B,EAAQ4B,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,EACnD7a,IAAAA,CAAK+c,SAAAA,CAAU4F,QAAAA,GAA2B,SAAhB,CAAA,IAAA1J,EAAQ0J,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI,GAC9C3iB,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,GAAQvB,EAAI,GAAG,IAE9B1O,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,GAAiB,SAAX,CAAA,IAAAvwC,EAAQuwC,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAIxpD,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,EAC7CxpD,IAAAA,CAAKgqD,MAAAA,CAAOL,eAAAA,GAAyC,SAAvB,CAAA,IAAA1wC,EAAQ0wC,eAAAA,AAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI,GACzD3pD,IAAAA,CAAKgqD,MAAAA,CAAOP,GAAAA,GAAiB,SAAX,CAAA,IAAAxwC,EAAQwwC,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAIzpD,IAAAA,CAAKgqD,MAAAA,CAAOP,GAAAA,EAE7CzpD,IAAAA,CAAK8qD,MAAAA,GAAAA,AAAU9qD,CAAAA,IAAAA,CAAK2qD,QAAAA,CAAS1nD,CAAAA,GAAIjD,IAAAA,CAAK0qD,UAAAA,CAAWznD,CAAAA,AAAAA,IAAKjD,IAAAA,CAAK4qD,IAAAA,EAC3D5qD,IAAAA,CAAK+qD,MAAAA,GAAAA,AAAU/qD,CAAAA,IAAAA,CAAK2qD,QAAAA,CAASt4C,CAAAA,GAAIrS,IAAAA,CAAK0qD,UAAAA,CAAWr4C,CAAAA,AAAAA,IAAKrS,IAAAA,CAAK4qD,IAAAA,EAC3D5qD,IAAAA,CAAKgrD,MAAAA,GAAAA,AAAUhrD,CAAAA,IAAAA,CAAK2qD,QAAAA,CAASr4C,CAAAA,GAAItS,IAAAA,CAAK0qD,UAAAA,CAAWp4C,CAAAA,AAAAA,IAAKtS,IAAAA,CAAK4qD,IAAAA,EAC3D5qD,IAAAA,CAAKirD,MAAAA,GAASjrD,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK4qD,IAAAA,EAE3C5qD,IAAAA,CAAK2rD,SAAAA,GAA6B,SAAjB,CAAA,IAAA1yC,EAAQ0yC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,GACtC3rD,IAAAA,CAAK4rD,OAAAA,GAAyB,SAAf,CAAA,IAAA3yC,EAAQ2yC,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAE9B5rD,IAAAA,CAAK4rD,OAAAA,GAAU,KAAK5rD,IAAAA,CAAK2rD,SAAAA,GAAY,KACvC3rD,CAAAA,IAAAA,CAAKmrD,QAAAA,GAAAA,AAAYnrD,CAAAA,IAAAA,CAAK4rD,OAAAA,GAAU5rD,IAAAA,CAAK2rD,SAAAA,AAAAA,IAAa3rD,IAAAA,CAAK4qD,IAAAA,EACvD5qD,IAAAA,CAAK8P,IAAAA,GAAO9P,IAAAA,CAAK2rD,SAAAA,AAAAA,GAEf3rD,IAAAA,CAAKo1C,OAAAA,GACPp1C,CAAAA,IAAAA,CAAK8/C,QAAAA,CAASvoB,GAAAA,CAAIv3B,IAAAA,CAAKo1C,OAAAA,GACvBp1C,IAAAA,CAAK8/C,QAAAA,CAASM,UAAAA,GAAAA,KAAat/C,CAAAA,IAE3Bd,CAAAA,IAAAA,CAAK8/C,QAAAA,CAAS5zB,WAAAA,GAAc5Q,EAAYc,aAAAA,CAAcpc,IAAAA,CAAK8P,IAAAA,EAAM9P,IAAAA,CAAK8P,IAAAA,EAAMhC,EAAOG,IAAAA,GACnFjO,IAAAA,CAAK8/C,QAAAA,CAASM,UAAAA,GAAchpB,CAAAA;oBAC1BA,EAAI7O,IAAAA,IACJ6O,EAAIpf,KAAAA,CAAM6zC,SAAAA,CAAUn9C,EAAI,GAAG,IAAI;wBAAEiF,OAAO3T,IAAAA,CAAKkrD,aAAAA;wBAAep7C,MAAM9P,IAAAA,CAAK8P,IAAAA;oBAAAA,IACvEsnB,EAAI5O,OAAAA;gBAAS,CAAA;YAGnB;YAEgB,OAAAg+B;gBAAAA,IAAAA;gBACG,CAAA,SAAb,CAAA,IAAAxmD,IAAAA,CAAK0rD,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEzF,QAAAA,AAAAA,IACjBjmD,IAAAA,CAAK0rD,QAAAA,CAASI,cAAAA,CAAe9rD,IAAAA,IAE7B4sB,KAAAA,CAAM45B;YAEV;YAEO,OAAOvsC,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAC5B92C,IAAAA,CAAK4qD,IAAAA,GAAO5qD,IAAAA,CAAK4qD,IAAAA,GAAO9T,GAEpB92C,IAAAA,CAAK4qD,IAAAA,GAAO,KACd5qD,IAAAA,CAAKwmD,IAAAA,IAGHxmD,IAAAA,CAAK6qD,IAAAA,IACP7qD,CAAAA,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUlc,EAAM1M,IAAAA,CAAKirD,MAAAA,GAASjrD,IAAAA,CAAK4qD,IAAAA,EAAM,MAAQ,EAAA,GAG7D5qD,IAAAA,CAAK2rD,SAAAA,IAAa3rD,IAAAA,CAAK4rD,OAAAA,IAAW5rD,IAAAA,CAAK2rD,SAAAA,GAAY,KAAK3rD,IAAAA,CAAK4rD,OAAAA,GAAU,KACzE5rD,CAAAA,IAAAA,CAAK8P,IAAAA,GAAOpD,EACV1M,IAAAA,CAAKmrD,QAAAA,GAAWrU,IAAU92C,IAAAA,CAAK8P,IAAAA,EAC/BxK,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAK2rD,SAAAA,EAAW3rD,IAAAA,CAAK4rD,OAAAA,GAC9BtmD,KAAKC,GAAAA,CAAIvF,IAAAA,CAAK2rD,SAAAA,EAAW3rD,IAAAA,CAAK4rD,OAAAA,EAAAA,GAIlC5rD,IAAAA,CAAKkrD,aAAAA,CAAcjoD,CAAAA,GAAIyJ,EAAM1M,IAAAA,CAAKkrD,aAAAA,CAAcjoD,CAAAA,GAAIjD,IAAAA,CAAK8qD,MAAAA,GAAShU,GAAS,GAAG,MAC9E92C,IAAAA,CAAKkrD,aAAAA,CAAc74C,CAAAA,GAAI3F,EAAM1M,IAAAA,CAAKkrD,aAAAA,CAAc74C,CAAAA,GAAIrS,IAAAA,CAAK+qD,MAAAA,GAASjU,GAAS,GAAG,MAC9E92C,IAAAA,CAAKkrD,aAAAA,CAAc54C,CAAAA,GAAI5F,EAAM1M,IAAAA,CAAKkrD,aAAAA,CAAc54C,CAAAA,GAAItS,IAAAA,CAAKgrD,MAAAA,GAASlU,GAAS,GAAG,MAC9E92C,IAAAA,CAAKkrD,aAAAA,CAAc9oD,CAAAA,GAAIpC,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA;gBAErC,IAAImjC,IAAQ/rD,IAAAA,CAAKgqD,MAAAA,CAAOP,GAAAA;gBACpBzpD,IAAAA,CAAKgsD,KAAAA,IACPD,CAAAA,IAAQ/rD,IAAAA,CAAKgsD,KAAAA,CACVz7C,GAAAA,CAAIvQ,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,EACnB7K,SAAAA,GACAC,KAAAA,CAAMjQ,IAAAA,CAAKisD,UAAAA,IAAc,GACzBh8C,KAAAA,CAAM6mC,IAAU,IAAA,GAGrBgT,GAAgBC,SAAAA,CAAU/pD,IAAAA,CAAK+c,SAAAA,EAAW/c,IAAAA,CAAKgqD,MAAAA,EAAQ+B,GAAOjV;YAChE;QAAA;QAiHF,IAAYwU;QArQI,GAAAY,aAAAA,GAAgC;YAC5CxB,YAAYt4C,EAAM0C,KAAAA;YAClB61C,UAAUv4C,EAAM0C,KAAAA;YAChB81C,MAAM;YACNC,MAAAA,CAAM;YACN/6C,MAAM;YACNslC,SAAAA,KAASt0C;YACT6qD,WAAAA,KAAW7qD;YACX8qD,SAAAA,KAAS9qD;QAAAA,GA6Pb,SAAYwqD,CAAAA;YAKV,EAAA,MAAA,GAAA,UAKA,EAAA,KAAA,GAAA;QACD,EAXWA,MAAAA,CAAAA,KAAiB,CAAA,CAAA;QC3QtB,MAAMa;YAAb,aAAA;gBACkB,IAAA,CAAA1lD,IAAAA,GAAO,eAChB,IAAA,CAAAs9B,QAAAA,GAAmB;YA2G5B;YAtGE,WAAW5V,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD,GAChBrkC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA2O,cC1BN;oBD2BMC,gBE3BN;oBF4BMC,WAAYK,CAAAA;wBACVlP,EAAGi+B,yBAAAA,CACD/uB,GACA;4BAAC;4BAAiB;4BAAiB;4BAAiB;4BAAwB;yBAAA,EAC5ElP,EAAGk+B,mBAAAA;oBACJ;gBAAA,IAGLrsD,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IACbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA;YAC1D;YAEQ,YAAY2K,CAAAA,EAAAA;gBAClB,MAAM0b,IAAiB1b,EAAM2b,YAAAA,CAAalX,GAA8BC,SAAAA,GAClE/B,IAAY+Y,IAAiB1a,GAAoB0a,KAAAA,KAAkBvnC,GACnEynC,IAAQza,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BE,SAAAA,IAC5EkX,IAAQ1a,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BG,SAAAA,IAE5EkX,IAA8C,WAAtC9b,EAAM2b,YAAAA,CAAa,gBAC3BpX,IAAUlxB,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAcze,IAAAA,CAC1C0C,GACA;oBACE2C,WAAAA;oBACAC,UAAU;wBAAEjjB,GAAGi8B;wBAAOn+B,GAAGo+B;oBAAAA;gBAAAA,GAE3BC;gBAIF,OADA9b,EAAMgc,eAAAA,CAAgB,gBACfzX;YACT;YAEA,KAAKub,CAAAA,EAA+BqK,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBAClC,MAAM3oB,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAEhBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA;gBACxD,MAAMjF,IACJ0vB,EAAS8f,QAAAA,CAASxvC,SAAAA,KAAcuuC,GAAkBkB,KAAAA,GAC9CxsD,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,KACd1kC,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,GAAehxB,QAAAA,CAAS+4B,EAASjkC,OAAAA,CAAQuU,SAAAA,CAAUpa,GAAAA,GAAM6jB,OAAAA;gBAC7ExmB,IAAAA,CAAK2iC,OAAAA,CAAQvC,sBAAAA,CAAuB,eAAerjB,IACnD/c,IAAAA,CAAK2iC,OAAAA,CAAQlD,iBAAAA,CAAkB,QAAA,CAAA,CAAQgN,EAAS8f,QAAAA,CAAS1B,IAAAA,GACzD7qD,IAAAA,CAAK2iC,OAAAA,CAAQlD,iBAAAA,CAAkB,cAAA,CAAA,CAAcgN,EAAS8f,QAAAA,CAASnX,OAAAA,GAC/Dp1C,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,aAAmC,SAAtB,CAAA,IAAA8M,EAAS8f,QAAAA,CAAS3B,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,MACpE5qD,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,WAAWmX,IACxC92C,IAAAA,CAAK2iC,OAAAA,CAAQ5C,qBAAAA,CAAsB,WAAgC,SAArB,CAAA,IAAA0M,EAAS8f,QAAAA,CAAS9C,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI/6C,EAAI,GAAG,KAC9E1O,IAAAA,CAAK2iC,OAAAA,CAAQ1C,oBAAAA,CAAqB,cAA0C,SAA5B,CAAA,IAAAwM,EAAS8f,QAAAA,CAAS7B,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAIt4C,EAAM8D,WAAAA,GACtFlW,IAAAA,CAAK2iC,OAAAA,CAAQ1C,oBAAAA,CAAqB,YAAsC,SAA1B,CAAA,IAAAwM,EAAS8f,QAAAA,CAAS5B,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAIv4C,EAAM8D,WAAAA;gBAElF,IAAIy1C,IAAuC,SAA3B,CAAA,IAAAlf,EAAS8f,QAAAA,CAASZ,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,GAC3CC,IAAmC,SAAzB,CAAA,IAAAnf,EAAS8f,QAAAA,CAASX,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;gBAC3C,MAAM97C,IAA6B,SAAtB,CAAA,IAAA28B,EAAS8f,QAAAA,CAASz8C,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI;gBAgBvC,IAfIA,IAAO,KACT67C,CAAAA,IAAY77C,GACZ87C,IAAU97C,CAAAA,GAGZ9P,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,aAAagsB,QAAAA,IAAAA,IAAa,KACvD3rD,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,WAAWisB,QAAAA,IAAAA,IAAW,KACnD5rD,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,gBAAyC,SAAzB,CAAA,IAAA8M,EAAS8f,QAAAA,CAAS3jC,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,IAEtE6jB,EAAS8f,QAAAA,CAASP,KAAAA,IACpBhsD,CAAAA,IAAAA,CAAK2iC,OAAAA,CAAQ5C,qBAAAA,CAAsB,SAAS0M,EAAS8f,QAAAA,CAASP,KAAAA,GAC9DhsD,IAAAA,CAAK2iC,OAAAA,CAAQhD,eAAAA,CAAgB,cAA0C,SAA5B,CAAA,IAAA8M,EAAS8f,QAAAA,CAASN,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,EAAA,GAIzExf,EAAS8f,QAAAA,CAASnX,OAAAA,EAAS;oBAC7B,MAAMA,IAAU3I,EAAS8f,QAAAA,CAASnX,OAAAA,EAE5BlkB,IAAUlxB,IAAAA,CAAKssD,WAAAA,CAAYlX,EAAQzoB,KAAAA,CAAMA,KAAAA;oBAE/CwB,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GACpBtJ,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAYuB,IAC9BlxB,IAAAA,CAAK2iC,OAAAA,CAAQxD,aAAAA,CAAc,WAAW;gBACxC;gBAOAsN,EAAS5sB,IAAAA,CAAKsO;YAChB;YACA,kBAAA0W;gBACE,OAAA,CAAO;YACT;YACA,QAAAJ,CAEA;YACA,UAAArV,CAEA;QAAA;QGnGK,MAAMq9B;YA4BX,YAAYxzC,CAAAA,CAAAA;gBA3BI,IAAA,CAAAxS,IAAAA,GAAO,eAChB,IAAA,CAAAs9B,QAAAA,GAAmB,GAMlB,IAAA,CAAA6C,UAAAA,GAAqB,KACrB,IAAA,CAAAC,YAAAA,GAAuB,GACvB,IAAA,CAAA6lB,WAAAA,GAAc,IAQd,IAAA,CAAA5lB,WAAAA,GAAsB,GACtB,IAAA,CAAAC,SAAAA,GAA4B,EAAA,EAC5B,IAAA,CAAAC,aAAAA,GAAgB,GAChB,IAAA,CAAAC,eAAAA,GAAkB,IAAI3Y,KACtB,IAAA,CAAA4Y,OAAAA,GAAU,IAAIjwB,KACd,IAAA,CAAAgtB,YAAAA,GAAuB,GAiOvB,IAAA,CAAAkD,aAAAA,GAAgB,IAAI7Y,KAUpB,IAAA,CAAA8Y,cAAAA,GAAiB,IAAI9Y,KAUrB,IAAA,CAAA+Y,KAAAA,GAAQ;oBAAC;oBAAG;oBAAG;oBAAG;iBAAA,EAClB,IAAA,CAAAC,KAAAA,GAAQ;oBAAC;oBAAG;iBAAA,EACZ,IAAA,CAAAE,YAAAA,GAAep1B,EAAM0C,KAAAA,EAjP3B9U,IAAAA,CAAKynC,eAAAA,GAAkBxuB,EAAQwuB,eAAAA,EAC/BznC,IAAAA,CAAK0nC,SAAAA,GAAYzuB,EAAQyuB,SAC3B;YAAA;YAEA,WAAWvZ,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrCrkC,IAAAA,CAAKwuB,GAAAA,GAAML,GACXnuB,IAAAA,CAAKskC,QAAAA,GAAWD;gBAEhB,MAAMsD,IAAaxZ,EAAGY,YAAAA,CAAaZ,EAAGyZ,uBAAAA,GAChCC,IAAgBlM,GAAuBxN,GAAIwZ;gBACjD3nC,IAAAA,CAAK6mC,YAAAA,GAAevhC,KAAKkF,GAAAA,CAAIm9B,GAAYE;gBACzC,MAAMC,IAAkB9nC,IAAAA,CAAK+nC,wBAAAA,CC/DjC,u4DD+DgE/nC,IAAAA,CAAK6mC,YAAAA;gBAEjE7mC,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA4O,gBAAgB+K;oBAChBhL,cEpEN;gBAAA,IFsEI98B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAGbz9B,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IACbv3B,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYkE,EAAQriB,KAAAA,GAElDhiB,IAAAA,CAAK2iC,OAAAA,CAAQpD,kBAAAA,CACX,cACA;uBAAIx1B,MAAM/J,IAAAA,CAAK6mC,YAAAA;iBAAAA,CAAe5mC,GAAAA,CAAI,CAACkhC,GAAG3gC,IAAMA,KAG9CR,IAAAA,CAAKmjC,IAAAA,GAAOhV,EAAGiV,iBAAAA,IACfjV,EAAGkV,eAAAA,CAAgBrjC,IAAAA,CAAKmjC,IAAAA,GACxBnjC,IAAAA,CAAK2sD,SAAAA,GAAY,IAAIhrC,aAAa;oBAEhC;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAEjC;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;oBAAG;iBAAA,GAEnC3hB,IAAAA,CAAK4sD,WAAAA,GAAcz+B,EAAGoT,YAAAA,IACtBpT,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAK4sD,WAAAA,GACpCz+B,EAAGqT,UAAAA,CAAWrT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAK2sD,SAAAA,EAAWx+B,EAAGwT,WAAAA,GAClDxT,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAAO,IAAI,IAClDrM,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAAO,IAAI,IAClDrM,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc;gBAG/B,MAAMmkB,IAAa7lD,IAAAA,CAAK0sD,WAAAA;gBACxB1sD,IAAAA,CAAK6sD,cAAAA,GAAiB,IAAIxrB,GAAa;oBACrClT,IAAAA;oBACAre,MAAM+1C,IAAa7lD,IAAAA,CAAK4mC,UAAAA;oBACxBngC,MAAM;gBAAA,IAGRzG,IAAAA,CAAK6sD,cAAAA,CAAehsC,IAAAA;gBAGpB,IAAIoU,IAAS,GACTjwB,IAAQ;gBACZ,MACM8nD,IAAyB,IAAbjH;gBAGlB13B,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,IAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,KAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,KAC3BxO,KAAU,GAGV9G,EAAGqV,mBAAAA,CAAoBx+B,KAAS,GAAGmpB,EAAGqM,KAAAA,EAAAA,CAAO,GAAOsyB,GAAW73B,IAC/D9G,EAAGsV,uBAAAA,CAAwB,KAC3BxO,KAAU,IAEV9G,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,GAAG,IAC1B5+B,EAAG4+B,mBAAAA,CAAoB,IAAI,IAC3B5+B,EAAG4+B,mBAAAA,CAAoB,IAAI,IAC3B5+B,EAAG4+B,mBAAAA,CAAoB,IAAI,IAE3B5+B,EAAGkV,eAAAA,CAAgB;YACrB;YAEQ,UAAUlV,CAAAA,EAAAA;gBAEhB,MAAM03B,IAAa7lD,IAAAA,CAAK0sD,WAAAA;gBACxB1sD,IAAAA,CAAK6sD,cAAAA,CAAehsC,IAAAA,IACpB7gB,IAAAA,CAAK6sD,cAAAA,CAAe/qB,MAAAA,CAAO+jB,IAAa7lD,IAAAA,CAAK8mC,WAAAA,GAE7C3Y,EAAGkV,eAAAA,CAAgBrjC,IAAAA,CAAKmjC,IAAAA;YAC1B;YAEO,UAAA/T;gBACLpvB,IAAAA,CAAK6sD,cAAAA,CAAez9B,OAAAA,IACpBpvB,IAAAA,CAAK2iC,OAAAA,CAAQvT,OAAAA,IACbpvB,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,GAAS,GACxBN,IAAAA,CAAKskC,QAAAA,GAAW,MAChBtkC,IAAAA,CAAKwuB,GAAAA,GAAM;YACb;YAEQ,yBAAyBjN,CAAAA,EAAgB0mB,CAAAA,EAAAA;gBAC/C,IAAIC,IAAY3mB,EAAOya,OAAAA,CAAQ,aAAaiM,EAAYloC,QAAAA,KACpDooC,IAAuB;gBAC3B,IAAK,IAAI3nC,IAAI,GAAGA,IAAIynC,GAAaznC,IAE7B2nC,KADQ,MAAN3nC,IACsB,CAAA,uBAAA,EAA0BA,EAAAA,OAAAA,CAAAA,GAE1B,CAAA,+BAAA,EAAkCA,EAAAA,OAAAA,CAAAA,EAE5D2nC,KAAwB,CAAA,iCAAA,EAAoC3nC,EAAAA,SAAAA,CAAAA,EAC5D2nC,KAAwB;gBAG1B,OADAD,IAAYA,EAAUlM,OAAAA,CAAQ,sBAAsBmM,IAC7CD;YACT;YAEQ,mBAAmBvb,CAAAA,EAAAA;gBACzB,IAAI3sB,IAAAA,CAAKknC,OAAAA,CAAQnvB,GAAAA,CAAI4U,IACnB;gBAEF,MAAM0b,IAAiB1b,EAAM2b,YAAAA,CAAalX,GAA8BC,SAAAA,GAClE/B,IAAY+Y,IAAiB1a,GAAoB0a,KAAAA,KAAkBvnC,GACnEynC,IAAQza,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BE,SAAAA,IAC5EkX,IAAQ1a,GAAmBnB,EAAM2b,YAAAA,CAAalX,GAA8BG,SAAAA,IAE5EkX,IAA8C,WAAtC9b,EAAM2b,YAAAA,CAAa,gBAC3BpX,IAAUlxB,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAcze,IAAAA,CAC1C0C,GACA;oBACE2C,WAAAA;oBACAC,UAAU;wBAAEjjB,GAAGi8B;wBAAOn+B,GAAGo+B;oBAAAA;gBAAAA,GAE3BC;gBAGF9b,EAAMgc,eAAAA,CAAgB,gBAAA,OAClB3oC,IAAAA,CAAK+mC,SAAAA,CAAUt+B,OAAAA,CAAQyoB,MACzBlxB,CAAAA,IAAAA,CAAK+mC,SAAAA,CAAUpnC,IAAAA,CAAKuxB,IACpBlxB,IAAAA,CAAKinC,eAAAA,CAAgBjc,GAAAA,CAAIkG,GAASlxB,IAAAA,CAAKgnC,aAAAA,KACvChnC,IAAAA,CAAKknC,OAAAA,CAAQ92B,GAAAA,CAAIuc,EAAAA;YAErB;YAEQ,cAAcwB,CAAAA,EAAAA;gBAEpB,MAAM5oB,IAAMD,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKgnC,aAAAA,EAAehnC,IAAAA,CAAK6mC,YAAAA;gBAC9C,IAAK,IAAIrmC,IAAI,GAAGA,IAAI+E,GAAK/E,IACvB2tB,EAAGqJ,aAAAA,CAAcrJ,EAAGsJ,QAAAA,GAAWj3B,IAC/B2tB,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAK+mC,SAAAA,CAAUvmC,EAAAA,IAAMR,IAAAA,CAAK+mC,SAAAA,CAAU,EAAA;YAEtE;YAEQ,sBAAsBpa,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC5B,IAAIA,GAAO;oBACT,MAAMmc,IAAe9oC,IAAAA,CAAKskC,QAAAA,CAASoE,aAAAA,CAAc/lC,GAAAA,CAAIgqB;oBACrD,OAA6C,SAAtC,CAAA,IAAA3sB,IAAAA,CAAKinC,eAAAA,CAAgBtkC,GAAAA,CAAImmC,EAAAA,KAAAA,KAAa,MAAA,IAAA,IAAA;gBAC/C;gBACA,OAAA;YACF;YAEQ,UAAAtE;gBACN,OAAIxkC,IAAAA,CAAK8mC,WAAAA,IAAe9mC,IAAAA,CAAK4mC,UAAAA,IAGzB5mC,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,IAAUN,IAAAA,CAAK6mC,YAIpC;YAAA;YAGQ,eAAela,CAAAA,EAAAA;gBACrB,IAAIqc,IAAahpC,IAAAA,CAAKmnC,aAAAA,CAAcxkC,GAAAA,CAAIgqB;gBAKxC,OAAA,KAJmB7rB,MAAfkoC,KACFA,CAAAA,IAAarc,EAAMxS,KAAAA,EACnBna,IAAAA,CAAKmnC,aAAAA,CAAcnc,GAAAA,CAAI2B,GAAOqc,EAAAA,GAEzBA;YACT;YAGQ,gBAAgBrc,CAAAA,EAAAA;gBACtB,IAAIuc,IAAclpC,IAAAA,CAAKonC,cAAAA,CAAezkC,GAAAA,CAAIgqB;gBAK1C,OAAA,KAJoB7rB,MAAhBooC,KACFA,CAAAA,IAAcvc,EAAMtS,MAAAA,EACpBra,IAAAA,CAAKonC,cAAAA,CAAepc,GAAAA,CAAI2B,GAAOuc,EAAAA,GAE1BA;YACT;YAKA,KACEvc,CAAAA,EACAlK,CAAAA,EACAC,CAAAA,EACAymB,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAGIxpC,IAAAA,CAAKwkC,OAAAA,MACPxkC,IAAAA,CAAKykC,KAAAA,IAGPzkC,IAAAA,CAAK8mC,WAAAA,IAEL9mC,IAAAA,CAAKooC,kBAAAA,CAAmBzb;gBACxB,MAAM8c,IAAkBzpC,IAAAA,CAAK+oC,cAAAA,CAAepc,IACtC+c,IAAmB1pC,IAAAA,CAAKipC,eAAAA,CAAgBtc;gBAE9C,IAAIxS,IAAQsvB,KAAmBN,KAAU,GACrC9uB,IAASqvB,KAAoBN,KAAW;gBAC5CppC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK,GAChBrnC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK,GAChBrnC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAA8B,SAAzB,CAAA,IAAA8B,QAAAA,IAAAA,IAAUM,CAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI,GAC7CzpC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAgC,SAA3B,CAAA,IAAA+B,QAAAA,IAAAA,IAAWM,CAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAI,GAC/C1pC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK7kB,QAAAA,IAAAA,IAAM,GACtBziB,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK5kB,QAAAA,IAAAA,IAAM,GAAA,KAEX5hB,MAAPuoC,KAAAA,KAA2BvoC,MAAPwoC,KAAAA,KAA+BxoC,MAAXyoC,KAAAA,KAAoCzoC,MAAZ0oC,KAClExpC,CAAAA,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK5kB,QAAAA,IAAAA,IAAM,GACtBziB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAK3kB,QAAAA,IAAAA,IAAM,GACtB1iB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAA8B,SAAzB,CAAA,IAAA8B,QAAAA,IAAAA,IAAUM,CAAAA,KAAAA,KAAe,MAAA,IAAA,IAAI,GAC7CzpC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,GAAgC,SAA3B,CAAA,IAAA+B,QAAAA,IAAAA,IAAWM,CAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAI,GAC/C1pC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAK+B,GAChBrpC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKgC,GAChBnvB,IAAQovB,GACRlvB,IAASmvB,CAAAA,GAGX/mB,IAAKziB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAChB3kB,IAAK1iB,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA;gBAChB,MAAMsC,IAAK3pC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAChBuC,IAAK5pC,IAAAA,CAAKqnC,KAAAA,CAAM,EAAA,EAGhBtqB,IAAY/c,IAAAA,CAAKskC,QAAAA,CAASI,YAAAA,IAC1B9b,IAAU5oB,IAAAA,CAAKskC,QAAAA,CAAS1b,OAAAA;gBACV5oB,IAAAA,CAAKskC,QAAAA,CAASc,WAAAA,IAEhCplC,CAAAA,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQtnC,CAAAA,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKhC,EAAAA,GACnCtlC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAA,CAAA,CAAQtnC,CAAAA,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,GAAKhC,EAAAA,CAAAA;gBAGrC,MAAMxc,IAAO9oB,IAAAA,CAAKskC,QAAAA,CAASxb,IAAAA,IAAQ9oB,IAAAA,CAAKwnC,YAAAA,EAElCqC,IAAY7pC,IAAAA,CAAK6oC,qBAAAA,CAAsBlc,IACvCmd,IAAaL,KAAmBtvB,GAChC4vB,IAAcL,KAAoBrvB,GAElC2vB,IAAAA,AAAQvnB,CAAAA,IAAKziB,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaoC,GAC/BG,IAAAA,AAAQvnB,CAAAA,IAAK1iB,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaqC,GAC/BG,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK3pC,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaoC,GACpCK,IAAAA,AAAQznB,CAAAA,IAAKknB,IAAK5pC,IAAAA,CAAK0nC,SAAAA,AAAAA,IAAaqC,GAEpCK,IAAUX,GACVY,IAAWX,GAGXvH,IAAeniC,IAAAA,CAAK6sD,cAAAA,CAAerrB,UAAAA;gBACzCW,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAC/CnF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBjkC,IAAAA,CAAKsnC,KAAAA,CAAM,EAAA,EAC/CnF,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBlnB,EAAUtb,IAAAA,CAAK,EAAA,EACnD0gC,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBrb,GACpCuZ,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB9pB,GACpCgoB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB5pB,GACpC8nB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBmG,GACpCjI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBoG,GACpClI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB4F,GACpC1H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkB+F,GACpC7H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBgG,GACpC9H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBiG,GACpC/H,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBkG,GACpChI,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK7lB,CAAAA,GAAI,KAC7Ck/B,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKzW,CAAAA,GAAI,KAC7C8vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAKxW,CAAAA,GAAI,KAC7C6vB,CAAAA,CAAaniC,IAAAA,CAAKikC,YAAAA,GAAAA,GAAkBnb,EAAK1mB,CAC3C;YAAA;YAEA,kBAAAyiC;gBACE,OAA4B,MAArB7kC,IAAAA,CAAK8mC,WACd;YAAA;YAEA,QAAArC;gBAEE,IAAyB,MAArBzkC,IAAAA,CAAK8mC,WAAAA,EACP;gBAGF,MAAM3Y,IAAKnuB,IAAAA,CAAKwuB,GAAAA;gBAGhBxuB,IAAAA,CAAK2iC,OAAAA,CAAQpL,GAAAA,IAGbv3B,IAAAA,CAAKgtD,SAAAA,CAAU7+B,IAGfnuB,IAAAA,CAAK2iC,OAAAA,CAAQxC,gBAAAA,CAAiB,YAAYngC,IAAAA,CAAKskC,QAAAA,CAAStiB,KAAAA,GAGxDhiB,IAAAA,CAAK2iC,OAAAA,CAAQlD,iBAAAA,CAAkB,cAAcz/B,IAAAA,CAAKynC,eAAAA,GAGlDznC,IAAAA,CAAK4oC,aAAAA,CAAcza,IAGnBA,EAAG8+B,mBAAAA,CAAoB9+B,EAAG2X,SAAAA,EAAW,GAAG,GAAG9lC,IAAAA,CAAK8mC,WAAAA,GAEhDnD,GAAoBE,gBAAAA,IAAoB7jC,IAAAA,CAAK8mC,WAAAA,EAC7CnD,GAAoBC,aAAAA,IAEpBzV,EAAGkV,eAAAA,CAAgB,OAEnBrjC,IAAAA,CAAK8mC,WAAAA,GAAc,GACnB9mC,IAAAA,CAAKikC,YAAAA,GAAe,GACpBjkC,IAAAA,CAAK+mC,SAAAA,CAAUzmC,MAAAA,GAAS,GACxBN,IAAAA,CAAKgnC,aAAAA,GAAgB,GACrBhnC,IAAAA,CAAKinC,eAAAA,CAAgBz/B,KAAAA,IACrBxH,IAAAA,CAAKknC,OAAAA,CAAQ1/B,KAAAA,IACbxH,IAAAA,CAAKmnC,aAAAA,CAAc3/B,KAAAA,IACnBxH,IAAAA,CAAKonC,cAAAA,CAAe5/B,KAAAA;YACtB;QAAA;QGxYK,MAAM89B,KAAmB;QAEhC,MAAM4nB;YAEJ,YAAoBC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,SAAAA,GAAAA,GADZ,IAAA,CAAAC,UAAAA,GAAa,IAAIt2B;YACsC;YAS/D,SAASxqB,CAAAA,EAAWlC,CAAAA,EAAW+P,CAAAA,EAAeE,CAAAA,EAAgBgzC,IAAmC;gBAAE15C,OAAOvB,EAAMyC,KAAAA;YAAAA,CAAAA,EAAAA;gBAC9G7U,IAAAA,CAAK+qC,QAAAA,CAASr8B,EAAIpC,GAAGlC,IAAIsE,EAAIpC,IAAI6N,GAAO/P,IAAI;oBAAA,GAAKijD,CAAAA;gBAAAA,IACjDrtD,IAAAA,CAAK+qC,QAAAA,CAASr8B,EAAIpC,IAAI6N,GAAO/P,IAAIsE,EAAIpC,IAAI6N,GAAO/P,IAAIiQ,IAAS;oBAAA,GAAKgzC,CAAAA;gBAAAA,IAClErtD,IAAAA,CAAK+qC,QAAAA,CAASr8B,EAAIpC,IAAI6N,GAAO/P,IAAIiQ,IAAS3L,EAAIpC,GAAGlC,IAAIiQ,IAAS;oBAAA,GAAKgzC,CAAAA;gBAAAA,IACnErtD,IAAAA,CAAK+qC,QAAAA,CAASr8B,EAAIpC,GAAGlC,IAAIiQ,IAAS3L,EAAIpC,GAAGlC,IAAI;oBAAA,GAAKijD,CAAAA;gBAAAA;YACpD;YAQA,SAASroD,CAAAA,EAAeu/B,CAAAA,EAAa+oB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACnCttD,IAAAA,CAAKmtD,SAAAA,CAAUttC,IAAAA,CAAmB,WAAW7a,GAAOu/B,GAAuB,SAAlB,CAAA,IAAA+oB,QAAAA,IAAAA,KAAW,IAAXA,EAAa35C,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIvB,EAAMyC,KAAAA;YACvF;YAOA,UAAU+H,CAAAA,EAAe2wC,IAAqC;gBAAE55C,OAAOvB,EAAMyC,KAAAA;gBAAO/E,MAAM;YAAA,CAAA,EAAA;gBACxF9P,IAAAA,CAAKmtD,SAAAA,CAAUttC,IAAAA,CAAoB,YAAYjD,GAAO2wC,EAAa55C,KAAAA,EAAO45C,EAAaz9C,IAAAA;YACzF;YAEA,SAAS8jB,CAAAA,EAAc/Y,CAAAA,EAAAA;gBACrB7a,IAAAA,CAAKotD,UAAAA,CAAWj2B,KAAAA,CAAMn3B,IAAAA,CAAKmtD,SAAAA,EAAWv5B,GAAM/Y;YAC9C;QAAA;QAiBK,MAAMoyB;YA8DX,IAAA,IAAWpkB;gBACT,OAAO7oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQG,CAC7B;YAAA;YAEA,IAAA,EAAazlB,CAAAA,EAAAA;gBACXpD,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQG,CAAAA,GAAIzlB;YAC1B;YAEA,IAAA,UAAWwlB;gBACT,OAAO5oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQE,OAC7B;YAAA;YAEA,IAAA,QAAmBxlB,CAAAA,EAAAA;gBACjBpD,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQE,OAAAA,GAAUxlB;YAChC;YAEA,IAAA,OAAW0lB;gBACT,OAAO9oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQI,IAC7B;YAAA;YAEA,IAAA,KAAgBnV,CAAAA,EAAAA;gBACd3T,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQI,IAAAA,GAAOnV;YAC7B;YAEA,IAAA,QAAWwG;gBACT,OAAOna,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAOa,KAC1B;YAAA;YAEA,IAAA,SAAWE;gBACT,OAAOra,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAOe,MAC1B;YAAA;YAEA,IAAA,QAAW2H;gBACT,OAAOhiB,IAAAA,CAAK0tD,MACd;YAAA;YAMO,2BAA2BE,CAAAA,EAAAA;gBAEhC,IAAIC,IAAAA,CAAY;gBAIhB,OAAA,AAHID,CAAAA,EAAIzzC,KAAAA,GAAQ,QAAQyzC,EAAIvzC,MAAAA,GAAS,IAAA,KACnCwzC,CAAAA,IAAAA,CAAY,CAAA,GAEPA;YACT;YAOA,YAAY50C,CAAAA,CAAAA;gBAnHJ,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IACjB,IAAA,CAAAy2C,UAAAA,GAA0C,IAAIx/B,KAC9C,IAAA,CAAAy/B,qBAAAA,GAA2D,IAAIz/B,KAChE,IAAA,CAAA0/B,aAAAA,GAA4CtoD,EAAMW,SAAAA,CAAU,+BAA+B,aAAa,eACvG,IAAA,CAAA4nD,gBAAAA,GAAAA,CAAmB,GACpB,IAAA,CAAAC,cAAAA,GAAAA,CAAiB,GAEhB,IAAA,CAAAC,aAAAA,GAAgB,IAAItiB,GAAe,IAAM,IAAIW,IAAAA,KAAY1rC,GAAW,MAEpE,IAAA,CAAAstD,cAAAA,GAAiB,GACjB,IAAA,CAAAC,UAAAA,GAAyB,IAAItkD,MAAM,KAAMuwC,IAAAA,CAAK,OAS9C,IAAA,CAAAgU,mBAAAA,GAAsC,EAAA,EAItC,IAAA,CAAAC,eAAAA,GAAmC,EAAA,EAOnC,IAAA,CAAA1b,UAAAA,GAAa,IAAIzqB,GACjB,IAAA,CAAAqlC,MAAAA,GAAS,IAAIzkC,GAMd,IAAA,CAAAoc,WAAAA,GAAAA,CAAuB,GAKd,IAAA,CAAA2S,SAAAA,GAAAA,CAAqB,GAKrB,IAAA,CAAAtQ,eAAAA,GAAAA,CAA2B,GAMpC,IAAA,CAAAC,SAAAA,GAAY,KAEZ,IAAA,CAAA8mB,eAAAA,GAAyBp8C,EAAM+D,aAAAA,EAuDtB,IAAA,CAAAs4C,uBAAAA,GAAAA,CAAmC,GAEnC,IAAA,CAAA52B,YAAAA,GAAAA,CAAwB,GAChC,IAAA,CAAA62B,cAAAA,GAAAA,CAAiB,GA+DjB,IAAA,CAAAC,SAAAA,GAAAA,CAAY,GAqNZ,IAAA,CAAAxnB,aAAAA,GAAgB,IAAI7Y,KAUpB,IAAA,CAAA8Y,cAAAA,GAAiB,IAAI9Y,KA2E7B,IAAA,CAAAtW,KAAAA,GAAQ,IAAIk1C,GAAmCltD,IAAAA,GAoDvC,IAAA,CAAA4uD,uBAAAA,GAA0B;gBA1ZhC,MAAA,EAAM,eACJC,CAAAA,EAAa,SACbxqB,CAAAA,EAAO,oBACPyqB,CAAAA,EAAkB,cAClBC,CAAAA,EAAY,WACZrnB,CAAAA,EAAS,yBACT+mB,CAAAA,EAAuB,iBACvBhnB,CAAAA,EAAe,iBACfunB,CAAAA,EAAe,aACf5pB,CAAAA,EAAW,iBACXopB,CAAAA,EAAe,gBACfN,CAAAA,EAAc,kBACdh/B,CAAAA,EAAgB,mBAChB+/B,CAAAA,EAAiB,uBACjBC,CAAAA,EAAAA,GACEj2C;gBAUJ,IATAjZ,IAAAA,CAAKstC,IAAAA,GACHjJ,QAAAA,IAAAA,IACCwqB,EAAcn1C,UAAAA,CAAW,UAAU;oBAClCie,WAAWo3B,QAAAA,IAAAA,IAAgB/uD,IAAAA,CAAK+3C,SAAAA;oBAChCoX,oBAAAA,CAAoB;oBACpBC,OAAON,QAAAA,IAAAA,IAAsB9uD,IAAAA,CAAK63B,YAAAA;oBAClCw3B,OAAAA,CAAO;oBACPL,iBAAiBA,QAAAA,IAAAA,IAAmB;gBAAA,IAAA,CAEnChvD,IAAAA,CAAKstC,IAAAA,EACR,MAAMnnC,MAAM;gBAGV8oD,KACFjvD,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAO+Q,gBAAAA,CAAiB,oBAAoB4kC,GAAAA,CAAmB,IAGvEC,KACFlvD,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAO+Q,gBAAAA,CAAiB,wBAAwB6kC,GAAAA,CAAuB,IAGnFlvD,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAO+Q,gBAAAA,CAAiB,oBAAoB;oBACpDrqB,IAAAA,CAAK0uD,cAAAA,GAAAA,CAAiB;gBAAI,IAG5B1uD,IAAAA,CAAKstC,IAAAA,CAAKh0B,MAAAA,CAAO+Q,gBAAAA,CAAiB,wBAAwB;oBACxDrqB,IAAAA,CAAK0uD,cAAAA,GAAAA,CAAiB;gBAAK,IAG7B1uD,IAAAA,CAAK0oC,aAAAA,GAAgB,IAAIxa,GAAcluB,IAAAA,CAAKstC,IAAAA,EAAMpe,IAClDlvB,IAAAA,CAAKolC,WAAAA,GAAcA,QAAAA,IAAAA,IAAeplC,IAAAA,CAAKolC,WAAAA,EACvCplC,IAAAA,CAAK+3C,SAAAA,GAAYgX,QAAAA,IAAAA,IAAgB/uD,IAAAA,CAAK+3C,SAAAA,EACtC/3C,IAAAA,CAAK63B,YAAAA,GAAei3B,QAAAA,IAAAA,IAAsB9uD,IAAAA,CAAK63B,YAAAA,EAC/C73B,IAAAA,CAAKynC,eAAAA,GAAkBA,QAAAA,IAAAA,IAAmBznC,IAAAA,CAAKynC,eAAAA,EAC/CznC,IAAAA,CAAK0nC,SAAAA,GAAYA,QAAAA,IAAAA,IAAa1nC,IAAAA,CAAK0nC,SAAAA,EACnC1nC,IAAAA,CAAKyuD,uBAAAA,GAA6D,aAAA,OAA5BA,IAAwCA,IAA0BzuD,IAAAA,CAAKyuD,uBAAAA,EAC7GzuD,IAAAA,CAAK43B,OAAAA,GAA6C,YAAA,OAA5B62B,IAAuCA,EAAwB72B,OAAAA,GAAAA,KAAU92B,GAC/Fd,IAAAA,CAAKwuD,eAAAA,GAAkBA,QAAAA,IAAAA,IAAmBxuD,IAAAA,CAAKwuD,eAAAA,EAC/CxuD,IAAAA,CAAKkuD,cAAAA,GAAiBA,QAAAA,IAAAA,IAAkBluD,IAAAA,CAAKkuD,cAAAA,EAC7CluD,IAAAA,CAAKmuD,aAAAA,CAAcjiB,eAAAA,GAAAA,CAAkB,GACrClsC,IAAAA,CAAKmuD,aAAAA,CAAchiB,WAAAA,IACnBnsC,IAAAA,CAAKsvD,KAAAA;YACP;YAGO,UAAAlgC;gBACL,IAAA,CAAKpvB,IAAAA,CAAK2uD,SAAAA,EAAW;oBACnB3uD,IAAAA,CAAK2uD,SAAAA,GAAAA,CAAY,GACjB3uD,IAAAA,CAAK0oC,aAAAA,CAActZ,OAAAA;oBACnB,KAAK,MAAMqd,KAAYzsC,IAAAA,CAAK8tD,UAAAA,CAAW5G,MAAAA,GACrCza,EAASrd,OAAAA;oBAEXpvB,IAAAA,CAAK8tD,UAAAA,CAAWtmD,KAAAA,IAChBxH,IAAAA,CAAKmuD,aAAAA,CAAc/+B,OAAAA,IACnBpvB,IAAAA,CAAKquD,UAAAA,CAAW/tD,MAAAA,GAAS,GACzBN,IAAAA,CAAKstC,IAAAA,GAAO;gBACd;YACF;YAEQ,QAAAgiB;gBACN,MAAMnhC,IAAKnuB,IAAAA,CAAKstC,IAAAA;gBAsChB,IApCAttC,IAAAA,CAAK0tD,MAAAA,GAAShsC,EAAOM,KAAAA,CAAM,GAAGmM,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA,EAAQ,GAAG,KAAA,OACpE8T,EAAGiM,QAAAA,CAAS,GAAG,GAAGjM,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA,GAG7C8T,EAAGohC,UAAAA,CAAWvvD,IAAAA,CAAKwuD,eAAAA,CAAgBvrD,CAAAA,GAAI,KAAKjD,IAAAA,CAAKwuD,eAAAA,CAAgBn8C,CAAAA,GAAI,KAAKrS,IAAAA,CAAKwuD,eAAAA,CAAgBl8C,CAAAA,GAAI,KAAKtS,IAAAA,CAAKwuD,eAAAA,CAAgBpsD,CAAAA,GAC7H+rB,EAAG3mB,KAAAA,CAAM2mB,EAAG8L,gBAAAA,GAIZ9L,EAAGvoB,MAAAA,CAAOuoB,EAAGqhC,KAAAA,GACbrhC,EAAGshC,aAAAA,CAActhC,EAAGuhC,QAAAA,GACpBvhC,EAAGwhC,SAAAA,CAAUxhC,EAAGyhC,GAAAA,EAAKzhC,EAAG0hC,mBAAAA,GACxB1hC,EAAG2hC,qBAAAA,CAAsB3hC,EAAGuhC,QAAAA,EAAUvhC,EAAGuhC,QAAAA,GACzCvhC,EAAG4hC,iBAAAA,CAAkB5hC,EAAGyhC,GAAAA,EAAKzhC,EAAG0hC,mBAAAA,EAAqB1hC,EAAGyhC,GAAAA,EAAKzhC,EAAG0hC,mBAAAA,GAChE1hC,EAAG6hC,SAAAA,CAAAA,CAAU,IAEbhwD,IAAAA,CAAKiyC,QAAAA,CACH,IAAItL,GAAc;oBAChBe,WAAW1nC,IAAAA,CAAK0nC,SAAAA;oBAChBD,iBAAiBznC,IAAAA,CAAKynC,eAAAA;gBAAAA,KAG1BznC,IAAAA,CAAKiyC,QAAAA,CAAS,IAAI9D,KAClBnuC,IAAAA,CAAKiyC,QAAAA,CAAS,IAAI1H,KAClBvqC,IAAAA,CAAKiyC,QAAAA,CAAS,IAAIxG,KAClBzrC,IAAAA,CAAKiyC,QAAAA,CAAS,IAAIjN,KAClBhlC,IAAAA,CAAKiyC,QAAAA,CAAS,IAAInO,KAClB9jC,IAAAA,CAAKiwD,YAAAA,CAA+B,eAAe,IAAM,IAAI9D,KAC7DnsD,IAAAA,CAAKiyC,QAAAA,CACH,IAAIwa,GAAgB;oBAClB/kB,WAAW1nC,IAAAA,CAAK0nC,SAAAA;oBAChBD,iBAAiBznC,IAAAA,CAAKynC,eAAAA;gBAAAA,KAI1BznC,IAAAA,CAAK6uC,qBAAAA,GAAwB1gB,EAAG6B,aAAAA,IAAAA,CAC3BhwB,IAAAA,CAAK6uC,qBAAAA,EACR,MAAM,IAAI1oC,MAAM;gBAElBgoB,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY3vB,IAAAA,CAAK6uC,qBAAAA,GACnC1gB,EAAGyB,UAAAA,CAAWzB,EAAGwB,UAAAA,EAAY,GAAGxB,EAAG0B,IAAAA,EAAM7vB,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQ,GAAG8T,EAAG0B,IAAAA,EAAM1B,EAAG2B,aAAAA,EAAe,OAChG3B,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG0C,kBAAAA,EAAoB1C,EAAG2C,OAAAA,GAC1D3C,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAG6C,kBAAAA,EAAoB7C,EAAG2C,OAAAA,GAC1D3C,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGoC,cAAAA,EAAgBpC,EAAGsC,MAAAA,GACtDtC,EAAGmC,aAAAA,CAAcnC,EAAGwB,UAAAA,EAAYxB,EAAGwC,cAAAA,EAAgBxC,EAAGsC,MAAAA,GACtDtC,EAAGuB,WAAAA,CAAYvB,EAAGwB,UAAAA,EAAY,OAE9B3vB,IAAAA,CAAKkwD,eAAAA,GAAkB,IAAI1qB,GAAkBrX,IAE7CnuB,IAAAA,CAAKmwD,aAAAA,GAAgB,IAAIz4B,GAAa;oBACpCvJ,IAAAA;oBACA0J,cAAc73B,IAAAA,CAAK63B,YAAAA;oBACnB1d,OAAOgU,EAAG7U,MAAAA,CAAOa,KAAAA;oBACjBE,QAAQ8T,EAAG7U,MAAAA,CAAOe,MAAAA;gBAAAA,IAGpBra,IAAAA,CAAKsuD,mBAAAA,GAAsB;oBACzB,IAAI52B,GAAa;wBACfvJ,IAAAA;wBACA0J,cAAc73B,IAAAA,CAAK63B,YAAAA;wBACnB1d,OAAOgU,EAAG7U,MAAAA,CAAOa,KAAAA;wBACjBE,QAAQ8T,EAAG7U,MAAAA,CAAOe,MAAAA;oBAAAA;oBAEpB,IAAIqd,GAAa;wBACfvJ,IAAAA;wBACA0J,cAAc73B,IAAAA,CAAK63B,YAAAA;wBACnB1d,OAAOgU,EAAG7U,MAAAA,CAAOa,KAAAA;wBACjBE,QAAQ8T,EAAG7U,MAAAA,CAAOe,MAAAA;oBAAAA;iBAAAA,EAItBra,IAAAA,CAAKowD,WAAAA,GAAc,IAAI14B,GAAa;oBAClCvJ,IAAAA;oBACA0J,cAAc73B,IAAAA,CAAK63B,YAAAA;oBACnB1d,OAAOgU,EAAG7U,MAAAA,CAAOa,KAAAA;oBACjBE,QAAQ8T,EAAG7U,MAAAA,CAAOe,MAAAA;oBAClBsd,WAAW33B,IAAAA,CAAKyuD,uBAAAA;oBAChB72B,SAAS53B,IAAAA,CAAK43B,OAAAA;gBAAAA;YAElB;YAEO,SAAmC6U,CAAAA,EAAAA;gBACxCzsC,IAAAA,CAAK8tD,UAAAA,CAAW9iC,GAAAA,CAAIyhB,EAAShmC,IAAAA,EAAMgmC,IACnCA,EAAS7J,UAAAA,CAAW5iC,IAAAA,CAAKstC,IAAAA,EAAMttC,IAAAA;YACjC;YAEO,aAA+CyG,CAAAA,EAAyBgmC,CAAAA,EAAAA;gBAC7EzsC,IAAAA,CAAK+tD,qBAAAA,CAAsB/iC,GAAAA,CAAIvkB,GAAMgmC;YACvC;YAEO,IAAI4jB,CAAAA,EAAAA;gBACT,IAAIC,IAAgBtwD,IAAAA,CAAK8tD,UAAAA,CAAWnrD,GAAAA,CAAI0tD;gBACxC,IAAA,CAAKC,GAAe;oBAClB,MAAMC,IAAcvwD,IAAAA,CAAK+tD,qBAAAA,CAAsBprD,GAAAA,CAAI0tD;oBAC/CE,KACFvwD,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,uBAAuBq4C,IAC1CC,IAAgBC,KAChBvwD,IAAAA,CAAKiyC,QAAAA,CAASqe,EAAAA;gBAElB;gBACA,OAAOA;YACT;YAIQ,mBAAmB7jB,CAAAA,EAAAA;gBACzB,OAAA,CAAKzsC,IAAAA,CAAKywD,gBAAAA,IAAoBzwD,IAAAA,CAAKywD,gBAAAA,KAAqBhkB;YAI1D;YAEO,qBAAAikB;gBACL1wD,IAAAA,CAAKiuD,gBAAAA,GAAAA,CAAmB;YAC1B;YAEO,mBAAA0C;gBACL3wD,IAAAA,CAAKiuD,gBAAAA,GAAAA,CAAmB;YAC1B;YAEO,KAAuCoC,CAAAA,EAAAA,GAAoC34C,CAAAA,EAAAA;gBAYhF,IANK1X,IAAAA,CAAKiuD,gBAAAA,IACRjuD,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,4NAIAvY,IAAAA,CAAK0uD,cAAAA,EAEP,OAAA,KADA1uD,IAAAA,CAAK6sB,OAAAA,CAAQrU,SAAAA,CAAU,CAAA,eAAA,EAAkB63C,EAAAA,2BAAAA,CAAAA;gBAI3C,MAAM5jB,IAAWzsC,IAAAA,CAAK2C,GAAAA,CAAI0tD;gBAC1B,IAAA,CAAI5jB,GAuCF,MAAMtmC,MAAM,CAAA,sBAAA,EAAyBkqD,EAAAA,oBAAAA,CAAAA;gBAtCrC,IAAIrwD,IAAAA,CAAKkuD,cAAAA,EAAgB;oBACvB,MAAM0C,IAAW5wD,IAAAA,CAAKmuD,aAAAA,CAAcxrD,GAAAA;oBACpCiuD,EAAS/nC,CAAAA,GAAI7oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQG,CAAAA,EACjC+nC,EAAS7sB,QAAAA,GAAW0I,EAAS1I,QAAAA,EAC7B6sB,EAASnkB,QAAAA,GAAW4jB,GACpBrwD,IAAAA,CAAK0kC,YAAAA,GAAezyB,KAAAA,CAAM2+C,EAAS7zC,SAAAA,GACnC6zC,EAASlkB,KAAAA,CAAM7jB,CAAAA,GAAI7oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQG,CAAAA,EACvC+nC,EAASlkB,KAAAA,CAAM9jB,OAAAA,GAAU5oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQE,OAAAA,EAC7CgoC,EAASlkB,KAAAA,CAAM5jB,IAAAA,GAAO9oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQI,IAAAA,EAC1C8nC,EAASlkB,KAAAA,CAAM3jB,QAAAA,GAAW/oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAAAA,EAC9C6nC,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxBk5C,EAASl5C,IAAAA,CAAK,EAAA,GAAKA,CAAAA,CAAK,EAAA,EACxB1X,IAAAA,CAAKquD,UAAAA,CAAWruD,IAAAA,CAAKouD,cAAAA,GAAAA,GAAoBwC;gBAC3C,OAEO5wD,IAAAA,CAAKywD,gBAAAA,IACRzwD,CAAAA,IAAAA,CAAKywD,gBAAAA,GAAmBhkB,CAAAA,GAGrBzsC,IAAAA,CAAKwwD,kBAAAA,CAAmB/jB,MAE3BzsC,IAAAA,CAAKywD,gBAAAA,CAAiBhsB,KAAAA,IAIxBgI,EAAS5sB,IAAAA,CAAKnI,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,EAAIA,CAAAA,CAAK,EAAA,GAEpG1X,IAAAA,CAAKywD,gBAAAA,GAAmBhkB;YAK9B;YAEO,iBAAA4P;gBACLr8C,IAAAA,CAAK6yC,UAAAA,CAAWl3B,KAAAA;YAClB;YAEO,eAAevB,CAAAA,EAAAA;gBACpB,MAAM+T,IAAKnuB,IAAAA,CAAKstC,IAAAA;gBAChBttC,IAAAA,CAAK0tD,MAAAA,GAAS1tD,IAAAA,CAAK0tD,MAAAA,GAAShsC,EAAOM,KAAAA,CAAM,GAAG5H,EAAWD,KAAAA,EAAOC,EAAWC,MAAAA,EAAQ,GAAG,KAAA,OAEpFra,IAAAA,CAAKmwD,aAAAA,CAAc93B,aAAAA,CAAclK,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA,GAC5Dra,IAAAA,CAAKowD,WAAAA,CAAY/3B,aAAAA,CAAclK,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA,GAC1Dra,IAAAA,CAAKsuD,mBAAAA,CAAoB,EAAA,CAAGj2B,aAAAA,CAAclK,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA,GACrEra,IAAAA,CAAKsuD,mBAAAA,CAAoB,EAAA,CAAGj2B,aAAAA,CAAclK,EAAG7U,MAAAA,CAAOa,KAAAA,EAAOgU,EAAG7U,MAAAA,CAAOe,MAAAA;YACvE;YAGQ,eAAesS,CAAAA,EAAAA;gBACrB,IAAIqc,IAAahpC,IAAAA,CAAKmnC,aAAAA,CAAcxkC,GAAAA,CAAIgqB;gBAKxC,OAAA,KAJmB7rB,MAAfkoC,KACFA,CAAAA,IAAarc,EAAMxS,KAAAA,EACnBna,IAAAA,CAAKmnC,aAAAA,CAAcnc,GAAAA,CAAI2B,GAAOqc,EAAAA,GAEzBA;YACT;YAGQ,gBAAgBrc,CAAAA,EAAAA;gBACtB,IAAIuc,IAAclpC,IAAAA,CAAKonC,cAAAA,CAAezkC,GAAAA,CAAIgqB;gBAK1C,OAAA,KAJoB7rB,MAAhBooC,KACFA,CAAAA,IAAcvc,EAAMtS,MAAAA,EACpBra,IAAAA,CAAKonC,cAAAA,CAAepc,GAAAA,CAAI2B,GAAOuc,EAAAA,GAE1BA;YACT;YAeA,UACEvc,CAAAA,EACAlK,CAAAA,EACAC,CAAAA,EACAymB,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAEA,IAAe,MAAXL,KAA4B,MAAZC,KAEE,MAAXG,KAA4B,MAAZC,KAEe,MAA/BxpC,IAAAA,CAAK+oC,cAAAA,CAAepc,MAAgD,MAAhC3sB,IAAAA,CAAKipC,eAAAA,CAAgBtc,IAIpE,OAAKA,IAAAA,KAUD3sB,CAAAA,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAAAA,GACtB/oB,IAAAA,CAAK6f,IAAAA,CAAuB,eAAe8M,GAAOlK,GAAIC,GAAIymB,GAAQC,GAASC,GAAIC,GAAIC,GAAQC,KAEvFxpC,CAAAA,IAAAA,CAAKguD,aAAAA,EACPhuD,IAAAA,CAAK6f,IAAAA,CAAoB7f,IAAAA,CAAKguD,aAAAA,EAAerhC,GAAOlK,GAAIC,GAAIymB,GAAQC,GAASC,GAAIC,GAAIC,GAAQC,EAAAA,CAAAA,IAb/F5yB,CAAAA,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,0CAAA,KAEtBO,CAAAA,QAAQk4C,KAAAA,IAEVl4C,QAAQk4C,KAAAA,EAAAA,CAAAA;YAcd;YAEO,SAAS9rD,CAAAA,EAAeu/B,CAAAA,EAAa5wB,CAAAA,EAAcs3B,IAAY,CAAA,EAAA;gBACpEjrC,IAAAA,CAAK6f,IAAAA,CAAwB,gBAAgB7a,GAAOu/B,GAAK5wB,GAAOs3B;YAClE;YAEO,cAAcpwB,CAAAA,EAAaV,CAAAA,EAAeE,CAAAA,EAAgB1G,CAAAA,EAAc43B,CAAAA,EAAgBC,CAAAA,EAAAA;gBAC7FxrC,IAAAA,CAAK6f,IAAAA,CAAwB,gBAAgBhF,GAAKV,GAAOE,GAAQ1G,GAAO43B,GAAQC;YAClF;YAEO,WAAW3wB,CAAAA,EAAa+wB,CAAAA,EAAgBj4B,CAAAA,EAAc43B,CAAAA,EAAgBN,CAAAA,EAAAA;gBAC3EjrC,IAAAA,CAAK6f,IAAAA,CAAqB,aAAahF,GAAK+wB,GAAQj4B,GAAO43B,GAAQN;YACrE;YAIO,OAAA1iB;gBACLvoB,IAAAA,CAAK6yC,UAAAA,CAAWtqB,IAAAA,IAChBvoB,IAAAA,CAAKytD,MAAAA,CAAOllC,IAAAA;YACd;YAEO,UAAAC;gBACLxoB,IAAAA,CAAK6yC,UAAAA,CAAWrqB,OAAAA,IAChBxoB,IAAAA,CAAKytD,MAAAA,CAAOjlC,OAAAA;YACd;YAEO,UAAUlc,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC1BpK,IAAAA,CAAK6yC,UAAAA,CAAWl2B,SAAAA,CAAU3c,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiB94B,CAAAA,IAAIg5B,EAAAA,IAAoBh5B,GAAGtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBh7B,CAAAA,IAAIk7B,EAAAA,IAAoBl7B;YAC3H;YAEO,OAAO6C,CAAAA,EAAAA;gBACZjN,IAAAA,CAAK6yC,UAAAA,CAAWhhC,MAAAA,CAAO5E;YACzB;YAEO,MAAMX,CAAAA,EAAWlC,CAAAA,EAAAA;gBACtBpK,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM3D,GAAGlC;YAC3B;YAEO,UAAU4S,CAAAA,EAAAA;gBACfhd,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA,GAAU1L;YAC5B;YAEO,eAAA0nB;gBACL,OAAO1kC,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OACzB;YAAA;YAEO,SAAS1C,CAAAA,EAAAA;gBACdhmB,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA,CAAQhV,QAAAA,CAASsS,GAAGhmB,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA;YACtD;YAEO,iBAAiBgd,CAAAA,EAAAA;gBACtB1lC,IAAAA,CAAKuuD,eAAAA,CAAgB5uD,IAAAA,CAAK+lC,IAC1BA,EAAc9C,UAAAA,CAAW5iC,IAAAA,CAAKstC,IAAAA;YAChC;YAEO,oBAAoB5H,CAAAA,EAAAA;gBACzB,MAAMl6B,IAAQxL,IAAAA,CAAKuuD,eAAAA,CAAgB9lD,OAAAA,CAAQi9B;gBAAAA,OACvCl6B,KACFxL,IAAAA,CAAKuuD,eAAAA,CAAgB7lD,MAAAA,CAAO8C,GAAO;YAEvC;YAEO,sBAAA0lD;gBACLlxD,IAAAA,CAAKuuD,eAAAA,CAAgBjuD,MAAAA,GAAS;YAChC;YAGO,qBAAqBw2C,CAAAA,EAAAA;gBAC1B,KAAK,MAAMpR,KAAiB1lC,IAAAA,CAAKuuD,eAAAA,CAAiB;oBAChD,MAAMryB,IAASwJ,EAAcC,SAAAA;oBAC7BzJ,EAAO3E,GAAAA;oBACP,MAAMqF,IAAWV,EAAO+B,WAAAA;oBACxBj+B,IAAAA,CAAK4uD,uBAAAA,IAA2B9X,GAE5Bla,EAASw0B,IAAAA,CAAMC,CAAAA,IAAiB,gBAAXA,EAAE5iC,IAAAA,KACzByN,EAAOyD,eAAAA,CAAgB,aAAa3/B,IAAAA,CAAK4uD,uBAAAA,GAEvChyB,EAASw0B,IAAAA,CAAMC,CAAAA,IAAiB,mBAAXA,EAAE5iC,IAAAA,KACzByN,EAAOyD,eAAAA,CAAgB,gBAAgBmX,IAErCla,EAASw0B,IAAAA,CAAMC,CAAAA,IAAiB,mBAAXA,EAAE5iC,IAAAA,KACzByN,EAAO6D,qBAAAA,CAAsB,gBAAgBrxB,EAAI1O,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,IAGhEqrB,EAAc4rB,QAAAA,IAChB5rB,EAAc4rB,QAAAA,CAASxa;gBAE3B;YACF;YAEA,IAAA,SAAoB/tB,CAAAA,EAAAA;gBAClB/oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAAAA,GAAWA;YACjC;YAEA,IAAA,WAAWA;gBACT,OAAO/oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAC7B;YAAA;YAOO,eAAe9P,CAAAA,EAAAA;gBAEpB,OADiB,IAAI0zB,GAAS;oBAAA,GAAK1zB,CAAAA;oBAAS2zB,iBAAiB5sC,IAAAA;gBAAAA;YAE/D;YAEO,aAAaiZ,CAAAA,EAAAA;gBAClB,MAAMkV,IAAKnuB,IAAAA,CAAKstC,IAAAA,EAAAA,EACV,cAAExQ,CAAAA,EAAY,gBAAEC,CAAAA,EAAAA,GAAmB9jB,GACnCijB,IAAS,IAAIO,GAAO;oBACxBtO,IAAAA;oBACA2O,cAAAA;oBACAC,gBAAAA;gBAAAA;gBAGF,OADAb,EAAOuB,OAAAA,IACAvB;YACT;YAEA,QAAA10B;gBACE,MAAM2mB,IAAKnuB,IAAAA,CAAKstC,IAAAA;gBACMttC,CAAAA,IAAAA,CAAKyuD,uBAAAA,GAA0BzuD,IAAAA,CAAKowD,WAAAA,GAAcpwD,IAAAA,CAAKmwD,aAAAA,AAAAA,EAC/D54B,GAAAA,IACdpJ,EAAGohC,UAAAA,CAAWvvD,IAAAA,CAAKwuD,eAAAA,CAAgBvrD,CAAAA,GAAI,KAAKjD,IAAAA,CAAKwuD,eAAAA,CAAgBn8C,CAAAA,GAAI,KAAKrS,IAAAA,CAAKwuD,eAAAA,CAAgBl8C,CAAAA,GAAI,KAAKtS,IAAAA,CAAKwuD,eAAAA,CAAgBpsD,CAAAA,GAG7H+rB,EAAG3mB,KAAAA,CAAM2mB,EAAG8L,gBAAAA;YACd;YAKA,QAAAwK;gBAAAA,IAAAA;gBACE,IAAIzkC,IAAAA,CAAK0uD,cAAAA,EAEP,OAAA,KADA1uD,IAAAA,CAAK6sB,OAAAA,CAAQrU,SAAAA,CAAU;gBAKzB,IAAIg5C,IAAgBxxD,IAAAA,CAAKyuD,uBAAAA,GAA0BzuD,IAAAA,CAAKowD,WAAAA,GAAcpwD,IAAAA,CAAKmwD,aAAAA;gBAG3E,IAFAqB,EAAcj6B,GAAAA,IAEVv3B,IAAAA,CAAKkuD,cAAAA,EAAgB;oBAEvB,IAAK,IAAI1tD,IAAIR,IAAAA,CAAKouD,cAAAA,EAAgB5tD,IAAIR,IAAAA,CAAKquD,UAAAA,CAAW/tD,MAAAA,EAAQE,IAC5DR,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,GAAK;oBAIvB,MAAMixD,IAAe,IAAInjC;oBACzB,KAAK,MAAA,CAAOG,EAAAA,IAASzuB,IAAAA,CAAK8tD,UAAAA,CAAY;wBACpC,IAAI4D,IAAa;wBACjB,IAAKA,IAAa,GAAGA,IAAa1xD,IAAAA,CAAKouD,cAAAA,IACjCpuD,IAAAA,CAAKquD,UAAAA,CAAWqD,EAAAA,CAAYjlB,QAAAA,KAAahe,GADQijC;wBAKvDD,EAAazmC,GAAAA,CAAIyD,GAAMijC;oBACzB;oBAEA1xD,IAAAA,CAAKquD,UAAAA,CAAWsD,IAAAA,CAAK,CAACvvD,GAAGkQ;wBACvB,IAAU,SAANlQ,KAAoB,SAANkQ,GAChB,OAAO;wBAET,MAAMuH,IAASzX,EAAEymB,CAAAA,GAAIvW,EAAEuW,CAAAA,EACjB+oC,IAAoBH,EAAa9uD,GAAAA,CAAIP,EAAEqqC,QAAAA,IAAaglB,EAAa9uD,GAAAA,CAAI2P,EAAEm6B,QAAAA,GACvE1I,IAAW3hC,EAAE2hC,QAAAA,GAAWzxB,EAAEyxB,QAAAA;wBAChC,OAAe,MAAXlqB,IAEe,MAAbkqB,IAEK6tB,IAEF7tB,IAEFlqB;oBAAM;oBAGf,MAAMg4C,IAAe7xD,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA,EAC/BopC,IAAW9xD,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA;oBAE7B,IAAI1oB,IAAAA,CAAKquD,UAAAA,CAAW/tD,MAAAA,IAAUN,IAAAA,CAAKouD,cAAAA,EAAgB;wBACjD,IAAI2D,IAAsB/xD,IAAAA,CAAKquD,UAAAA,CAAW,EAAA,CAAG5hB,QAAAA,EACzCulB,IAAkBhyD,IAAAA,CAAK2C,GAAAA,CAAIovD;wBAC/B,IAAK,IAAIvxD,IAAI,GAAGA,IAAIR,IAAAA,CAAKouD,cAAAA,EAAgB5tD,IAEvCR,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA,GAAU1oB,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,CAAGuc,SAAAA,EAC7C/c,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,GAAU1oB,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,CAAGksC,KAAAA,EAErC1sC,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,CAAGisC,QAAAA,KAAaslB,KAElCC,CAAAA,EAAiBvtB,KAAAA,IACjBstB,IAAsB/xD,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,CAAGisC,QAAAA,EACzCulB,IAAkBhyD,IAAAA,CAAK2C,GAAAA,CAAIovD,EAAAA,GAIzBC,aAA2B7jB,MAAiC,CAAA,SAAb,CAAA,IAAAnuC,IAAAA,CAAK+oB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEykB,oBAAAA,AAAAA,KAChEgkB,CAAAA,EAAct3B,aAAAA,CAAcl6B,IAAAA,CAAK6uC,qBAAAA,GACjC2iB,EAAcj6B,GAAAA,EAAAA,GAGhBy6B,EAAiBnyC,IAAAA,IAAQ7f,IAAAA,CAAKquD,UAAAA,CAAW7tD,EAAAA,CAAGkX,IAAAA;wBAE1Cs6C,EAAiBntB,eAAAA,MACnBmtB,EAAiBvtB,KAAAA;oBAErB;oBAGAzkC,IAAAA,CAAK6yC,UAAAA,CAAWnqB,OAAAA,GAAUmpC,GAC1B7xD,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,GAAUopC,GAGtB9xD,IAAAA,CAAKmuD,aAAAA,CAAc9hB,IAAAA,IACnBrsC,IAAAA,CAAKouD,cAAAA,GAAiB,GACtBpuD,IAAAA,CAAKonC,cAAAA,CAAe5/B,KAAAA,IACpBxH,IAAAA,CAAKmnC,aAAAA,CAAc3/B,KAAAA;gBACrB,OAEE,KAAK,MAAMilC,KAAYzsC,IAAAA,CAAK8tD,UAAAA,CAAW5G,MAAAA,GACjCza,EAAS5H,eAAAA,MACX4H,EAAShI,KAAAA;gBAKf+sB,EAAcprD,OAAAA,IAGVpG,IAAAA,CAAKuuD,eAAAA,CAAgBjuD,MAAAA,GAAS,KAChCkxD,EAAc/3B,cAAAA,GAAiBlC,GAAAA;gBAIjC,IAAK,IAAI/2B,IAAI,GAAGA,IAAIR,IAAAA,CAAKuuD,eAAAA,CAAgBjuD,MAAAA,EAAQE,IAC/CgxD,IAAgBxxD,IAAAA,CAAKsuD,mBAAAA,CAAoB9tD,IAAI,EAAA,EAC7CR,IAAAA,CAAKsuD,mBAAAA,CAAoB9tD,IAAI,EAAA,CAAG+2B,GAAAA,IAChCv3B,IAAAA,CAAKkwD,eAAAA,CAAgBzqB,uBAAAA,CAAwBzlC,IAAAA,CAAKuuD,eAAAA,CAAgB/tD,EAAAA,GAClER,IAAAA,CAAKsuD,mBAAAA,CAAoB9tD,IAAI,EAAA,CAAGi5B,cAAAA,GAAiBlC,GAAAA;gBAInDi6B,EAAc73B,YAAAA;YAChB;QAAA;QCnxBF,MAAM,KAAmB;QAEzB,MAAMs4B;YAEJ,YAAoB/U,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,GAAAA,GAAAA,GADZ,IAAA,CAAAkQ,UAAAA,GAAa,IAAIt2B;YACmC;YAQ5D,SAASxqB,CAAAA,EAAWlC,CAAAA,EAAW+P,CAAAA,EAAeE,CAAAA,EAAAA;gBAC5Cra,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM3pC,IAAAA,IACfvoB,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM9Y,WAAAA,GAAc,OAC7Bp5C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMC,UAAAA,CACbnyD,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiB94B,CAAAA,IAAI,EAAA,IAAoBA,GAClDtM,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBh7B,CAAAA,IAAI,EAAA,IAAoBA,GAClDpK,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBjrB,CAAAA,IAAQ,EAAA,IAAoBA,GACtDna,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiB/qB,CAAAA,IAAS,EAAA,IAAoBA,IAEzDra,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM1pC,OAAAA;YACjB;YAEA,SAASxjB,CAAAA,EAAeu/B,CAAAA,EAAa+oB,IAAmC;gBAAE35C,OAAOvB,EAAMyC,KAAAA;YAAAA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACrF7U,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM3pC,IAAAA,IACfvoB,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMlY,SAAAA,IACfh6C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM9Y,WAAAA,GAA2C,SAA7B,CAAA,IAAiB,SAAjB,CAAA,IAAAkU,EAAY35C,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE5T,QAAAA,EAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,IAC9DC,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMjY,MAAAA,CACbj6C,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBpgC,CAAAA,EAAMsH,CAAAA,GAAI,EAAA,IAAoBtH,EAAMsH,CAAAA,EAC9DtM,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBpgC,CAAAA,EAAMoF,CAAAA,GAAI,EAAA,IAAoBpF,EAAMoF,CAAAA,GAEhEpK,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMhY,MAAAA,CACbl6C,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBb,CAAAA,EAAIj4B,CAAAA,GAAI,EAAA,IAAoBi4B,EAAIj4B,CAAAA,EAC1DtM,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBb,CAAAA,EAAIn6B,CAAAA,GAAI,EAAA,IAAoBm6B,EAAIn6B,CAAAA,GAE5DpK,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMla,SAAAA,GAAY,GAC3Bh4C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM3mB,MAAAA,IACfvrC,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM/X,SAAAA,IACfn6C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM1pC,OAAAA;YACjB;YAEA,UAAU5L,CAAAA,EAAe2wC,IAAqC;gBAAE55C,OAAOvB,EAAMyC,KAAAA;gBAAO/E,MAAM;YAAA,CAAA,EAAA;gBACxF9P,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM3pC,IAAAA,IACfvoB,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMlY,SAAAA,IACfh6C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAMt9C,SAAAA,GAAY24C,EAAa55C,KAAAA,CAAM5T,QAAAA,IAC9CC,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM9X,GAAAA,CACbp6C,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBxoB,CAAAA,EAAMtQ,CAAAA,GAAI,EAAA,IAAoBsQ,EAAMtQ,CAAAA,EAC9DtM,IAAAA,CAAKk9C,GAAAA,CAAI9X,WAAAA,GAAAA,CAAAA,CAAiBxoB,CAAAA,EAAMxS,CAAAA,GAAI,EAAA,IAAoBwS,EAAMxS,CAAAA,EAC9DmjD,EAAaz9C,IAAAA,EACb,GACU,IAAVxK,KAAK8G,EAAAA,GAEPpM,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM5X,IAAAA,IACft6C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM/X,SAAAA,IACfn6C,IAAAA,CAAKk9C,GAAAA,CAAIgV,KAAAA,CAAM1pC,OAAAA;YACjB;YAEA,SAASoL,CAAAA,EAAc/Y,CAAAA,EAAAA;gBACrB7a,IAAAA,CAAKotD,UAAAA,CAAWj2B,KAAAA,CAAMn3B,IAAAA,CAAKk9C,GAAAA,EAAKtpB,GAAM/Y;YACxC;QAAA;QAOK,MAAMu3C;YAMX,IAAA,QAAWj4C;gBACT,OAAOna,IAAAA,CAAKkyD,KAAAA,CAAM54C,MAAAA,CAAOa,KAC3B;YAAA;YAEA,IAAA,SAAWE;gBACT,OAAOra,IAAAA,CAAKkyD,KAAAA,CAAM54C,MAAAA,CAAOe,MAC3B;YAAA;YAgBA,IAAA,UAAWuO;gBACT,OAAO5oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQE,OAC7B;YAAA;YAEA,IAAA,QAAmBxlB,CAAAA,EAAAA;gBACjBpD,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQE,OAAAA,GAAUxlB;YAChC;YAEA,IAAA,OAAW0lB;gBACT,OAAO9oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQI,IAC7B;YAAA;YAEA,IAAA,KAAgBnV,CAAAA,EAAAA;gBACd3T,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQI,IAAAA,GAAOnV;YAC7B;YAIA,IAAA,YAAWokC;gBACT,OAAO/3C,IAAAA,CAAKkyD,KAAAA,CAAMjZ,qBACpB;YAAA;YAEA,IAAA,UAAqB71C,CAAAA,EAAAA;gBACnBpD,IAAAA,CAAKkyD,KAAAA,CAAMjZ,qBAAAA,GAAwB71C;YACrC;YAEA,YAAY6V,CAAAA,CAAAA;gBArCI,IAAA,CAAAi1C,cAAAA,GAAAA,CAA0B,GAKnC,IAAA,CAAArlC,CAAAA,GAAY,GAEZ,IAAA,CAAA2lC,eAAAA,GAAyBp8C,EAAM+D,aAAAA,EAE9B,IAAA,CAAAs3C,MAAAA,GAAS,IAAIzkC,GAkBd,IAAA,CAAAoc,WAAAA,GAAAA,CAAuB,GA2I9B,IAAA,CAAAptB,KAAAA,GAAQ,IAAIi6C,GAAsCjyD,IAAAA;gBAhIhD,MAAA,EAAM,eAAE6uD,CAAAA,EAAa,SAAExqB,CAAAA,EAAO,oBAAEyqB,CAAAA,EAAkB,aAAE1pB,CAAAA,EAAa2pB,cAAchX,CAAAA,EAAS,iBAAEyW,CAAAA,EAAAA,GAAoBv1C;gBAM9G,IALAjZ,IAAAA,CAAKkyD,KAAAA,GACH7tB,QAAAA,IAAAA,IACCwqB,EAAcn1C,UAAAA,CAAW,MAAM;oBAC9B01C,OAAON,QAAAA,KAAAA;gBAAAA,IAAAA,CAEN9uD,IAAAA,CAAKkyD,KAAAA,EACR,MAAM,IAAI/rD,MAAM;gBAElBnG,IAAAA,CAAKwuD,eAAAA,GAAkBA,QAAAA,IAAAA,IAAmBxuD,IAAAA,CAAKwuD,eAAAA,EAC/CxuD,IAAAA,CAAKolC,WAAAA,GAAcA,QAAAA,IAAAA,IAAeplC,IAAAA,CAAKolC,WAAAA,EACvCplC,IAAAA,CAAK+3C,SAAAA,GAAYA,QAAAA,IAAAA,IAAa/3C,IAAAA,CAAK+3C,SACrC;YAAA;YAEO,iBAAAsE;gBACLr8C,IAAAA,CAAKkyD,KAAAA,CAAM7V,cAAAA;YACb;YAEO,eAAegW,CAAAA,EAAAA,CAEtB;YA4BA,UACE1lC,CAAAA,EACAlK,CAAAA,EACAC,CAAAA,EACAymB,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAEA,IAAe,MAAXL,KAA4B,MAAZC,GAClB;gBACK,IAAe,MAAXG,KAA4B,MAAZC,GACzB;gBACK,IAAoB,MAAhB7c,EAAMxS,KAAAA,IAAgC,MAAjBwS,EAAMtS,MAAAA,EACpC;gBAGFra,IAAAA,CAAKkyD,KAAAA,CAAMI,WAAAA,GAActyD,IAAAA,CAAK4oB,OAAAA;gBAC9B,MAAMlR,IAAO;oBAACiV;oBAAOlK;oBAAIC;oBAAIymB;oBAAQC;oBAASC;oBAAIC;oBAAIC;oBAAQC;iBAAAA,CAC3DxhC,MAAAA,CAAQ5F,CAAAA,IAAAA,KAAYtB,MAANsB,GACdnC,GAAAA,CAAKmC,CAAAA,IAAoB,YAAA,OAANA,KAAkBpC,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAgBhjC,IAAIA;gBACjEpC,IAAAA,CAAKkyD,KAAAA,CAAM1kC,SAAAA,CAAUzU,KAAAA,CAAM/Y,IAAAA,CAAKkyD,KAAAA,EAAOx6C,IACvCisB,GAAoBC,aAAAA,IACpBD,GAAoBE,gBAAAA,GAAmB;YACzC;YAEO,SAAS7+B,CAAAA,EAAeu/B,CAAAA,EAAa5wB,CAAAA,EAAcs3B,IAAY,CAAA,EAAA;gBACpEjrC,IAAAA,CAAKkyD,KAAAA,CAAM3pC,IAAAA,IACXvoB,IAAAA,CAAKkyD,KAAAA,CAAMlY,SAAAA,IACXh6C,IAAAA,CAAKkyD,KAAAA,CAAM9Y,WAAAA,GAAczlC,EAAM5T,QAAAA,IAC/BC,IAAAA,CAAKkyD,KAAAA,CAAMjY,MAAAA,CACTj6C,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBpgC,CAAAA,EAAMsH,CAAAA,GAAI,EAAA,IAAoBtH,EAAMsH,CAAAA,EAC1DtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBpgC,CAAAA,EAAMoF,CAAAA,GAAI,EAAA,IAAoBpF,EAAMoF,CAAAA,GAE5DpK,IAAAA,CAAKkyD,KAAAA,CAAMhY,MAAAA,CAAOl6C,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBb,CAAAA,EAAIj4B,CAAAA,GAAI,EAAA,IAAoBi4B,EAAIj4B,CAAAA,EAAGtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBb,CAAAA,EAAIn6B,CAAAA,GAAI,EAAA,IAAoBm6B,EAAIn6B,CAAAA,GACjIpK,IAAAA,CAAKkyD,KAAAA,CAAMla,SAAAA,GAAY/M,GACvBjrC,IAAAA,CAAKkyD,KAAAA,CAAM3mB,MAAAA,IACXvrC,IAAAA,CAAKkyD,KAAAA,CAAM/X,SAAAA,IACXn6C,IAAAA,CAAKkyD,KAAAA,CAAM1pC,OAAAA;YACb;YAEO,cAAc3N,CAAAA,EAAaV,CAAAA,EAAeE,CAAAA,EAAgB1G,CAAAA,EAAAA;gBAC/D3T,IAAAA,CAAKkyD,KAAAA,CAAM3pC,IAAAA,IACXvoB,IAAAA,CAAKkyD,KAAAA,CAAMt9C,SAAAA,GAAYjB,EAAM5T,QAAAA,IAC7BC,IAAAA,CAAKkyD,KAAAA,CAAMK,QAAAA,CACTvyD,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBvqB,CAAAA,EAAIvO,CAAAA,GAAI,EAAA,IAAoBuO,EAAIvO,CAAAA,EACtDtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBvqB,CAAAA,EAAIzQ,CAAAA,GAAI,EAAA,IAAoByQ,EAAIzQ,CAAAA,EACtDpK,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBjrB,CAAAA,IAAQ,EAAA,IAAoBA,GAClDna,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiB/qB,CAAAA,IAAS,EAAA,IAAoBA,IAErDra,IAAAA,CAAKkyD,KAAAA,CAAM1pC,OAAAA;YACb;YAEO,WAAW3N,CAAAA,EAAa+wB,CAAAA,EAAgBj4B,CAAAA,EAAc43B,CAAAA,EAAgBN,CAAAA,EAAAA;gBAC3EjrC,IAAAA,CAAKkyD,KAAAA,CAAM3pC,IAAAA,IACXvoB,IAAAA,CAAKkyD,KAAAA,CAAMlY,SAAAA,IACPzO,KACFvrC,CAAAA,IAAAA,CAAKkyD,KAAAA,CAAM9Y,WAAAA,GAAc7N,EAAOxrC,QAAAA,EAAAA,GAE9BkrC,KACFjrC,CAAAA,IAAAA,CAAKkyD,KAAAA,CAAMla,SAAAA,GAAY/M,CAAAA,GAEzBjrC,IAAAA,CAAKkyD,KAAAA,CAAMt9C,SAAAA,GAAYjB,EAAM5T,QAAAA,IAC7BC,IAAAA,CAAKkyD,KAAAA,CAAM9X,GAAAA,CACTp6C,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBvqB,CAAAA,EAAIvO,CAAAA,GAAI,EAAA,IAAoBuO,EAAIvO,CAAAA,EACtDtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBvqB,CAAAA,EAAIzQ,CAAAA,GAAI,EAAA,IAAoByQ,EAAIzQ,CAAAA,EACtDwhC,GACA,GACU,IAAVtmC,KAAK8G,EAAAA,GAEPpM,IAAAA,CAAKkyD,KAAAA,CAAM5X,IAAAA,IACP/O,KACFvrC,IAAAA,CAAKkyD,KAAAA,CAAM3mB,MAAAA,IAEbvrC,IAAAA,CAAKkyD,KAAAA,CAAM/X,SAAAA,IACXn6C,IAAAA,CAAKkyD,KAAAA,CAAM1pC,OAAAA;YACb;YAOA,OAAAD;gBACEvoB,IAAAA,CAAKkyD,KAAAA,CAAM3pC,IAAAA,IACXvoB,IAAAA,CAAKytD,MAAAA,CAAOllC,IAAAA;YACd;YAKA,UAAAC;gBACExoB,IAAAA,CAAKkyD,KAAAA,CAAM1pC,OAAAA,IACXxoB,IAAAA,CAAKytD,MAAAA,CAAOjlC,OAAAA;YACd;YAOA,UAAUlc,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnBpK,IAAAA,CAAKkyD,KAAAA,CAAMv1C,SAAAA,CAAU3c,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiB94B,CAAAA,IAAI,EAAA,IAAoBA,GAAGtM,IAAAA,CAAKolC,WAAAA,GAAAA,CAAAA,CAAiBh7B,CAAAA,IAAI,EAAA,IAAoBA;YACtH;YAKA,OAAO6C,CAAAA,EAAAA;gBACLjN,IAAAA,CAAKkyD,KAAAA,CAAMrgD,MAAAA,CAAO5E;YACpB;YAOA,MAAMX,CAAAA,EAAWlC,CAAAA,EAAAA;gBACfpK,IAAAA,CAAKkyD,KAAAA,CAAMjiD,KAAAA,CAAM3D,GAAGlC;YACtB;YAEO,eAAAs6B;gBACL,MAAM,IAAIv+B,MAAM;YAClB;YAEO,SAASkD,CAAAA,EAAAA;gBACdrJ,IAAAA,CAAKkyD,KAAAA,CAAM3gB,YAAAA,CAAavxC,IAAAA,CAAKkyD,KAAAA,CAAMxtB,YAAAA,GAAehxB,QAAAA,CAASrK,EAAG+Y,WAAAA;YAChE;YAEO,iBAAiBowC,CAAAA,EAAAA,CAExB;YAEO,oBAAoBA,CAAAA,EAAAA,CAE3B;YAEO,sBAAAtB,CAEP;YAEO,qBAAqBpa,CAAAA,EAAAA,CAE5B;YAEO,qBAAA4Z,CAEP;YAEO,mBAAAC,CAEP;YAEA,IAAA,SAAoB5nC,CAAAA,EAAAA;gBAClB/oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAAAA,GAAWA;YACjC;YAEA,IAAA,WAAWA;gBACT,OAAO/oB,IAAAA,CAAKytD,MAAAA,CAAO/kC,OAAAA,CAAQK,QAC7B;YAAA;YAEO,eAAe9P,CAAAA,EAAAA;gBAEpB,OAAO;YACT;YAEA,QAAAzR;gBAEExH,IAAAA,CAAKkyD,KAAAA,CAAMt3C,SAAAA,CAAU,GAAG,GAAG5a,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,GAC5Cra,IAAAA,CAAKkyD,KAAAA,CAAMt9C,SAAAA,GAAY5U,IAAAA,CAAKwuD,eAAAA,CAAgBzuD,QAAAA,IAC5CC,IAAAA,CAAKkyD,KAAAA,CAAMK,QAAAA,CAAS,GAAG,GAAGvyD,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,GAC3CspB,GAAoBn8B,KAAAA;YACtB;YAKA,QAAAi9B,CAEA;YAEA,UAAArV;gBACEpvB,IAAAA,CAAKkyD,KAAAA,GAAAA,KAAQpxD;YACf;QAAA;QCvWF,IAAY2xD;QAAAA,CAAZ,SAAYA,CAAAA;YAIV,EAAA,KAAA,GAAA,SAOA,EAAA,mBAAA,GAAA,uBAOA,EAAA,gBAAA,GAAA,oBASA,EAAA,mBAAA,GAAA,uBASA,EAAA,gBAAA,GAAA,oBA2BA,EAAA,SAAA,GAAA,aAMA,EAAA,UAAA,GAAA,cAKA,EAAA,YAAA,GAAA,gBAKA,EAAA,aAAA,GAAA;QACD,EAhFWA,MAAAA,CAAAA,KAAW,CAAA,CAAA;QAsFhB,MAAMC;YAEJ,WAAA,OAAWC;gBAChB,OAAO;oBAAEx4C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,WAAWu4C;gBAChB,OAAO;oBAAEz4C,OAAO;oBAAME,QAAQ;gBAAA;YAChC;YAGO,WAAA,YAAWw4C;gBAChB,OAAO;oBAAE14C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,UAAWy4C;gBAChB,OAAO;oBAAE34C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,iBAAW04C;gBAChB,OAAO;oBAAE54C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,aAAW24C;gBAChB,OAAO;oBAAE74C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,MAAW44C;gBAChB,OAAO;oBAAE94C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;YAGO,WAAA,OAAW64C;gBAChB,OAAO;oBAAE/4C,OAAO;oBAAKE,QAAQ;gBAAA;YAC/B;QAAA;QAiHK,MAAM84C,KAAe;YAC1BC,cAAc;YACdC,kBAAkB;YAClBC,kBAAkB;QAAA;QAMb,MAAMC;YAwBX,YAAYt6C,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAnBL,IAAA,CAAAiB,MAAAA,GAAS,IAAIhT,GAEZ,IAAA,CAAAssD,aAAAA,GAAAA,CAAyB,GACzB,IAAA,CAAAC,qBAAAA,GAA8C,QAK9C,IAAA,CAAAC,gBAAAA,GAAiC,EAAA,EAEjC,IAAA,CAAAC,cAAAA,GAAsC,EAAA,EACtC,IAAA,CAAAC,mBAAAA,GAAqC,MAErC,IAAA,CAAAC,aAAAA,GAAAA,CAAgB,GAEhB,IAAA,CAAAC,WAAAA,GAAAA,CAAc,GACd,IAAA,CAAAjnC,OAAAA,GAAUjW,EAAOS,WAAAA,IA4DjB,IAAA,CAAA08C,wBAAAA,GAA2B;oBAC7B/zD,IAAAA,CAAK8zD,WAAAA,IAGT9zD,CAAAA,IAAAA,CAAK6zD,aAAAA,GAAAA,CAAiB7zD,IAAAA,CAAK6zD,aAAAA,EAC3B7zD,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,qBAAqBhY,IAAAA,CAAK6zD,aAAAA,GAC7C7zD,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc;wBAC7B6rD,YAAYh0D,IAAAA,CAAKi0D,YAAAA;oBAAAA,EAAAA;gBACe,GAG5B,IAAA,CAAAC,wBAAAA,GAA2B;oBAC7Bl0D,IAAAA,CAAK8zD,WAAAA,IAGT9zD,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,sBAAsBxU,OAAOqB,gBAAAA,GAChD7E,IAAAA,CAAKm0D,oBAAAA,IACLn0D,IAAAA,CAAKo0D,iBAAAA,GAAoBp0D,IAAAA,CAAKq0D,0BAAAA,IAC9Br0D,IAAAA,CAAKs0D,0BAAAA,IAELt0D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc;wBAC7BosD,YAAYv0D,IAAAA,CAAKu0D,UAAAA;oBAAAA,EAAAA;gBACe,GAG5B,IAAA,CAAAC,cAAAA,GAAiB;oBACvB,IAAIx0D,IAAAA,CAAK8zD,WAAAA,EACP;oBAEF,MAAM5jB,IAASlwC,IAAAA,CAAKkwC,MAAAA;oBACpBlwC,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,sBACnBhY,IAAAA,CAAKy0D,sCAAAA,CAAuCvkB,IAC5ClwC,IAAAA,CAAKs0D,0BAAAA,IAGLt0D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;wBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;wBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;oBAAAA;gBACa,GAcxB,IAAA,CAAAg6B,iBAAAA,GAAoBp0D,IAAAA,CAAKq0D,0BAAAA,IA8hBzB,IAAA,CAAAK,YAAAA,GAA4B,IAAIp5C,GAChC,IAAA,CAAAq5C,WAAAA,GAA2B,IAAIr5C,GA3oBrCtb,IAAAA,CAAKo6B,QAAAA,GAAWnhB,EAAQmhB,QAAAA,EACxBp6B,IAAAA,CAAKoa,UAAAA,GAA+B,SAAlB,CAAA,IAAAnB,EAAQmB,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI;oBAAA,GAAKpa,IAAAA,CAAKo6B,QAAAA;gBAAAA,GAClDp6B,IAAAA,CAAK40D,kBAAAA,GAAqB50D,IAAAA,CAAKoa,UAAAA,EAC/Bpa,IAAAA,CAAK60D,YAAAA,GAAkC,SAAnB,CAAA,IAAA57C,EAAQ67C,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIrC,GAAYsC,KAAAA,EACvD/0D,IAAAA,CAAKg1D,OAAAA,GAAU/7C,EAAQK,MAAAA,EACvBtZ,IAAAA,CAAK4sC,eAAAA,GAAkB3zB,EAAQorB,OAAAA,EAC/BrkC,IAAAA,CAAKwzD,aAAAA,GAAoC,SAApB,CAAA,IAAAv6C,EAAQ81C,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI/uD,IAAAA,CAAKwzD,aAAAA,EAClDxzD,IAAAA,CAAKyzD,qBAAAA,GAAoD,SAA5B,CAAA,IAAAx6C,EAAQg8C,oBAAAA,AAAAA,KAAAA,KAAoB,MAAA,IAAA,IAAIj1D,IAAAA,CAAKyzD,qBAAAA,EAClEzzD,IAAAA,CAAKk1D,QAAAA,GAAWj8C,EAAQk8C,OAAAA,EACxBn1D,IAAAA,CAAK4zD,mBAAAA,GAAsB36C,EAAQs7C,UAAAA,EAEnCv0D,IAAAA,CAAKo1D,iBAAAA,IAELp1D,IAAAA,CAAKm0D,oBAAAA,IAELn0D,IAAAA,CAAKg1D,OAAAA,CAAQ3qC,gBAAAA,CAAiB,oBAAoBrqB,IAAAA,CAAK+zD,wBAAAA,GACvD/zD,IAAAA,CAAKs0D,0BAAAA;YACP;YAEQ,uBAAAH;gBACFn0D,IAAAA,CAAKq1D,eAAAA,IAAAA,CAAoBr1D,IAAAA,CAAKq1D,eAAAA,CAAgBhrC,gBAAAA,IAEhDrqB,IAAAA,CAAKq1D,eAAAA,CAAgBC,cAAAA,CAAet1D,IAAAA,CAAKk0D,wBAAAA,GAE3Cl0D,IAAAA,CAAKq1D,eAAAA,GAAkBr1D,IAAAA,CAAKk1D,QAAAA,CAAS1xD,MAAAA,CAAO+xD,eAAAA,CAAgBC,UAAAA,CAAW,CAAA,aAAA,EAAgBhyD,OAAOqB,gBAAAA,CAAAA,KAAAA,CAAAA,GAG1F7E,IAAAA,CAAKq1D,eAAAA,CAAgBhrC,gBAAAA,GACvBrqB,IAAAA,CAAKq1D,eAAAA,CAAgBhrC,gBAAAA,CAAiB,UAAUrqB,IAAAA,CAAKk0D,wBAAAA,EAA0B;oBAAEpsD,MAAAA,CAAM;gBAAA,KAEvF9H,IAAAA,CAAKq1D,eAAAA,CAAgBI,WAAAA,CAAYz1D,IAAAA,CAAKk0D,wBAAAA;YAE1C;YAEO,UAAA9kC;gBACApvB,IAAAA,CAAK8zD,WAAAA,IAER9zD,CAAAA,IAAAA,CAAK8zD,WAAAA,GAAAA,CAAc,GACnB9zD,IAAAA,CAAKka,MAAAA,CAAO1S,KAAAA,IACZxH,IAAAA,CAAKk1D,QAAAA,CAAS1xD,MAAAA,CAAOqE,GAAAA,CAAI,UAAU7H,IAAAA,CAAKw0D,cAAAA,GACxCx0D,IAAAA,CAAKk1D,QAAAA,CAAS1xD,MAAAA,CAAOgE,KAAAA,IACjBxH,IAAAA,CAAK01D,eAAAA,IACP11D,IAAAA,CAAK01D,eAAAA,CAAgBC,UAAAA,IAEvB31D,IAAAA,CAAKkwC,MAAAA,CAAO0lB,mBAAAA,CAAoB,UAAU51D,IAAAA,CAAKw0D,cAAAA,GAE3Cx0D,IAAAA,CAAKq1D,eAAAA,CAAgBO,mBAAAA,GACvB51D,IAAAA,CAAKq1D,eAAAA,CAAgBO,mBAAAA,CAAoB,UAAU51D,IAAAA,CAAKk0D,wBAAAA,IAExDl0D,IAAAA,CAAKq1D,eAAAA,CAAgBC,cAAAA,CAAet1D,IAAAA,CAAKk0D,wBAAAA,GAE3Cl0D,IAAAA,CAAKg1D,OAAAA,CAAQY,mBAAAA,CAAoB,oBAAoB51D,IAAAA,CAAK+zD,wBAAAA,GAC1D/zD,IAAAA,CAAKg1D,OAAAA,GAAU,IAAA;YAEnB;YA2CQ,6BAAAX;gBACN,IAAI7wD,OAAOqB,gBAAAA,GAAmB,GAC5B,OAAO;gBAKT,OAFyBrB,OAAOqB,gBAAAA,IAAoB;YAGtD;YAQA,IAAA,aAAW0vD;gBACT,OAAIv0D,IAAAA,CAAK4zD,mBAAAA,GACA5zD,IAAAA,CAAK4zD,mBAAAA,GAGP5zD,IAAAA,CAAKo0D,iBACd;YAAA;YAOA,IAAA,wBAAWyB;gBACT,IAAI71D,IAAAA,CAAKg1D,OAAAA,EAAS;oBAChB,MAAMc,IAAa91D,IAAAA,CAAK+1D,sBAAAA,CAAuBjoD,EAAOC,IAAAA;oBAGtD,OAFqB/N,IAAAA,CAAK+1D,sBAAAA,CAAuBrnD,EAAI,GAAG,IAAI6B,GAAAA,CAAIulD,GAC3BxpD,CAEvC;gBAAA;gBACE,OAAO;YAEX;YAOA,IAAA,qBAAW0pD;gBACT,OAAOh2D,IAAAA,CAAK4zD,mBACd;YAAA;YAEA,IAAA,mBAA8BxwD,CAAAA,EAAAA;gBAC5BpD,IAAAA,CAAK4zD,mBAAAA,GAAsBxwD;YAC7B;YAEA,IAAA,UAAW6yD;gBACT,OAA2B,MAApBj2D,IAAAA,CAAKu0D,UACd;YAAA;YAEA,IAAA,cAAWO;gBACT,OAAO90D,IAAAA,CAAK60D,YACd;YAAA;YAEA,IAAA,SAAWv7C;gBACT,OAAOtZ,IAAAA,CAAKg1D,OACd;YAAA;YAEA,IAAA,SAAW9kB;gBACT,OAAQlwC,IAAAA,CAAK80D,WAAAA;oBACX,KAAKrC,GAAYyD,aAAAA;oBACjB,KAAKzD,GAAY0D,YAAAA;oBACjB,KAAK1D,GAAY2D,mBAAAA;oBACjB,KAAK3D,GAAY4D,mBAAAA;wBACf,OAAOr2D,IAAAA,CAAKsZ,MAAAA,CAAOg9C,aAAAA,IAAiB/8C,SAASO,IAAAA;oBAC/C;wBACE,OAAOtW;gBAAAA;YAEb;YAEA,IAAA,aAAW4W;gBACT,OAAOpa,IAAAA,CAAKqyD,WACd;YAAA;YAEA,IAAA,WAAsBj4C,CAAAA,EAAAA;gBACpBpa,IAAAA,CAAKqyD,WAAAA,GAAcj4C;YACrB;YAKA,IAAA,WAAWggB;gBACT,OAAIp6B,IAAAA,CAAKu2D,SAAAA,GACAv2D,IAAAA,CAAKu2D,SAAAA,GAEPv2D,IAAAA,CAAKqyD,WACd;YAAA;YAEA,IAAA,SAAoBj4B,CAAAA,EAAAA;gBAClBp6B,IAAAA,CAAKu2D,SAAAA,GAAYn8B;YACnB;YAEA,IAAA,cAAWo8B;gBACT,OAAOx2D,IAAAA,CAAKqyD,WAAAA,CAAYl4C,KAAAA,GAAQna,IAAAA,CAAKqyD,WAAAA,CAAYh4C,MACnD;YAAA;YAEA,IAAA,cAAWo8C;gBACT,OAAOz2D,IAAAA,CAAKqyD,WAAAA,CAAYl4C,KAAAA,GAAQna,IAAAA,CAAKu0D,UACvC;YAAA;YAEA,IAAA,eAAWmC;gBACT,OAAO12D,IAAAA,CAAKqyD,WAAAA,CAAYh4C,MAAAA,GAASra,IAAAA,CAAKu0D,UACxC;YAAA;YAEO,iBAAiBqC,CAAAA,EAAAA;gBACtB52D,IAAAA,CAAK62D,OAAAA,GAAUD;YACjB;YAEO,4BAAAE;gBACL92D,IAAAA,CAAK0zD,gBAAAA,CAAiB/zD,IAAAA,CAAKK,IAAAA,CAAKoa,UAAAA,GAChCpa,IAAAA,CAAK2zD,cAAAA,CAAeh0D,IAAAA,CAAKK,IAAAA,CAAKo6B,QAAAA,GAE9Bp6B,IAAAA,CAAKoa,UAAAA,GAAa;oBAAA,GAAKpa,IAAAA,CAAKoa,UAAAA;gBAAAA,GAC5Bpa,IAAAA,CAAKo6B,QAAAA,GAAW;oBAAA,GAAKp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAC5B;YAEO,eAAA28B;gBACL,OAAO/2D,IAAAA,CAAK2zD,cAAAA,CAAe3zD,IAAAA,CAAK2zD,cAAAA,CAAerzD,MAAAA,GAAS,EAC1D;YAAA;YAEO,iBAAA02D;gBACL,OAAOh3D,IAAAA,CAAK0zD,gBAAAA,CAAiB1zD,IAAAA,CAAK0zD,gBAAAA,CAAiBpzD,MAAAA,GAAS,EAC9D;YAAA;YAEO,2BAAA22D;gBACDj3D,IAAAA,CAAK0zD,gBAAAA,CAAiBpzD,MAAAA,IAAUN,IAAAA,CAAK2zD,cAAAA,CAAerzD,MAAAA,IACtDN,CAAAA,IAAAA,CAAKoa,UAAAA,GAAapa,IAAAA,CAAK0zD,gBAAAA,CAAiBvrC,GAAAA,IACxCnoB,IAAAA,CAAKo6B,QAAAA,GAAWp6B,IAAAA,CAAK2zD,cAAAA,CAAexrC,GAAAA,EAAAA;YAExC;YAEO,6BAAAmsC;gBACL,IAAIt0D,IAAAA,CAAK4sC,eAAAA,YAA2BK,IAKlC;oBAAA,IAAA,CAJkCjtC,IAAAA,CAAK4sC,eAAAA,CAAgB+gB,0BAAAA,CAA2B;wBAChFxzC,OAAOna,IAAAA,CAAKy2D,WAAAA;wBACZp8C,QAAQra,IAAAA,CAAK02D,YAAAA;oBAAAA,MAGb12D,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,CAAA,qCAAA,EAAwCvY,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,CAAAA,CAAAA,EAASna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,CAAAA,mBAAAA,EAA4Bra,IAAAA,CAAKu0D,UAAAA,CAAAA,+QAAAA,CAAAA,GAAAA,CAO/Gv0D,IAAAA,CAAKg2D,kBAAAA,AAAAA,GAAoB;wBAC5B,IAAIkB,IAAoB5xD,KAAKC,GAAAA,CAAI,GAAGvF,IAAAA,CAAKu0D,UAAAA,GAAa,KAClD4C,IAAAA,CAAyB;wBAC7B,MAAOD,IAAoB,KAAA,CAAMC,GAAwB;4BACvDD,IAAoB5xD,KAAKC,GAAAA,CAAI,GAAG2xD,IAAoB;4BACpD,MAAM/8C,IAAQna,IAAAA,CAAKqyD,WAAAA,CAAYl4C,KAAAA,GAAQ+8C,GACjC78C,IAASra,IAAAA,CAAKqyD,WAAAA,CAAYh4C,MAAAA,GAAS68C;4BACzCC,IAAyBn3D,IAAAA,CAAK4sC,eAAAA,CAAgB+gB,0BAAAA,CAA2B;gCAAExzC,OAAAA;gCAAOE,QAAAA;4BAAAA;wBACpF;wBACAra,IAAAA,CAAKg2D,kBAAAA,GAAqBkB,GAC1Bl3D,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAET,CAAA,wFAAA,EAA8CvY,IAAAA,CAAKu0D,UAAAA,CAAAA,mOAAAA,CAAAA;oBAIzD;gBAAA;gBAIJv0D,IAAAA,CAAKg1D,OAAAA,CAAQ76C,KAAAA,GAAQna,IAAAA,CAAKy2D,WAAAA,EAC1Bz2D,IAAAA,CAAKg1D,OAAAA,CAAQ36C,MAAAA,GAASra,IAAAA,CAAK02D,YAAAA,EAEQ,WAA/B12D,IAAAA,CAAKyzD,qBAAAA,GACPzzD,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMy9C,cAAAA,GAAiB,SAEpCp3D,CAAAA,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMy9C,cAAAA,GAAiB,aAGM,OAAtCp3D,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMy9C,cAAAA,IACrBp3D,CAAAA,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMy9C,cAAAA,GAAiB,aAAA,CAAA;gBAIxC,MAAMC,IAAwC,cAA5Br3D,IAAAA,CAAKo6B,QAAAA,CAASi9B,SAAAA,GAA0B,MAAM,MAC1DC,IAA0C,cAA7Bt3D,IAAAA,CAAKo6B,QAAAA,CAASk9B,UAAAA,GAA2B,MAAM;gBAElEt3D,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMQ,KAAAA,GAAQna,IAAAA,CAAKo6B,QAAAA,CAASjgB,KAAAA,GAAQk9C,GACjDr3D,IAAAA,CAAKg1D,OAAAA,CAAQr7C,KAAAA,CAAMU,MAAAA,GAASra,IAAAA,CAAKo6B,QAAAA,CAAS/f,MAAAA,GAASi9C,GAGnDt3D,IAAAA,CAAK4sC,eAAAA,CAAgBikB,cAAAA,CAAe7wD,IAAAA,CAAKoa,UAAAA,GACzCpa,IAAAA,CAAK4sC,eAAAA,CAAgByP,cAAAA,IACrBr8C,IAAAA,CAAK4sC,eAAAA,CAAgBmL,SAAAA,GAAY/3C,IAAAA,CAAKwzD,aAAAA,EAClCxzD,IAAAA,CAAK4sC,eAAAA,YAA2BwlB,MAClCpyD,IAAAA,CAAK4sC,eAAAA,CAAgB38B,KAAAA,CAAMjQ,IAAAA,CAAKu0D,UAAAA,EAAYv0D,IAAAA,CAAKu0D,UAAAA,GAGnDh7C,SAASg+C,eAAAA,CAAgB59C,KAAAA,CAAM69C,WAAAA,CAAY,oBAAoBx3D,IAAAA,CAAK61D,qBAAAA,CAAsB91D,QAAAA;YAC5F;YAOA,IAAA,eAAWgvD;gBACT,OAAO/uD,IAAAA,CAAKwzD,aACd;YAAA;YAKA,IAAA,aAAwBiE,CAAAA,EAAAA;gBACtBz3D,IAAAA,CAAKwzD,aAAAA,GAAgBiE,GACrBz3D,IAAAA,CAAK4sC,eAAAA,CAAgBmL,SAAAA,GAAY/3C,IAAAA,CAAKwzD,aACxC;YAAA;YAMA,IAAA,eAAWkE;gBACT,OAAO13D,IAAAA,CAAK6zD,aACd;YAAA;YAKA,IAAA,eAAWI;gBACT,OAAOj0D,IAAAA,CAAK6zD,aACd;YAAA;YAUO,aAAa+D,CAAAA,EAAAA;gBAClB,OAAO53D,IAAAA,CAAK63D,eAAAA,CAAgBD;YAC9B;YASO,gBAAgBA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACrB,IAAIA,GAAW;oBACb,MAAME,IAAev+C,SAASw+C,cAAAA,CAAeH;oBAE7C,IAAA,AAAIE,CAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAcE,iBAAAA,AAAAA,KAAsBF,CAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAsBG,uBAAAA,AAAAA,GAAyB;wBAKrF,IAJKH,EAAaxvB,YAAAA,CAAa,6BAC7BwvB,CAAAA,EAAazlC,YAAAA,CAAa,0BAA0B,SACpDylC,EAAaztC,gBAAAA,CAAiB,oBAAoBrqB,IAAAA,CAAK+zD,wBAAAA,CAAAA,GAErD+D,EAAaE,iBAAAA,EACf,OAAuC,SAAhC,CAAA,IAAAF,EAAaE,iBAAAA,EAAAA,KAAAA,KAAmB,MAAA,IAAA,IAAIzzD,QAAQC,OAAAA;wBAC9C,IAAKszD,EAAqBG,uBAAAA,EAC/B,OAAsD,SAA9C,CAAA,IAAAH,EAAqBG,uBAAAA,EAAAA,KAAAA,KAAyB,MAAA,IAAA,IAAI1zD,QAAQC,OAAAA;oBAEtE;gBACF;gBACA,OAAA,AAAgB,CAAA,SAAZ,CAAA,IAAAxE,IAAAA,CAAKg1D,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAEgD,iBAAAA,AAAAA,IACwB,SAAjC,CAAA,IAAY,SAAZ,CAAA,IAAAh4D,IAAAA,CAAKg1D,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAEgD,iBAAAA,EAAAA,KAAAA,KAAmB,MAAA,IAAA,IAAIzzD,QAAQC,OAAAA,KAC1CxE,IAAAA,CAAKg1D,OAAAA,CAAgBiD,uBAAAA,GACuB,SAA9C,CAAA,IAAAj4D,IAAAA,CAAKg1D,OAAAA,CAAgBiD,uBAAAA,EAAAA,KAAAA,KAAyB,MAAA,IAAA,IAAI1zD,QAAQC,OAAAA,KAEpExE,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,uGACfhU,QAAQC,OAAAA,EAAAA;YACjB;YAMO,iBAAA0zD;gBACL,OAAOl4D,IAAAA,CAAKm4D,cAAAA;YACd;YAEO,iBAAAA;gBACL,OAAO5+C,SAAS4+C,cAAAA;YAClB;YAEQ,kBAAkB/9B,CAAAA,EAAAA;gBACxB,OAAO;oBACLjgB,OAA8B,cAAvBigB,EAASi9B,SAAAA,GAA0Br3D,IAAAA,CAAKsZ,MAAAA,CAAO++C,WAAAA,GAAcj+B,EAASjgB,KAAAA;oBAC7EE,QAAgC,cAAxB+f,EAASk9B,UAAAA,GAA2Bt3D,IAAAA,CAAKsZ,MAAAA,CAAOg/C,YAAAA,GAAel+B,EAAS/f,MAAAA;gBAAAA;YAEpF;YAWO,wBAAwBuC,CAAAA,EAAAA;gBAC7B,IAAIgzB,IAAOhzB,EAAMtQ,CAAAA,EACbujC,IAAOjzB,EAAMxS,CAAAA;gBAEZpK,IAAAA,CAAK6zD,aAAAA,IACRjkB,CAAAA,KAAQlyB,EAAY1d,IAAAA,CAAKg1D,OAAAA,EAAS1oD,CAAAA,EAClCujC,KAAQnyB,EAAY1d,IAAAA,CAAKg1D,OAAAA,EAAS5qD,CAAAA,AAAAA;gBAGpC,MAAMgwB,IAAWp6B,IAAAA,CAAKo4D,iBAAAA,CAAkBp4D,IAAAA,CAAKo6B,QAAAA;gBAI7C,IAAIp6B,IAAAA,CAAK6zD,aAAAA;oBACP,IAAIrwD,OAAOg1D,UAAAA,GAAax4D,IAAAA,CAAKw2D,WAAAA,GAAchzD,OAAOi1D,WAAAA,EAAa;wBAC7D,MAAMC,IAAel1D,OAAOg1D,UAAAA,GAAax4D,IAAAA,CAAKw2D,WAAAA;wBAE9C3mB,IAAAA,AAASA,CAAAA,IAAAA,AADcrsC,CAAAA,OAAOi1D,WAAAA,GAAcC,CAAAA,IAAgB,CAAA,IAC3BA,IAAgBt+B,EAAS/f,MAAAA,EAC1Du1B,IAAQA,IAAOpsC,OAAOg1D,UAAAA,GAAcp+B,EAASjgB,KAC/C;oBAAA,OAAO;wBACL,MAAMw+C,IAAcn1D,OAAOi1D,WAAAA,GAAcz4D,IAAAA,CAAKw2D,WAAAA;wBAE9C5mB,IAAAA,AAASA,CAAAA,IAAAA,AADcpsC,CAAAA,OAAOg1D,UAAAA,GAAaG,CAAAA,IAAe,CAAA,IACzBA,IAAev+B,EAASjgB,KAAAA,EACzD01B,IAAQA,IAAOrsC,OAAOi1D,WAAAA,GAAer+B,EAAS/f,MAChD;oBAAA;;gBAUF,OAPAu1B,IAAQA,IAAOxV,EAASjgB,KAAAA,GAASna,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EACjD01B,IAAQA,IAAOzV,EAAS/f,MAAAA,GAAUra,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAGlDu1B,KAAc5vC,IAAAA,CAAK44D,WAAAA,CAAYp+C,IAAAA,EAC/Bq1B,KAAc7vC,IAAAA,CAAK44D,WAAAA,CAAYn+C,GAAAA,EAExB,IAAI3M,EAAO8hC,GAAMC;YAC1B;YAUO,wBAAwBjzB,CAAAA,EAAAA;gBAC7B,IAAIgzB,IAAOhzB,EAAMtQ,CAAAA,EACbujC,IAAOjzB,EAAMxS,CAAAA;gBAIjB,MAAMgwB,IAAWp6B,IAAAA,CAAKo4D,iBAAAA,CAAkBp4D,IAAAA,CAAKo6B,QAAAA;gBAK7C,IAHAwV,IAAQA,IAAO5vC,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAASigB,EAASjgB,KAAAA,EACjD01B,IAAQA,IAAO7vC,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAAU+f,EAAS/f,MAAAA,EAE9Cra,IAAAA,CAAK6zD,aAAAA;oBACP,IAAIrwD,OAAOg1D,UAAAA,GAAax4D,IAAAA,CAAKw2D,WAAAA,GAAchzD,OAAOi1D,WAAAA,EAAa;wBAC7D,MAAMC,IAAel1D,OAAOg1D,UAAAA,GAAax4D,IAAAA,CAAKw2D,WAAAA,EACxCqC,IAAAA,AAAiBr1D,CAAAA,OAAOi1D,WAAAA,GAAcC,CAAAA,IAAgB;wBAC5D7oB,IAAQA,IAAOzV,EAAS/f,MAAAA,GAAUq+C,IAAeG,GACjDjpB,IAAQA,IAAOxV,EAASjgB,KAAAA,GAAS3W,OAAOg1D,UAC1C;oBAAA,OAAO;wBACL,MAAMG,IAAcn1D,OAAOi1D,WAAAA,GAAcz4D,IAAAA,CAAKw2D,WAAAA,EACxCsC,IAAAA,AAAiBt1D,CAAAA,OAAOg1D,UAAAA,GAAaG,CAAAA,IAAe;wBAC1D/oB,IAAQA,IAAOxV,EAASjgB,KAAAA,GAASw+C,IAAcG,GAC/CjpB,IAAQA,IAAOzV,EAAS/f,MAAAA,GAAU7W,OAAOi1D,WAC3C;oBAAA;;gBAQF,OALKz4D,IAAAA,CAAK6zD,aAAAA,IACRjkB,CAAAA,KAAQlyB,EAAY1d,IAAAA,CAAKg1D,OAAAA,EAAS1oD,CAAAA,EAClCujC,KAAQnyB,EAAY1d,IAAAA,CAAKg1D,OAAAA,EAAS5qD,CAAAA,AAAAA,GAG7B,IAAI0D,EAAO8hC,GAAMC;YAC1B;YASO,yBAAyBjzB,CAAAA,EAAAA;gBAK9B,OAHAA,IAAQA,EAAMxM,GAAAA,CAAI1B,EAAI1O,IAAAA,CAAK44D,WAAAA,CAAYp+C,IAAAA,EAAMxa,IAAAA,CAAK44D,WAAAA,CAAYn+C,GAAAA,IAG1Dza,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAK62D,OAAAA,CAAQrwC,OAAAA,CAAQ9S,QAAAA,CAASkJ,KAEhCA,EAAMrM,GAAAA,CAAI7B,EAAI1O,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQ,GAAGna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAAS;YAC3E;YAQO,yBAAyBuC,CAAAA,EAAAA;gBAC9B,OAAI5c,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAK62D,OAAAA,CAAQ95C,SAAAA,CAAUrJ,QAAAA,CAASkJ,KAElCA,EAAMxM,GAAAA,CAAI1B,EAAI1O,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQ,GAAGna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAAS;YAC3E;YAEO,uBAAuBuC,CAAAA,EAAAA;gBAC5B,MAAM5I,IAAShU,IAAAA,CAAKu4D,uBAAAA,CAAwB37C;gBAC5C,OAAO5c,IAAAA,CAAK+4D,wBAAAA,CAAyB/kD;YACvC;YAEO,uBAAuB4I,CAAAA,EAAAA;gBAC5B,MAAM5I,IAAShU,IAAAA,CAAKg5D,wBAAAA,CAAyBp8C;gBAC7C,OAAO5c,IAAAA,CAAKua,uBAAAA,CAAwBvG;YACtC;YAQO,iBAAAklD;gBAKL,OAJe59C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOG,IAAAA,EAC5FgC,KAAAA,CAAMvB,EAAI,IAAI1O,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,EAAM,IAAIn5D,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,GAClDtnD,MAAAA,CAAO7R,IAAAA,CAAK62D,OAAAA,CAAQl0C,QAAAA,EACpBhG,SAAAA,CAAU3c,IAAAA,CAAK62D,OAAAA,CAAQuC,OAAAA;YAE5B;YAOO,kBAAAC;gBAEL,OADe/9C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOC,IAAAA,EAAMD,EAAOC,IAAAA;YAE9G;YAMA,IAAA,cAAWurD;gBACT,OAAOt5D,IAAAA,CAAKsZ,MAAAA,CAAOa,KACrB;YAAA;YAKA,IAAA,kBAAWo/C;gBACT,OAAOv5D,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAQ;YAC7B;YAMA,IAAA,eAAWq/C;gBACT,OAAOx5D,IAAAA,CAAKsZ,MAAAA,CAAOe,MACrB;YAAA;YAKA,IAAA,mBAAWo/C;gBACT,OAAOz5D,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAAS;YAC9B;YAKA,IAAA,YAAWq/C;gBACT,OAAI15D,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQna,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,GAEvCn5D,IAAAA,CAAKoa,UAAAA,CAAWD,KACzB;YAAA;YAKA,IAAA,QAAWA;gBACT,OAAIna,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQna,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,GAEvCn5D,IAAAA,CAAKoa,UAAAA,CAAWD,KACzB;YAAA;YAKA,IAAA,gBAAWw/C;gBACT,OAAO35D,IAAAA,CAAK05D,SAAAA,GAAY;YAC1B;YAKA,IAAA,aAAWE;gBACT,OAAI55D,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASra,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,GAExCn5D,IAAAA,CAAKoa,UAAAA,CAAWC,MACzB;YAAA;YAEA,IAAA,SAAWA;gBACT,OAAIra,IAAAA,CAAK62D,OAAAA,GACA72D,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASra,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,GAExCn5D,IAAAA,CAAKoa,UAAAA,CAAWC,MACzB;YAAA;YAKA,IAAA,iBAAWw/C;gBACT,OAAO75D,IAAAA,CAAK45D,UAAAA,GAAa;YAC3B;YAKA,IAAA,SAAWt9C;gBACT,OAAO5N,EAAI1O,IAAAA,CAAK25D,aAAAA,EAAe35D,IAAAA,CAAK65D,cAAAA;YACtC;YAKA,IAAA,cAAWjB;gBACT,OAAO54D,IAAAA,CAAK00D,YACd;YAAA;YAKA,IAAA,aAAWoF;gBACT,OAAO95D,IAAAA,CAAK20D,WACd;YAAA;YAKQ,cAAAoF;gBACNxgD,SAASO,IAAAA,CAAKH,KAAAA,CAAMgd,MAAAA,GAAS,OAC7Bpd,SAASO,IAAAA,CAAKH,KAAAA,CAAMqgD,QAAAA,GAAW;gBAC/B,MAAMC,IAASj6D,IAAAA,CAAKw2D,WAAAA;gBACpB,IAAI0D,IAAgB,GAChBC,IAAiB;gBACjB32D,OAAOg1D,UAAAA,GAAayB,IAASz2D,OAAOi1D,WAAAA,GACtCyB,CAAAA,IAAgB12D,OAAOg1D,UAAAA,EACvB2B,IAAiB32D,OAAOg1D,UAAAA,GAAayB,CAAAA,IAErCC,CAAAA,IAAgB12D,OAAOi1D,WAAAA,GAAcwB,GACrCE,IAAiB32D,OAAOi1D,WAAAA,AAAAA,GAG1Bz4D,IAAAA,CAAKo6B,QAAAA,GAAW;oBACdjgB,OAAO+/C;oBACP7/C,QAAQ8/C;gBAAAA,GAEVn6D,IAAAA,CAAK00D,YAAAA,GAAep5C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOC,IAAAA,GACpG/N,IAAAA,CAAK20D,WAAAA,GAAcr5C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOC,IAAAA,GACnG/N,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,2BAAAggC;gBACN7gD,SAASO,IAAAA,CAAKH,KAAAA,CAAMgd,MAAAA,GAAS,OAC7Bpd,SAASO,IAAAA,CAAKH,KAAAA,CAAMqgD,QAAAA,GAAW;gBAC/B,MAAMK,IAAK72D,OAAOg1D,UAAAA,EACZ8B,IAAK92D,OAAOi1D,WAAAA;gBAClBz4D,IAAAA,CAAKu6D,kBAAAA,CAAmBF,GAAIC,IAC5Bt6D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,8BAAAogC;gBACNx6D,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMQ,KAAAA,GAAQ,QAC1Bna,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMU,MAAAA,GAAS,QAE3Bra,IAAAA,CAAKu6D,kBAAAA,CAAmBv6D,IAAAA,CAAKsZ,MAAAA,CAAO++C,WAAAA,EAAar4D,IAAAA,CAAKsZ,MAAAA,CAAOg/C,YAAAA,EAAc;oBACzEn+C,OAAO;oBACPk9C,WAAW;oBACXh9C,QAAQ;oBACRi9C,YAAY;gBAAA,IAEdt3D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,mBAAmBigC,CAAAA,EAAYC,CAAAA,EAAYlgC,CAAAA,EAAAA;gBAMjD,IALAp6B,IAAAA,CAAKo6B,QAAAA,GAAWA,QAAAA,IAAAA,IAAY;oBAC1BjgB,OAAOkgD;oBACPhgD,QAAQigD;gBAAAA,GAGND,IAAKC,KAAMt6D,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA,GAAQna,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA,EAAQ;oBAE7Era,IAAAA,CAAKoa,UAAAA,GAAa;wBAChBD,OAAQkgD,IAAKr6D,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA,GAASkgD;wBAC9ChgD,QAAWggD,IAAKr6D,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA,GAASkgD,IAAMC,IAAMD;oBAAAA;oBAE/D,MAAMI,IAAAA,AAAQz6D,CAAAA,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASra,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA,AAAAA,IAAU;oBACzEra,IAAAA,CAAK00D,YAAAA,GAAe,IAAIp5C,EAAY;wBAClCb,KAAKggD;wBACLjgD,MAAM;wBACNgB,OAAOxb,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA;wBAC/BsB,QAAQzb,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASogD;oBAAAA,IAEnCz6D,IAAAA,CAAK20D,WAAAA,GAAc,IAAIr5C,EAAY;wBACjCb,KAAAA,CAAMggD;wBACNjgD,MAAM;wBACNgB,OAAOxb,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA;wBAC/BsB,QAAQzb,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASogD;oBAAAA;gBAErC,OAAO;oBACLz6D,IAAAA,CAAKoa,UAAAA,GAAa;wBAChBD,OAAUmgD,IAAKt6D,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA,GAAUigD,IAAMD,IAAMC;wBAC7DjgD,QAASigD,IAAKt6D,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA,GAAUigD;oBAAAA;oBAElD,MAAMG,IAAAA,AAAQz6D,CAAAA,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQna,IAAAA,CAAK40D,kBAAAA,CAAmBz6C,KAAAA,AAAAA,IAAS;oBACvEna,IAAAA,CAAK00D,YAAAA,GAAe,IAAIp5C,EAAY;wBAClCb,KAAK;wBACLD,MAAMigD;wBACNj/C,OAAOxb,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQsgD;wBAC/Bh/C,QAAQzb,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA;oBAAAA,IAElCra,IAAAA,CAAK20D,WAAAA,GAAc,IAAIr5C,EAAY;wBACjCb,KAAK;wBACLD,MAAAA,CAAOigD;wBACPj/C,OAAOxb,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQsgD;wBAC/Bh/C,QAAQzb,IAAAA,CAAK40D,kBAAAA,CAAmBv6C,MAAAA;oBAAAA;gBAEpC;YACF;YAEQ,2BAAAqgD;gBACNnhD,SAASO,IAAAA,CAAKH,KAAAA,CAAMgd,MAAAA,GAAS,OAC7Bpd,SAASO,IAAAA,CAAKH,KAAAA,CAAMqgD,QAAAA,GAAW,UAC/Bh6D,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMC,QAAAA,GAAW;gBAE7B,MAAMygD,IAAK72D,OAAOg1D,UAAAA,EACZ8B,IAAK92D,OAAOi1D,WAAAA;gBAElBz4D,IAAAA,CAAK26D,kBAAAA,CAAmBN,GAAIC,IAC5Bt6D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,8BAAAwgC;gBACN56D,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMQ,KAAAA,GAAQ,QAC1Bna,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMU,MAAAA,GAAS,QAC3Bra,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMC,QAAAA,GAAW;gBACd5Z,IAAAA,CAAKsZ,MAAAA,CAAOg9C,aAAAA,CACpB38C,KAAAA,CAAMqgD,QAAAA,GAAW;gBACxB,MAAA,EAAQ3B,aAAagC,CAAAA,EAAI/B,cAAcgC,CAAAA,EAAAA,GAAOt6D,IAAAA,CAAKsZ,MAAAA;gBAEnDtZ,IAAAA,CAAK26D,kBAAAA,CAAmBN,GAAIC,IAC5Bt6D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,mBAAmBigC,CAAAA,EAAYC,CAAAA,EAAAA;gBACrC,MAAML,IAASj6D,IAAAA,CAAKw2D,WAAAA;gBACpB,IAAI0D,IAAgB,GAChBC,IAAiB;gBACjBE,IAAKJ,IAASK,IAChBJ,CAAAA,IAAgBG,GAChBF,IAAiBE,IAAKJ,CAAAA,IAEtBC,CAAAA,IAAgBI,IAAKL,GACrBE,IAAiBG,CAAAA;gBAGnB,MAAMO,IAASR,IAAKH,GACdY,IAASR,IAAKH,GAEdY,IAAiBz1D,KAAKC,GAAAA,CAAIs1D,GAAQC,IAElCE,IAAcd,IAAgBa,GAC9BE,IAAed,IAAiBY;gBAIpC/6D,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMa,IAAAA,GADhBwgD,IAAcX,IAAAA,CACWW,CAAAA,IAAcX,CAAAA,IAAM,IAAI,OAE1B,IAIzBr6D,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMc,GAAAA,GADhBwgD,IAAeX,IAAAA,CACSW,CAAAA,IAAeX,CAAAA,IAAM,IAAI,OAE3B,IAG1Bt6D,IAAAA,CAAKo6B,QAAAA,GAAW;oBACdjgB,OAAO6gD;oBACP3gD,QAAQ4gD;gBAAAA;gBAGV,MAAMjmC,IAAS1Z,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKo6B,QAAAA,CAASjgB,KAAAA,EAAOna,IAAAA,CAAKo6B,QAAAA,CAAS/f,MAAAA,EAAQvM,EAAOC,IAAAA;gBAE3F,IAAI/N,IAAAA,CAAKo6B,QAAAA,CAASjgB,KAAAA,GAAQkgD,GAAI;oBAC5B,MAAMI,IAAAA,AAASz6D,CAAAA,IAAAA,CAAKo6B,QAAAA,CAASjgB,KAAAA,GAAQkgD,CAAAA,IAAMr6D,IAAAA,CAAKo6B,QAAAA,CAASjgB,KAAAA,GAASna,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA;oBAClF6a,EAAOva,GAAAA,GAAM,GACbua,EAAOxa,IAAAA,GAAOigD,IAAO,GACrBzlC,EAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,GAAQsgD,IAAO,GAC9CzlC,EAAOvZ,MAAAA,GAASzb,IAAAA,CAAKoa,UAAAA,CAAWC,MAClC;gBAAA;gBAEA,IAAIra,IAAAA,CAAKo6B,QAAAA,CAAS/f,MAAAA,GAASigD,GAAI;oBAC7B,MAAMG,IAAAA,AAASz6D,CAAAA,IAAAA,CAAKo6B,QAAAA,CAAS/f,MAAAA,GAASigD,CAAAA,IAAMt6D,IAAAA,CAAKo6B,QAAAA,CAAS/f,MAAAA,GAAUra,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA;oBACpF2a,EAAOva,GAAAA,GAAMggD,IAAO,GACpBzlC,EAAOxa,IAAAA,GAAO,GACdwa,EAAOvZ,MAAAA,GAASzb,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,GAASogD,IAAO,GAChDzlC,EAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKoa,UAAAA,CAAWD,KACjC;gBAAA;gBACAna,IAAAA,CAAK00D,YAAAA,GAAe1/B;YACtB;YAEQ,uBAAAkmC;gBACN,MAAMjB,IAASj6D,IAAAA,CAAKw2D,WAAAA;gBACpB,IAAI0D,IAAgB,GAChBC,IAAiB,GACjB9C,IAA0B,SAC1BC,IAA2B;gBAC/B,MAAMpnB,IAASlwC,IAAAA,CAAKsZ,MAAAA,CAAOg9C,aAAAA;gBACvBpmB,EAAOirB,WAAAA,GAAclB,IAAS/pB,EAAOkrB,YAAAA,GACvCp7D,CAAAA,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMQ,KAAAA,GAAQ,QAC1B+/C,IAAgB,KAChB7C,IAAY,WACZ8C,IAAiBn6D,IAAAA,CAAKsZ,MAAAA,CAAO++C,WAAAA,GAAc4B,CAAAA,IAE3Cj6D,CAAAA,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMU,MAAAA,GAAS,QAC3B8/C,IAAiB,KACjB7C,IAAa,WACb4C,IAAgBl6D,IAAAA,CAAKsZ,MAAAA,CAAOg/C,YAAAA,GAAe2B,CAAAA,GAG7Cj6D,IAAAA,CAAKo6B,QAAAA,GAAW;oBACdjgB,OAAO+/C;oBACP7C,WAAAA;oBACAh9C,QAAQ8/C;oBACR7C,YAAAA;gBAAAA,GAEFt3D,IAAAA,CAAK00D,YAAAA,GAAep5C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOC,IAAAA,GACpG/N,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU;oBACzBiS,YAAYpa,IAAAA,CAAKoa,UAAAA;oBACjBggB,UAAUp6B,IAAAA,CAAKo6B,QAAAA;gBAAAA;YAEnB;YAEQ,oBAAAg7B;gBACNp1D,IAAAA,CAAKy0D,sCAAAA,CAAuCz0D,IAAAA,CAAKkwC,MAAAA,GAG7ClwC,IAAAA,CAAKkwC,MAAAA,YAAkBmrB,SACzBr7D,IAAAA,CAAKk1D,QAAAA,CAAS1xD,MAAAA,CAAOiE,EAAAA,CAAG,UAAUzH,IAAAA,CAAKw0D,cAAAA,IAEvCx0D,CAAAA,IAAAA,CAAK01D,eAAAA,GAAkB,IAAI4F,eAAe;oBACxCt7D,IAAAA,CAAKw0D,cAAAA;gBAAgB,IAEvBx0D,IAAAA,CAAK01D,eAAAA,CAAgB6F,OAAAA,CAAQv7D,IAAAA,CAAKkwC,MAAAA,CAAAA,GAEpClwC,IAAAA,CAAKkwC,MAAAA,CAAO7lB,gBAAAA,CAAiB,UAAUrqB,IAAAA,CAAKw0D,cAAAA;YAC9C;YAKQ,uCAAuCtkB,CAAAA,EAAAA;gBACzClwC,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAYyD,aAAAA,IACnCl2D,CAAAA,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMQ,KAAAA,GAAQ,QAC1Bna,IAAAA,CAAKsZ,MAAAA,CAAOK,KAAAA,CAAMU,MAAAA,GAAS,QAC3Bra,IAAAA,CAAKo6B,QAAAA,GAAW;oBACdjgB,OAAO;oBACPk9C,WAAW;oBACXh9C,QAAQ;oBACRi9C,YAAY;gBAAA,GAEdt3D,IAAAA,CAAKoa,UAAAA,GAAa;oBAChBD,OAAOna,IAAAA,CAAKsZ,MAAAA,CAAO++C,WAAAA;oBACnBh+C,QAAQra,IAAAA,CAAKsZ,MAAAA,CAAOg/C,YAAAA;gBAAAA,CAAAA,GAIpBt4D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAY+I,UAAAA,IACnCjiD,CAAAA,SAASO,IAAAA,CAAKH,KAAAA,CAAMgd,MAAAA,GAAS,OAC7Bpd,SAASO,IAAAA,CAAKH,KAAAA,CAAMqgD,QAAAA,GAAW,UAC/Bh6D,IAAAA,CAAKoa,UAAAA,GAAa;oBAChBD,OAAgB+1B,EAAQsoB,UAAAA;oBACxBn+C,QAAiB61B,EAAQuoB,WAAAA;gBAAAA,GAG3Bz4D,IAAAA,CAAKo6B,QAAAA,GAAWp6B,IAAAA,CAAKoa,UAAAA,AAAAA,GAGvBpa,IAAAA,CAAK00D,YAAAA,GAAep5C,EAAYc,aAAAA,CAAcpc,IAAAA,CAAKoa,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKoa,UAAAA,CAAWC,MAAAA,EAAQvM,EAAOC,IAAAA,GAEhG/N,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAYgJ,SAAAA,IACnCz7D,IAAAA,CAAK+5D,WAAAA,IAGH/5D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAY0D,YAAAA,IACnCn2D,IAAAA,CAAKk7D,oBAAAA,IAGHl7D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAYiJ,gBAAAA,IACnC17D,IAAAA,CAAKo6D,wBAAAA,IAGHp6D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAY2D,mBAAAA,IACnCp2D,IAAAA,CAAKw6D,2BAAAA,IAGHx6D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAYkJ,gBAAAA,IACnC37D,IAAAA,CAAK06D,wBAAAA,IAGH16D,IAAAA,CAAK80D,WAAAA,KAAgBrC,GAAY4D,mBAAAA,IACnCr2D,IAAAA,CAAK46D,2BAAAA;YAET;QAAA;QCzsCK,MAAMgB;YAGJ,OAAA,SAAOC;gBAOZ,OANK77D,IAAAA,CAAKkX,SAAAA,IAAAA,AACE1T,CAAAA,OAAQU,YAAAA,IAAsBV,OAAQW,kBAAAA,AAAAA,KAC9CnE,CAAAA,IAAAA,CAAKkX,SAAAA,GAAY,IAAIhT,YAAAA,GAIlBlE,IAAAA,CAAKkX,SACd;YAAA;QAAA;QCGK,MAAM4kD;YAQX,OAAA,SAAOC;gBA8CL,OA7CgB,IAAIx3D,QAAiB,CAACC,GAASC;oBAC7C,IAAIq3D,GAASE,SAAAA,IAAAA,CAAcJ,GAAoBC,MAAAA,IAC7C,OAAOr3D,EAAAA,CAAQ;oBAEjB,MAAMy3D,IAAqB92D,WAAW;wBACpCyR,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,oGAC1B7T,EAAAA,CAAQ;oBAAM,GACb,MAEGf,IAAem4D,GAAoBC,MAAAA;oBACzCp4D,EAAay4D,MAAAA,GAAS/uC,IAAAA,CACpB;wBAEE,MAAMmU,IAAS79B,EAAa89B,YAAAA,CAAa,GAAG,GAAG,QACzChgB,IAAS9d,EAAa04D,kBAAAA;wBAC5B,IAAIC,IAAAA,CAAQ;wBAEZ76C,EAAO+f,MAAAA,GAASA,GAChB/f,EAAO86C,OAAAA,CAAQ54D,EAAa64D,WAAAA,GAC5B/6C,EAAOg7C,OAAAA,GAAU,IAAOH,IAAAA,CAAQ,GAEhC76C,EAAOvc,KAAAA,CAAM,IAGbG,WAAW;4BAAA,CArCrB,SAAgCoc,CAAAA;gCAC9B,OAAA,CAAA,CAASA,EAAOi7C,aAClB;4BAAA,EAoCuCj7C,KAAAA,AAKrB9d,CAAAA,EAAai5D,WAAAA,GAAc,KAAKN,CAAAA,KAClCN,CAAAA,GAASE,SAAAA,GAAAA,CAAY,CAAA,IALnBz6C,EAAOi7C,aAAAA,KAAkBj7C,EAAOo7C,aAAAA,IAAiBp7C,EAAOi7C,aAAAA,KAAkBj7C,EAAOq7C,cAAAA,IACnFd,CAAAA,GAASE,SAAAA,GAAAA,CAAY,CAAA;wBAMzB,GACC,IAEHv2D,aAAaw2D,IACbz3D,EAAAA,CAAQ;oBAAK,GAEf;wBACEC;oBAAQ;gBAEX;YAIL;YAEA,OAAA,aAAOo4D;gBACL,OAAO78D,IAAAA,CAAKg8D,SACd;YAAA;QAAA;QA1De,GAAAA,SAAAA,GAAAA,CAAqB;QCH/B,MAAMc,WAAevlB;YAI1B,IAAA,MAAWngB;gBACT,OAAOp3B,IAAAA,CAAKyZ,IACd;YAAA;YAEA,YAAoBJ,IAA2D,CAAC,CAAA,CAAA;gBAC9EuT,KAAAA,CAAMvT,IADY,IAAA,CAAAA,QAAAA,GAAAA;YAEpB;YAEO,QAAApH;gBACL,OAAO,IAAI6qD,GAAO;oBAAA,GACb98D,IAAAA,CAAKqZ,QAAAA;oBAAAA,GACLrZ,IAAAA,CAAKisB,mBAAAA,EAAAA;oBAAAA,GACLjsB,IAAAA,CAAKu4C,kBAAAA,EAAAA;gBAAAA;YAEZ;YAEA,QAAQnhB,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACW,CAAA,SAAb,CAAA,IAAAp3B,IAAAA,CAAKqZ,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEwG,IAAAA,AAAAA,KACJ,CAAA,SAAb,CAAA,IAAA7f,IAAAA,CAAKqZ,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,KAAA,EAAEwG,IAAAA,CAAKuX,EAAAA,GAEjBp3B,IAAAA,CAAKqZ,QAAAA,CAAS0jD,KAAAA,IACjB/8D,IAAAA,CAAKgwC,SAAAA;YAET;QAAA;QCnCK,MAAMgtB;QAAAA;QACG,GAAAv2D,IAAAA,GAA8B;YAC1Cw2D,KAAK;YACLzqC,MAAM;YACN0qC,MAAM;YACNtpC,MAAM;YACNra,UAAU;YACV4jD,aAAa;QAAA;QCMV,MAAMC;YAAb,aAAA;gBASS,IAAA,CAAAC,MAAAA,GAAS,IAAI/uC;YAmFtB;YAzFE,IAAA,eAAWgvC;gBACT,OAAOt9D,IAAAA,CAAKu9D,aACd;YAAA;YACA,IAAA,aAAwB7wB,CAAAA,EAAAA;gBACtB1sC,IAAAA,CAAKu9D,aAAAA,GAAgB7wB;YACvB;YAIA,OAAA,OACE8wB,CAAAA,EACA/7D,CAAAA,EAAAA;gBAEA,MAAMg8D,IAAU,IAAIL;gBACpBK,EAAQh8D,IAAAA,GAAOA;gBACf,IAAK,MAAMi8D,KAAaF,EAAmBH,MAAAA,CACzCI,EAAQJ,MAAAA,CAAOryC,GAAAA,CAAI0yC,GAAuC;oBACxDjvC,MAAMivC;oBAAAA,GACHF,EAAmBH,MAAAA,CAAOK,EAAAA;gBAAAA;gBAKjC,KAAK,MAAMhxB,KAAS+wB,EAAQJ,MAAAA,CAAOnW,MAAAA,GACjC,KAAK,MAAMyW,KAAmBjxB,EAAMkxB,WAAAA,CAClC,IAAwB,QAApBD,KAAAA,CAGCF,EAAQJ,MAAAA,CAAOtlD,GAAAA,CAAI4lD,IACtB,MAAMx3D,MACJ,CAAA,8BAAA,EAAiCumC,EAAMje,IAAAA,CAAAA,wDAAAA,EAA+DkvC,EAAAA,CAAAA,CAAAA;gBAM9G,OADAF,EAAQH,YAAAA,GAAeG,EAAQI,UAAAA,GAAaJ,EAAQJ,MAAAA,CAAO16D,GAAAA,CAAI66D,EAAmBx4D,KAAAA,GAC3Ey4D;YACT;YAEA,GAAG/wB,CAAAA,EAAAA;gBACD,OAAO1sC,IAAAA,CAAKs9D,YAAAA,CAAa7uC,IAAAA,KAASie;YACpC;YAEA,GAAGgxB,CAAAA,EAA4BK,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAC7B,IAAI/9D,IAAAA,CAAKs9D,YAAAA,CAAaM,WAAAA,CAAY38C,QAAAA,CAASy8C,MAAc19D,IAAAA,CAAKs9D,YAAAA,CAAaM,WAAAA,CAAY38C,QAAAA,CAAS,MAAM;oBACpG,MAAM+8C,IAAoBh+D,IAAAA,CAAKq9D,MAAAA,CAAO16D,GAAAA,CAAI+6D;oBAC1C,IAAI19D,IAAAA,CAAKs9D,YAAAA,CAAaW,MAAAA,EAAQ;wBAE5B,IAAA,CAAgB,MADiB,CAAA,SAAjB,CAAA,IAAAj+D,IAAAA,CAAKs9D,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,KAAA,IAAA,EAAEW,MAAAA,CAAO;4BAAEzwD,IAAIwwD,EAAkBvvC,IAAAA;4BAAMhtB,MAAMzB,IAAAA,CAAKyB,IAAAA;wBAAAA,EAAAA,GAEjF,OAAA,CAAO;oBAEX;oBAEA,IAAIu8D,QAAAA,IAAAA,KAAiB,IAAjBA,EAAmBE,OAAAA,EAAS;wBAE9B,IAAA,CAAiB,MADAF,CAAAA,QAAAA,IAAAA,KAAiB,IAAjBA,EAAmBE,OAAAA,CAAQ;4BAAE3wD,MAAMvN,IAAAA,CAAKs9D,YAAAA,CAAa7uC,IAAAA;4BAAMsvC,WAAAA;4BAAWt8D,MAAMzB,IAAAA,CAAKyB,IAAAA;wBAAAA,EAAAA,GAEhG,OAAA,CAAO;oBAEX;oBAKA,OAJAzB,IAAAA,CAAKs9D,YAAAA,GAAeU,GAAAA,AACC,CAAA,SAAjB,CAAA,IAAAh+D,IAAAA,CAAKs9D,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,KAAA,IAAA,EAAEa,OAAAA,AAAAA,KACrBn+D,IAAAA,CAAKs9D,YAAAA,CAAaa,OAAAA,IAAAA,CAEb;gBACT;gBACA,OAAA,CAAO;YACT;YAEA,OAAOrnB,CAAAA,EAAAA;gBACD92C,IAAAA,CAAKs9D,YAAAA,CAAahM,QAAAA,IACpBtxD,IAAAA,CAAKs9D,YAAAA,CAAahM,QAAAA,CAAStxD,IAAAA,CAAKyB,IAAAA,EAAMq1C;YAE1C;YAEA,KAAKsnB,CAAAA,EAAAA;gBACHC,aAAaC,OAAAA,CACXF,GACA78D,KAAKC,SAAAA,CAAU;oBACb87D,cAAct9D,IAAAA,CAAKs9D,YAAAA,CAAa7uC,IAAAA;oBAChChtB,MAAMzB,IAAAA,CAAKyB,IAAAA;gBAAAA;YAGjB;YAEA,QAAQ28D,CAAAA,EAAAA;gBACN,MAAM1xB,IAAkCnrC,KAAKg9D,KAAAA,CAAMF,aAAaG,OAAAA,CAAQJ;gBACxEp+D,IAAAA,CAAKs9D,YAAAA,GAAet9D,IAAAA,CAAKq9D,MAAAA,CAAO16D,GAAAA,CAAI+pC,EAAM4wB,YAAAA,GAC1Ct9D,IAAAA,CAAKyB,IAAAA,GAAOirC,EAAMjrC,IACpB;YAAA;QAAA;QCjGK,MAAMg9D;YAsEH,yBAAAC;gBACN1+D,IAAAA,CAAK2+D,SAAAA,GAAY3+D,IAAAA,CAAK4+D,aAAAA,CAAczC,kBAAAA,IACpCn8D,IAAAA,CAAK2+D,SAAAA,CAAUr9B,MAAAA,GAASthC,IAAAA,CAAK2xB,IAAAA,EAC7B3xB,IAAAA,CAAK2+D,SAAAA,CAAUE,IAAAA,GAAO7+D,IAAAA,CAAK6+D,IAAAA,EAC3B7+D,IAAAA,CAAK2+D,SAAAA,CAAUG,YAAAA,CAAa17D,KAAAA,GAAQpD,IAAAA,CAAK++D,aAAAA,EACzC/+D,IAAAA,CAAK2+D,SAAAA,CAAUtC,OAAAA,CAAQr8D,IAAAA,CAAKg/D,WAAAA,GAC5Bh/D,IAAAA,CAAKg/D,WAAAA,CAAY3C,OAAAA,CAAQr8D,IAAAA,CAAK4+D,aAAAA,CAActC,WAAAA;YAC9C;YAEQ,aAAA2C;gBACDj/D,IAAAA,CAAK6+D,IAAAA,IACR7+D,CAAAA,IAAAA,CAAK2+D,SAAAA,CAAUpC,OAAAA,GAAU;oBACvBv8D,IAAAA,CAAKk/D,cAAAA,CAAe16D,OAAAA,CAAAA,CAAQ;gBAAK,CAAA;YAGvC;YAMA,IAAA,KAAgBpB,CAAAA,EAAAA;gBACdpD,IAAAA,CAAKm/D,KAAAA,GAAQ/7D,GAETpD,IAAAA,CAAK2+D,SAAAA,IACP3+D,CAAAA,IAAAA,CAAK2+D,SAAAA,CAAUE,IAAAA,GAAOz7D,GACjBpD,IAAAA,CAAK6+D,IAAAA,IACR7+D,CAAAA,IAAAA,CAAK2+D,SAAAA,CAAUpC,OAAAA,GAAU;oBACvBv8D,IAAAA,CAAKk/D,cAAAA,CAAe16D,OAAAA,CAAAA,CAAQ;gBAAK,CAAA,CAAA;YAIzC;YACA,IAAA,OAAWq6D;gBACT,OAAO7+D,IAAAA,CAAKm/D,KACd;YAAA;YAEA,IAAA,OAAkB/7D,CAAAA,EAAAA;gBAChBA,IAAQsJ,EAAMtJ,GAAO,GAAG,IAExBpD,IAAAA,CAAKq/D,OAAAA,GAAUj8D,GAEXpD,IAAAA,CAAKs/D,aAAAA,CAAcC,EAAAA,CAAG,cAAcv/D,IAAAA,CAAKg/D,WAAAA,CAAYQ,IAAAA,CAAKC,eAAAA,GAI5Dz/D,IAAAA,CAAKg/D,WAAAA,CAAYQ,IAAAA,CAAKC,eAAAA,CAAgBr8D,GAAOpD,IAAAA,CAAK4+D,aAAAA,CAAclC,WAAAA,EAAa,MAE7E18D,IAAAA,CAAKg/D,WAAAA,CAAYQ,IAAAA,CAAKp8D,KAAAA,GAAQA;YAElC;YACA,IAAA,SAAWg8D;gBACT,OAAOp/D,IAAAA,CAAKq/D,OACd;YAAA;YAMA,IAAA,WAAW3pB;gBAAAA,IAAAA;gBACT,OAAqB,SAAd,CAAA,IAAA11C,IAAAA,CAAK0/D,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI1/D,IAAAA,CAAK2/D,wBAAAA;YAChC;YASA,IAAA,SAAoBjqB,CAAAA,EAAAA;gBAClB11C,IAAAA,CAAK0/D,SAAAA,GAAYhqB;YACnB;YAEA,YAAoB/jB,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,IAAAA,GAAAA,GA9IZ,IAAA,CAAAitC,aAAAA,GAA8BhD,GAAoBC,MAAAA,IAClD,IAAA,CAAAmD,WAAAA,GAAch/D,IAAAA,CAAK4+D,aAAAA,CAAcgB,UAAAA,IAEjC,IAAA,CAAAV,cAAAA,GAAiB,IAAIx4D,GACrB,IAAA,CAAA44D,aAAAA,GAAgBlC,GAAavB,MAAAA,CACnC;oBACE72D,OAAO;oBACPq4D,QAAQ;wBACNwC,SAAS;4BACP3B,SAAS,CAAA,EAAGz8D,MAAAA,CAAAA,EAAAA;gCAEVzB,IAAAA,CAAK0+D,sBAAAA,IACL1+D,IAAAA,CAAKi/D,UAAAA,IACDj/D,IAAAA,CAAK6+D,IAAAA,GAEP7+D,IAAAA,CAAK2+D,SAAAA,CAAU35D,KAAAA,CAAM,GAAGvD,EAAKq+D,QAAAA,GAAW9/D,IAAAA,CAAK++D,aAAAA,IAE7C/+D,IAAAA,CAAK2+D,SAAAA,CAAU35D,KAAAA,CAAM,GAAGvD,EAAKq+D,QAAAA,GAAW9/D,IAAAA,CAAK++D,aAAAA,EAAe/+D,IAAAA,CAAK01C,QAAAA,GAEnEj0C,EAAKs+D,SAAAA,GAAY//D,IAAAA,CAAK4+D,aAAAA,CAAclC,WAAAA,GAAcj7D,EAAKq+D,QAAAA,EACvDr+D,EAAKq+D,QAAAA,GAAW;4BAAC;4BAEnB3B,SAAS,IAAMn+D,IAAAA,CAAKggE,YAAAA;4BACpB/B,QAAQ,CAAA,EAAGzwD,IAAAA,CAAAA,EAAAA;gCAEE,cAAPA,KACFxN,IAAAA,CAAKk/D,cAAAA,CAAe16D,OAAAA,CAAAA,CAAQ,IAG9BxE,IAAAA,CAAK2+D,SAAAA,CAAUpC,OAAAA,GAAU,MACzBv8D,IAAAA,CAAK2+D,SAAAA,CAAUhJ,UAAAA,IACf31D,IAAAA,CAAK2+D,SAAAA,CAAUsB,IAAAA,CAAK,IACpBjgE,IAAAA,CAAK2+D,SAAAA,GAAY;4BAAW;4BAE9Bf,aAAa;gCAAC;gCAAW;gCAAU;6BAAA;wBAAA;wBAErCsC,MAAM;4BACJhC,SAAS,CAAA,EAAGH,WAAWnkD,CAAAA,EAAUnY,MAAAA,CAAAA,EAAAA;gCAC/BA,EAAKq+D,QAAAA,GAAAA,AAAYlmD,CAAAA,QAAAA,IAAAA,IAAY,CAAA,IAAK5Z,IAAAA,CAAK++D,aAAAA,EACvCt9D,EAAKs+D,SAAAA,GAAY;4BAAC;4BAEpBnC,aAAa;gCAAC;6BAAA;wBAAA;wBAEhBuC,SAAS;4BACPjC,SAAS,CAAA,EAAGz8D,MAAAA,CAAAA,EAAAA;gCACVA,EAAKq+D,QAAAA,GAAW,GAChBr+D,EAAKs+D,SAAAA,GAAY,GACjB//D,IAAAA,CAAKk/D,cAAAA,CAAe16D,OAAAA,CAAAA,CAAQ;4BAAK;4BAEnCo5D,aAAa;gCAAC;gCAAW;gCAAU;6BAAA;wBAAA;wBAErCwC,QAAQ;4BACNlC,SAAS,CAAA,EAAGz8D,MAAAA,CAAAA,EAAAA;gCAIVA,EAAKq+D,QAAAA,GAAW9/D,IAAAA,CAAK4+D,aAAAA,CAAclC,WAAAA,GAAcj7D,EAAKs+D,SAAS;4BAAA;4BAEjEnC,aAAa;gCAAC;gCAAW;gCAAW;6BAAA;wBAAA;oBAAA;gBAAA,GAI1C;oBACEmC,WAAW;oBACXD,UAAU;gBAAA,IAqBN,IAAA,CAAAT,OAAAA,GAAU,GACV,IAAA,CAAAF,KAAAA,GAAAA,CAAQ,GAER,IAAA,CAAAa,YAAAA,GAA0B,KAAA,GAyG1B,IAAA,CAAAjB,aAAAA,GAAgB,GAlDtB/+D,IAAAA,CAAK0+D,sBAAAA;YACP;YAEO,YAAAxoB;gBACL,OAAOl2C,IAAAA,CAAKs/D,aAAAA,CAAcC,EAAAA,CAAG;YAC/B;YAEO,WAAAc;gBACL,OAAOrgE,IAAAA,CAAKs/D,aAAAA,CAAcC,EAAAA,CAAG,aAAav/D,IAAAA,CAAKs/D,aAAAA,CAAcC,EAAAA,CAAG;YAClE;YAEO,YAAAe;gBACL,OAAOtgE,IAAAA,CAAKs/D,aAAAA,CAAcC,EAAAA,CAAG;YAC/B;YAGO,KAAKgB,IAAyB,KAAA,CAAA,EAAA;gBAGnC,OAFAvgE,IAAAA,CAAKggE,YAAAA,GAAeO,GACpBvgE,IAAAA,CAAKs/D,aAAAA,CAAcxB,EAAAA,CAAG,YACf99D,IAAAA,CAAKk/D,cAAAA,CAAer4D,OAC7B;YAAA;YAEO,QAAA+B;gBACL5I,IAAAA,CAAKs/D,aAAAA,CAAcxB,EAAAA,CAAG;YACxB;YAEO,OAAAmC;gBACLjgE,IAAAA,CAAKs/D,aAAAA,CAAcxB,EAAAA,CAAG;YACxB;YAEO,KAAKlkD,CAAAA,EAAAA;gBACV5Z,IAAAA,CAAKs/D,aAAAA,CAAcxB,EAAAA,CAAG,WACtB99D,IAAAA,CAAKs/D,aAAAA,CAAcxB,EAAAA,CAAG,QAAQlkD;YAChC;YAEO,2BAAA+lD;gBACL,OAAO3/D,IAAAA,CAAK2xB,IAAAA,CAAK+jB,QACnB;YAAA;YAEO,sBAAA+qB;gBACL,MAAA,EAAM,UAAEX,CAAAA,EAAQ,WAAEC,CAAAA,EAAAA,GAAc//D,IAAAA,CAAKs/D,aAAAA,CAAc79D,IAAAA;gBACnD,OAAIq+D,IACKA,IAAW9/D,IAAAA,CAAK++D,aAAAA,GAErBgB,IAAAA,AACM//D,CAAAA,IAAAA,CAAK4+D,aAAAA,CAAclC,WAAAA,GAAcqD,CAAAA,IAAa//D,IAAAA,CAAK++D,aAAAA,GAEtD;YACT;YAGA,IAAA,aAAwBD,CAAAA,EAAAA;gBACtB9+D,IAAAA,CAAK2+D,SAAAA,CAAUG,YAAAA,CAAa17D,KAAAA,GAAQpD,IAAAA,CAAK++D,aAAAA,GAAgBD;YAC3D;YAEA,IAAA,eAAWA;gBACT,OAAO9+D,IAAAA,CAAK2+D,SAAAA,CAAUG,YAAAA,CAAa17D,KACrC;YAAA;QAAA;QCpNK,MAAMs9D,WAAmBtf;YAI9B,IAAA,QAAmBuf,CAAAA,EAAAA,CAEnB;YAIA,IAAA,UAAWrf;gBACT,OAAA,CAAO;YACT;YAIA,IAAA,QAAcsf;gBACZ,OAAO;YACT;YAIA,IAAA,MAAoBC,CAAAA,EAAAA,CAEpB;YAEA,YACSx/C,CAAAA,EACGyrB,IAAgB,YAAA,CAAA;gBAE1BlgB,KAAAA,IAHO,IAAA,CAAAvL,MAAAA,GAAAA,GACG,IAAA,CAAAyrB,KAAAA,GAAAA;YAGZ;YAKO,kBAAAyU,CAIP;YAIO,SAAA8C,CAIP;YAIO,YAAAyc,CAIP;YAEO,QAAQE,CAAAA,EAAAA,CAIf;QAAA;QAGK,MAAMC,WAAyBP;YACpC,YACEr/C,CAAAA,EACO6/C,CAAAA,CAAAA;gBAEPt0C,KAAAA,CAAMvL,GAAQ,qBAFP,IAAA,CAAA6/C,KAAAA,GAAAA;YAGT;QAAA;QAGK,MAAMC,WAAkCT;YAG7C,YACEr/C,CAAAA,EACQ+/C,CAAAA,CAAAA;gBAERx0C,KAAAA,CAAMvL,GAAQ,8BAFN,IAAA,CAAA+/C,cAAAA,GAAAA,GAIRphE,IAAAA,CAAKyB,IAAAA,GAAOzB,IAAAA,CAAKohE,cACnB;YAAA;QAAA;QCpFK,SAASC,GAAYC,CAAAA;YAC1B,IAAA;gBACE,MAAMl/D,IAAI,IAAIm/D,OACRC,IAAW,uCACX/6D,IAAO66D,EAAK5uD,KAAAA,CAAM8uD,EAAAA,CAAU,EAAA;gBAClC,OAAA,CAAA,CAAIp/D,EAAEq/D,WAAAA,CAAY,WAAWh7D;YAK/B,EAAE,OAAO6Y,GAAAA;gBAEP,OADA1I,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,yEAAyEiH,IAAAA,CAC5F;YACT;QACF;QCGO,MAAMoiD,KAAc;YACzBC,cAAc;YACdC,WAAW;YACXC,OAAO;YACPC,MAAM;YACNC,aAAa;YACbC,QAAQ;YACRC,eAAe;QAAA;QAQV,MAAMC;YASX,IAAA,KAAgB9+D,CAAAA,EAAAA;gBACdpD,IAAAA,CAAKm/D,KAAAA,GAAQ/7D;gBAEb,KAAK,MAAM89D,KAASlhE,IAAAA,CAAKmiE,OAAAA,CACvBjB,EAAMrC,IAAAA,GAAO7+D,IAAAA,CAAKm/D,KAAAA;gBAGpBn/D,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,uCAAuChY,IAAAA,CAAKypB,IAAAA,EAAM,MAAMzpB,IAAAA,CAAKm/D,KAAAA;YACjF;YACA,IAAA,OAAWN;gBACT,OAAO7+D,IAAAA,CAAKm/D,KACd;YAAA;YAEA,IAAA,OAAkB/7D,CAAAA,EAAAA;gBAChBpD,IAAAA,CAAKq/D,OAAAA,GAAUj8D;gBAEf,KAAK,MAAM89D,KAASlhE,IAAAA,CAAKmiE,OAAAA,CACvBjB,EAAM9B,MAAAA,GAASp/D,IAAAA,CAAKq/D,OAAAA;gBAGtBr/D,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAI84D,GAAiBjhE,IAAAA,IAEtDA,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,uCAAuChY,IAAAA,CAAKypB,IAAAA,EAAM,MAAMzpB,IAAAA,CAAKq/D,OAAAA;YACjF;YACA,IAAA,SAAWD;gBACT,OAAOp/D,IAAAA,CAAKq/D,OACd;YAAA;YAMA,IAAA,WAAW3pB;gBACT,OAAO11C,IAAAA,CAAK0/D,SACd;YAAA;YAQA,IAAA,SAAoBhqB,CAAAA,EAAAA;gBAClB11C,IAAAA,CAAK0/D,SAAAA,GAAYhqB;YACnB;YAKA,IAAA,YAAW0sB;gBACT,OAAOpiE,IAAAA,CAAKmiE,OACd;YAAA;YAEA,IAAA,OAAW14C;gBACT,OAAOzpB,IAAAA,CAAKiyB,SAAAA,CAAUxI,IACxB;YAAA;YAEA,IAAA,KAAgBhd,CAAAA,EAAAA;gBACdzM,IAAAA,CAAKiyB,SAAAA,CAAUxI,IAAAA,GAAOhd;YACxB;YAMA,IAAA,YAAWkd;gBACT,OAAO3pB,IAAAA,CAAKiyB,SAAAA,CAAUtI,SACxB;YAAA;YAEA,IAAA,UAAqBld,CAAAA,EAAAA;gBACnBzM,IAAAA,CAAKiyB,SAAAA,CAAUtI,SAAAA,GAAYld;YAC7B;YAeA,YAAA9F,GAAe07D,CAAAA,CAAAA;gBA9FR,IAAA,CAAAnoD,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAA0iB,MAAAA,GAAiBhT,EAAOS,WAAAA,IAgFvB,IAAA,CAAA8nD,KAAAA,GAAAA,CAAQ,GACR,IAAA,CAAAE,OAAAA,GAAU,GACV,IAAA,CAAAiD,UAAAA,GAAAA,CAAa,GAEb,IAAA,CAAAH,OAAAA,GAAmB,EAAA,EAEnB,IAAA,CAAAI,mBAAAA,GAAAA,CAA+B,GAC/B,IAAA,CAAAxD,aAAAA,GAAgB,GAChB,IAAA,CAAAH,aAAAA,GAAgBhD,GAAoBC,MAAAA,IAM1C77D,IAAAA,CAAKiyB,SAAAA,GAAY,IAAIzI,GAAS,IAAIwzC,GAAWv2D,IAAAA,CAAK02D,WAAAA;gBAOlD,KAAK,MAAM1zC,KAAQ44C,EACjB,IAAIhB,GAAY53C,IAAO;oBACrBzpB,IAAAA,CAAKypB,IAAAA,GAAOA;oBACZ;gBACF;gBAGGzpB,IAAAA,CAAKypB,IAAAA,IACRzpB,CAAAA,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,mEAAmEgqD,EAAM9hE,IAAAA,CAAK,QAC/FP,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,qBAAqBgqD,CAAAA,CAAM,EAAA,GAC5CriE,IAAAA,CAAKypB,IAAAA,GAAO44C,CAAAA,CAAM,EAAA,AAAA;YAEtB;YAEO,WAAAx4C;gBACL,OAAA,CAAA,CAAS7pB,IAAAA,CAAKyB,IAChB;YAAA;YAEO,MAAA,OAAMwoB;gBAAAA,IAAAA,GAAAA;gBACX,IAAIjqB,IAAAA,CAAKyB,IAAAA,EACP,OAAOzB,IAAAA,CAAKyB,IAAAA;gBAEd,MAAM07D,IAAAA,MAAoBn9D,IAAAA,CAAKiyB,SAAAA,CAAUhI,IAAAA,IACnCu4C,IAAAA,MAAoBxiE,IAAAA,CAAKyiE,WAAAA,CAAYtF,EAAY5xD,KAAAA,CAAM;gBAG7D,OAFAvL,IAAAA,CAAK0/D,SAAAA,GAAmD,SAAvC,CAAA,IAAc,SAAd,CAAA,IAAA1/D,IAAAA,CAAK0/D,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI8C,QAAAA,IAAAA,KAAW,IAAXA,EAAa9sB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAA,KAAI50C,GAC5Dd,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,aAAa,IAAIg5D,GAA0BnhE,IAAAA,EAAMwiE,KAC1DxiE,IAAAA,CAAKyB,IAAAA,GAAO+gE;YACtB;YAEO,MAAA,YAAkB/gE,CAAAA,EAAAA;gBACvB,IAAA;oBACE,OAAA,MAAazB,IAAAA,CAAK4+D,aAAAA,CAAcv6D,eAAAA,CAAgB5C,EAAK8J,KAAAA,CAAM;gBAC7D,EAAE,OAAO+T,GAAAA;oBAMP,OALAtf,IAAAA,CAAK4pB,MAAAA,CAAO3iB,KAAAA,CACV,uKAAA,MAIW1C,QAAQE,MAAAA;gBACvB;YACF;YAEO,WAAWwV,CAAAA,EAAAA;gBACZA,KACFja,CAAAA,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GAEfja,IAAAA,CAAK2iE,OAAAA,CAAQl7D,EAAAA,CAAG,UAAU;oBACpBwS,EAAO2oD,oBAAAA,IAAwB5iE,IAAAA,CAAKk2C,SAAAA,MACtCl2C,CAAAA,IAAAA,CAAKuiE,mBAAAA,GAAAA,CAAsB,GAC3BviE,IAAAA,CAAK4I,KAAAA,EAAAA;gBACP,IAGF5I,IAAAA,CAAK2iE,OAAAA,CAAQl7D,EAAAA,CAAG,WAAW;oBACrBwS,EAAO2oD,oBAAAA,IAAwB5iE,IAAAA,CAAKuiE,mBAAAA,IAEtCviE,CAAAA,IAAAA,CAAKs2C,IAAAA,IACLt2C,IAAAA,CAAKuiE,mBAAAA,GAAAA,CAAsB,CAAA;gBAC7B,IAGFviE,IAAAA,CAAK2iE,OAAAA,CAAQl7D,EAAAA,CAAG,SAAS;oBACvBzH,IAAAA,CAAKsiE,UAAAA,GAAAA,CAAa;gBAAK,IAGzBtiE,IAAAA,CAAK2iE,OAAAA,CAAQl7D,EAAAA,CAAG,QAAQ;oBACtBzH,IAAAA,CAAKigE,IAAAA,IACLjgE,IAAAA,CAAKsiE,UAAAA,GAAAA,CAAa;gBAAI,EAAA;YAG5B;YAKO,gBAAAO;gBACL,OAAO7iE,IAAAA,CAAKmiE,OAAAA,CAAQ7hE,MACtB;YAAA;YAKO,YAAA41C;gBACL,OAAOl2C,IAAAA,CAAKmiE,OAAAA,CAAQW,IAAAA,CAAMtsD,CAAAA,IAAMA,EAAE0/B,SAAAA;YACpC;YAEO,WAAAmqB;gBACL,OAAOrgE,IAAAA,CAAKmiE,OAAAA,CAAQW,IAAAA,CAAMtsD,CAAAA,IAAMA,EAAE6pD,QAAAA;YACpC;YAEO,YAAAC;gBACL,OAAOtgE,IAAAA,CAAKmiE,OAAAA,CAAQW,IAAAA,CAAMtsD,CAAAA,IAAMA,EAAE8pD,SAAAA;YACpC;YAMO,KAAKlB,CAAAA,EAAAA;gBACV,OAAKp/D,IAAAA,CAAK6pB,QAAAA,KAMN7pB,IAAAA,CAAKsiE,UAAAA,GACPtiE,CAAAA,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,wDACV9T,QAAQC,OAAAA,CAAAA,CAAQ,EAAA,IAGzBxE,CAAAA,IAAAA,CAAKo/D,MAAAA,GAASA,KAAUp/D,IAAAA,CAAKo/D,MAAAA,EAEzBp/D,IAAAA,CAAKqgE,QAAAA,KACArgE,IAAAA,CAAK+iE,eAAAA,KAEL/iE,IAAAA,CAAKgjE,cAAAA,EAAAA,IAfZhjE,CAAAA,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,kCAAkCrY,IAAAA,CAAKypB,IAAAA,EAAM,sBAEvDllB,QAAQC,OAAAA,CAAAA,CAAQ,EAAA;YAe3B;YAKO,QAAAoE;gBACL,IAAK5I,IAAAA,CAAKk2C,SAAAA,IAAV;oBAIA,KAAK,MAAMgrB,KAASlhE,IAAAA,CAAKmiE,OAAAA,CACvBjB,EAAMt4D,KAAAA;oBAGR5I,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS,IAAI84D,GAAiBjhE,IAAAA,IAE/CA,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,iCAAiChY,IAAAA,CAAKypB,IAAAA;gBARxD;YASF;YAKO,OAAAw2C;gBACL,KAAK,MAAMiB,KAASlhE,IAAAA,CAAKmiE,OAAAA,CACvBjB,EAAMjB,IAAAA;gBAGRjgE,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ,IAAI84D,GAAiBjhE,IAAAA,IAE9CA,IAAAA,CAAKmiE,OAAAA,CAAQ7hE,MAAAA,GAAS,GACtBN,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,kCAAkChY,IAAAA,CAAKypB,IAAAA;YAC3D;YAEA,IAAA,eAAWq1C;gBACT,OAAO9+D,IAAAA,CAAK++D,aACd;YAAA;YAEA,IAAA,aAAwBD,CAAAA,EAAAA;gBACtB9+D,IAAAA,CAAK++D,aAAAA,GAAgBD,GACrB9+D,IAAAA,CAAKmiE,OAAAA,CAAQhkB,OAAAA,CAAS3nC,CAAAA;oBACpBA,EAAEsoD,YAAAA,GAAe9+D,IAAAA,CAAK++D,aAAa;gBAAA;YAEvC;YAEO,KAAKnlD,CAAAA,EAAkBqpD,IAAU,CAAA,EAAA;gBACV,MAAxBjjE,IAAAA,CAAKmiE,OAAAA,CAAQ7hE,MAAAA,IACfN,IAAAA,CAAKkjE,iBAAAA,CAAkBljE,IAAAA,CAAKyB,IAAAA,GAG9BzB,IAAAA,CAAKmiE,OAAAA,CAAQc,EAAAA,CAASzC,IAAAA,CAAK5mD;YAC7B;YAEO,2BAAA+lD;gBACL,OAAK3/D,IAAAA,CAAK6pB,QAAAA,KAOH7pB,IAAAA,CAAKyB,IAAAA,CAAKi0C,QAAAA,GANf11C,CAAAA,IAAAA,CAAK4pB,MAAAA,CAAOrR,QAAAA,CACV,CAAA,WAAA,EAAcvY,IAAAA,CAAKypB,IAAAA,CAAAA,oIAAAA,CAAAA,GAGd,CAAA;YAGX;YAQO,oBAAoBw5C,IAAU,CAAA,EAAA;gBACnC,OAAIjjE,IAAAA,CAAKmiE,OAAAA,CAAQ7hE,MAAAA,GACRN,IAAAA,CAAKmiE,OAAAA,CAAQc,EAAAA,CAASxC,mBAAAA,KAExB;YACT;YAMO,WAAWS,CAAAA,EAAAA;gBAChB,OAAOlhE,IAAAA,CAAKmiE,OAAAA,CAAQ15D,OAAAA,CAAQy4D;YAC9B;YAEQ,MAAA,kBAAM6B;gBACZ,IAAI/iE,IAAAA,CAAKqgE,QAAAA,IAAY;oBACnB,MAAM+C,IAA8B,EAAA;oBAEpC,KAAK,MAAMlC,KAASlhE,IAAAA,CAAKmiE,OAAAA,CACvBiB,EAAQzjE,IAAAA,CACNuhE,EAAM5qB,IAAAA,GAAOnpB,IAAAA,CAAK,IAChBntB,CAAAA,IAAAA,CAAKmiE,OAAAA,CAAQz5D,MAAAA,CAAO1I,IAAAA,CAAKmjE,UAAAA,CAAWjC,IAAQ,IAAA,CACrC,CAAA;oBAKblhE,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU,IAAI84D,GAAiBjhE,IAAAA,IAEhDA,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,uCAAuChY,IAAAA,CAAKypB,IAAAA,EAAMzpB,IAAAA,CAAKmiE,OAAAA,GAAAA,MAEnE59D,QAAQ8+D,GAAAA,CAAID;gBACpB;gBACA,OAAA,CAAO;YACT;YAKQ,MAAA,iBAAMJ;gBACZ,MAAM9B,IAAQlhE,IAAAA,CAAKkjE,iBAAAA,CAAkBljE,IAAAA,CAAKyB,IAAAA,GAEpC6hE,IAAAA,MAAiBpC,EAAM5qB,IAAAA,CAAK;oBAChCt2C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,iBAAiB,IAAI84D,GAAiBjhE,IAAAA,EAAMkhE,KAC7DlhE,IAAAA,CAAK4pB,MAAAA,CAAO5R,KAAAA,CAAM,kCAAkChY,IAAAA,CAAKypB,IAAAA;gBAAK;gBAGhEzpB,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,eAAe,IAAI84D,GAAiBjhE,IAAAA,EAAMkhE;gBAG3D,MAAM+B,IAAUjjE,IAAAA,CAAKmjE,UAAAA,CAAWjC;gBAKhC,OAAA,OAJI+B,KACFjjE,IAAAA,CAAKmiE,OAAAA,CAAQz5D,MAAAA,CAAOu6D,GAAS,IAGxBK;YACT;YAEQ,kBAAkB7hE,CAAAA,EAAAA;gBAAAA,IAAAA;gBACxB,MAAM8hE,IAAW,IAAI9E,GAAiBh9D;gBAStC,OAPA8hE,EAAS1E,IAAAA,GAAO7+D,IAAAA,CAAK6+D,IAAAA,EACrB0E,EAASnE,MAAAA,GAASp/D,IAAAA,CAAKo/D,MAAAA,EACvBmE,EAAS7tB,QAAAA,GAAwB,SAAb,CAAA,IAAA11C,IAAAA,CAAK01C,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI,GACrC6tB,EAASzE,YAAAA,GAAe9+D,IAAAA,CAAK++D,aAAAA,EAE7B/+D,IAAAA,CAAKmiE,OAAAA,CAAQxiE,IAAAA,CAAK4jE,IAEXA;YACT;YAIO,KAAwD77D,CAAAA,EAAuBU,CAAAA,EAAAA;gBACpFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAsDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBAClF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAuDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;QAAA;QCzYK,MAAM67D,KAAe;YAE1BC,YAAY;YACZC,WAAW;YACXC,YAAY;YACZC,mBAAmB;YACnBC,iBAAiB;QAAA;QAOZ,SAASC,GAAoBx3D,CAAAA;YAAAA,IAAAA,GAAAA;YAClC,OAAA,CAAA,CAASA,CAAAA,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,CAAAA,CAAwC,CAAA,SAAzB,CAAA,IAAY,SAAZ,CAAA,IAAAwJ,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE6D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE8nB,IAAAA,AAAAA;QACxD;QAEO,MAAMs1C;YAUX,IAAA,YAAWC;gBACT,OAAOhkE,IAAAA,CAAKikE,UACd;YAAA;YAOA,YAAYhrD,CAAAA,CAAAA;gBAAAA,IAAAA;gBAjBL,IAAA,CAAAiB,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAAoS,MAAAA,GAAiB,IAAIwjD,GAAO;oBACjCxtC,WAAW7B,GAAeI,OAAAA;oBAC1BkqB,WAAAA,CAAW;oBACXglB,OAAAA,CAAO;oBACPl9C,MAAM7f,IAAAA,CAAK6lC,MAAAA,CAAOhlB,IAAAA,CAAK7gB,IAAAA;gBAAAA,IAEjB,IAAA,CAAAikE,UAAAA,GAA8B,EAAA,EAI9B,IAAA,CAAAC,UAAAA,GAAqB,GAwFrB,IAAA,CAAAC,YAAAA,GAAe,GAwCf,IAAA,CAAAC,cAAAA,GAAiB,IAAI19D,GAzHvBuS,KAA4B,CAAA,SAAjB,CAAA,IAAAA,EAAQorD,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE/jE,MAAAA,AAAAA,KAChCN,IAAAA,CAAKskE,YAAAA,CAAarrD,EAAQorD,SAAAA;YAE9B;YAMO,aAAapqD,CAAAA,EAAAA;gBAClBja,IAAAA,CAAKia,MAAAA,GAASA,GACdja,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EAClDna,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MACrD;YAAA;YASO,MAAA,eAAMkqD;gBACX,OAAA,MAAahgE,QAAQC,OAAAA;YACvB;YAKO,MAAA,eAAMggE,CAEb;YAKO,MAAA,cAAMC;gBAAAA,MAELjkD,EAAM,KAAKxgB,IAAAA,CAAKia,MAAAA,CAAOyG,KAAAA;YAC/B;YAMO,YAAYikD,CAAAA,EAAAA;gBACjB3kE,IAAAA,CAAKikE,UAAAA,CAAWtkE,IAAAA,CAAKglE;YACvB;YAMO,aAAaN,CAAAA,EAAAA;gBAClB,IAAI7jE,IAAI;gBACR,MAAMmX,IAAM0sD,EAAU/jE,MAAAA;gBAEtB,MAAQE,IAAImX,GAAKnX,IACfR,IAAAA,CAAK0kE,WAAAA,CAAYL,CAAAA,CAAU7jE,EAAAA;YAE/B;YAEO,uBAAAokE;gBACL5kE,IAAAA,CAAKkkE,UAAAA;YACP;YAKA,IAAA,WAAWW;gBACT,MAAMC,IAAQ9kE,IAAAA,CAAKikE,UAAAA,CAAW3jE,MAAAA;gBAC9B,OAAOwkE,IAAQ,IAAIp4D,EAAM1M,IAAAA,CAAKkkE,UAAAA,EAAY,GAAGY,KAASA,IAAQ;YAChE;YAKO,WAAAj7C;gBACL,OAAO7pB,IAAAA,CAAKkkE,UAAAA,KAAelkE,IAAAA,CAAKikE,UAAAA,CAAW3jE,MAC7C;YAAA;YASA,SAAS2Z,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACvB92C,IAAAA,CAAKmkE,YAAAA,IAAgBrtB;YAEvB;YAKA,OAAO1f,CAAAA,EAAAA;gBACL,MAAM8yB,IAAUlqD,IAAAA,CAAKmkE,YAAAA,GAAe;gBAEpC/sC,EAAIxiB,SAAAA,GAAYxC,EAAMyC,KAAAA,CAAM3B,MAAAA,IAC5BkkB,EAAIm7B,QAAAA,CAAS,GAAG,GAAGvyD,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EAAOna,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA,GAEtF+c,EAAI7O,IAAAA,IACJ6O,EAAIza,SAAAA,CAAU3c,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,GAAQ,GAAGna,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA,GAAS;gBAC9F,MAAMw6B,IAAkB,KAAVqV;gBACd9yB,EAAIgiB,WAAAA,GAAc,SAClBhiB,EAAI4gB,SAAAA,GAAY,IAChB5gB,EAAIogB,OAAAA,GAAU,SACdpgB,EAAIgjB,GAAAA,CAAI,GAAG,GAAG,IAAIvF,GAAOA,IAAmB,IAAVvvC,KAAK8G,EAAAA,GAAU,IACjDgrB,EAAImU,MAAAA,IAEJnU,EAAIxiB,SAAAA,GAAY,SAChBwiB,EAAI2jB,IAAAA,GAAO;gBACX,MAAMnnB,IAAAA,AAAwB,CAAA,MAAhB5zB,IAAAA,CAAK6kE,QAAAA,AAAAA,EAAgB1yD,OAAAA,CAAQ,KAAK,KAC1C4yD,IAAU3tC,EAAI/C,WAAAA,CAAYT,IAC1BzZ,IAAQ7U,KAAKyH,GAAAA,CAAIg4D,EAAQnpB,qBAAAA,IAAyBt2C,KAAKyH,GAAAA,CAAIg4D,EAAQlpB,sBAAAA,GACnExhC,IAAS/U,KAAKyH,GAAAA,CAAIg4D,EAAQvpB,uBAAAA,IAA2Bl2C,KAAKyH,GAAAA,CAAIg4D,EAAQtpB,wBAAAA;gBAC5ErkB,EAAItc,QAAAA,CAAS8Y,GAAAA,CAAOzZ,IAAQ,GAAGE,IAAS,IACxC+c,EAAI5O,OAAAA;YACN;YAGO,qBAAAw8C;gBACL,OAA+B,MAA3BhlE,IAAAA,CAAKikE,UAAAA,CAAW3jE,MAAAA,GAEXiE,QAAQC,OAAAA,KAEVxE,IAAAA,CAAKokE,cAAAA,CAAev9D,OAC7B;YAAA;YAQO,MAAA,OAAMojB;gBAAAA,MACLjqB,IAAAA,CAAKwkE,YAAAA,IACXxkE,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,eACjBnI,IAAAA,CAAKsZ,MAAAA,CAAO02B,SAAAA,IAAAA,MAENzrC,QAAQ8+D,GAAAA,CACZrjE,IAAAA,CAAKikE,UAAAA,CAAWhkE,GAAAA,CAAIglE,OAAOhiE;oBACzBjD,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,qBAAqBlF,IAAAA,MAChCA,EAAEgnB,IAAAA,GAAOi7C,OAAAA,CAAQ;wBAErBllE,IAAAA,CAAKkkE,UAAAA,IACLlkE,IAAAA,CAAKsZ,MAAAA,CAAO02B,SAAAA,IACZhwC,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,mBAAmBlF;oBAAE;gBACtC;gBAKN,KAAK,MAAMkiE,KAAYnlE,IAAAA,CAAKikE,UAAAA,CACtBkB,aAAoBjD,MACtBiD,EAASzC,UAAAA,CAAW1iE,IAAAA,CAAKia,MAAAA;gBAe7B,OAXAja,IAAAA,CAAKokE,cAAAA,CAAe5/D,OAAAA,IACpBxE,IAAAA,CAAKsZ,MAAAA,CAAO02B,SAAAA,IAAAA,MAINhwC,IAAAA,CAAKukE,YAAAA,IACXvkE,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,eAAA,MACX2zD,GAASC,MAAAA,IAAAA,MAET/7D,IAAAA,CAAKykE,WAAAA,IACXzkE,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cACTnI,IAAAA,CAAKyB,IAAAA,GAAOzB,IAAAA,CAAKikE,UAC3B;YAAA;YAIO,KAAyDv8D,CAAAA,EAAuBU,CAAAA,EAAAA;gBACrFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAuDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF3H,IAAAA,CAAKka,MAAAA,CAAerS,GAAAA,CAAIH,GAAWC;YACtC;QAAA;QAAA,IAAA,KAAA,EAAA;QC3KK,MAAMy9D,WAAerB;YA8C1B,IAAA,SAAcsB;gBAOZ,OANKrlE,IAAAA,CAAKslE,aAAAA,IACRtlE,CAAAA,IAAAA,CAAKslE,aAAAA,GAAgB,IAAIvzC,OACzB/xB,IAAAA,CAAKslE,aAAAA,CAAc1yC,MAAAA,GAAS,IAAM5yB,IAAAA,CAAKulE,YAAAA,CAAa/gE,OAAAA,IACpDxE,IAAAA,CAAKslE,aAAAA,CAAc1zC,GAAAA,GAAM5xB,IAAAA,CAAKwlE,IAAAA,AAAAA,GAGzBxlE,IAAAA,CAAKslE,aACd;YAAA;YAGA,IAAA,wBAAWG;gBACT,OAAOzlE,IAAAA,CAAK0lE,sBACd;YAAA;YACA,IAAA,oBAAWC;gBACT,OAAO3lE,IAAAA,CAAK4lE,kBACd;YAAA;YAMA,IAAA,cAAcC;gBACZ,MAAMC,IAAevsD,SAASw+C,cAAAA,CAAe;gBAmB7C,OAlBI+N,KACF9lE,CAAAA,IAAAA,CAAK0lE,sBAAAA,GAAyBI,CAAAA,GAE3B9lE,IAAAA,CAAK0lE,sBAAAA,IACR1lE,CAAAA,IAAAA,CAAK0lE,sBAAAA,GAAyBnsD,SAASC,aAAAA,CAAc,QACrDxZ,IAAAA,CAAK0lE,sBAAAA,CAAuB9lE,EAAAA,GAAK,uBACjCI,IAAAA,CAAK0lE,sBAAAA,CAAuB/rD,KAAAA,CAAMC,QAAAA,GAAW,YAC7CL,SAASO,IAAAA,CAAKC,WAAAA,CAAY/Z,IAAAA,CAAK0lE,sBAAAA,CAAAA,GAE5B1lE,IAAAA,CAAK+lE,WAAAA,IACR/lE,CAAAA,IAAAA,CAAK+lE,WAAAA,GAAcxsD,SAASC,aAAAA,CAAc,UAC1CxZ,IAAAA,CAAK+lE,WAAAA,CAAYC,WAAAA,GAAchmE,IAAAA,CAAKimE,iBAAAA,EACpC1sD,SAAS2sD,IAAAA,CAAKnsD,WAAAA,CAAY/Z,IAAAA,CAAK+lE,WAAAA,CAAAA,GAE5B/lE,IAAAA,CAAK4lE,kBAAAA,IACR5lE,CAAAA,IAAAA,CAAK4lE,kBAAAA,GAAqB5lE,IAAAA,CAAKmmE,kBAAAA,IAC/BnmE,IAAAA,CAAK0lE,sBAAAA,CAAuB3rD,WAAAA,CAAY/Z,IAAAA,CAAK4lE,kBAAAA,CAAAA,GAExC5lE,IAAAA,CAAK4lE,kBACd;YAAA;YA8BA,YAAYQ,CAAAA,CAAAA;gBACV,MAAMntD,IAAUlP,MAAMoX,OAAAA,CAAQilD,KAC1B;oBACE/B,WAAW+B;gBAAAA,IAEbA;gBACJx5C,KAAAA,CAAM3T,IA5HA,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAMjB,IAAA,CAAAgvD,gBAAAA,GAAkC;oBAAEhC,WAAW,EAAA;gBAAA,GAChD,IAAA,CAAAnqD,MAAAA,GAAS,IAAIhT,GAEZ,IAAA,CAAAo/D,gBAAAA,GAAAA,CAA4B,GAK7B,IAAA,CAAAd,IAAAA,GC1GT,0qHD2GS,IAAA,CAAAe,SAAAA,GAAY,KACZ,IAAA,CAAAC,UAAAA,GAAa,KAoBb,IAAA,CAAAC,eAAAA,GAAyBr0D,EAAM0C,KAAAA,EAK/B,IAAA,CAAA05C,eAAAA,GAA0B,WAGvB,IAAA,CAAA+W,YAAAA,GAA6B,IAAI7+D,GAWpC,IAAA,CAAAggE,kBAAAA,GAAAA,CAA8B,GAW3B,IAAA,CAAAT,iBAAAA,GAA4B,GAAA,CAAA,CAAUlmE,QAAAA,IA2BzC,IAAA,CAAA4mE,cAAAA,GAAyB,aAKzB,IAAA,CAAAR,kBAAAA,GAAqB;oBAC1B,IAAIS,IAAmCrtD,SAASw+C,cAAAA,CAAe;oBAQ/D,OAPK6O,KACHA,CAAAA,IAAgBrtD,SAASC,aAAAA,CAAc,SAAA,GAGzCotD,EAAchnE,EAAAA,GAAK,kBACnBgnE,EAAcZ,WAAAA,GAAchmE,IAAAA,CAAK2mE,cAAAA,EACjCC,EAAcjtD,KAAAA,CAAMktD,OAAAA,GAAU,QACvBD;gBAAa,GAkBpB5mE,IAAAA,CAAKqmE,gBAAAA,GAAmB;oBAAA,GAAKjB,GAAO0B,uBAAAA;oBAAAA,GAA4B7tD,CAAAA;gBAAAA;YAClE;YAEgB,aAAagB,CAAAA,EAAAA;gBAC3Bja,IAAAA,CAAKia,MAAAA,GAASA,GACdja,IAAAA,CAAKgU,MAAAA,GAASiG,EAAOjG,MAAAA,EACrBhU,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAOa,KAAAA,EACvCna,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAOe,MAAAA,EACxCra,IAAAA,CAAKgU,MAAAA,CAAOkG,MAAAA,CAAOzS,EAAAA,CAAG,UAAU;oBAC9BzH,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAOa,KAAAA,EACvCna,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAOe,MAAM;gBAAA;YAElD;YAKO,MAAA,iBAAM0sD;gBAAAA,IAAAA,GAAAA;gBACX,IAAA,CAAI/mE,IAAAA,CAAK0mE,kBAAAA,EAIF;oBACL,MAAMM,IAAgB;wBACpB,IAAA;4BACEhnE,IAAAA,CAAKinE,mBAAAA;wBACP,EAAE,OAAA,GAAA,CAEF;oBAAA;oBAEa,CAAA,SAAX,CAAA,IAAAjnE,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEk7C,OAAAA,AAAAA,KACfn1D,IAAAA,CAAKia,MAAAA,CAAOk7C,OAAAA,CAAQ3xD,MAAAA,CAAOiE,EAAAA,CAAG,UAAUu/D,IAE1ChnE,IAAAA,CAAKsmE,gBAAAA,GAAAA,CAAmB,GACxBtmE,IAAAA,CAAK6lE,WAAAA,CAAYlsD,KAAAA,CAAMktD,OAAAA,GAAU,SACjCttD,SAASO,IAAAA,CAAKuQ,gBAAAA,CAAiB,SAAU68C,CAAAA;wBACvB,YAAZA,EAAI5kE,GAAAA,IACNtC,IAAAA,CAAK6lE,WAAAA,CAAYsB,KAAAA;oBACnB,IAEFnnE,IAAAA,CAAKinE,mBAAAA;oBACL,MAAMG,IAAoB,IAAI7iE,QAAeC,CAAAA;wBAC3C,MAAM6iE,IAAsB/nD,CAAAA;4BAAAA,IAAAA;4BAS1B,IAPAA,EAAEiiC,eAAAA,IAEFvhD,IAAAA,CAAKsnE,cAAAA,IAAAA,AACU,CAAA,SAAX,CAAA,IAAAtnE,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEk7C,OAAAA,AAAAA,KACfn1D,IAAAA,CAAKia,MAAAA,CAAOk7C,OAAAA,CAAQ3xD,MAAAA,CAAOqE,GAAAA,CAAI,UAAUm/D,IAGvChnE,IAAAA,CAAKqmE,gBAAAA,CAAiBkB,mBAAAA,EACxB,IAAA;gCACEvnE,IAAAA,CAAK6sB,OAAAA,CAAQ1U,IAAAA,CAAK,0BACdnY,IAAAA,CAAKqmE,gBAAAA,CAAiBmB,mBAAAA,YAA+BC,cACvDznE,IAAAA,CAAKqmE,gBAAAA,CAAiBmB,mBAAAA,CAAoBxP,iBAAAA,KAE1Ch4D,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO6jD,eAAAA,CAAgB73D,IAAAA,CAAKqmE,gBAAAA,CAAiBmB,mBAAAA;4BAE7D,EAAE,OAAOvgE,GAAAA;gCACPjH,IAAAA,CAAK6sB,OAAAA,CAAQ5lB,KAAAA,CAAM,2BAA2BA;4BAChD;4BAGFzC;wBAAS;wBAEXxE,IAAAA,CAAK6lE,WAAAA,CAAYx7C,gBAAAA,CAAiB,SAASg9C,IAC3CrnE,IAAAA,CAAK6lE,WAAAA,CAAYx7C,gBAAAA,CAAiB,YAAYg9C,IAC9CrnE,IAAAA,CAAK6lE,WAAAA,CAAYx7C,gBAAAA,CAAiB,aAAag9C,IAC3CrnE,IAAAA,CAAKia,MAAAA,IACPja,IAAAA,CAAKia,MAAAA,CAAOytD,KAAAA,CAAMC,QAAAA,CAAS7/D,IAAAA,CAAK,UAAU,IAAMu/D,EAAmB,IAAIO,MAAM;oBAC/E;oBAGF,OAAA,MAAaR;gBACf;gBAxDEpnE,IAAAA,CAAKsnE,cAAAA,IAAAA,MAEC9mD,EAAM,KAAgB,SAAX,CAAA,IAAAxgB,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEyG,KAAAA;YAuDlC;YAEO,iBAAA4mD;gBACLtnE,IAAAA,CAAKsmE,gBAAAA,GAAAA,CAAmB,GACxBtmE,IAAAA,CAAK6lE,WAAAA,CAAYlsD,KAAAA,CAAMktD,OAAAA,GAAU;YACnC;YAKO,UAAAz3C;gBACDpvB,IAAAA,CAAK0lE,sBAAAA,CAAuBpP,aAAAA,IAC9Bt2D,CAAAA,IAAAA,CAAK0lE,sBAAAA,CAAuBne,WAAAA,CAAYvnD,IAAAA,CAAK4lE,kBAAAA,GAC7CrsD,SAASO,IAAAA,CAAKytC,WAAAA,CAAYvnD,IAAAA,CAAK0lE,sBAAAA,GAC/BnsD,SAAS2sD,IAAAA,CAAK3e,WAAAA,CAAYvnD,IAAAA,CAAK+lE,WAAAA,GAC/B/lE,IAAAA,CAAK0lE,sBAAAA,GAAyB,MAC9B1lE,IAAAA,CAAK4lE,kBAAAA,GAAqB,MAC1B5lE,IAAAA,CAAK+lE,WAAAA,GAAc,IAAA;YAEvB;YAIgB,MAAA,eAAMxB;gBAAAA,IAAAA;gBAAAA,MAEd/jD,EAAM,KAAgB,SAAX,CAAA,IAAAxgB,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEyG,KAAAA,GAC9B1gB,IAAAA,CAAKsZ,MAAAA,CAAO02B,SAAAA,IAAAA,MAENhwC,IAAAA,CAAK+mE,cAAAA;YACb;YAEgB,MAAA,eAAMvC;gBACpBxkE,IAAAA,CAAKgU,MAAAA,CAAO8iD,yBAAAA,IACZ92D,IAAAA,CAAKgU,MAAAA,CAAOoG,UAAAA,GAAa;oBAAED,OAAOna,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA;oBAAOE,QAAQra,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA;gBAAAA,GACzEra,IAAAA,CAAKgU,MAAAA,CAAOsgD,0BAAAA;gBACZ,MAAM3nC,IAAQ3sB,IAAAA,CAAKqlE,MAAAA;gBAAAA,MACbrlE,IAAAA,CAAKulE,YAAAA,CAAa1+D,OAAAA,EAAAA,MAClB8lB,CAAAA,QAAAA,IAAAA,KAAK,IAALA,EAAOk7C,MAAAA,EAAAA;YACf;YAGgB,MAAA,cAAMpD;gBACpBzkE,IAAAA,CAAKgU,MAAAA,CAAOijD,wBAAAA,IACZj3D,IAAAA,CAAKgU,MAAAA,CAAOsgD,0BAAAA,IACZt0D,IAAAA,CAAKovB,OAAAA;YACP;YAEQ,sBAAA63C;gBACN,IAAIjnE,IAAAA,CAAKia,MAAAA,EAAQ;oBACf,MAAA,EAAQ3N,GAAGkO,CAAAA,EAAMpQ,GAAGqQ,CAAAA,EAAKN,OAAOw+C,CAAAA,EAAat+C,QAAQq+C,CAAAA,EAAAA,GAAiB14D,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAO2G,qBAAAA;oBACzF,IAAIjgB,IAAAA,CAAK0lE,sBAAAA,EAAwB;wBAC/B,MAAMoC,IAAc9nE,IAAAA,CAAK6lE,WAAAA,CAAY1K,WAAAA,EAC/B4M,IAAe/nE,IAAAA,CAAK6lE,WAAAA,CAAYzK,YAAAA;wBAClCp7D,IAAAA,CAAKgoE,kBAAAA,GACPhoE,CAAAA,IAAAA,CAAK0lE,sBAAAA,CAAuB/rD,KAAAA,CAAMa,IAAAA,GAAO,GAAGxa,IAAAA,CAAKgoE,kBAAAA,CAAmB17D,CAAAA,CAAAA,EAAAA,CAAAA,EACpEtM,IAAAA,CAAK0lE,sBAAAA,CAAuB/rD,KAAAA,CAAMc,GAAAA,GAAM,GAAGza,IAAAA,CAAKgoE,kBAAAA,CAAmB59D,CAAAA,CAAAA,EAAAA,CAAAA,AAAAA,IAEnEpK,CAAAA,IAAAA,CAAK0lE,sBAAAA,CAAuB/rD,KAAAA,CAAMa,IAAAA,GAAUA,IAAOm+C,IAAc,IAAImP,IAAc,IAA1C,MACzC9nE,IAAAA,CAAK0lE,sBAAAA,CAAuB/rD,KAAAA,CAAMc,GAAAA,GAASA,IAAMi+C,IAAe,IAAIqP,IAAe,IAAI,MAA/C,IAAA;oBAE5C;gBACF;YACF;YAOgB,OAAO3wC,CAAAA,EAAAA;gBACrB,MAAMoiC,IAAex5D,IAAAA,CAAKia,MAAAA,CAAOu/C,YAAAA,GAAex5D,IAAAA,CAAKia,MAAAA,CAAOs6C,UAAAA,EACtD+E,IAAct5D,IAAAA,CAAKia,MAAAA,CAAOq/C,WAAAA,GAAct5D,IAAAA,CAAKia,MAAAA,CAAOs6C,UAAAA;gBAE1Dv0D,IAAAA,CAAKinE,mBAAAA,IAEL7vC,EAAIxiB,SAAAA,GAAY5U,IAAAA,CAAKwuD,eAAAA,EACrBp3B,EAAIm7B,QAAAA,CAAS,GAAG,GAAG+G,GAAaE;gBAEhC,IAAIyO,IAAQzO,IAAe;gBAC3B,MAAMr/C,IAAQ7U,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKumE,SAAAA,EAAyB,MAAdjN;gBACvC,IAAI4O,IAAQ5O,IAAc,IAAIn/C,IAAQ;gBAElCna,IAAAA,CAAKmoE,YAAAA,IACPD,CAAAA,IAAQloE,IAAAA,CAAKmoE,YAAAA,CAAa77D,CAAAA,EAC1B27D,IAAQjoE,IAAAA,CAAKmoE,YAAAA,CAAa/9D,CAAAA,AAAAA;gBAG5B,MAAM2/B,IAAczkC,KAAKoF,KAAAA,CAAMyP,IAASna,CAAAA,IAAAA,CAAKwmE,UAAAA,GAAaxmE,IAAAA,CAAKumE,SAAAA,AAAAA,IACzD6B,IAAepoE,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+6C,YAAAA;gBASxC,IARA/uD,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+6C,YAAAA,GAAAA,CAAe,GAC7B/uD,IAAAA,CAAKmoE,YAAAA,GAGR/wC,EAAI5J,SAAAA,CAAUxtB,IAAAA,CAAKqlE,MAAAA,EAAQ,GAAG,GAAGrlE,IAAAA,CAAKumE,SAAAA,EAAWvmE,IAAAA,CAAKwmE,UAAAA,EAAY0B,GAAOD,GAAO9tD,GAAO4vB,KAFvF3S,EAAI5J,SAAAA,CAAUxtB,IAAAA,CAAKqlE,MAAAA,EAAQ,GAAG,GAAGrlE,IAAAA,CAAKumE,SAAAA,EAAWvmE,IAAAA,CAAKwmE,UAAAA,EAAY0B,GAAOD,IAAQl+B,IAAc,IAAI5vB,GAAO4vB,IAAAA,CAMvG/pC,IAAAA,CAAK0mE,kBAAAA,IAAsB1mE,IAAAA,CAAKsmE,gBAAAA,EAEnC,OAAA,KADAtmE,CAAAA,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+6C,YAAAA,GAAeqZ,CAAAA;gBAIpC,IAAIC,IAAWH,GACXI,IAAWL;gBACXjoE,IAAAA,CAAKuoE,kBAAAA,IACPF,CAAAA,IAAWroE,IAAAA,CAAKuoE,kBAAAA,CAAmBj8D,CAAAA,EACnCg8D,IAAWtoE,IAAAA,CAAKuoE,kBAAAA,CAAmBn+D,CAAAA,AAAAA,GAGrCgtB,EAAI4gB,SAAAA,GAAY,GAChB,GAAmB5gB,GAAKixC,GAAUC,GAAUnuD,GAAO,IAAI,IAAIna,IAAAA,CAAKymE,eAAAA;gBAChE,MAEM+B,IAFWruD,IAAQna,IAAAA,CAAK6kE,QAAAA,GAEGluC;gBAEjC,GACES,GACAixC,IALa,GAMbC,IANa,GAObE,IAAgB,KAAKA,IAAgB,IALxB,IAOb,GACA,MACAxoE,IAAAA,CAAKymE,eAAAA,GAEPzmE,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+6C,YAAAA,GAAeqZ;YACpC;QAAA;QAtUe,GAAAtB,uBAAAA,GAAyC;YACtDzC,WAAW,EAAA;YACXkD,qBAAAA,CAAqB;YACrBC,qBAAAA,KAAqB1mE;QAAAA;QE1FzB,MAAM2nE,KAA+C;YACnDC,OAAO;YACPC,UAAU;YACVC,YAAY;QAAA;QAiCP,MAAMC;YAKX,aAAA;gBAJQ,IAAA,CAAAC,SAAAA,GAA8B,MAE/B,IAAA,CAAAC,WAAAA,GAAwB,EAAA,EA+FvB,IAAA,CAAAC,cAAAA,GAAgC;oBAEtCC,eAAe;wBACb,MAAMC,IAAO3vD,SAASC,aAAAA,CAAc;wBACpC,OAAA,CAAA,CAAA,CAAU0vD,EAAKxvD,UAAAA,IAAAA,CAAcwvD,EAAKxvD,UAAAA,CAAW,KAAA;oBAC/C;oBAGAyvD,oBAAoB;wBAClB,MAAMC,IAAM,IAAIj/C;wBAChBi/C,EAAIh/C,IAAAA,CAAK,OAAO;wBAChB,IAAA;4BACEg/C,EAAI1/C,YAAAA,GAAe;wBACrB,EAAE,OAAOpK,GAAAA;4BACP,OAAA,CAAO;wBACT;wBACA,OAA4B,kBAArB8pD,EAAI1/C,YACb;oBAAA;oBAGA2/C,gBAAgB;wBAEd,OAAmE,MADpD9vD,SAASC,aAAAA,CAAc,UACxB8vD,SAAAA,CAAU,aAAa7gE,OAAAA,CAAQ;oBAC/C;oBAGA8gE,kBAAkB;wBAChB,OAAO,SAAS/lE,UAAU,qBAAqBkvB,OAAO,qBAAqBA;oBAC7E;oBAGA82C,aAAa;wBACX,MAAM7vD,IAAQJ,SAASC,aAAAA,CAAc,KAAKG,KAAAA;wBAE1C,OADAA,EAAM8vD,OAAAA,GAAU,yCAAA,AACR,CAAA,KAAK9vD,EAAM60C,eAAAA,AAAAA,EAAiB/lD,OAAAA,CAAQ,UAAA;oBAC9C;gBAAA,GAIM,IAAA,CAAAihE,YAAAA,GAA6B;oBACnCC,iBAAiB;wBACf,OAAA,CAAA,CACQnmE,CAAAA,OAAQU,YAAAA,IACRV,OAAQW,kBAAAA,IACRX,OAAQkB,eAAAA,IACRlB,OAAQmB,cAAAA,IACRnB,OAAQoB,aAAAA,AAAAA;oBAElB;oBACAglE,cAAc;wBACZ,MAAMV,IAAO3vD,SAASC,aAAAA,CAAc;wBACpC,OAAA,CAAA,CAAA,CAAU0vD,EAAKxvD,UAAAA,IAAAA,CAAcwvD,EAAKxvD,UAAAA,CAAW,QAAA;oBAC/C;gBAAA,GAhJA1Z,IAAAA,CAAK8oE,SAAAA,GAAY9oE,IAAAA,CAAK6pE,oBAAAA;YACxB;YAOO,qBAAAC;gBAIL,OAHuB,SAAnB9pE,IAAAA,CAAK8oE,SAAAA,IACP9oE,CAAAA,IAAAA,CAAK8oE,SAAAA,GAAY9oE,IAAAA,CAAK6pE,oBAAAA,EAAAA,GAEjB7pE,IAAAA,CAAK8oE,SACd;YAAA;YAMO,qBAAAiB;gBACL,IAAIC,IAAM;gBACV,MAAMtyD,IAAO;oBAAC;oBAAkC;iBAAA,EAE1Cm2C,IAAiB7tD,IAAAA,CAAK8pE,kBAAAA;gBAC5B,KAAK,MAAMG,KAAWznE,OAAO+D,IAAAA,CAAKkiE,IAC5B5a,CAAAA,CAAUoc,EAAAA,GACZD,CAAAA,KAAO,gBACPtyD,EAAK/X,IAAAA,CAAK,oCACV+X,EAAK/X,IAAAA,CAAK,sCAAA,IAEVqqE,CAAAA,KAAO,gBACPtyD,EAAK/X,IAAAA,CAAK,kCACV+X,EAAK/X,IAAAA,CAAK,sCAAA,GAGZqqE,KAAO,MAAMvB,EAAAA,CAAkBwB,EAAAA,GAAW;gBAG5CvyD,EAAKoB,OAAAA,CAAQkxD,IAEbpxD,QAAQhB,GAAAA,CAAImB,KAAAA,CAAMH,SAASlB;YAC7B;YAMQ,uBAAAmyD;gBACN,OAAO;oBAELvwD,QAAQ,AAAA,CAAA,IACCtZ,IAAAA,CAAKgpE,cAAAA,CAAeC,aAAAA,EAAAA;oBAI7B9L,aAAa,AAAA,CAAA,IACJn9D,IAAAA,CAAKgpE,cAAAA,CAAeG,kBAAAA,EAAAA;oBAI7Be,SAAS,AAAA,CAAA,IACAlqE,IAAAA,CAAKgpE,cAAAA,CAAeK,cAAAA,EAAAA;oBAI7Bc,WAAW,AAAA,CAAA,IACFnqE,IAAAA,CAAKgpE,cAAAA,CAAeO,gBAAAA,EAAAA;oBAI7Ba,MAAM,AAAA,CAAA,IACGpqE,IAAAA,CAAKgpE,cAAAA,CAAeQ,WAAAA,EAAAA;oBAI7Bb,UAAU,AAAA,CAAA,IACD3oE,IAAAA,CAAK0pE,YAAAA,CAAaC,eAAAA,EAAAA;oBAI3BjB,OAAO,AAAA,CAAA,IACE1oE,IAAAA,CAAK0pE,YAAAA,CAAaE,YAAAA,EAAAA;oBAI3BhB,YAAAA,CAAAA,CACiByB,UAAWC,WAAAA;gBAAAA;YAGhC;YA0DO,OAAAtgD;gBAEL,IAAIugD,IAAAA,CAAiB;gBACrB,IAAK,MAAMvgD,KAAQhqB,IAAAA,CAAKgpE,cAAAA,CACjBhpE,IAAAA,CAAKgpE,cAAAA,CAAoCh/C,EAAAA,CAAMhnB,IAAAA,CAAKhD,IAAAA,KACvDA,CAAAA,IAAAA,CAAK+oE,WAAAA,CAAYppE,IAAAA,CAAKqqB,IACtBpT,EAAOS,WAAAA,GAAcpQ,KAAAA,CAAM,yDAAyD+iB,IACpFugD,IAAAA,CAAiB,CAAA;gBAGrB,IAAIA,GACF,OAAA,CAAO;gBAIT,IAAK,MAAMC,KAAWxqE,IAAAA,CAAK0pE,YAAAA,CACpB1pE,IAAAA,CAAK0pE,YAAAA,CAAiCc,EAAAA,MACzC5zD,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,6EAA6EmyD;gBAI3G,OAAA,CAAO;YACT;QAAA;QCtNF,IAAYC,ICMAC,ICNAC;QAAAA,CFAZ,SAAYF,CAAAA;YAKV,EAAA,gBAAA,GAAA,oBAMA,EAAA,OAAA,GAAA,WAMA,EAAA,MAAA,GAAA,UASA,EAAA,KAAA,GAAA;QACD,EA3BWA,MAAAA,CAAAA,KAAa,CAAA,CAAA;QGElB,MAAMG;YAaJ,OAAA,OAAcn8C,CAAAA,EAAco8C,CAAAA,EAAAA;gBACjC,IAAI7qE,IAAAA,CAAK8qE,cAAAA,GAAiB9qE,IAAAA,CAAK+qE,WAAAA,EAC7B,MAAM,IAAI5kE,MAAM,CAAA,sBAAA,EAAyBnG,IAAAA,CAAK+qE,WAAAA,CAAAA,iBAAAA,CAAAA;gBAEhD,IAAI/qE,IAAAA,CAAKgrE,OAAAA,CAAQroE,GAAAA,CAAI8rB,IAAO;oBAC1B,MAAMw8C,IAAgBjrE,IAAAA,CAAKgrE,OAAAA,CAAQroE,GAAAA,CAAI8rB;oBACvC,IAAIw8C,EAAcJ,IAAAA,KAASA,GACzB,OAAOI;oBAET,MAAM,IAAI9kE,MAAM,CAAA,gBAAA,EAAmBsoB,EAAAA,sCAAAA,CAAAA;gBACrC;gBACA,MAAMy8C,IAAQ,IAAIC,GAAe18C,GAAMzuB,IAAAA,CAAKorE,YAAAA,EAAAA,KAAuBtqE,MAAT+pE,IAAqBA,IAAAA,CAAQ7qE,IAAAA,CAAKorE,YAAAA;gBAI5F,OAHAprE,IAAAA,CAAKorE,YAAAA,GAAgBprE,IAAAA,CAAKorE,YAAAA,IAAgB,GAC1CprE,IAAAA,CAAK8qE,cAAAA,IACL9qE,IAAAA,CAAKgrE,OAAAA,CAAQhgD,GAAAA,CAAIyD,GAAMy8C,IAChBA;YACT;YAKO,WAAA,SAAWhwC;gBAChB,OAAOnxB,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAKgrE,OAAAA,CAAQ9jB,MAAAA;YACjC;YAMO,OAAA,YAAmBz4B,CAAAA,EAAAA;gBACxB,OAAOzuB,IAAAA,CAAKgrE,OAAAA,CAAQroE,GAAAA,CAAI8rB;YAC1B;YAKO,OAAA,QAAO9S;gBACZ3b,IAAAA,CAAKgrE,OAAAA,GAAU,IAAI18C,KACnBtuB,IAAAA,CAAKorE,YAAAA,GAAeprE,IAAAA,CAAKsrE,aAAAA,EACzBtrE,IAAAA,CAAK8qE,cAAAA,GAAiB;YACxB;QAAA;QAnDe,GAAAQ,aAAAA,GAAgB,GAChB,GAAAP,WAAAA,GAAc,IACd,GAAAD,cAAAA,GAAiB,GACjB,GAAAM,YAAAA,GAAeR,GAAsBU,aAAAA,EACrC,GAAAN,OAAAA,GAAuC,IAAI18C;QCkCrD,MAAM68C;YAkBX,YAAY18C,CAAAA,EAAc88C,CAAAA,EAAkBV,CAAAA,CAAAA;gBAC1C7qE,IAAAA,CAAK8sC,KAAAA,GAAQre,GACbzuB,IAAAA,CAAKwrE,SAAAA,GAAYD,GACjBvrE,IAAAA,CAAKyrE,KAAAA,GAAQZ;YACf;YAKA,IAAA,OAAWp8C;gBACT,OAAOzuB,IAAAA,CAAK8sC,KACd;YAAA;YAKA,IAAA,WAAWy+B;gBACT,OAAOvrE,IAAAA,CAAKwrE,SACd;YAAA;YAKA,IAAA,OAAWX;gBACT,OAAO7qE,IAAAA,CAAKyrE,KACd;YAAA;YAQO,WAAWxsD,CAAAA,EAAAA;gBAChB,MAAM0sD,IAAW3rE,IAAAA,CAAKurE,QAAAA,GAAWtsD,EAAM4rD,IAAAA,EACjCe,IAAW5rE,IAAAA,CAAK6qE,IAAAA,GAAO5rD,EAAMssD,QAAAA;gBACnC,OAAoB,MAAbI,KAA+B,MAAbC;YAC3B;YAOO,SAAA13D;gBACL,MAAMg3D,IAAQN,GAAsB/O,MAAAA,CAAO,OAAO77D,IAAAA,CAAKyuB,IAAAA,GAAO,KAAkB,IAAA,CAAZzuB,IAAAA,CAAK6qE,IAAAA;gBAEzE,OADAK,EAAMM,SAAAA,GAAAA,CAAaxrE,IAAAA,CAAKurE,QAAAA,EACjBL;YACT;YAMO,OAAA,QAAeW,CAAAA,EAAAA;gBACpB,MAAMC,IAAeD,EAAgB5rE,GAAAA,CAAKwU,CAAAA,IAAMA,EAAEga,IAAAA,EAAMluB,IAAAA,CAAK,MAEvDwrE,IAAAA,CADmBF,EAAgBn3C,MAAAA,CAAO,CAAChM,GAASrW,IAAMA,EAAEk5D,QAAAA,GAAW7iD,GAAS;gBAGtF,OAAOkiD,GAAsB/O,MAAAA,CAAOiQ,GAAcC;YACpD;YAMO,OAAA,aAAoBF,CAAAA,EAAAA;gBACzB,MAAMC,IAAe,CAAA,aAAA,EAAgBD,EAAgB5rE,GAAAA,CAAKwU,CAAAA,IAAMA,EAAEga,IAAAA,EAAMluB,IAAAA,CAAK,KAAA,CAAA,CAAA,EACvEwrE,IAAeF,EAAgBn3C,MAAAA,CAAO,CAAChM,GAASrW,IAAMA,EAAEk5D,QAAAA,GAAW7iD,GAAS;gBAClF,OAAOkiD,GAAsB/O,MAAAA,CAAOiQ,GAAcC;YACpD;YAEO,WAAAhsE;gBACL,OAAO,CAAA,YAAA,EACCC,IAAAA,CAAKurE,QAAAA,CAASxrE,QAAAA,CAAS,GAAGksE,QAAAA,CAAS,IAAI,KAAA,YAAA,EAAA,AACtCjsE,CAAAA,IAAAA,CAAK6qE,IAAAA,KAAS,CAAA,EAAG9qE,QAAAA,CAAS,GAAGksE,QAAAA,CAAS,IAAI,KAAA,MAAA,CAErD;YAAA;QAAA;QA1Fc,GAAAC,GAAAA,GAAM,IAAIf,GAAe,2BAAA,IAA4B;QCzC9D,MAAMgB;YAEX,YACSC,CAAAA,EACAC,CAAAA,CAAAA;gBADA,IAAA,CAAAD,SAAAA,GAAAA,GACA,IAAA,CAAAC,SAAAA,GAAAA,GAHF,IAAA,CAAAzsE,EAAAA,GAAa,MAKlBI,IAAAA,CAAKJ,EAAAA,GAAKusE,GAAKG,iBAAAA,CAAkBF,EAAUxsE,EAAAA,EAAIysE,EAAUzsE,EAAAA;YAC3D;YAOO,OAAA,WAAkBwsE,CAAAA,EAAqBC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAE5C,IAAID,EAAUxsE,EAAAA,KAAOysE,EAAUzsE,EAAAA,EAC7B,OAAA,CAAO;gBAIT,IAAIwsE,EAAUx6B,KAAAA,IAASy6B,EAAUz6B,KAAAA,IAASw6B,EAAUx6B,KAAAA,CAAMhyC,EAAAA,KAAOysE,EAAUz6B,KAAAA,CAAMhyC,EAAAA,EAC/E,OAAA,CAAO;gBAIT,IAAIwsE,EAAUlgD,WAAAA,CAAY7P,iBAAAA,MAAuBgwD,EAAUngD,WAAAA,CAAY7P,iBAAAA,IACrE,OAAA,CAAO;gBAGT,MAAMkwD,IAAwB,SAAhB,CAAA,IAAAH,QAAAA,IAAAA,KAAS,IAATA,EAAWx6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC9BC,IAAwB,SAAhB,CAAA,IAAAJ,QAAAA,IAAAA,KAAS,IAATA,EAAWz6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;gBAIpC,OAAA,CAAA,CAAA,CAAKD,KAAAA,CAAUE,CAAAA,KAAAA,CAAAA,CAKVF,EAAMrB,KAAAA,CAAMQ,UAAAA,CAAWe,EAAMvB,KAAAA,KAAAA,AAK9BqB,CAAAA,EAAMG,aAAAA,KAAkBjC,GAAc1V,KAAAA,IAAS0X,EAAMC,aAAAA,KAAkBjC,GAAc1V,KAAAA,AAAAA,KAKrF0X,EAAMC,aAAAA,KAAkBjC,GAAckC,gBAAAA,IAAoBJ,EAAMG,aAAAA,KAAkBjC,GAAckC,gBAAAA,IAAAA,CAAAA,CAAAA,CAK/FJ,EAAMtmB,QAAAA,IAAAA,CAAawmB,EAAMxmB,QAAAA,AAAAA;YAKhC;YAKA,IAAA,aAAWylB;gBACT,MAAMU,IAAYpsE,IAAAA,CAAKosE,SAAAA,EACjBC,IAAYrsE,IAAAA,CAAKqsE,SAAAA;gBACvB,OAAOF,GAAKT,UAAAA,CAAWU,GAAWC;YACpC;YAKO,UAAAO;gBACL,OAAO5sE,IAAAA,CAAKosE,SAAAA,CAAUQ,OAAAA,CAAQ5sE,IAAAA,CAAKqsE,SAAAA;YACrC;YAMO,YAAYS,CAAAA,EAAAA;gBACjB,OAAOA,MAAa9sE,IAAAA,CAAKosE,SAAAA,IAAaU,MAAa9sE,IAAAA,CAAKqsE,SAC1D;YAAA;YAKO,OAAA,kBAAyBU,CAAAA,EAAqBC,CAAAA,EAAAA;gBACnD,OAAID,EAAI3pE,KAAAA,GAAQ4pE,EAAI5pE,KAAAA,GACX,CAAA,CAAA,EAAI2pE,EAAI3pE,KAAAA,CAAAA,CAAAA,EAAS4pE,EAAI5pE,KAAAA,EAAAA,GAErB,CAAA,CAAA,EAAI4pE,EAAI5pE,KAAAA,CAAAA,CAAAA,EAAS2pE,EAAI3pE,KAAAA,EAEhC;YAAA;QAAA;QCpGK,MAAM6pE;YACX,YACSziE,CAAAA,EACAjF,CAAAA,CAAAA;gBADA,IAAA,CAAAiF,GAAAA,GAAAA,GACA,IAAA,CAAAjF,GAAAA,GAAAA;YACN;YACI,SAAS2nE,CAAAA,EAAAA;gBACd,OAAOltE,IAAAA,CAAKuF,GAAAA,GAAM2nE,EAAW1iE,GAAAA,IAAO0iE,EAAW3nE,GAAAA,GAAMvF,IAAAA,CAAKwK,GAC5D;YAAA;YAEO,WAAW0iE,CAAAA,EAAAA;gBAChB,OAAIltE,IAAAA,CAAKof,QAAAA,CAAS8tD,KACZltE,IAAAA,CAAKuF,GAAAA,GAAM2nE,EAAW3nE,GAAAA,GACjB2nE,EAAW3nE,GAAAA,GAAMvF,IAAAA,CAAKwK,GAAAA,GAEtBxK,IAAAA,CAAKuF,GAAAA,GAAM2nE,EAAW1iE,GAAAA,GAG1B;YACT;QAAA;QCVK,MAAM4iE;YAMX,YAAmBl9B,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GACjBlwC,IAAAA,CAAKkwC,MAAAA,GAASA,KAAU,MACxBlwC,IAAAA,CAAKyB,IAAAA,GAAO,MACZzB,IAAAA,CAAKg1B,MAAAA,GAAS,IAAI1Z,GAClBtb,IAAAA,CAAKwa,IAAAA,GAAO,MACZxa,IAAAA,CAAKwb,KAAAA,GAAQ,MACbxb,IAAAA,CAAKqa,MAAAA,GAAS;YAChB;YAEO,SAAAgzD;gBACL,OAAA,CAAQrtE,IAAAA,CAAKwa,IAAAA,IAAAA,CAASxa,IAAAA,CAAKwb,KAC7B;YAAA;QAAA;QAgBK,MAAM8xD;YAGX,YACUC,CAAAA,EACDC,IAA2B,IAAIlyD,EAAAA,CAAaiD,OAAOC,SAAAA,EAAAA,CAAYD,OAAOC,SAAAA,EAAWD,OAAOC,SAAAA,EAAWD,OAAOC,SAAAA,CAAAA,CAAAA;gBADzG,IAAA,CAAA+uD,OAAAA,GAAAA,GACD,IAAA,CAAAC,WAAAA,GAAAA,GAEPxtE,IAAAA,CAAKb,IAAAA,GAAO,MACZa,IAAAA,CAAKytE,KAAAA,GAAQ,CAAC;YAChB;YAKQ,QAAQE,CAAAA,EAAAA;gBAEd,IAAkB,SAAd3tE,IAAAA,CAAKb,IAAAA,EAGP,OAFAa,IAAAA,CAAKb,IAAAA,GAAOwuE,GAAAA,KACZ3tE,CAAAA,IAAAA,CAAKb,IAAAA,CAAK+wC,MAAAA,GAAS,IAAA;gBAKrB,MAAM09B,IAAWD,EAAK34C,MAAAA;gBACtB,IAAI64C,IAAc7tE,IAAAA,CAAKb,IAAAA;gBACvB,MAAA,CAAQ0uE,EAAYR,MAAAA,IAAU;oBAC5B,MAAM7yD,IAAOqzD,EAAYrzD,IAAAA,EACnBgB,IAAQqyD,EAAYryD,KAAAA,EAEpBsyD,IAAOD,EAAY74C,MAAAA,CAAOrX,YAAAA,IAE1BowD,IADeF,EAAY74C,MAAAA,CAAOhW,OAAAA,CAAQ4uD,GACdjwD,YAAAA,IAG5BqwD,IAAO,IAAID,GAGXE,IAAkB,IAAKF,CAAAA,IAAeD,CAAAA;oBAG5C,IAAII,IAAW;oBACf,MAAMC,IAAeP,EAAS5uD,OAAAA,CAAQxE,EAAKwa,MAAAA;oBAC3C,IAAIo5C,GACAC;oBACA7zD,EAAK6yD,MAAAA,KACPa,IAAWC,EAAaxwD,YAAAA,KAAiBswD,IAEzCI,CAAAA,IAAU7zD,EAAKwa,MAAAA,CAAOrX,YAAAA,IACtBywD,IAAUD,EAAaxwD,YAAAA,IACvBuwD,IAAWE,IAAUC,IAAUJ,CAAAA;oBAGjC,IAAIK,IAAY;oBAChB,MAAMC,IAAgBX,EAAS5uD,OAAAA,CAAQxD,EAAMwZ,MAAAA;oBAU7C,IATIxZ,EAAM6xD,MAAAA,KACRiB,IAAYC,EAAc5wD,YAAAA,KAAiBswD,IAE3CI,CAAAA,IAAU7yD,EAAMwZ,MAAAA,CAAOrX,YAAAA,IACvBywD,IAAUG,EAAc5wD,YAAAA,IACxB2wD,IAAYF,IAAUC,IAAUJ,CAAAA,GAI9BD,IAAOE,KAAYF,IAAOM,GAC5B;oBAKAT,IADEK,IAAWI,IACC9zD,IAEAgB;gBAElB;gBAGA,MAAMgzD,IAAYX,EAAY39B,MAAAA,EACxBu+B,IAAY,IAAIrB,GAASoB;gBAC/BC,EAAUz5C,MAAAA,GAAS44C,EAAS5uD,OAAAA,CAAQ6uD,EAAY74C,MAAAA,GAChDy5C,EAAUp0D,MAAAA,GAASwzD,EAAYxzD,MAAAA,GAAS,GAEtB,SAAdm0D,IAEEA,CAAAA,EAAUh0D,IAAAA,KAASqzD,IACrBW,EAAUh0D,IAAAA,GAAOi0D,IAEjBD,EAAUhzD,KAAAA,GAAQizD,GAGpBA,EAAUj0D,IAAAA,GAAOqzD,GACjBY,EAAUjzD,KAAAA,GAAQmyD,GAElBE,EAAY39B,MAAAA,GAASu+B,GACrBd,EAAKz9B,MAAAA,GAASu+B,CAAAA,IAGdA,CAAAA,EAAUj0D,IAAAA,GAAOqzD,GACjBY,EAAUjzD,KAAAA,GAAQmyD,GAElBE,EAAY39B,MAAAA,GAASu+B,GACrBd,EAAKz9B,MAAAA,GAASu+B,GACdzuE,IAAAA,CAAKb,IAAAA,GAAOsvE,CAAAA;gBAId,IAAIC,IAAcf,EAAKz9B,MAAAA;gBACvB,MAAOw+B,GAAa;oBAGlB,IAFAA,IAAc1uE,IAAAA,CAAK2uE,QAAAA,CAASD,IAAAA,CAEvBA,EAAYl0D,IAAAA,EACf,MAAM,IAAIrU,MAAM,yDAAyDuoE;oBAE3E,IAAA,CAAKA,EAAYlzD,KAAAA,EACf,MAAM,IAAIrV,MAAM,0DAA0DuoE;oBAG5EA,EAAYr0D,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAImpE,EAAYl0D,IAAAA,CAAKH,MAAAA,EAAQq0D,EAAYlzD,KAAAA,CAAMnB,MAAAA,GAC7Eq0D,EAAY15C,MAAAA,GAAS05C,EAAYl0D,IAAAA,CAAKwa,MAAAA,CAAOhW,OAAAA,CAAQ0vD,EAAYlzD,KAAAA,CAAMwZ,MAAAA,GAEvE05C,IAAcA,EAAYx+B,MAC5B;gBAAA;YACF;YAKQ,QAAQy9B,CAAAA,EAAAA;gBACd,IAAIA,MAAS3tE,IAAAA,CAAKb,IAAAA,EAEhB,OAAA,KADAa,CAAAA,IAAAA,CAAKb,IAAAA,GAAO,IAAA;gBAId,MAAM+wC,IAASy9B,EAAKz9B,MAAAA,EACd0+B,IAAc1+B,EAAOA,MAAAA;gBAC3B,IAAI2+B;gBAOJ,IALEA,IADE3+B,EAAO11B,IAAAA,KAASmzD,IACRz9B,EAAO10B,KAAAA,GAEP00B,EAAO11B,IAAAA,EAGfo0D,GAAa;oBACXA,EAAYp0D,IAAAA,KAAS01B,IACvB0+B,EAAYp0D,IAAAA,GAAOq0D,IAEnBD,EAAYpzD,KAAAA,GAAQqzD,GAEtBA,EAAQ3+B,MAAAA,GAAS0+B;oBAEjB,IAAIF,IAAcE;oBAClB,MAAOF,GACLA,IAAc1uE,IAAAA,CAAK2uE,QAAAA,CAASD,IAC5BA,EAAY15C,MAAAA,GAAS05C,EAAYl0D,IAAAA,CAAKwa,MAAAA,CAAOhW,OAAAA,CAAQ0vD,EAAYlzD,KAAAA,CAAMwZ,MAAAA,GACvE05C,EAAYr0D,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAImpE,EAAYl0D,IAAAA,CAAKH,MAAAA,EAAQq0D,EAAYlzD,KAAAA,CAAMnB,MAAAA,GAE7Eq0D,IAAcA,EAAYx+B,MAE9B;gBAAA,OACElwC,IAAAA,CAAKb,IAAAA,GAAO0vE,GACZA,EAAQ3+B,MAAAA,GAAS;YAErB;YAKO,cAAc48B,CAAAA,EAAAA;gBACnB,MAAMiC,IAAO,IAAI3B;gBACjB2B,EAAKttE,IAAAA,GAAOqrE,GACZiC,EAAK/5C,MAAAA,GAAS83C,EAAS93C,MAAAA,EACvB+5C,EAAK/5C,MAAAA,CAAOxa,IAAAA,IAAQ,GACpBu0D,EAAK/5C,MAAAA,CAAOva,GAAAA,IAAO,GACnBs0D,EAAK/5C,MAAAA,CAAOxZ,KAAAA,IAAS,GACrBuzD,EAAK/5C,MAAAA,CAAOvZ,MAAAA,IAAU,GACtBzb,IAAAA,CAAKytE,KAAAA,CAAMX,EAASltE,EAAAA,CAAGwD,KAAAA,CAAAA,GAAS2rE,GAChC/uE,IAAAA,CAAK0tE,OAAAA,CAAQqB;YACf;YAKO,eAAejC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACpB,MAAMiC,IAAO/uE,IAAAA,CAAKytE,KAAAA,CAAMX,EAASltE,EAAAA,CAAGwD,KAAAA,CAAAA;gBACpC,IAAA,CAAK2rE,GACH,OAAA,CAAO;gBAET,MAAMz8D,IAAIw6D,EAAS93C,MAAAA;gBAGnB,IAAA,CAAKh1B,IAAAA,CAAKwtE,WAAAA,CAAYzuD,QAAAA,CAASzM,IAK7B,OAJAsE,EAAOS,WAAAA,GAAcgB,IAAAA,CACnB,sBAAsBy0D,EAASltE,EAAAA,CAAGwD,KAAAA,GAAQ,2EAE5CpD,IAAAA,CAAKivE,eAAAA,CAAgBnC,IAAAA,CACd;gBAGT,IAAIiC,EAAK/5C,MAAAA,CAAOjW,QAAAA,CAASzM,IACvB,OAAA,CAAO;gBAUT,IAPAtS,IAAAA,CAAKkpD,OAAAA,CAAQ6lB,IACbz8D,EAAEkI,IAAAA,IAAQxa,IAAAA,CAAKutE,OAAAA,CAAQ2B,aAAAA,EACvB58D,EAAEmI,GAAAA,IAAOza,IAAAA,CAAKutE,OAAAA,CAAQ2B,aAAAA,EACtB58D,EAAEkJ,KAAAA,IAASxb,IAAAA,CAAKutE,OAAAA,CAAQ2B,aAAAA,EACxB58D,EAAEmJ,MAAAA,IAAUzb,IAAAA,CAAKutE,OAAAA,CAAQ2B,aAAAA,EAGrBpC,EAASl7B,KAAAA,EAAO;oBAClB,MAAM93B,IAAqB,SAAd,CAAA,IAAAgzD,EAASl7B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;oBACjC,IAAI1yD,GAAM;wBACR,MAAMq1D,IAAwB,KAAbr1D,EAAK0vC,GAAAA,CAAIl9C,CAAAA,GAAU,MAAQtM,IAAAA,CAAKutE,OAAAA,CAAQ6B,kBAAAA,EACnDC,IAAwB,KAAbv1D,EAAK0vC,GAAAA,CAAIp/C,CAAAA,GAAU,MAAQpK,IAAAA,CAAKutE,OAAAA,CAAQ6B,kBAAAA;wBAErDD,IAAS,IACX78D,EAAEkI,IAAAA,IAAQ20D,IAEV78D,EAAEkJ,KAAAA,IAAS2zD,GAGTE,IAAS,IACX/8D,EAAEmI,GAAAA,IAAO40D,IAET/8D,EAAEmJ,MAAAA,IAAU4zD;oBAEhB;gBACF;gBAIA,OAFAN,EAAK/5C,MAAAA,GAAS1iB,GACdtS,IAAAA,CAAK0tE,OAAAA,CAAQqB,IAAAA,CACN;YACT;YAKO,gBAAgBjC,CAAAA,EAAAA;gBACrB,MAAMiC,IAAO/uE,IAAAA,CAAKytE,KAAAA,CAAMX,EAASltE,EAAAA,CAAGwD,KAAAA,CAAAA;gBAC/B2rE,KAGL/uE,CAAAA,IAAAA,CAAKkpD,OAAAA,CAAQ6lB,IACb/uE,IAAAA,CAAKytE,KAAAA,CAAMX,EAASltE,EAAAA,CAAGwD,KAAAA,CAAAA,GAAS,MAAA,OACzBpD,IAAAA,CAAKytE,KAAAA,CAAMX,EAASltE,EAAAA,CAAGwD,KAAAA,CAAAA,AAAAA;YAChC;YAKQ,SAAS2rE,CAAAA,EAAAA;gBACf,IAAa,SAATA,GACF,MAAM,IAAI5oE,MAAM;gBAGlB,IAAI4oE,EAAK1B,MAAAA,MAAY0B,EAAK10D,MAAAA,GAAS,GACjC,OAAO00D;gBAGT,MAAMv0D,IAAOu0D,EAAKv0D,IAAAA,EACZgB,IAAQuzD,EAAKvzD,KAAAA,EAEbpZ,IAAI2sE,GACJz8D,IAAIkI,GACJ/F,IAAI+G,GACJrZ,IAAIqY,EAAKA,IAAAA,EACT8E,IAAI9E,EAAKgB,KAAAA,EACTy5B,IAAIz5B,EAAMhB,IAAAA,EACVnI,IAAImJ,EAAMA,KAAAA,EAEV8zD,IAAU76D,EAAE4F,MAAAA,GAAS/H,EAAE+H,MAAAA;gBAE7B,IAAIi1D,IAAU,GAyCZ,OAvCA76D,EAAE+F,IAAAA,GAAOpY,GACTqS,EAAEy7B,MAAAA,GAAS9tC,EAAE8tC,MAAAA,EACb9tC,EAAE8tC,MAAAA,GAASz7B,GAIPA,EAAEy7B,MAAAA,GACAz7B,EAAEy7B,MAAAA,CAAO11B,IAAAA,KAASpY,IACpBqS,EAAEy7B,MAAAA,CAAO11B,IAAAA,GAAO/F,IAEhBA,EAAEy7B,MAAAA,CAAO10B,KAAAA,GAAQ/G,IAGnBzU,IAAAA,CAAKb,IAAAA,GAAOsV,GAIVwgC,EAAE56B,MAAAA,GAAShI,EAAEgI,MAAAA,GACf5F,CAAAA,EAAE+G,KAAAA,GAAQy5B,GACV7yC,EAAEoZ,KAAAA,GAAQnJ,GACVA,EAAE69B,MAAAA,GAAS9tC,GAEXA,EAAE4yB,MAAAA,GAAS1iB,EAAE0iB,MAAAA,CAAOhW,OAAAA,CAAQ3M,EAAE2iB,MAAAA,GAC9BvgB,EAAEugB,MAAAA,GAAS5yB,EAAE4yB,MAAAA,CAAOhW,OAAAA,CAAQi2B,EAAEjgB,MAAAA,GAE9B5yB,EAAEiY,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAI+M,EAAE+H,MAAAA,EAAQhI,EAAEgI,MAAAA,GACpC5F,EAAE4F,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAInD,EAAEiY,MAAAA,EAAQ46B,EAAE56B,MAAAA,CAAAA,IAEpC5F,CAAAA,EAAE+G,KAAAA,GAAQnJ,GACVjQ,EAAEoZ,KAAAA,GAAQy5B,GACVA,EAAE/E,MAAAA,GAAS9tC,GAEXA,EAAE4yB,MAAAA,GAAS1iB,EAAE0iB,MAAAA,CAAOhW,OAAAA,CAAQi2B,EAAEjgB,MAAAA,GAC9BvgB,EAAEugB,MAAAA,GAAS5yB,EAAE4yB,MAAAA,CAAOhW,OAAAA,CAAQ3M,EAAE2iB,MAAAA,GAE9B5yB,EAAEiY,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAI+M,EAAE+H,MAAAA,EAAQ46B,EAAE56B,MAAAA,GACpC5F,EAAE4F,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAInD,EAAEiY,MAAAA,EAAQhI,EAAEgI,MAAAA,CAAAA,GAG/B5F;gBAGT,IAAI66D,IAAAA,IAAc;oBAOhB,IALAh9D,EAAEkI,IAAAA,GAAOpY,GACTkQ,EAAE49B,MAAAA,GAAS9tC,EAAE8tC,MAAAA,EACb9tC,EAAE8tC,MAAAA,GAAS59B,GAGPA,EAAE49B,MAAAA;wBACJ,IAAI59B,EAAE49B,MAAAA,CAAO11B,IAAAA,KAASpY,GACpBkQ,EAAE49B,MAAAA,CAAO11B,IAAAA,GAAOlI;6BACX;4BACL,IAAIA,EAAE49B,MAAAA,CAAO10B,KAAAA,KAAUpZ,GACrB,MAAM;4BAERkQ,EAAE49B,MAAAA,CAAO10B,KAAAA,GAAQlJ;wBACnB;2BAEAtS,IAAAA,CAAKb,IAAAA,GAAOmT;oBAyBd,OArBInQ,EAAEkY,MAAAA,GAASiF,EAAEjF,MAAAA,GACf/H,CAAAA,EAAEkJ,KAAAA,GAAQrZ,GACVC,EAAEoY,IAAAA,GAAO8E,GACTA,EAAE4wB,MAAAA,GAAS9tC,GAEXA,EAAE4yB,MAAAA,GAASvgB,EAAEugB,MAAAA,CAAOhW,OAAAA,CAAQM,EAAE0V,MAAAA,GAC9B1iB,EAAE0iB,MAAAA,GAAS5yB,EAAE4yB,MAAAA,CAAOhW,OAAAA,CAAQ7c,EAAE6yB,MAAAA,GAE9B5yB,EAAEiY,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAIkP,EAAE4F,MAAAA,EAAQiF,EAAEjF,MAAAA,GACpC/H,EAAE+H,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAInD,EAAEiY,MAAAA,EAAQlY,EAAEkY,MAAAA,CAAAA,IAEpC/H,CAAAA,EAAEkJ,KAAAA,GAAQ8D,GACVld,EAAEoY,IAAAA,GAAOrY,GACTA,EAAE+tC,MAAAA,GAAS9tC,GAEXA,EAAE4yB,MAAAA,GAASvgB,EAAEugB,MAAAA,CAAOhW,OAAAA,CAAQ7c,EAAE6yB,MAAAA,GAC9B1iB,EAAE0iB,MAAAA,GAAS5yB,EAAE4yB,MAAAA,CAAOhW,OAAAA,CAAQM,EAAE0V,MAAAA,GAE9B5yB,EAAEiY,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAIkP,EAAE4F,MAAAA,EAAQlY,EAAEkY,MAAAA,GACpC/H,EAAE+H,MAAAA,GAAS,IAAI/U,KAAKC,GAAAA,CAAInD,EAAEiY,MAAAA,EAAQiF,EAAEjF,MAAAA,CAAAA,GAE/B/H;gBACT;gBAEA,OAAOy8D;YACT;YAKO,YAAAQ;gBACL,OAAkB,SAAdvvE,IAAAA,CAAKb,IAAAA,GACA,IAEFa,IAAAA,CAAKb,IAAAA,CAAKkb,MACnB;YAAA;YASO,MAAMyyD,CAAAA,EAAkBjpE,CAAAA,EAAAA;gBAC7B,MAAMmxB,IAAS83C,EAAS93C,MAAAA,EAClBy6C,IAAUf,CAAAA;oBACd,IAAIA,KAAeA,EAAY15C,MAAAA,CAAO5V,QAAAA,CAAS4V,IAAS;wBACtD,IAAA,CAAI05C,EAAYrB,MAAAA,MAAYqB,EAAYjtE,IAAAA,KAASqrE,GAK/C,OAAO2C,EAAOf,EAAYl0D,IAAAA,KAASi1D,EAAOf,EAAYlzD,KAAAA;wBAJtD,IAAI3X,EAASb,IAAAA,CAAK8pE,GAAU4B,EAAYjtE,IAAAA,GACtC,OAAA,CAAO;oBAKb;oBACA,OAAA,CAAO;gBAAK;gBAEdguE,EAAOzvE,IAAAA,CAAKb,IAAAA;YACd;YAUO,aAAa8e,CAAAA,EAAU1Y,IAAcqJ,IAAAA,CAAAA,EAAU/K,CAAAA,EAAAA;gBACpD,MAAM4rE,IAAUf,CAAAA;oBACd,IAAIA,KAAeA,EAAY15C,MAAAA,CAAOhX,OAAAA,CAAQC,GAAK1Y,IAAM;wBACvD,IAAA,CAAImpE,EAAYrB,MAAAA,IAOd,OAAOoC,EAAOf,EAAYl0D,IAAAA,KAASi1D,EAAOf,EAAYlzD,KAAAA;wBANtD,IAAI3X,EAASb,IAAAA,CAAKib,GAAKywD,EAAYjtE,IAAAA,GAEjC,OAAA,CAAO;oBAMb;oBACA,OAAA,CAAO;gBAAK;gBAEdguE,EAAOzvE,IAAAA,CAAKb,IAAAA;YACd;YAEO,WAAAwwE;gBACL,MAAMF,IAAUf,CAAAA,IACVA,IACK;wBAACA;qBAAAA,CAAaruE,MAAAA,CAAOovE,EAAOf,EAAYl0D,IAAAA,GAAOi1D,EAAOf,EAAYlzD,KAAAA,KAElE,EAAA;gBAGX,OAAOi0D,EAAOzvE,IAAAA,CAAKb,IAAAA;YACrB;YAEO,MAAM2gB,CAAAA,EAAAA;gBAEX,MAAM2vD,IAAUf,CAAAA;oBACVA,KACEA,CAAAA,EAAYrB,MAAAA,KACdqB,EAAY15C,MAAAA,CAAOnV,IAAAA,CAAKC,GAAI1N,EAAM4D,KAAAA,IAElC04D,EAAY15C,MAAAA,CAAOnV,IAAAA,CAAKC,GAAI1N,EAAM0C,KAAAA,GAGhC45D,EAAYl0D,IAAAA,IACdi1D,EAAOf,EAAYl0D,IAAAA,GAEjBk0D,EAAYlzD,KAAAA,IACdi0D,EAAOf,EAAYlzD,KAAAA,CAAAA;gBAEvB;gBAGFi0D,EAAOzvE,IAAAA,CAAKb,IAAAA;YACd;QAAA;QC5eK,MAAMywE;YAQX,YAAY/0D,CAAAA,EAAayD,CAAAA,CAAAA;gBACvBte,IAAAA,CAAK6a,GAAAA,GAAMA,GACX7a,IAAAA,CAAKse,GAAAA,GAAMA,EAAItO,SAAAA;YACjB;YAOO,UAAU8kB,CAAAA,EAAAA;gBACf,MAAM+6C,IAAY/6C,EAAKg7C,KAAAA,CAAMv/D,GAAAA,CAAIvQ,IAAAA,CAAK6a,GAAAA;gBAGtC,IAAwC,MAApC7a,IAAAA,CAAKse,GAAAA,CAAI1N,KAAAA,CAAMkkB,EAAKi7C,QAAAA,OAAmD,MAA9BF,EAAUj/D,KAAAA,CAAM5Q,IAAAA,CAAKse,GAAAA,GAChE,OAAA;gBAIF,MAAM0xD,IAAUhwE,IAAAA,CAAKse,GAAAA,CAAI1N,KAAAA,CAAMkkB,EAAKi7C,QAAAA;gBACpC,IAAgB,MAAZC,GACF,OAAA;gBAGF,MAAMx5D,IAAIq5D,EAAUj/D,KAAAA,CAAMkkB,EAAKi7C,QAAAA,MAAcC;gBAE7C,IAAIx5D,KAAK,GAAG;oBACV,MAAM66C,IAAIwe,EAAUj/D,KAAAA,CAAM5Q,IAAAA,CAAKse,GAAAA,IAAO0xD,IAAUl7C,EAAKm7C,SAAAA;oBACrD,IAAI5e,KAAK,KAAKA,KAAK,GACjB,OAAO76C;gBAEX;gBACA,OAAA;YACF;YAEO,eAAese,CAAAA,EAAAA;gBACpB,MAAMmpB,IAAOj+C,IAAAA,CAAKwf,SAAAA,CAAUsV;gBAC5B,OAAImpB,IAAO,IACF,OAEFj+C,IAAAA,CAAKmwE,QAAAA,CAASlyB;YACvB;YAKO,SAASA,CAAAA,EAAAA;gBACd,OAAOj+C,IAAAA,CAAK6a,GAAAA,CAAIzK,GAAAA,CAAIpQ,IAAAA,CAAKse,GAAAA,CAAIrO,KAAAA,CAAMguC;YACrC;QAAA;QCrCK,MAAMmyB;YAOX,YAAoB7C,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,OAAAA,GAAAA,GALZ,IAAA,CAAA8C,MAAAA,GAAS,IAAIp5D,KAEb,IAAA,CAAAq5D,mBAAAA,GAA8B,EAAA,EAC9B,IAAA,CAAAC,UAAAA,GAAyB,EAAA,EAG/BvwE,IAAAA,CAAKwwE,qBAAAA,GAAwB,IAAIlD,GAAsBC,EAAQkD,WAAAA;YACjE;YAEO,eAAAC;gBACL,OAAO1wE,IAAAA,CAAKuwE,UACd;YAAA;YAIO,MAAMI,CAAAA,EAAAA;gBACX,MAAM98C,IAAsB,EAAA;gBA0B5B,OAzBI88C,aAAyBr1D,IAC3Btb,IAAAA,CAAKwwE,qBAAAA,CAAsBhB,KAAAA,CACzB;oBACE5vE,IAAI4G,EAAS,YAAA;oBACborC,OAAO;oBACP5c,QAAQ27C;gBAAAA,GAET1xD,CAAAA,IACC4U,CAAAA,EAAQl0B,IAAAA,CAAKsf,IAAAA,CACN,CAAA,KAIXjf,IAAAA,CAAKwwE,qBAAAA,CAAsBhB,KAAAA,CACzB;oBACE5vE,IAAI4G,EAAS,YAAA;oBACborC,OAAO;oBACP5c,QAAQ,IAAI1Z,EAAYq1D,EAAcrkE,CAAAA,EAAGqkE,EAAcvmE,CAAAA,EAAGumE,EAAcrkE,CAAAA,EAAGqkE,EAAcvmE,CAAAA;gBAAAA,GAE1F6U,CAAAA,IACC4U,CAAAA,EAAQl0B,IAAAA,CAAKsf,IAAAA,CACN,CAAA,IAIN4U;YACT;YAEO,QAAQ5V,CAAAA,EAAUhF,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBACvB,MAAM4a,IAAwB,EAAA,EACxB+8C,IAAkC,SAApB,CAAA,IAAA33D,QAAAA,IAAAA,KAAO,IAAPA,EAAS23D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIhiE,IAAAA,GACtCiiE,IAAiB53D,QAAAA,IAAAA,KAAO,IAAPA,EAAS43D,cAAAA,EAC1BC,IAAiBD,IAAyEA,EAAetF,QAAAA,GAAjD,SAAtB,CAAA,IAAAtyD,QAAAA,IAAAA,KAAO,IAAPA,EAAS63D,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAI3F,GAAee,GAAAA,CAAIX,QAAAA,EAC/EwF,IAAgD,SAA3B,CAAA,IAAA93D,QAAAA,IAAAA,KAAO,IAAPA,EAAS83D,kBAAAA,AAAAA,KAAAA,KAAkB,MAAA,KAAA;gBAqCtD,OApCA/wE,IAAAA,CAAKwwE,qBAAAA,CAAsBd,YAAAA,CAAazxD,GAAK2yD,GAAc9D,CAAAA;oBACzD,MACMkE,IADQlE,EAASl7B,KAAAA,CACCjvC,GAAAA,CAAI6pE;oBAE5B,IAAA,AAAIvzD,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASg4D,uBAAAA,AAAAA,KAA2BD,EAAU9F,KAAAA,KAAUC,GAAee,GAAAA,EACzE,OAAA,CAAO;oBAGT,MAAMR,IAAAA,CAAAA,CAAcoF,CAAAA,IAAgBE,EAAU9F,KAAAA,CAAMK,QAAAA,AAAAA;oBAGpD,IAAA,AAAIyF,CAAAA,QAAAA,IAAAA,KAAS,IAATA,EAAW9F,KAAAA,AAAAA,KAAAA,CAAUQ,GACvB,OAAA,CAAO;oBAGT,MAAMwF,IAAMpE,EAAS9uD,OAAAA,CAAQC,GAAK2yD;oBAElC,IAAIM,GACF;wBAAA,IAAIj4D,QAAAA,IAAAA,KAAO,IAAPA,EAASjR,MAAAA,EAAAA;4BACX,IAAIiR,EAAQjR,MAAAA,CAAOkpE,MACjBr9C,CAAAA,EAAQl0B,IAAAA,CAAKuxE,IAAAA,CACRH,CAAAA,GAEH,OAAA,CAAO;wBAAA,OAKX,IADAl9C,EAAQl0B,IAAAA,CAAKuxE,IAAAA,CACRH,GAEH,OAAA,CAAO;oBAAA;oBAIb,OAAA,CAAO;gBAAK,IAEPl9C;YACT;YAKO,MAAMxS,CAAAA,EAAAA;gBACX,IAAKA;oBAIL,IAAIA,aAAkB8vD,IAAmB;wBACvC,MAAMC,IAAY/vD,EAAOqvD,YAAAA;wBACzB,KAAK,MAAMj8D,KAAK28D,EACd38D,EAAEm9B,KAAAA,GAAQvwB,EAAOuwB,KAAAA,EACjB5xC,IAAAA,CAAKuwE,UAAAA,CAAW5wE,IAAAA,CAAK8U,IACrBzU,IAAAA,CAAKwwE,qBAAAA,CAAsB1B,aAAAA,CAAcr6D;oBAE7C,OACEzU,IAAAA,CAAKuwE,UAAAA,CAAW5wE,IAAAA,CAAK0hB,IACrBrhB,IAAAA,CAAKwwE,qBAAAA,CAAsB1B,aAAAA,CAAcztD;uBAZzCzK,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK;YAc9B;YAKO,QAAQgJ,CAAAA,EAAAA;gBACb,IAAKA;oBAKL,IAAIA,aAAkB8vD,IAAmB;wBACvC,MAAMC,IAAY/vD,EAAOqvD,YAAAA;wBACzB,KAAK,MAAMj8D,KAAK28D,EAAW;4BACzB,MAAM5lE,IAAQxL,IAAAA,CAAKuwE,UAAAA,CAAW9nE,OAAAA,CAAQgM;4BAAAA,OAClCjJ,KACFxL,IAAAA,CAAKuwE,UAAAA,CAAW7nE,MAAAA,CAAO8C,GAAO,IAEhCxL,IAAAA,CAAKwwE,qBAAAA,CAAsBvB,eAAAA,CAAgBx6D;wBAC7C;oBACF,OAAO;wBACL,MAAMjJ,IAAQxL,IAAAA,CAAKuwE,UAAAA,CAAW9nE,OAAAA,CAAQ4Y;wBAAAA,OAClC7V,KACFxL,IAAAA,CAAKuwE,UAAAA,CAAW7nE,MAAAA,CAAO8C,GAAO,IAEhCxL,IAAAA,CAAKwwE,qBAAAA,CAAsBvB,eAAAA,CAAgB5tD;oBAC7C;uBAnBEzK,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK;YAoB9B;YAEQ,YAAY+zD,CAAAA,EAAqBC,CAAAA,EAAAA;gBAEvC,MAAM/uB,IAAO6uB,GAAKG,iBAAAA,CAAkBF,EAAUxsE,EAAAA,EAAIysE,EAAUzsE,EAAAA;gBAC5D,OAAOI,IAAAA,CAAKqwE,MAAAA,CAAOt4D,GAAAA,CAAIulC;YACzB;YAKO,WAAWk0B,CAAAA,EAAqB16B,CAAAA,EAAiB0L,CAAAA,EAAAA;gBACtD,MAAM0H,IAAUpT,IAAU,KAGpB26B,IAAqBD,EAAQxpE,MAAAA,CAAQiX,CAAAA;oBAAAA,IAAAA,GAAAA;oBACzC,MAAMnF,IAAkB,SAAX,CAAA,IAAAmF,EAAM2yB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;oBAC9B,OAAA,AAAkB,CAAA,SAAX,CAAA,IAAAvtD,EAAM2yB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEqU,QAAAA,AAAAA,KAAYnsC,EAAK4yD,aAAAA,KAAkBjC,GAAckC,gBAAgB;gBAAA;gBAQvF,IAAIG;gBAJJ9sE,IAAAA,CAAKswE,mBAAAA,GAAsB,EAAA,EAC3BtwE,IAAAA,CAAKqwE,MAAAA,CAAO7oE,KAAAA;gBAIZ,IAAK,IAAIkqE,IAAI,GAAG1+D,IAAIy+D,EAAmBnxE,MAAAA,EAAQoxE,IAAI1+D,GAAG0+D,IACpD5E,IAAW2E,CAAAA,CAAmBC,EAAAA,EAE9B1xE,IAAAA,CAAKwwE,qBAAAA,CAAsBhB,KAAAA,CAAM1C,GAAW7tD,CAAAA;oBAC1C,IAAA,CAAKjf,IAAAA,CAAKsxE,WAAAA,CAAYxE,GAAU7tD,MAAUktD,GAAKT,UAAAA,CAAWoB,GAAU7tD,IAAQ;wBAC1E,MAAM0yD,IAAO,IAAIxF,GAAKW,GAAU7tD;wBAChCjf,IAAAA,CAAKqwE,MAAAA,CAAOjgE,GAAAA,CAAIuhE,EAAK/xE,EAAAA,GACrBI,IAAAA,CAAKswE,mBAAAA,CAAoB3wE,IAAAA,CAAKgyE;oBAChC;oBAEA,OAAA,CAAO;gBAAK;gBAShB,IANInvB,KACFA,CAAAA,EAAMovB,OAAAA,CAAQC,KAAAA,GAAQ7xE,IAAAA,CAAKswE,mBAAAA,CAAoBhwE,MAAAA,AAAAA,GAK7CN,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWC,kBAAAA,EAC1B,KAAK,MAAMjF,KAAY2E,EAAoB;oBACzC,MAAM33D,IAAOgzD,EAASl7B,KAAAA,CAAMjvC,GAAAA,CAAI6pE;oBAEhC,IAAI1yD,EAAK4yD,aAAAA,KAAkBjC,GAAcuH,MAAAA,EACvC;oBAIF,MAAMC,IACJn4D,EAAK0vC,GAAAA,CAAI55C,SAAAA,GAAYs6C,IACA,KAArBpwC,EAAK2vC,GAAAA,CAAI75C,SAAAA,GAAkBs6C,IAAUA,GAGjCgoB,IAAe5sE,KAAKkF,GAAAA,CAAIsiE,EAAS93C,MAAAA,CAAO3a,MAAAA,EAAQyyD,EAAS93C,MAAAA,CAAO7a,KAAAA;oBACtE,IAAIna,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWK,8BAAAA,IAAkCF,IAAiBC,IAAe,GAAG;wBAC3F1vB,KACFA,EAAMovB,OAAAA,CAAQQ,UAAAA;wBAKhB,MAAMC,IAAYv4D,EAAKg3B,SAAAA,CAAUvgC,GAAAA,CAAIuJ,EAAKw4D,MAAAA,GACpCC,IAAczF,EAASxwD,MAAAA,EACvBk2D,IAAgB1F,EAAS2F,gBAAAA,CAAiB34D,EAAK0vC,GAAAA,GAC/C79B,IAAiB6mD,EAAcjiE,GAAAA,CAAI8hE,IAEnCp0D,IAAW,IAAI2xD,GAAIjkD,GAAQ7R,EAAK0vC,GAAAA;wBAItC,IAAIkpB;wBADJz0D,EAAIpD,GAAAA,GAAMoD,EAAIpD,GAAAA,CAAIzK,GAAAA,CAAI6N,EAAIK,GAAAA,CAAIrO,KAAAA,CAAAA,KAAWjQ,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWa,cAAAA;wBAEjE,IAAIC,IAAuB,IAAI9kE,EAAOc,IAAAA,GAAUA,IAAAA;wBAehD,IAdA5O,IAAAA,CAAKwwE,qBAAAA,CAAsBd,YAAAA,CAAazxD,GAAKg0D,IAA0D,IAAzCjyE,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWa,cAAAA,EAAqB1zD,CAAAA;4BACzG,IAAA,CAAKjf,IAAAA,CAAKsxE,WAAAA,CAAYxE,GAAU7tD,MAAUktD,GAAKT,UAAAA,CAAWoB,GAAU7tD,IAAQ;gCAC1E,MAAMiyD,IAAMjyD,EAAMjB,OAAAA,CAAQC,GAAKg0D,IAA0D,KAAzCjyE,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWa,cAAAA;gCACxE,IAAIzB,GAAK;oCACP,MAAMv0D,IAAYu0D,EAAIt0D,KAAAA,CAAMrM,GAAAA,CAAIob;oCAC5BhP,EAAU/M,SAAAA,GAAYgjE,EAAahjE,SAAAA,IACrCgjE,CAAAA,IAAej2D,GACf+1D,IAAczzD,CAAAA;gCAElB;4BACF;4BACA,OAAA,CAAO;wBAAK,IAGVyzD,KAAe5kE,EAAOW,OAAAA,CAAQmkE,IAAe;4BAC/C,MAAMjB,IAAO,IAAIxF,GAAKW,GAAU4F;4BAC3B1yE,IAAAA,CAAKqwE,MAAAA,CAAOt4D,GAAAA,CAAI45D,EAAK/xE,EAAAA,KACxBI,CAAAA,IAAAA,CAAKqwE,MAAAA,CAAOjgE,GAAAA,CAAIuhE,EAAK/xE,EAAAA,GACrBI,IAAAA,CAAKswE,mBAAAA,CAAoB3wE,IAAAA,CAAKgyE,EAAAA;4BAIhC,MAAMnwD,IAAQ+wD,EAAYhiE,GAAAA,CAAIiiE;4BAC9B14D,EAAKg3B,SAAAA,GAAYnlB,EACdvb,GAAAA,CAAIoR,GACJpR,GAAAA,CAAIwiE,GACJxiE,GAAAA,CAAI6N,EAAIK,GAAAA,CAAIrO,KAAAA,CAAM,KAAKjQ,IAAAA,CAAKutE,OAAAA,CAAQuE,UAAAA,CAAWa,cAAAA,IAClD7F,EAASr/B,MAAAA,CAAO3zB,EAAKiD,SAAAA,CAAUpa,GAAAA,KAE3B6/C,KACFA,EAAMovB,OAAAA,CAAQiB,kBAAAA;wBAElB;oBACF;gBACF;gBAGF,OAAO7yE,IAAAA,CAAKswE,mBACd;YAAA;YAMO,YAAYuB,CAAAA,EAAervB,CAAAA,EAAAA;gBAChC,IAAIuwB,IAA+B,EAAA;gBACnC,IAAK,IAAIvyE,IAAI,GAAGA,IAAIqxE,EAAMvxE,MAAAA,EAAQE,IAAK;oBACrC,MAAMwyE,IAAcnB,CAAAA,CAAMrxE,EAAAA,CAAGosE,OAAAA;oBAE7B,IADAmG,IAAWA,EAAS1yE,MAAAA,CAAO2yE,IACvBxwB,KAASwwB,EAAY1yE,MAAAA,GAAS,GAChC,KAAK,MAAMmU,KAAKu+D,EACdxwB,EAAMovB,OAAAA,CAAQmB,QAAAA,CAAS/nD,GAAAA,CAAIvW,EAAE7U,EAAAA,EAAI6U;gBAGvC;gBAIA,OAHI+tC,KACFA,CAAAA,EAAMovB,OAAAA,CAAQqB,UAAAA,IAAcF,EAASzyE,MAAAA,AAAAA,GAEhCyyE;YACT;YAKO,OAAOvB,CAAAA,EAAAA;gBACZ,IAAI0B,IAAU;gBACd,MAAMv7D,IAAM65D,EAAQlxE,MAAAA;gBAEpB,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IACnBR,IAAAA,CAAKwwE,qBAAAA,CAAsBxB,cAAAA,CAAewC,CAAAA,CAAQhxE,EAAAA,KACpD0yE;gBAGJ,OAAOA;YACT;YAEO,MAAMpzD,CAAAA,EAAAA;gBACX9f,IAAAA,CAAKwwE,qBAAAA,CAAsBx4D,KAAAA,CAAM8H;YACnC;QAAA;QC5SK,MAAeqzD;YAAtB,aAAA;gBAEkB,IAAA,CAAAvzE,EAAAA,GAAqB4G,EAAS,YAAY2sE,GAAStnD,GAAAA,KAM5D,IAAA,CAAAunD,SAAAA,GAAsC,MACtC,IAAA,CAAAl5D,MAAAA,GAAS,IAAIhT,GAuBpB,IAAA,CAAA+tB,MAAAA,GAAiBnnB,EAAOC,IAmE1B;YAAA;YAnFS,SAASkR,CAAAA,EAAAA;gBAGd,OAAA,CAAA,CAFgBjf,IAAAA,CAAK4sE,OAAAA,CAAQ3tD;YAO/B;QAAA;QAvBe,GAAA4M,GAAAA,GAAM,GTZvB,SAAY6+C,CAAAA;YACV,EAAA,MAAA,GAAA,UACA,EAAA,SAAA,GAAA;QACD,EAHWA,MAAAA,CAAAA,KAAc,CAAA,CAAA,ICN1B,SAAYC,CAAAA;YACV,EAAA,IAAA,GAAA,QACA,EAAA,aAAA,GAAA,kBACA,EAAA,eAAA,GAAA;QACD,EAJWA,MAAAA,CAAAA,KAAgB,CAAA,CAAA;QAiBrB,MAAM2I,KAA6B;YACxCC,UAAU;YACVC,YAAY;QAAA,GAMDC,KAA+B;YAC1CD,YAAY;YACZD,UAAU;QAAA,GAMCp4D,KAAoB;YAC/Bq4D,YAAY;YACZD,UAAU;QAAA;QS7BZ,IAAYG;QAAAA,CAAZ,SAAYA,CAAAA;YACV,EAAA,WAAA,GAAA,gBACA,EAAA,cAAA,GAAA;QACD,EAHWA,MAAAA,CAAAA,KAAwB,CAAA,CAAA;QCkN7B,MAAMC,KAA6D,IAAM,CAAA;gBAC9EC,SAAAA,CAAS;gBACTC,SAASnlE,EAAI,GAAG,GAAGuD,KAAAA;gBACnB6hE,QAAQpJ,GAAeqJ,MAAAA;gBACvBC,SAAS;gBACT5C,WAAW;oBACT6C,mBAAmB;gBAAA;gBAErBnC,YAAY;oBACVC,oBAAAA,CAAoB;oBACpBI,gCAAAA,CAAgC;oBAChCQ,gBAAgB;gBAAA;gBAElBuB,QAAQ;oBACNC,mBAAAA,CAAmB;oBACnBC,cAAc;oBACdC,eAAe,MAAO;oBACtBC,WAAW;oBACXC,aAAa;gBAAA;gBAEfC,kBAAkBd,GAAyBe,cAAAA;gBAC3CC,gBAAgB;oBACd5kE,MAAM;gBAAA;gBAER2gE,aAAa;oBACXvB,eAAe;oBACfE,oBAAoB;gBAAA;gBAEtBuF,QAAQ;oBACNC,kBAAkBjK,GAAiBxvD,IAAAA;gBAAAA;gBAErC05D,WAAW;oBACTD,kBAAkBjK,GAAiBxvD,IAAAA;oBACnC25D,oBAAoB;oBACpBC,oBAAoB;oBACpBC,MAAM;oBACNC,gBAAgB;oBAChBC,WAAAA,CAAW;gBAAA;YAAA,CAAA;QC/OR,MAAM/D,WAA0BgC;YAwBrC,IAAA,kBAA6B/vE,CAAAA,EAAAA;gBAC3BpD,IAAAA,CAAKm1E,kBAAAA,GAAqB/xE;YAC5B;YACA,IAAA,oBAAW6wE;gBACT,OAAOj0E,IAAAA,CAAKm1E,kBACd;YAAA;YAEA,YAAY/D,CAAAA,CAAAA;gBACVxkD,KAAAA,IA9BM,IAAA,CAAAwoD,mBAAAA,GAAsB,IAAIhF,GAA8B;oBAAA,GAC3DuD,IAAAA;gBAAAA,IAEG,IAAA,CAAA0B,gBAAAA,GAAmB,IAAI/H,GAAY;oBACzC4B,eAAe;oBACfE,oBAAoB;gBAAA,IAEd,IAAA,CAAAmB,UAAAA,GAAyB,EAAA;gBAwB/B,KAAK,MAAM97D,KAAK28D,EACdpxE,IAAAA,CAAKs1E,WAAAA,CAAY7gE;YAErB;YAEA,iBAAA8gE;gBACEv1E,IAAAA,CAAKuwE,UAAAA,GAAa,EACpB;YAAA;YAEA,YAAYzD,CAAAA,EAAAA;gBACV,IAAIsE;gBACAtE,aAAoBqE,KACtBC,CAAAA,IAAYtE,EAAS4D,YAAAA,IACrBU,EAAUjzB,OAAAA,CAAS1pC,CAAAA,IAAMA,EAAEwgB,MAAAA,CAAOzkB,QAAAA,CAASs8D,EAAS73C,MAAAA,EAAAA,IAEpDm8C,IAAY;oBAACtE;iBAAAA;gBAGf,KAAK,MAAMr4D,KAAK28D,EACd38D,EAAEyF,MAAAA,CAAO3R,IAAAA,CAAKvI,IAAAA,CAAKka,MAAAA,GACnBzF,EAAE2+D,SAAAA,GAAYpzE,IAAAA,EACdA,IAAAA,CAAKuwE,UAAAA,CAAW5wE,IAAAA,CAAK8U,IACrBzU,IAAAA,CAAKo1E,mBAAAA,CAAoBlU,KAAAA,CAAMzsD,IAC/BzU,IAAAA,CAAKq1E,gBAAAA,CAAiBvG,aAAAA,CAAcr6D;YAExC;YAEA,eAAeq4D,CAAAA,EAAAA;gBACbA,EAAS5yD,MAAAA,CAAO3R,IAAAA,CAAKvI,IAAAA,CAAKka,MAAAA,GAC1B4yD,EAASsG,SAAAA,GAAY,MACrB,EAAyBtG,GAAU9sE,IAAAA,CAAKuwE,UAAAA,GACxCvwE,IAAAA,CAAKo1E,mBAAAA,CAAoB/D,OAAAA,CAAQvE,IACjC9sE,IAAAA,CAAKq1E,gBAAAA,CAAiBpG,eAAAA,CAAgBnC;YACxC;YAEA,eAAA4D;gBACE,OAAO1wE,IAAAA,CAAKuwE,UACd;YAAA;YAEA,IAAA,WAAIkF;gBAAAA,IAAAA,GAAAA;gBACF,OAAA,AAA4B,CAAA,SAApB,CAAA,IAAe,SAAf,CAAA,IAAAz1E,IAAAA,CAAK6yC,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEh4B,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI/M,EAAOC,IAAAA,AAAAA,EAAMqC,GAAAA,CAAIpQ,IAAAA,CAAKi1B,MAAAA;YACxD;YAEA,IAAA,SAAI3Y;gBAAAA,IAAAA,GAAAA;gBACF,OAAA,AAA4B,CAAA,SAApB,CAAA,IAAe,SAAf,CAAA,IAAAtc,IAAAA,CAAK6yC,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEh4B,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI/M,EAAOC,IAAAA,AAAAA,EAAMqC,GAAAA,CAAIpQ,IAAAA,CAAKi1B,MAAAA;YACxD;YAEA,IAAA,SAAID;gBAAAA,IAAAA,GAAAA;gBAEF,MAAMo8C,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBAMvB,OALgBU,EAAU18C,MAAAA,CACxB,CAAC+0B,GAAKqjB,IAAarjB,EAAIzqC,OAAAA,CAAQ8tD,EAAS93C,MAAAA,GACpB,SAApB,CAAA,IAAY,SAAZ,CAAA,IAAAo8C,CAAAA,CAAU,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,KAAA,IAAA,EAAEp8C,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAA,AAAI,CAAA,IAAI1Z,CAAAA,EAAcqB,SAAAA,CAAU3c,IAAAA,CAAKy1E,QAAAA,GAG5C94D,SAAAA,CAAU3c,IAAAA,CAAKi1B,MAAAA;YAChC;YAEA,IAAA,cAAI/I;gBAAAA,IAAAA,GAAAA;gBAEF,MAAMklD,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBAGvB,OAFgBU,EAAU18C,MAAAA,CAAO,CAAC+0B,GAAKqjB,IAAarjB,EAAIzqC,OAAAA,CAAQ8tD,EAAS5gD,WAAAA,GAAuC,SAAzB,CAAA,IAAY,SAAZ,CAAA,IAAAklD,CAAAA,CAAU,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,KAAA,IAAA,EAAEllD,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI,IAAI5Q;YAG1H;YAEA,IAAA,OAAIo6D;gBAEF,MAAMtE,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBACvB,IAAIgF,IAAiB,EAAA;gBACrB,KAAK,MAAM5I,KAAYsE,EACrBsE,IAAOA,EAAKr1E,MAAAA,CAAOysE,EAAS4I,IAAAA;gBAE9B,OAAOA;YACT;YAEA,iBAAiBr6D,CAAAA,EAAAA;gBACf,MAAM+1D,IAAYpxE,IAAAA,CAAK0wE,YAAAA,IACjBiF,IAA2B,EAAA;gBACjC,KAAK,MAAM7I,KAAYsE,EACrBuE,EAAeh2E,IAAAA,CAAKmtE,EAAS2F,gBAAAA,CAAiBp3D;gBAGhD,IAAIu6D,IAAYD,CAAAA,CAAe,EAAA,EAC3B/E,IAAAA,CAAeryD,OAAOC,SAAAA;gBAC1B,KAAK,MAAM5B,KAAS+4D,EAAgB;oBAClC,MAAM9mE,IAAW+N,EAAMjM,GAAAA,CAAI0K;oBACvBxM,IAAW+hE,KACbgF,CAAAA,IAAYh5D,GACZg0D,IAAc/hE,CAAAA;gBAElB;gBACA,OAAO+mE;YACT;YAEA,WAAWE,CAAAA,EAAAA;gBACT,MAAM1E,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBACvB,IAAIqF,IAAe;gBACnB,KAAK,MAAMjJ,KAAYsE,EACrB2E,KAAgBjJ,EAAS+I,UAAAA,CAAWC;gBAEtC,OAAOC;YACT;YAEA,QAAQ92D,CAAAA,EAAAA;gBACN,IAAI+2D,IAAiB;oBAAC/2D;iBAAAA;gBAClBA,aAAiBkyD,MACnB6E,CAAAA,IAAiB/2D,EAAMyxD,YAAAA,EAAAA;gBAGzB,MAAMmB,IAAgB,EAAA;gBACtB,KAAK,MAAMp9D,KAAKuhE,EACdh2E,IAAAA,CAAKq1E,gBAAAA,CAAiB7F,KAAAA,CAAM/6D,GAAIwhE,CAAAA,IAC9BpE,CAAAA,EAAMlyE,IAAAA,CAAK,IAAIwsE,GAAK13D,GAAGwhE,KAAAA,CAChB,CAAA;gBAIX,IAAIlD,IAA+B,EAAA;gBACnC,KAAK,MAAMz8D,KAAKu7D,EACdkB,IAAWA,EAAS1yE,MAAAA,CAAOiW,EAAEs2D,OAAAA;gBAE/B,OAAOmG;YACT;YAEA,sBAAsB9zD,CAAAA,EAAAA;gBACpB,MAAMmyD,IAAYpxE,IAAAA,CAAK0wE,YAAAA,IACjBn8C,IAAuB,EAAA;gBAC7B,IAAItV,aAAiBkyD,IAAmB;oBACtC,MAAM6E,IAAiB/2D,EAAMyxD,YAAAA;oBAC7B,KAAK,MAAMtE,KAAagF,EACtB,KAAK,MAAM/E,KAAa2J,EAAgB;wBACtC,MAAMG,IAAY/J,EAAU8J,qBAAAA,CAAsB7J;wBAC9C8J,KACF5hD,EAAM50B,IAAAA,CAAKw2E;oBAEf;gBAEJ,OACE,KAAK,MAAMrJ,KAAYsE,EAAW;oBAChC,MAAM+E,IAAYl3D,EAAMi3D,qBAAAA,CAAsBpJ;oBAC1CqJ,KACF5hD,EAAM50B,IAAAA,CAAKw2E;gBAEf;gBAGF,IAAI5hD,EAAMj0B,MAAAA,EAAQ;oBAChB,IAAI81E,IAAY7hD,CAAAA,CAAM,EAAA,CAAG07C,SAAAA,IACrBoG,IAAU9hD,CAAAA,CAAM,EAAA;oBACpB,KAAK,MAAMO,KAAQP,EAAO;wBACxB,MAAMj0B,IAASw0B,EAAKm7C,SAAAA;wBAChB3vE,IAAS81E,KACXA,CAAAA,IAAY91E,GACZ+1E,IAAUvhD,CAAAA;oBAEd;oBACA,OAAOuhD;gBACT;gBACA,OAAO;YACT;YACA,SAASz5D,CAAAA,EAAAA;gBACP,MAAMw0D,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBACvB,KAAK,MAAM5D,KAAYsE,EACrB,IAAItE,EAAS/tD,QAAAA,CAASnC,IACpB,OAAA,CAAO;gBAGX,OAAA,CAAO;YACT;YACA,QAAQqB,CAAAA,EAAU1Y,CAAAA,EAAAA;gBAChB,MAAM6rE,IAAYpxE,IAAAA,CAAK0wE,YAAAA,IACjB4F,IAAqB,EAAA;gBAC3B,KAAK,MAAMxJ,KAAYsE,EAAW;oBAChC,MAAMF,IAAMpE,EAAS9uD,OAAAA,CAAQC,GAAK1Y;oBAC9B2rE,KACFoF,EAAK32E,IAAAA,CAAKuxE;gBAEd;gBACA,IAAIoF,EAAKh2E,MAAAA,EAAQ;oBACf,IAAIi2E,IAASD,CAAAA,CAAK,EAAA,EACdE,IAAcD,EAAO35D,KAAAA,CAAMjM,GAAAA,CAAIsN,EAAIK,GAAAA;oBACvC,KAAK,MAAM4yD,KAAOoF,EAAM;wBACtB,MAAMznE,IAAWoP,EAAIK,GAAAA,CAAI3N,GAAAA,CAAIugE,EAAIt0D,KAAAA;wBAC7B/N,IAAW2nE,KACbD,CAAAA,IAASrF,GACTsF,IAAc3nE,CAAAA;oBAElB;oBACA,OAAO0nE;gBACT;gBACA,OAAO;YACT;YACA,QAAQxzB,CAAAA,EAAAA;gBACN,MAAMquB,IAAYpxE,IAAAA,CAAK0wE,YAAAA,IACjBgG,IAA4B,EAAA;gBAClC,KAAK,MAAM5J,KAAYsE,EAAW;oBAChC,MAAMuF,IAAO7J,EAAS2J,OAAAA,CAAQ1zB;oBAC1B4zB,KACFD,EAAY/2E,IAAAA,CAAKg3E;gBAErB;gBAEA,IAAID,EAAYp2E,MAAAA,EAAQ;oBACtB,MAAMs2E,IAAgB,IAAI3J,GAAWyJ,CAAAA,CAAY,EAAA,CAAGlsE,GAAAA,EAAKksE,CAAAA,CAAY,EAAA,CAAGnxE,GAAAA;oBACxE,KAAK,MAAMoxE,KAAQD,EACjBE,EAAcpsE,GAAAA,GAAMlF,KAAKkF,GAAAA,CAAImsE,EAAKnsE,GAAAA,EAAKosE,EAAcpsE,GAAAA,GACrDosE,EAAcrxE,GAAAA,GAAMD,KAAKC,GAAAA,CAAIoxE,EAAKpxE,GAAAA,EAAKqxE,EAAcrxE,GAAAA;oBAEvD,OAAOqxE;gBACT;gBACA,OAAO;YACT;YAEA,OAAO75D,CAAAA,EAAAA;gBACL,IAAIA,GAAW;oBACb,MAAMq0D,IAAYpxE,IAAAA,CAAK0wE,YAAAA;oBACvB,KAAK,MAAM5D,KAAYsE,EACrBtE,EAASl7B,KAAAA,GAAQ5xC,IAAAA,CAAK4xC,KAAAA,EACtBk7B,EAASr/B,MAAAA,CAAO1wB;gBAEpB;YACF;YAEO,MAAM+C,CAAAA,EAA8BnM,CAAAA,EAAcsF,CAAAA,EAAAA;gBACvD,MAAMm4D,IAAYpxE,IAAAA,CAAK0wE,YAAAA;gBACvB5wD,EAAGyI,IAAAA,IACHzI,EAAGnD,SAAAA,CAAU3c,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EAAGtM,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA;gBACxC,KAAK,MAAM0iE,KAAYsE,EACrBtE,EAAS90D,KAAAA,CAAM8H,GAAInM,GAAOsF;gBAE5B6G,EAAG0I,OAAAA;YACL;YAEA,QAAAvW;gBACE,MAAM7G,IAAS,IAAI+lE,GAAkBnxE,IAAAA,CAAKuwE,UAAAA,CAAWtwE,GAAAA,CAAKwU,CAAAA,IAAMA,EAAExC,KAAAA;gBAElE,OADA7G,EAAO6pB,MAAAA,GAASj1B,IAAAA,CAAKi1B,MAAAA,CAAOhjB,KAAAA,IACrB7G;YACT;QAAA;QCzRK,MAAMyrE;YAKX,YACS/G,CAAAA,EACAvrC,CAAAA,CAAAA;gBADA,IAAA,CAAAurC,KAAAA,GAAAA,GACA,IAAA,CAAAvrC,GAAAA,GAAAA;YACN;YAEH,MAAMj0B,CAAAA,EAAAA;gBACJ,MAAMlF,IAASkF,KAAQ,IAAIumE,GAAY72E,IAAAA,CAAK8vE,KAAAA,CAAM79D,KAAAA,IAASjS,IAAAA,CAAKukC,GAAAA,CAAItyB,KAAAA;gBAGpE,OAFA7G,EAAO0kE,KAAAA,GAAQ9vE,IAAAA,CAAK8vE,KAAAA,CAAM79D,KAAAA,CAAM7G,EAAO0kE,KAAAA,GACvC1kE,EAAOm5B,GAAAA,GAAMvkC,IAAAA,CAAKukC,GAAAA,CAAItyB,KAAAA,CAAM7G,EAAOm5B,GAAAA,GAC5Bn5B;YACT;YAEA,UAAU4R,CAAAA,EAAsB1M,CAAAA,EAAAA;gBAC9B,MAAMlF,IAASkF,KAAQ,IAAIumE,GAAY/oE,EAAOC,IAAAA,EAAMD,EAAOC,IAAAA;gBAG3D,OAFA3C,EAAO0kE,KAAAA,GAAQ9yD,EAAOtJ,QAAAA,CAAS1T,IAAAA,CAAK8vE,KAAAA,EAAO1kE,EAAO0kE,KAAAA,GAClD1kE,EAAOm5B,GAAAA,GAAMvnB,EAAOtJ,QAAAA,CAAS1T,IAAAA,CAAKukC,GAAAA,EAAKn5B,EAAOm5B,GAAAA,GACvCn5B;YACT;YAKA,IAAA,QAAW0rE;gBACT,OAAA,AAAQ92E,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,AAAAA,IAAMpK,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,AAAAA;YAChE;YAKA,IAAA,YAAWyqE;gBACT,OAAO/2E,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,GAAIpK,IAAAA,CAAK82E,KAAAA,GAAQ92E,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAChD;YAAA;YAMO,SAAAyE;gBACL,OAAI/Q,IAAAA,CAAKg3E,OAAAA,GACAh3E,IAAAA,CAAKg3E,OAAAA,GAENh3E,IAAAA,CAAKg3E,OAAAA,GAAUh3E,IAAAA,CAAKukC,GAAAA,CAAIh0B,GAAAA,CAAIvQ,IAAAA,CAAK8vE,KAAAA,EAAO/+D,MAAAA;YAClD;YAGO,MAAAuN;gBACL,OAAIte,IAAAA,CAAKi3E,IAAAA,GACAj3E,IAAAA,CAAKi3E,IAAAA,GAENj3E,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKukC,GAAAA,CAAIh0B,GAAAA,CAAIvQ,IAAAA,CAAK8vE,KAAAA;YACxC;YAEO,YAAAjzD;gBACL,OAAO;oBAAC7c,IAAAA,CAAK8vE,KAAAA;oBAAO9vE,IAAAA,CAAKukC,GAAAA;iBAC3B;YAAA;YAMO,WAAAwrC;gBACL,IAAI/vE,IAAAA,CAAKk3E,MAAAA,EACP,OAAOl3E,IAAAA,CAAKk3E,MAAAA;gBAEd,MAAMpH,IAAQ9vE,IAAAA,CAAK8vE,KAAAA,EACbvrC,IAAMvkC,IAAAA,CAAKukC,GAAAA,EACX11B,IAAWihE,EAAMjhE,QAAAA,CAAS01B;gBAChC,OAAQvkC,IAAAA,CAAKk3E,MAAAA,GAAS3yC,EAAIh0B,GAAAA,CAAIu/D,GAAO7/D,KAAAA,CAAM,IAAIpB;YACjD;YAKO,UAAAsoE;gBACL,MAAMrH,IAAQ9vE,IAAAA,CAAK8vE,KAAAA;gBAEnB,OADY9vE,IAAAA,CAAKukC,GAAAA,CACNh0B,GAAAA,CAAIu/D;YACjB;YAKO,YAAAG;gBACL,MAAMH,IAAQ9vE,IAAAA,CAAK8vE,KAAAA,EACbvrC,IAAMvkC,IAAAA,CAAKukC,GAAAA;gBAEjB,OADiBurC,EAAMjhE,QAAAA,CAAS01B;YAElC;YAKA,IAAA,WAAW6yC;gBACT,OAAOp3E,IAAAA,CAAK8vE,KAAAA,CAAM1/D,GAAAA,CAAIpQ,IAAAA,CAAKukC,GAAAA,EAAKt0B,KAAAA,CAAM;YACxC;YAKO,OAAAonE;gBACL,OAAO,IAAIR,GAAY72E,IAAAA,CAAKukC,GAAAA,EAAKvkC,IAAAA,CAAK8vE,KAAAA;YACxC;YAMO,MAAMlzD,CAAAA,EAAAA;gBAEX,OAAA,AADgB5c,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,AAAAA,IAAMsQ,CAAAA,EAAMxS,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,AAAAA,IAAAA,AAAMpK,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,AAAAA,IAAMwS,CAAAA,EAAMtQ,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,AAAAA,KAC3G;YACnB;YAOO,KAAKirE,CAAAA,EAAoBj3E,CAAAA,EAAgB0P,IAAAA,CAAY,CAAA,EAAA;gBAC1D,IAAIsO,IAAMi5D;gBACNvnE,KACFsO,CAAAA,IAAMA,EAAItO,SAAAA,EAAAA;gBAGZ,MAAMiS,IAAO3D,EAAI3N,GAAAA,CAAI3Q,IAAAA,CAAK8vE,KAAAA,IAASxvE,GAC7B4hB,IAAM5D,EAAI3N,GAAAA,CAAI3Q,IAAAA,CAAKukC,GAAAA,IAAOjkC,GAE1BuzB,IAAU,EAAA;gBAQhB,IAPI5R,KAAQ,KACV4R,EAAQl0B,IAAAA,CAAKK,IAAAA,CAAK8vE,KAAAA,GAEhB5tD,KAAO,KACT2R,EAAQl0B,IAAAA,CAAKK,IAAAA,CAAKukC,GAAAA,GAGhBtiB,IAAOC,IAAM,GAAG;oBAClB,MAAMs1D,IAAWv1D,IAAQA,CAAAA,IAAOC,CAAAA;oBAChC2R,EAAQl0B,IAAAA,CAAKK,IAAAA,CAAK8vE,KAAAA,CAAM1/D,GAAAA,CAAIpQ,IAAAA,CAAKukC,GAAAA,CAAIh0B,GAAAA,CAAIvQ,IAAAA,CAAK8vE,KAAAA,EAAO7/D,KAAAA,CAAMunE;gBAC7D;gBACA,OAAuB,MAAnB3jD,EAAQvzB,MAAAA,GACH,OAGF,IAAIu2E,GAAYhjD,CAAAA,CAAQ,EAAA,EAAIA,CAAAA,CAAQ,EAAA;YAC7C;YAOO,gBAAgBjX,CAAAA,EAAe86D,IAAAA,CAAkB,CAAA,EAAA;gBACtD,MAAMC,IAAK/6D,EAAMtQ,CAAAA,EACXsrE,IAAKh7D,EAAMxS,CAAAA,EAEX4I,IAAIhT,IAAAA,CAAKiwE,SAAAA,IAITphE,IAAAA,AAAAA,CAAAA,AAFK7O,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,AAAAA,IAEZutE,IAAAA,AADZ33E,CAAAA,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,AAAAA,IACFsrE,IAAK53E,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,GAAIpK,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,AAAAA,IAAK0G;gBAC/F,OAAO0kE,IAAS7oE,IAAWvJ,KAAKyH,GAAAA,CAAI8B;YACtC;YAWO,kBAAkB+N,CAAAA,EAAAA;gBACvB,MAAMk7D,IAAU93E,IAAAA,CAAK8vE,KAAAA,CAAMv/D,GAAAA,CAAIqM,IACzB5a,IAAIhC,IAAAA,CAAK+vE,QAAAA;gBAEf,OAAO+H,EAAQvnE,GAAAA,CAAIvO,EAAEiO,KAAAA,CAAM6nE,EAAQnnE,GAAAA,CAAI3O;YACzC;YASO,UAAUsK,IAAY,IAAA,EAAMlC,IAAY,IAAA,EAAA;gBAC7C,MAAM4b,IAAIhmB,IAAAA,CAAK82E,KAAAA,EACTxkE,IAAItS,IAAAA,CAAK+2E,SAAAA;gBAEf,IAAU,SAANzqE,GACF,OAAO,IAAIwB,EAAOxB,GAAG0Z,IAAI1Z,IAAIgG;gBACxB,IAAU,SAANlI,GACT,OAAO,IAAI0D,EAAAA,AAAQ1D,CAAAA,IAAIkI,CAAAA,IAAK0T,GAAG5b;gBAE/B,MAAM,IAAIjE,MAAM;YAEpB;YAmBO,WAAA6xE;gBACL,IAAIC,GACAC,IAAY;gBAEhB,IAA4B,YAAA,OAAjBC,SAAAA,CAAU,EAAA,IAA2C,YAAA,OAAjBA,SAAAA,CAAU,EAAA,EACvDF,IAAY,IAAInqE,EAAOqqE,SAAAA,CAAU,EAAA,EAAIA,SAAAA,CAAU,EAAA,GAC/CD,IAAYC,SAAAA,CAAU,EAAA,IAAM;qBACvB;oBAAA,IAAA,CAAIA,CAAAA,SAAAA,CAAU,EAAA,YAAcrqE,CAAAA,GAIjC,MAAM;oBAHNmqE,IAAYE,SAAAA,CAAU,EAAA,EACtBD,IAAYC,SAAAA,CAAU,EAAA,IAAM;gBAG9B;gBAEA,MAAMC,IAAMH,EAAU3rE,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,EAC/B+rE,IAAMJ,EAAU7tE,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,EAE/BkuE,IAAMt4E,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,EAC9BisE,IAAMv4E,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,EAE9BwG,IAAQwnE,IAAMG,IAAMF,IAAMC;gBAGhC,OAAA,CAAIhzE,CAAAA,KAAKyH,GAAAA,CAAI6D,KAASsnE,CAAAA,KAKlB5yE,CAAAA,KAAKyH,GAAAA,CAAIurE,MAAQhzE,KAAKyH,GAAAA,CAAIwrE,KACrBD,IAAM,IAAIt4E,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,IAAK2rE,EAAU3rE,CAAAA,IAAK2rE,EAAU3rE,CAAAA,IAAKtM,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,GAAItM,IAAAA,CAAKukC,GAAAA,CAAIj4B,CAAAA,IAAK2rE,EAAU3rE,CAAAA,IAAK2rE,EAAU3rE,CAAAA,IAAKtM,IAAAA,CAAK8vE,KAAAA,CAAMxjE,CAAAA,GAE5HisE,IAAM,IAAIv4E,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,IAAK6tE,EAAU7tE,CAAAA,IAAK6tE,EAAU7tE,CAAAA,IAAKpK,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,GAAIpK,IAAAA,CAAKukC,GAAAA,CAAIn6B,CAAAA,IAAK6tE,EAAU7tE,CAAAA,IAAK6tE,EAAU7tE,CAAAA,IAAKpK,IAAAA,CAAK8vE,KAAAA,CAAM1lE,CAAAA,AAAAA;YAEvI;QAAA;QCzPF,SAASouE,GAAYC,CAAAA,EAAoBC,CAAAA;YAEvC,MAAMC,IAAU,MAEVC,IAAWH,EAAMn6D,GAAAA,IACjBu6D,IAAWH,EAAMp6D,GAAAA,IAEjBw6D,IAAYF,EAASjoE,GAAAA,CAAIioE,IACzBG,IAAYF,EAASloE,GAAAA,CAAIkoE;YAE/B,IAAIC,IAAYH,KAAWI,IAAYJ,GACrC,OAAO,IAAI9B,GAAY4B,EAAM3I,KAAAA,EAAO4I,EAAM5I,KAAAA;YAG5C,IAAIgJ,IAAYH,GAAS;gBACvB,MAAMniE,IAAI9J,EAAMmsE,EAASloE,GAAAA,CAAI8nE,EAAM3I,KAAAA,CAAMv/D,GAAAA,CAAImoE,EAAM5I,KAAAA,KAAUiJ,GAAW,GAAG,IACrEC,IAAeN,EAAM5I,KAAAA,CAAM1/D,GAAAA,CAAIyoE,EAAS5oE,KAAAA,CAAMuG;gBACpD,OAAO,IAAIqgE,GAAY4B,EAAM3I,KAAAA,EAAOkJ;YACtC;YAEA,IAAID,IAAYJ,GAAS;gBACvB,MAAMniE,IAAI9J,EAAMksE,EAASjoE,GAAAA,CAAI+nE,EAAM5I,KAAAA,CAAMv/D,GAAAA,CAAIkoE,EAAM3I,KAAAA,KAAUgJ,GAAW,GAAG,IACrEE,IAAeP,EAAM3I,KAAAA,CAAM1/D,GAAAA,CAAIwoE,EAAS3oE,KAAAA,CAAMuG;gBACpD,OAAO,IAAIqgE,GAAYmC,GAAcN,EAAM5I,KAAAA;YAC7C;YAEA,MAAM7sE,IAAIw1E,EAAM3I,KAAAA,CAAMv/D,GAAAA,CAAImoE,EAAM5I,KAAAA,GAC1B1tE,IAAI02E,GACJx5D,IAAIy5D,GACJ9jC,IAAI4jC,EAASloE,GAAAA,CAAI1N,IAEjBg2E,IAAQ72E,IAAIkd,IAAIha,KAAK2J,GAAAA,CAAI2pE,EAASjoE,GAAAA,CAAIkoE,IAAW;YAEvD,IAAI7uE,IAAI,GACJwM,IAAI;YAGNxM,IADE1E,KAAKyH,GAAAA,CAAIksE,KAASN,IAChBjsE,EAAAA,AAAOksE,CAAAA,EAASjoE,GAAAA,CAAIkoE,KAAY5jC,IAAI31B,IAAIs5D,EAASjoE,GAAAA,CAAI1N,EAAAA,IAAMg2E,GAAO,GAAG,KAGrEvsE,EAAMksE,EAASjoE,GAAAA,CAAI1N,KAAKb,GAAG,GAAG,IAIlCoU,IADElR,KAAKyH,GAAAA,CAAIuS,KAAKq5D,IACZjsE,EAAAA,AAAOksE,CAAAA,EAASjoE,GAAAA,CAAIkoE,KAAY7uE,IAAIirC,CAAAA,IAAK31B,GAAG,GAAG,KAG/C;YAGN,MAAM45D,IAAsBT,EAAM3I,KAAAA,CAAM1/D,GAAAA,CAAIwoE,EAAS3oE,KAAAA,CAAMjG,KACrDmvE,IAAsBT,EAAM5I,KAAAA,CAAM1/D,GAAAA,CAAIyoE,EAAS5oE,KAAAA,CAAMuG;YAE3D,OAAO,IAAIqgE,GAAYqC,GAAqBC;QAC9C;QAEO,MAAMC,KAAuB;YAClC,2BAA0BE,CAAAA,EAA2BC,CAAAA;gBACnD,MAAMC,IAASF,EAASG,QAAAA,IAClBC,IAASH,EAASE,QAAAA;gBAExB,IAAIjD,IAAcj4D,OAAOC,SAAAA,EACrBm7D,IAAkC;gBAEtC,IAAK,IAAIn5E,IAAI,GAAGA,IAAIg5E,EAAOl5E,MAAAA,EAAQE,IACjC,IAAK,IAAIkxE,IAAI,GAAGA,IAAIgI,EAAOp5E,MAAAA,EAAQoxE,IAAK;oBACtC,MAAM58C,IAAO0jD,GAAYgB,CAAAA,CAAOh5E,EAAAA,EAAIk5E,CAAAA,CAAOhI,EAAAA,GACrC7iE,IAAWimB,EAAKm7C,SAAAA;oBAElBphE,IAAW2nE,KACbA,CAAAA,IAAc3nE,GACd8qE,IAAc7kD,CAAAA;gBAElB;gBAGF,OAAO6kD;YACT;YAEA,wBAAuBE,CAAAA,EAA0BC,CAAAA;gBAE/C,MACMC,IADgBD,EAAKrE,QAAAA,CACUllE,GAAAA,CAAIspE,EAAQpE,QAAAA,GAE3CuE,IAAkB,IAAIpK,GAAIiK,EAAQpE,QAAAA,EAAUsE,IAE5CE,IAAYJ,EAAQ77D,OAAAA,CAAQg8D,GAAiBp9D,KAAAA,CAAMxM,GAAAA,CAAI4pE,EAAgB17D,GAAAA,CAAIrO,KAAAA,CAAM,MAEjFiqE,IAAWL,EAAQM,cAAAA,CAAeF,IAKlCG,IAAWN,EAAKO,MAAAA;gBAEtB,OAAO7B,GAAY0B,EAASI,IAAAA,EAAMF;YACpC;YAEA,0BAAyBP,CAAAA,EAA0Bh/B,CAAAA;gBAGjD,MAAM2/B,IAAgB3/B,EAAO46B,QAAAA,EACvBsE,IAAiBS,EAAcjqE,GAAAA,CAAIspE,EAAQpE,QAAAA,GAE3CuE,IAAkB,IAAIpK,GAAIiK,EAAQpE,QAAAA,EAAUsE,EAAe/pE,SAAAA,KAE3DiqE,IAAYJ,EAAQ77D,OAAAA,CAAQg8D,GAAiBp9D,KAAAA,CAAMxM,GAAAA,CAAI4pE,EAAgB17D,GAAAA,CAAIrO,KAAAA,CAAM,MAEjFiqE,IAAWL,EAAQM,cAAAA,CAAeF,IAGlCQ,IAAKP,EAASI,IAAAA,CAAKxK,KAAAA,EACnBze,IAAI6oB,EAASI,IAAAA,CAAKnD,OAAAA;gBAGxB,IAAI3gE,IAAAA,AAAK66C,CAAAA,EAAE/kD,CAAAA,GAAKkuE,CAAAA,EAAcluE,CAAAA,GAAImuE,EAAGnuE,CAAAA,AAAAA,IAAK+kD,EAAEjnD,CAAAA,GAAKowE,CAAAA,EAAcpwE,CAAAA,GAAIqwE,EAAGrwE,CAAAA,AAAAA,CAAAA,IAAOinD,CAAAA,EAAE/kD,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAI+kD,EAAEjnD,CAAAA,GAAIinD,EAAEjnD,CAAAA,AAAAA;gBAG7FoM,IAAI,IACNA,IAAI,IACKA,IAAI,KACbA,CAAAA,IAAI,CAAA;gBAIN,MAAMrU,IAAImD,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIwrE,EAAGnuE,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAIkK,IAAIgkE,EAAcluE,CAAAA,EAAG,KAAKhH,KAAK2J,GAAAA,CAAIwrE,EAAGrwE,CAAAA,GAAIinD,EAAEjnD,CAAAA,GAAIoM,IAAIgkE,EAAcpwE,CAAAA,EAAG,MAAMywC,EAAOjP,MAAAA,EAEtH8uC,IAAAA,AAAYD,CAAAA,EAAGnuE,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAIkK,IAAIgkE,EAAcluE,CAAAA,AAAAA,IAAKuuC,EAAOjP,MAAAA,GAAWiP,CAAAA,EAAOjP,MAAAA,GAASzpC,CAAAA,GAClFw4E,IAAAA,AAAYF,CAAAA,EAAGrwE,CAAAA,GAAIinD,EAAEjnD,CAAAA,GAAIoM,IAAIgkE,EAAcpwE,CAAAA,AAAAA,IAAKywC,EAAOjP,MAAAA,GAAWiP,CAAAA,EAAOjP,MAAAA,GAASzpC,CAAAA;gBACxF,OAAO,IAAI00E,GAAYxlB,EAAEphD,KAAAA,CAAMuG,GAAGpG,GAAAA,CAAIqqE,IAAK,IAAI3sE,EAAO0sE,EAAcluE,CAAAA,GAAIouE,GAASF,EAAcpwE,CAAAA,GAAIuwE;YACrG;YAEA,yBAAwBE,CAAAA,EAAyBC,CAAAA;gBAE/C,MACMf,IADgBe,EAAQrF,QAAAA,CACOllE,GAAAA,CAAIsqE,EAAQpF,QAAAA,GAG3CsF,IADeF,EAAQpF,QAAAA,CACMllE,GAAAA,CAAIuqE,EAAQrF,QAAAA,GAEzCuE,IAAkB,IAAIpK,GAAIiL,EAAQpF,QAAAA,EAAUsE,IAC5CiB,IAAiB,IAAIpL,GAAIkL,EAAQrF,QAAAA,EAAUsF,IAE3Cd,IAAYY,EAAQ78D,OAAAA,CAAQg8D,IAC5BiB,IAAaH,EAAQ98D,OAAAA,CAAQg9D;gBAEnC,OAAO,IAAInE,GAAYoD,EAAUr9D,KAAAA,EAAOq+D,EAAWr+D,KAAAA;YACrD;YAEA,uBAAsBi+B,CAAAA,EAAwBi/B,CAAAA;gBAE5C,MAAMqB,IAAiBtgC,EAAO46B,QAAAA,EAGxB2E,IAAWN,EAAKO,MAAAA,IAGhBI,IAFYL,EAAStK,KAAAA,EAGrBze,IAFa+oB,EAASjD,OAAAA;gBAK5B,IAAI3gE,IAAAA,AAAK66C,CAAAA,EAAE/kD,CAAAA,GAAK6uE,CAAAA,EAAe7uE,CAAAA,GAAImuE,EAAGnuE,CAAAA,AAAAA,IAAK+kD,EAAEjnD,CAAAA,GAAK+wE,CAAAA,EAAe/wE,CAAAA,GAAIqwE,EAAGrwE,CAAAA,AAAAA,CAAAA,IAAOinD,CAAAA,EAAE/kD,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAI+kD,EAAEjnD,CAAAA,GAAIinD,EAAEjnD,CAAAA,AAAAA;gBAG/FoM,IAAI,IACNA,IAAI,IACKA,IAAI,KACbA,CAAAA,IAAI,CAAA;gBAIN,MAAMrU,IAAImD,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIwrE,EAAGnuE,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAIkK,IAAI2kE,EAAe7uE,CAAAA,EAAG,KAAKhH,KAAK2J,GAAAA,CAAIwrE,EAAGrwE,CAAAA,GAAIinD,EAAEjnD,CAAAA,GAAIoM,IAAI2kE,EAAe/wE,CAAAA,EAAG,MAAMywC,EAAOjP,MAAAA,EAExH8uC,IAAAA,AAAYD,CAAAA,EAAGnuE,CAAAA,GAAI+kD,EAAE/kD,CAAAA,GAAIkK,IAAI2kE,EAAe7uE,CAAAA,AAAAA,IAAKuuC,EAAOjP,MAAAA,GAAWiP,CAAAA,EAAOjP,MAAAA,GAASzpC,CAAAA,GACnFw4E,IAAAA,AAAYF,CAAAA,EAAGrwE,CAAAA,GAAIinD,EAAEjnD,CAAAA,GAAIoM,IAAI2kE,EAAe/wE,CAAAA,AAAAA,IAAKywC,EAAOjP,MAAAA,GAAWiP,CAAAA,EAAOjP,MAAAA,GAASzpC,CAAAA;gBACzF,OAAO,IAAI00E,GAAYxlB,EAAEphD,KAAAA,CAAMuG,GAAGpG,GAAAA,CAAIqqE,IAAK,IAAI3sE,EAAOqtE,EAAe7uE,CAAAA,GAAIouE,GAASS,EAAe/wE,CAAAA,GAAIuwE;YACvG;YAEAS,qBAAmB,CAACC,GAAqBC,IAOhC9C,GALW6C,EAAMhB,MAAAA,IAGNiB,EAAMjB,MAAAA;QAAAA;QC/JrB,MAAMkB,WAAuBpI;YAQlC,IAAA,WAAWsC;gBACT,OAAOz1E,IAAAA,CAAKw7E,aAAAA,CAAc99D,WAAAA;YAC5B;YAQA,IAAA,SAAWkuB;gBAAAA,IAAAA;gBACT,IAAI5rC,IAAAA,CAAKy7E,OAAAA,EACP,OAAOz7E,IAAAA,CAAKy7E,OAAAA;gBAEd,MAAMx1D,IAAKjmB,IAAAA,CAAK6yC,UAAAA,EACV5iC,IAAuB,SAAf,CAAA,IAAAgW,QAAAA,IAAAA,KAAE,IAAFA,EAAIoqB,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIviC,EAAOE,GAAAA;gBAExC,OAAQhO,IAAAA,CAAKy7E,OAAAA,GAAUz7E,IAAAA,CAAK07E,cAAAA,GAAiBp2E,KAAKkF,GAAAA,CAAIyF,EAAM3D,CAAAA,EAAG2D,EAAM7F,CAAAA;YACvE;YAKA,IAAA,OAAkBqC,CAAAA,EAAAA;gBAAAA,IAAAA;gBAChB,MAAMwZ,IAAKjmB,IAAAA,CAAK6yC,UAAAA,EACV5iC,IAAuB,SAAf,CAAA,IAAAgW,QAAAA,IAAAA,KAAE,IAAFA,EAAIoqB,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIviC,EAAOE,GAAAA;gBAExChO,IAAAA,CAAK07E,cAAAA,GAAiBjvE,IAAMnH,KAAKkF,GAAAA,CAAIyF,EAAM3D,CAAAA,EAAG2D,EAAM7F,CAAAA,GACpDpK,IAAAA,CAAK27E,iBAAAA,GAAAA,CAAoB,GACzB37E,IAAAA,CAAKy7E,OAAAA,GAAUhvE;YACjB;YAIA,YAAYwM,CAAAA,CAAAA;gBACV2T,KAAAA,IAvCK,IAAA,CAAAqI,MAAAA,GAAiBnnB,EAAOC,IAAAA,EAEvB,IAAA,CAAAytE,aAAAA,GAA8Bp1D,EAAa7D,QAAAA,IA6L3C,IAAA,CAAAo5D,iBAAAA,GAAAA,CAAoB,GAvJ1B37E,IAAAA,CAAKi1B,MAAAA,GAAShc,EAAQgc,MAAAA,IAAUnnB,EAAOC,IAAAA,EACvC/N,IAAAA,CAAK4rC,MAAAA,GAAS3yB,EAAQ2yB,MAAAA,IAAU,GAChC5rC,IAAAA,CAAKw7E,aAAAA,CAAc7+D,SAAAA,CAAU3c,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EAAGtM,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA;YAC1D;YAKO,QAAA6H;gBACL,OAAO,IAAIspE,GAAe;oBACxBtmD,QAAQj1B,IAAAA,CAAKi1B,MAAAA,CAAOhjB,KAAAA;oBACpB25B,QAAQ5rC,IAAAA,CAAK4rC,MAAAA;gBAAAA;YAEjB;YAKA,IAAA,SAAWtvB;gBACT,OAAOtc,IAAAA,CAAKw7E,aAAAA,CAAc99D,WAAAA;YAC5B;YAKO,SAASd,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAGd,OAAA,AAFgC,CAAA,SAApB,CAAA,IAAe,SAAf,CAAA,IAAA5c,IAAAA,CAAK6yC,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEh4B,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI7a,IAAAA,CAAKi1B,MAAAA,AAAAA,EACpBpmB,QAAAA,CAAS+N,MACd5c,IAAAA,CAAK4rC,MAIvB;YAAA;YAMO,QAAQ3tB,CAAAA,EAAU1Y,IAAcqJ,IAAAA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAErC,MAAM6F,IAAIzU,IAAAA,CAAKsc,MAAAA,EACTgC,IAAML,EAAIK,GAAAA,EACVs9D,IAAO39D,EAAIpD,GAAAA,EAEXw2C,IAAI58C,EAAElE,GAAAA,CAAIqrE,IAEVC,IAAKv9D,EAAIrO,KAAAA,CAAMohD,EAAE1gD,GAAAA,CAAI2N,KAGrBnc,IAFKkvD,EAAE9gD,GAAAA,CAAIsrE,GAEJjsE,SAAAA;gBAEb,IAAIzN,IAAInC,IAAAA,CAAK4rC,MAAAA,EACX,OAAO;gBACF;oBAEL,IAAIkwC,IAAM;oBACV,IAAInvE,EAAmBxK,GAAGnC,IAAAA,CAAK4rC,MAAAA,EAAQ,OAAS;wBAE9C,IADAkwC,IAAAA,CAAOx9D,EAAI3N,GAAAA,CAAIirE,EAAKrrE,GAAAA,CAAIkE,KACpBqnE,IAAM,KAAKA,IAAMv2E,GAAK;4BACxB,MAAMqX,IAAQqB,EAAIkyD,QAAAA,CAAS2L;4BAC3B,OAAO;gCACLl/D,OAAAA;gCACA7L,QAAQ6L,EAAMrM,GAAAA,CAAIkE,GAAGzE,SAAAA;gCACrB88D,UAAU9sE,IAAAA;gCACV8Z,MAAgB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;gCACtB39D,UAAUitE;4BAAAA;wBAEd;wBACA,OAAO;oBACT;oBAAO;wBAEL,MAAMC,IAAez2E,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIqP,EAAI3N,GAAAA,CAAIirE,EAAKrrE,GAAAA,CAAIkE,KAAK,KAAKnP,KAAK2J,GAAAA,CAAI2sE,EAAKrrE,GAAAA,CAAIkE,GAAG5F,QAAAA,IAAY,KAAKvJ,KAAK2J,GAAAA,CAAIjP,IAAAA,CAAK4rC,MAAAA,EAAQ,KAEzHowC,IAAAA,CAAQ19D,EAAI3N,GAAAA,CAAIirE,EAAKrrE,GAAAA,CAAIkE,MAAMsnE,GAC/BE,IAAAA,CAAQ39D,EAAI3N,GAAAA,CAAIirE,EAAKrrE,GAAAA,CAAIkE,MAAMsnE,GAE/BG,IAAwB,EAAA;wBAC1BF,KAAQ,KACVE,EAAYv8E,IAAAA,CAAKq8E,IAGfC,KAAQ,KACVC,EAAYv8E,IAAAA,CAAKs8E;wBAGnB,MAAME,IAAS72E,KAAKkF,GAAAA,IAAO0xE;wBAC3B,IAAIC,KAAU52E,GAAK;4BACjB,MAAMqX,IAAQqB,EAAIkyD,QAAAA,CAASgM;4BAC3B,OAAO;gCACLv/D,OAAAA;gCACA7L,QAAQ6L,EAAMrM,GAAAA,CAAIkE,GAAGzE,SAAAA;gCACrB88D,UAAU9sE,IAAAA;gCACV8Z,MAAgB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;gCACtB39D,UAAUstE;4BAAAA;wBAEd;wBACA,OAAO;oBACT;gBACF;YACF;YAEO,sBAAsBC,CAAAA,EAAAA;gBAC3B,IAAIA,aAAiBb,IACnB,OAAOnC,GAAqBwB,uBAAAA,CAAwB56E,IAAAA,EAAMo8E;gBACrD,IAAIA,aAAiBC,IAC1B,OAAOjD,GAAqBmB,wBAAAA,CAAyB6B,GAAOp8E,IAAAA,EAAMq3E,IAAAA;gBAC7D,IAAI+E,aAAiBE,IAC1B,OAAOlD,GAAqB8B,qBAAAA,CAAsBl7E,IAAAA,EAAMo8E,GAAO/E,IAAAA;gBAE/D,MAAM,IAAIlxE,MAAM,2DAAA,OAAgEi2E;YAEpF;YAKO,QAAQtP,CAAAA,EAAAA;gBACb,IAAIA,aAAoByO,IACtB,OAAOgB,GAAmBC,mBAAAA,CAAoBx8E,IAAAA,EAAM8sE;gBAC/C,IAAIA,aAAoBuP,IAC7B,OAAOE,GAAmBE,oBAAAA,CAAqBz8E,IAAAA,EAAM8sE;gBAChD,IAAIA,aAAoBwP,IAC7B,OAAOC,GAAmBG,iBAAAA,CAAkB18E,IAAAA,EAAM8sE;gBAElD,MAAM,IAAI3mE,MAAM,0DAAA,OAA+D2mE;YAEnF;YAKO,iBAAiBzxD,CAAAA,EAAAA;gBACtB,OAAOrb,IAAAA,CAAKsc,MAAAA,CAAOlM,GAAAA,CAAIiL,EAAUrL,SAAAA,GAAYC,KAAAA,CAAMjQ,IAAAA,CAAK4rC,MAAAA;YAC1D;YAMO,sBAAsBvwB,CAAAA,EAAAA;gBAE3B,OADYA,EAAUrL,SAAAA,GACXC,KAAAA,CAAMjQ,IAAAA,CAAK4rC,MAAAA;YACxB;YAKA,IAAA,SAAW5W;gBACT,OAAOh1B,IAAAA,CAAKksB,WAAAA,CAAYnP,SAAAA,CAAU/c,IAAAA,CAAKw7E,aAAAA;YACzC;YAOA,IAAA,cAAWtvD;gBAKT,OAJIlsB,IAAAA,CAAK27E,iBAAAA,IACP37E,CAAAA,IAAAA,CAAKihD,YAAAA,GAAe,IAAI3lC,EAAAA,CAAatb,IAAAA,CAAK07E,cAAAA,EAAAA,CAAiB17E,IAAAA,CAAK07E,cAAAA,EAAAA,CAAiB17E,IAAAA,CAAK07E,cAAAA,EAAAA,CAAiB17E,IAAAA,CAAK07E,cAAAA,GAC5G17E,IAAAA,CAAK27E,iBAAAA,GAAAA,CAAoB,CAAA,GAEpB37E,IAAAA,CAAKihD,YACd;YAAA;YAKA,IAAA,OAAWy0B;gBACT,OAAO,EACT;YAAA;YAMO,WAAWI,CAAAA,EAAAA;gBAChB,OAAQA,IAAO91E,IAAAA,CAAK4rC,MAAAA,GAAS5rC,IAAAA,CAAK4rC,MAAAA,GAAU;YAC9C;YAGO,OAAO7uB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ/c,IAAAA,CAAK6yC,UAAAA,GAAa91B;gBACgB,CAAA,SAAhB,CAAA,IAAAA,EAAUC,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIhd,IAAAA,CAAKw7E,aAAAA,AAAAA,EACjCvpE,KAAAA,CAAMjS,IAAAA,CAAKw7E,aAAAA,GACrBx7E,IAAAA,CAAKw7E,aAAAA,CAAc7+D,SAAAA,CAAU3c,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EAAGtM,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA,GACxDpK,IAAAA,CAAKy7E,OAAAA,GAAAA,KAAU36E;YACjB;YAKO,QAAQiiD,CAAAA,EAAAA;gBACb,MAAM65B,IAAU,EAAA,EAEVC,IADQ78E,IAAAA,CAAKsc,MAAAA,CACM3L,GAAAA,CAAIoyC;gBAI7B,OAHA65B,EAAQj9E,IAAAA,CAAKk9E,IACbD,EAAQj9E,IAAAA,CAAKk9E,IAAa78E,IAAAA,CAAK4rC,MAAAA,GAC/BgxC,EAAQj9E,IAAAA,CAAKk9E,IAAa78E,IAAAA,CAAK4rC,MAAAA,GACxB,IAAIqhC,GAAW3nE,KAAKkF,GAAAA,CAAIuO,KAAAA,CAAMzT,MAAMs3E,IAAUt3E,KAAKC,GAAAA,CAAIwT,KAAAA,CAAMzT,MAAMs3E;YAC5E;YAEO,MAAM98D,CAAAA,EAA8BnM,CAAAA,EAAcsF,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACvD,MAAA,EAAM,WAAE++B,CAAAA,EAAAA,GAAc;oBAAOA,WAAW;oBAAA,GAAQ/+B,CAAAA;gBAAAA,GAC1CgN,IAAKjmB,IAAAA,CAAK6yC,UAAAA,EACV5iC,IAAuB,SAAf,CAAA,IAAAgW,QAAAA,IAAAA,KAAE,IAAFA,EAAIoqB,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIviC,EAAOE,GAAAA,EAClC2U,IAA6B,SAAlB,CAAA,IAAAsD,QAAAA,IAAAA,KAAE,IAAFA,EAAIgrB,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAI,GACjCp2B,IAAmB,SAAb,CAAA,IAAAoL,QAAAA,IAAAA,KAAE,IAAFA,EAAI6qB,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIhjC,EAAOC,IAAAA;gBACpC+R,EAAGyI,IAAAA,IACHzI,EAAGnD,SAAAA,CAAU9B,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA,GACxB0V,EAAGjO,MAAAA,CAAO8Q,IACV7C,EAAG7P,KAAAA,CAAMA,EAAM3D,CAAAA,EAAG2D,EAAM7F,CAAAA,GACxB0V,EAAGixC,UAAAA,CAAsB,SAAX,CAAA,IAAA/wD,IAAAA,CAAKi1B,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAInnB,EAAOC,IAAAA,EAAM/N,IAAAA,CAAK07E,cAAAA,EAAgBtpE,EAAM8D,WAAAA,EAAavC,GAAOqkC,IACzFl4B,EAAG0I,OAAAA;YACL;QAAA;QCzRK,MAAMs0D;YAmDX,YACE1Q,CAAAA,EACAC,CAAAA,EACA0Q,CAAAA,EACAhsE,CAAAA,EACAisE,CAAAA,EACAjhE,CAAAA,EACAkhE,CAAAA,EACA9kE,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBAWA,IArEM,IAAA,CAAA+kE,SAAAA,GAAAA,CAAY,GA+CpB,IAAA,CAAA3Q,KAAAA,GAA8B,MAC9B,IAAA,CAAAE,KAAAA,GAA8B,MAY5BzsE,IAAAA,CAAKosE,SAAAA,GAAYA,GACjBpsE,IAAAA,CAAKqsE,SAAAA,GAAYA,GACjBrsE,IAAAA,CAAK+8E,GAAAA,GAAMA,GACX/8E,IAAAA,CAAK+Q,MAAAA,GAASA,GACd/Q,IAAAA,CAAKg9E,OAAAA,GAAUA,GACfh9E,IAAAA,CAAK+b,MAAAA,GAASA,GACd/b,IAAAA,CAAKi9E,WAAAA,GAAcA,GACnBj9E,IAAAA,CAAKmY,IAAAA,GAAOA,GACZnY,IAAAA,CAAKJ,EAAAA,GAAKusE,GAAKG,iBAAAA,CAAkBF,EAAUxsE,EAAAA,EAAIysE,EAAUzsE,EAAAA,GACrDwsE,EAAUgH,SAAAA,IAAa/G,EAAU+G,SAAAA,EAAW;oBAE9C,MAAM+J,IAAyD,eAAxB,CAAA,SAAnB,CAAA,IAAA/Q,EAAUgH,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEa,iBAAAA,AAAAA,IAAmC7H,EAAUxsE,EAAAA,GAA4B,SAAvB,CAAA,IAAmB,SAAnB,CAAA,IAAAwsE,EAAUgH,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAExzE,EAAAA,AAAAA,KAAAA,KAAE,MAAA,IAAA,IAAIwsE,EAAUxsE,EAAAA,EAC1Hw9E,IAAyD,eAAxB,CAAA,SAAnB,CAAA,IAAA/Q,EAAU+G,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEa,iBAAAA,AAAAA,IAAmC5H,EAAUzsE,EAAAA,GAA4B,SAAvB,CAAA,IAAmB,SAAnB,CAAA,IAAAysE,EAAU+G,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAExzE,EAAAA,AAAAA,KAAAA,KAAE,MAAA,IAAA,IAAIysE,EAAUzsE,EAAAA;oBAChII,IAAAA,CAAKJ,EAAAA,IAAM,MAAMusE,GAAKG,iBAAAA,CAAkB6Q,GAAaC;gBACvD;gBACIp9E,IAAAA,CAAKosE,SAAAA,CAAUx6B,KAAAA,IACjB5xC,CAAAA,IAAAA,CAAKusE,KAAAA,GAAQvsE,IAAAA,CAAKosE,SAAAA,CAAUx6B,KAAAA,CAAMjvC,GAAAA,CAAI6pE,GAAAA,GAEpCxsE,IAAAA,CAAKqsE,SAAAA,CAAUz6B,KAAAA,IACjB5xC,CAAAA,IAAAA,CAAKysE,KAAAA,GAAQzsE,IAAAA,CAAKqsE,SAAAA,CAAUz6B,KAAAA,CAAMjvC,GAAAA,CAAI6pE,GAAAA;YAE1C;YAKO,aAAA6Q;gBACL,MAAM9Q,IAAQvsE,IAAAA,CAAKusE,KAAAA,EACbE,IAAQzsE,IAAAA,CAAKysE,KAAAA;gBACfF,KAASE,KACPF,EAAM+Q,UAAAA,KAAe7Q,EAAM6Q,UAAAA,IACzB/Q,CAAAA,EAAM+Q,UAAAA,IAAc/Q,EAAMG,aAAAA,KAAkBjC,GAAc1V,KAAAA,IAAS0X,EAAM8Q,WAAAA,IAAehR,EAAM8H,aAAAA,IAChG9H,CAAAA,EAAM+Q,UAAAA,GAAAA,CAAa,CAAA,GAEjB7Q,EAAM6Q,UAAAA,IAAc7Q,EAAMC,aAAAA,KAAkBjC,GAAc1V,KAAAA,IAASwX,EAAMgR,WAAAA,IAAe9Q,EAAM4H,aAAAA,IAChG5H,CAAAA,EAAM6Q,UAAAA,GAAAA,CAAa,CAAA,CAAA;YAI3B;YAEO,aAAAE;gBACL,OAAOx9E,IAAAA,CAAKk9E,SACd;YAAA;YAEO,SAAAO;gBACLz9E,IAAAA,CAAKk9E,SAAAA,GAAAA,CAAY;YACnB;YAKO,KAAKpQ,CAAAA,EAAAA;gBACV,IAAIA,MAAa9sE,IAAAA,CAAKosE,SAAAA,IAAaU,MAAa9sE,IAAAA,CAAKqsE,SAAAA,EACnD,MAAM,IAAIlmE,MAAM;gBAGlB,IAAI2mE,MAAa9sE,IAAAA,CAAKosE,SAAAA,EACpB,OAAOpsE,IAAAA;gBAGT,MAAMosE,IAAYpsE,IAAAA,CAAKosE,SAAAA,EACjBC,IAAYrsE,IAAAA,CAAKqsE,SAAAA;gBAQvB,OANArsE,IAAAA,CAAKqsE,SAAAA,GAAYD,GACjBpsE,IAAAA,CAAKosE,SAAAA,GAAYC,GACjBrsE,IAAAA,CAAK+8E,GAAAA,GAAM/8E,IAAAA,CAAK+8E,GAAAA,CAAI/rE,MAAAA,IACpBhR,IAAAA,CAAK+Q,MAAAA,GAAS/Q,IAAAA,CAAK+Q,MAAAA,CAAOC,MAAAA,IAC1BhR,IAAAA,CAAKg9E,OAAAA,GAAUh9E,IAAAA,CAAKg9E,OAAAA,CAAQhsE,MAAAA,IAErBhR,IACT;YAAA;QAAA;QCpIK,MAAM29E;YAAb,aAAA;gBAcE,IAAA,CAAA56B,IAAAA,GAAer0C,EAAI,GAAG,IAKtB,IAAA,CAAAkvE,SAAAA,GAAqBlvE,EAAI,GAAG,IAM5B,IAAA,CAAAsM,IAAAA,GAAqB,IAAI67D,GAAYnoE,EAAI,GAAG,IAAIA,EAAI,GAAG,KAKvD,IAAA,CAAAmvE,SAAAA,GAA0B,IAAIhH,GAAYnoE,EAAI,GAAG,IAAIA,EAAI,GAAG,KAU5D,IAAA,CAAAkO,KAAAA,GAAgBlO,EAAI,GAAG,IAKvB,IAAA,CAAAovE,UAAAA,GAAsBpvE,EAAI,GAAG;YAC/B;QAAA;QAEO,MAAMqvE;YAWX,OAAA,6BAAoCE,CAAAA,EAAwBC,CAAAA,EAAAA;gBAE1D,IAA6C,MAAzCA,EAAMnhE,SAAAA,CAAUC,MAAAA,CAAOuJ,WAAAA,IACzB,OAAOw3D,GAAeI,sCAAAA,CAAuCF,GAAOC;gBAOtE,IAEIJ,GAFAM,IAAAA,CAAkB7/D,OAAOC,SAAAA,EACzB6/D,IAAAA;gBAIJ,MAAMC,IAAeJ,EAAMnhE,SAAAA,CAAUyJ,OAAAA,CAAQ9S,QAAAA,CAASuqE,EAAMlhE,SAAAA,CAAUC,MAAAA,EAAQ+gE,GAAeQ,eAAAA,GACvFC,IAAuBF,EAAaj5D,WAAAA,IAEpCo5D,IAAWR,EAAMS,OAAAA,EACjBC,IAAUV,EAAMliE,MAAAA,EAChB6iE,IAAUV,EAAMniE,MAAAA;gBACtB,IAAK,IAAI8iE,IAAe,GAAGA,IAAeF,EAAQr+E,MAAAA,EAAQu+E,IAAgB;oBACxE,MAAM9tE,IAAS0tE,CAAAA,CAASI,EAAAA,CAAchtE,MAAAA,CAAO2sE,GAAsBT,GAAee,KAAAA,EAAOf,GAAegB,eAAAA,GAClGniE,IAAQ0hE,EAAa5qE,QAAAA,CAASirE,CAAAA,CAAQE,EAAAA,EAAed,GAAeiB,cAAAA;oBAK1E,IACIC,GADAC,IAAwB3gE,OAAOC,SAAAA;oBAEnC,IAAK,IAAI2gE,IAAe,GAAGA,IAAeP,EAAQt+E,MAAAA,EAAQ6+E,IAAgB;wBACxE,MAAMtwE,IAAWkC,EAAOJ,GAAAA,CAAIiuE,CAAAA,CAAQO,EAAAA,CAAc5uE,GAAAA,CAAIqM,GAAOmhE,GAAeqB,kBAAAA;wBACxEvwE,IAAWqwE,KACbA,CAAAA,IAAwBrwE,GACxBowE,IAAqBL,CAAAA,CAAQO,EAAAA,AAAAA;oBAEjC;oBAIID,IAAwBd,KAC1BA,CAAAA,IAAiBc,GACjBb,IAAgBQ,GAChBf,IAAamB,CAAAA;gBAEjB;gBAGA,MAAMI,IAAAA,AAAahB,CAAAA,IAAgB,CAAA,IAAKM,EAAQr+E,MAAAA,EAC1Cg/E,IAAiBvB,GAAewB,cAAAA,CAAe58E,GAAAA;gBAGrD,OAFA28E,EAAexS,QAAAA,GAAWmR,GAC1BqB,EAAeE,UAAAA,GAAapB,GACxBA,IAAiB,KAIrBK,CAAAA,CAAAA,CAASJ,EAAAA,CAAepsE,KAAAA,CAAMqtE,EAAe1B,SAAAA,GAC7Ca,CAAAA,CAASJ,EAAAA,CAAexsE,MAAAA,CAAOosE,EAAMlhE,SAAAA,CAAU4F,QAAAA,EAAUo7D,GAAee,KAAAA,EAAOQ,EAAev8B,IAAAA,GAC9Fk7B,EAAMlhE,SAAAA,CAAUC,MAAAA,CAAOtJ,QAAAA,CAASirE,CAAAA,CAAQN,EAAAA,EAAgBiB,EAAetkE,IAAAA,CAAK80D,KAAAA,GAC5EmO,EAAMlhE,SAAAA,CAAUC,MAAAA,CAAOtJ,QAAAA,CAASirE,CAAAA,CAAQU,EAAAA,EAAYC,EAAetkE,IAAAA,CAAKupB,GAAAA,GACxE25C,EAAMnhE,SAAAA,CAAUC,MAAAA,CAAOtJ,QAAAA,CAASoqE,GAAYwB,EAAe1iE,KAAAA,GAC3D0iE,EAAeG,MAAAA,GAASpB,GACxBP,EAAW7rE,KAAAA,CAAMqtE,EAAexB,UAAAA,GAChCa,CAAAA,CAAQN,EAAAA,CAAepsE,KAAAA,CAAMqtE,EAAezB,SAAAA,CAAU/N,KAAAA,GACtD6O,CAAAA,CAAQU,EAAAA,CAAWptE,KAAAA,CAAMqtE,EAAezB,SAAAA,CAAUt5C,GAAAA,CAAAA,GAVzC+6C;YAYX;YACA,OAAA,4BAAmCzkC,CAAAA,EAAwBg/B,CAAAA,EAAAA;gBACzD,MAAMnE,IAAOmE,EAAQnE,IAAAA,EAGfiK,IAFK9F,EAAQv9D,MAAAA,CAEA/L,GAAAA,CAAIsqC,EAAO46B,QAAAA,GACxBmK,IAAqB/F,EAAQpH,gBAAAA,CAAiBkN,EAAQ3uE,MAAAA;gBAC5D0kE,EAAK/1E,IAAAA,CAAKigF,EAAmBrvE,GAAAA,CAAIsqC,EAAO46B,QAAAA,EAAUzlE,SAAAA;gBAElD,IAAI6vE,IAAathE,OAAOC,SAAAA,EACpBshE,IAAU,MACVC,IAAAA;gBACJ,IAAK,IAAIv/E,IAAI,GAAGA,IAAIk1E,EAAKp1E,MAAAA,EAAQE,IAAK;oBACpC,MAAMw/E,IAAQnG,EAAQpD,OAAAA,CAAQf,CAAAA,CAAKl1E,EAAAA,GAC7By/E,IAAQplC,EAAO47B,OAAAA,CAAQf,CAAAA,CAAKl1E,EAAAA,GAC5B0/E,IAAUF,EAAM7S,UAAAA,CAAW8S;oBACjC,IAAIC,KAAW,GACb,OAAO;oBAEHA,IAAUL,KACZA,CAAAA,IAAaK,GACbJ,IAAUpK,CAAAA,CAAKl1E,EAAAA,EACfu/E,IAAWv/E,CAAAA;gBAGjB;gBACA,OAAIu/E,IAAW,IACN,OAEFD,EAAQ9vE,SAAAA,GAAYC,KAAAA,CAAM4vE;YACnC;YAEA,OAAA,uCAA8C5B,CAAAA,EAAwBC,CAAAA,EAAAA;gBACpE,IAAIE,IAAAA,CAAkB7/D,OAAOC,SAAAA,EACzB2hE,IAA+B,MAC/BC,IAA0B,MAC1B/B,IAAAA,IACAgC,IAAgC;gBACpC,MAAMC,IAAQrC,EAAMxE,QAAAA,IACd8G,IAAatC,EAAMuC,aAAAA;gBACzB,IAAK,IAAIhgF,IAAI,GAAGA,IAAI8/E,EAAMhgF,MAAAA,EAAQE,IAAK;oBACrC,MAAMwa,IAAOslE,CAAAA,CAAM9/E,EAAAA,EACbuiD,IAAO/nC,EAAKjK,MAAAA,IACZ0vE,IAAQvC,EAAMzL,gBAAAA,CAAiB1vB,EAAK/xC,MAAAA,KAGpC0vE,IAAiB1lE,EAAKy8D,eAAAA,CAAgBgJ,GAAAA,CAAO;oBAC/CC,IAAiBtC,KACnBA,CAAAA,IAAiBsC,GACjBP,IAAWnlE,GACXolE,IAAWr9B,GACXs7B,IAAgB79E,GAChB6/E,IAAiBI,CAAAA;gBAErB;gBAEA,OAAO;oBACL3T,UAAUmR;oBACVuB,YAAYY,IAAWhC,IAAiB;oBACxCr7B,MAAMq9B;oBACNplE,MAAMmlE;oBACNtC,WAAW0C,CAAAA,CAAWlC,EAAAA;oBACtBoB,QAAQpB;oBACRzhE,OAAOyjE;oBACPvC,YAAYsC,IAAWlC,EAAMvB,qBAAAA,CAAsByD,EAAUpvE,MAAAA,MAAY;gBAAA;YAE7E;QAAA;QA9IO,GAAAuuE,cAAAA,GAAiB,IAAI1zC,GAC1B,IAAM,IAAI8xC,IACTn9E,CAAAA,IAAMA,GACP,MAEa,GAAAs+E,KAAAA,GAAQpwE,EAAI,GAAG,IACf,GAAAswE,cAAAA,GAAiBtwE,EAAI,GAAG,IACxB,GAAA0wE,kBAAAA,GAAqB1wE,EAAI,GAAG,IAC5B,GAAAqwE,eAAAA,GAAkBrwE,EAAI,GAAG,IACzB,GAAA6vE,eAAAA,GAAkBn4D,EAAa7D,QAAAA,IAwIhDw7D,GAAewB,cAAAA,CAAerzC,eAAAA,GAAAA,CAAkB;QCnMhD,MAAMy0C,KAAc7yE,EAAOC,IAAAA,EACrB6yE,KAAgB9yE,EAAOC,IAAAA,EACvB8yE,KAAgBz6D,EAAa7D,QAAAA,IAEtBg6D,KAAqB;YAChC,qBAAoB1B,CAAAA,EAAyBC,CAAAA;gBAC3C,MAAMgG,IAAajG,EAAQpF,QAAAA,EACrBsL,IAAajG,EAAQrF,QAAAA,EACrBuL,IAAiBnG,EAAQjvC,MAAAA,GAASkvC,EAAQlvC,MAAAA,EAC1C/8B,IAAWiyE,EAAWjyE,QAAAA,CAASkyE;gBAErC,IAAIlyE,IAAWmyE,GACb,OAAO,EAAA;gBAIT,MAAMxB,IAAawB,IAAiBnyE,GAG9BkC,IAASgwE,EAAWxwE,GAAAA,CAAIuwE,GAAY9wE,SAAAA,IACpCgtE,IAAUjsE,EAAOD,aAAAA,IACjBmwE,IAAMlwE,EAAOd,KAAAA,CAAMuvE,IAEnB5iE,IAAQi+D,EAAQpI,gBAAAA,CAAiB1hE,IACjCmwE,IAAQrG,EAAQ8B,qBAAAA,CAAsB5rE;gBAS5C,OAAO;oBAAC,IAAI+rE,GAAiBjC,GAASC,GAASmG,GAAKlwE,GAAQisE,GAAS;wBAACpgE;qBAAAA,EAAQ;wBAACskE;qBAAAA,EAPlD;wBAC3BpU,UAAU+N;wBACV2E,YAAAA;wBACAz8B,MAAMhyC;wBACN6L,OAAOA;oBAAAA;iBAIX;YAAA;YAEA,sBAAqBi+B,CAAAA,EAAwBg/B,CAAAA;gBAAAA,IAAAA,GAAAA;gBAC3C,IAAIiG,IAAU/B,GAAe2B,2BAAAA,CAA4B7kC,GAAQg/B;gBACjE,IAAA,CAAKiG,GACH,OAAO,EAAA;gBAIT,MAAMqB,IAAUrB,EAAQnvE,GAAAA,CAAIkpE,EAAQv9D,MAAAA,CAAO/L,GAAAA,CAAIsqC,EAAOv+B,MAAAA;gBACtDwjE,IAAUqB,IAAU,IAAIrB,EAAQ9uE,MAAAA,KAAW8uE;gBAE3C,MAAMljE,IAAQi+B,EAAO43B,gBAAAA,CAAiBqN,IAEhCoB,IAAAA,AAD0C,CAAA,SAArC,CAAA,IAAY,SAAZ,CAAA,IAAArmC,EAAOjJ,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAIgwC,GAAAA,KAAAA,KAAmB,MAAA,IAAA,IAAI,IAAIA,EAAAA,EACvCrB,YAAAA,CAAa10B,IACxB7L,IAAS+uE,EAAQ9vE,SAAAA,IAEjBmI,IAAuB;oBAC3B20D,UAAUjyB;oBACV2kC,YAAAA,CAAaM,EAAQlwE,SAAAA;oBACrBmzC,MAAMhyC;oBACN6L,OAAOA;oBACPkhE,YAAYoD;oBACZlmE,MAAM6+D,EAAQuH,QAAAA,CAASrwE,EAAOC,MAAAA;oBAC9B6sE,WAAWhE,EAAQwH,aAAAA,CAActwE,EAAOC,MAAAA;gBAAAA;gBAG1C,OAAO;oBAAC,IAAI8rE,GAAiBjiC,GAAQg/B,GAASiG,GAAS/uE,GAAQA,EAAOD,aAAAA,IAAiB;wBAAC8L;qBAAAA,EAAQ;wBAACskE;qBAAAA,EAAQ/oE;iBAC3G;YAAA;YAEA,mBAAkB0iC,CAAAA,EAAwBi/B,CAAAA;gBAKxC,MAAMwH,IAAKzmC,EAAOv+B,MAAAA,EAEZilE,IAAYzH,EAAKO,MAAAA,IACjB/6D,IAAIiiE,EAAUh9C,GAAAA,CAAIh0B,GAAAA,CAAIgxE,EAAUzR,KAAAA,GAGhCze,IAAI/xC,EAAE3O,GAAAA,CAAI4wE,EAAUh9C,GAAAA,CAAIh0B,GAAAA,CAAI+wE,KAC5B/xE,IAAI+P,EAAE3O,GAAAA,CAAI2wE,EAAG/wE,GAAAA,CAAIgxE,EAAUzR,KAAAA,IAC3B90D,IAAO8+D,EAAKO,MAAAA,IACZwD,IAAY/D,EAAK0H,WAAAA;gBAGvB,IAAIjyE,KAAK,GAAG;oBACV,MAAMkyE,IAAKF,EAAUzR,KAAAA,CAAMv/D,GAAAA,CAAI+wE,IACzBI,IAAMD,EAAG9wE,GAAAA,CAAI8wE;oBAEnB,IAAIC,IAAM7mC,EAAOjP,MAAAA,GAASiP,EAAOjP,MAAAA,EAC/B,OAAO,EAAA;oBAGT,MAAM76B,IAAS0wE,EAAGzxE,SAAAA,IACZwvE,IAAa3kC,EAAOjP,MAAAA,GAAStmC,KAAK0J,IAAAA,CAAK0yE,IAEvCvpE,IAAuB;wBAC3B20D,UAAUjyB;wBACV2kC,YAAYA;wBACZz8B,MAAMhyC;wBACN6L,OAAO5B,EAAK80D,KAAAA;wBACZ90D,MAAMA;wBACN6iE,WAAWA;oBAAAA;oBAGb,OAAO;wBACL,IAAIf,GAAiBjiC,GAAQi/B,GAAM/oE,EAAOd,KAAAA,CAAMuvE,IAAazuE,GAAQA,EAAOD,aAAAA,IAAiB;4BAACkK,EAAK80D,KAAAA;yBAAAA,EAAQ;4BAAC+N,EAAU/N,KAAAA;yBAAAA,EAAQ33D;qBAElI;gBAAA;gBAGA,IAAIk5C,KAAK,GAAG;oBACV,MAAMswB,IAAKJ,EAAUh9C,GAAAA,CAAIh0B,GAAAA,CAAI+wE,IACvBM,IAAMD,EAAGhxE,GAAAA,CAAIgxE;oBACnB,IAAIC,IAAM/mC,EAAOjP,MAAAA,GAASiP,EAAOjP,MAAAA,EAC/B,OAAO,EAAA;oBAGT,MAAM76B,IAAS4wE,EAAG3xE,SAAAA,IACZwvE,IAAa3kC,EAAOjP,MAAAA,GAAStmC,KAAK0J,IAAAA,CAAK4yE,IAEvCzpE,IAAuB;wBAC3B20D,UAAUjyB;wBACV2kC,YAAYA;wBACZz8B,MAAMhyC;wBACN6L,OAAO5B,EAAKupB,GAAAA;wBACZvpB,MAAMA;wBACN6iE,WAAWA;oBAAAA;oBAGb,OAAO;wBACL,IAAIf,GAAiBjiC,GAAQi/B,GAAM/oE,EAAOd,KAAAA,CAAMuvE,IAAazuE,GAAQA,EAAOD,aAAAA,IAAiB;4BAACkK,EAAKupB,GAAAA;yBAAAA,EAAM;4BAACs5C,EAAUt5C,GAAAA;yBAAAA,EAAMpsB;qBAE9H;gBAAA;gBAGA,MAAM0pE,IAAMviE,EAAE3O,GAAAA,CAAI2O,IACZwiE,IAAcP,EAAUzR,KAAAA,CAC3B7/D,KAAAA,CAAMohD,GACNjhD,GAAAA,CAAImxE,EAAUh9C,GAAAA,CAAIt0B,KAAAA,CAAMV,IACxBU,KAAAA,CAAM,IAAI4xE,IACP1/E,IAAIm/E,EAAG/wE,GAAAA,CAAIuxE,IAEXC,IAAK5/E,EAAEwO,GAAAA,CAAIxO;gBACjB,IAAI4/E,IAAKlnC,EAAOjP,MAAAA,GAASiP,EAAOjP,MAAAA,EAC9B,OAAO,EAAA;gBAGT,IAAI76B,IAASuO,EAAExO,aAAAA;gBAEXC,EAAOJ,GAAAA,CAAI2wE,EAAG/wE,GAAAA,CAAIgxE,EAAUzR,KAAAA,KAAU,KACxC/+D,CAAAA,EAAOzE,CAAAA,GAAAA,CAAKyE,EAAOzE,CAAAA,EACnByE,EAAO3G,CAAAA,GAAAA,CAAK2G,EAAO3G,CAAAA,AAAAA,GAGrB2G,IAASA,EAAOf,SAAAA;gBAChB,MAAMwvE,IAAa3kC,EAAOjP,MAAAA,GAAStmC,KAAK0J,IAAAA,CAAK+yE,IAEvCd,IAAMlwE,EAAOd,KAAAA,CAAMuvE,IACnBrnE,IAAuB;oBAC3B20D,UAAUjyB;oBACV2kC,YAAYA;oBACZz8B,MAAMhyC;oBACN6L,OAAOklE;oBACP9mE,MAAMA;oBACN6iE,WAAWA;gBAAAA;gBAGb,OAAO;oBACL,IAAIf,GACFjiC,GACAi/B,GACAmH,GACAlwE,EAAOC,MAAAA,IACPD,EAAOC,MAAAA,GAASF,aAAAA,IAChB;wBAACgxE;qBAAAA,EACD;wBAACA,EAAYvxE,GAAAA,CAAIupE,EAAKrE,QAAAA;qBAAAA,EACtBt9D;iBAGN;YAAA;YAEA6pE,iBAAe,IAEN,EAAA;YAGT,oBAAmBnI,CAAAA,EAA0BC,CAAAA;gBAAAA,IAAAA;gBAC3C,MAAMoI,IAAKrI,EAAQv9D,MAAAA,EAEbgC,IADKw7D,EAAKx9D,MAAAA,CACD/L,GAAAA,CAAI2xE,GAAIlyE,SAAAA,IAGjBmyE,IAAW,IAAI9F,GAAgB;oBACnCtgE,QAAQ;wBAAC+9D,EAAKhK,KAAAA;wBAAOgK,EAAKv1C,GAAAA;wBAAKu1C,EAAKv1C,GAAAA,CAAIn0B,GAAAA,CAAIkO,EAAIrO,KAAAA,CAAM;wBAAO6pE,EAAKhK,KAAAA,CAAM1/D,GAAAA,CAAIkO,EAAIrO,KAAAA,CAAM;qBAAA;oBACtFglB,QAAQ6kD,EAAK7kD,MAAAA;gBAAAA;gBAEfktD,EAASvwC,KAAAA,GAAQkoC,EAAKloC,KAAAA;gBACD,CAAA,SAAV,CAAA,IAAAkoC,EAAKloC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAIgwC,GAAAA,KAEzBwvC,EAAS10C,MAAAA,CAAOqsC,EAAKloC,KAAAA,CAAMjvC,GAAAA,CAAIgwC,IAAoBhwC,GAAAA;gBAGrD,MAAMwgD,IAAUnjD,IAAAA,CAAKoiF,qBAAAA,CAAsBvI,GAASsI;gBAMpD,OALIh/B,EAAQ7iD,MAAAA,IAEV6iD,CAAAA,CAAAA,CAAQ,EAAA,CAAGkpB,SAAAA,GAAYyN,GACtB32B,CAAAA,CAAQ,EAAA,CAAGvjD,EAAAA,GAAausE,GAAKG,iBAAAA,CAAkBuN,EAAQj6E,EAAAA,EAAIk6E,EAAKl6E,EAAAA,CAAAA,GAE5DujD;YACT;YAEA,uBAAsB86B,CAAAA,EAAwBC,CAAAA;gBAI5C,MAAMmE,IAActE,GAAeC,4BAAAA,CAA6BC,GAAOC;gBAGvE,IAAImE,EAAY7C,UAAAA,GAAa,GAC3B,OAAO,EAAA;gBAGT,MAAM8C,IAAcvE,GAAeC,4BAAAA,CAA6BE,GAAOD;gBAEvE,IAAIqE,EAAY9C,UAAAA,GAAa,GAC3B,OAAO,EAAA;gBAIT,MAAMA,IAAa6C,EAAY7C,UAAAA,GAAa8C,EAAY9C,UAAAA,GAAa6C,IAAcC,GAG7ErjE,IAAQugE,EAAW1S,QAAAA,KAAamR,IAAQC,IAAQD,GAChDsE,IAAO/C,EAAW1S,QAAAA,KAAamR,IAAQA,IAAQC,GAE/CsE,IAAkBvjE,EAAMlC,SAAAA,CAAUyJ,OAAAA,CAAQ9S,QAAAA,CAAS6uE,EAAKxlE,SAAAA,CAAUC,MAAAA,EAAQ6jE,KAC1E4B,IAA0BD,EAAgBn9D,WAAAA,IAC1Cq9D,IAAsBH,EAAK7D,OAAAA,CAAQc,EAAWC,MAAAA,CAAAA,CAAQ5tE,MAAAA,CAAO4wE,GAAyB9B,IAAaC;gBACzG,IAAI+B,IAAUpkE,OAAOC,SAAAA,EACjBokE,IAAoB;gBACxB,IAAK,IAAIpiF,IAAI,GAAGA,IAAIye,EAAMy/D,OAAAA,CAAQp+E,MAAAA,EAAQE,IAAK;oBAC7C,MAAM4C,IAAQs/E,EAAoB/xE,GAAAA,CAAIsO,EAAMy/D,OAAAA,CAAQl+E,EAAAA;oBAChD4C,IAAQu/E,KACVA,CAAAA,IAAUv/E,GACVw/E,IAAoBpiF,CAAAA;gBAExB;gBAGA,IAAA,CAAKg/E,EAAW3B,SAAAA,IAAAA,CAAc2B,EAAW5B,SAAAA,IAAAA,CAAc4B,EAAWz8B,IAAAA,EAChE,OAAO,EAAA;gBAKT,MAAM8/B,IAAgBrD,EAAW3B,SAAAA,CAAU9gE,SAAAA,CAAUylE,IAC/CM,IAAqBtD,EAAW5B,SAAAA,CAAU9sE,aAAAA,GAAgBE,MAAAA,GAASa,MAAAA,CAAO4wE,IAG1EM,IADe,IAAIlM,GAAY53D,EAAMlD,MAAAA,CAAO6mE,EAAAA,EAAoB3jE,EAAMlD,MAAAA,CAAAA,AAAQ6mE,CAAAA,IAAoB,CAAA,IAAK3jE,EAAMlD,MAAAA,CAAOzb,MAAAA,CAAAA,EAC3Fm6D,IAAAA,CAAKqoB,EAAmB9xE,MAAAA,IAAAA,CAAW8xE,EAAmBnyE,GAAAA,CAAIkyE,EAAc/S,KAAAA,GAAAA,CAAQ;gBAC/G,IAAIkT,IAA+B;gBAKnC,IAJID,KACFC,CAAAA,IAAWD,EAAUtoB,IAAAA,CAAKqoB,GAAoBA,EAAmBnyE,GAAAA,CAAIkyE,EAAct+C,GAAAA,GAAAA,CAAM,EAAA,GAGvFy+C,GAAU;oBACZ,MAAM/F,IAAwB,EAAA,EACxBlhE,IAAmB,EAAA,EACnBknE,IAAaD,EAASnmE,SAAAA;oBAE5B,IAAK,IAAIrc,IAAI,GAAGA,IAAIyiF,EAAW3iF,MAAAA,EAAQE,IAAK;wBAC1C,MAAM8V,IAAI2sE,CAAAA,CAAWziF,EAAAA;wBACjBqiF,EAAcvL,KAAAA,CAAMhhE,MACtB2mE,CAAAA,EAAYt9E,IAAAA,CAAK2W,IACjByF,EAAOpc,IAAAA,CAAKsf,EAAMlC,SAAAA,CAAUhE,KAAAA,CAAMzC,GAAAA;oBAEtC;oBACA,IAAIvF,IAASyuE,EAAWz8B,IAAAA,EACpBi6B,IAAUjsE,EAAOD,aAAAA;oBAMrB,OAJIotE,EAAM5hE,MAAAA,CAAO/L,GAAAA,CAAI0tE,EAAM3hE,MAAAA,EAAQ3L,GAAAA,CAAII,KAAU,KAC/CA,CAAAA,IAASA,EAAOC,MAAAA,IAChBgsE,IAAUjsE,EAAOD,aAAAA,EAAAA,GAEZ;wBAAC,IAAIgsE,GAAiBmB,GAAOC,GAAOntE,EAAOd,KAAAA,CAAAA,CAAOuvE,EAAWA,UAAAA,GAAazuE,GAAQisE,GAASjhE,GAAQkhE,GAAauC;qBACzH;gBAAA;gBACA,OAAO,EACT;YAAA;YAEA,uBAAsBr8B,CAAAA,EAA2B26B,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBAC/C,MAAMqF,IAAShgC,EAAQipB,SAAAA,EACjBgX,IAA8B,SAAxB,CAAA,IAAa,SAAb,CAAA,IAAAjgC,EAAQopB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAExvD,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,IAAI41B,IACtC0wC,IAASlgC,EAAQkpB,SAAAA,EACjBiX,IAA8B,SAAxB,CAAA,IAAa,SAAb,CAAA,IAAAngC,EAAQspB,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE1vD,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,IAAI41B;gBAG5C,IAAIwwC,aAAkB5H,MAAkB8H,aAAkB9H,IAIxD,OAAA,CAHuB4H,CAAAA,EAAOv3C,MAAAA,GAASy3C,EAAOz3C,MAAAA,GAC7Bw3C,EAAIvoE,GAAAA,CAAIhM,QAAAA,CAASy0E,EAAIzoE,GAAAA,CAAAA;gBAMxC,IAAIsoE,aAAkB9G,MAAmBgH,aAAkBhH,MACrDl5B,EAAQhrC,IAAAA,CAAK0lE,SAAAA,EAAW;oBAC1B,IAAI7iE,GACAuoE;oBAeJ,OAdIpgC,EAAQhrC,IAAAA,CAAK20D,QAAAA,KAAaqW,IAC5BnoE,CAAAA,IAAO,IAAI67D,GACTuM,EAAIrqE,KAAAA,CAAMoqC,EAAQhrC,IAAAA,CAAK0lE,SAAAA,CAAU/N,KAAAA,EAAO1/D,GAAAA,CAAI+yE,EAAOluD,MAAAA,GACnDmuD,EAAIrqE,KAAAA,CAAMoqC,EAAQhrC,IAAAA,CAAK0lE,SAAAA,CAAUt5C,GAAAA,EAAKn0B,GAAAA,CAAI+yE,EAAOluD,MAAAA,IAEnDsuD,IAAaD,EAAIvqE,KAAAA,CAAM+kE,GAAY1tE,GAAAA,CAAIizE,EAAOpuD,MAAAA,CAAAA,IAE9Cja,CAAAA,IAAO,IAAI67D,GACTyM,EAAIvqE,KAAAA,CAAMoqC,EAAQhrC,IAAAA,CAAK0lE,SAAAA,CAAU/N,KAAAA,EAAO1/D,GAAAA,CAAIizE,EAAOpuD,MAAAA,GACnDquD,EAAIvqE,KAAAA,CAAMoqC,EAAQhrC,IAAAA,CAAK0lE,SAAAA,CAAUt5C,GAAAA,EAAKn0B,GAAAA,CAAIizE,EAAOpuD,MAAAA,IAEnDsuD,IAAaH,EAAIrqE,KAAAA,CAAM+kE,GAAY1tE,GAAAA,CAAI+yE,EAAOluD,MAAAA,CAAAA,GAGzCja,EAAKy8D,eAAAA,CAAgB8L,GAAAA,CAAY;gBAC1C;gBAIF,IACGJ,aAAkB9G,MAAmBgH,aAAkB9H,MACvD8H,aAAkBhH,MAAmB8G,aAAkB5H,IACxD;oBACA,MAAMgI,IAAaH,EAAIrqE,KAAAA,CAAM+kE;oBAC7B,IAAI36B,EAAQhrC,IAAAA,CAAK6C,IAAAA,EACf,OAAOmoC,EAAQhrC,IAAAA,CAAK6C,IAAAA,CAAKy8D,eAAAA,CAAgB8L,GAAAA,CAAY;gBAEzD;gBAGA,IACGJ,aAAkB7G,MAAgB+G,aAAkBhH,MACpDgH,aAAkB/G,MAAgB6G,aAAkB9G,IACrD;oBACA,IAAIkH;oBAMJ,IAJEA,IADEpgC,EAAQhrC,IAAAA,CAAK20D,QAAAA,KAAaqW,IACfG,EAAIvqE,KAAAA,CAAM+kE,KAEVsF,EAAIrqE,KAAAA,CAAM+kE,IAErB36B,EAAQhrC,IAAAA,CAAK6C,IAAAA,EACf,OAAOmoC,EAAQhrC,IAAAA,CAAK6C,IAAAA,CAAKy8D,eAAAA,CAAgB8L,GAAAA,CAAY;gBAEzD;gBAGA,IACGJ,aAAkB5H,MAAkB8H,aAAkB/G,MACtD+G,aAAkB9H,MAAkB4H,aAAkB7G,IACvD;oBAEA,MAAMiH,IAAaD,EAAIvqE,KAAAA,CAAM+kE;oBAE7B,IAAI0F;oBACAL,aAAkB5H,MACpBiI,CAAAA,IAAcL,EAAO1Q,gBAAAA,CAAiBtvB,EAAQpyC,MAAAA,CAAAA;oBAGhD,MAAM0yE,IAAOF,EAAW10E,QAAAA,CAAS20E;oBAEjC,IAAIrgC,EAAQhrC,IAAAA,CAAK6C,IAAAA,EACf,OAAOyoE,IAAO,IAAA,CAAKA,IAAO;gBAE9B;gBAEA,OAAO;YACT;QAAA;QCxVK,MAAMnH,WAAqBnJ;YAQhC,YAAYl6D,CAAAA,CAAAA;gBAAAA,IAAAA;gBACV2T,KAAAA,IAHM,IAAA,CAAA4uD,aAAAA,GAA8Bp1D,EAAa7D,QAAAA,IAIjDviB,IAAAA,CAAK8vE,KAAAA,GAAQ72D,EAAQ62D,KAAAA,IAAShiE,EAAOC,IAAAA,EACrC/N,IAAAA,CAAKukC,GAAAA,GAAMtrB,EAAQsrB,GAAAA,IAAOz2B,EAAOC,IAAAA,EACjC/N,IAAAA,CAAKi1B,MAAAA,GAAuB,SAAd,CAAA,IAAAhc,EAAQgc,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAInnB,EAAOC,IACzC;YAAA;YAKO,QAAAkE;gBACL,OAAO,IAAIqqE,GAAa;oBACtBxM,OAAO9vE,IAAAA,CAAK8vE,KAAAA,CAAM79D,KAAAA;oBAClBsyB,KAAKvkC,IAAAA,CAAKukC,GAAAA,CAAItyB,KAAAA;gBAAAA;YAElB;YAEA,IAAA,WAAWwjE;gBAAAA,IAAAA;gBACT,MAAMxvD,IAAKjmB,IAAAA,CAAK6yC,UAAAA;gBAChB,OAAqC,SAA9B,CAAA,IAAA5sB,QAAAA,IAAAA,KAAE,IAAFA,EAAI6qB,SAAAA,CAAU1gC,GAAAA,CAAIpQ,IAAAA,CAAKi1B,MAAAA,CAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIj1B,IAAAA,CAAKi1B,MAChD;YAAA;YAKA,IAAA,SAAW3Y;gBACT,MAAMwzD,IAAQ9vE,IAAAA,CAAK0jF,oBAAAA,IACbn/C,IAAMvkC,IAAAA,CAAK2jF,kBAAAA;gBAEjB,OADY7T,EAAM3/D,OAAAA,CAAQo0B;YAE5B;YAEQ,uBAAAm/C;gBACN,OAAO1jF,IAAAA,CAAKw7E,aAAAA,CAAc9nE,QAAAA,CAAS1T,IAAAA,CAAK8vE,KAAAA;YAC1C;YAEQ,qBAAA6T;gBACN,OAAO3jF,IAAAA,CAAKw7E,aAAAA,CAAc9nE,QAAAA,CAAS1T,IAAAA,CAAKukC,GAAAA;YAC1C;YAKO,WAAAwrC;gBACL,MAAMD,IAAQ9vE,IAAAA,CAAK0jF,oBAAAA,IACbn/C,IAAMvkC,IAAAA,CAAK2jF,kBAAAA,IACX90E,IAAWihE,EAAMjhE,QAAAA,CAAS01B;gBAChC,OAAOA,EAAIh0B,GAAAA,CAAIu/D,GAAO7/D,KAAAA,CAAM,IAAIpB;YAClC;YAKO,YAAAohE;gBACL,MAAMH,IAAQ9vE,IAAAA,CAAK0jF,oBAAAA,IACbn/C,IAAMvkC,IAAAA,CAAK2jF,kBAAAA;gBAEjB,OADiB7T,EAAMjhE,QAAAA,CAAS01B;YAElC;YAKO,WAAAxlB;gBACL,OAAA,CAAO;YACT;YAKO,QAAQd,CAAAA,EAAU1Y,IAAcqJ,IAAAA,CAAAA,EAAAA;gBAAAA,IAAAA;gBACrC,MAAMihE,IAAY7vE,IAAAA,CAAK0jF,oBAAAA,GAAuBnzE,GAAAA,CAAI0N,EAAIpD,GAAAA;gBAGtD,IAAuC,MAAnCoD,EAAIK,GAAAA,CAAI1N,KAAAA,CAAM5Q,IAAAA,CAAK+vE,QAAAA,OAAkD,MAA7BF,EAAUj/D,KAAAA,CAAMqN,EAAIK,GAAAA,GAC9D,OAAO;gBAIT,MAAM0xD,IAAU/xD,EAAIK,GAAAA,CAAI1N,KAAAA,CAAM5Q,IAAAA,CAAK+vE,QAAAA;gBACnC,IAAgB,MAAZC,GACF,OAAO;gBAGT,MAAMx5D,IAAIq5D,EAAUj/D,KAAAA,CAAM5Q,IAAAA,CAAK+vE,QAAAA,MAAcC;gBAE7C,IAAIx5D,KAAK,KAAKA,KAAKjR,GAAK;oBACtB,MAAM8rD,IAAIwe,EAAUj/D,KAAAA,CAAMqN,EAAIK,GAAAA,IAAO0xD,IAAUhwE,IAAAA,CAAKiwE,SAAAA;oBACpD,IAAI5e,KAAK,KAAKA,KAAK,GACjB,OAAO;wBACLxiD,UAAU2H;wBACVzF,QAAQ/Q,IAAAA,CAAKq6E,MAAAA,GAAStpE,MAAAA;wBACtB+7D,UAAU9sE,IAAAA;wBACV8Z,MAAgB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;wBACtB5vD,OAAOqB,EAAIkyD,QAAAA,CAAS35D;oBAAAA;gBAG1B;gBAEA,OAAO;YACT;YAMO,sBAAsB4lE,CAAAA,EAAAA;gBAC3B,IAAIA,aAAiBb,IACnB,OAAOnC,GAAqB8B,qBAAAA,CAAsBkB,GAAOp8E,IAAAA;gBACpD,IAAIo8E,aAAiBC,IAC1B,OAAOjD,GAAqBQ,sBAAAA,CAAuBwC,GAAOp8E,IAAAA,EAAMq3E,IAAAA;gBAC3D,IAAI+E,aAAiBE,IAC1B,OAAOlD,GAAqBgC,mBAAAA,CAAoBp7E,IAAAA,EAAMo8E;gBAEtD,MAAM,IAAIj2E,MAAM,2DAAA,OAAgEi2E;YAEpF;YAKO,QAAQA,CAAAA,EAAAA;gBACb,IAAIA,aAAiBb,IACnB,OAAOgB,GAAmBG,iBAAAA,CAAkBN,GAAOp8E,IAAAA;gBAC9C,IAAIo8E,aAAiBC,IAC1B,OAAOE,GAAmB0F,kBAAAA,CAAmB7F,GAAOp8E,IAAAA;gBAC/C,IAAIo8E,aAAiBE,IAC1B,OAAOC,GAAmByF,eAAAA;gBAE1B,MAAM,IAAI77E,MAAM,wDAAA,OAA6Di2E;YAEjF;YAKO,iBAAiB/gE,CAAAA,EAAAA;gBACtB,MAAMuoE,IAAmB5jF,IAAAA,CAAK0jF,oBAAAA,IACxBG,IAAiB7jF,IAAAA,CAAK2jF,kBAAAA;gBAC5B,OAAItoE,EAAU1K,GAAAA,CAAIizE,KAAoB,IAC7BA,IAEAC;YAEX;YAEQ,oBAAoB/T,CAAAA,EAAevrC,CAAAA,EAAa2T,IAAU,EAAA,EAAA;gBAGhE,OAAO,IAAI58B,EACThW,KAAKkF,GAAAA,CAAIslE,EAAMxjE,CAAAA,EAAGi4B,EAAIj4B,CAAAA,IAAK4rC,GAC3B5yC,KAAKkF,GAAAA,CAAIslE,EAAM1lE,CAAAA,EAAGm6B,EAAIn6B,CAAAA,IAAK8tC,GAC3B5yC,KAAKC,GAAAA,CAAIuqE,EAAMxjE,CAAAA,EAAGi4B,EAAIj4B,CAAAA,IAAK4rC,GAC3B5yC,KAAKC,GAAAA,CAAIuqE,EAAM1lE,CAAAA,EAAGm6B,EAAIn6B,CAAAA,IAAK8tC;YAE/B;YAKA,IAAA,SAAWljB;gBACT,MAAM4uD,IAAmB5jF,IAAAA,CAAK0jF,oBAAAA,IACxBG,IAAiB7jF,IAAAA,CAAK2jF,kBAAAA;gBAC5B,OAAO3jF,IAAAA,CAAK8jF,mBAAAA,CAAoBF,GAAkBC;YACpD;YAKA,IAAA,cAAW33D;gBACT,OAAOlsB,IAAAA,CAAK8jF,mBAAAA,CAAoB9jF,IAAAA,CAAK8vE,KAAAA,EAAO9vE,IAAAA,CAAKukC,GAAAA;YACnD;YAKO,SAAA81C;gBACL,OAAO,IAAIxD,GAAY72E,IAAAA,CAAK0jF,oBAAAA,IAAwB1jF,IAAAA,CAAK2jF,kBAAAA;YAC3D;YAKO,cAAAnC;gBACL,OAAO,IAAI3K,GAAY72E,IAAAA,CAAK8vE,KAAAA,EAAO9vE,IAAAA,CAAKukC,GAAAA;YAC1C;YAKA,IAAA,OAAWmxC;gBACT,MACMqO,IADI/jF,IAAAA,CAAK2jF,kBAAAA,GAAqBpzE,GAAAA,CAAIvQ,IAAAA,CAAK0jF,oBAAAA,IACxB3yE,MAAAA,IAEf2kE,IAAO,EAAA;gBAKb,OAJAA,EAAK/1E,IAAAA,CAAKokF,IACVrO,EAAK/1E,IAAAA,CAAKokF,EAAW/yE,MAAAA,KACrB0kE,EAAK/1E,IAAAA,CAAKokF,EAAWhzE,MAAAA,KACrB2kE,EAAK/1E,IAAAA,CAAKokF,EAAWhzE,MAAAA,GAASC,MAAAA,KACvB0kE;YACT;YAMO,WAAWI,CAAAA,EAAAA;gBAChB,MAAMx1E,IAASN,IAAAA,CAAKukC,GAAAA,CAAIh0B,GAAAA,CAAIvQ,IAAAA,CAAK8vE,KAAAA,EAAOjhE,QAAAA,KAAa;gBACrD,OAAOinE,IAAOx1E,IAASA;YACzB;YAKO,OAAOyc,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ/c,IAAAA,CAAK6yC,UAAAA,GAAa91B;gBACgB,CAAA,SAAhB,CAAA,IAAAA,EAAUC,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIhd,IAAAA,CAAKw7E,aAAAA,AAAAA,EACjCvpE,KAAAA,CAAMjS,IAAAA,CAAKw7E,aAAAA,GACrBx7E,IAAAA,CAAKw7E,aAAAA,CAAc7+D,SAAAA,CAAU3c,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EAAGtM,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA;YAC1D;YAKO,QAAQ24C,CAAAA,EAAAA;gBACb,MAAM65B,IAAU,EAAA,EAEV7gE,IAAS;oBAAC/b,IAAAA,CAAK0jF,oBAAAA;oBAAwB1jF,IAAAA,CAAK2jF,kBAAAA;iBAAAA,EAC5ChsE,IAAMoE,EAAOzb,MAAAA;gBACnB,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IACvBo8E,EAAQj9E,IAAAA,CAAKoc,CAAAA,CAAOvb,EAAAA,CAAGmQ,GAAAA,CAAIoyC;gBAG7B,OAAO,IAAIkqB,GAAW3nE,KAAKkF,GAAAA,CAAIuO,KAAAA,CAAMzT,MAAMs3E,IAAUt3E,KAAKC,GAAAA,CAAIwT,KAAAA,CAAMzT,MAAMs3E;YAC5E;YAEO,MAAM98D,CAAAA,EAA8BnM,CAAAA,EAAAA;gBACzC,MAAMm8D,IAAQ9vE,IAAAA,CAAK0jF,oBAAAA,IACbn/C,IAAMvkC,IAAAA,CAAK2jF,kBAAAA;gBACjB7jE,EAAGirB,QAAAA,CAAS+kC,GAAOvrC,GAAK5wB,GAAO,IAC/BmM,EAAGixC,UAAAA,CAAW+e,GAAO,GAAGn8D,IACxBmM,EAAGixC,UAAAA,CAAWxsB,GAAK,GAAG5wB;YACxB;QAAA;QCzRK,MAAMsE;YAIX,OAAA,wBAA+Bmf,CAAAA,EAAAA;gBAC7Bnf,GAAMwB,IAAAA,GAAO2d;YACf;YACA,OAAA,KAAY6sD,CAAAA,EAAAA;gBACVjkF,IAAAA,CAAKquD,UAAAA,CAAW1uD,IAAAA,CAAKskF;YACvB;YAEA,OAAA,UAAiBrnE,CAAAA,EAAe3D,CAAAA,EAAAA;gBAC9BhB,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACVA,EAAIpf,KAAAA,CAAM6zC,SAAAA,CAAUjvC,GAAO3D;gBAAQ;YAEvC;YAEA,OAAA,SAAgBjU,CAAAA,EAAeu/B,CAAAA,EAAatrB,CAAAA,EAAAA;gBAC1ChB,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACVA,EAAIpf,KAAAA,CAAM+yB,QAAAA,CAAS/lC,GAAOu/B,GAAKtrB;gBAAQ;YAE3C;YAEA,OAAA,UAAiB8C,CAAAA,EAAkB9C,CAAAA,EAAAA;gBAC7B8C,EAAOzb,MAAAA,GAAS,KAClB2X,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACV,IAAK,IAAI52B,IAAI,GAAGA,IAAIub,EAAOzb,MAAAA,GAAS,GAAGE,IACrC42B,EAAIpf,KAAAA,CAAM+yB,QAAAA,CAAShvB,CAAAA,CAAOvb,EAAAA,EAAIub,CAAAA,CAAOvb,IAAI,EAAA,EAAIyY;gBAC/C;YAGN;YAEA,OAAA,SAAgB2a,CAAAA,EAAc/Y,CAAAA,EAAAA;gBAC5B5C,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACVA,EAAIpf,KAAAA,CAAMw1C,QAAAA,CAAS55B,GAAM/Y;gBAAI;YAEjC;YAEA,OAAA,YAAmBkB,CAAAA,EAAkB9C,CAAAA,EAAAA;gBAC/B8C,EAAOzb,MAAAA,GAAS,KAClB2X,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACV,MAAMgtD,IAAaroE,CAAAA,CAAO,EAAA,EACpB89D,IAAU;2BAAI99D;wBAAQqoE;qBAAAA;oBAC5B,IAAK,IAAI5jF,IAAI,GAAGA,IAAIq5E,EAAQv5E,MAAAA,GAAS,GAAGE,IACtC42B,EAAIpf,KAAAA,CAAM+yB,QAAAA,CAAS8uC,CAAAA,CAAQr5E,EAAAA,EAAIq5E,CAAAA,CAAQr5E,IAAI,EAAA,EAAIyY;gBACjD;YAGN;YAEA,OAAA,WACEqD,CAAAA,EACAsvB,CAAAA,EACA3yB,CAAAA,EAAAA;gBAMA,MAAA,EAAM,OAAEtF,CAAAA,EAAK,aAAEmkC,CAAAA,EAAW,OAAE39B,CAAAA,EAAAA,GAAU;oBACpCxG,OAAOvB,EAAMyC,KAAAA;oBACbijC,aAAAA,KAAah3C;oBACbqZ,OAAAA,KAAOrZ;oBAAAA,GACJmY,CAAAA;gBAAAA;gBAELhB,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACVA,EAAI25B,UAAAA,CAAWz0C,GAAQsvB,GAAQj4B,GAAOmkC,GAAa39B;gBAAM;YAE7D;YAEA,OAAA,WAAkBmqE,CAAAA,EAA0BrrE,CAAAA,EAAAA;gBAC1ChB,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACVA,EAAIpf,KAAAA,CAAM+H,QAAAA,CAASukE,EAAY9pE,IAAAA,EAAM8pE,EAAY7pE,GAAAA,EAAK6pE,EAAYnqE,KAAAA,EAAOmqE,EAAYjqE,MAAAA,EAAQpB;gBAAQ;YAEzG;YAEA,OAAA,QAAegF,CAAAA,EAAUhF,CAAAA,EAAAA;gBACvB,MAAA,EAAM,UAAEpK,CAAAA,EAAQ,OAAE8E,CAAAA,EAAAA,GAAU;oBAC1BA,OAAOvB,EAAMuD,IAAAA;oBACb9G,UAAU;oBAAA,GACPoK,CAAAA;gBAAAA;gBAELhB,GAAM4H,IAAAA,CAAMuX,CAAAA;oBACV,MAAMpyB,IAAQiZ,EAAIpD,GAAAA,EACZ0pB,IAAMtmB,EAAIpD,GAAAA,CAAIzK,GAAAA,CAAI6N,EAAIK,GAAAA,CAAIrO,KAAAA,CAAMpB;oBAEtCuoB,EAAIpf,KAAAA,CAAM+yB,QAAAA,CAAS/lC,GAAOu/B,GAAK;wBAAE5wB,OAAAA;oBAAAA;gBAAQ;YAE7C;YAEA,OAAA,MAAayjB,CAAAA,EAAAA;gBACXA,EAAI7O,IAAAA,IACJ6O,EAAIvO,CAAAA,GAAI5Q,GAAM4Q,CAAAA;gBACd,KAAK,MAAM+nC,KAAY34C,GAAMo2C,UAAAA,CAC3BuC,EAASx5B;gBAEXA,EAAI5O,OAAAA,IACJvQ,GAAMzQ,KAAAA;YACR;YAEA,OAAA,QAAOA;gBACLyQ,GAAMo2C,UAAAA,CAAW/tD,MAAAA,GAAS;YAC5B;QAAA;QAtGO,GAAA+tD,UAAAA,GAA0D,EAAA,EAE1D,GAAAxlC,CAAAA,GAAYja,IAAAA;QC6Bd,MAAMytE,WAAwBlJ;YAO5B,YAAAnjC;gBACLhwC,IAAAA,CAAK27E,iBAAAA,GAAAA,CAAoB,GACzB37E,IAAAA,CAAKwkF,gBAAAA,GAAAA,CAAmB,GACxBxkF,IAAAA,CAAKykF,uBAAAA,GAAAA,CAA0B,GAC/BzkF,IAAAA,CAAK0kF,WAAAA,GAAAA,CAAc;YACrB;YAKA,IAAA,UAAWhG;gBACT,OAAO1+E,IAAAA,CAAK2kF,QACd;YAAA;YAMA,IAAA,OAAkB5oE,CAAAA,EAAAA;gBAChB,IAAIA,EAAOzb,MAAAA,GAAS,GAClB,MAAM,IAAI6F,MAAM;gBAElBnG,IAAAA,CAAK0b,OAAAA,GAAUK,GACf/b,IAAAA,CAAK4kF,sBAAAA,CAAuB5kF,IAAAA,CAAK0b,OAAAA,GACjC1b,IAAAA,CAAK6kF,iBAAAA,IACL7kF,IAAAA,CAAKgwC,SAAAA;YACP;YAEQ,oBAAA60C;gBACN,MAAMnG,IAAoB,EAAA;gBAC1B,IAAK,IAAIl+E,IAAI,GAAGA,IAAIR,IAAAA,CAAK0b,OAAAA,CAAQpb,MAAAA,EAAQE,IACvCk+E,EAAQ/+E,IAAAA,CAAKK,IAAAA,CAAK0b,OAAAA,CAAAA,AAASlb,CAAAA,IAAI,CAAA,IAAKR,IAAAA,CAAK0b,OAAAA,CAAQpb,MAAAA,CAAAA,CAAQiQ,GAAAA,CAAIvQ,IAAAA,CAAK0b,OAAAA,CAAQlb,EAAAA,EAAIuQ,MAAAA;gBAEhF/Q,IAAAA,CAAK2kF,QAAAA,GAAWjG;YAClB;YAMA,IAAA,SAAW3iE;gBACT,OAAO/b,IAAAA,CAAK0b,OACd;YAAA;YAGA,IAAA,YAAWqB;gBACT,OAAO/c,IAAAA,CAAK6yC,UACd;YAAA;YAMA,YAAY55B,CAAAA,CAAAA;gBAAAA,IAAAA;gBACV2T,KAAAA,IA5DM,IAAA,CAAAC,OAAAA,GAAUjW,EAAOS,WAAAA,IAkDjB,IAAA,CAAAw7B,UAAAA,GAAwB,IAAI,IAK5B,IAAA,CAAAiyC,kBAAAA,GAA+B,EAAA,EAC/B,IAAA,CAAAC,MAAAA,GAAwB,EAAA,EACxB,IAAA,CAAAC,WAAAA,GAA6B,EAAA,EA0R7B,IAAA,CAAAP,uBAAAA,GAAAA,CAA0B,GAwB1B,IAAA,CAAAC,WAAAA,GAAAA,CAAc,GAmBd,IAAA,CAAAF,gBAAAA,GAAAA,CAAmB,GA8NnB,IAAA,CAAA7I,iBAAAA,GAAAA,CAAoB,GA/hB1B37E,IAAAA,CAAKi1B,MAAAA,GAAuB,SAAd,CAAA,IAAAhc,EAAQgc,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAInnB,EAAOC,IAAAA,EACvC/N,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,CAAIvO,CAAAA,IAAKtM,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EACrCtM,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,CAAIzQ,CAAAA,IAAKpK,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA,EACrCpK,IAAAA,CAAK+b,MAAAA,GAAS9C,EAAQ8C,MAAAA,EAEjB/b,IAAAA,CAAKilF,QAAAA,MACHhsE,EAAQisE,qBAAAA,IACXllF,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,kLAONrY,IAAAA,CAAKmlF,wBAAAA;YACP;YAEQ,uBAAuBppE,CAAAA,EAAAA;gBACJ/b,IAAAA,CAAKolF,0BAAAA,CAA2BrpE,MAEvDA,EAAOg5B,OAAAA;YAEX;YACO,2BAA2Bh5B,CAAAA,EAAAA;gBAEhC,IAAIspE,IAAM;gBACV,IAAK,IAAI7kF,IAAI,GAAGA,IAAIub,EAAOzb,MAAAA,EAAQE,IACjC6kF,KAAAA,AAAQtpE,CAAAA,CAAAA,CAAAA,AAAQvb,CAAAA,IAAI,CAAA,IAAKub,EAAOzb,MAAAA,CAAAA,CAAQgM,CAAAA,GAAIyP,CAAAA,CAAOvb,EAAAA,CAAG8L,CAAAA,AAAAA,IAAMyP,CAAAA,CAAAA,CAAAA,AAAQvb,CAAAA,IAAI,CAAA,IAAKub,EAAOzb,MAAAA,CAAAA,CAAQ8J,CAAAA,GAAI2R,CAAAA,CAAOvb,EAAAA,CAAG4J,CAAAA,AAAAA;gBAE5G,OAAOi7E,IAAM;YACf;YAMO,WAAAJ;gBAEL,IAAIjlF,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,GAAS,GACvB,OAAA,CAAO;gBAET,IAAIglF,IAAWtlF,IAAAA,CAAK+b,MAAAA,CAAO/b,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,GAAS,EAAA,EAC5CilF,IAAWvlF,IAAAA,CAAK+b,MAAAA,CAAO/b,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,GAAS,EAAA,EAC5C+a,IAAY/V,KAAK4L,KAAAA,CAAMq0E,EAASn7E,CAAAA,GAAIk7E,EAASl7E,CAAAA,EAAGm7E,EAASj5E,CAAAA,GAAIg5E,EAASh5E,CAAAA,GACtEk5E,IAAe,GACfC,IAAc,GACdC,IAAW;gBACf,KAAK,MAAA,CAAOllF,GAAGoc,EAAAA,IAAU5c,IAAAA,CAAK+b,MAAAA,CAAOmyB,OAAAA,GAAW;oBAK9C,IAJAo3C,IAAWC,GACXC,IAAenqE,GACfkqE,IAAW3oE,GACXvB,IAAY/V,KAAK4L,KAAAA,CAAMq0E,EAASn7E,CAAAA,GAAIk7E,EAASl7E,CAAAA,EAAGm7E,EAASj5E,CAAAA,GAAIg5E,EAASh5E,CAAAA,GAClEg5E,EAASl2E,MAAAA,CAAOm2E,IAClB,OAAA,CAAO;oBAET,IAAIt4E,IAAQoO,IAAYmqE;oBAMxB,IALIv4E,KAAAA,CAAU3H,KAAK8G,EAAAA,GACjBa,KAAmB,IAAV3H,KAAK8G,EAAAA,GACLa,IAAQ3H,KAAK8G,EAAAA,IACtBa,CAAAA,KAAmB,IAAV3H,KAAK8G,EAAAA,AAAAA,GAEN,MAAN5L,GAAS;wBACX,IAAc,MAAVyM,GACF,OAAA,CAAO;wBAETw4E,IAAcx4E,IAAQ,IAAI,IAAA;oBAC5B,OACE,IAAIw4E,IAAcx4E,KAAS,GACzB,OAAA,CAAO;oBAGXy4E,KAAYz4E;gBACd;gBACA,OAA0D,MAAnD3H,KAAKyH,GAAAA,CAAIzH,KAAKuI,KAAAA,CAAM63E,IAAsB,CAAA,IAAVpgF,KAAK8G,EAAAA,AAAAA;YAC9C;YAKO,aAAAu5E;gBACL,MAAMC,IAAuB,EAAA;gBAC7B,IAAK,IAAIplF,IAAI,GAAGA,IAAIR,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,GAAS,GAAGE,IAC1ColF,EAASjmF,IAAAA,CAAK;oBAACK,IAAAA,CAAK+b,MAAAA,CAAO,EAAA;oBAAI/b,IAAAA,CAAK+b,MAAAA,CAAOvb,IAAI,EAAA;oBAAIR,IAAAA,CAAK+b,MAAAA,CAAOvb,IAAI,EAAA;iBAAA;gBAIrE,OAFAolF,EAASjmF,IAAAA,CAAK;oBAACK,IAAAA,CAAK+b,MAAAA,CAAO,EAAA;oBAAI/b,IAAAA,CAAK+b,MAAAA,CAAO,EAAA;oBAAI/b,IAAAA,CAAK+b,MAAAA,CAAO,EAAA;iBAAA,GAEpD,IAAIo1D,GAAkByU,EAAS3lF,GAAAA,CAAK8b,CAAAA,IAAW8pE,GAAMC,OAAAA,CAAQ/pE;YACtE;YAMO,cAAAgqE;gBAEL,IAAI/lF,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,GAAS,GACvB,MAAM6F,MAAM;gBAGd,MAAM6/E,IAAwC,EAAA,EAExCC,IAAW;uBAAIjmF,IAAAA,CAAK+b,MAAAA;iBAAAA,CAAQg5B,OAAAA;gBAClC,IAAImxC,IAAcD,EAAS3lF,MAAAA;gBAK3B,SAAS6lF,EAAa36E,CAAAA;oBACpB,OAAiB,MAAVA,IAAc06E,IAAc,IAAI16E,IAAQ;gBACjD;gBAKA,SAAS46E,EAAa56E,CAAAA;oBACpB,OAAOA,MAAU06E,IAAc,IAAI,IAAI16E,IAAQ;gBACjD;gBAKA,SAASy5E,EAASz5E,CAAAA;oBAChB,MAAM66E,IAAOF,EAAa36E,IACpBlB,IAAO87E,EAAa56E,IAEpB86E,IAAKL,CAAAA,CAASI,EAAAA,EACdE,IAAKN,CAAAA,CAASz6E,EAAAA,EACdg7E,IAAKP,CAAAA,CAAS37E,EAAAA,EAGdm8E,IAAUH,EAAG/1E,GAAAA,CAAIg2E,IACjBG,IAAWF,EAAGj2E,GAAAA,CAAIg2E;oBAExB,OAAA,CAAIE,CAAAA,EAAQ71E,KAAAA,CAAM81E,KAAY,CAAA;gBAIhC;gBAEA,MAAMC,IAAiBV,EAAShmF,GAAAA,CAAI,CAACkhC,GAAG3gC,IAAMykF,EAASzkF;gBAKvD,SAASomF,EAAkBhqE,CAAAA,EAAexa,CAAAA,EAAWkQ,CAAAA,EAAWmC,CAAAA;oBAC9D,MAAMoyE,IAAKv0E,EAAE/B,GAAAA,CAAInO,IACX0kF,IAAKryE,EAAElE,GAAAA,CAAI+B,IACXy0E,IAAK3kF,EAAEmO,GAAAA,CAAIkE,IAEXuyE,IAAKpqE,EAAMrM,GAAAA,CAAInO,IACf6kF,IAAKrqE,EAAMrM,GAAAA,CAAI+B,IACf40E,IAAKtqE,EAAMrM,GAAAA,CAAIkE,IAEf0yE,IAASN,EAAGj2E,KAAAA,CAAMo2E,IAClBI,IAASN,EAAGl2E,KAAAA,CAAMq2E,IAClBI,IAASN,EAAGn2E,KAAAA,CAAMs2E;oBAExB,OAAA,CAAIC,CAAAA,IAAS,KAAKC,IAAS,KAAKC,IAAS,CAAA;gBAI3C;gBAYA,SAASC;oBACP,IAAK,IAAI9mF,IAAI,GAAGA,IAAI0lF,GAAa1lF,IAC/B,IAAImmF,CAAAA,CAAenmF,EAAAA,EAAI;wBACrB,MAAM6lF,IAAOF,EAAa3lF,IACpB8J,IAAO87E,EAAa5lF,IAEpB8lF,IAAKL,CAAAA,CAASI,EAAAA,EACdE,IAAKN,CAAAA,CAASzlF,EAAAA,EACdgmF,IAAKP,CAAAA,CAAS37E,EAAAA;wBAEpB,IAAIi9E,IAAAA,CAAQ;wBAEZ,IAAK,IAAI7V,IAAI,GAAGA,IAAIwU,GAAaxU,IAAK;4BAEpC,IAAIA,MAAMlxE,KAAKkxE,MAAM2U,KAAQ3U,MAAMpnE,GACjC;4BAGF,IAAIs8E,EADUX,CAAAA,CAASvU,EAAAA,EACM4U,GAAIC,GAAIC,IAAK;gCACxCe,IAAAA,CAAQ;gCACR;4BACF;wBACF;wBAGA,IAAIA,GACF,OAAO/mF;oBAEX;oBAIF,IAAK,IAAIA,IAAI,GAAGA,IAAI0lF,GAAa1lF,IAC/B,IAAImmF,CAAAA,CAAenmF,EAAAA,EACjB,OAAOA;oBAKX,OAAO;gBACT;gBAKA,SAASgnF,EAAUh8E,CAAAA;oBACjB,MAAM66E,IAAOF,EAAa36E,IACpBlB,IAAO87E,EAAa56E,IAEpB86E,IAAKL,CAAAA,CAASI,EAAAA,EACdE,IAAKN,CAAAA,CAASz6E,EAAAA,EACdg7E,IAAKP,CAAAA,CAAS37E,EAAAA;oBAIpB07E,EAAUrmF,IAAAA,CAAK;wBAAC2mF;wBAAIC;wBAAIC;qBAAAA,GAExBP,EAASv9E,MAAAA,CAAO8C,GAAO,IACvBm7E,EAAej+E,MAAAA,CAAO8C,GAAO,IAC7B06E;gBACF;gBAGA,MAAOA,IAAc,GAAG;oBAEtBsB,EADiBF;oBAIjB,IAAK,IAAI9mF,IAAI,GAAGA,IAAI0lF,GAAa1lF,IAC/BmmF,CAAAA,CAAenmF,EAAAA,GAAKykF,EAASzkF;gBAEjC;gBAMA,OAHAwlF,EAAUrmF,IAAAA,CAAK;oBAACsmF,CAAAA,CAAS,EAAA;oBAAIA,CAAAA,CAAS,EAAA;oBAAIA,CAAAA,CAAS,EAAA;iBAAA,GAG5C,IAAI9U,GAAkB6U,EAAU/lF,GAAAA,CAAK8b,CAAAA,IAAW8pE,GAAMC,OAAAA,CAAQ/pE,GAAQjO,EAAOC,IAAAA,EAAAA,CAAM;YAC5F;YAKO,QAAAkE;gBACL,OAAO,IAAIoqE,GAAgB;oBACzBpnD,QAAQj1B,IAAAA,CAAKi1B,MAAAA,CAAOhjB,KAAAA;oBACpB8J,QAAQ/b,IAAAA,CAAK+b,MAAAA,CAAO9b,GAAAA,CAAKqW,CAAAA,IAAMA,EAAErE,KAAAA;gBAAAA;YAErC;YAKA,IAAA,WAAWwjE;gBACT,OAAOz1E,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GACzB;YAAA;YAKA,IAAA,SAAWyB;gBACT,OAAOtc,IAAAA,CAAKg1B,MAAAA,CAAO1Y,MACrB;YAAA;YAMQ,2BAAA6oE;gBACN,MAAMppE,IAAS/b,IAAAA,CAAK+b,MAAAA,EACdpE,IAAMoE,EAAOzb,MAAAA;gBACnBN,IAAAA,CAAK8kF,kBAAAA,CAAmBxkF,MAAAA,GAAS;gBACjC,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IACvBR,IAAAA,CAAK8kF,kBAAAA,CAAmBtkF,EAAAA,GAAKR,IAAAA,CAAK6yC,UAAAA,CAAW95B,KAAAA,CAAMgD,CAAAA,CAAOvb,EAAAA,CAAGyR,KAAAA;YAEjE;YAKO,uBAAAw1E;gBAKL,OAJIznF,IAAAA,CAAKykF,uBAAAA,IACPzkF,CAAAA,IAAAA,CAAKmlF,wBAAAA,IACLnlF,IAAAA,CAAKykF,uBAAAA,GAAAA,CAA0B,CAAA,GAE1BzkF,IAAAA,CAAK8kF,kBACd;YAAA;YAMO,WAAArL;gBACL,IAAIz5E,IAAAA,CAAK0kF,WAAAA,EAAa;oBACpB,MAAMnwD,IAAQ,EAAA,EACRxY,IAAS/b,IAAAA,CAAKynF,oBAAAA,IACd9vE,IAAMoE,EAAOzb,MAAAA;oBACnB,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IAEvB+zB,EAAM50B,IAAAA,CAAK,IAAIk3E,GAAY96D,CAAAA,CAAOvb,EAAAA,EAAIub,CAAAA,CAAAA,AAAQvb,CAAAA,IAAI,CAAA,IAAKmX,EAAAA;oBAEzD3X,IAAAA,CAAK+kF,MAAAA,GAASxwD,GACdv0B,IAAAA,CAAK0kF,WAAAA,GAAAA,CAAc;gBACrB;gBACA,OAAO1kF,IAAAA,CAAK+kF,MACd;YAAA;YAMO,gBAAAvE;gBACL,IAAIxgF,IAAAA,CAAKwkF,gBAAAA,EAAkB;oBACzB,MAAMjwD,IAAQ,EAAA,EACRxY,IAAS/b,IAAAA,CAAK+b,MAAAA,EACdpE,IAAMoE,EAAOzb,MAAAA;oBACnB,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IAEvB+zB,EAAM50B,IAAAA,CAAK,IAAIk3E,GAAY96D,CAAAA,CAAOvb,EAAAA,EAAIub,CAAAA,CAAAA,AAAQvb,CAAAA,IAAI,CAAA,IAAKmX,EAAAA;oBAEzD3X,IAAAA,CAAKglF,WAAAA,GAAczwD,GACnBv0B,IAAAA,CAAKwkF,gBAAAA,GAAAA,CAAmB;gBAC1B;gBAEA,OAAOxkF,IAAAA,CAAKglF,WACd;YAAA;YAMO,SAAS3pE,CAAAA,EAAAA;gBACd,MAAMilE,IAAQtgF,IAAAA,CAAKy5E,QAAAA;gBACnB,IAAI0G,IAAWG,CAAAA,CAAM,EAAA,EACjB1P,IAAAA,CAAeryD,OAAOC,SAAAA;gBAC1B,IAAK,IAAIxD,IAAO,GAAGA,IAAOslE,EAAMhgF,MAAAA,EAAQ0a,IAAQ;oBAC9C,MAAM0sE,IAAcpH,CAAAA,CAAMtlE,EAAAA,EAEpB2sE,IADaD,EAAY32E,MAAAA,GACEJ,GAAAA,CAAI0K;oBACjCssE,IAAgB/W,KAClBuP,CAAAA,IAAWuH,GACX9W,IAAc+W,CAAAA;gBAElB;gBACA,OAAOxH;YACT;YAMO,cAAc9kE,CAAAA,EAAAA;gBACnB,MAAMilE,IAAQtgF,IAAAA,CAAKwgF,aAAAA;gBACnB,IAAIL,IAAWG,CAAAA,CAAM,EAAA,EACjB1P,IAAAA,CAAeryD,OAAOC,SAAAA;gBAC1B,IAAK,IAAIxD,IAAO,GAAGA,IAAOslE,EAAMhgF,MAAAA,EAAQ0a,IAAQ;oBAC9C,MAAM0sE,IAAcpH,CAAAA,CAAMtlE,EAAAA,EAEpB2sE,IADaD,EAAY32E,MAAAA,GACEJ,GAAAA,CAAI0K;oBACjCssE,IAAgB/W,KAClBuP,CAAAA,IAAWuH,GACX9W,IAAc+W,CAAAA;gBAElB;gBACA,OAAOxH;YACT;YAKA,IAAA,OAAWzK;gBACT,MAAMA,IAAiB,EAAA,EACjB4K,IAAQtgF,IAAAA,CAAKy5E,QAAAA;gBACnB,IAAK,IAAIj5E,IAAI,GAAGA,IAAI8/E,EAAMhgF,MAAAA,EAAQE,IAChCk1E,EAAK/1E,IAAAA,CAAK2gF,CAAAA,CAAM9/E,EAAAA,CAAGuQ,MAAAA;gBAErB,OAAO2kE;YACT;YAQO,OAAO34D,CAAAA,EAAAA;gBACRA,KAEFA,CAAAA,EAAU00B,eAAAA,CAAgBzxC,IAAAA,CAAK6yC,UAAAA,GAC/B7yC,IAAAA,CAAKykF,uBAAAA,GAAAA,CAA0B,GAC/BzkF,IAAAA,CAAK0kF,WAAAA,GAAAA,CAAc,GACG,MAAlB1kF,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,IAA6B,MAAlBtM,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA,IACrCpK,CAAAA,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,CAAIvO,CAAAA,IAAKtM,IAAAA,CAAKi1B,MAAAA,CAAO3oB,CAAAA,EACrCtM,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,CAAIzQ,CAAAA,IAAKpK,IAAAA,CAAKi1B,MAAAA,CAAO7qB,CAAAA,AAAAA,GAGnCpK,IAAAA,CAAK6yC,UAAAA,CAAWrB,UAAAA,MAGlBxxC,CAAAA,IAAAA,CAAK+b,MAAAA,GAAS/b,IAAAA,CAAK+b,MAAAA,CAAO9b,GAAAA,CAAKqW,CAAAA,IAAM5H,EAAI4H,EAAEhK,CAAAA,GAAIE,EAAKxM,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM3D,CAAAA,GAAIgK,EAAElM,CAAAA,GAAIoC,EAAKxM,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM7F,CAAAA,KAC/GpK,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM3D,CAAAA,GAAIhH,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM3D,CAAAA,GACzDtM,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM7F,CAAAA,GAAI9E,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6yC,UAAAA,CAAW5iC,KAAAA,CAAM7F,CAAAA,CAAAA,CAAAA;YAG/D;YAKO,SAASwS,CAAAA,EAAAA;gBAGd,MAAMkhE,IAAa99E,IAAAA,CAAK6yC,UAAAA,CAAWvB,YAAAA,CAAa10B,IAC1CgrE,IAAU,IAAIhY,GAAIkO,GAAY,IAAIhwE,EAAO,GAAG;gBAElD,IAAI+5E,IAAiB;gBACrB,MAAMvH,IAAQtgF,IAAAA,CAAKwgF,aAAAA;gBACnB,IAAK,IAAIsH,IAAY,GAAGA,IAAYxH,EAAMhgF,MAAAA,EAAQwnF,IAAa;oBAC7D,MAAM9sE,IAAOslE,CAAAA,CAAMwH,EAAAA;oBACfF,EAAQpoE,SAAAA,CAAUxE,MAAS,KAC7B6sE;gBAEJ;gBAEA,OAAIA,IAAiB,KAAM;YAI7B;YAEO,sBAAsB/a,CAAAA,EAAAA;gBAC3B,IAAIA,aAAoByO,IACtB,OAAOnC,GAAqBmB,wBAAAA,CAAyBv6E,IAAAA,EAAM8sE;gBACtD,IAAIA,aAAoBuP,IAC7B,OAAOjD,GAAqBC,yBAAAA,CAA0Br5E,IAAAA,EAAM8sE;gBACvD,IAAIA,aAAoBwP,IAC7B,OAAOlD,GAAqBQ,sBAAAA,CAAuB55E,IAAAA,EAAM8sE;gBAEzD,MAAM,IAAI3mE,MAAM,2DAAA,OAAgE2mE;YAEpF;YAOO,QAAQA,CAAAA,EAAAA;gBACb,IAAIA,aAAoByO,IACtB,OAAOgB,GAAmBE,oBAAAA,CAAqB3P,GAAU9sE,IAAAA;gBACpD,IAAI8sE,aAAoBuP,IAC7B,OAAOE,GAAmB6F,qBAAAA,CAAsBpiF,IAAAA,EAAM8sE;gBACjD,IAAIA,aAAoBwP,IAC7B,OAAOC,GAAmB0F,kBAAAA,CAAmBjiF,IAAAA,EAAM8sE;gBAEnD,MAAM,IAAI3mE,MAAM,2DAAA,OAAgE2mE;YAEpF;YAKO,iBAAiBzxD,CAAAA,EAAAA;gBACtB,MAAM0sE,IAAM/nF,IAAAA,CAAKynF,oBAAAA;gBACjB,IAAIjV,IAAgB,MAChB5B,IAAAA,CAAeryD,OAAOC,SAAAA;gBAC1B,IAAK,IAAIhe,IAAI,GAAGA,IAAIunF,EAAIznF,MAAAA,EAAQE,IAAK;oBACnC,MAAMqO,IAAWwM,EAAU1K,GAAAA,CAAIo3E,CAAAA,CAAIvnF,EAAAA;oBAC/BqO,IAAW+hE,KACbA,CAAAA,IAAc/hE,GACd2jE,IAAgBuV,CAAAA,CAAIvnF,EAAAA,AAAAA;gBAExB;gBACA,OAAOgyE;YACT;YAMO,sBAAsBn3D,CAAAA,EAAAA;gBAC3B,MAAM0sE,IAAM/nF,IAAAA,CAAK+b,MAAAA;gBACjB,IAAIy2D,IAAgBuV,CAAAA,CAAI,EAAA,EACpBnX,IAAAA,CAAeryD,OAAOC,SAAAA;gBAC1B,IAAK,IAAIhe,IAAI,GAAGA,IAAIunF,EAAIznF,MAAAA,EAAQE,IAAK;oBACnC,MAAMqO,IAAWwM,EAAU1K,GAAAA,CAAIo3E,CAAAA,CAAIvnF,EAAAA;oBAC/BqO,IAAW+hE,KACbA,CAAAA,IAAc/hE,GACd2jE,IAAgBuV,CAAAA,CAAIvnF,EAAAA,AAAAA;gBAExB;gBACA,OAAOgyE;YACT;YAMO,eAAe51D,CAAAA,EAAAA;gBACpB,MAAM0jE,IAAQtgF,IAAAA,CAAKy5E,QAAAA;gBACnB,IAAIjvE,IAAM+T,OAAOypE,iBAAAA,EACbC,IAAAA,IACAp5E,IAAAA;gBACJ,IAAK,IAAIrO,IAAI,GAAGA,IAAI8/E,EAAMhgF,MAAAA,EAAQE,IAAK;oBACrC,MAAMijF,IAAOnD,CAAAA,CAAM9/E,EAAAA,CAAGi3E,eAAAA,CAAgB76D;oBAClC6mE,IAAOj5E,KACTA,CAAAA,IAAMi5E,GACNwE,IAAYznF,GACZqO,IAAW40E,CAAAA;gBAEf;gBAEA,OAAA,OAAIwE,IACK;oBACLp5E,UAAUyxE,CAAAA,CAAM2H,EAAAA,CAAWl3E,MAAAA,GAASd,KAAAA,CAAMpB;oBAC1CyrE,MAAMgG,CAAAA,CAAM2H,EAAAA;gBAAAA,IAIT;YACT;YAKA,IAAA,SAAWjzD;gBACT,OAAOh1B,IAAAA,CAAKksB,WAAAA,CAAYnP,SAAAA,CAAU/c,IAAAA,CAAK6yC,UAAAA,CAAW71B,MAAAA;YACpD;YAOA,IAAA,cAAWkP;gBAMT,OALIlsB,IAAAA,CAAK27E,iBAAAA,IACP37E,CAAAA,IAAAA,CAAKihD,YAAAA,GAAe3lC,EAAYQ,UAAAA,CAAW9b,IAAAA,CAAK+b,MAAAA,GAChD/b,IAAAA,CAAK27E,iBAAAA,GAAAA,CAAoB,CAAA,GAGpB37E,IAAAA,CAAKihD,YACd;YAAA;YAQO,WAAW60B,CAAAA,EAAAA;gBAChB,IAAI91E,IAAAA,CAAKkoF,WAAAA,KAAgBpS,KAAQ91E,IAAAA,CAAKmoF,cAAAA,EACpC,OAAOnoF,IAAAA,CAAKmoF,cAAAA;gBAEd,IAAItY,IAAY,GACZuY,IAAc;gBAClB,MAAMrsE,IAAS/b,IAAAA,CAAK+b,MAAAA;gBACpB,IAAK,IAAIvb,IAAI,GAAGA,IAAIub,EAAOzb,MAAAA,EAAQE,IAAK;oBACtC,MAAM6nF,IAAAA,AAAY7nF,CAAAA,IAAI,CAAA,IAAKub,EAAOzb,MAAAA,EAC5BgoF,IAAYvsE,CAAAA,CAAOssE,EAAAA,CAAUz3E,KAAAA,CAAMmL,CAAAA,CAAOvb,EAAAA;oBAChDqvE,KAAayY,IAAavsE,CAAAA,CAAAA,CAAOvb,EAAAA,CAAGmQ,GAAAA,CAAIoL,CAAAA,CAAOvb,EAAAA,IAAMub,CAAAA,CAAOvb,EAAAA,CAAGmQ,GAAAA,CAAIoL,CAAAA,CAAOssE,EAAAA,IAAatsE,CAAAA,CAAOssE,EAAAA,CAAU13E,GAAAA,CAAIoL,CAAAA,CAAOssE,EAAAA,CAAAA,GACnHD,KAAeE;gBACjB;gBAEA,OADAtoF,IAAAA,CAAKkoF,WAAAA,GAAcpS,GACX91E,IAAAA,CAAKmoF,cAAAA,GAAkBrS,IAAO,IAAMjG,CAAAA,IAAYuY,CAAAA;YAC1D;YAKO,QAAQnqE,CAAAA,EAAU1Y,IAAcqJ,IAAAA,CAAAA,EAAAA;gBAAAA,IAAAA;gBAGrC,MAAM0xE,IAAQtgF,IAAAA,CAAKy5E,QAAAA,IACb9hE,IAAM2oE,EAAMhgF,MAAAA;gBAClB,IACIioF,GADAC,IAAiBjqE,OAAOC,SAAAA,EAExBiqE,IAAAA;gBACJ,IAAK,IAAIjoF,IAAI,GAAGA,IAAImX,GAAKnX,IAAK;oBAC5B,MAAMkoF,IAAczqE,EAAIuB,SAAAA,CAAU8gE,CAAAA,CAAM9/E,EAAAA;oBACpCkoF,KAAe,KAAKA,IAAcF,KAAkBE,KAAenjF,KACrEijF,CAAAA,IAAiBE,GACjBH,IAAcjI,CAAAA,CAAM9/E,EAAAA,EACpBioF,IAAejoF,CAAAA;gBAEnB;gBAGA,OAAIioF,KAAgB,IACX;oBACL3b,UAAU9sE,IAAAA;oBACV6O,UAAU25E;oBACV1uE,MAAgB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;oBACtB5vD,OAAOqB,EAAIkyD,QAAAA,CAASqY;oBACpBz3E,QAAQw3E,EAAYx3E,MAAAA;gBAAAA,IAKjB;YACT;YAKO,QAAQgyC,CAAAA,EAAAA;gBACb,MAAMhnC,IAAS/b,IAAAA,CAAKynF,oBAAAA,IACd9vE,IAAMoE,EAAOzb,MAAAA;gBACnB,IAAIkK,IAAM+T,OAAOC,SAAAA,EACbjZ,IAAAA,CAAOgZ,OAAOC,SAAAA;gBAClB,IAAK,IAAIhe,IAAI,GAAGA,IAAImX,GAAKnX,IAAK;oBAC5B,MAAMmoF,IAAS5sE,CAAAA,CAAOvb,EAAAA,CAAGmQ,GAAAA,CAAIoyC;oBAC7Bv4C,IAAMlF,KAAKkF,GAAAA,CAAIA,GAAKm+E,IACpBpjF,IAAMD,KAAKC,GAAAA,CAAIA,GAAKojF;gBACtB;gBAEA,OAAO,IAAI1b,GAAWziE,GAAKjF;YAC7B;YAEO,MAAMua,CAAAA,EAA8BnM,CAAAA,EAAcsF,CAAAA,EAAAA;gBACvD,MAAM8C,IAAS/b,IAAAA,CAAKynF,oBAAAA;gBACpBxvE,GAAMksE,WAAAA,CAAYpoE,GAAQ;oBAAEpI,OAAAA;gBAAAA;YAC9B;QAAA;QCptBK,MAAMkyE;YAQX,OAAA,IAAW1rE,CAAAA,EAAeE,CAAAA,EAAgBvI,IAAiBhE,EAAOG,IAAAA,EAAMgnB,IAAiBnnB,EAAOC,IAAAA,EAAAA;gBAC9F,OAAO,IAAIsuE,GAAgB;oBACzBtgE,QAAQ,IAAIT,EAAAA,CAAanB,IAAQrI,EAAOxF,CAAAA,EAAAA,CAAI+N,IAASvI,EAAO1H,CAAAA,EAAG+P,IAAQA,IAAQrI,EAAOxF,CAAAA,EAAG+N,IAASA,IAASvI,EAAO1H,CAAAA,EAAGyS,SAAAA;oBACrHoY,QAAQA;gBAAAA;YAEZ;YASA,OAAA,QAAelZ,CAAAA,EAAkBkZ,IAAiBnnB,EAAOC,IAAAA,EAAMm3E,IAAAA,CAAwB,CAAA,EAAA;gBACrF,OAAO,IAAI7I,GAAgB;oBACzBtgE,QAAQA;oBACRkZ,QAAQA;oBACRiwD,uBAAAA;gBAAAA;YAEJ;YASA,OAAA,OAAct5C,CAAAA,EAAgB3W,IAAiBnnB,EAAOC,IAAAA,EAAAA;gBACpD,OAAO,IAAIwtE,GAAe;oBACxB3vC,QAAQA;oBACR3W,QAAQA;gBAAAA;YAEZ;YASA,OAAA,KAAY66C,CAAAA,EAAevrC,CAAAA,EAAAA;gBACzB,OAAO,IAAI+3C,GAAa;oBACtBxM,OAAOA;oBACPvrC,KAAKA;gBAAAA;YAET;YAWA,OAAA,QAAepqB,CAAAA,EAAeE,CAAAA,EAAgB4a,IAASnnB,EAAOC,IAAAA,EAAAA;gBAC5D,MAAM6b,IAAShT,EAAOS,WAAAA;gBAClB8C,MAAUE,KACZuP,EAAOvR,IAAAA,CAAK;gBAKd,IAFiBgC,KAAUF,GASzB,OALgB,IAAIg3D,GAAkB;oBACpC0U,GAAMgD,MAAAA,CAAO1uE,IAAQ,GAAGzL,EAAI,GAAA,CAAI2L,IAAS,IAAIF,IAAQ,GAAG/J,GAAAA,CAAI6kB;oBAC5D4wD,GAAM+C,GAAAA,CAAIzuE,GAAOE,IAASF,GAAOrM,EAAOG,IAAAA,EAAMgnB;oBAC9C4wD,GAAMgD,MAAAA,CAAO1uE,IAAQ,GAAGzL,EAAI,GAAG2L,IAAS,IAAIF,IAAQ,GAAG/J,GAAAA,CAAI6kB;iBAAAA;gBAU7D,OALgB,IAAIk8C,GAAkB;oBACpC0U,GAAMgD,MAAAA,CAAOxuE,IAAS,GAAG3L,EAAAA,CAAKyL,IAAQ,IAAIE,IAAS,GAAG,GAAGjK,GAAAA,CAAI6kB;oBAC7D4wD,GAAM+C,GAAAA,CAAIzuE,IAAQE,GAAQA,GAAQvM,EAAOG,IAAAA,EAAMgnB;oBAC/C4wD,GAAMgD,MAAAA,CAAOxuE,IAAS,GAAG3L,EAAIyL,IAAQ,IAAIE,IAAS,GAAG,GAAGjK,GAAAA,CAAI6kB;iBAAAA;YAIlE;QAAA;QCtFK,MAAM+zD,WAA0Br3C;YAYrC,YAAYm7B,CAAAA,CAAAA;gBACVlgD,KAAAA,IAZK,IAAA,CAAA1S,MAAAA,GAAS,IAAIhT,GAIb,IAAA,CAAA+hF,cAAAA,GAAiB,IAAIn3C,IAKrB,IAAA,CAAAo3C,gBAAAA,GAAmB,IAAIp3C,IAgCtB,IAAA,CAAAq3C,kBAAAA,GAAiC,EAAA,EA5BvCnpF,IAAAA,CAAKgrB,GAAAA,CAAI8hD;YACX;YAMO,MAAAnqE;gBACL,OAAO3C,IAAAA,CAAKopF,SACd;YAAA;YAOO,IAAwBtc,CAAAA,EAAAA;gBAS7B,OARA9sE,IAAAA,CAAKwH,KAAAA,IACDslE,KACF9sE,CAAAA,IAAAA,CAAKopF,SAAAA,GAAYtc,GACjB9sE,IAAAA,CAAKopF,SAAAA,CAAUx3C,KAAAA,GAAQ5xC,IAAAA,CAAK4xC,KAAAA,EAC5Bk7B,EAAS5yD,MAAAA,CAAO3R,IAAAA,CAAKvI,IAAAA,CAAKka,MAAAA,GAC1Bla,IAAAA,CAAKipF,cAAAA,CAAe12C,SAAAA,CAAUu6B,IAC9B9sE,IAAAA,CAAKytC,MAAAA,EAAAA,GAEAq/B;YACT;YAMO,QAAAtlE;gBACDxH,IAAAA,CAAKopF,SAAAA,IACPppF,CAAAA,IAAAA,CAAKmpF,kBAAAA,CAAmBxpF,IAAAA,CAAKK,IAAAA,CAAKopF,SAAAA,GAClCppF,IAAAA,CAAKopF,SAAAA,GAAY,IAAA;YAErB;YAEO,yBAAAC;gBACL,KAAK,MAAMvc,KAAY9sE,IAAAA,CAAKmpF,kBAAAA,CAC1Brc,EAAS5yD,MAAAA,CAAOvR,MAAAA,CAAO3I,IAAAA,CAAKka,MAAAA,GAC5Bla,IAAAA,CAAKkpF,gBAAAA,CAAiB32C,SAAAA,CAAUu6B,IAChCA,EAASl7B,KAAAA,GAAQ;YAErB;YAEO,QAAA3/B;gBAGL,OAFc,IAAI+2E,GAAkBhpF,IAAAA,CAAKopF,SAAAA,CAAUn3E,KAAAA;YAGrD;YAKA,IAAA,SAAW+iB;gBAAAA,IAAAA,GAAAA;gBACT,OAA6B,SAAtB,CAAA,IAAc,SAAd,CAAA,IAAAh1B,IAAAA,CAAKopF,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEp0D,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI,IAAI1Z;YACvC;YAKA,IAAA,cAAW4Q;gBAAAA,IAAAA,GAAAA;gBACT,OAAkC,SAA3B,CAAA,IAAc,SAAd,CAAA,IAAAlsB,IAAAA,CAAKopF,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEl9D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI,IAAI5Q;YAC5C;YAKO,SAAAmyB;gBAAAA,IAAAA;gBACL,MAAMxnB,IAAe,SAAV,CAAA,IAAAjmB,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAIgwC;gBACvB3yC,IAAAA,CAAKopF,SAAAA,IACPppF,CAAAA,IAAAA,CAAKopF,SAAAA,CAAUx3C,KAAAA,GAAQ5xC,IAAAA,CAAK4xC,KAAAA,EACxB3rB,KACFjmB,IAAAA,CAAKopF,SAAAA,CAAU37C,MAAAA,CAAOxnB,EAAGtjB,GAAAA,GAAAA;YAG/B;YAMA,QAAQsc,CAAAA,EAAAA;gBACN,IAAImtD,IAAYpsE,IAAAA,CAAKopF,SAAAA,EACjB/c,IAAYptD,EAAMmqE,SAAAA;gBACtB,IAAA,CAAKhd,KAAAA,CAAcC,GACjB,OAAO,EAAA;gBAKT,IAAIid,IAAAA,CAAU;gBAOd,IANIjd,aAAqB8E,MACvB/E,CAAAA,IAAYC,GACZA,IAAYrsE,IAAAA,CAAKopF,SAAAA,EACjBE,IAAAA,CAAU,CAAA,GAGRtpF,IAAAA,CAAKopF,SAAAA,EAAW;oBAClB,MAAMrW,IAAW3G,EAAUQ,OAAAA,CAAQP;oBACnC,OAAI0G,IACEuW,CAAAA,KACFvW,EAAS50B,OAAAA,CAASgF,CAAAA;wBAChBA,EAAQ45B,GAAAA,GAAM55B,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAC1BmyC,EAAQpyC,MAAAA,GAASoyC,EAAQpyC,MAAAA,CAAOC,MAAAA,IAChCmyC,EAAQ65B,OAAAA,GAAU75B,EAAQpyC,MAAAA,CAAOD,aAAAA,IACjCqyC,EAAQipB,SAAAA,GAAYpsE,IAAAA,CAAKopF,SAAAA,EACzBjmC,EAAQkpB,SAAAA,GAAYptD,EAAMmqE,SAAS;oBAAA,IAGhCrW,CAAAA,IAEF,EACT;gBAAA;gBACA,OAAO,EACT;YAAA;YAEA,MAAM7uB,CAAAA,EAAAA;gBACAlkD,IAAAA,CAAKopF,SAAAA,IACPppF,IAAAA,CAAKytC,MAAAA,IAGPztC,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,gBAAiBy/D,CAAAA;oBAC9B,MAAMqiB,IAAeriB;oBACrBhjB,EAAOhqC,MAAAA,CAAO/R,IAAAA,CACZ,gBACA,IAAI+6C,GAAkBqmC,EAAa9pF,IAAAA,EAAM8pF,EAAatqE,KAAAA,EAAOsqE,EAAavuE,IAAAA,EAAMuuE,EAAa1tE,YAAAA,EAAc0tE,EAAapmC,OAAAA,IAEtHe,aAAkBslC,MACpBtlC,EAAOulC,qBAAAA,CAAsBF,EAAa9pF,IAAAA,EAAM8pF,EAAatqE,KAAAA,EAAOsqE,EAAavuE,IAAAA,EAAMuuE,EAAapmC,OAAAA;gBACtG,IAEFnjD,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,iBAAkBy/D,CAAAA;oBAC/B,MAAMwiB,IAAgBxiB;oBACtBhjB,EAAOhqC,MAAAA,CAAO/R,IAAAA,CACZ,iBACA,IAAIi7C,GACFsmC,EAAcjqF,IAAAA,EACdiqF,EAAczqE,KAAAA,EACdyqE,EAAc1uE,IAAAA,EACd0uE,EAAc7tE,YAAAA,EACd6tE,EAAcvmC,OAAAA,IAGde,aAAkBslC,MACpBtlC,EAAOylC,sBAAAA,CAAuBD,EAAcjqF,IAAAA,EAAMiqF,EAAczqE,KAAAA,EAAOyqE,EAAc1uE,IAAAA,EAAM0uE,EAAcvmC,OAAAA;gBAC3G,IAEFnjD,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,kBAAmBy/D,CAAAA;oBAChC,MAAMliE,IAAQkiE;oBACdhjB,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,kBAAkB,IAAIu7C,GAAoB1+C,EAAMvF,IAAAA,EAAMuF,EAAMia,KAAAA,EAAOja,EAAMgW,IAAAA,EAAMhW,EAAMm+C,OAAAA,IACpGe,aAAkBslC,MACpBtlC,EAAO0lC,gBAAAA,CAAiB5kF,EAAMvF,IAAAA,EAAMuF,EAAMia,KAAAA,EAAOja,EAAMgW,IAAAA,EAAMhW,EAAMm+C,OAAAA;gBACrE,IAEFnjD,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,gBAAiBy/D,CAAAA;oBAC9B,MAAM3iC,IAAM2iC;oBACZhjB,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAIw7C,GAAkBpf,EAAI9kC,IAAAA,EAAM8kC,EAAItlB,KAAAA,EAAOslB,EAAIvpB,IAAAA,EAAMupB,EAAIgf,WAAAA,IACxFW,aAAkBslC,MACpBtlC,EAAO2lC,cAAAA,CAAetlD,EAAI9kC,IAAAA,EAAM8kC,EAAItlB,KAAAA,EAAOslB,EAAIvpB,IAAAA,EAAMupB,EAAIgf,WAAAA;gBAC3D;YAEJ;YAEA,WAAAhQ;gBACEvzC,IAAAA,CAAKka,MAAAA,CAAO1S,KAAAA,IACZxH,IAAAA,CAAKkpF,gBAAAA,CAAiB32C,SAAAA,CAAUvyC,IAAAA,CAAKopF,SAAAA;YACvC;YASA,eAAejvE,CAAAA,EAAeE,CAAAA,EAAgBvI,IAAiBhE,EAAOG,IAAAA,EAAMqO,IAAiBxO,EAAOC,IAAAA,EAAAA;gBAClG,MAAM++D,IAAW+Y,GAAM+C,GAAAA,CAAIzuE,GAAOE,GAAQvI,GAAQwK;gBAClD,OAAOtc,IAAAA,CAAKgrB,GAAAA,CAAI8hD;YAClB;YAWA,mBAAmB/wD,CAAAA,EAAkBO,IAAiBxO,EAAOC,IAAAA,EAAAA;gBAC3D,MAAMi8E,IAAOnE,GAAMC,OAAAA,CAAQ/pE,GAAQO;gBACnC,OAAOtc,IAAAA,CAAKgrB,GAAAA,CAAIg/D;YAClB;YAOA,kBAAkBp+C,CAAAA,EAAgBtvB,IAAiBxO,EAAOC,IAAAA,EAAAA;gBACxD,MAAM++D,IAAW+Y,GAAMgD,MAAAA,CAAOj9C,GAAQtvB;gBACtC,OAAOtc,IAAAA,CAAKgrB,GAAAA,CAAI8hD;YAClB;YAQA,gBAAgBgD,CAAAA,EAAevrC,CAAAA,EAAAA;gBAC7B,MAAMuoC,IAAW+Y,GAAMiD,IAAAA,CAAKhZ,GAAOvrC;gBACnC,OAAOvkC,IAAAA,CAAKgrB,GAAAA,CAAI8hD;YAClB;YAMA,qBAAqBsE,CAAAA,EAAAA;gBACnB,OAAOpxE,IAAAA,CAAKgrB,GAAAA,CAAI,IAAImmD,GAAkBC;YACxC;QAAA;QCxOF,IAAYgZ;QAAAA,CAAZ,SAAYA,CAAAA;YACV,EAAA,QAAA,GAAA,YACA,EAAA,CAAA,GAAA,KACA,EAAA,CAAA,GAAA;QACD,EAJWA,MAAAA,CAAAA,KAAe,CAAA,CAAA;QAUpB,MAAM5d,WAAsB76B;YAyBjC,YAAY14B,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,IAzBK,IAAA,CAAA07B,YAAAA,GAAe;oBAAC3V;oBAAoB4W;iBAAAA,EAE3B,IAAA,CAAA3pD,EAAAA,GAAiB4G,EAAS,QAAQgmE,GAAc3gD,GAAAA,KACzD,IAAA,CAAA3R,MAAAA,GAAS,IAAIhT,GAEb,IAAA,CAAA2qD,YAAAA,GAAe,IAAI,IAMnB,IAAA,CAAAw4B,sBAAAA,GAAAA,CAAkC,GAKlC,IAAA,CAAAC,4BAAAA,GAAAA,CAA+B,GAuD/B,IAAA,CAAA5d,aAAAA,GAA+BjC,GAAckC,gBAAAA,EAK7C,IAAA,CAAAzB,KAAAA,GAAwBC,GAAee,GAAAA,EAiCtC,IAAA,CAAAqe,SAAAA,GAAAA,CAAY,GA+Fb,IAAA,CAAAC,UAAAA,GAAqB,IAQrB,IAAA,CAAAC,QAAAA,GAAmB,KAKnB,IAAA,CAAAC,UAAAA,GAAAA,CAAsB,GAOtB,IAAA,CAAAC,oBAAAA,GAA0C,EAAA,EAqDzC,IAAA,CAAAC,aAAAA,GAAwB98E,EAAOC,IAAAA,EA8BhC,IAAA,CAAA88E,MAAAA,GAAiB,IAAI/8E,EAAO,GAAG,IAiB/B,IAAA,CAAAg9E,MAAAA,GAAiBh9E,EAAOC,IAAAA,EA0EvB,IAAA,CAAAg9E,eAAAA,GAAkBr8E,EAAI,GAAG,IACzB,IAAA,CAAAs8E,0BAAAA,GAA6Bt8E,EAAI,GAAG,IArXtCuK,IACFjZ,CAAAA,IAAAA,CAAK0sE,aAAAA,GAA4B,SAAZ,CAAA,IAAAzzD,EAAQxS,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAIzG,IAAAA,CAAK0sE,aAAAA,EAC1C1sE,IAAAA,CAAKkrE,KAAAA,GAAqB,SAAb,CAAA,IAAAjyD,EAAQiyD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIlrE,IAAAA,CAAKkrE,KAAAA,EACnClrE,IAAAA,CAAK0qF,UAAAA,GAA+B,SAAlB,CAAA,IAAAzxE,EAAQyxE,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI1qF,IAAAA,CAAK0qF,UAAAA,EAC7C1qF,IAAAA,CAAKirF,WAAAA,GAAc;oBAAA,GACdtX,KAA0BO,MAAAA;oBAAAA,GAC1Bj7D,EAAQiyE,MAAAA;gBAAAA,CAAAA,IAGblrF,IAAAA,CAAKirF,WAAAA,GAAc;oBAAA,GACdtX,KAA0BO,MAAAA;gBAAAA,GAGjCl0E,IAAAA,CAAKmrF,mBAAAA,CAAoBnrF,IAAAA,CAAKirF,WAAAA,GAC9BjrF,IAAAA,CAAKorF,KAAAA,GAAQ5e,GAAc6e,eAAAA,CAAgB9W,WAC7C;YAAA;YAEA,IAAA,SAAWv3D;gBACT,OAAOhd,IAAAA,CAAK+c,SAAAA,CAAUpa,GAAAA,GAAMqa,MAC9B;YAAA;YAMO,oBAAoBkuE,CAAAA,EAAAA;gBACzBlrF,IAAAA,CAAKirF,WAAAA,GAAc;oBAAA,GACdtX,KAA0BO,MAAAA;oBAAAA,GAC1BgX,CAAAA;gBAAAA,GAELlrF,IAAAA,CAAKsrF,QAAAA,GAAWtrF,IAAAA,CAAKirF,WAAAA,CAAY9W,iBAAAA,EACjCn0E,IAAAA,CAAKu9E,WAAAA,GAA8C,IAAhCv9E,IAAAA,CAAKirF,WAAAA,CAAY7W,YAAAA,EACpCp0E,IAAAA,CAAKq0E,aAAAA,GAAgBr0E,IAAAA,CAAKirF,WAAAA,CAAY5W,aACxC;YAAA;YAKO,OAAA,2BAAkC6W,CAAAA,EAAAA;gBACvC1e,GAAc6e,eAAAA,GAAkBH;YAClC;YAgBA,IAAA,OAAWpV;gBACT,OAAO91E,IAAAA,CAAKorF,KACd;YAAA;YAEA,IAAA,KAAgBI,CAAAA,EAAAA;gBACdxrF,IAAAA,CAAKorF,KAAAA,GAAQI,GACbxrF,IAAAA,CAAKmoF,cAAAA,GAAAA,KAAiBrnF,GACtBd,IAAAA,CAAKyrF,qBAAAA,GAAAA,KAAwB3qF;YAC/B;YAKA,IAAA,cAAW4qF;gBACT,OAAO1rF,IAAAA,CAAK0sE,aAAAA,KAAkBjC,GAAc1V,KAAAA,GAAQ,IAAI,IAAI/0D,IAAAA,CAAK81E,IACnE;YAAA;YAiBA,IAAA,WAAW6V;gBACT,OAAO3rF,IAAAA,CAAKs9E,UACd;YAAA;YAKA,IAAA,aAAWA;gBACT,OAAOt9E,IAAAA,CAAKuqF,SACd;YAAA;YAOO,YAAYoB,CAAAA,EAAAA;gBACjB3rF,IAAAA,CAAKs9E,UAAAA,GAAaqO;YACpB;YAEA,IAAA,WAAsBA,CAAAA,EAAAA;gBACpB3rF,IAAAA,CAAKuqF,SAAAA,GAAYoB,GACZA,IAIH3rF,CAAAA,IAAAA,CAAKwpD,GAAAA,GAAM17C,EAAOC,IAAAA,EAClB/N,IAAAA,CAAKypD,GAAAA,GAAM37C,EAAOC,IAAAA,EAClB/N,IAAAA,CAAK2pD,eAAAA,GAAkB,GACvB3pD,IAAAA,CAAKu9E,WAAAA,GAAc,CAAA,IALnBv9E,IAAAA,CAAKu9E,WAAAA,GAA8C,IAAhCv9E,IAAAA,CAAKirF,WAAAA,CAAY7W,YAOxC;YAAA;YAKO,eAAAyX;gBACD7rF,IAAAA,CAAKuqF,SAAAA,IACPvqF,CAAAA,IAAAA,CAAKs9E,UAAAA,GAAAA,CAAa,CAAA;gBAEpB,MAAMwO,IAAgB9rF,IAAAA,CAAKwpD,GAAAA,CAAI55C,SAAAA,GAAY5P,IAAAA,CAAKwpD,GAAAA,CAAI55C,SAAAA,GAAYtK,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK2pD,eAAAA,GAAkB3pD,IAAAA,CAAK2pD,eAAAA,GAC/F+zB,IAAO19E,IAAAA,CAAKirF,WAAAA,CAAY3W,SAAAA;gBAC9Bt0E,IAAAA,CAAKu9E,WAAAA,GAAcG,IAAO19E,IAAAA,CAAKu9E,WAAAA,GAAAA,AAAe,CAAA,IAAIG,CAAAA,IAAQoO,GAC1D9rF,IAAAA,CAAKu9E,WAAAA,GAAc7wE,EAAM1M,IAAAA,CAAKu9E,WAAAA,EAAa,GAAG,KAAKv9E,IAAAA,CAAKirF,WAAAA,CAAY7W,YAAAA,GAChEp0E,IAAAA,CAAKsrF,QAAAA,IAAYtrF,IAAAA,CAAKu9E,WAAAA,GAAcv9E,IAAAA,CAAKirF,WAAAA,CAAY7W,YAAAA,IACvDp0E,CAAAA,IAAAA,CAAKs9E,UAAAA,GAAAA,CAAa,CAAA;YAEtB;YAMA,IAAA,UAAWzzB;gBACT,IAAI7pD,IAAAA,CAAKmoF,cAAAA,EACP,OAAOnoF,IAAAA,CAAKmoF,cAAAA;gBAId,MAAMrb,IAAW9sE,IAAAA,CAAK4xC,KAAAA,CAAMjvC,GAAAA,CAAIqmF;gBAChC,IAAIlc,GAAU;oBACZA,EAASmc,cAAAA,CAAe92C,SAAAA,CAAU;wBAChCnyC,IAAAA,CAAKmoF,cAAAA,GAAiB;oBAAI,IAE5Brb,EAASoc,gBAAAA,CAAiB/2C,SAAAA,CAAU;wBAClCnyC,IAAAA,CAAKmoF,cAAAA,GAAiB;oBAAI;oBAE5B,MAAM4D,IAAgBjf,EAASnqE,GAAAA;oBAC/B,IAAIopF,GACF,OAAQ/rF,IAAAA,CAAKmoF,cAAAA,GAAiB4D,EAAclW,UAAAA,CAAW71E,IAAAA,CAAK81E,IAAAA;gBAEhE;gBACA,OAAO;YACT;YAMA,IAAA,iBAAWkW;gBACT,OAAIhsF,IAAAA,CAAKyrF,qBAAAA,GACAzrF,IAAAA,CAAKyrF,qBAAAA,GAENzrF,IAAAA,CAAKyrF,qBAAAA,GAAwBzrF,IAAAA,CAAK0sE,aAAAA,KAAkBjC,GAAc1V,KAAAA,GAAQ,IAAI,IAAI/0D,IAAAA,CAAK6pD,OACjG;YAAA;YAgCA,IAAA,SAAWtD;gBAAAA,IAAAA;gBACT,OAAA,CAAA,CAAmB,CAAA,SAAV,CAAA,IAAAvmD,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEqU,QAAAA,AAAAA;YACvB;YAKA,IAAA,WAAWA;gBAAAA,IAAAA;gBACT,OAAA,CAAA,CAAmB,CAAA,SAAV,CAAA,IAAAjmD,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEqU,QAAAA,AAAAA;YACvB;YAKA,IAAA,SAAW3pC;gBACT,OAAOtc,IAAAA,CAAK8wC,SACd;YAAA;YAKS,MAAMc,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACb5xC,IAAAA,CAAK+c,SAAAA,GAAsB,SAAV,CAAA,IAAA/c,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAIgwC,KACjC3yC,IAAAA,CAAKgqD,MAAAA,GAAmB,SAAV,CAAA,IAAAhqD,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI4mD;YAChC;YAEA,IAAA,MAAW1uC;gBACT,OAAO7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GACxB;YAAA;YAEA,IAAA,IAAepO,CAAAA,EAAAA;gBACbzM,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMpO;YACvB;YAOA,IAAA,YAAWqkC;gBACT,OAAO9wC,IAAAA,CAAK+c,SAAAA,CAAU+zB,SACxB;YAAA;YAEA,IAAA,UAAqBrkC,CAAAA,EAAAA;gBACnBzM,IAAAA,CAAK+c,SAAAA,CAAU+zB,SAAAA,GAAYrkC;YAC7B;YAOA,IAAA,SAAW6lE;gBACT,OAAOtyE,IAAAA,CAAK6xD,YAAAA,CAAah3C,GAC3B;YAAA;YAKA,IAAA,eAAWoxE;gBACT,OAAOjsF,IAAAA,CAAK4qF,aACd;YAAA;YAKA,IAAA,MAAWphC;gBACT,OAAOxpD,IAAAA,CAAKgqD,MAAAA,CAAOR,GACrB;YAAA;YAEA,IAAA,IAAe/8C,CAAAA,EAAAA;gBACbzM,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,GAAM/8C;YACpB;YAWA,IAAA,MAAWg9C;gBACT,OAAOzpD,IAAAA,CAAKgqD,MAAAA,CAAOP,GACrB;YAAA;YAEA,IAAA,IAAeh9C,CAAAA,EAAAA;gBACbzM,IAAAA,CAAKgqD,MAAAA,CAAOP,GAAAA,GAAMh9C;YACpB;YAUA,IAAA,SAAWm9C;gBACT,OAAO5pD,IAAAA,CAAKgqD,MAAAA,CAAOJ,MACrB;YAAA;YAEA,IAAA,OAAkBn9C,CAAAA,EAAAA;gBAChBzM,IAAAA,CAAKgqD,MAAAA,CAAOJ,MAAAA,GAASn9C;YACvB;YAKA,IAAA,cAAWy/E;gBACT,OAAOlsF,IAAAA,CAAK6xD,YAAAA,CAAalvC,QAC3B;YAAA;YAKA,IAAA,WAAWA;gBACT,OAAO3iB,IAAAA,CAAK+c,SAAAA,CAAUk0B,cACxB;YAAA;YAEA,IAAA,SAAoBxkC,CAAAA,EAAAA;gBAClBzM,IAAAA,CAAK+c,SAAAA,CAAUk0B,cAAAA,GAAiBxkC;YAClC;YAKA,IAAA,QAAWwD;gBACT,OAAOjQ,IAAAA,CAAK+c,SAAAA,CAAUszB,WACxB;YAAA;YAEA,IAAA,MAAiB5jC,CAAAA,EAAAA;gBACfzM,IAAAA,CAAK+c,SAAAA,CAAUszB,WAAAA,GAAc5jC;YAC/B;YAKA,IAAA,WAAW0/E;gBACT,OAAOnsF,IAAAA,CAAK6xD,YAAAA,CAAa5hD,KAC3B;YAAA;YAKA,IAAA,cAAWy5C;gBACT,OAAO1pD,IAAAA,CAAKgqD,MAAAA,CAAON,WACrB;YAAA;YAEA,IAAA,YAAuBA,CAAAA,EAAAA;gBACrB1pD,IAAAA,CAAKgqD,MAAAA,CAAON,WAAAA,GAAcA;YAC5B;YAKA,IAAA,kBAAWC;gBACT,OAAO3pD,IAAAA,CAAKgqD,MAAAA,CAAOL,eACrB;YAAA;YAKA,IAAA,gBAA2BvmD,CAAAA,EAAAA;gBACzBpD,IAAAA,CAAKgqD,MAAAA,CAAOL,eAAAA,GAAkBvmD;YAChC;YASO,aAAawZ,CAAAA,EAAeyvE,CAAAA,EAAAA;gBACjC,IAAIrsF,IAAAA,CAAK0sE,aAAAA,KAAkBjC,GAAcuH,MAAAA,EACvC;gBAGF,MAAMsa,IAAeD,EAAQp8E,KAAAA,CAAMjQ,IAAAA,CAAK0rF,WAAAA,EAAa1rF,IAAAA,CAAK+qF,eAAAA;gBAU1D,IATI/qF,IAAAA,CAAK2qF,oBAAAA,CAAqBliF,OAAAA,CAAQ2hF,GAAgBmC,CAAAA,IAAAA,MACpDD,CAAAA,EAAahgF,CAAAA,GAAI,CAAA,GAEftM,IAAAA,CAAK2qF,oBAAAA,CAAqBliF,OAAAA,CAAQ2hF,GAAgBoC,CAAAA,IAAAA,MACpDF,CAAAA,EAAaliF,CAAAA,GAAI,CAAA,GAGnBpK,IAAAA,CAAKwpD,GAAAA,CAAIh5C,QAAAA,CAAS87E,IAAAA,CAEbtsF,IAAAA,CAAK2qF,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBqC,QAAAA,GAAW;oBACjE,MAAMC,IAAqB9vE,EAAMrM,GAAAA,CAAIvQ,IAAAA,CAAK8wC,SAAAA,EAAW9wC,IAAAA,CAAKgrF,0BAAAA;oBAC1DhrF,IAAAA,CAAK2pD,eAAAA,IAAmB3pD,IAAAA,CAAKgsF,cAAAA,GAAiBU,EAAmB97E,KAAAA,CAAMy7E;gBACzE;YACF;YAMO,mBAAmBA,CAAAA,EAAAA;gBACxB,IAAIrsF,IAAAA,CAAK0sE,aAAAA,KAAkBjC,GAAcuH,MAAAA,EACvC;gBAGF,MAAMsa,IAAeD,EAAQp8E,KAAAA,CAAMjQ,IAAAA,CAAK0rF,WAAAA;gBAEpC1rF,IAAAA,CAAK2qF,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBmC,CAAAA,KACrDD,CAAAA,EAAahgF,CAAAA,GAAI,CAAA,GAEftM,IAAAA,CAAK2qF,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBoC,CAAAA,KACrDF,CAAAA,EAAaliF,CAAAA,GAAI,CAAA,GAGnBpK,IAAAA,CAAKwpD,GAAAA,GAAMxpD,IAAAA,CAAKwpD,GAAAA,CAAIp5C,GAAAA,CAAIk8E;YAC1B;YAOO,oBAAoB1vE,CAAAA,EAAeyvE,CAAAA,EAAAA;gBACxC,IAAIrsF,IAAAA,CAAK0sE,aAAAA,KAAkBjC,GAAcuH,MAAAA,IAAAA,CAIpChyE,IAAAA,CAAK2qF,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBqC,QAAAA,GAAW;oBACjE,MAAMC,IAAqB9vE,EAAMrM,GAAAA,CAAIvQ,IAAAA,CAAK8wC,SAAAA;oBAC1C9wC,IAAAA,CAAK2pD,eAAAA,IAAmB3pD,IAAAA,CAAKgsF,cAAAA,GAAiBU,EAAmB97E,KAAAA,CAAMy7E;gBACzE;YACF;YAKO,sBAAAQ;gBAEL7sF,IAAAA,CAAKqqF,sBAAAA,GAAAA,CAAyB;gBAC9B,MAAMpkE,IAAKjmB,IAAAA,CAAK+c,SAAAA,CAAUpa,GAAAA;gBAC1BsjB,EAAGhU,KAAAA,CAAMjS,IAAAA,CAAK6xD,YAAAA,GACd7xD,IAAAA,CAAK6xD,YAAAA,CAAa3hB,MAAAA,GAASjqB,EAAGiqB,MAAAA,EAC9BlwC,IAAAA,CAAK6qF,MAAAA,CAAO17E,KAAAA,CAAMnP,IAAAA,CAAKwpD,GAAAA,CAAIl9C,CAAAA,EAAGtM,IAAAA,CAAKwpD,GAAAA,CAAIp/C,CAAAA,GACvCpK,IAAAA,CAAK8qF,MAAAA,CAAO37E,KAAAA,CAAMnP,IAAAA,CAAKypD,GAAAA,CAAIn9C,CAAAA,EAAGtM,IAAAA,CAAKypD,GAAAA,CAAIr/C,CAAAA,GACvCpK,IAAAA,CAAKisF,YAAAA,CAAa98E,KAAAA,CAAMnP,IAAAA,CAAK8wC,SAAAA,CAAUxkC,CAAAA,EAAGtM,IAAAA,CAAK8wC,SAAAA,CAAU1mC,CAAAA;YAC3D;YAEO,QAAA6H;gBAEL,OADkB2a,KAAAA,CAAM3a;YAE1B;QAAA;QA/dc,GAAA4Z,GAAAA,GAAM,GAkBL,GAAAw/D,eAAAA,GAAyE;YAAA,GACnF1X,KAA0BO,MAAAA;QAAAA;QC5C1B,MAAM4Y,WAAkBv1C;YAC7B,YAAYt+B,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM3T,IACNjZ,IAAAA,CAAKma,KAAAA,GAAQlB,EAAQkB,KAAAA,EACrBna,IAAAA,CAAKqa,MAAAA,GAASpB,EAAQoB,MAAAA,EACtBra,IAAAA,CAAK84C,SAAAA;YACP;YAEO,QAAA7mC;gBACL,OAAO,IAAI66E,GAAU;oBACnB3yE,OAAOna,IAAAA,CAAKma,KAAAA;oBACZE,QAAQra,IAAAA,CAAKqa,MAAAA;oBAAAA,GACVra,IAAAA,CAAKisB,mBAAAA,EAAAA;oBAAAA,GACLjsB,IAAAA,CAAKu4C,kBAAAA,EAAAA;gBAAAA;YAEZ;YAEA,QAAQnhB,CAAAA,EAAAA;gBACFp3B,IAAAA,CAAK2T,KAAAA,IACPyjB,EAAIm7B,QAAAA,CAAS,GAAG,GAAGvyD,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,GAElCra,IAAAA,CAAK83C,WAAAA,IACP1gB,EAAI+6B,UAAAA,CAAW,GAAG,GAAGnyD,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA;YAE1C;QAAA;QCtBK,MAAMwuE,WAAetxC;YAE1B,IAAA,SAAW3L;gBACT,OAAO5rC,IAAAA,CAAKy7E,OACd;YAAA;YACA,IAAA,OAAkBr4E,CAAAA,EAAAA;gBAChBpD,IAAAA,CAAKy7E,OAAAA,GAAUr4E,GACfpD,IAAAA,CAAKma,KAAAA,GAAuB,IAAfna,IAAAA,CAAKy7E,OAAAA,EAClBz7E,IAAAA,CAAKqa,MAAAA,GAAwB,IAAfra,IAAAA,CAAKy7E,OAAAA,EACnBz7E,IAAAA,CAAKgwC,SAAAA;YACP;YACA,YAAY/2B,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,CAAM3T,IAXA,IAAA,CAAAwiE,OAAAA,GAAkB;gBAYxB,MAAMzjC,IAA6B,SAAjB,CAAA,IAAA/+B,EAAQ++B,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAK/+B,EAAQ6+B,WAAAA,GAAc,IAAI;gBAClE93C,IAAAA,CAAKk4C,OAAAA,GAAyB,SAAf,CAAA,IAAAj/B,EAAQi/B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,IAAIF,IAAY,GAClDh4C,IAAAA,CAAK4rC,MAAAA,GAAS3yB,EAAQ2yB,MAAAA,EACtB5rC,IAAAA,CAAKsvB,SAAAA,GAA6B,SAAjB,CAAA,IAAArW,EAAQqW,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI7B,GAAeI,OAAAA,EACrD7tB,IAAAA,CAAK84C,SAAAA;YACP;YAEO,QAAA7mC;gBACL,OAAO,IAAI42E,GAAO;oBAChBj9C,QAAQ5rC,IAAAA,CAAK4rC,MAAAA;oBAAAA,GACV5rC,IAAAA,CAAKisB,mBAAAA,EAAAA;oBAAAA,GACLjsB,IAAAA,CAAKu4C,kBAAAA,EAAAA;gBAAAA;YAEZ;YAEA,QAAQnhB,CAAAA,EAAAA;gBACFp3B,IAAAA,CAAK4rC,MAAAA,GAAS,KAChBxU,CAAAA,EAAI4iB,SAAAA,IACJ5iB,EAAIgjB,GAAAA,CAAIp6C,IAAAA,CAAK4rC,MAAAA,EAAQ5rC,IAAAA,CAAK4rC,MAAAA,EAAQ5rC,IAAAA,CAAK4rC,MAAAA,EAAQ,GAAa,IAAVtmC,KAAK8G,EAAAA,GAEnDpM,IAAAA,CAAK2T,KAAAA,IACPyjB,EAAIkjB,IAAAA,IAGFt6C,IAAAA,CAAK83C,WAAAA,IACP1gB,EAAImU,MAAAA,EAAAA;YAGV;QAAA;QCnCK,MAAMwhD,WAAyBp7C;YAkBpC,YAAY14B,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACV2T,KAAAA,IAbK,IAAA,CAAAogE,gBAAAA,GAAAA,CAAmB,GAKnB,IAAA,CAAAC,iBAAAA,GAAAA,CAAoB,GASzBjtF,IAAAA,CAAKgtF,gBAAAA,GAA4C,SAAzB,CAAA,IAAA/zE,QAAAA,IAAAA,KAAO,IAAPA,EAAS+zE,gBAAAA,AAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAIhtF,IAAAA,CAAKgtF,gBAAAA,EAC1DhtF,IAAAA,CAAKitF,iBAAAA,GAA8C,SAA1B,CAAA,IAAAh0E,QAAAA,IAAAA,KAAO,IAAPA,EAASg0E,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,IAAA,IAAIjtF,IAAAA,CAAKitF,iBAAAA,EAC5DjtF,IAAAA,CAAKksB,WAAAA,GAAcjT,QAAAA,IAAAA,KAAO,IAAPA,EAASiT,WAC9B;YAAA;QAAA;QCSK,MAAMghE;YACJ,OAAA,+BAAsCE,CAAAA,EAAAA;gBAC3C,OAAO,CAACnvC,GAAcj5C,GAAeu/B,GAAamR,IAC5CnR,IAAMv/B,IACDA,IAASooF,CAAAA,EAAOnvC,GAAM1Z,GAAKv/B,GAAO0wC,KAAYnR,CAAAA,IAE9C6oD,EAAOnvC,GAAMj5C,GAAOu/B,GAAKmR;YAGtC;YAEO,OAAA,2BAAkC03C,CAAAA,EAAAA;gBACvC,OAAO,CAACnvC,GAAcj5C,GAAeu/B,GAAamR,IACzC,IAAI5nC,EAAOs/E,EAAOnvC,GAAMj5C,EAAMsH,CAAAA,EAAGi4B,EAAIj4B,CAAAA,EAAGopC,IAAW03C,EAAOnvC,GAAMj5C,EAAMoF,CAAAA,EAAGm6B,EAAIn6B,CAAAA,EAAGsrC;YAE3F;QAAA;QAEc,GAAA43C,MAAAA,GAAyBJ,GAAgBC,8BAAAA,CACrD,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAAAA,AAC1D83C,CAAAA,KAAsBD,CAAAA,IACH7wB,IAAehnB,IAAW63C,IAInC,GAAAE,UAAAA,GAAaP,GAAgBC,8BAAAA,CACzC,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAAAA,AAC1D83C,CAAAA,KAAsBD,CAAAA,IACtB7wB,CAAAA,KAAehnB,CAAAA,IAEiBgnB,IAAc6wB,IAIpC,GAAAG,WAAAA,GAA8BR,GAAgBC,8BAAAA,CAC1D,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAAAA,CAC1D83C,CAAAA,KAAsBD,CAAAA,IACtB7wB,CAAAA,KAAehnB,CAAAA,IACmBgnB,CAAAA,IAAc,CAAA,IAAK6wB,IAI3C,GAAAI,aAAAA,GAAgCT,GAAgBC,8BAAAA,CAC5D,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAC1D83C,CAAAA,KAAsBD,GAAAA,AACtB7wB,CAAAA,KAAehnB,IAAW,CAAA,IAER,IACR83C,IAAW,IAAK9wB,IAAcA,IAAc6wB,IAAAA,CAI7CC,IAAW,IAAA,CAAA,EAFpB9wB,IAEyCA,CAAAA,IAAc,CAAA,IAAK,CAAA,IAAK6wB,CAAAA,IAIvD,GAAAK,WAAAA,GAA8BV,GAAgBC,8BAAAA,CAC1D,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAAAA,AAC1D83C,CAAAA,KAAsBD,CAAAA,IACtB7wB,CAAAA,KAAehnB,CAAAA,IACiBgnB,IAAcA,IAAc6wB,IAIlD,GAAAM,YAAAA,GAA+BX,GAAgBC,8BAAAA,CAC3D,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAE1DgnB,CAAAA,KAAehnB,GAAAA,AADf83C,CAAAA,KAAsBD,CAAAA,IAAAA,CAAAA,EAEtB7wB,IACiCA,IAAcA,IAAc,CAAA,IAAK6wB,CAAAA,IAIxD,GAAAO,cAAAA,GAAiCZ,GAAgBC,8BAAAA,CAC7D,CAACzwB,GAAqB6wB,GAAoBC,GAAkB93C,IAC1D83C,CAAAA,KAAsBD,GAAAA,AACtB7wB,CAAAA,KAAehnB,IAAW,CAAA,IACR,IACR83C,IAAW,IAAK9wB,IAAcA,IAAcA,IAAc6wB,IAG5DC,IAAW,IAAA,CAAA,AADnB9wB,CAAAA,KAAe,CAAA,IACwBA,IAAcA,IAAc,CAAA,IAAK6wB,CAAAA;QCpHvE,MAAMQ;YAKX,YAAY7pC,CAAAA,CAAAA;gBAHJ,IAAA,CAAA8pC,QAAAA,GAAqB,EAAA,EACrB,IAAA,CAAAC,cAAAA,GAAgC,MAChC,IAAA,CAAAC,iBAAAA,GAA8B,EAAA,EAEpCluF,IAAAA,CAAKmuF,OAAAA,GAAUjqC;YACjB;YAMO,IAAIG,CAAAA,EAAAA;gBACTrkD,IAAAA,CAAKguF,QAAAA,CAASruF,IAAAA,CAAK0kD;YACrB;YAMO,OAAOA,CAAAA,EAAAA;gBACZ,MAAM74C,IAAQxL,IAAAA,CAAKguF,QAAAA,CAASvlF,OAAAA,CAAQ47C;gBACpCrkD,IAAAA,CAAKguF,QAAAA,CAAStlF,MAAAA,CAAO8C,GAAO;YAC9B;YAKO,eAAA4iF;gBACLpuF,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA,GAAS,GACvBN,IAAAA,CAAKkuF,iBAAAA,CAAkB5tF,MAAAA,GAAS,GAC5BN,IAAAA,CAAKiuF,cAAAA,IACPjuF,IAAAA,CAAKiuF,cAAAA,CAAehuB,IAAAA;YAExB;YAMO,aAAAouB;gBACL,OAAOruF,IAAAA,CAAKguF,QAAAA,CAAS3tF,MAAAA,CAAOL,IAAAA,CAAKkuF,iBAAAA;YACnC;YAEO,uBAAAI;gBACL,OAAOtuF,IAAAA,CAAKguF,QACd;YAAA;YAEO,mBAAAO;gBACL,OAAOvuF,IAAAA,CAAKiuF,cACd;YAAA;YAMO,UAAAO;gBACL,OAAOxuF,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA,GAAS;YAChC;YAKO,aAAAmuF;gBACL,OAAgC,MAAzBzuF,IAAAA,CAAKguF,QAAAA,CAAS1tF,MACvB;YAAA;YAKO,QAAAqb;gBACL3b,IAAAA,CAAKguF,QAAAA,GAAWhuF,IAAAA,CAAKquF,UAAAA;gBAErB,MAAM12E,IAAM3X,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA;gBAC1B,IAAK,IAAIE,IAAI,GAAGA,IAAImX,GAAKnX,IACvBR,IAAAA,CAAKguF,QAAAA,CAASxtF,EAAAA,CAAGmb,KAAAA;gBAEnB3b,IAAAA,CAAKkuF,iBAAAA,GAAoB,EAC3B;YAAA;YAMO,OAAOp3C,CAAAA,EAAAA;gBACZ,IAAI92C,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA,GAAS,KACrBN,CAAAA,IAAAA,CAAKiuF,cAAAA,KAAmBjuF,IAAAA,CAAKguF,QAAAA,CAAS,EAAA,IACxChuF,CAAAA,IAAAA,CAAKiuF,cAAAA,GAAiBjuF,IAAAA,CAAKguF,QAAAA,CAAS,EAAA,EACpChuF,IAAAA,CAAKmuF,OAAAA,CAAQhmF,IAAAA,CAAK,eAAe,IAAIi8C,GAAiBpkD,IAAAA,CAAKiuF,cAAAA,EAAgBjuF,IAAAA,CAAKmuF,OAAAA,EAAAA,GAGlFnuF,IAAAA,CAAKiuF,cAAAA,CAAexgD,MAAAA,CAAOqJ,IAEvB92C,IAAAA,CAAKiuF,cAAAA,CAAeQ,UAAAA,CAAWzuF,IAAAA,CAAKmuF,OAAAA,CAAAA,GAAU;oBAChDnuF,IAAAA,CAAKmuF,OAAAA,CAAQhmF,IAAAA,CAAK,kBAAkB,IAAIm8C,GAAoBtkD,IAAAA,CAAKiuF,cAAAA,EAAgBjuF,IAAAA,CAAKmuF,OAAAA;oBACtF,MAAM7qB,IAAWtjE,IAAAA,CAAKguF,QAAAA,CAASxsE,KAAAA;oBAC3B8hD,KACFtjE,IAAAA,CAAKkuF,iBAAAA,CAAkBvuF,IAAAA,CAAK2jE;gBAEhC;YAEJ;QAAA;QCvGF,IAAIorB,KAAa;QAIV,SAASC;YACd,OAAOD;QACT;QCdO,MAAM1gE;YAQX,YAAYk2B,CAAAA,EAAgB0qC,CAAAA,EAAsDC,CAAAA,CAAAA;gBAPlF,IAAA,CAAAjvF,EAAAA,GAAK+uF,MAIG,IAAA,CAAAG,QAAAA,GAAAA,CAAoB,GAI1B9uF,IAAAA,CAAK+uF,cAAAA,GAAiBH,GACtB5uF,IAAAA,CAAKgvF,cAAAA,GAAiB,IAAIC,GAAc/qC,IACxClkD,IAAAA,CAAKkvF,YAAAA,GAAelvF,IAAAA,CAAKgvF,cAAAA,CAAeG,QAAAA,IAExCnvF,IAAAA,CAAKovF,OAAAA,GAAUP,GACf7uF,IAAAA,CAAKqvF,eAAAA,GAAkBR,GAEvB7uF,IAAAA,CAAK+uF,cAAAA,CAAe/uF,IAAAA,CAAKgvF,cAAAA,GACzBhvF,IAAAA,CAAKovF,OAAAA;YACP;YAEO,OAAOt4C,CAAAA,EAAAA;gBACR92C,IAAAA,CAAKkvF,YAAAA,CAAaT,UAAAA,MACpBzuF,CAAAA,IAAAA,CAAKkvF,YAAAA,CAAad,YAAAA,IAClBpuF,IAAAA,CAAK+uF,cAAAA,CAAe/uF,IAAAA,CAAKgvF,cAAAA,GACzBhvF,IAAAA,CAAKovF,OAAAA,EAAAA,GAEPpvF,IAAAA,CAAKkvF,YAAAA,CAAazhD,MAAAA,CAAOqJ;YAC3B;YAEO,aAAA23C;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAa9uF,IAAAA,CAAKovF,OAAAA,IAAW,KAAKpvF,IAAAA,CAAKkvF,YAAAA,CAAaT,UAAAA;YAClE;YAEO,OAAAxuB;gBACLjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAKovF,OAAAA,GAAUpvF,IAAAA,CAAKqvF,eACtB;YAAA;QAAA;QCjCK,MAAMC;YAMX,YAAYprC,CAAAA,EAAgB0qC,CAAAA,CAAAA;gBAL5B,IAAA,CAAAhvF,EAAAA,GAAK+uF,MAEG,IAAA,CAAAG,QAAAA,GAAAA,CAAoB,GAI1B9uF,IAAAA,CAAK+uF,cAAAA,GAAiBH,GACtB5uF,IAAAA,CAAKgvF,cAAAA,GAAiB,IAAIC,GAAc/qC,IACxClkD,IAAAA,CAAKkvF,YAAAA,GAAelvF,IAAAA,CAAKgvF,cAAAA,CAAeG,QAAAA,IAExCnvF,IAAAA,CAAK+uF,cAAAA,CAAe/uF,IAAAA,CAAKgvF,cAAAA;YAC3B;YAEO,OAAOl4C,CAAAA,EAAAA;gBACR92C,IAAAA,CAAK8uF,QAAAA,IAIL9uF,CAAAA,IAAAA,CAAKkvF,YAAAA,CAAaT,UAAAA,MACpBzuF,CAAAA,IAAAA,CAAKkvF,YAAAA,CAAad,YAAAA,IAClBpuF,IAAAA,CAAK+uF,cAAAA,CAAe/uF,IAAAA,CAAKgvF,cAAAA,CAAAA,GAG3BhvF,IAAAA,CAAKkvF,YAAAA,CAAazhD,MAAAA,CAAOqJ,EAAAA;YAC3B;YAEO,aAAA23C;gBACL,OAAOzuF,IAAAA,CAAK8uF,QACd;YAAA;YAEO,OAAA7uB;gBACLjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKkvF,YAAAA,CAAad,YAAAA;YACpB;YAEO,QAAAzyE,CAEP;QAAA;QCvCK,SAAS4zE,GAAKntF,CAAAA,EAAWkQ,CAAAA,EAAW2rC,CAAAA;YACzC,OAAA,AAAQ,CAAA,IAAIA,CAAAA,IAAQ77C,IAAIkQ,IAAI2rC;QAC9B;QASO,SAASuxC,GAAUC,CAAAA,EAAoBC,CAAAA,EAAkBt+E,CAAAA,EAA4B6sC,CAAAA;YAC1F,MAAM0xC,IAAAA,AAA0BF,CAAAA,IAAaC,IAAWvjF,CAAAA,IAASA,KAAS7G,KAAK8G,EAAAA,EACzEwjF,IAAYtqF,KAAKyH,GAAAA,CAAI2iF,IAAWD,IAChCI,IAAY1jF,IAAQyjF;YAC1B,IAAIE,IAAgB,GAChBC,IAAe;YACfH,IAAYC,IACdC,CAAAA,IAAgBD,GAChBE,IAAeH,CAAAA,IAEfE,CAAAA,IAAgBF,GAChBG,IAAeF,CAAAA;YAEjB,IAAIhhF,IAAW,GACXwM,IAAY;YAEhB,OAAQjK;gBACN,KAAK9N,EAAamO,YAAAA;oBAChB5C,IAAWihF,GACXz0E,IAAYs0E,IAAyB,IAAA;oBACrC;gBACF,KAAKrsF,EAAaoO,WAAAA;oBAChB7C,IAAWkhF,GACX10E,IAAYs0E,IAAAA,KAA8B;oBAC1C;gBACF,KAAKrsF,EAAaqO,SAAAA;oBAChB0J,IAAY,GACZxM,IAAW8gF,IAAyBG,IAAgBC;oBACpD;gBACF,KAAKzsF,EAAasO,gBAAAA;oBAChByJ,IAAAA,IACAxM,IAAW8gF,IAAyBI,IAAeD;YAAAA;YAIvD,OAAOL,IAAap0E,IAAaxM,CAAAA,IAAWovC,CAAAA;QAC9C;QAQO,SAAS+xC,GAAW5tF,CAAAA,EAAWkQ,CAAAA,EAAW2rC,CAAAA;YAC/C,OAAO77C,EAAE6N,KAAAA,CAAM,IAAIguC,GAAM7tC,GAAAA,CAAIkC,EAAErC,KAAAA,CAAMguC;QACvC;QAUO,SAASgyC,GAAY7tF,CAAAA,EAAWkQ,CAAAA,EAAWlP,CAAAA;YAChD,OAAA,AAAQA,CAAAA,IAAQhB,CAAAA,IAAMkQ,CAAAA,IAAIlQ,CAAAA;QAC5B;QAYO,SAAS8tF,GAAkB9tF,CAAAA,EAAWkQ,CAAAA,EAAWlP,CAAAA;YACtD,MAAMysE,IAAYzsE,EAAMmN,GAAAA,CAAInO,IACtBgmF,IAAc91E,EAAE/B,GAAAA,CAAInO,IACpBkK,IAAIujE,EAAUvjE,CAAAA,GAAI87E,EAAY97E,CAAAA,EAC9BlC,IAAIylE,EAAUzlE,CAAAA,GAAIg+E,EAAYh+E,CAAAA;YACpC,OAAO9E,KAAKkF,GAAAA,CAAI8B,GAAGlC;QACrB;QAUO,SAAS+lF,GAAMC,CAAAA,EAAmBC,CAAAA,EAAmBC,CAAAA,EAAwBC,CAAAA,EAAwBntF,CAAAA;YAE1G,OAAOmsF,GAAKe,GAAgBC,GADfN,GAAYG,GAAWC,GAAWjtF;QAEjD;QAYO,SAASotF,GAAYJ,CAAAA,EAAmBC,CAAAA,EAAmBC,CAAAA,EAAwBC,CAAAA,EAAwBntF,CAAAA;YAEhH,OAAO4sF,GAAWM,GAAgBC,GADrBL,GAAkBE,GAAWC,GAAWjtF;QAEvD;QC3GO,SAASqtF,GAAgBnkF,CAAAA;YAC9B,OAAOA,EAAE2oB,MAAAA,YAAkBnnB,KAAgC,YAAA,OAAfxB,EAAEopC,QAChD;QAAA;QAEO,MAAMg7C;YAYX,YACSxsC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAMA,IAPO,IAAA,CAAAirC,MAAAA,GAAAA,GAZT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAKG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAGpB,IAAA,CAAA8B,OAAAA,GAA0B1D,GAAgBI,MAAAA,EAKhDttF,IAAAA,CAAK0/C,OAAAA,GAAUzmC,EAAQgc,MAAAA,EACvBj1B,IAAAA,CAAK4wF,OAAAA,GAAwB,SAAd,CAAA,IAAA33E,EAAQm0E,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIptF,IAAAA,CAAK4wF,OAAAA,EACtC5wF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,iFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAI5I,KAAAA,IAC3BjS,IAAAA,CAAKkxF,IAAAA,GAAOlxF,IAAAA,CAAKixF,MAAAA,CAAO7gF,GAAAA,CAAIpQ,IAAAA,CAAK0/C,OAAAA,GACjC1/C,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IACnFG,IAAanxF,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,EACtBu2E,IAAUpxF,IAAAA,CAAK4wF,OAAAA,CAAQp6E,GAAGxW,IAAAA,CAAKixF,MAAAA,CAAO3kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAG,IACtD+kF,IAAUrxF,IAAAA,CAAK4wF,OAAAA,CAAQp6E,GAAGxW,IAAAA,CAAKixF,MAAAA,CAAO7mF,CAAAA,EAAGpK,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,EAAG,IACtDknF,IAAAA,AAAQF,CAAAA,IAAUD,EAAW7kF,CAAAA,AAAAA,IAAMwqC,CAAAA,IAAU,GAAA,GAC7Cy6C,IAAAA,AAAQF,CAAAA,IAAUF,EAAW/mF,CAAAA,AAAAA,IAAM0sC,CAAAA,IAAU,GAAA;gBACnD92C,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,CAAIl9C,CAAAA,GAAIglF,GACrBtxF,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,CAAIp/C,CAAAA,GAAImnF,GAEjBvxF,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKkkD,MAAAA,KACvBlkD,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA;YAE9B;YACO,WAAWw1C,CAAAA,EAAAA;gBAChB,OAAOlkD,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAM0C;YAiBX,YAAYttC,CAAAA,EAAgBhD,CAAAA,EAAiBC,CAAAA,EAAiBtM,CAAAA,CAAAA;gBAM5D,IAtBF,IAAA,CAAAj1C,EAAAA,GAAK+uF,MAaG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAGjB9uF,IAAAA,CAAKmuF,OAAAA,GAAUjqC,GACflkD,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAK20C,MAAAA,GAASE,GACd70C,IAAAA,CAAK0/C,OAAAA,GAAU,IAAI5xC,EAAOozC,GAASC,IAC/BtM,KAAS,GAEX,MADAj+B,EAAOS,WAAAA,GAAcpQ,KAAAA,CAAM,iEAAiE4tC,IACtF,IAAI1uC,MAAM;YAEpB;YAEO,OAAO2wC,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKixF,MAAAA,GAAS,IAAInjF,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GACtDpK,IAAAA,CAAKkxF,IAAAA,GAAOlxF,IAAAA,CAAKixF,MAAAA,CAAO7gF,GAAAA,CAAIpQ,IAAAA,CAAK0/C,OAAAA,GACjC1/C,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAK0/C,OAAAA,CAAQ9vC,SAAAA,EAC9B5P,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAKixF,MAAAA,EAAQjhF,SAAAA,EAAAA,GAGrChQ,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKmuF,OAAAA,IACvBnuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA,IAE1B1O,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAMxpD,IAAAA,CAAKi3E,IAAAA,CAAKhnE,KAAAA,CAAMjQ,IAAAA,CAAK20C,MAAAA;YAE5C;YAEO,WAAWuP,CAAAA,EAAAA;gBAChB,MAAMj+B,IAAKi+B,EAAOvhD,GAAAA,CAAIgwC;gBACtB,OAAO3yC,IAAAA,CAAK8uF,QAAAA,IAAY7oE,EAAGpL,GAAAA,CAAIhM,QAAAA,CAAS7O,IAAAA,CAAKixF,MAAAA,KAAWjxF,IAAAA,CAAKyxF,SAC/D;YAAA;YAEO,OAAAxxB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QChIK,SAAS4C,GAAgBplF,CAAAA;YAC9B,OAAOA,EAAEuO,GAAAA,YAAe/M,KAAgC,YAAA,OAAfxB,EAAEopC,QAC7C;QAAA;QAEO,MAAMi8C;YAWX,YACSztC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAMA,IAPO,IAAA,CAAAirC,MAAAA,GAAAA,GAXT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAIG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAGpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA8B,OAAAA,GAA0B1D,GAAgBI,MAAAA,EAKhDttF,IAAAA,CAAKkxF,IAAAA,GAAOj4E,EAAQ4B,GAAAA,EACpB7a,IAAAA,CAAK4wF,OAAAA,GAAwB,SAAd,CAAA,IAAA33E,EAAQm0E,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIptF,IAAAA,CAAK4wF,OAAAA,EACtC5wF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,iFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAI5I,KAAAA,IAC3BjS,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IACnFG,IAAanxF,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,EACtBu2E,IAAUpxF,IAAAA,CAAK4wF,OAAAA,CAAQp6E,GAAGxW,IAAAA,CAAKixF,MAAAA,CAAO3kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAG,IACtD+kF,IAAUrxF,IAAAA,CAAK4wF,OAAAA,CAAQp6E,GAAGxW,IAAAA,CAAKixF,MAAAA,CAAO7mF,CAAAA,EAAGpK,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,EAAG,IACtDknF,IAAAA,AAAQF,CAAAA,IAAUD,EAAW7kF,CAAAA,AAAAA,IAAMwqC,CAAAA,IAAU,GAAA,GAC7Cy6C,IAAAA,AAAQF,CAAAA,IAAUF,EAAW/mF,CAAAA,AAAAA,IAAM0sC,CAAAA,IAAU,GAAA;gBACnD92C,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,CAAIl9C,CAAAA,GAAIglF,GACrBtxF,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,CAAIp/C,CAAAA,GAAImnF,GAEjBvxF,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKkkD,MAAAA,KACvBlkD,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA;YAE9B;YACO,WAAWw1C,CAAAA,EAAAA;gBAChB,OAAOlkD,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAM8C;YAaX,YACS1tC,CAAAA,EACP2tC,CAAAA,EACAC,CAAAA,EACAj9C,CAAAA,CAAAA;gBAHO,IAAA,CAAAqP,MAAAA,GAAAA,GAbT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAUG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAOjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAKkxF,IAAAA,GAAO,IAAIpjF,EAAO+jF,GAAOC,IAC9B9xF,IAAAA,CAAK20C,MAAAA,GAASE;YAChB;YAEO,OAAOiC,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKixF,MAAAA,GAAS,IAAInjF,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GACtDpK,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKixF,MAAAA,CAAOpiF,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GAC3ClxF,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAKixF,MAAAA,EAAQjhF,SAAAA,EAAAA;gBAEzC,MAAMgW,IAAIhmB,IAAAA,CAAKi3E,IAAAA,CAAKhnE,KAAAA,CAAMjQ,IAAAA,CAAK20C,MAAAA;gBAC/B30C,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAIsX,EAAE1Z,CAAAA,EAAG0Z,EAAE5b,CAAAA,GAE1BpK,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKkkD,MAAAA,KACvBlkD,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA;YAE9B;YAEO,WAAWw1C,CAAAA,EAAAA;gBAChB,MAAMj+B,IAAKi+B,EAAOvhD,GAAAA,CAAIgwC;gBACtB,OAAO3yC,IAAAA,CAAK8uF,QAAAA,IAAY,IAAIhhF,EAAOmY,EAAGpL,GAAAA,CAAIvO,CAAAA,EAAG2Z,EAAGpL,GAAAA,CAAIzQ,CAAAA,EAAGyE,QAAAA,CAAS7O,IAAAA,CAAKixF,MAAAA,KAAWjxF,IAAAA,CAAKyxF,SACvF;YAAA;YAEO,OAAAxxB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QC/GK,SAASiD,GAAkBzlF,CAAAA;YAChC,OAA0B,YAAA,OAAZA,EAAEW,KAAAA,IAA4C,YAAA,OAAfX,EAAEopC,QACjD;QAAA;QAEO,MAAMs8C;YAWX,YACS9tC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAKA,IANO,IAAA,CAAAirC,MAAAA,GAAAA,GAXT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAGG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAAmD,SAAAA,GAAoB,GACpB,IAAA,CAAAC,WAAAA,GAAsB,GAM5BlyF,IAAAA,CAAKiyF,SAAAA,GAAYh5E,EAAQhM,KAAAA,EACzBjN,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,mFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKmyF,aAAAA,GAAoC,SAApB,CAAA,IAAAl5E,EAAQ7H,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI9N,EAAamO,YAAAA,EAC1DzR,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKkyF,WAAAA,GAAclyF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,EAC5B3iB,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IAInFoB,IAAAA,AAHW5C,CAAAA,GAAUxvF,IAAAA,CAAKkyF,WAAAA,EAAalyF,IAAAA,CAAKiyF,SAAAA,EAAWjyF,IAAAA,CAAKmyF,aAAAA,EAAe37E,KAC5DxW,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,AAAAA,IAEUm0B,CAAAA,IAAU,GAAA;gBAClD92C,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkByoC,GAE3BpyF,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKkkD,MAAAA,KACvBlkD,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,GAAW3iB,IAAAA,CAAKiyF,SAAAA,EACzBjyF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,CAAA;YAEnC;YACO,WAAWzF,CAAAA,EAAAA;gBAChB,OAAOlkD,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAMuD;YAkBX,YAAYnuC,CAAAA,EAAgBj3C,CAAAA,EAAe4nC,CAAAA,EAAezjC,CAAAA,CAAAA;gBAjB1D,IAAA,CAAAxR,EAAAA,GAAK+uF,MAeG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAEjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAKkxF,IAAAA,GAAOjkF,GACZjN,IAAAA,CAAK20C,MAAAA,GAASE,GACd70C,IAAAA,CAAKmyF,aAAAA,GAAgB/gF,KAAgB9N,EAAamO,YACpD;YAAA;YAEO,OAAOqlC,CAAAA,EAAAA;gBACZ,IAAA,CAAK92C,IAAAA,CAAK2wF,QAAAA,EAAU;oBAClB3wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,EACvB3iB,IAAAA,CAAKsyF,sBAAAA,GAAyBtyF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA;oBACvC,MAAMitE,IAAYtqF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKkxF,IAAAA,GAAOlxF,IAAAA,CAAKixF,MAAAA,GACtCpB,IAAY1jF,IAAQyjF;oBAW1B,OAVIA,IAAYC,IACd7vF,CAAAA,IAAAA,CAAKuyF,cAAAA,GAAiB1C,GACtB7vF,IAAAA,CAAKwyF,aAAAA,GAAgB5C,CAAAA,IAErB5vF,CAAAA,IAAAA,CAAKuyF,cAAAA,GAAiB3C,GACtB5vF,IAAAA,CAAKwyF,aAAAA,GAAgB3C,CAAAA,GAGvB7vF,IAAAA,CAAKyyF,uBAAAA,GAAAA,AAA2BzyF,CAAAA,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAKkxF,IAAAA,GAAO/kF,CAAAA,IAASA,KAAS7G,KAAK8G,EAAAA,EAEzEpM,IAAAA,CAAKmyF,aAAAA;wBACX,KAAK7uF,EAAamO,YAAAA;4BAChBzR,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA,EAClBvyF,IAAAA,CAAKyyF,uBAAAA,GACPzyF,IAAAA,CAAK0yF,UAAAA,GAAa,IAElB1yF,IAAAA,CAAK0yF,UAAAA,GAAAA;4BAEP;wBACF,KAAKpvF,EAAaoO,WAAAA;4BAChB1R,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA,EAClBxyF,IAAAA,CAAKyyF,uBAAAA,GACPzyF,IAAAA,CAAK0yF,UAAAA,GAAAA,KAEL1yF,IAAAA,CAAK0yF,UAAAA,GAAa;4BAEpB;wBACF,KAAKpvF,EAAaqO,SAAAA;4BAChB3R,IAAAA,CAAK0yF,UAAAA,GAAa,GACd1yF,IAAAA,CAAKyyF,uBAAAA,GACPzyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA,GAEtBvyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA;4BAExB;wBACF,KAAKlvF,EAAasO,gBAAAA;4BAChB5R,IAAAA,CAAK0yF,UAAAA,GAAAA,IACA1yF,IAAAA,CAAKyyF,uBAAAA,GAGRzyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA,GAFtBxyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA;oBAAAA;gBAM9B;gBAEAvyF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB3pD,IAAAA,CAAK0yF,UAAAA,GAAa1yF,IAAAA,CAAK20C,MAAAA,EACtD30C,IAAAA,CAAKsyF,sBAAAA,IAA0BtyF,IAAAA,CAAK0yF,UAAAA,GAAa1yF,IAAAA,CAAK20C,MAAAA,GAAUmC,CAAAA,IAAU,GAAA,GAEtE92C,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,GAAW3iB,IAAAA,CAAKkxF,IAAAA,EACzBlxF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,CAAA;YAEpB;YAEO,aAAAL;gBACL,MAAMkE,IAAmBrtF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKsyF,sBAAAA,GAAyBtyF,IAAAA,CAAKixF,MAAAA;gBACrE,OAAOjxF,IAAAA,CAAK8uF,QAAAA,IAAY6D,KAAoBrtF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKyxF,SAAAA;YAC5D;YAEO,OAAAxxB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QCvKK,SAAS8D,GAAkBtmF,CAAAA;YAChC,OAAuC,YAAA,OAAzBA,EAAEumF,kBAAAA,IAAyD,YAAA,OAAfvmF,EAAEopC,QAC9D;QAAA;QAEO,MAAMo9C;YAYX,YACS5uC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAKA,IANO,IAAA,CAAAirC,MAAAA,GAAAA,GAZT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAGG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAApvC,OAAAA,GAAkB,GAClB,IAAA,CAAAwyC,WAAAA,GAAsB,GAEtB,IAAA,CAAAD,SAAAA,GAAoB,GAK1BjyF,IAAAA,CAAK0/C,OAAAA,GAAUzmC,EAAQ45E,kBAAAA,EACvB7yF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,mFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKmyF,aAAAA,GAAoC,SAApB,CAAA,IAAAl5E,EAAQ7H,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI9N,EAAamO,YAAAA,EAC1DzR,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKkyF,WAAAA,GAAclyF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,EAC5B3iB,IAAAA,CAAKiyF,SAAAA,GAAYjlF,EAAkBhN,IAAAA,CAAKkyF,WAAAA,GAAclyF,IAAAA,CAAK0/C,OAAAA,GAC3D1/C,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IAInFoB,IAAAA,AAHW5C,CAAAA,GAAUxvF,IAAAA,CAAKkyF,WAAAA,EAAalyF,IAAAA,CAAKiyF,SAAAA,EAAWjyF,IAAAA,CAAKmyF,aAAAA,EAAe37E,KAC5DxW,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,AAAAA,IAEUm0B,CAAAA,IAAU,GAAA;gBAClD92C,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkByoC,GAE3BpyF,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,GAAW3iB,IAAAA,CAAKiyF,SAAAA,EACzBjyF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,CAAA;YAEnC;YACO,aAAA8kC;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAMiE;YAoBX,YAAY7uC,CAAAA,EAAgB2uC,CAAAA,EAA4Bh+C,CAAAA,EAAezjC,CAAAA,CAAAA;gBAnBvE,IAAA,CAAAxR,EAAAA,GAAK+uF,MAiBG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAEjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAK20C,MAAAA,GAASE,GACd70C,IAAAA,CAAK0/C,OAAAA,GAAUmzC,GACf7yF,IAAAA,CAAKmyF,aAAAA,GAAgB/gF,KAAgB9N,EAAamO,YACpD;YAAA;YAEO,OAAOqlC,CAAAA,EAAAA;gBACZ,IAAA,CAAK92C,IAAAA,CAAK2wF,QAAAA,EAAU;oBAClB3wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,EACvB3iB,IAAAA,CAAKsyF,sBAAAA,GAAyBtyF,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,EACvC3iB,IAAAA,CAAKkxF,IAAAA,GAAOlxF,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAK0/C,OAAAA;oBAE/B,MAAMkwC,IAAYtqF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKkxF,IAAAA,GAAOlxF,IAAAA,CAAKixF,MAAAA,GACtCpB,IAAY1jF,IAAQyjF;oBAW1B,OAVIA,IAAYC,IACd7vF,CAAAA,IAAAA,CAAKuyF,cAAAA,GAAiB1C,GACtB7vF,IAAAA,CAAKwyF,aAAAA,GAAgB5C,CAAAA,IAErB5vF,CAAAA,IAAAA,CAAKuyF,cAAAA,GAAiB3C,GACtB5vF,IAAAA,CAAKwyF,aAAAA,GAAgB3C,CAAAA,GAGvB7vF,IAAAA,CAAKyyF,uBAAAA,GAAAA,AAA2BzyF,CAAAA,IAAAA,CAAKixF,MAAAA,GAASjxF,IAAAA,CAAKkxF,IAAAA,GAAO/kF,CAAAA,IAASA,KAAS7G,KAAK8G,EAAAA,EAEzEpM,IAAAA,CAAKmyF,aAAAA;wBACX,KAAK7uF,EAAamO,YAAAA;4BAChBzR,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA,EAClBvyF,IAAAA,CAAKyyF,uBAAAA,GACPzyF,IAAAA,CAAK0yF,UAAAA,GAAa,IAElB1yF,IAAAA,CAAK0yF,UAAAA,GAAAA;4BAEP;wBACF,KAAKpvF,EAAaoO,WAAAA;4BAChB1R,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA,EAClBxyF,IAAAA,CAAKyyF,uBAAAA,GACPzyF,IAAAA,CAAK0yF,UAAAA,GAAAA,KAEL1yF,IAAAA,CAAK0yF,UAAAA,GAAa;4BAEpB;wBACF,KAAKpvF,EAAaqO,SAAAA;4BAChB3R,IAAAA,CAAK0yF,UAAAA,GAAa,GACd1yF,IAAAA,CAAKuyF,cAAAA,IAAkB,IACzBvyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA,GAEtBvyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA;4BAExB;wBACF,KAAKlvF,EAAasO,gBAAAA;4BAChB5R,IAAAA,CAAK0yF,UAAAA,GAAAA,IACD1yF,IAAAA,CAAKuyF,cAAAA,IAAkB,IACzBvyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKuyF,cAAAA,GAEtBvyF,IAAAA,CAAKyxF,SAAAA,GAAYzxF,IAAAA,CAAKwyF,aAAAA;oBAAAA;gBAI9B;gBAEAxyF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB3pD,IAAAA,CAAK0yF,UAAAA,GAAa1yF,IAAAA,CAAK20C,MAAAA,EACtD30C,IAAAA,CAAKsyF,sBAAAA,IAA0BtyF,IAAAA,CAAK0yF,UAAAA,GAAa1yF,IAAAA,CAAK20C,MAAAA,GAAUmC,CAAAA,IAAU,GAAA,GAEtE92C,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIluE,QAAAA,GAAW3iB,IAAAA,CAAKkxF,IAAAA,EACzBlxF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,CAAA;YAEpB;YAEO,aAAAL;gBACL,MAAMkE,IAAmBrtF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKsyF,sBAAAA,GAAyBtyF,IAAAA,CAAKixF,MAAAA;gBACrE,OAAOjxF,IAAAA,CAAK8uF,QAAAA,IAAY6D,KAAoBrtF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKyxF,SAAAA;YAC5D;YAEO,OAAAxxB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,GAC/B3pD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKixF,MAAAA,GAAAA,KAASnwF,GACdd,IAAAA,CAAKsyF,sBAAAA,GAAAA,KAAyBxxF,GAC9Bd,IAAAA,CAAKyxF,SAAAA,GAAAA,KAAY3wF;YACnB;QAAA;QCnLK,SAASkyF,GAAiB1mF,CAAAA;YAC/B,OAA0B,YAAA,OAAZA,EAAE2D,KAAAA,IAA4C,YAAA,OAAf3D,EAAEopC,QACjD;QAAA;QAEO,MAAMu9C;YAUX,YACS/uC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAKA,IANO,IAAA,CAAAirC,MAAAA,GAAAA,GAVT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAGG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAAoE,SAAAA,GAAoBxkF,EAAI,GAAG,IAC3B,IAAA,CAAAykF,WAAAA,GAAsBzkF,EAAI,GAAG,IAKnC1O,IAAAA,CAAKkzF,SAAAA,GAAYj6E,EAAQhJ,KAAAA,EACzBjQ,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,kFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKmzF,WAAAA,GAAcnzF,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,EAC5BjQ,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IACnFoC,IAAWpD,GAAWhwF,IAAAA,CAAKmzF,WAAAA,EAAanzF,IAAAA,CAAKkzF,SAAAA,EAAW18E,IACxD4O,IAAeplB,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,EAExBwS,IAAK2wE,EAAS7iF,GAAAA,CAAI6U,GAAcnV,KAAAA,CAAM,IAAK6mC,CAAAA,IAAU,GAAA;gBAC3D92C,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,GAAcjnC,GAEvBziB,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,GAAQjQ,IAAAA,CAAKkzF,SAAAA,EACtBlzF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,CAAA;YAEnC;YACO,aAAA8kC;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,GAAc57C,EAAOC,IAAAA,EAClC/N,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAMuE;YAgBX,YAAYnvC,CAAAA,EAAgB2W,CAAAA,EAAgBC,CAAAA,EAAgBw4B,CAAAA,EAAgBC,CAAAA,CAAAA;gBAf5E,IAAA,CAAA3zF,EAAAA,GAAK+uF,MAaG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAEjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAKwzF,KAAAA,GAAQ34B,GACb76D,IAAAA,CAAKyzF,KAAAA,GAAQ34B,GACb96D,IAAAA,CAAK0zF,OAAAA,GAAUJ,GACftzF,IAAAA,CAAK2zF,OAAAA,GAAUJ;YACjB;YAEO,OAAOz8C,CAAAA,EAAAA;gBASZ,IARK92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK4zF,OAAAA,GAAU5zF,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM3D,CAAAA,EAC9BtM,IAAAA,CAAK6zF,OAAAA,GAAU7zF,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM7F,CAAAA,EAC9BpK,IAAAA,CAAK8zF,UAAAA,GAAaxuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKwzF,KAAAA,GAAQxzF,IAAAA,CAAK4zF,OAAAA,GAC7C5zF,IAAAA,CAAK+zF,UAAAA,GAAazuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKyzF,KAAAA,GAAQzzF,IAAAA,CAAK6zF,OAAAA,CAAAA,GAGzCvuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM3D,CAAAA,GAAItM,IAAAA,CAAK4zF,OAAAA,KAAY5zF,IAAAA,CAAK8zF,UAAAA,EAItD9zF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAI;qBAJsC;oBACnE,MAAM0nF,IAAah0F,IAAAA,CAAKyzF,KAAAA,GAAQzzF,IAAAA,CAAK6zF,OAAAA,GAAAA,KAAe;oBACpD7zF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAItM,IAAAA,CAAK0zF,OAAAA,GAAUM;gBAC9C;gBAIA,IAAM1uF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM7F,CAAAA,GAAIpK,IAAAA,CAAK6zF,OAAAA,KAAY7zF,IAAAA,CAAK+zF,UAAAA,EAItD/zF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAI;qBAJsC;oBACnE,MAAM6pF,IAAaj0F,IAAAA,CAAKyzF,KAAAA,GAAQzzF,IAAAA,CAAK6zF,OAAAA,GAAAA,KAAe;oBACpD7zF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAIpK,IAAAA,CAAK2zF,OAAAA,GAAUM;gBAC9C;gBAIIj0F,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,GAAQvB,EAAI1O,IAAAA,CAAKwzF,KAAAA,EAAOxzF,IAAAA,CAAKyzF,KAAAA,GACtCzzF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAI,GAC7BtM,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAI,CAAA;YAEjC;YAEO,aAAAqkF;gBACL,OACEzuF,IAAAA,CAAK8uF,QAAAA,IACJxpF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM3D,CAAAA,GAAItM,IAAAA,CAAK4zF,OAAAA,KAAY5zF,IAAAA,CAAK8zF,UAAAA,GAAa,OAC9DxuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM7F,CAAAA,GAAIpK,IAAAA,CAAK6zF,OAAAA,KAAY7zF,IAAAA,CAAK+zF,UAAAA,GAAa;YAErE;YAEO,OAAA9zB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAI,GAC7BtM,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAI,GAC7BpK,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QCtIK,SAASoF,GAAiB5nF,CAAAA;YAC/B,OAAgC,YAAA,OAAlBA,EAAE6nF,WAAAA,IAAkD,YAAA,OAAf7nF,EAAEopC,QACvD;QAAA;QAEO,MAAM0+C;YAWX,YACSlwC,CAAAA,EACPjrC,CAAAA,CAAAA;gBAKA,IANO,IAAA,CAAAirC,MAAAA,GAAAA,GAXT,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAGG,IAAA,CAAAgC,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAoB,GAEpB,IAAA,CAAAoE,SAAAA,GAAoBxkF,EAAI,GAAG,IAC3B,IAAA,CAAA2lF,YAAAA,GAAuB3lF,EAAI,GAAG,IAC9B,IAAA,CAAAykF,WAAAA,GAAsBzkF,EAAI,GAAG,IAKnC1O,IAAAA,CAAKq0F,YAAAA,GAAep7E,EAAQk7E,WAAAA,EAC5Bn0F,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAAAA,CACrBvpD,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,kFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YACA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKmzF,WAAAA,GAAcnzF,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,EAC5BjQ,IAAAA,CAAKkzF,SAAAA,GAAYlzF,IAAAA,CAAKmzF,WAAAA,CAAY/iF,GAAAA,CAAIpQ,IAAAA,CAAKq0F,YAAAA,GAC3Cr0F,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG,IACnFoC,IAAWpD,GAAWhwF,IAAAA,CAAKmzF,WAAAA,EAAanzF,IAAAA,CAAKkzF,SAAAA,EAAW18E,IACxD4O,IAAeplB,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,EACxBwS,IAAK2wE,EAAS7iF,GAAAA,CAAI6U,GAAcnV,KAAAA,CAAM,IAAK6mC,CAAAA,IAAU,GAAA;gBAC3D92C,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,GAAcjnC,GAEvBziB,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,GAAQjQ,IAAAA,CAAKkzF,SAAAA,EACtBlzF,IAAAA,CAAK8wF,OAAAA,CAAQnnC,eAAAA,GAAkB,CAAA;YAEnC;YACO,aAAA8kC;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YAEO,OAAA/wB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,GAAc57C,EAAOC,IAAAA,EAClC/N,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;YAEO,QAAAr1E;gBACL3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAGK,MAAMwF;YAiBX,YAAYpwC,CAAAA,EAAgBqwC,CAAAA,EAAsBC,CAAAA,EAAsB3/C,CAAAA,CAAAA;gBAhBxE,IAAA,CAAAj1C,EAAAA,GAAK+uF,MAYG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAIjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAK0/C,OAAAA,GAAU,IAAI5xC,EAAOymF,GAAcC,IACxCx0F,IAAAA,CAAK0zF,OAAAA,GAAU1zF,IAAAA,CAAK2zF,OAAAA,GAAU9+C;YAChC;YAEO,OAAOiC,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKmzF,WAAAA,GAAcnzF,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAMgC,KAAAA,IAClCjS,IAAAA,CAAKkzF,SAAAA,GAAYlzF,IAAAA,CAAKmzF,WAAAA,CAAY/iF,GAAAA,CAAIpQ,IAAAA,CAAK0/C,OAAAA,GAC3C1/C,IAAAA,CAAK8zF,UAAAA,GAAaxuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKkzF,SAAAA,CAAU5mF,CAAAA,GAAItM,IAAAA,CAAKmzF,WAAAA,CAAY7mF,CAAAA,GAC/DtM,IAAAA,CAAK+zF,UAAAA,GAAazuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKkzF,SAAAA,CAAU9oF,CAAAA,GAAIpK,IAAAA,CAAKmzF,WAAAA,CAAY/oF,CAAAA,GAC/DpK,IAAAA,CAAKy0F,WAAAA,GAAcz0F,IAAAA,CAAKkzF,SAAAA,CAAU5mF,CAAAA,GAAItM,IAAAA,CAAKmzF,WAAAA,CAAY7mF,CAAAA,GAAAA,KAAS,GAChEtM,IAAAA,CAAK00F,WAAAA,GAAc10F,IAAAA,CAAKkzF,SAAAA,CAAU9oF,CAAAA,GAAIpK,IAAAA,CAAKmzF,WAAAA,CAAY/oF,CAAAA,GAAAA,KAAS,CAAA,GAGlEpK,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAItM,IAAAA,CAAK0zF,OAAAA,GAAU1zF,IAAAA,CAAKy0F,WAAAA,EACjDz0F,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAIpK,IAAAA,CAAK2zF,OAAAA,GAAU3zF,IAAAA,CAAK00F,WAAAA,EAE7C10F,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,GAAQjQ,IAAAA,CAAKkzF,SAAAA,EACtBlzF,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAI,GAC7BtM,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAI,CAAA;YAEjC;YAEO,aAAAqkF;gBACL,OACEzuF,IAAAA,CAAK8uF,QAAAA,IACJxpF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM3D,CAAAA,GAAItM,IAAAA,CAAKmzF,WAAAA,CAAY7mF,CAAAA,KAAMtM,IAAAA,CAAK8zF,UAAAA,GAAa,OACpExuF,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAK6wF,GAAAA,CAAI5gF,KAAAA,CAAM7F,CAAAA,GAAIpK,IAAAA,CAAKmzF,WAAAA,CAAY/oF,CAAAA,KAAMpK,IAAAA,CAAK+zF,UAAAA,GAAa;YAE3E;YAEO,OAAA9zB;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYp9C,CAAAA,GAAI,GAC7BtM,IAAAA,CAAK8wF,OAAAA,CAAQpnC,WAAAA,CAAYt/C,CAAAA,GAAI,GAC7BpK,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QChJK,MAAM6F;YAIX,YAAYC,CAAAA,CAAAA;gBAHZ,IAAA,CAAAh1F,EAAAA,GAAK+uF,MAEG,IAAA,CAAAkG,cAAAA,GAAAA,CAA0B,GAEhC70F,IAAAA,CAAK80F,OAAAA,GAAUF;YACjB;YAEO,OAAO99C,CAAAA,EAAAA;gBACZ92C,IAAAA,CAAK80F,OAAAA,IACL90F,IAAAA,CAAK60F,cAAAA,GAAAA,CAAiB;YACxB;YACO,aAAApG;gBACL,OAAOzuF,IAAAA,CAAK60F,cACd;YAAA;YACO,QAAAl5E;gBACL3b,IAAAA,CAAK60F,cAAAA,GAAAA,CAAiB;YACxB;YACO,OAAA50B;gBACLjgE,IAAAA,CAAK60F,cAAAA,GAAAA,CAAiB;YACxB;QAAA;QCbK,MAAME;YAUX,YACE7wC,CAAAA,EACA53C,CAAAA,EACAlC,CAAAA,EACAsrC,CAAAA,EACOs/C,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,SAAAA,GAAAA,GAdT,IAAA,CAAAp1F,EAAAA,GAAK+uF,MAGG,IAAA,CAAAsG,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,aAAAA,GAAwB,KACxB,IAAA,CAAAC,UAAAA,GAAqB,IAAIrnF,EAAO,GAAG,IACnC,IAAA,CAAAsnF,QAAAA,GAAmB,IAAItnF,EAAO,GAAG,IACjC,IAAA,CAAA20B,YAAAA,GAAAA,CAAwB,GACxB,IAAA,CAAAqsD,QAAAA,GAAAA,CAAoB,GAQ1B9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAKk1F,aAAAA,GAAgBx/C,GACrB11C,IAAAA,CAAKo1F,QAAAA,GAAW,IAAItnF,EAAOxB,GAAGlC;YAChC;YACQ,cAAA+iC;gBACNntC,IAAAA,CAAKm1F,UAAAA,GAAa,IAAIrnF,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GAC1DpK,IAAAA,CAAKi1F,gBAAAA,GAAmB;YAC1B;YAEO,OAAOn+C,CAAAA,EAAAA;gBACP92C,IAAAA,CAAKyiC,YAAAA,IACRziC,CAAAA,IAAAA,CAAKmtC,WAAAA,IACLntC,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe,CAAA,GAItBziC,IAAAA,CAAKi1F,gBAAAA,IAAoBn+C;gBACzB,IAAIlH,IAAO5vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EACpBujC,IAAO7vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA;gBACpBpK,IAAAA,CAAKi1F,gBAAAA,GAAmBj1F,IAAAA,CAAKk1F,aAAAA,GAE7BtlD,CAAAA,IADE5vC,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,GAAItM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,GAElCtM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,GACftM,CAAAA,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,EAAGtM,IAAAA,CAAKk1F,aAAAA,IAAiBl1F,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,AAAAA,IAE1GtM,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,EAAGtM,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKk1F,aAAAA,GAItFrlD,IADE7vC,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,GAAIpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,GAElCpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,GACfpK,CAAAA,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,EAAGpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,EAAGpK,IAAAA,CAAKk1F,aAAAA,IAAiBl1F,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,AAAAA,IAE1GpK,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,EAAGpK,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,EAAGpK,IAAAA,CAAKk1F,aAAAA,GAGxFl1F,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAAA,AAAKkhC,CAAAA,IAAO5vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,AAAAA,IAAMwqC,CAAAA,IAAU,GAAA,GAAA,AAAQjH,CAAAA,IAAO7vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAM0sC,CAAAA,IAAU,GAAA,EAAA,IAExG92C,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,GAClDpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM17C,EAAOC,IAAAA,AAAAA;YAE9B;YACO,aAAA0gF;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKi1F,gBAAAA,IAAoBj1F,IAAAA,CAAKk1F,aACxD;YAAA;YAEO,QAAAv5E;gBACL3b,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe,GACpBziC,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKi1F,gBAAAA,GAAmB;YAC1B;YACO,OAAAh1B;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QCxEK,MAAMuG;YAWX,YACEnxC,CAAAA,EACAhD,CAAAA,EACAC,CAAAA,EACAzL,CAAAA,EACOs/C,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,SAAAA,GAAAA,GAfT,IAAA,CAAAp1F,EAAAA,GAAK+uF,MAGG,IAAA,CAAAsG,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,aAAAA,GAAwB,KACxB,IAAA,CAAAC,UAAAA,GAAqB,IAAIrnF,EAAO,GAAG,IACnC,IAAA,CAAAsnF,QAAAA,GAAmB,IAAItnF,EAAO,GAAG,IAEjC,IAAA,CAAA20B,YAAAA,GAAAA,CAAwB,GACxB,IAAA,CAAAqsD,QAAAA,GAAAA,CAAoB,GAQ1B9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAKk1F,aAAAA,GAAgBx/C,GACrB11C,IAAAA,CAAK0/C,OAAAA,GAAU,IAAI5xC,EAAOozC,GAASC;YACrC;YACQ,cAAAhU;gBACNntC,IAAAA,CAAKm1F,UAAAA,GAAa,IAAIrnF,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GAC1DpK,IAAAA,CAAKi1F,gBAAAA,GAAmB,GACxBj1F,IAAAA,CAAKo1F,QAAAA,GAAWp1F,IAAAA,CAAKm1F,UAAAA,CAAW/kF,GAAAA,CAAIpQ,IAAAA,CAAK0/C,OAAAA;YAC3C;YAEO,OAAO5I,CAAAA,EAAAA;gBACP92C,IAAAA,CAAKyiC,YAAAA,IACRziC,CAAAA,IAAAA,CAAKmtC,WAAAA,IACLntC,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe,CAAA,GAItBziC,IAAAA,CAAKi1F,gBAAAA,IAAoBn+C;gBACzB,IAAIlH,IAAO5vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EACpBujC,IAAO7vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA;gBACpBpK,IAAAA,CAAKi1F,gBAAAA,GAAmBj1F,IAAAA,CAAKk1F,aAAAA,GAE7BtlD,CAAAA,IADE5vC,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,GAAItM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,GAElCtM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,GACftM,CAAAA,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,EAAGtM,IAAAA,CAAKk1F,aAAAA,IAAiBl1F,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,AAAAA,IAE1GtM,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKm1F,UAAAA,CAAW7oF,CAAAA,EAAGtM,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKk1F,aAAAA,GAItFrlD,IADE7vC,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,GAAIpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,GAElCpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,GACfpK,CAAAA,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,EAAGpK,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,EAAGpK,IAAAA,CAAKk1F,aAAAA,IAAiBl1F,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,AAAAA,IAE1GpK,IAAAA,CAAKg1F,SAAAA,CAAUh1F,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKm1F,UAAAA,CAAW/qF,CAAAA,EAAGpK,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,EAAGpK,IAAAA,CAAKk1F,aAAAA,GAGxFl1F,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAAA,AAAKkhC,CAAAA,IAAO5vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,AAAAA,IAAMwqC,CAAAA,IAAU,GAAA,GAAA,AAAQjH,CAAAA,IAAO7vC,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,AAAAA,IAAM0sC,CAAAA,IAAU,GAAA,EAAA,IAExG92C,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKo1F,QAAAA,CAAS9oF,CAAAA,EAAGtM,IAAAA,CAAKo1F,QAAAA,CAAShrF,CAAAA,GAClDpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM17C,EAAOC,IAAAA,AAAAA;YAE9B;YACO,aAAA0gF;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKi1F,gBAAAA,IAAoBj1F,IAAAA,CAAKk1F,aACxD;YAAA;YAEO,QAAAv5E;gBACL3b,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe,GACpBziC,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKi1F,gBAAAA,GAAmB;YAC1B;YACO,OAAAh1B;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QC/EK,MAAMwG;YAUX,YAAYpxC,CAAAA,EAAgBqxC,CAAAA,EAAqBC,CAAAA,EAAwBC,IAAoB,CAAA,CAAA;gBAT7F,IAAA,CAAA71F,EAAAA,GAAK+uF,MAEG,IAAA,CAAA+G,YAAAA,GAAuB,GACvB,IAAA,CAAAC,eAAAA,GAA0B,GAC1B,IAAA,CAAAC,YAAAA,GAAuB,GACvB,IAAA,CAAAC,UAAAA,GAAqB,GAErB,IAAA,CAAA/G,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAA6B,QAAAA,GAAAA,CAAoB,GAE1B3wF,IAAAA,CAAKggD,SAAAA,GAAYkE,EAAOvhD,GAAAA,CAAI48C,KAC5Bv/C,IAAAA,CAAK01F,YAAAA,GAAeH,GACpBv1F,IAAAA,CAAK21F,eAAAA,GAAkBH,GACvBx1F,IAAAA,CAAK0/D,SAAAA,GAAAA,AAAa61B,CAAAA,IAAcC,CAAAA,IAAkBC;YACpD;YAEO,OAAO3+C,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK61F,UAAAA,GAAa,CAAA,GAEf71F,IAAAA,CAAKggD,SAAAA,IAIVhgD,CAAAA,IAAAA,CAAK41F,YAAAA,IAAgB9+C,GACrB92C,IAAAA,CAAK61F,UAAAA,IAAc/+C,GACf92C,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,IAAaz/C,IAAAA,CAAK41F,YAAAA,IAAgB51F,IAAAA,CAAK01F,YAAAA,IACxD11F,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,GAAAA,CAAY,GAC3Bz/C,IAAAA,CAAK41F,YAAAA,GAAe,CAAA,GAAA,CAGjB51F,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,IAAaz/C,IAAAA,CAAK41F,YAAAA,IAAgB51F,IAAAA,CAAK21F,eAAAA,IACzD31F,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,GAAAA,CAAY,GAC3Bz/C,IAAAA,CAAK41F,YAAAA,GAAe,CAAA,GAGlB51F,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,GAAAA,CAAY,CAAA,CAAA;YAE/B;YAEO,aAAAgvC;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAK61F,UAAAA,IAAc71F,IAAAA,CAAK0/D,SAClD;YAAA;YAEO,OAAAO;gBACDjgE,IAAAA,CAAKggD,SAAAA,IACPhgD,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,GAAAA,CAAY,CAAA,GAE7Bz/C,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK61F,UAAAA,GAAa;YACpB;QAAA;QC3DK,MAAMC;YAWX,YAAY5xC,CAAAA,EAAgB6xC,CAAAA,EAAoBrgD,CAAAA,CAAAA;gBAVhD,IAAA,CAAA91C,EAAAA,GAAK+uF,MAMG,IAAA,CAAAqH,WAAAA,GAAsB,GACtB,IAAA,CAAArF,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAGjB9uF,IAAAA,CAAKggD,SAAAA,GAAYkE,EAAOvhD,GAAAA,CAAI48C,KAC5Bv/C,IAAAA,CAAKi2F,WAAAA,GAAcF,GACnB/1F,IAAAA,CAAKk2F,cAAAA,GAAiBl2F,IAAAA,CAAKm2F,aAAAA,GAAgBzgD;YAC7C;YAEO,OAAOoB,CAAAA,EAAAA;gBACP92C,IAAAA,CAAKggD,SAAAA,IAILhgD,CAAAA,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKk2F,cAAAA,GAAiBl2F,IAAAA,CAAKm2F,aAAAA,EAGvBn2F,IAAAA,CAAKi2F,WAAAA,GAAcj2F,IAAAA,CAAKggD,SAAAA,CAAUp3B,OAAAA,GACpC5oB,IAAAA,CAAKg2F,WAAAA,GAAAA,KAELh2F,IAAAA,CAAKg2F,WAAAA,GAAc,CAAA,GAInBh2F,IAAAA,CAAKk2F,cAAAA,GAAiB,KACxBl2F,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUp3B,OAAAA,IAAY5oB,IAAAA,CAAKg2F,WAAAA,GAAe1wF,CAAAA,KAAKyH,GAAAA,CAAI/M,IAAAA,CAAKggD,SAAAA,CAAUp3B,OAAAA,GAAU5oB,IAAAA,CAAKi2F,WAAAA,IAAen/C,CAAAA,IAAY92C,IAAAA,CAAKk2F,cAAAA,AAAAA,GAGxHl2F,IAAAA,CAAKk2F,cAAAA,IAAkBp/C,GAEnB92C,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUp3B,OAAAA,GAAU5oB,IAAAA,CAAKi2F,WAAAA,AAAAA,GAGhCr/E,EAAOS,WAAAA,GAAcW,KAAAA,CAAM,gCAAgChY,IAAAA,CAAKggD,SAAAA,CAAUp3B,OAAAA,CAAAA;YAC5E;YAEO,aAAA6lE;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKk2F,cAAAA,IAAkB;YACjD;YAEO,OAAAj2B;gBACLjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKk2F,cAAAA,GAAiBl2F,IAAAA,CAAKm2F,aAC7B;YAAA;QAAA;QC9DK,MAAMC;YAMX,YAAY1gD,CAAAA,CAAAA;gBALZ,IAAA,CAAA91C,EAAAA,GAAK+uF,MACG,IAAA,CAAAiH,YAAAA,GAAuB,GAEvB,IAAA,CAAAjF,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAEjB9uF,IAAAA,CAAKq2F,MAAAA,GAAS3gD;YAChB;YAEO,OAAOoB,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAGlB3wF,IAAAA,CAAK41F,YAAAA,IAAgB9+C;YACvB;YAEA,aAAA23C;gBACE,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAK41F,YAAAA,IAAgB51F,IAAAA,CAAKq2F,MACpD;YAAA;YAEO,OAAAp2B;gBACLjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEA,QAAAnzE;gBACE3b,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QC5BK,MAAMwH;YAKX,YAAYpyC,CAAAA,CAAAA;gBAJZ,IAAA,CAAAtkD,EAAAA,GAAK+uF,MAEG,IAAA,CAAAG,QAAAA,GAAAA,CAAW,GAGjB9uF,IAAAA,CAAKmuF,OAAAA,GAAUjqC;YACjB;YAEO,OAAOpN,CAAAA,EAAAA;gBACZ92C,IAAAA,CAAKmuF,OAAAA,CAAQxrF,GAAAA,CAAI4zF,IAAkBnI,YAAAA,IACnCpuF,IAAAA,CAAKmuF,OAAAA,CAAQ3nC,IAAAA,IACbxmD,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,aAAAL;gBACL,OAAOzuF,IAAAA,CAAK8uF,QACd;YAAA;YAEO,OAAA7uB,CAEP;YAEO,QAAAtkD,CAEP;QAAA;QCvBK,MAAM66E;YAkBX,YAAYtyC,CAAAA,EAAgBuyC,CAAAA,EAAwBC,CAAAA,CAAAA;gBAjBpD,IAAA,CAAA92F,EAAAA,GAAK+uF,MAcG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GAGjB9uF,IAAAA,CAAK6wF,GAAAA,GAAM3sC,EAAOvhD,GAAAA,CAAIgwC,KACtB3yC,IAAAA,CAAK8wF,OAAAA,GAAU5sC,EAAOvhD,GAAAA,CAAI4mD,KAC1BvpD,IAAAA,CAAK22F,SAAAA,GAAYF,EAAe9zF,GAAAA,CAAIgwC,KACpC3yC,IAAAA,CAAK42F,aAAAA,GAAgBH,EAAe9zF,GAAAA,CAAI4mD,KACxCvpD,IAAAA,CAAK+/C,QAAAA,GAAW,IAAIjyC,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GACxDpK,IAAAA,CAAKkxF,IAAAA,GAAO,IAAIpjF,EAAO9N,IAAAA,CAAK22F,SAAAA,CAAU97E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK22F,SAAAA,CAAU97E,GAAAA,CAAIzQ,CAAAA,GAChEpK,IAAAA,CAAK62F,gBAAAA,GAAAA,KAAsC/1F,MAAnB41F,IAA+BA,IAAiB12F,IAAAA,CAAK+/C,QAAAA,CAASlxC,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GACpGlxF,IAAAA,CAAK20C,MAAAA,GAAS;YAChB;YAEO,OAAOmC,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK82F,gBAAAA,GAAmB92F,IAAAA,CAAK+/C,QAAAA,CAASlxC,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GACpDlxF,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAK+/C,QAAAA,EAAU/vC,SAAAA,EAAAA;gBAG3C,MAAM+mF,IAAqBzxF,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIjP,IAAAA,CAAK42F,aAAAA,CAAcptC,GAAAA,CAAIl9C,CAAAA,EAAG,KAAKhH,KAAK2J,GAAAA,CAAIjP,IAAAA,CAAK42F,aAAAA,CAAcptC,GAAAA,CAAIp/C,CAAAA,EAAG;gBAUhH,IAT2B,MAAvB2sF,KACF/2F,CAAAA,IAAAA,CAAK20C,MAAAA,GAASoiD,CAAAA,GAEhB/2F,IAAAA,CAAK+/C,QAAAA,GAAWrxC,EAAI1O,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GAEjDpK,IAAAA,CAAKkxF,IAAAA,GAAOxiF,EAAI1O,IAAAA,CAAK22F,SAAAA,CAAU97E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK22F,SAAAA,CAAU97E,GAAAA,CAAIzQ,CAAAA,GACzDpK,IAAAA,CAAK82F,gBAAAA,GAAmB92F,IAAAA,CAAK+/C,QAAAA,CAASlxC,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GACpDlxF,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAK+/C,QAAAA,EAAU/vC,SAAAA,IAErChQ,IAAAA,CAAK82F,gBAAAA,IAAoB92F,IAAAA,CAAK62F,gBAAAA,EAAkB;oBAClD,MAAM7wE,IAAIhmB,IAAAA,CAAKi3E,IAAAA,CAAKhnE,KAAAA,CAAMjQ,IAAAA,CAAK20C,MAAAA;oBAC/B30C,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAIsX,EAAE1Z,CAAAA,EAAG0Z,EAAE5b,CAAAA;gBAChC,OACEpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG;gBAGxB1O,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA;YAE9B;YAEO,OAAAuxD;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,aAAAL;gBAEL,OAAOzuF,IAAAA,CAAK8uF,QACd;YAAA;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QCxEK,MAAMkI;YAiBX,YAAYC,CAAAA,EAAeC,CAAAA,EAAqBriD,CAAAA,CAAAA;gBAhBhD,IAAA,CAAAj1C,EAAAA,GAAK+uF,MAYG,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAqI,kBAAAA,GAAAA,CAAqB,GAG3Bn3F,IAAAA,CAAK6wF,GAAAA,GAAMoG,EAAMt0F,GAAAA,CAAIgwC,KACrB3yC,IAAAA,CAAK8wF,OAAAA,GAAUmG,EAAMt0F,GAAAA,CAAI4mD,KACzBvpD,IAAAA,CAAKo3F,OAAAA,GAAUF,EAAYv0F,GAAAA,CAAIgwC,KAC/B3yC,IAAAA,CAAKq3F,WAAAA,GAAcH,EAAYv0F,GAAAA,CAAI4mD,KACnCvpD,IAAAA,CAAK+/C,QAAAA,GAAW,IAAIjyC,EAAO9N,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GACxDpK,IAAAA,CAAKkxF,IAAAA,GAAO,IAAIpjF,EAAO9N,IAAAA,CAAKo3F,OAAAA,CAAQv8E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAKo3F,OAAAA,CAAQv8E,GAAAA,CAAIzQ,CAAAA,GAC5DpK,IAAAA,CAAK20C,MAAAA,GAASE,KAAS,GAAA,KAET/zC,MAAV+zC,KACF70C,CAAAA,IAAAA,CAAKm3F,kBAAAA,GAAAA,CAAqB,CAAA;YAE9B;YAEO,OAAOrgD,CAAAA,EAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK82F,gBAAAA,GAAmB92F,IAAAA,CAAK+/C,QAAAA,CAASlxC,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GACpDlxF,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAK+/C,QAAAA,EAAU/vC,SAAAA,EAAAA;gBAG3C,MAAMsnF,IAAmBhyF,KAAK0J,IAAAA,CAAK1J,KAAK2J,GAAAA,CAAIjP,IAAAA,CAAKq3F,WAAAA,CAAY7tC,GAAAA,CAAIl9C,CAAAA,EAAG,KAAKhH,KAAK2J,GAAAA,CAAIjP,IAAAA,CAAKq3F,WAAAA,CAAY7tC,GAAAA,CAAIp/C,CAAAA,EAAG;gBACjF,MAArBktF,KAA2Bt3F,IAAAA,CAAKm3F,kBAAAA,IAClCn3F,CAAAA,IAAAA,CAAK20C,MAAAA,GAAS2iD,CAAAA,GAEhBt3F,IAAAA,CAAK+/C,QAAAA,GAAWrxC,EAAI1O,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,CAAIzQ,CAAAA,GAEjDpK,IAAAA,CAAKkxF,IAAAA,GAAOxiF,EAAI1O,IAAAA,CAAKo3F,OAAAA,CAAQv8E,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAKo3F,OAAAA,CAAQv8E,GAAAA,CAAIzQ,CAAAA,GACrDpK,IAAAA,CAAK82F,gBAAAA,GAAmB92F,IAAAA,CAAK+/C,QAAAA,CAASlxC,QAAAA,CAAS7O,IAAAA,CAAKkxF,IAAAA,GACpDlxF,IAAAA,CAAKi3E,IAAAA,GAAOj3E,IAAAA,CAAKkxF,IAAAA,CAAK3gF,GAAAA,CAAIvQ,IAAAA,CAAK+/C,QAAAA,EAAU/vC,SAAAA;gBAEzC,MAAMgW,IAAIhmB,IAAAA,CAAKi3E,IAAAA,CAAKhnE,KAAAA,CAAMjQ,IAAAA,CAAK20C,MAAAA;gBAC/B30C,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAIsX,EAAE1Z,CAAAA,EAAG0Z,EAAE5b,CAAAA,GAE1BpK,IAAAA,CAAKyuF,UAAAA,MACPzuF,CAAAA,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKkxF,IAAAA,CAAK5kF,CAAAA,EAAGtM,IAAAA,CAAKkxF,IAAAA,CAAK9mF,CAAAA,GAC1CpK,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,EAAA;YAE9B;YAEO,aAAA+/E;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAK82F,gBAAAA,IAAoB;YACnD;YAEO,OAAA72B;gBACLjgE,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM96C,EAAI,GAAG,IAC1B1O,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAK82F,gBAAAA,GAAmBloF,IAAAA;YAC1B;QAAA;QCpEK,MAAM2oF;YAWX,YAAYrzC,CAAAA,EAAgBvwC,CAAAA,EAAc+hC,IAAmB,GAAA,CAAA;gBAAA,IAAA;gBAV7D,IAAA,CAAA91C,EAAAA,GAAK+uF,MAGG,IAAA,CAAAG,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAA6B,QAAAA,GAAAA,CAAoB,GAGpB,IAAA,CAAA6G,MAAAA,GAAiB,GACjB,IAAA,CAAAC,gBAAAA,GAA2B,GAGjCz3F,IAAAA,CAAKggD,SAAAA,GAAYkE,EAAOvhD,GAAAA,CAAI48C,KAC5Bv/C,IAAAA,CAAK0/D,SAAAA,GAAYhqB,GACjB11C,IAAAA,CAAKmuF,OAAAA,GAAUjqC,GACflkD,IAAAA,CAAK03F,SAAAA,GAAwB,SAAZ,CAAA,IAAAxzC,EAAO8B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE/rC,MAAAA,CAAO2yB,eAAAA,CAAgB2kB,cAAAA,CAAe;oBACnE9iC,MAAM;oBACN9a,OAAAA;oBACAopB,gBAAgB;gBAAA,IAgBlB/8B,IAAAA,CAAKw3F,MAAAA,GAAS9hD;YAChB;YAEO,OAAOoB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACP92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAKw3F,MAAAA,GAASx3F,IAAAA,CAAK0/D,SAAAA,EACnB1/D,IAAAA,CAAKy3F,gBAAAA,GAAmBz3F,IAAAA,CAAK0/D,SAAAA,EAC5B1/D,IAAAA,CAAKmuF,OAAAA,CAAkBruC,QAAAA,CAAS/2B,QAAAA,GAAW/oB,IAAAA,CAAK03F,SAAAA,AAAAA,GAE9C13F,IAAAA,CAAKggD,SAAAA,IAIVhgD,CAAAA,IAAAA,CAAKy3F,gBAAAA,IAAoB3gD,GAErB92C,IAAAA,CAAKggD,SAAAA,IACO,CAAA,SAAd,CAAA,IAAAhgD,IAAAA,CAAK03F,SAAAA,AAAAA,KAAAA,KAAS,MAAA,KAAA,EAAEjqD,MAAAA,CAAQvR,CAAAA;oBACtBA,EAAO0D,kBAAAA,CAAmB,WAAW5/B,IAAAA,CAAKy3F,gBAAAA,GAAmBz3F,IAAAA,CAAKw3F,MAAAA;gBAAO,EAAA,GAIzEx3F,IAAAA,CAAKyuF,UAAAA,MACNzuF,CAAAA,IAAAA,CAAKmuF,OAAAA,CAAkBruC,QAAAA,CAAS/2B,QAAAA,GAAW,IAAA,CAAA;YAEhD;YAEO,aAAA0lE;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKy3F,gBAAAA,IAAoB;YACnD;YAEO,OAAAx3B;gBACDjgE,IAAAA,CAAKggD,SAAAA,IACPhgD,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUP,SAAAA,GAAAA,CAAY,CAAA,GAE7Bz/C,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QC9DK,MAAM6I;YAMX,YAAY1+E,CAAAA,CAAAA;gBAAAA,IAAAA;gBACV,IALM,IAAA,CAAA2+E,WAAAA,GAAwB,EAAA,EAGvB,IAAA,CAAAngD,OAAAA,GAAkB,GAEY,MAAjCx+B,EAAQ4+E,aAAAA,CAAcv3F,MAAAA,EACxB,MAAM,IAAI6F,MAAM;gBAElBnG,IAAAA,CAAK83F,cAAAA,GAAiB;uBAAI7+E,EAAQ4+E,aAAAA;iBAAAA,EAClC73F,IAAAA,CAAKy3C,OAAAA,GAAyB,SAAf,CAAA,IAAAx+B,EAAQw+B,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAIz3C,IAAAA,CAAKy3C,OAAAA,EAEvCz3C,IAAAA,CAAK+3F,gBAAAA;YACP;YAEA,IAAA,YAAWC;gBACT,OAAOh4F,IAAAA,CAAKi4F,UACd;YAAA;YAEA,IAAA,gBAAWJ;gBACT,OAAO73F,IAAAA,CAAK83F,cACd;YAAA;YAEA,IAAA,cAAyB/7E,CAAAA,EAAAA;gBACvB/b,IAAAA,CAAK83F,cAAAA,GAAiB;uBAAI/7E;iBAAAA,EAC1B/b,IAAAA,CAAK+3F,gBAAAA;YACP;YAEA,gBAAgBvsF,CAAAA,EAAsBoR,CAAAA,EAAAA;gBACpC5c,IAAAA,CAAK83F,cAAAA,CAAetsF,EAAAA,GAASoR,GAC7B5c,IAAAA,CAAK+3F,gBAAAA;YACP;YAEQ,mBAAAA;gBACN,IAAII,IAAc;gBAClBn4F,IAAAA,CAAK43F,WAAAA,CAAYt3F,MAAAA,GAAS;gBAC1B,IAAI+lF,IAAOrmF,IAAAA,CAAK63F,aAAAA,CAAc,EAAA;gBAC9B,MAAM71F,IAAIhC,IAAAA,CAAK63F,aAAAA,CAAcv3F,MAAAA,GAASN,IAAAA,CAAKy3C,OAAAA;gBAC3C,IAAK,IAAIj3C,IAAI,GAAGA,IAAIwB,GAAGxB,IAAK;oBAC1B,MAAMgW,IAAIhW,IAAKwB,CAAAA,IAAI,CAAA,GACbo2F,IAAKp4F,IAAAA,CAAKmwE,QAAAA,CAAS35D;oBAEzB2hF,KADa9R,EAAKx3E,QAAAA,CAASupF,IAE3Bp4F,IAAAA,CAAK43F,WAAAA,CAAYj4F,IAAAA,CAAKw4F,IACtB9R,IAAO+R;gBACT;gBACAp4F,IAAAA,CAAKi4F,UAAAA,GAAaE;YACpB;YAEQ,sBAAsBtpF,CAAAA,EAAAA;gBAC5B,MAAM7M,IAAIhC,IAAAA,CAAK43F,WAAAA,CAAYt3F,MAAAA,EACrB03F,IAAYh4F,IAAAA,CAAKg4F,SAAAA;gBAEvB,IAAInpF,KAAY,KAAKA,IAAWmpF,GAC9B;oBAAA,IAAK,IAAIx3F,IAAI,GAAGA,IAAIwB,IAAI,GAAGxB,IACzB,IAAIR,IAAAA,CAAK43F,WAAAA,CAAYp3F,EAAAA,IAAMqO,KAAYA,IAAW7O,IAAAA,CAAK43F,WAAAA,CAAYp3F,IAAI,EAAA,EACrE,OAAO2vF,GAAMnwF,IAAAA,CAAK43F,WAAAA,CAAYp3F,EAAAA,EAAIR,IAAAA,CAAK43F,WAAAA,CAAYp3F,IAAI,EAAA,EAAIA,IAAKwB,CAAAA,IAAI,CAAA,GAAA,AAAKxB,CAAAA,IAAI,CAAA,IAAMwB,CAAAA,IAAI,CAAA,GAAI6M;gBAAAA;gBAIjG,OAAOA,IAAWmpF;YACpB;YAMA,SAAS/5C,CAAAA,EAAAA;gBACP,MAAMliC,IAAS;uBAAI/b,IAAAA,CAAK63F,aAAAA;iBAAAA;gBAExB,IAAK,IAAI50F,IAAI,GAAGA,IAAI8Y,EAAOzb,MAAAA,EAAQ2C,IACjC,IAAK,IAAIzC,IAAI,GAAGA,IAAIub,EAAOzb,MAAAA,GAAS2C,GAAGzC,IACrCub,CAAAA,CAAOvb,EAAAA,GAAKwvF,GAAWj0E,CAAAA,CAAOvb,EAAAA,EAAIub,CAAAA,CAAOvb,IAAI,EAAA,EAAIy9C;gBAIrD,OAAOliC,CAAAA,CAAO,EAChB;YAAA;YAMA,WAAWkiC,CAAAA,EAAAA;gBACT,MAAMs6C,IAAct6C,IAAOA,GACrBw8B,IAAKz6E,IAAAA,CAAK63F,aAAAA,CAAc,EAAA,EACxBW,IAAKx4F,IAAAA,CAAK63F,aAAAA,CAAc,EAAA,EACxBY,IAAKz4F,IAAAA,CAAK63F,aAAAA,CAAc,EAAA,EACxBa,IAAK14F,IAAAA,CAAK63F,aAAAA,CAAc,EAAA;gBAO9B,OAJepd,EACZxqE,KAAAA,CAAAA,KAAWsoF,IAAc,IAAIt6C,IAAO,GACpC7tC,GAAAA,CAAIooF,EAAGvoF,KAAAA,CAAM,IAAIsoF,IAAc,KAAKt6C,IAAO,GAAG7tC,GAAAA,CAAIqoF,EAAGxoF,KAAAA,CAAAA,KAAWsoF,IAAc,IAAIt6C,GAAM7tC,GAAAA,CAAIsoF,EAAGzoF,KAAAA,CAAM,IAAIsoF,MAE9FvoF,SAAAA;YAChB;YAMA,kBAAkBiuC,CAAAA,EAAAA;gBAChB,MAAM26C,IAAkB36C,IAAOj+C,IAAAA,CAAKg4F,SAAAA,EAC9Ba,IAAc74F,IAAAA,CAAKq4F,qBAAAA,CAAsBO;gBAC/C,OAAO54F,IAAAA,CAAKs4F,UAAAA,CAAWO;YACzB;YAMA,UAAU56C,CAAAA,EAAAA;gBACR,OAAOj+C,IAAAA,CAAKs4F,UAAAA,CAAWr6C,GAAMltC,MAAAA;YAC/B;YAMA,iBAAiBktC,CAAAA,EAAAA;gBACf,OAAOj+C,IAAAA,CAAK24F,iBAAAA,CAAkB16C,GAAMltC,MAAAA;YACtC;YAMA,gBAAgBktC,CAAAA,EAAAA;gBACd,MAAM26C,IAAkB36C,IAAOj+C,IAAAA,CAAKg4F,SAAAA,EAC9Ba,IAAc74F,IAAAA,CAAKq4F,qBAAAA,CAAsBO;gBAC/C,OAAO54F,IAAAA,CAAKmwE,QAAAA,CAAS0oB;YACvB;YAEA,QAAA5mF;gBACE,OAAO,IAAI0lF,GAAY;oBACrBE,eAAe;2BAAI73F,IAAAA,CAAK63F,aAAAA;qBAAAA;oBACxBpgD,SAASz3C,IAAAA,CAAKy3C,OAAAA;gBAAAA;YAElB;QAAA;QChIK,MAAMwhD;YAWX,YAAY/0C,CAAAA,EAAgBjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAG1B,IAbF,IAAA,CAAArZ,EAAAA,GAAa+uF,MAOL,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAoK,KAAAA,GAA+B,WAErCl5F,IAAAA,CAAKmuF,OAAAA,GAAUjqC,GACflkD,IAAAA,CAAK6wF,GAAAA,GAAM7wF,IAAAA,CAAKmuF,OAAAA,CAAQxrF,GAAAA,CAAIgwC,KAAAA,CACvB3yC,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,kFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAKm5F,MAAAA,GAAS,IAAIxB,GAAY;oBAC5BE,eAAe;wBAACnpF,EAAI,GAAG;2BAAOuK,EAAQ4+E,aAAAA;qBAAAA;oBACtCpgD,SAASx+B,EAAQw+B,OAAAA;gBAAAA,IAEnBz3C,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKk5F,KAAAA,GAAoB,SAAZ,CAAA,IAAAjgF,EAAQmgF,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAIp5F,IAAAA,CAAKk5F,KAAAA,EAClCl5F,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YAEA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKm5F,MAAAA,CAAOjB,eAAAA,CAAgB,GAAGl4F,IAAAA,CAAK6wF,GAAAA,CAAI//C,SAAAA,CAAU7+B,KAAAA,KAClDjS,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG;gBACtE,cAAfhxF,IAAAA,CAAKk5F,KAAAA,GACPl5F,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOhpB,QAAAA,CAAS35D,KAEpCxW,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOH,eAAAA,CAAgBxiF,IAEzCxW,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKmuF,OAAAA,KACJ,CAAA,cAAfnuF,IAAAA,CAAKk5F,KAAAA,GACPl5F,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOhpB,QAAAA,CAAS,KAEpCnwE,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOH,eAAAA,CAAgB,EAAA;YAGjD;YACA,WAAW90C,CAAAA,EAAAA;gBACT,OAAOlkD,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YACA,QAAAr1E;gBACE3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YACA,OAAA7uB;gBACEjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YACpB;QAAA;QC1DK,MAAMqI;YAWX,YAAYn1C,CAAAA,EAAgBjrC,CAAAA,CAAAA;gBAAAA,IAAAA;gBAG1B,IAbF,IAAA,CAAArZ,EAAAA,GAAa+uF,MAOL,IAAA,CAAAgC,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAA7B,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAoK,KAAAA,GAA+B,WAErCl5F,IAAAA,CAAKmuF,OAAAA,GAAUjqC,GACflkD,IAAAA,CAAK6wF,GAAAA,GAAM7wF,IAAAA,CAAKmuF,OAAAA,CAAQxrF,GAAAA,CAAIgwC,KAAAA,CACvB3yC,IAAAA,CAAK6wF,GAAAA,EACR,MAAM,IAAI1qF,MAAM,CAAA,OAAA,EAAU+9C,EAAOz1B,IAAAA,CAAAA,kFAAAA,CAAAA;gBAEnCzuB,IAAAA,CAAKm5F,MAAAA,GAASn5F,IAAAA,CAAKm5F,MAAAA,GAAS,IAAIxB,GAAY;oBAC1CE,eAAe;wBAACnpF,EAAI,GAAG;2BAAOuK,EAAQ4+E,aAAAA;qBAAAA;oBACtCpgD,SAASx+B,EAAQw+B,OAAAA;gBAAAA,IAEnBz3C,IAAAA,CAAK+wF,WAAAA,GAAc93E,EAAQy8B,QAAAA,EAC3B11C,IAAAA,CAAKk5F,KAAAA,GAAoB,SAAZ,CAAA,IAAAjgF,EAAQmgF,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAIp5F,IAAAA,CAAKk5F,KAAAA,EAClCl5F,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WACzB;YAAA;YAEA,OAAOj6C,CAAAA,EAAAA;gBACA92C,IAAAA,CAAK2wF,QAAAA,IACR3wF,CAAAA,IAAAA,CAAKm5F,MAAAA,CAAOjB,eAAAA,CAAgB,GAAGl4F,IAAAA,CAAK6wF,GAAAA,CAAI//C,SAAAA,GACxC9wC,IAAAA,CAAKm5F,MAAAA,CAAOjB,eAAAA,CAAgB,GAAGl4F,IAAAA,CAAKm5F,MAAAA,CAAOtB,aAAAA,CAAc,EAAA,CAAGznF,GAAAA,CAAIpQ,IAAAA,CAAK6wF,GAAAA,CAAI//C,SAAAA,IACzE9wC,IAAAA,CAAKm5F,MAAAA,CAAOjB,eAAAA,CAAgB,GAAGl4F,IAAAA,CAAKm5F,MAAAA,CAAOtB,aAAAA,CAAc,EAAA,CAAGznF,GAAAA,CAAIpQ,IAAAA,CAAK6wF,GAAAA,CAAI//C,SAAAA,IACzE9wC,IAAAA,CAAKm5F,MAAAA,CAAOjB,eAAAA,CAAgB,GAAGl4F,IAAAA,CAAKm5F,MAAAA,CAAOtB,aAAAA,CAAc,EAAA,CAAGznF,GAAAA,CAAIpQ,IAAAA,CAAK6wF,GAAAA,CAAI//C,SAAAA,IACzE9wC,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,CAAA,GAElB3wF,IAAAA,CAAKgxF,UAAAA,IAAcl6C;gBACnB,MAAMtgC,IAAI9J,EAAMyjF,GAAM,GAAGnwF,IAAAA,CAAK+wF,WAAAA,EAAa,GAAG,GAAG/wF,IAAAA,CAAK+wF,WAAAA,GAAc/wF,IAAAA,CAAKgxF,UAAAA,GAAa,GAAG;gBACtE,cAAfhxF,IAAAA,CAAKk5F,KAAAA,GACPl5F,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOhpB,QAAAA,CAAS35D,KAEpCxW,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOH,eAAAA,CAAgBxiF,IAEzCxW,IAAAA,CAAKyuF,UAAAA,CAAWzuF,IAAAA,CAAKmuF,OAAAA,KACJ,CAAA,cAAfnuF,IAAAA,CAAKk5F,KAAAA,GACPl5F,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOhpB,QAAAA,CAAS,KAEpCnwE,IAAAA,CAAK6wF,GAAAA,CAAIh2E,GAAAA,GAAM7a,IAAAA,CAAKm5F,MAAAA,CAAOH,eAAAA,CAAgB,EAAA;YAGjD;YACA,WAAW90C,CAAAA,EAAAA;gBACT,OAAOlkD,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKgxF,UAAAA,GAAa;YAC5C;YACA,QAAAr1E;gBACE3b,IAAAA,CAAKgxF,UAAAA,GAAahxF,IAAAA,CAAK+wF,WAAAA,EACvB/wF,IAAAA,CAAK2wF,QAAAA,GAAAA,CAAW,GAChB3wF,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YACA,OAAA7uB;gBACEjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;QAAA;QC1DK,MAAMG;YAIX,YAAY/qC,CAAAA,CAAAA;gBACVlkD,IAAAA,CAAKmuF,OAAAA,GAAUjqC,GACflkD,IAAAA,CAAKs5F,MAAAA,GAAS,IAAIvL,GAAY7pC;YAChC;YAEO,WAAAirC;gBACL,OAAOnvF,IAAAA,CAAKs5F,MACd;YAAA;YAEO,OAAOxiD,CAAAA,EAAAA;gBACZ92C,IAAAA,CAAKs5F,MAAAA,CAAO7rD,MAAAA,CAAOqJ;YACrB;YAKO,eAAAs3C;gBACLpuF,IAAAA,CAAKs5F,MAAAA,CAAOlL,YAAAA;YACd;YAEO,UAAU/pC,CAAAA,EAAAA;gBAGf,OAFAA,EAAO1oC,KAAAA,IACP3b,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAIi0C,IACTrkD,IACT;YAAA;YAOO,QAAQiZ,CAAAA,EAAAA;gBAEb,OADAjZ,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIipF,GAAQr5F,IAAAA,CAAKmuF,OAAAA,EAASl1E,KACnCjZ,IACT;YAAA;YAOO,QAAQiZ,CAAAA,EAAAA;gBAEb,OADAjZ,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI6oF,GAAQj5F,IAAAA,CAAKmuF,OAAAA,EAASl1E,KACnCjZ,IACT;YAAA;YAuBO,OAAA05F,GAAUhiF,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACf,IAAIpL,IAAI,GACJlC,IAAI,GACJsrC,IAAW,GACXs/C,IAAY9H,GAAgBI,MAAAA;gBAchC,OAbI51E,CAAAA,CAAK,EAAA,YAAc5J,IACrBxB,CAAAA,IAAIoL,CAAAA,CAAK,EAAA,CAAGpL,CAAAA,EACZlC,IAAIsN,CAAAA,CAAK,EAAA,CAAGtN,CAAAA,EACZsrC,IAAWh+B,CAAAA,CAAK,EAAA,EAChBs9E,IAAmB,SAAP,CAAA,IAAAt9E,CAAAA,CAAK,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,IAAIs9E,CAAAA,IAEvB1oF,CAAAA,IAAIoL,CAAAA,CAAK,EAAA,EACTtN,IAAIsN,CAAAA,CAAK,EAAA,EACTg+B,IAAWh+B,CAAAA,CAAK,EAAA,EAChBs9E,IAAmB,SAAP,CAAA,IAAAt9E,CAAAA,CAAK,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,IAAIs9E,CAAAA,GAGzBh1F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI2kF,GAAO/0F,IAAAA,CAAKmuF,OAAAA,EAAS7hF,GAAGlC,GAAGsrC,GAAUs/C,KAClDh1F,IACT;YAAA;YAoBO,OAAA25F,GAAUjiF,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACf,IAAIwpC,IAAU,GACVC,IAAU,GACVzL,IAAW,GACXs/C,IAAY9H,GAAgBI,MAAAA;gBAchC,OAbI51E,CAAAA,CAAK,EAAA,YAAc5J,IACrBozC,CAAAA,IAAUxpC,CAAAA,CAAK,EAAA,CAAGpL,CAAAA,EAClB60C,IAAUzpC,CAAAA,CAAK,EAAA,CAAGtN,CAAAA,EAClBsrC,IAAWh+B,CAAAA,CAAK,EAAA,EAChBs9E,IAAmB,SAAP,CAAA,IAAAt9E,CAAAA,CAAK,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,IAAIs9E,CAAAA,IAEvB9zC,CAAAA,IAAUxpC,CAAAA,CAAK,EAAA,EACfypC,IAAUzpC,CAAAA,CAAK,EAAA,EACfg+B,IAAWh+B,CAAAA,CAAK,EAAA,EAChBs9E,IAAmB,SAAP,CAAA,IAAAt9E,CAAAA,CAAK,EAAA,AAAA,KAAA,KAAE,MAAA,IAAA,IAAIs9E,CAAAA,GAGzBh1F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIilF,GAAOr1F,IAAAA,CAAKmuF,OAAAA,EAASjtC,GAASC,GAASzL,GAAUs/C,KAC9Dh1F,IACT;YAAA;YAyBO,OAAO45F,CAAAA,EAAkDC,CAAAA,EAAmBC,CAAAA,EAAAA;gBACjF,IAAIxtF,IAAI,GACJlC,IAAI,GACJyqC,IAAQ;gBAcZ,OAbI+kD,aAA2B9rF,IAC7BxB,CAAAA,IAAIstF,EAAgBttF,CAAAA,EACpBlC,IAAIwvF,EAAgBxvF,CAAAA,EACpByqC,IAAAA,CAAUglD,CAAAA,QAAAA,IAAAA,IAAY,CAAA,GACtB75F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIwhF,GAAO5xF,IAAAA,CAAKmuF,OAAAA,EAAS7hF,GAAGlC,GAAGyqC,GAAAA,IACX,YAAA,OAApB+kD,KAAoD,YAAA,OAAbC,KAAqD,YAAA,OAArBC,IACvFxtF,CAAAA,IAAIstF,GACJxvF,IAAIyvF,GACJhlD,IAAQilD,GACR95F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIwhF,GAAO5xF,IAAAA,CAAKmuF,OAAAA,EAAS7hF,GAAGlC,GAAGyqC,GAAAA,IACtC68C,GAAgBkI,MACzB55F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIuhF,GAAkB3xF,IAAAA,CAAKmuF,OAAAA,EAASyL,KAE/C55F,IACT;YAAA;YAiBO,OACLg6F,CAAAA,EACAC,CAAAA,EACAH,CAAAA,EAAAA;gBAEA,IAAII,IAAU,GACVC,IAAU,GACVtlD,IAAQ;gBAcZ,OAbImlD,aAAoClsF,KAAoC,YAAA,OAAnBmsF,IACvDC,CAAAA,IAAUF,EAAyB1tF,CAAAA,EACnC6tF,IAAUH,EAAyB5vF,CAAAA,EACnCyqC,IAAQolD,GACRj6F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIohF,GAAOxxF,IAAAA,CAAKmuF,OAAAA,EAAS+L,GAASC,GAAStlD,GAAAA,IACd,YAAA,OAA7BmlD,KAAmE,YAAA,OAAnBC,KAA2D,YAAA,OAArBH,IACtGI,CAAAA,IAAUF,GACVG,IAAUF,GACVplD,IAAQilD,GACR95F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIohF,GAAOxxF,IAAAA,CAAKmuF,OAAAA,EAAS+L,GAASC,GAAStlD,GAAAA,IAClD47C,GAAgBuJ,MACzBh6F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIsgF,GAAkB1wF,IAAAA,CAAKmuF,OAAAA,EAAS6L,KAE/Ch6F,IACT;YAAA;YAiBO,SAASq6F,CAAAA,EAAiDxlD,CAAAA,EAAgBzjC,CAAAA,EAAAA;gBAM/E,OALqC,YAAA,OAA1BipF,KAAuD,YAAA,OAAVxlD,IACtD70C,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIiiF,GAASryF,IAAAA,CAAKmuF,OAAAA,EAASkM,GAAuBxlD,GAAOzjC,MAC/B,YAAA,OAA1BipF,KAChBr6F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI4hF,GAAoBhyF,IAAAA,CAAKmuF,OAAAA,EAASkM,KAEjDr6F,IACT;YAAA;YAiBO,SAASu6F,CAAAA,EAAuD1lD,CAAAA,EAAgBzjC,CAAAA,EAAAA;gBAMrF,OAL2C,YAAA,OAAhCmpF,IACTv6F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI0iF,GAAoB9yF,IAAAA,CAAKmuF,OAAAA,EAASoM,MAEtDv6F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI2iF,GAAS/yF,IAAAA,CAAKmuF,OAAAA,EAASoM,GAA6B1lD,GAAiBzjC,KAEpFpR,IACT;YAAA;YA2BO,QACLy6F,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAEA,IAAIC,IAAQ,GACRC,IAAQ,GACRxH,IAAS,GACTC,IAAS;gBAEb,OAAIP,GAAiByH,KACnBz6F,CAAAA,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI6iF,GAAmBjzF,IAAAA,CAAKmuF,OAAAA,EAASsM,KAC9Cz6F,IAAAA,AAAAA,IAGLy6F,CAAAA,aAAkC3sF,KAAU4sF,aAAwB5sF,KACtE+sF,CAAAA,IAAQJ,EAAuBnuF,CAAAA,EAC/BwuF,IAAQL,EAAuBrwF,CAAAA,EAE/BkpF,IAASoH,EAAapuF,CAAAA,EACtBinF,IAASmH,EAAatwF,CAAAA,AAAAA,GAEc,YAAA,OAA3BqwF,KAA+D,YAAA,OAAjBC,KACvDG,CAAAA,IAAQJ,GACRK,IAAQJ,GAERpH,IAASqH,GACTpH,IAASqH,CAAAA,GAGX56F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIijF,GAAQrzF,IAAAA,CAAKmuF,OAAAA,EAAS0M,GAAOC,GAAOxH,GAAQC,KACzDvzF,IAAAA,AAAAA;YACT;YAwBO,QACLg7F,CAAAA,EACAC,CAAAA,EACApmD,CAAAA,EAAAA;gBAEA,IAAIq/C,GAAiB8G,IAEnB,OADAh7F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIgkF,GAAmBp0F,IAAAA,CAAKmuF,OAAAA,EAAS6M,KAC9Ch7F,IAAAA;gBAET,IAAIk7F,IAAc,GACdC,IAAc;gBAclB,OAZIH,aAAwCltF,KAC1CotF,CAAAA,IAAcF,EAA6B1uF,CAAAA,EAC3C6uF,IAAcH,EAA6B5wF,CAAAA,EAE3CyqC,IAAQomD,CAAAA,GAEkC,YAAA,OAAjCD,KAA2E,YAAA,OAAvBC,KAC7DC,CAAAA,IAAcF,GACdG,IAAcF,CAAAA,GAGhBj7F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIkkF,GAAQt0F,IAAAA,CAAKmuF,OAAAA,EAAS+M,GAAaC,GAAatmD,KAC7D70C,IACT;YAAA;YAWO,MAAMu1F,CAAAA,EAAqBC,CAAAA,EAAwBC,IAAoB,CAAA,EAAA;gBAE5E,OADAz1F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIklF,GAAMt1F,IAAAA,CAAKmuF,OAAAA,EAASoH,GAAaC,GAAgBC,KAC9Dz1F,IACT;YAAA;YASO,KAAK4oB,CAAAA,EAAiB8sB,CAAAA,EAAAA;gBAE3B,OADA11C,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI0lF,GAAK91F,IAAAA,CAAKmuF,OAAAA,EAASvlE,GAAS8sB,KACzC11C,IACT;YAAA;YAOO,MAAM2T,CAAAA,EAAc+hC,IAAmB,GAAA,EAAA;gBAE5C,OADA11C,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAImnF,GAAMv3F,IAAAA,CAAKmuF,OAAAA,EAASx6E,GAAO+hC,KACxC11C,IACT;YAAA;YAQO,MAAM01C,CAAAA,EAAAA;gBAEX,OADA11C,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIgmF,GAAM1gD,KACnB11C,IACT;YAAA;YAOO,MAAAs7F;gBAEL,OADAt7F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIkmF,GAAIt2F,IAAAA,CAAKmuF,OAAAA,IACtBnuF,IACT;YAAA;YAOO,WAAW40F,CAAAA,EAAAA;gBAEhB,OADA50F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIukF,GAAWC,KACxB50F,IACT;YAAA;YAmBO,OAAO4uF,CAAAA,EAAsD4M,CAAAA,EAAAA;gBAClE,OAAKA,IAILx7F,CAAAA,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI4d,GAAOhuB,IAAAA,CAAKmuF,OAAAA,EAASS,GAAe4M,KAEjDx7F,IAAAA,AAAAA,IALLA,CAAAA,IAAAA,CAAKy7F,aAAAA,CAAc7M,IACZ5uF,IAAAA,AAAAA;YAKX;YAiBO,cAAc4uF,CAAAA,EAAAA;gBAEnB,OADA5uF,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIk/E,GAActvF,IAAAA,CAAKmuF,OAAAA,EAASS,KACzC5uF,IACT;YAAA;YAOO,OAAOkkD,CAAAA,EAAgBwyC,CAAAA,EAAAA;gBAM5B,OAAA,KALuB51F,MAAnB41F,IACF12F,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIomF,GAAOx2F,IAAAA,CAAKmuF,OAAAA,EAASjqC,MAEzClkD,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAIomF,GAAOx2F,IAAAA,CAAKmuF,OAAAA,EAASjqC,GAAQwyC,KAE5C12F,IACT;YAAA;YAQO,KAAKkkD,CAAAA,EAAgBrP,CAAAA,EAAAA;gBAM1B,OAAA,KALc/zC,MAAV+zC,IACF70C,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI4mF,GAAKh3F,IAAAA,CAAKmuF,OAAAA,EAASjqC,MAEvClkD,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CAAI,IAAI4mF,GAAKh3F,IAAAA,CAAKmuF,OAAAA,EAASjqC,GAAQrP,KAE1C70C,IACT;YAAA;YAMO,YAAA47F;gBAQL,OAPa,IAAIr3F,QAAeC,CAAAA;oBAC9BxE,IAAAA,CAAKs5F,MAAAA,CAAOlpF,GAAAA,CACV,IAAIukF,GAAW;wBACbnwF;oBAAS;gBAEZ;YAGL;QAAA;QC7hBK,MAAM+xF,WAAyB5kD;YAAtC,aAAA;gBAAA,KAAA,IAAA,YACE,IAAA,CAAA2W,YAAAA,GAAe;oBAAC3V;oBAAoB4W;iBAAAA,EAC5B,IAAA,CAAA9vC,IAAAA,GAA6B;YAmZvC;YAjZE,MAAMyqC,CAAAA,EAAAA;gBACJlkD,IAAAA,CAAKyZ,IAAAA,GAAO,IAAIw1E,GAAc/qC;YAChC;YAEA,WAAA3Q;gBACEvzC,IAAAA,CAAKyZ,IAAAA,GAAO;YACd;YAEQ,UAAAoiF;gBACN,IAAA,CAAK77F,IAAAA,CAAKyZ,IAAAA,EACR,MAAM,IAAItT,MAAM;gBAElB,OAAOnG,IAAAA,CAAKyZ,IACd;YAAA;YAMO,WAAA01E;gBACL,IAAA,CAAKnvF,IAAAA,CAAKyZ,IAAAA,EACR,MAAM,IAAItT,MAAM;gBAElB,OAAOnG,IAAAA,CAAKyZ,IAAAA,CAAK01E,QAAAA;YACnB;YAMO,UAAU9qC,CAAAA,EAAAA;gBACf,IAAA,CAAKrkD,IAAAA,CAAKyZ,IAAAA,EACR,MAAM,IAAItT,MAAM;gBAElB,OAAOnG,IAAAA,CAAKyZ,IAAAA,CAAK8/E,SAAAA,CAAUl1C;YAC7B;YAMO,OAAOvN,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ,OAAgB,SAAT,CAAA,IAAA92C,IAAAA,CAAKyZ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEg0B,MAAAA,CAAOqJ;YAC3B;YAKO,eAAAs3C;gBAAAA,IAAAA;gBACI,SAAT,CAAA,IAAApuF,IAAAA,CAAKyZ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,KAAA,EAAE20E,YAAAA;YACb;YAOO,QAAQn1E,CAAAA,EAAAA;gBACb,OAAOjZ,IAAAA,CAAK67F,OAAAA,GAAUrC,OAAAA,CAAQzgF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACR;iBAAAA;YAClD;YAOO,QAAQA,CAAAA,EAAAA;gBACb,OAAOjZ,IAAAA,CAAK67F,OAAAA,GAAUpC,OAAAA,CAAQ1gF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACR;iBAAAA;YAClD;YAuBO,OAAAygF,GAAUhiF,CAAAA,EAAAA;gBACf,OAAO1X,IAAAA,CAAK67F,OAAAA,GAAUnC,MAAAA,CAAO3gF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM/B;YAChD;YAmBO,OAAAiiF,GAAUjiF,CAAAA,EAAAA;gBACf,OAAO1X,IAAAA,CAAK67F,OAAAA,GAAUlC,MAAAA,CAAO5gF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM/B;YAChD;YAyBO,OAAOkiF,CAAAA,EAAkDC,CAAAA,EAAmBC,CAAAA,EAAAA;gBACjF,OAAO95F,IAAAA,CAAK67F,OAAAA,GAAU5hD,MAAAA,CAAOlhC,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACmgF;oBAAiBC;oBAAUC;iBAAAA;YAC5E;YAuBO,OACLgC,CAAAA,EACA7B,CAAAA,EACAH,CAAAA,EAAAA;gBAEA,OAAO95F,IAAAA,CAAK67F,OAAAA,GAAU9B,MAAAA,CAAOhhF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACqiF;oBAAwB7B;oBAAgBH;iBAAAA;YACzF;YAiBO,SAAS7sF,CAAAA,EAAiC4nC,CAAAA,EAAgBzjC,CAAAA,EAAAA;gBAC/D,OAAOpR,IAAAA,CAAK67F,OAAAA,GAAUzB,QAAAA,CAASrhF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACxM;oBAAO4nC;oBAAOzjC;iBAAAA;YACjE;YAiBO,SAASmpF,CAAAA,EAAuD1lD,CAAAA,EAAgBzjC,CAAAA,EAAAA;gBACrF,OAAOpR,IAAAA,CAAK67F,OAAAA,GAAUvB,QAAAA,CAASvhF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAAC8gF;oBAA6B1lD;oBAAOzjC;iBAAAA;YACvF;YA2BO,QACLqpF,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EACAC,CAAAA,EAAAA;gBAEA,OAAO56F,IAAAA,CAAK67F,OAAAA,GAAUrB,OAAAA,CAAQzhF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACghF;oBAAwBC;oBAAcC;oBAAmBC;iBAAAA;YAC3G;YAwBO,QACLI,CAAAA,EACAC,CAAAA,EACApmD,CAAAA,EAAAA;gBAEA,OAAO70C,IAAAA,CAAK67F,OAAAA,GAAUd,OAAAA,CAAQhiF,KAAAA,CAAM/Y,IAAAA,CAAKyZ,IAAAA,EAAM;oBAACuhF;oBAA8BC;oBAAoBpmD;iBAAAA;YACpG;YAWO,MAAM0gD,CAAAA,EAAqBC,CAAAA,EAAwBC,CAAAA,EAAAA;gBACxD,OAAOz1F,IAAAA,CAAK67F,OAAAA,GAAUT,KAAAA,CAAM7F,GAAaC,GAAgBC;YAC3D;YASO,KAAK7sE,CAAAA,EAAiB8sB,CAAAA,EAAAA;gBAC3B,OAAO11C,IAAAA,CAAK67F,OAAAA,GAAUhxC,IAAAA,CAAKjiC,GAAS8sB;YACtC;YAOO,MAAM/hC,CAAAA,EAAc+hC,IAAmB,GAAA,EAAA;gBAC5C,OAAO11C,IAAAA,CAAK67F,OAAAA,GAAUR,KAAAA,CAAM1nF,GAAO+hC;YACrC;YAQO,MAAMA,CAAAA,EAAAA;gBACX,OAAO11C,IAAAA,CAAK67F,OAAAA,GAAUr7E,KAAAA,CAAMk1B;YAC9B;YAOO,MAAA4lD;gBACL,OAAOt7F,IAAAA,CAAK67F,OAAAA,GAAUP,GAAAA;YACxB;YAOO,WAAW1G,CAAAA,EAAAA;gBAChB,OAAO50F,IAAAA,CAAK67F,OAAAA,GAAUN,UAAAA,CAAW3G;YACnC;YAmBO,OAAOhG,CAAAA,EAAsD4M,CAAAA,EAAAA;gBAClE,OAAOx7F,IAAAA,CAAK67F,OAAAA,GAAUhN,MAAAA,CAAOD,GAAe4M;YAC9C;YAiBO,cAAc5M,CAAAA,EAAAA;gBACnB,OAAO5uF,IAAAA,CAAK67F,OAAAA,GAAUJ,aAAAA,CAAc7M;YACtC;YAOO,OAAO1qC,CAAAA,EAAewyC,CAAAA,EAAAA;gBAC3B,OAAO12F,IAAAA,CAAK67F,OAAAA,GAAUH,MAAAA,CAAOx3C,GAAQwyC;YACvC;YAQO,KAAKxyC,CAAAA,EAAerP,CAAAA,EAAAA;gBACzB,OAAO70C,IAAAA,CAAK67F,OAAAA,GAAUF,IAAAA,CAAKz3C,GAAQrP;YACrC;YAMO,YAAA+mD;gBACL,OAAO57F,IAAAA,CAAK67F,OAAAA,GAAUD,SAAAA;YACxB;QAAA;QClXK,SAASG,GAAQzvF,CAAAA;YACtB,OAAOA,aAAak9E;QACtB;QA8JO,MAAMwS,KAAc;YACzBC,gBAAgB;YAChBC,cAAc;YACdC,cAAc;YACdC,eAAe;YACfj3C,MAAM;YACNk3C,SAAS;YACTC,UAAU;YACVC,SAAS;YACTC,UAAU;YACVC,kBAAkB;YAClBC,mBAAmB;YACnBC,cAAc;YACdC,eAAe;YACfC,WAAW;YACXC,aAAa;YACbC,cAAc;YACdC,cAAc;YACdC,aAAa;YACbC,eAAe;YACfC,OAAO;YACPC,aAAa;YACbC,gBAAgB;YAChBC,kBAAkB;YAClBC,kBAAkB;YAClBC,iBAAiB;YACjBC,eAAe;YACfC,cAAc;YACdC,aAAa;YACbC,gBAAgB;QAAA;QASX,MAAMpU,WAAcpkC;YAsDzB,IAAA,MAAWvqC;gBACT,OAAO7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GACxB;YAAA;YAKA,IAAA,IAAegjF,CAAAA,EAAAA;gBACb79F,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMgjF,EAAO5rF,KAAAA;YAC9B;YAKA,IAAA,SAAWqgE;gBACT,OAAOtyE,IAAAA,CAAK8Z,IAAAA,CAAKw4D,MACnB;YAAA;YAKA,IAAA,eAAW2Z;gBACT,OAAOjsF,IAAAA,CAAK8Z,IAAAA,CAAKmyE,YACnB;YAAA;YAKA,IAAA,OAAkB4R,CAAAA,EAAAA;gBAChB79F,IAAAA,CAAK8Z,IAAAA,CAAKw4D,MAAAA,CAAOnjE,KAAAA,CAAM0uF,EAAOvxF,CAAAA,EAAGuxF,EAAOzzF,CAAAA;YAC1C;YAKA,IAAA,MAAWo/C;gBACT,OAAOxpD,IAAAA,CAAKgqD,MAAAA,CAAOR,GACrB;YAAA;YAKA,IAAA,IAAes0C,CAAAA,EAAAA;gBACb99F,IAAAA,CAAKgqD,MAAAA,CAAOR,GAAAA,GAAMs0C,EAAO7rF,KAAAA;YAC3B;YAKA,IAAA,SAAW44E;gBACT,OAAO7qF,IAAAA,CAAK8Z,IAAAA,CAAK+wE,MACnB;YAAA;YAKA,IAAA,OAAkBiT,CAAAA,EAAAA;gBAChB99F,IAAAA,CAAK8Z,IAAAA,CAAK+wE,MAAAA,CAAO17E,KAAAA,CAAM2uF,EAAOxxF,CAAAA,EAAGwxF,EAAO1zF,CAAAA;YAC1C;YAMA,IAAA,MAAWq/C;gBACT,OAAOzpD,IAAAA,CAAKgqD,MAAAA,CAAOP,GACrB;YAAA;YAKA,IAAA,IAAes0C,CAAAA,EAAAA;gBACb/9F,IAAAA,CAAKgqD,MAAAA,CAAOP,GAAAA,GAAMs0C,EAAO9rF,KAAAA;YAC3B;YAKA,IAAA,OAAkB8rF,CAAAA,EAAAA;gBAChB/9F,IAAAA,CAAK8Z,IAAAA,CAAKgxE,MAAAA,CAAO37E,KAAAA,CAAM4uF,EAAOzxF,CAAAA,EAAGyxF,EAAO3zF,CAAAA;YAC1C;YAKA,IAAA,SAAW0gF;gBACT,OAAO9qF,IAAAA,CAAK8Z,IAAAA,CAAKgxE,MACnB;YAAA;YAKA,IAAA,WAAWnoE;gBACT,OAAO3iB,IAAAA,CAAK+c,SAAAA,CAAU4F,QACxB;YAAA;YAKA,IAAA,SAAoBq7E,CAAAA,EAAAA;gBAClBh+F,IAAAA,CAAK+c,SAAAA,CAAU4F,QAAAA,GAAWq7E;YAC5B;YAKA,IAAA,kBAAWr0C;gBACT,OAAO3pD,IAAAA,CAAKgqD,MAAAA,CAAOL,eACrB;YAAA;YAKA,IAAA,gBAA2BA,CAAAA,EAAAA;gBACzB3pD,IAAAA,CAAKgqD,MAAAA,CAAOL,eAAAA,GAAkBA;YAChC;YAEA,IAAA,QAAW15C;gBACT,OAAOjQ,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB1iC,KACtC;YAAA;YAEA,IAAA,MAAiBA,CAAAA,EAAAA;gBACfjQ,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB1iC,KAAAA,GAAQA;YACvC;YAcA,IAAA,SAAW6B;gBACT,OAAO9R,IAAAA,CAAK4/C,OACd;YAAA;YAEA,IAAA,OAAkBlxC,CAAAA,EAAAA;gBAChB1O,IAAAA,CAAK4/C,OAAAA,GAAUh1B,GAAMlc,GAAMa,CAAAA,IAAMvP,IAAAA,CAAKi+F,mBAAAA,CAAoB1uF,KAC1DvP,IAAAA,CAAKi+F,mBAAAA,CAAoBvvF;YAC3B;YAEQ,oBAAoBa,CAAAA,EAAAA;gBACtBvP,IAAAA,CAAK8/C,QAAAA,IACP9/C,CAAAA,IAAAA,CAAK8/C,QAAAA,CAAShuC,MAAAA,GAASvC,CAAAA;YAE3B;YAQA,IAAA,SAAW0lB;gBACT,OAAOj1B,IAAAA,CAAK0/C,OACd;YAAA;YAEA,IAAA,OAAkBhxC,CAAAA,EAAAA;gBAChB1O,IAAAA,CAAK0/C,OAAAA,GAAU90B,GAAMlc,GAAMa,CAAAA,IAAMvP,IAAAA,CAAKk+F,mBAAAA,CAAoB3uF,KAC1DvP,IAAAA,CAAKk+F,mBAAAA,CAAoBxvF;YAC3B;YAEQ,oBAAoBa,CAAAA,EAAAA;gBACtBvP,IAAAA,CAAK8/C,QAAAA,IACP9/C,CAAAA,IAAAA,CAAK8/C,QAAAA,CAAS7qB,MAAAA,GAAS1lB,CAAAA;YAE3B;YAKA,IAAA,cAAW4uF;gBACT,OAAOn+F,IAAAA,CAAK4mD,MAAAA,CAAO;YACrB;YAiCA,IAAA,YAAWw3C;gBACT,OAAOp+F,IAAAA,CAAKq+F,UACd;YAAA;YAEA,IAAA,UAAqBC,CAAAA,EAAAA;gBACfA,KACEA,CAAAA,KAAAA,CAAgBt+F,IAAAA,CAAKq+F,UAAAA,GACvBr+F,CAAAA,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,oBAAoBzH,IAAAA,CAAKu+F,wBAAAA,GACxCv+F,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,kBAAkBzH,IAAAA,CAAKw+F,sBAAAA,GACtCx+F,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,mBAAmBzH,IAAAA,CAAKy+F,uBAAAA,GACvCz+F,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,oBAAoBzH,IAAAA,CAAK0+F,wBAAAA,CAAAA,IAAAA,CAC9BJ,KAAet+F,IAAAA,CAAKq+F,UAAAA,IAC9Br+F,CAAAA,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAI,oBAAoB7H,IAAAA,CAAKu+F,wBAAAA,GACzCv+F,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAI,kBAAkB7H,IAAAA,CAAKw+F,sBAAAA,GACvCx+F,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAI,mBAAmB7H,IAAAA,CAAKy+F,uBAAAA,GACxCz+F,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAI,oBAAoB7H,IAAAA,CAAK0+F,wBAAAA,CAAAA,GAG3C1+F,IAAAA,CAAKq+F,UAAAA,GAAaC,CAAAA;YAEtB;YAKA,IAAA,QAAW3qF;gBACT,OAAO3T,IAAAA,CAAK8/C,QAAAA,CAASnsC,KACvB;YAAA;YACA,IAAA,MAAiBpE,CAAAA,EAAAA;gBACfvP,IAAAA,CAAK8/C,QAAAA,CAASnsC,KAAAA,GAAQpE;YACxB;YAQA,YAAY27E,CAAAA,CAAAA;gBACVt+D,KAAAA,IA/SK,IAAA,CAAA1S,MAAAA,GAAS,IAAIhT,GAkLZ,IAAA,CAAA04C,OAAAA,GAAkBh1B,GAAM9c,EAAOG,IAAAA,EAAOsB,CAAAA,IAAMvP,IAAAA,CAAKi+F,mBAAAA,CAAoB1uF,KA2BrE,IAAA,CAAAmwC,OAAAA,GAAkB90B,GAAM9c,EAAOC,IAAAA,EAAOwB,CAAAA,IAAMvP,IAAAA,CAAKk+F,mBAAAA,CAAoB3uF,KA+BtE,IAAA,CAAAqa,MAAAA,GAAiBhT,EAAOS,WAAAA,IAKvB,IAAA,CAAAgnF,UAAAA,GAAAA,CAAsB,GACtB,IAAA,CAAAM,SAAAA,GAAAA,CAAqB,GAErB,IAAA,CAAAJ,wBAAAA,GAA2B;oBACjCv+F,IAAAA,CAAK2+F,SAAAA,GAAAA,CAAY;gBAAI,GAGf,IAAA,CAAAH,sBAAAA,GAAyB;oBAC/Bx+F,IAAAA,CAAK2+F,SAAAA,GAAAA,CAAY;gBAAK,GAGhB,IAAA,CAAAF,uBAAAA,GAA2BG,CAAAA;oBAC7B5+F,IAAAA,CAAK2+F,SAAAA,IACP3+F,CAAAA,IAAAA,CAAK6a,GAAAA,GAAM+jF,EAAGnpB,QAAAA,AAAAA;gBAChB,GAGM,IAAA,CAAAipB,wBAAAA,GAA4BE,CAAAA;oBAC9B5+F,IAAAA,CAAK2+F,SAAAA,IACP3+F,CAAAA,IAAAA,CAAK6a,GAAAA,GAAM+jF,EAAGnpB,QAAAA,AAAAA;gBAChB;gBA4CA,MAAA,EAAM,MACJhnD,CAAAA,EAAI,GACJniB,CAAAA,EAAC,GACDlC,CAAAA,EAAC,KACDyQ,CAAAA,EAAG,YACH64B,CAAAA,EAAU,OACVzjC,CAAAA,EAAK,OACLkK,CAAAA,EAAK,QACLE,CAAAA,EAAM,QACNuxB,CAAAA,EAAM,UACNkhC,CAAAA,EAAQ,KACRtjB,CAAAA,EAAG,KACHC,CAAAA,EAAG,UACH9mC,CAAAA,EAAQ,iBACRgnC,CAAAA,EAAe,GACf9gC,CAAAA,EAAC,OACDlV,CAAAA,EAAK,SACL6rC,CAAAA,EAAO,SACP52B,CAAAA,EAAO,QACP9W,CAAAA,EAAM,QACNmjB,CAAAA,EAAM,eACNy3C,CAAAA,EAAa,gBACbmE,CAAAA,EAAc,iBACdxqB,CAAAA,EAAAA,GACE;oBAAA,GACC6kC,CAAAA;gBAAAA;gBAGLlrF,IAAAA,CAAKyuB,IAAAA,GAAOA,QAAAA,IAAAA,IAAQzuB,IAAAA,CAAKyuB,IAAAA,EACzBzuB,IAAAA,CAAK8R,MAAAA,GAASA,QAAAA,IAAAA,IAAU03E,GAAMqV,QAAAA,CAAS/sF,MAAAA,CAAOG,KAAAA,IAC9CjS,IAAAA,CAAKi1B,MAAAA,GAASA,QAAAA,IAAAA,IAAUnnB,EAAOC,IAAAA,EAC/B/N,IAAAA,CAAK+c,SAAAA,GAAY,IAAI41B,IACrB3yC,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK+c,SAAAA,GACvB/c,IAAAA,CAAK6a,GAAAA,GAAMA,QAAAA,IAAAA,IAAOnM,EAAIpC,QAAAA,IAAAA,IAAK,GAAGlC,QAAAA,IAAAA,IAAK,IACnCpK,IAAAA,CAAK2iB,QAAAA,GAAWA,QAAAA,IAAAA,IAAY,GAC5B3iB,IAAAA,CAAKiQ,KAAAA,GAAQA,QAAAA,IAAAA,IAASvB,EAAI,GAAG,IAC7B1O,IAAAA,CAAK6oB,CAAAA,GAAIA,QAAAA,IAAAA,IAAK,GACd7oB,IAAAA,CAAK+c,SAAAA,CAAU22B,UAAAA,GAAaA,QAAAA,IAAAA,IAAc5E,GAAWqE,KAAAA,EACrDnzC,IAAAA,CAAK8+F,gBAAAA,GAAmBz4C,QAAAA,KAAAA,GAExBrmD,IAAAA,CAAK++F,OAAAA,GAAU,IAAIhS,IACnB/sF,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK++F,OAAAA,GAEvB/+F,IAAAA,CAAK8/C,QAAAA,GAAW,IAAIP,GAAkB;oBACpCztC,QAAQ9R,IAAAA,CAAK8R,MAAAA;oBACbmjB,QAAQj1B,IAAAA,CAAKi1B,MAAAA;oBACbrM,SAASA;gBAAAA,IAEX5oB,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8/C,QAAAA,GAEvB9/C,IAAAA,CAAKgqD,MAAAA,GAAS,IAAIT,IAClBvpD,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAKgqD,MAAAA,GACvBhqD,IAAAA,CAAKwpD,GAAAA,GAAMA,QAAAA,IAAAA,IAAO17C,EAAOC,IAAAA,EACzB/N,IAAAA,CAAKypD,GAAAA,GAAMA,QAAAA,IAAAA,IAAO37C,EAAOC,IAAAA,EACzB/N,IAAAA,CAAK2pD,eAAAA,GAAkBA,QAAAA,IAAAA,IAAmB,GAE1C3pD,IAAAA,CAAKg/F,OAAAA,GAAU,IAAIzI,IACnBv2F,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAKg/F,OAAAA,GAEvBh/F,IAAAA,CAAK8Z,IAAAA,GAAO,IAAI0yD,IAChBxsE,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8Z,IAAAA,GACvB9Z,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,GAAgBA,QAAAA,IAAAA,IAAiBjC,GAAcw0B,OAAAA,EACrDpuB,KACF7wE,CAAAA,IAAAA,CAAK8Z,IAAAA,CAAKoxD,KAAAA,GAAQ2F,CAAAA,GAGhBl9D,KACF3T,CAAAA,IAAAA,CAAK2T,KAAAA,GAAQA,CAAAA,GAGXm5D,IACF9sE,CAAAA,IAAAA,CAAK8sE,QAAAA,GAAW,IAAIkc,GAAkBlc,IACtC9sE,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8sE,QAAAA,CAAAA,IACdlhC,IACT5rC,CAAAA,IAAAA,CAAK8sE,QAAAA,GAAW,IAAIkc,GAAkBnD,GAAMgD,MAAAA,CAAOj9C,KACnD5rC,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8sE,QAAAA,GAEnBn5D,KACF3T,IAAAA,CAAK8/C,QAAAA,CAAS1vC,GAAAA,CACZ,IAAIy4E,GAAO;oBACTl1E,OAAOA;oBACPi4B,QAAAA;gBAAAA,GAAAA,IAKFzxB,IAAQ,KAAKE,IAAS,IACxBra,CAAAA,IAAAA,CAAK8sE,QAAAA,GAAW,IAAIkc,GAAkBnD,GAAM+C,GAAAA,CAAIzuE,GAAOE,GAAQra,IAAAA,CAAK8R,MAAAA,IACpE9R,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8sE,QAAAA,GAEnBn5D,KAASwG,KAASE,KACpBra,IAAAA,CAAK8/C,QAAAA,CAAS1vC,GAAAA,CACZ,IAAI08E,GAAU;oBACZn5E,OAAOA;oBACPwG,OAAAA;oBACAE,QAAAA;gBAAAA,GAAAA,IAKNra,CAAAA,IAAAA,CAAK8sE,QAAAA,GAAW,IAAIkc,IACpBhpF,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8sE,QAAAA,CAAAA,GAI3B9sE,IAAAA,CAAK8/C,QAAAA,CAASL,SAAAA,GAAYD,QAAAA,KAAAA;YAC5B;YAEO,QAAAvtC;gBACL,MAAMA,IAAQ,IAAIu3E,GAAM;oBACtBnjC,iBAAiBrmD,IAAAA,CAAK8+F,gBAAAA;oBACtBnrF,OAAO3T,IAAAA,CAAK2T,KAAAA,CAAM1B,KAAAA;oBAClBH,QAAQ9R,IAAAA,CAAK8R,MAAAA,CAAOG,KAAAA;oBACpBgjB,QAAQj1B,IAAAA,CAAKi1B,MAAAA,CAAOhjB,KAAAA;gBAAAA;gBAEtBA,EAAM22C,eAAAA,IACN32C,EAAM42C,uBAAAA,IAGN52C,EAAMq0C,YAAAA,CAAcr0C,EAAM8K,SAAAA,GAAY/c,IAAAA,CAAK+c,SAAAA,CAAU9K,KAAAA,IAAAA,CAAgC,IACrFA,EAAMq0C,YAAAA,CAAcr0C,EAAM8sF,OAAAA,GAAU/+F,IAAAA,CAAK++F,OAAAA,CAAQ9sF,KAAAA,IAAAA,CAA8B,IAC/EA,EAAMq0C,YAAAA,CAAcr0C,EAAM6tC,QAAAA,GAAW9/C,IAAAA,CAAK8/C,QAAAA,CAAS7tC,KAAAA,IAAAA,CAA+B,IAClFA,EAAMq0C,YAAAA,CAAcr0C,EAAM+3C,MAAAA,GAAShqD,IAAAA,CAAKgqD,MAAAA,CAAO/3C,KAAAA,IAAAA,CAA6B,IAC5EA,EAAMq0C,YAAAA,CAAcr0C,EAAM+sF,OAAAA,GAAUh/F,IAAAA,CAAKg/F,OAAAA,CAAQ/sF,KAAAA,IAAAA,CAA8B,IAC/EA,EAAMq0C,YAAAA,CAAcr0C,EAAM6H,IAAAA,GAAO9Z,IAAAA,CAAK8Z,IAAAA,CAAK7H,KAAAA,IAAAA,CAA2B,IACtEA,EAAMq0C,YAAAA,CAAcr0C,EAAM66D,QAAAA,GAAW9sE,IAAAA,CAAK8sE,QAAAA,CAAS76D,KAAAA,IAAAA,CAA+B;gBAElF,MAAMitF,IAAiC;oBACrCl/F,IAAAA,CAAK+c,SAAAA;oBACL/c,IAAAA,CAAK++F,OAAAA;oBACL/+F,IAAAA,CAAK8/C,QAAAA;oBACL9/C,IAAAA,CAAKgqD,MAAAA;oBACLhqD,IAAAA,CAAKg/F,OAAAA;oBACLh/F,IAAAA,CAAK8Z,IAAAA;oBACL9Z,IAAAA,CAAK8sE,QAAAA;iBAAAA,EAIDjnB,IAAa7lD,IAAAA,CAAKinD,aAAAA;gBACxB,KAAK,MAAMxyC,KAAKoxC,EACTq5C,EAAkBj+E,QAAAA,CAASxM,MAC9BxC,EAAMq0C,YAAAA,CAAa7xC,EAAExC,KAAAA,IAAAA,CAAS;gBAGlC,OAAOA;YACT;YAQO,aAAagI,CAAAA,EAAAA,CAEpB;YAQO,YAAYA,CAAAA,EAAAA;gBACjB2S,KAAAA,CAAMugB,YAAYlzB;gBAClB,KAAK,MAAM84B,KAAS/yC,IAAAA,CAAK6wC,QAAAA,CACvBkC,EAAM5F,WAAAA,CAAYlzB;YAEtB;YAKO,KAAwDvS,CAAAA,EAAuBU,CAAAA,EAAAA;gBACpFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAsDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBAClF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAuDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAUO,SAASq+C,CAAAA,EAAAA;gBACdhmD,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,WAAW,IAAIs5C,GAAazhD,IAAAA,IAC7CA,IAAAA,CAAKo/F,SAAAA,CAAUp5C;YACjB;YAOO,UAAUA,CAAAA,EAAAA,CAEjB;YAQO,UAAUA,CAAAA,EAAAA;gBACfhmD,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,YAAY,IAAIu5C,GAAc1hD,IAAAA,IAC/CA,IAAAA,CAAKs/F,UAAAA,CAAWt5C;YAClB;YAOO,WAAWA,CAAAA,EAAAA,CAElB;YAMO,OAAAQ;gBACDxmD,IAAAA,CAAKgmD,KAAAA,GACPhmD,CAAAA,IAAAA,CAAKm/F,QAAAA,CAASn/F,IAAAA,CAAKgmD,KAAAA,GACnBhmD,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ,IAAIq5C,GAAUxhD,IAAAA,IACvC4sB,KAAAA,CAAM45B,QACNxmD,IAAAA,CAAKq/F,SAAAA,CAAUr/F,IAAAA,CAAKgmD,KAAAA,CAAAA,IAEpBhmD,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,yBAAA,EAA4BrY,IAAAA,CAAKyuB,IAAAA,CAAAA,kCAAAA,CAAAA;YAEtD;YAKO,SAAA8wE;gBACLv/F,IAAAA,CAAKimD,QAAAA,GAAAA,CAAW;YAClB;YAKO,WAAAS;gBACL,OAAA,CAAQ1mD,IAAAA,CAAKimD,QACf;YAAA;YAMA,IAAA,IAAWp9B;gBACT,OAAO7oB,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB9pB,CACtC;YAAA;YAQA,IAAA,EAAa22E,CAAAA,EAAAA;gBACXx/F,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB9pB,CAAAA,GAAI22E;YACnC;YAKA,IAAA,SAAWljF;gBACT,MAAMw0B,IAAY9wC,IAAAA,CAAKy/F,YAAAA;gBACvB,OAAO,IAAI3xF,EACTgjC,EAAUxkC,CAAAA,GAAItM,IAAAA,CAAKma,KAAAA,GAAQ,IAAIna,IAAAA,CAAK8R,MAAAA,CAAOxF,CAAAA,GAAItM,IAAAA,CAAKma,KAAAA,EACpD22B,EAAU1mC,CAAAA,GAAIpK,IAAAA,CAAKqa,MAAAA,GAAS,IAAIra,IAAAA,CAAK8R,MAAAA,CAAO1H,CAAAA,GAAIpK,IAAAA,CAAKqa,MAAAA;YAEzD;YAKA,IAAA,cAAWqlF;gBACT,OAAO,IAAI5xF,EAAO9N,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,GAAItM,IAAAA,CAAKma,KAAAA,GAAQ,IAAIna,IAAAA,CAAK8R,MAAAA,CAAOxF,CAAAA,GAAItM,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,GAAIpK,IAAAA,CAAKqa,MAAAA,GAAS,IAAIra,IAAAA,CAAK8R,MAAAA,CAAO1H,CAAAA,GAAIpK,IAAAA,CAAKqa,MAAAA;YAClI;YAEA,IAAA,QAAWF;gBACT,OAAOna,IAAAA,CAAK8sE,QAAAA,CAAS5gD,WAAAA,CAAY/R,KAAAA,GAAQna,IAAAA,CAAK2/F,cAAAA,GAAiBrzF,CACjE;YAAA;YAEA,IAAA,SAAW+N;gBACT,OAAOra,IAAAA,CAAK8sE,QAAAA,CAAS5gD,WAAAA,CAAY7R,MAAAA,GAASra,IAAAA,CAAK2/F,cAAAA,GAAiBv1F,CAClE;YAAA;YAOO,oBAAAw1F;gBACL,OAAO5/F,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB1B,cACtC;YAAA;YAKA,IAAA,iBAAWA;gBACT,OAAOjxC,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB1B,cACtC;YAAA;YAOO,eAAAwuD;gBACL,OAAOz/F,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB7B,SACtC;YAAA;YAKA,IAAA,YAAWA;gBACT,OAAO9wC,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB7B,SACtC;YAAA;YAMO,iBAAA6uD;gBACL,OAAO3/F,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoBtC,WACtC;YAAA;YAKA,IAAA,cAAWA;gBACT,OAAOrwC,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoBtC,WACtC;YAAA;YAKA,IAAA,UAAWe;gBACT,OAAOpxC,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoBvB,OACtC;YAAA;YAUO,SAAS9kC,CAAAA,EAAWlC,CAAAA,EAAWy1F,IAAAA,CAAmB,CAAA,EAAA;gBACvD,MAAMjjF,IAAQlO,EAAIpC,GAAGlC,IACf0iE,IAAW9sE,IAAAA,CAAK2C,GAAAA,CAAIqmF;gBAC1Blc,EAASr/B,MAAAA;gBACT,MAAMqyD,IAAOhzB,EAASnqE,GAAAA;gBACtB,IAAA,CAAKm9F,GACH,OAAA,CAAO;gBAET,MAAMC,IAAcD,EAAK/gF,QAAAA,CAASnC;gBAElC,OAAIijF,IAEAE,KACA//F,IAAAA,CAAK6wC,QAAAA,CAASiyB,IAAAA,CAAM/vB,CAAAA,IACXA,EAAMh0B,QAAAA,CAASzS,GAAGlC,GAAAA,CAAG,MAK3B21F;YACT;YAOO,OAAO9I,CAAAA,EAAcpoF,CAAAA,EAAAA;gBAC1B,MAAMi+D,IAAW9sE,IAAAA,CAAK2C,GAAAA,CAAIqmF,KACpBiX,IAAgBhJ,EAAMt0F,GAAAA,CAAIqmF,KAC1BkX,IAAKpzB,EAASnqE,GAAAA,IACdsc,IAAQghF,EAAct9F,GAAAA;gBAC5B,OAAA,CAAA,CAAA,CAAIu9F,KAAAA,CAAMjhF,CAAAA,KACDihF,EAAGhqB,qBAAAA,CAAsBj3D,GAAOgxD,SAAAA,MAAephE;YAG1D;YAYO,OAAOoL,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAC5B92C,IAAAA,CAAKmtC,WAAAA,CAAYlzB,IACjBja,IAAAA,CAAKipD,IAAAA,CAAKhvC,IACVja,IAAAA,CAAKmpD,UAAAA,CAAWlvC,GAAQ68B,IACxB92C,IAAAA,CAAKqpD,WAAAA,CAAYpvC,GAAQ68B,IACzB92C,IAAAA,CAAKkpD,OAAAA,CAAQjvC;YACf;YASO,YAAYA,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEnC;YASO,aAAa78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEpC;YASO,sBAAsBr3C,CAAAA,EAAgBwf,CAAAA,EAAiBjE,CAAAA,EAAYmoC,CAAAA,EAAAA,CAE1E;YASO,uBAAuB1jD,CAAAA,EAAgBwf,CAAAA,EAAiBjE,CAAAA,EAAYmoC,CAAAA,EAAAA,CAE3E;YAUO,iBAAiB1jD,CAAAA,EAAgBwf,CAAAA,EAAiBjE,CAAAA,EAAYmoC,CAAAA,EAAAA,CAErE;YASO,eAAe1jD,CAAAA,EAAgBwf,CAAAA,EAAiBjE,CAAAA,EAAYuoC,CAAAA,EAAAA,CAEnE;YAUO,WAAWtpC,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAChC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,aAAa,IAAIg6C,GAAeloC,GAAQ68B,GAAS92C,IAAAA,IAClEA,IAAAA,CAAKopD,WAAAA,CAAYnvC,GAAQ68B;YAC3B;YAUO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACjC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBnoC,GAAQ68B,GAAS92C,IAAAA,IACpEA,IAAAA,CAAKspD,YAAAA,CAAarvC,GAAQ68B;YAC5B;QAAA;QC1iCK,SAASqpD,GAAgBlJ,CAAAA;YAC9B,OAAOA,aAAiBmJ;QAC1B;QDqPgB,GAAAvB,QAAAA,GAAW;YACvB/sF,QAAQhE,EAAOG,IAAAA;QAAAA;QChPZ,MAAMmyF,WAAsB5W;YAMjC,YAAY0B,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACVt+D,KAAAA,CAAM;oBAAA,GAAKs+D,CAAAA;gBAAAA,IACXlrF,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoBe,UAAAA,GAAa5E,GAAWykB,MAAAA,EACrDvzD,IAAAA,CAAK8R,MAAAA,GAAuB,SAAd,CAAA,IAAAo5E,QAAAA,IAAAA,KAAM,IAANA,EAAQp5E,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIpD,EAAI,GAAG,IACvC1O,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,GAAqC,SAArB,CAAA,IAAAwe,QAAAA,IAAAA,KAAM,IAANA,EAAQxe,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAIjC,GAAckC,gBAAAA,EACjE3sE,IAAAA,CAAK++F,OAAAA,CAAQ9R,iBAAAA,GAAAA,CAAoB,GACjCjtF,IAAAA,CAAK++F,OAAAA,CAAQ/R,gBAAAA,GAAAA,CAAmB,GAAA,CAC3B9B,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQpe,QAAAA,AAAAA,KAAAA,AAAYoe,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ/wE,KAAAA,AAAAA,IAAQ,KAAA,AAAK+wE,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ7wE,MAAAA,AAAAA,IAAS,KAC7Dra,IAAAA,CAAK8sE,QAAAA,CAASgd,cAAAA,CAAe9pF,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAKqa,MAAAA,EAAQra,IAAAA,CAAK8R,MAAAA;YAE/D;YAEO,YAAYmI,CAAAA,EAAAA;gBACjBja,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GACf2S,KAAAA,CAAMugB,YAAYlzB;YACpB;YAEO,SAAS3N,CAAAA,EAAWlC,CAAAA,EAAWi2F,IAAAA,CAAoB,CAAA,EAAA;gBACxD,IAAIA,GACF,OAAOzzE,KAAAA,CAAM7N,SAASzS,GAAGlC;gBAG3B,MAAMk2F,IAAStgG,IAAAA,CAAK2iE,OAAAA,CAAQ3J,wBAAAA,CAAyB,IAAIlrD,EAAOxB,GAAGlC;gBACnE,OAAOwiB,KAAAA,CAAM7N,SAASuhF,EAAOh0F,CAAAA,EAAGg0F,EAAOl2F,CAAAA;YACzC;QAAA;QCRK,MAAMm2F;YAwBX,IAAA,WAAWj9B;gBACT,OAAOtjE,IAAAA,CAAKwgG,SACd;YAAA;YAIA,YAAYvnF,CAAAA,CAAAA;gBAAAA,IAAAA;gBA7BJ,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAElB,IAAA,CAAAzX,EAAAA,GAAa,GAEZ,IAAA,CAAAg2F,YAAAA,GAAuB,GACvB,IAAA,CAAA6K,eAAAA,GAA0B,GAE1B,IAAA,CAAAC,QAAAA,GAAAA,CAAW,GAEX,IAAA,CAAAC,cAAAA,GAAyB,GAG1B,IAAA,CAAAC,QAAAA,GAAmB,IACnB,IAAA,CAAAC,OAAAA,GAAAA,CAAmB,GACnB,IAAA,CAAAC,kBAAAA,GAAAA,IACA,IAAA,CAAAC,WAAAA,GAAgC;oBAAC;oBAAG;iBAAA,EAEnC,IAAA,CAAAC,aAAAA,GAAgB,IAChB,IAAA,CAAAC,uBAAAA,GAA0B,IACzBjhG,IAAAA,CAAKghG,aAAAA,GAAgBhhG,IAAAA,CAAK2N,MAAAA,CAAOlD,OAAAA,CAAQzK,IAAAA,CAAK+gG,WAAAA,CAAY,EAAA,EAAI/gG,IAAAA,CAAK+gG,WAAAA,CAAY,EAAA,GAGhF,IAAA,CAAAP,SAAAA,GAAAA,CAAY,GAKb,IAAA,CAAAx6C,KAAAA,GAAe;gBAGpB,MAAMk7C,IAAoB,SAAd,CAAA,IAAAjoF,EAAQorC,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIprC,EAAQioF,GAAAA,EAChCN,IAAW3nF,EAAQ2nF,QAAAA,EACnBC,IAAU5nF,EAAQ4nF,OAAAA,EAClBM,IAAkBloF,EAAQkoF,eAAAA,EAC1BJ,IAAc9nF,EAAQ8nF,WAAAA,EACtBpzF,IAASsL,EAAQtL,MAAAA;gBAEvB,IAAMwzF,KAAmBA,KAAmB,KAC1CnhG,CAAAA,IAAAA,CAAK8gG,kBAAAA,GAAqBK,GAAAA,CACrBN,CAAAA,GACH,MAAM,IAAI16F,MAAM;gBAOpB,IAHAnG,IAAAA,CAAKJ,EAAAA,GAAK2gG,GAAMa,OAAAA,IAChBphG,IAAAA,CAAKqhG,UAAAA,GAAa,EAAA,EAClBrhG,IAAAA,CAAKghG,aAAAA,GAAgBhhG,IAAAA,CAAK4gG,QAAAA,GAAWA,GAC/BG,GAAa;oBACjB,IAAIA,CAAAA,CAAY,EAAA,GAAKA,CAAAA,CAAY,EAAA,EAC/B,MAAM,IAAI56F,MAAM;oBAGlBnG,IAAAA,CAAK2N,MAAAA,GAASA,QAAAA,IAAAA,IAAU,IAAI5E,GAC5B/I,IAAAA,CAAK+gG,WAAAA,GAAcA,GAEnB/gG,IAAAA,CAAK4gG,QAAAA,GAAW5gG,IAAAA,CAAKihG,uBAAAA,IACrBjhG,IAAAA,CAAKyH,EAAAA,CAAG;wBACNzH,IAAAA,CAAK4gG,QAAAA,GAAW5gG,IAAAA,CAAKihG,uBAAAA;oBAAyB;gBAElD;gBACAjhG,IAAAA,CAAK6gG,OAAAA,GAAUA,KAAW7gG,IAAAA,CAAK6gG,OAAAA,EAC3BK,KACFlhG,IAAAA,CAAKyH,EAAAA,CAAGy5F;YAEZ;YAMO,GAAG78C,CAAAA,EAAAA;gBACRrkD,IAAAA,CAAKqhG,UAAAA,CAAW1hG,IAAAA,CAAK0kD;YACvB;YAMO,IAAIA,CAAAA,EAAAA;gBACT,MAAM74C,IAAQxL,IAAAA,CAAKqhG,UAAAA,CAAW54F,OAAAA,CAAQ47C;gBACtCrkD,IAAAA,CAAKqhG,UAAAA,CAAW34F,MAAAA,CAAO8C,GAAO;YAChC;YAKO,OAAOsrC,CAAAA,EAAAA;gBACR92C,IAAAA,CAAK0gG,QAAAA,IACP1gG,CAAAA,IAAAA,CAAKygG,eAAAA,IAAmB3pD,GACxB92C,IAAAA,CAAK41F,YAAAA,IAAgB9+C,GAEjB92C,IAAAA,CAAK8gG,kBAAAA,GAAAA,MAA2B9gG,IAAAA,CAAK2gG,cAAAA,IAAkB3gG,IAAAA,CAAK8gG,kBAAAA,IAC9D9gG,CAAAA,IAAAA,CAAKwgG,SAAAA,GAAAA,CAAY,GACjBxgG,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GAChB1gG,IAAAA,CAAK41F,YAAAA,GAAe,CAAA,GAAA,CAGjB51F,IAAAA,CAAKsjE,QAAAA,IAAYtjE,IAAAA,CAAK41F,YAAAA,IAAgB51F,IAAAA,CAAK4gG,QAAAA,IAC9C5gG,CAAAA,IAAAA,CAAKqhG,UAAAA,CAAWljD,OAAAA,CAAS1pC,CAAAA;oBACvBA,EAAEzR,IAAAA,CAAKhD,IAAAA;gBAAK,IAEdA,IAAAA,CAAK2gG,cAAAA,IACD3gG,IAAAA,CAAK6gG,OAAAA,IAGP7gG,CAAAA,IAAAA,CAAKwgG,SAAAA,GAAAA,CAAY,GACjBxgG,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,CAAA,GAHhB1gG,IAAAA,CAAK41F,YAAAA,GAAe,CAAA,CAAA;YAQ5B;YASO,MAAM0L,CAAAA,EAAsBC,CAAAA,EAAAA;gBAKjC,IAJMD,KAAeA,KAAe,KAClCthG,CAAAA,IAAAA,CAAKghG,aAAAA,GAAgBhhG,IAAAA,CAAK4gG,QAAAA,GAAWU,CAAAA,GAGjCthG,IAAAA,CAAK8gG,kBAAAA,IAAsB9gG,IAAAA,CAAK8gG,kBAAAA,IAAsB,KAC1D9gG,CAAAA,IAAAA,CAAK8gG,kBAAAA,GAAqBS,GAAAA,CACrBvhG,IAAAA,CAAK6gG,OAAAA,AAAAA,GACR,MAAM,IAAI16F,MAAM;gBAIpBnG,IAAAA,CAAKwgG,SAAAA,GAAAA,CAAY,GACjBxgG,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK2gG,cAAAA,GAAiB;YACxB;YAEA,IAAA,gBAAWa;gBACT,OAAOxhG,IAAAA,CAAK2gG,cACd;YAAA;YAEO,iBAAAc;gBACL,OAAOzhG,IAAAA,CAAKygG,eACd;YAAA;YAKA,IAAA,mBAAWiB;gBACT,OAAI1hG,IAAAA,CAAKsjE,QAAAA,GACA,IAEFtjE,IAAAA,CAAK4gG,QAAAA,GAAW5gG,IAAAA,CAAK41F,YAC9B;YAAA;YAKA,IAAA,8BAAW+L;gBACT,OAAO3hG,IAAAA,CAAK41F,YACd;YAAA;YAEA,IAAA,YAAWgM;gBACT,OAAO5hG,IAAAA,CAAK0gG,QACd;YAAA;YAKO,QAAA93F;gBAEL,OADA5I,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GACT1gG,IACT;YAAA;YAKO,SAAAk8D;gBAEL,OADAl8D,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GACT1gG,IACT;YAAA;YAKO,QAAAgF;gBAYL,OAXKhF,IAAAA,CAAKgmD,KAAAA,IACRhmD,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,2EAGpBrY,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GACZ1gG,IAAAA,CAAKsjE,QAAAA,IACPtjE,CAAAA,IAAAA,CAAKwgG,SAAAA,GAAAA,CAAY,GACjBxgG,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK2gG,cAAAA,GAAiB,CAAA,GAGjB3gG,IACT;YAAA;YAKO,OAAAigE;gBAIL,OAHAjgE,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GAChB1gG,IAAAA,CAAK41F,YAAAA,GAAe,GACpB51F,IAAAA,CAAK2gG,cAAAA,GAAiB,GACf3gG,IACT;YAAA;YAKO,SAAAy9E;gBACLz9E,IAAAA,CAAK4I,KAAAA,IACD5I,IAAAA,CAAKgmD,KAAAA,IACPhmD,IAAAA,CAAKgmD,KAAAA,CAAM67C,WAAAA,CAAY7hG,IAAAA;YAE3B;QAAA;QAzNe,GAAAohG,OAAAA,GAAkB;QCvC5B,MAAMU,WAA0BnwD;YAGrC,YAAYowD,CAAAA,CAAAA;gBACVn1E,KAAAA,IAHF,IAAA,CAAAm1E,cAAAA,GAAiBrzF,EAAI,GAAK,IAIxB1O,IAAAA,CAAK+hG,cAAAA,GAAiBA,QAAAA,IAAAA,IAAkB/hG,IAAAA,CAAK+hG,cAC/C;YAAA;QAAA;QCCK,MAAMC,WAA+BrwD;YAC1C,YACS9xB,CAAAA,EACAoiF,IAAAA,CAAe,CAAA,CAAA;gBAEtBr1E,KAAAA,IAHO,IAAA,CAAA/M,IAAAA,GAAAA,GACA,IAAA,CAAAoiF,YAAAA,GAAAA;YAGT;QAAA;QCEF,SAASC,GAAgBnhF,CAAAA;YACvB,OAAOA,KAAUA,EAAOohF,sBAAAA,IAA0BphF,EAAOqhF,uBAC3D;QAAA;QAEO,MAAMC;YAIX,IAAA,SAAWnoF;gBACT,OAAOla,IAAAA,CAAK+gB,MAAAA,CAAO7G,MACrB;YAAA;YACO,KAAK6G,CAAAA,EAAiBhC,CAAAA,EAAiDwnC,CAAAA,EAAAA;gBAC5EvmD,IAAAA,CAAK+gB,MAAAA,GAASA,GACd/gB,IAAAA,CAAK+e,QAAAA,GAAWA,GAChB/e,IAAAA,CAAKumD,MAAAA,GAASA;YAChB;QAAA;QAGK,MAAMg8C;YAAb,aAAA;gBACU,IAAA,CAAAC,UAAAA,GAAa,IAAI/6E,EACvB,IAAM,IAAI46E,IACT/rF,CAAAA,IAAMA,GACP,MAEM,IAAA,CAAAmsF,cAAAA,GAAiB,IAAIn0E,KACrB,IAAA,CAAAo0E,QAAAA,GAAgD,EAAA,EAqChD,IAAA,CAAAC,0BAAAA,GAA6B,IAAIr0E,KACjC,IAAA,CAAAs0E,6BAAAA,GAAgC,IAAIt0E;YAyM9C;YAvOS,UAAUvN,CAAAA,EAAiBhC,CAAAA,EAAiDwnC,CAAAA,EAAAA;gBACjF,MAAMu8C,IAAQ9iG,IAAAA,CAAKwiG,UAAAA,CAAWv6E,IAAAA,CAAAA,CAAK;gBACnC66E,EAAMR,IAAAA,CAAKvhF,GAAQhC,GAAUwnC,IAC7BvmD,IAAAA,CAAK0iG,QAAAA,CAAS/iG,IAAAA,CAAKmjG,IACnB9iG,IAAAA,CAAKyiG,cAAAA,CAAez3E,GAAAA,CAAIjK,GAAQ+hF;YAClC;YAEQ,UAAU/hF,CAAAA,EAAAA;gBAChB,MAAM+hF,IAAQ9iG,IAAAA,CAAKyiG,cAAAA,CAAe9/F,GAAAA,CAAIoe;gBACtC,IAAI+hF,GACF,OAAOA;gBAET,MAAM,IAAI38F,MAAM;YAClB;YAMO,aAAa4a,CAAAA,EAAAA;gBAClB,MAAM+hF,IAAQ9iG,IAAAA,CAAKyiG,cAAAA,CAAe9/F,GAAAA,CAAIoe;gBACtC,IAAI+hF,GAAO;oBACT,MAAMt3F,IAAQxL,IAAAA,CAAK0iG,QAAAA,CAASj6F,OAAAA,CAAQq6F;oBAChCt3F,IAAAA,MACFxL,IAAAA,CAAK0iG,QAAAA,CAASh6F,MAAAA,CAAO8C,GAAO,IAE9BxL,IAAAA,CAAKwiG,UAAAA,CAAW/5E,MAAAA,CAAOq6E;gBACzB;YACF;YAGQ,6BAA6B/hF,CAAAA,EAAuCmiF,CAAAA,EAAAA;gBAC1E,OAAA,CAAA,CAAA,CAAUljG,IAAAA,CAAK4iG,6BAAAA,CAA8B7qF,GAAAA,CAAIgJ,MAAAA,CAAW/gB,IAAAA,CAAK4iG,6BAAAA,CAA8BjgG,GAAAA,CAAIoe,GAASE,QAAAA,CAASiiF,EAAAA;YACvH;YAEQ,uBAAuBniF,CAAAA,EAAuCmiF,CAAAA,EAAAA;gBACpE,OAAA,CAAA,CAAA,CAAUljG,IAAAA,CAAK2iG,0BAAAA,CAA2B5qF,GAAAA,CAAIgJ,MAAAA,CAAW/gB,IAAAA,CAAK2iG,0BAAAA,CAA2BhgG,GAAAA,CAAIoe,GAASE,QAAAA,CAASiiF,EAAAA;YACjH;YAEQ,SAASniF,CAAAA,EAAuCmiF,CAAAA,EAAAA;gBACtD,OAAOljG,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQmiF,MAAAA,CAAeljG,IAAAA,CAAK2iG,0BAAAA,CAA2B5qF,GAAAA,CAAIgJ;YACtG;YAEQ,MAAMA,CAAAA,EAAuCmiF,CAAAA,EAAAA;gBACnD,OAAA,CAAQljG,IAAAA,CAAK4iG,6BAAAA,CAA8B7qF,GAAAA,CAAIgJ,MAAW/gB,IAAAA,CAAKmjG,sBAAAA,CAAuBpiF,GAAQmiF;YAChG;YAOO,mBAAmBniF,CAAAA,EAAiBmiF,CAAAA,EAAAA;gBACzC,MAAMI,IAAatjG,IAAAA,CAAKyiG,cAAAA,CAAe9/F,GAAAA,CAAIoe;gBACvCuiF,KACFtjG,IAAAA,CAAKujG,kBAAAA,CAAmBD,GAAYJ;YAExC;YAEQ,mBAAmBniF,CAAAA,EAAuCmiF,CAAAA,EAAAA;gBAChE,IAAA,CAAKljG,IAAAA,CAAK4iG,6BAAAA,CAA8B7qF,GAAAA,CAAIgJ,IAE1C,OAAA,KADA/gB,IAAAA,CAAK4iG,6BAAAA,CAA8B53E,GAAAA,CAAIjK,GAAQ;oBAACmiF;iBAAAA;gBAGlD,MAAMM,IAAWxjG,IAAAA,CAAK4iG,6BAAAA,CAA8BjgG,GAAAA,CAAIoe;gBACxD/gB,IAAAA,CAAK4iG,6BAAAA,CAA8B53E,GAAAA,CAAIjK,GAAQyiF,EAASnjG,MAAAA,CAAO6iG;YACjE;YAOO,eAAeQ,CAAAA,EAAgCC,CAAAA,EAAAA;gBACpD,MAAMC,IAAoB,IAAI3sF,IAAIjX,IAAAA,CAAK2iG,0BAAAA,CAA2Bp8F,IAAAA,KAC5Ds9F,IAAuB,IAAI5sF,IAAIjX,IAAAA,CAAK4iG,6BAAAA,CAA8Br8F,IAAAA;gBAExE,IAAIu9F,GACAC,GACAC;gBAEJ,IAAK,IAAIxjG,IAAI,GAAGA,IAAImjG,EAAcrjG,MAAAA,EAAQE,IAAK;oBAC7C,MAAMugB,IAAS4iF,CAAAA,CAAcnjG,EAAAA,EACvBsiG,IAAQ9iG,IAAAA,CAAK+iG,SAAAA,CAAUhiF;oBAI7B,IAHImhF,GAAgBnhF,MAClBA,EAAOohF,sBAAAA,CAAuBuB,IAE5BE,EAAkB7rF,GAAAA,CAAI+qF,MAAUe,EAAqB9rF,GAAAA,CAAI+qF,IAAQ;wBACnEkB,IAAqBhkG,IAAAA,CAAKikG,mBAAAA,CAAoBP,GAAUZ,IAExDiB,IAAmB/jG,IAAAA,CAAKkkG,iBAAAA,CAAkBR,GAAUZ,IAEpDgB,IAAqB9jG,IAAAA,CAAKmkG,mBAAAA,CAAoBT,GAAUZ;wBAExD,MAAMsB,IAAuB;+BAAIN,EAAmB58C,MAAAA;+BAAa88C,EAAmB98C,MAAAA;+BAAa68C,EAAiB78C,MAAAA;yBAAAA;wBAClHlnD,IAAAA,CAAKqkG,yBAAAA,CAA0BX,GAAUZ,GAAOsB,IAEhDpkG,IAAAA,CAAKskG,qBAAAA,CAAsBZ,GAAUZ,IAErC9iG,IAAAA,CAAKukG,oBAAAA,CAAqBb,GAAUZ;oBACtC;gBACF;YACF;YAOO,uBAAuBY,CAAAA,EAAgCz3D,CAAAA,EAAAA;gBAE5D,IAAK,IAAIw4D,IAAc,GAAGA,IAAcx4D,EAAQ3rC,MAAAA,EAAQmkG,IAAe;oBACrE,MAAM1jF,IAASkrB,CAAAA,CAAQw4D,EAAAA,EACjB3B,IAAQ9iG,IAAAA,CAAK+iG,SAAAA,CAAUhiF;oBACzBmhF,GAAgBnhF,MAClBA,EAAOqhF,uBAAAA,CAAwBsB;oBAEjC,KAAK,MAAA,CAAOR,GAAWroF,EAAAA,IAAQ6oF,EAASgB,yBAAAA,CAA0Bx2D,OAAAA,GAC5D40D,EAAM/jF,QAAAA,CAASlE,MACjB7a,IAAAA,CAAKujG,kBAAAA,CAAmBT,GAAOI;gBAGrC;YACF;YAKO,QAAA17F;gBACLxH,IAAAA,CAAK2iG,0BAAAA,CAA2Bn7F,KAAAA,IAChCxH,IAAAA,CAAK2iG,0BAAAA,GAA6B,IAAIr0E,IAA6CtuB,IAAAA,CAAK4iG,6BAAAA,GACxF5iG,IAAAA,CAAK4iG,6BAAAA,CAA8Bp7F,KAAAA;YACrC;YAEQ,oBAAoBk8F,CAAAA,EAAgC3iF,CAAAA,EAAAA;gBAC1D,MAAMijF,IAAqB,IAAI11E;gBAE/B,KAAK,MAAMlmB,KAASs7F,EAASiB,gBAAAA,CACvBv8F,EAAMm+C,MAAAA,IAAUvmD,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ3Y,EAAM86F,SAAAA,KAClEniF,CAAAA,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,eAAeC,IAC9Bs7F,EAASkB,WAAAA,CAAYx8F,EAAM86F,SAAAA,KAC7BniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,oBAAoBC,EAAAA,GAG3C47F,EAAmBh5E,GAAAA,CAAI5iB,EAAM86F,SAAAA,EAAW96F;gBAE1C,OAAO47F;YACT;YAEQ,kBAAkBN,CAAAA,EAAgC3iF,CAAAA,EAAAA;gBACxD,MAAMgjF,IAAmB,IAAIz1E;gBAE7B,KAAK,MAAMlmB,KAASs7F,EAASmB,cAAAA,CACvBz8F,EAAMm+C,MAAAA,IAAUvmD,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ3Y,EAAM86F,SAAAA,KAClEniF,CAAAA,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,aAAaC,IAC5Bs7F,EAASoB,SAAAA,CAAU18F,EAAM86F,SAAAA,KAC3BniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,kBAAkBC,EAAAA,GAGzC27F,EAAiB/4E,GAAAA,CAAI5iB,EAAM86F,SAAAA,EAAW96F;gBAExC,OAAO27F;YACT;YAEQ,oBAAoBL,CAAAA,EAAgC3iF,CAAAA,EAAAA;gBAC1D,MAAM+iF,IAAqB,IAAIx1E;gBAE/B,KAAK,MAAMlmB,KAASs7F,EAASqB,gBAAAA,CACvB38F,EAAMm+C,MAAAA,IAAUxlC,EAAOwlC,MAAAA,MAAYvmD,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ3Y,EAAM86F,SAAAA,KAErFniF,CAAAA,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,eAAeC,IAE9Bs7F,EAASsB,UAAAA,CAAW58F,EAAM86F,SAAAA,KAC5BniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,mBAAmBC,EAAAA,GAG1C07F,EAAmB94E,GAAAA,CAAI5iB,EAAM86F,SAAAA,EAAW96F;gBAE1C,OAAO07F;YACT;YAEQ,0BACNJ,CAAAA,EACA3iF,CAAAA,EACAqjF,CAAAA,EAAAA;gBAGA,KAAK,MAAMh8F,KAASg8F,EAAsB;oBAExC,IAAIh8F,EAAMm+C,MAAAA,IAAUxlC,EAAOwlC,MAAAA,MAAYvmD,IAAAA,CAAKojG,QAAAA,CAASriF,GAAQ3Y,EAAM86F,SAAAA,GAAY;wBAC7EniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgBC,IAC/Bs7F,EAASsB,UAAAA,CAAW58F,EAAM86F,SAAAA,KAC5BniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,oBAAoBC;wBAEzC;oBACF;oBACA,IACEA,EAAMm+C,MAAAA,IACNxlC,EAAOwlC,MAAAA,MAENvmD,CAAAA,IAAAA,CAAK4d,KAAAA,CAAMmD,GAAQ3Y,EAAM86F,SAAAA,KAEvBljG,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ3Y,EAAM86F,SAAAA,KAA6B,SAAf96F,EAAM3B,IAAAA,AAAAA,GACvE;wBACAsa,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgBC,IAC/Bs7F,EAASsB,UAAAA,CAAW58F,EAAM86F,SAAAA,KAC5BniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,oBAAoBC;wBAEzC;oBACF;gBACF;YACF;YAEQ,sBAAsBs7F,CAAAA,EAAgC3iF,CAAAA,EAAAA;gBAE5D,KAAK,MAAM3Y,KAASs7F,EAASuB,kBAAAA,CACvB78F,EAAMm+C,MAAAA,IAAUxlC,EAAOwlC,MAAAA,MAAYvmD,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ3Y,EAAM86F,SAAAA,KACrFniF,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,iBAAiBC;YAG1C;YAEQ,qBAAqBs7F,CAAAA,EAAgC3iF,CAAAA,EAAAA;gBAE3D,KAAK,MAAM3Y,KAASs7F,EAASwB,iBAAAA,CAEvB98F,EAAMm+C,MAAAA,IAAUxlC,EAAOwlC,MAAAA,MAAYvmD,IAAAA,CAAKijG,4BAAAA,CAA6BliF,GAAQ,MAC/EA,EAAO7G,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgBC;YAGzC;QAAA;QCpMK,MAAM+8F,KAAgB;YAC3BlgD,WAAW;YACXC,YAAY;YACZq3C,SAAS;YACTC,UAAU;YACVK,WAAW;YACXC,aAAa;YACbG,aAAa;YACbC,eAAe;QAAA;QAQV,MAAMkI,WAAgBhgD;YAoBpB,qBAAAigD;gBACLrlG,IAAAA,CAAKslG,eAAAA,GAAAA,CAAkB;YACzB;YAEO,iBAAAC;gBACL,IAAK,IAAI/kG,IAAI,GAAGA,IAAIR,IAAAA,CAAKwlG,KAAAA,CAAMllG,MAAAA,EAAQE,IACjCR,IAAAA,CAAKwlG,KAAAA,CAAMhlG,EAAAA,IACbR,IAAAA,CAAKwlG,KAAAA,CAAMhlG,EAAAA,CAAGwvC,SAAAA;YAGpB;YASA,IAAA,IAAW1jC;gBAAAA,IAAAA;gBACT,OAA2B,SAApB,CAAA,IAAAtM,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,CAAIvO,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI;YACjC;YAEA,IAAA,EAAaG,CAAAA,EAAAA;gBAAAA,IAAAA;gBACO,CAAA,SAAd,CAAA,IAAAzM,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAElC,GAAAA,AAAAA,KAClB7a,CAAAA,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB93B,GAAAA,GAAMnM,EAAIjC,GAAKzM,IAAAA,CAAKoK,CAAAA,CAAAA;YAErD;YAEA,IAAA,IAAWA;gBAAAA,IAAAA,GAAAA;gBACT,OAA4B,SAArB,CAAA,IAAc,SAAd,CAAA,IAAApK,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAElC,GAAAA,CAAIzQ,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI;YAClC;YAEA,IAAA,EAAaqC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACO,CAAA,SAAd,CAAA,IAAAzM,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAElC,GAAAA,AAAAA,KAClB7a,CAAAA,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAKsM,CAAAA,EAAGG,EAAAA;YAErC;YAEA,IAAA,IAAWoc;gBAAAA,IAAAA;gBACT,OAAuB,SAAhB,CAAA,IAAA7oB,IAAAA,CAAK+c,SAAAA,CAAU8L,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI;YAC7B;YAEA,IAAA,EAAapc,CAAAA,EAAAA;gBACPzM,IAAAA,CAAK+c,SAAAA,IACP/c,CAAAA,IAAAA,CAAK+c,SAAAA,CAAU8L,CAAAA,GAAIpc,CAAAA;YAEvB;YAGA,IAAA,WAAWkW;gBAAAA,IAAAA,GAAAA;gBACT,OAA+B,SAAxB,CAAA,IAAc,SAAd,CAAA,IAAA3iB,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE4F,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI;YACrC;YAEA,IAAA,SAAoBlW,CAAAA,EAAAA;gBACdzM,IAAAA,CAAK+c,SAAAA,IACP/c,CAAAA,IAAAA,CAAK+c,SAAAA,CAAU4F,QAAAA,GAAWlW,CAAAA;YAE9B;YAGA,IAAA,QAAWwD;gBAAAA,IAAAA,GAAAA;gBACT,OAA4B,SAArB,CAAA,IAAc,SAAd,CAAA,IAAAjQ,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE9M,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAInC,EAAOE,GACzC;YAAA;YAEA,IAAA,MAAiBvB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACG,CAAA,SAAd,CAAA,IAAAzM,IAAAA,CAAK+c,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE9M,KAAAA,AAAAA,KAClBjQ,CAAAA,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,GAAQxD,CAAAA;YAE3B;YAGA,IAAA,MAAWoO;gBACT,OAAO7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GACxB;YAAA;YAEA,IAAA,IAAepO,CAAAA,EAAAA;gBACbzM,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMpO;YACvB;YAEA,IAAA,MAAW+8C;gBACT,OAAOxpD,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GACtB;YAAA;YAEA,IAAA,IAAe/8C,CAAAA,EAAAA;gBACbzM,IAAAA,CAAK8wF,OAAAA,CAAQtnC,GAAAA,GAAM/8C;YACrB;YAKA,IAAA,QAAW0N;gBACT,OAAOna,IAAAA,CAAKylG,SAAAA,GAAYzlG,IAAAA,CAAK+1B,OAAAA,GAAU/1B,IAAAA,CAAKiQ,KAAAA,CAAM3D,CACpD;YAAA;YAKA,IAAA,SAAW+N;gBACT,OAAOra,IAAAA,CAAK0lG,UAAAA,GAAa1lG,IAAAA,CAAK81B,IAAAA,GAAO91B,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAClD;YAAA;YAIO,KAA0D1C,CAAAA,EAAuBU,CAAAA,EAAAA;gBACtFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAwDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAA0DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACtF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAKA,YAAYsR,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,CAAM,EAAA,EAAI3T,EAAQwV,IAAAA,GAtJb,IAAA,CAAAvU,MAAAA,GAAS,IAAIhT,GACZ,IAAA,CAAAy+F,MAAAA,GAAS,GAGV,IAAA,CAAA/7E,MAAAA,GAAiBhT,EAAOS,WAAAA,IACf,IAAA,CAAAmuF,KAAAA,GAAgB,EAAA,EACxB,IAAA,CAAAI,KAAAA,GAAkB,EAAA,EAClB,IAAA,CAAAC,KAAAA,GAAkB,EAAA,EAOnB,IAAA,CAAAC,sBAAAA,GAAAA,CAAyB,GACzB,IAAA,CAAAC,iBAAAA,GAAoB,IAEnB,IAAA,CAAAT,eAAAA,GAAAA,CAAkB,GAmDlB,IAAA,CAAAU,YAAAA,GAAuB,GAiKvB,IAAA,CAAAC,gBAAAA,GAAmB,IAAIC,SA9E7BlmG,IAAAA,CAAK+lG,iBAAAA,GAA6C,SAAzB,CAAA,IAAA9sF,EAAQ8sF,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,IAAA,IAAI/lG,IAAAA,CAAK+lG,iBAAAA,EAC3D/lG,IAAAA,CAAKsmD,YAAAA,CAAa,IAAI3T,KACtB3yC,IAAAA,CAAKsmD,YAAAA,CAAa,IAAIiD,KACtBvpD,IAAAA,CAAKsmD,YAAAA,CACH,IAAIkmB,GAAc;oBAChB/lE,MAAMgkE,GAAc1V,KAAAA;gBAAAA,KAGxB/0D,IAAAA,CAAKsmD,YAAAA,CACH,IAAI/G,GAAkB;oBACpBa,YAAY,CAAChpB,GAAK0f,IAAY92C,IAAAA,CAAK6f,IAAAA,CAAKuX,GAAK0f;gBAAAA,KAGjD92C,IAAAA,CAAKsmD,YAAAA,CAAa,IAAI07C,GAAuB,CAAC5qE,GAAK+uE,IAAenmG,IAAAA,CAAKgY,KAAAA,CAAMof,GAAK+uE,IAAAA,CAAa,KAC/FnmG,IAAAA,CAAKsmD,YAAAA,CAAa,IAAI0iC,KACtBhpF,IAAAA,CAAKsmD,YAAAA,CAAa,IAAIymC,KACtB/sF,IAAAA,CAAK++F,OAAAA,GAAU/+F,IAAAA,CAAK2C,GAAAA,CAAIoqF,KACxB/sF,IAAAA,CAAKggD,SAAAA,GAAYhgD,IAAAA,CAAK2C,GAAAA,CAAI48C,KAC1Bv/C,IAAAA,CAAK+c,SAAAA,GAAY/c,IAAAA,CAAK2C,GAAAA,CAAIgwC,KAC1B3yC,IAAAA,CAAK8wF,OAAAA,GAAU9wF,IAAAA,CAAK2C,GAAAA,CAAI4mD,KACxBvpD,IAAAA,CAAK8sE,QAAAA,GAAW9sE,IAAAA,CAAK2C,GAAAA,CAAIqmF,KACzBhpF,IAAAA,CAAKomG,UAAAA,GAAapmG,IAAAA,CAAK8sE,QAAAA,CAASqd,oBAAAA,CAAqB,EAAA,GAErDnqF,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAiB,SAAX,CAAA,IAAA5B,EAAQ4B,GAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI/M,EAAOC,IAAAA,EAC3C/N,IAAAA,CAAKqmG,OAAAA,GAAUrmG,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,CAAI5I,KAAAA,IAClCjS,IAAAA,CAAKsmG,SAAAA,GAAYtmG,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,CAAMgC,KAAAA,IACtCjS,IAAAA,CAAK8lG,sBAAAA,GAAuD,SAA9B,CAAA,IAAA7sF,EAAQ6sF,sBAAAA,AAAAA,KAAAA,KAAsB,MAAA,IAAA,IAAI9lG,IAAAA,CAAK8lG,sBAAAA,EACrE9lG,IAAAA,CAAKylG,SAAAA,GAAYxsF,EAAQwsF,SAAAA,EACzBzlG,IAAAA,CAAK0lG,UAAAA,GAAazsF,EAAQysF,UAAAA,EAC1B1lG,IAAAA,CAAK81B,IAAAA,GAAO7c,EAAQ6c,IAAAA,EACpB91B,IAAAA,CAAK+1B,OAAAA,GAAU9c,EAAQ8c,OAAAA,EAEvB/1B,IAAAA,CAAKumG,uBAAAA,GAA0B,IAAIhE,IAEnCviG,IAAAA,CAAKwlG,KAAAA,GAAQ,IAAIz7F,MAAY/J,IAAAA,CAAK81B,IAAAA,GAAO91B,IAAAA,CAAK+1B,OAAAA,GAC9C/1B,IAAAA,CAAK4lG,KAAAA,GAAQ,IAAI77F,MAAM/J,IAAAA,CAAK81B,IAAAA,GAC5B91B,IAAAA,CAAK6lG,KAAAA,GAAQ,IAAI97F,MAAM/J,IAAAA,CAAK+1B,OAAAA;gBAC5B,IAAIywE,IAAqB,EAAA;gBACzB,IAAK,IAAIhmG,IAAI,GAAGA,IAAIR,IAAAA,CAAK+1B,OAAAA,EAASv1B,IAAK;oBACrC,IAAK,IAAIkxE,IAAI,GAAGA,IAAI1xE,IAAAA,CAAK81B,IAAAA,EAAM47C,IAAK;wBAClC,MAAM+0B,IAAO,IAAIC,GAAK;4BACpBp6F,GAAG9L;4BACH4J,GAAGsnE;4BACHzxE,KAAKD,IAAAA;wBAAAA;wBAEPymG,EAAKxmG,GAAAA,GAAMD,IAAAA,EACXA,IAAAA,CAAKwlG,KAAAA,CAAMhlG,IAAIkxE,IAAI1xE,IAAAA,CAAK+1B,OAAAA,CAAAA,GAAW0wE,GACnCzmG,IAAAA,CAAKumG,uBAAAA,CAAwB1D,SAAAA,CAC3B4D,GACC/3F,CAAAA,IAEQ+3F,EAAKzxE,MAAAA,CAAOjW,QAAAA,CAASrQ,EAAI+mE,QAAAA,GAElC,IAAA,CAAM,IAER+wB,EAAW7mG,IAAAA,CAAK8mG,IACXzmG,IAAAA,CAAK4lG,KAAAA,CAAMl0B,EAAAA,IACd1xE,CAAAA,IAAAA,CAAK4lG,KAAAA,CAAMl0B,EAAAA,GAAK,EAAA,AAAA,GAElB1xE,IAAAA,CAAK4lG,KAAAA,CAAMl0B,EAAAA,CAAG/xE,IAAAA,CAAK8mG;oBACrB;oBACAzmG,IAAAA,CAAK6lG,KAAAA,CAAMrlG,EAAAA,GAAKgmG,GAChBA,IAAa,EACf;gBAAA;gBAEAxmG,IAAAA,CAAKggD,SAAAA,CAAU9zB,WAAAA,GAAc,IAAI5Q,EAAY;oBAC3Cd,MAAM;oBACNC,KAAK;oBACLe,OAAOxb,IAAAA,CAAK+1B,OAAAA,GAAU/1B,IAAAA,CAAKylG,SAAAA,GAAYzlG,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA;oBAClDmP,QAAQzb,IAAAA,CAAK81B,IAAAA,GAAO91B,IAAAA,CAAK0lG,UAAAA,GAAa1lG,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;gBAAAA;YAErD;YAEO,YAAY6P,CAAAA,EAAAA;gBACjB2S,KAAAA,CAAMugB,YAAYlzB,IAClBja,IAAAA,CAAK2iE,OAAAA,GAAU1oD;YACjB;YAGQ,gCAAgC6yD,CAAAA,EAAAA;gBAAAA,IAAAA;gBACtC,IAAK9sE,IAAAA,CAAKimG,gBAAAA,CAAiBluF,GAAAA,CAAI+0D,IAK7B,OAA0C,SAAnC,CAAA,IAAA9sE,IAAAA,CAAKimG,gBAAAA,CAAiBtjG,GAAAA,CAAImqE,EAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIh/D,EAAOC,IAAAA;gBALb;oBACxC,MAAM64F,IAAiB95B,EAAS73C,MAAAA;oBAEhC,OADAj1B,IAAAA,CAAKimG,gBAAAA,CAAiBj7E,GAAAA,CAAI8hD,GAAU85B,IAC7BA;gBACT;YAGF;YAKQ,mBAAAC;gBACN7mG,IAAAA,CAAK8sE,QAAAA,CAASoc,gBAAAA,CAAiB32C,SAAAA,CAAUvyC,IAAAA,CAAKomG,UAAAA,GAC9CpmG,IAAAA,CAAKomG,UAAAA,CAAW7wB,cAAAA;gBAChB,MAAMnE,IAA2B,EAAA;gBACjCpxE,IAAAA,CAAKomG,UAAAA,GAAapmG,IAAAA,CAAK8sE,QAAAA,CAASqd,oBAAAA,CAAqB,EAAA;gBACrD,IAAIzhE,IAA8B;gBAQlC,MAAMo+E,IAAa,CAACzgB,GAAmB/7E,IAAAA,CAAAA,CAAAA,CACjC+7E,KAAAA,CAAQ/7E,CAAAA,KAGR+7E,EAAK5rE,GAAAA,KAAQnQ,EAAKmQ,GAAAA,IAClB4rE,EAAK5qE,MAAAA,KAAWnR,EAAKmR,MAAAA,IAErB4qE,EAAK7qE,KAAAA,KAAUlR,EAAKkQ,IAAAA,EAcpBusF,IAAkB,CAACr+E,GAAsB0oD,GAA0B41B,IAAchnG,IAAAA,CAAK+lG,iBAAAA;oBAC1F,IAAA,CAAKr9E,GACH,OAAA,CAAO;oBAGT,IAAK,IAAIloB,IAAI4wE,EAAU9wE,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAAK;wBAC9C,IAAIwmG,MAAgB,GAElB,OAAA,CAAO;wBAET,MAAM3gB,IAAOjV,CAAAA,CAAU5wE,EAAAA;wBACvB,IAAIsmG,EAAWzgB,GAAM39D,IAEnB,OADA0oD,CAAAA,CAAU5wE,EAAAA,GAAK6lF,EAAKrnE,OAAAA,CAAQ0J,IAAAA,CACrB;oBAEX;oBACA,OAAA,CAAO;gBAAK;gBAKd,IAAK,IAAIloB,IAAI,GAAGA,IAAIR,IAAAA,CAAK+1B,OAAAA,EAASv1B,IAAK;oBAErC,IAAK,IAAIkxE,IAAI,GAAGA,IAAI1xE,IAAAA,CAAK81B,IAAAA,EAAM47C,IAAK;wBAClC,MAAM+0B,IAAOzmG,IAAAA,CAAKwlG,KAAAA,CAAMhlG,IAAIkxE,IAAI1xE,IAAAA,CAAK+1B,OAAAA,CAAAA;wBAErC,IAAI0wE,EAAKQ,KAAAA;4BAEP,IAAIR,EAAK/1B,YAAAA,GAAepwE,MAAAA,GAAS,GAAG;gCAElC,KAAK,MAAMwsE,KAAY25B,EAAK/1B,YAAAA,GAAgB;oCAC1C,MAAMk2B,IAAiB5mG,IAAAA,CAAK2mG,+BAAAA,CAAgC75B;oCAC5DA,EAAS73C,MAAAA,GAASvmB,EAAI+3F,EAAKn6F,CAAAA,GAAItM,IAAAA,CAAKylG,SAAAA,GAAYzlG,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAGm6F,EAAKr8F,CAAAA,GAAIpK,IAAAA,CAAK0lG,UAAAA,GAAa1lG,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,EAAGgG,GAAAA,CAAIw2F,IAC3G95B,EAASl7B,KAAAA,GAAQ5xC,IAAAA,EACjBA,IAAAA,CAAKomG,UAAAA,CAAW9wB,WAAAA,CAAYxI;gCAC9B;gCAEIpkD,KAAAA,CAAYq+E,EAAgBr+E,GAAS0oD,MACvCA,EAAUzxE,IAAAA,CAAK+oB,IAEjBA,IAAU;4BAEZ,OAMIA,IALGA,IAKOA,EAAQ1J,OAAAA,CAAQynF,EAAKS,eAAAA,IAHrBT,EAAKS,eAAAA;+BASfx+E,KAAAA,CAAYq+E,EAAgBr+E,GAAS0oD,MACvCA,EAAUzxE,IAAAA,CAAK+oB,IAEjBA,IAAU;oBAEd;oBAGIA,KAAAA,CAAYq+E,EAAgBr+E,GAAS0oD,MAEvCA,EAAUzxE,IAAAA,CAAK+oB,IAEjBA,IAAU;gBACZ;gBAEA,KAAK,MAAMjU,KAAK28D,EAAW;oBACzB,MAAMtE,IAAW+Y,GAAM+C,GAAAA,CAAIn0E,EAAE0F,KAAAA,EAAO1F,EAAE4F,MAAAA,EAAQvM,EAAOC,IAAAA,EAAMW,EAAI+F,EAAE+F,IAAAA,GAAOxa,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,EAAGmI,EAAEgG,GAAAA,GAAMza,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA;oBACrG0iE,EAASl7B,KAAAA,GAAQ5xC,IAAAA,EACjBA,IAAAA,CAAKomG,UAAAA,CAAW9wB,WAAAA,CAAYxI;gBAC9B;gBACA9sE,IAAAA,CAAK8sE,QAAAA,CAASr/B,MAAAA,IAEdztC,IAAAA,CAAK8sE,QAAAA,CAASmc,cAAAA,CAAe12C,SAAAA,CAAUvyC,IAAAA,CAAKomG,UAAAA;YAC9C;YAOO,eAAe56F,CAAAA,EAAAA;gBAAAA,IAAAA;gBACpB,OAAwB,SAAjB,CAAA,IAAAxL,IAAAA,CAAKwlG,KAAAA,CAAMh6F,EAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;YAC9B;YASO,QAAQc,CAAAA,EAAWlC,CAAAA,EAAAA;gBACxB,OAAIkC,IAAI,KAAKlC,IAAI,KAAKkC,KAAKtM,IAAAA,CAAK+1B,OAAAA,IAAW3rB,KAAKpK,IAAAA,CAAK81B,IAAAA,GAC5C,OAEF91B,IAAAA,CAAKwlG,KAAAA,CAAMl5F,IAAIlC,IAAIpK,IAAAA,CAAK+1B,OAAAA,CACjC;YAAA;YAKO,eAAenZ,CAAAA,EAAAA;gBACpB,MAAA,EAAM,GAAEtQ,CAAAA,EAAC,GAAElC,CAAAA,EAAAA,GAAMpK,IAAAA,CAAKsnG,mBAAAA,CAAoB1qF,IACpC6pF,IAAOzmG,IAAAA,CAAKonG,OAAAA,CAAQ96F,GAAGlC;gBAC7B,OAAIkC,KAAK,KAAKlC,KAAK,KAAKkC,IAAItM,IAAAA,CAAK+1B,OAAAA,IAAW3rB,IAAIpK,IAAAA,CAAK81B,IAAAA,IAAQ2wE,IACpDA,IAEF;YACT;YAEQ,oBAAoB7pF,CAAAA,EAAAA;gBAE1BA,IAAQ5c,IAAAA,CAAK+c,SAAAA,CAAUu0B,YAAAA,CAAa10B;gBAIpC,OAAO;oBAAEtQ,GAFChH,KAAKoF,KAAAA,CAAMkS,EAAMtQ,CAAAA,GAAItM,IAAAA,CAAKylG,SAAAA;oBAExBr7F,GADF9E,KAAKoF,KAAAA,CAAMkS,EAAMxS,CAAAA,GAAIpK,IAAAA,CAAK0lG,UAAAA;gBAAAA;YAEtC;YAEO,UAAA6B;gBACL,OAAOvnG,IAAAA,CAAK4lG,KACd;YAAA;YAEO,aAAA4B;gBACL,OAAOxnG,IAAAA,CAAK6lG,KACd;YAAA;YAOO,mBAAA4B;gBACL,IAAIj6B,IAAcxtE,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAOklD,cAAAA;gBACtC,MAAMwuC,IAAgB1nG,IAAAA,CAAK2C,GAAAA,CAAIm/F;gBAC/B,IAAI4F,KAAiB1nG,IAAAA,CAAK8oD,aAAAA,EAAe;oBACvC,IAAIjuC,IAAM7a,IAAAA,CAAK6a,GAAAA;oBACf,MAAM8sF,IAAiB75F,EAAOE,GAAAA,CAAIuC,GAAAA,CAAIm3F,EAAc3F,cAAAA,GAC9C6F,IAAiB5nG,IAAAA,CAAK2iE,OAAAA,CAAQklC,YAAAA,CAAajxC,MAAAA,CAAO/7C,GAAAA,CAAI5K,KAAAA,CAAM03F;oBAClE9sF,IAAMA,EAAItK,GAAAA,CAAIq3F,IAEdp6B,IAAcA,EAAY7wD,SAAAA,CAAU9B;gBACtC;gBAEA,MAAMma,IAASh1B,IAAAA,CAAK+c,SAAAA,CAAU22B,UAAAA,KAAe5E,GAAWykB,MAAAA,GAASvzD,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAOqlD,eAAAA,KAAoBmU,GACnGjxD,IAAUvc,IAAAA,CAAKsnG,mBAAAA,CAAoBtyE,EAAOzY,OAAAA,GAC1CE,IAAWzc,IAAAA,CAAKsnG,mBAAAA,CAAoBtyE,EAAOvY,QAAAA,GAC3CD,IAAcxc,IAAAA,CAAKsnG,mBAAAA,CAAoBtyE,EAAOxY,WAAAA,GAC9CE,IAAa1c,IAAAA,CAAKsnG,mBAAAA,CAAoBtyE,EAAOtY,UAAAA,GAE7CorF,IAAaxiG,KAAKkF,GAAAA,CAAIkC,EAAM6P,EAAQjQ,CAAAA,EAAG,GAAGtM,IAAAA,CAAK+1B,OAAAA,GAAU,IAAIrpB,EAAM+P,EAASnQ,CAAAA,EAAG,GAAGtM,IAAAA,CAAK+1B,OAAAA,GAAU,KACjGgyE,IAAaziG,KAAKkF,GAAAA,CAAIkC,EAAM6P,EAAQnS,CAAAA,EAAG,GAAGpK,IAAAA,CAAK81B,IAAAA,GAAO,IAAIppB,EAAM+P,EAASrS,CAAAA,EAAG,GAAGpK,IAAAA,CAAK81B,IAAAA,GAAO,KAC3FkyE,IAAW1iG,KAAKC,GAAAA,CAAImH,EAAM8P,EAAYlQ,CAAAA,EAAG,GAAGtM,IAAAA,CAAK+1B,OAAAA,GAAU,IAAIrpB,EAAMgQ,EAAWpQ,CAAAA,EAAG,GAAGtM,IAAAA,CAAK+1B,OAAAA,GAAU,KACrGkyE,IAAW3iG,KAAKC,GAAAA,CAAImH,EAAM8P,EAAYpS,CAAAA,EAAG,GAAGpK,IAAAA,CAAK81B,IAAAA,GAAO,IAAIppB,EAAMgQ,EAAWtS,CAAAA,EAAG,GAAGpK,IAAAA,CAAK81B,IAAAA,GAAO,KAE/F0vE,IAAgB,EAAA;gBACtB,IAAK,IAAIl5F,IAAIw7F,GAAYx7F,KAAK07F,GAAU17F,IACtC,IAAK,IAAIlC,IAAI29F,GAAY39F,KAAK69F,GAAU79F,IACtCo7F,EAAM7lG,IAAAA,CAAKK,IAAAA,CAAKonG,OAAAA,CAAQ96F,GAAGlC;gBAG/B,OAAOo7F;YACT;YAKO,wBAAwB9B,CAAAA,EAAAA;gBAC7B1jG,IAAAA,CAAKumG,uBAAAA,CAAwB/B,sBAAAA,CAAuBd,GAAU1jG,IAAAA,CAAKwlG,KAAAA;YACrE;YAKO,uBAAuB9B,CAAAA,EAAAA;gBAC5B1jG,IAAAA,CAAKumG,uBAAAA,CAAwB9C,cAAAA,CAAeC,GAAU1jG,IAAAA,CAAKwlG,KAAAA;YAC7D;YAEO,OAAOvrF,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAC5B92C,IAAAA,CAAKmtC,WAAAA,CAAYlzB,IACjBja,IAAAA,CAAKopD,WAAAA,CAAYnvC,GAAQ68B,IACzB92C,IAAAA,CAAKmI,IAAAA,CAAK,aAAa,IAAIg6C,GAAeloC,GAAQ68B,GAAS92C,IAAAA,IAGtDA,IAAAA,CAAKqmG,OAAAA,CAAQj3F,MAAAA,CAAOpP,IAAAA,CAAK6a,GAAAA,KAAQ7a,IAAAA,CAAKgmG,YAAAA,KAAiBhmG,IAAAA,CAAK2iB,QAAAA,IAAa3iB,IAAAA,CAAKsmG,SAAAA,CAAUl3F,MAAAA,CAAOpP,IAAAA,CAAKiQ,KAAAA,KACvGjQ,CAAAA,IAAAA,CAAKqlG,kBAAAA,IACLrlG,IAAAA,CAAKulG,cAAAA,EAAAA,GAEHvlG,IAAAA,CAAKslG,eAAAA,IACPtlG,CAAAA,IAAAA,CAAKslG,eAAAA,GAAAA,CAAkB,GACvBtlG,IAAAA,CAAK6mG,gBAAAA,EAAAA,GAIP7mG,IAAAA,CAAKumG,uBAAAA,CAAwB/+F,KAAAA,IAE7BxH,IAAAA,CAAK2lG,MAAAA,IAEL3lG,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,CAAMjS,IAAAA,CAAKqmG,OAAAA,GACpBrmG,IAAAA,CAAKgmG,YAAAA,GAAehmG,IAAAA,CAAK2iB,QAAAA,EACzB3iB,IAAAA,CAAKiQ,KAAAA,CAAMgC,KAAAA,CAAMjS,IAAAA,CAAKsmG,SAAAA,GACtBtmG,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAM7a,IAAAA,CAAK6a,GAAAA,EAC1B7a,IAAAA,CAAKspD,YAAAA,CAAarvC,GAAQ68B,IAC1B92C,IAAAA,CAAKmI,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBnoC,GAAQ68B,GAAS92C,IAAAA;YAC/D;YAOO,KAAKo3B,CAAAA,EAA+B0f,CAAAA,EAAAA;gBACzC,IAAA,CAAK92C,IAAAA,CAAK8oD,aAAAA,EACR;gBAIF,IAAIhJ,GAA8BooD,GAAuBC;gBAFzDnoG,IAAAA,CAAKmI,IAAAA,CAAK,WAAW,IAAI05C,GAAazqB,GAAY0f,GAAS92C,IAAAA;gBAI3D,MAAMwlG,IAAQxlG,IAAAA,CAAKynG,gBAAAA;gBACnB,IAAK,IAAIjnG,IAAI,GAAGA,IAAIglG,EAAMllG,MAAAA,EAAQE,IAAK;oBACrC,MAAMimG,IAAOjB,CAAAA,CAAMhlG,EAAAA,EAEb4nG,IAAU3B,EAAK4B,kBAAAA;oBAGrB,IAFAvoD,IAAW2mD,EAAK6B,WAAAA,IAEXJ,IAAgB,GAAGC,IAAcroD,EAASx/C,MAAAA,EAAQ4nG,IAAgBC,GAAaD,IAAiB;wBAEnG,MAAM9yD,IAAU0K,CAAAA,CAASooD,EAAAA,EACnBjzE,IAASmzE,CAAAA,CAAQF,EAAAA;wBACvB,IAAI9yD,GAAS;4BACPkK,GAAgBlK,MAClBA,CAAAA,QAAAA,KAAAA,EAASyB,IAAAA,CAAKC,GAAS92C,IAAAA,CAAK2lG,MAAAA,CAAAA;4BAE9B,MAAMxkD,IAAUnhD,IAAAA,CAAK8lG,sBAAAA,GAAyB,IAAI1wD,EAAQ/6B,MAAAA,GAASra,IAAAA,CAAK0lG,UAAAA;4BACxEtwD,EAAQv1B,IAAAA,CAAKuX,GAAKqvE,EAAKn6F,CAAAA,GAAItM,IAAAA,CAAKylG,SAAAA,GAAYxwE,EAAO3oB,CAAAA,EAAGm6F,EAAKr8F,CAAAA,GAAIpK,IAAAA,CAAK0lG,UAAAA,GAAavkD,IAAUlsB,EAAO7qB,CAAAA;wBACpG;oBACF;gBACF;gBACApK,IAAAA,CAAKmI,IAAAA,CAAK,YAAY,IAAI25C,GAAc1qB,GAAY0f,GAAS92C,IAAAA;YAC/D;YAEO,MAAMuoG,CAAAA,EAA+BpC,CAAAA,EAAAA;gBAC1C,MAAA,EAAM,SACJqC,CAAAA,EAAO,UACPC,CAAAA,EAAQ,WACRC,CAAAA,EAAS,WACTC,CAAAA,EACAC,iBAAiBC,CAAAA,EACjBC,kBAAkBC,CAAAA,EAAmB,sBACrCC,CAAAA,EAAAA,GACE7C,EAAW8C,OAAAA,EAAAA,EACT,eAAEC,CAAAA,EAAa,mBAAEC,CAAAA,EAAiB,mBAAEC,CAAAA,EAAAA,GAAsBjD,EAAWr5B,QAAAA,EACrE3yD,IAAQna,IAAAA,CAAKylG,SAAAA,GAAYzlG,IAAAA,CAAK+1B,OAAAA,GAAU/1B,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EACnD+N,IAASra,IAAAA,CAAK0lG,UAAAA,GAAa1lG,IAAAA,CAAK81B,IAAAA,GAAO91B,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA,EAClDyQ,IAAM7a,IAAAA,CAAK6a,GAAAA;gBACjB,IAAI4tF,KAAYD,GAAS;oBACvB,IAAK,IAAIvlG,IAAI,GAAGA,IAAIjD,IAAAA,CAAK81B,IAAAA,GAAO,GAAG7yB,IAAK;wBACtC,MAAMk3F,IAAUzrF,EAAI,GAAGzL,IAAIjD,IAAAA,CAAK0lG,UAAAA,GAAa1lG,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;wBACxDm+F,EAAIx9D,QAAAA,CAASlwB,EAAIzK,GAAAA,CAAI+pF,IAAUt/E,EAAIzK,GAAAA,CAAI1B,EAAIyL,GAAOggF,EAAQ/vF,CAAAA,IAAKs+F,GAAWC;oBAC5E;oBAEA,IAAK,IAAIl0F,IAAI,GAAGA,IAAIzU,IAAAA,CAAK+1B,OAAAA,GAAU,GAAGthB,IAAK;wBACzC,MAAMylF,IAAUxrF,EAAI+F,IAAIzU,IAAAA,CAAKylG,SAAAA,GAAYzlG,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAG;wBACvDi8F,EAAIx9D,QAAAA,CAASlwB,EAAIzK,GAAAA,CAAI8pF,IAAUr/E,EAAIzK,GAAAA,CAAI1B,EAAIwrF,EAAQ5tF,CAAAA,EAAG+N,KAAUquF,GAAWC;oBAC7E;gBACF;gBAEA,IAAIH,KAAWK,KAAsBG,GAAsB;oBACzD,MAAM53B,IAAYpxE,IAAAA,CAAKomG,UAAAA,CAAW11B,YAAAA;oBAClC63B,EAAIhgF,IAAAA,IACJggF,EAAI5rF,SAAAA,CAAU3c,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,GACnCm+F,EAAIt4F,KAAAA,CAAMjQ,IAAAA,CAAKiQ,KAAAA,CAAM3D,CAAAA,EAAGtM,IAAAA,CAAKiQ,KAAAA,CAAM7F,CAAAA;oBACnC,KAAK,MAAM0iE,KAAYsE,EAAW;wBAChC,MAAMp8C,IAAS83C,EAAS5gD,WAAAA,EAClBrR,IAAMiyD,EAAS2I,QAAAA,CAASllE,GAAAA,CAAIvQ,IAAAA,CAAK6a,GAAAA;wBACnCguF,KACFN,EAAIv9D,aAAAA,CAAcnwB,GAAKma,EAAO7a,KAAAA,EAAO6a,EAAO3a,MAAAA,EAAQ0uF;oBAExD;oBAEA,IADAR,EAAI//E,OAAAA,IACAwgF,GACF,KAAK,MAAMl8B,KAAYsE,EACrBtE,EAAS90D,KAAAA,CAAMuwF,GAAKW,GAAe;wBAAElxD,WAAWmxD;wBAAmBE,WAAWD;oBAAAA;gBAGpF;gBAEA,IAAIZ,KAAWK,GAAoB;oBAGjC,IAFAN,EAAIhgF,IAAAA,IACJggF,EAAI1/E,CAAAA,GAAI,KACJggF,GACF,IAAK,IAAIroG,IAAI,GAAGA,IAAIR,IAAAA,CAAKwlG,KAAAA,CAAMllG,MAAAA,EAAQE,IACrCR,IAAAA,CAAKwlG,KAAAA,CAAMhlG,EAAAA,CAAGw0B,MAAAA,CAAOnV,IAAAA,CAAK0oF;oBAG9BA,EAAI//E,OAAAA;gBACN;YACF;QAAA;QA2BK,MAAMk+E;YAWX,IAAA,MAAW7rF;gBAKT,OAJI7a,IAAAA,CAAKspG,SAAAA,IACPtpG,CAAAA,IAAAA,CAAKupG,YAAAA,IACLvpG,IAAAA,CAAKspG,SAAAA,GAAAA,CAAY,CAAA,GAEZtpG,IAAAA,CAAKmZ,IACd;YAAA;YAgBA,IAAA,QAAWgB;gBACT,OAAOna,IAAAA,CAAK+rB,MACd;YAAA;YAMA,IAAA,SAAW1R;gBACT,OAAOra,IAAAA,CAAKgsB,OACd;YAAA;YAWA,IAAA,QAAWi7E;gBACT,OAAOjnG,IAAAA,CAAKwpG,MACd;YAAA;YAIA,IAAA,MAAiB/8F,CAAAA,EAAAA;gBAAAA,IAAAA;gBACP,SAAR,CAAA,IAAAzM,IAAAA,CAAKC,GAAAA,AAAAA,KAAAA,KAAG,MAAA,KAAA,EAAEolG,kBAAAA,IACVrlG,IAAAA,CAAKwpG,MAAAA,GAAS/8F;YAChB;YAQO,cAAA67F;gBACL,OAAOtoG,IAAAA,CAAKggD,SACd;YAAA;YAKO,qBAAAqoD;gBACL,OAAOroG,IAAAA,CAAKypG,QACd;YAAA;YAMO,WAAWr0D,CAAAA,EAAkBn8B,CAAAA,EAAAA;gBAClCjZ,IAAAA,CAAKggD,SAAAA,CAAUrgD,IAAAA,CAAKy1C,IAAAA,AAChBn8B,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASgc,MAAAA,AAAAA,IACXj1B,IAAAA,CAAKypG,QAAAA,CAAS9pG,IAAAA,CAAKsZ,EAAQgc,MAAAA,IAE3Bj1B,IAAAA,CAAKypG,QAAAA,CAAS9pG,IAAAA,CAAKmO,EAAOC,IAAAA;YAE9B;YAKO,cAAcqnC,CAAAA,EAAAA;gBACnB,MAAM5pC,IAAQxL,IAAAA,CAAKggD,SAAAA,CAAUv3C,OAAAA,CAAQ2sC;gBACjC5pC,IAAAA,MACFxL,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUt3C,MAAAA,CAAO8C,GAAO,IAC7BxL,IAAAA,CAAKypG,QAAAA,CAAS/gG,MAAAA,CAAO8C,GAAO,EAAA;YAEhC;YAKO,gBAAAo+F;gBACL5pG,IAAAA,CAAKggD,SAAAA,CAAU1/C,MAAAA,GAAS,GACxBN,IAAAA,CAAKypG,QAAAA,CAASnpG,MAAAA,GAAS;YACzB;YAUO,eAAAowE;gBACL,OAAO1wE,IAAAA,CAAKuwE,UACd;YAAA;YAUO,YAAYzD,CAAAA,EAAAA;gBACjB9sE,IAAAA,CAAKuwE,UAAAA,CAAW5wE,IAAAA,CAAKmtE,IACrB9sE,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAMO,eAAev4B,CAAAA,EAAAA;gBACpB,MAAMthE,IAAQxL,IAAAA,CAAKuwE,UAAAA,CAAW9nE,OAAAA,CAAQqkE;gBAClCthE,IAAAA,MACFxL,IAAAA,CAAKuwE,UAAAA,CAAW7nE,MAAAA,CAAO8C,GAAO,IAEhCxL,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAKO,iBAAA9vB;gBACLv1E,IAAAA,CAAKuwE,UAAAA,CAAWjwE,MAAAA,GAAS,GACzBN,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAOA,YAAYpsF,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBAhKJ,IAAA,CAAAqwF,SAAAA,GAAAA,CAAY,GAEb,IAAA,CAAApvF,MAAAA,GAAS,IAAIhT,GA4CZ,IAAA,CAAAsiG,MAAAA,GAAAA,CAAS,GAeT,IAAA,CAAAxpD,SAAAA,GAAuB,EAAA,EACvB,IAAA,CAAAypD,QAAAA,GAAqB,EAAA,EAmDrB,IAAA,CAAAl5B,UAAAA,GAAyB,EAAA,EA6C1B,IAAA,CAAA9uE,IAAAA,GAAO,IAAI6sB,KAGhBtuB,IAAAA,CAAKsM,CAAAA,GAAI2M,EAAQ3M,CAAAA,EACjBtM,IAAAA,CAAKoK,CAAAA,GAAI6O,EAAQ7O,CAAAA,EACjBpK,IAAAA,CAAKC,GAAAA,GAAMgZ,EAAQhZ,GAAAA,EACnBD,IAAAA,CAAK+rB,MAAAA,GAAS9S,EAAQhZ,GAAAA,CAAIwlG,SAAAA,GAAYzlG,IAAAA,CAAKC,GAAAA,CAAIgQ,KAAAA,CAAM3D,CAAAA,EACrDtM,IAAAA,CAAKgsB,OAAAA,GAAU/S,EAAQhZ,GAAAA,CAAIylG,UAAAA,GAAa1lG,IAAAA,CAAKC,GAAAA,CAAIgQ,KAAAA,CAAM7F,CAAAA,EACvDpK,IAAAA,CAAKinG,KAAAA,GAAqB,SAAb,CAAA,IAAAhuF,EAAQguF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIjnG,IAAAA,CAAKinG,KAAAA,EACnCjnG,IAAAA,CAAKggD,SAAAA,GAA4B,SAAhB,CAAA,IAAA/mC,EAAQ6mC,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI,EAAA,EACrC9/C,IAAAA,CAAKupG,YAAAA;YACP;YAEO,YAAAv5D;gBACL,OAAQhwC,IAAAA,CAAKspG,SAAAA,GAAAA,CAAY;YAC3B;YAEQ,eAAAC;gBACN,MAAMM,IAAc7pG,IAAAA,CAAKC,GAAAA,CAAI4a,GAAAA,CAAIzK,GAAAA,CAAI1B,EAAI1O,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,EAAWzlG,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA;gBACxF1lG,IAAAA,CAAK8pG,SAAAA,GAAY,IAAIxuF,EAAYuuF,EAAYv9F,CAAAA,EAAGu9F,EAAYz/F,CAAAA,EAAGy/F,EAAYv9F,CAAAA,GAAItM,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,EAAWoE,EAAYz/F,CAAAA,GAAIpK,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,GAE5H1lG,IAAAA,CAAK+rB,MAAAA,GAAS/rB,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,GAAYzlG,IAAAA,CAAKC,GAAAA,CAAIgQ,KAAAA,CAAM3D,CAAAA,EAClDtM,IAAAA,CAAKgsB,OAAAA,GAAUhsB,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,GAAa1lG,IAAAA,CAAKC,GAAAA,CAAIgQ,KAAAA,CAAM7F,CAAAA,EAEpDpK,IAAAA,CAAKmZ,IAAAA,GAAOnZ,IAAAA,CAAKC,GAAAA,CAAI4a,GAAAA,CAAIzK,GAAAA,CAAI1B,EAAI1O,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAK+rB,MAAAA,EAAQ/rB,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAKgsB,OAAAA,IACrEhsB,IAAAA,CAAK+pG,OAAAA,GAAU,IAAIzuF,EAAYtb,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,EAAGtM,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,EAAGpK,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,GAAItM,IAAAA,CAAK+rB,MAAAA,EAAQ/rB,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,GAAIpK,IAAAA,CAAKgsB,OAAAA,GAEnGhsB,IAAAA,CAAKC,GAAAA,CAAI0iB,QAAAA,IACX3iB,CAAAA,IAAAA,CAAK+pG,OAAAA,GAAU/pG,IAAAA,CAAK+pG,OAAAA,CAAQl4F,MAAAA,CAAO7R,IAAAA,CAAKC,GAAAA,CAAI0iB,QAAAA,EAAU3iB,IAAAA,CAAKC,GAAAA,CAAI4a,GAAAA,CAAAA,GAEjE7a,IAAAA,CAAKspG,SAAAA,GAAAA,CAAY;YACnB;YAKA,IAAA,SAAWt0E;gBAIT,OAHIh1B,IAAAA,CAAKspG,SAAAA,IACPtpG,IAAAA,CAAKupG,YAAAA,IAEAvpG,IAAAA,CAAK+pG,OACd;YAAA;YAEA,IAAA,kBAAW7C;gBACT,OAAOlnG,IAAAA,CAAK8pG,SACd;YAAA;YAKA,IAAA,SAAWxtF;gBAIT,OAHItc,IAAAA,CAAKspG,SAAAA,IACPtpG,IAAAA,CAAKupG,YAAAA,IAEA,IAAIz7F,EAAO9N,IAAAA,CAAKmZ,IAAAA,CAAK7M,CAAAA,GAAItM,IAAAA,CAAK+rB,MAAAA,GAAS,GAAG/rB,IAAAA,CAAKmZ,IAAAA,CAAK/O,CAAAA,GAAIpK,IAAAA,CAAKgsB,OAAAA,GAAU;YAChF;YAIO,KAA8DtkB,CAAAA,EAAuBU,CAAAA,EAAAA;gBAC1FpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAOO,GAA4DV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACxF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAOO,KAA8DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAC1F,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAA6DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrFA,IACF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC,KAE3B3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH;YAEpB;QAAA;QCx5BK,MAAMsiG;YACX,YAAmBpzC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA;YAAiB;YAM7B,YAAYqgC,CAAAA,EAAAA;gBACjBj3F,IAAAA,CAAK42D,MAAAA,CAAOszC,WAAAA,CAAY,IAAIC,GAA0BlT;YACxD;YAOO,gBAAgBA,CAAAA,EAAcl0C,CAAAA,EAAAA;gBACnC/iD,IAAAA,CAAK42D,MAAAA,CAAOszC,WAAAA,CAAY,IAAIG,GAA8BpT,GAAOl0C;YACnE;YAWO,eAAek0C,CAAAA,EAAcsT,CAAAA,EAA0BC,CAAAA,EAAAA;gBAC5DxqG,IAAAA,CAAK42D,MAAAA,CAAOszC,WAAAA,CAAY,IAAIO,GAAuBxT,GAAOsT,GAAkBC;YAC9E;YAOO,kBAAkBvT,CAAAA,EAAcrrD,CAAAA,EAAAA;gBACrC5rC,IAAAA,CAAK42D,MAAAA,CAAOszC,WAAAA,CAAY,IAAIS,GAA0B1T,GAAOrrD;YAC/D;YAMO,kBAAkBi/D,CAAAA,EAAAA;gBACvB7qG,IAAAA,CAAK42D,MAAAA,CAAOszC,WAAAA,CAAY,IAAIY,GAA0BD;YACxD;QAAA;QAMF,IAAYE;QAAAA,CAAZ,SAAYA,CAAAA;YACV,CAAA,CAAA,EAAA,CAAA,GAAA,EAAA,GAAA,KACA,CAAA,CAAA,EAAA,CAAA,GAAA,EAAA,GAAA;QACD,EAHWA,MAAAA,CAAAA,KAAI,CAAA,CAAA;QAQT,MAAMZ;YACX,YAAmB9oF,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GACZ,IAAA,CAAAgjC,MAAAA,GAAS,CAAChjC,GAAeu1C,GAAgB38C,GAAgB68B,IAC/Cz1B,EAAO/E,MAFW;YAAA;QAAA;QAU9B,MAAM+tF;YACX,YACShpF,CAAAA,EACA0hC,CAAAA,CAAAA;gBADA,IAAA,CAAA1hC,MAAAA,GAAAA,GACA,IAAA,CAAA0hC,IAAAA,GAAAA,GAEF,IAAA,CAAAsB,MAAAA,GAAS,CAAChjC,GAAe2pF,GAAaC,GAAcn0D;oBACzD,MAAMx6B,IAAS+E,EAAO/E,MAAAA,EAChB4uF,IAAeF,EAAIG,QAAAA;oBACzB,OAAInrG,IAAAA,CAAK+iD,IAAAA,KAASgoD,GAAKxe,CAAAA,GACd,IAAIz+E,EAAOwO,EAAOhQ,CAAAA,EAAG4+F,EAAa9gG,CAAAA,IAElC,IAAI0D,EAAOo9F,EAAa5+F,CAAAA,EAAGgQ,EAAOlS,CAAAA;gBAC3C;YARC;QAAA;QAeE,MAAMqgG;YASX,YACSppF,CAAAA,EACAkpF,CAAAA,EACAC,CAAAA,CAAAA;gBAFA,IAAA,CAAAnpF,MAAAA,GAAAA,GACA,IAAA,CAAAkpF,gBAAAA,GAAAA,GACA,IAAA,CAAAC,cAAAA,GAAAA,GAEF,IAAA,CAAAnmD,MAAAA,GAAS,CAAChjC,GAAe2pF,GAAaC,GAAcn0D;oBACzD,MAAMl9B,IAAWyH,EAAO/E,MAAAA;oBACxB,IAAI0vC,IAAQg/C,EAAIG,QAAAA,IACZC,IAAYJ,EAAIxhD,GAAAA,CAAIv3C,KAAAA;oBAMxB,MAAMo5F,IAAUzxF,EAASrJ,GAAAA,CAAIy7C,GAAO/7C,KAAAA,CAAMjQ,IAAAA,CAAKuqG,gBAAAA;oBAC/Ca,IAAYA,EAAUh7F,GAAAA,CAAIi7F;oBAI1B,MAAM5gB,IAAW2gB,EAAUn7F,KAAAA,CAAAA,IAAUA,KAAAA,CAAMjQ,IAAAA,CAAKwqG,cAAAA;oBAMhD,OALAY,IAAYA,EAAUh7F,GAAAA,CAAIq6E,IAG1Bz+B,IAAQA,EAAM57C,GAAAA,CAAIg7F,IAEXp/C;gBAAK;YArBX;QAAA;QAyBE,MAAM2+C;YAMX,YACStpF,CAAAA,EACAuqB,CAAAA,CAAAA;gBADA,IAAA,CAAAvqB,MAAAA,GAAAA,GACA,IAAA,CAAAuqB,MAAAA,GAAAA,GAEF,IAAA,CAAAyY,MAAAA,GAAS,CAAChjC,GAAe2pF,GAAaC,GAAcn0D;oBACzD,MAAMl9B,IAAWyH,EAAO/E,MAAAA,EAClB0vC,IAAQg/C,EAAIG,QAAAA,IAEZ9vF,IAAYzB,EAASrJ,GAAAA,CAAIy7C,IACzBn9C,IAAWwM,EAAUzL,SAAAA;oBAC3B,IAAIf,KAAY7O,IAAAA,CAAK4rC,MAAAA,EAAQ;wBAC3B,MAAM3W,IAASpmB,IAAW7O,IAAAA,CAAK4rC,MAAAA;wBAC/B,OAAOogB,EAAM57C,GAAAA,CAAIiL,EAAUrL,SAAAA,GAAYC,KAAAA,CAAMglB;oBAC/C;oBACA,OAAO+2B;gBAAK;YAXX;QAAA;QAkBE,MAAM8+C;YAcX,YAAmBzpF,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GAFnB,IAAA,CAAAiqF,gBAAAA,GAAAA,CAA4B,GAIrB,IAAA,CAAAjnD,MAAAA,GAAS,CAAChjC,GAAqB2pF,GAAaC,GAAcn0D;oBAC/D,MAAMkV,IAAQg/C,EAAIG,QAAAA;oBAEbnrG,IAAAA,CAAKsrG,gBAAAA,IAAAA,CAAAA,AACJjqF,CAAAA,EAAO5F,MAAAA,GAAS4F,EAAO5G,GAAAA,GAAMwwF,EAAKrxC,UAAAA,IAAcv4C,EAAO7F,KAAAA,GAAQ6F,EAAO7G,IAAAA,GAAOywF,EAAKvxC,SAAAA,AAAAA,KACpF9iD,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,iEAE5BrY,IAAAA,CAAKsrG,gBAAAA,GAAAA,CAAmB,CAAA;oBAG1B,IAAIC,IAASv/C,EAAM1/C,CAAAA,EACfk/F,IAASx/C,EAAM5hD,CAAAA;oBAanB,OAZI4hD,EAAM1/C,CAAAA,GAAI+U,EAAO7G,IAAAA,GAAOywF,EAAKtxC,aAAAA,GAC/B4xC,IAASlqF,EAAO7G,IAAAA,GAAOywF,EAAKtxC,aAAAA,GACnB3N,EAAM1/C,CAAAA,GAAI+U,EAAO7F,KAAAA,GAAQyvF,EAAKtxC,aAAAA,IACvC4xC,CAAAA,IAASlqF,EAAO7F,KAAAA,GAAQyvF,EAAKtxC,aAAAA,AAAAA,GAG3B3N,EAAM5hD,CAAAA,GAAIiX,EAAO5G,GAAAA,GAAMwwF,EAAKpxC,cAAAA,GAC9B2xC,IAASnqF,EAAO5G,GAAAA,GAAMwwF,EAAKpxC,cAAAA,GAClB7N,EAAM5hD,CAAAA,GAAIiX,EAAO5F,MAAAA,GAASwvF,EAAKpxC,cAAAA,IACxC2xC,CAAAA,IAASnqF,EAAO5F,MAAAA,GAASwvF,EAAKpxC,cAAAA,AAAAA,GAGzBnrD,EAAI68F,GAAQC;gBAAO;YA1Ba;QAAA;QAoCpC,MAAMC,KAAe;YAC1BzmD,YAAY;YACZC,WAAW;YACXC,YAAY;QAAA;QAWP,MAAMwmD;YAAb,aAAA;gBACS,IAAA,CAAAxxF,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAA6V,SAAAA,GAA0BqJ,EAAa7D,QAAAA,IACvC,IAAA,CAAAiE,OAAAA,GAAwBJ,EAAa7D,QAAAA,IAIpC,IAAA,CAAAopF,iBAAAA,GAA2C,EAAA,EAE5C,IAAA,CAAAz3D,QAAAA,GAA8B,IAAI81D,GAAkBhqG,IAAAA,GAKnD,IAAA,CAAAuwC,EAAAA,GAAK,GAeN,IAAA,CAAAq7D,EAAAA,GAAa,GAIb,IAAA,CAAAC,EAAAA,GAAa,GAKb,IAAA,CAAAlpF,QAAAA,GAAmB,GAElB,IAAA,CAAAmpF,gBAAAA,GAA2B,GAa3B,IAAA,CAAAC,WAAAA,GAAAA,CAAc,GACd,IAAA,CAAA5yF,IAAAA,GAAe,IAAIu2B,GAAY5hC,EAAOC,IAAAA,EAAM;oBAClD/N,IAAAA,CAAK+rG,WAAAA,GAAAA,CAAc;gBAAI,IA0BlB,IAAA,CAAA3yC,OAAAA,GAAkBp5D,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,IAE1B,IAAA,CAAAo0F,OAAAA,GAAUrmG,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,IAKpB,IAAA,CAAAu3C,GAAAA,GAAc17C,EAAOC,IAAAA,EAKrB,IAAA,CAAA07C,GAAAA,GAAc37C,EAAOC,IAAAA,EAEpB,IAAA,CAAAi+F,aAAAA,GAAAA,CAAyB,GACzB,IAAA,CAAA/W,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,aAAAA,GAAwB,KACxB,IAAA,CAAAC,UAAAA,GAAqB,MACrB,IAAA,CAAAC,QAAAA,GAAmB,MAKjB,IAAA,CAAA6W,UAAAA,GAAAA,CAAsB,GACxB,IAAA,CAAAC,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,cAAAA,GAAyB,GACzB,IAAA,CAAAC,iBAAAA,GAA4B,GAC5B,IAAA,CAAAC,OAAAA,GAAkB,GAClB,IAAA,CAAAC,OAAAA,GAAkB,GAEhB,IAAA,CAAAC,UAAAA,GAAAA,CAAsB,GACxB,IAAA,CAAAC,UAAAA,GAAqB,GACrB,IAAA,CAAAC,QAAAA,GAAmB,GACnB,IAAA,CAAAC,gBAAAA,GAA2B,GAC3B,IAAA,CAAAC,aAAAA,GAAwB,GAIxB,IAAA,CAAAC,WAAAA,GAA8B3f,GAAgBY,cAAAA,EAC9C,IAAA,CAAA8C,OAAAA,GAA0B1D,GAAgBY,cAAAA,EAE1C,IAAA,CAAAgf,UAAAA,GAAqB,GACrB,IAAA,CAAAC,WAAAA,GAAsB,GAiKtB,IAAA,CAAAx2C,SAAAA,GAAyB,MAqFzB,IAAA,CAAArQ,cAAAA,GAAAA,CAAiB,GAgLjB,IAAA,CAAA8mD,QAAAA,GAAWt+F,EAAI,GAAG;YAmD5B;YAtkBE,IAAA,OAAWyqD;gBACT,OAAOn5D,IAAAA,CAAKuwC,EACd;YAAA;YAEA,IAAA,KAAgB9jC,CAAAA,EAAAA;gBACdzM,IAAAA,CAAKuwC,EAAAA,GAAK9jC,GACNzM,IAAAA,CAAK2iE,OAAAA,IACP3iE,CAAAA,IAAAA,CAAK8sG,UAAAA,GAAa9sG,IAAAA,CAAK2iE,OAAAA,CAAQhJ,aAAAA,EAC/B35D,IAAAA,CAAK+sG,WAAAA,GAAc/sG,IAAAA,CAAK2iE,OAAAA,CAAQ9I,cAAAA,AAAAA;YAEpC;YAoBA,IAAA,kBAAWlQ;gBACT,OAAO3pD,IAAAA,CAAK8rG,gBACd;YAAA;YAEA,IAAA,gBAA2B1oG,CAAAA,EAAAA;gBACzBpD,IAAAA,CAAK8rG,gBAAAA,GAAmB1oG;YAC1B;YASA,IAAA,MAAWyX;gBACT,OAAO7a,IAAAA,CAAKmZ,IACd;YAAA;YACA,IAAA,IAAezK,CAAAA,EAAAA;gBACb1O,IAAAA,CAAK+rG,WAAAA,GAAAA,CAAc,GACnB/rG,IAAAA,CAAKmZ,IAAAA,GAAO,IAAIu2B,GAAYhhC,GAAK;oBAC/B1O,IAAAA,CAAK+rG,WAAAA,GAAAA,CAAc;gBAAI;YAE3B;YAKO,aAAAkB;gBACL,OAAOjtG,IAAAA,CAAK+rG,WACd;YAAA;YAsDA,IAAA,IAAWz/F;gBACT,OAAOtM,IAAAA,CAAK6a,GAAAA,CAAIvO,CAClB;YAAA;YAKA,IAAA,EAAalJ,CAAAA,EAAAA;gBACNpD,IAAAA,CAAKktG,OAAAA,IAAYltG,IAAAA,CAAKgsG,aAAAA,IACzBhsG,CAAAA,IAAAA,CAAK6a,GAAAA,GAAMnM,EAAItL,GAAOpD,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,CAAAA;YAEnC;YAKA,IAAA,IAAWA;gBACT,OAAOpK,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAClB;YAAA;YAKA,IAAA,EAAahH,CAAAA,EAAAA;gBACNpD,IAAAA,CAAKktG,OAAAA,IAAYltG,IAAAA,CAAKgsG,aAAAA,IACzBhsG,CAAAA,IAAAA,CAAK6a,GAAAA,GAAMnM,EAAI1O,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,EAAGlJ,EAAAA;YAE/B;YAKA,IAAA,KAAWimC;gBACT,OAAOrpC,IAAAA,CAAKwpD,GAAAA,CAAIl9C,CAClB;YAAA;YAEA,IAAA,GAAclJ,CAAAA,EAAAA;gBACZpD,IAAAA,CAAKwpD,GAAAA,GAAM96C,EAAItL,GAAOpD,IAAAA,CAAKwpD,GAAAA,CAAIp/C,CAAAA;YACjC;YAKA,IAAA,KAAWk/B;gBACT,OAAOtpC,IAAAA,CAAKwpD,GAAAA,CAAIp/C,CAClB;YAAA;YAEA,IAAA,GAAchH,CAAAA,EAAAA;gBACZpD,IAAAA,CAAKwpD,GAAAA,GAAM96C,EAAI1O,IAAAA,CAAKwpD,GAAAA,CAAIl9C,CAAAA,EAAGlJ;YAC7B;YAKA,IAAA,KAAW+pG;gBACT,OAAOntG,IAAAA,CAAKypD,GAAAA,CAAIn9C,CAClB;YAAA;YAEA,IAAA,GAAclJ,CAAAA,EAAAA;gBACZpD,IAAAA,CAAKypD,GAAAA,GAAM/6C,EAAItL,GAAOpD,IAAAA,CAAKypD,GAAAA,CAAIr/C,CAAAA;YACjC;YAKA,IAAA,KAAWgjG;gBACT,OAAOptG,IAAAA,CAAKypD,GAAAA,CAAIr/C,CAClB;YAAA;YAEA,IAAA,GAAchH,CAAAA,EAAAA;gBACZpD,IAAAA,CAAKypD,GAAAA,GAAM/6C,EAAI1O,IAAAA,CAAKypD,GAAAA,CAAIn9C,CAAAA,EAAGlJ;YAC7B;YAKO,WAAA+nG;gBACL,OAAOnrG,IAAAA,CAAK6a,GACd;YAAA;YAUO,KAAKA,CAAAA,EAAa66B,CAAAA,EAAkB43D,IAA2BpgB,GAAgBY,cAAAA,EAAAA;gBACpF,IAAwB,cAAA,OAAbwf,GACT,MAAM;gBAIR,OAAIttG,IAAAA,CAAKktG,OAAAA,GACA3oG,QAAQE,MAAAA,CAAOoW,KAIpB7a,CAAAA,IAAAA,CAAKutG,YAAAA,IAAgBvtG,IAAAA,CAAKwtG,YAAAA,IAC5BxtG,IAAAA,CAAKwtG,YAAAA,CAAa3yF,IAGpB7a,IAAAA,CAAKutG,YAAAA,GAAe,IAAIhpG,QAAiBC,CAAAA;oBACvCxE,IAAAA,CAAKwtG,YAAAA,GAAehpG;gBAAO,IAE7BxE,IAAAA,CAAKm1F,UAAAA,GAAan1F,IAAAA,CAAKmrG,QAAAA,GAAWl5F,KAAAA,IAClCjS,IAAAA,CAAKk1F,aAAAA,GAAgBx/C,GACrB11C,IAAAA,CAAKo1F,QAAAA,GAAWv6E,GAChB7a,IAAAA,CAAKi1F,gBAAAA,GAAmB,GACxBj1F,IAAAA,CAAKgsG,aAAAA,GAAAA,CAAgB,GACrBhsG,IAAAA,CAAK4wF,OAAAA,GAAU0c,GAERttG,IAAAA,CAAKutG,YAAAA,AAAAA;YACd;YAQO,MAAMG,CAAAA,EAAoBC,CAAAA,EAAoBj4D,CAAAA,EAAAA;gBACnD11C,IAAAA,CAAKisG,UAAAA,GAAAA,CAAa,GAClBjsG,IAAAA,CAAKksG,gBAAAA,GAAmBwB,GACxB1tG,IAAAA,CAAKmsG,gBAAAA,GAAmBwB,GACxB3tG,IAAAA,CAAKosG,cAAAA,GAAiB12D;YACxB;YAQO,aAAazlC,CAAAA,EAAeylC,IAAmB,CAAA,EAAG43D,IAA2BpgB,GAAgBY,cAAAA,EAAAA;gBAKlG,OAJA9tF,IAAAA,CAAK6tG,YAAAA,GAAe,IAAItpG,QAAkBC,CAAAA;oBACxCxE,IAAAA,CAAK8tG,YAAAA,GAAetpG;gBAAO,IAGzBkxC,IACF11C,CAAAA,IAAAA,CAAKwsG,UAAAA,GAAAA,CAAa,GAClBxsG,IAAAA,CAAK6sG,WAAAA,GAAcS,GACnBttG,IAAAA,CAAK2sG,gBAAAA,GAAmB,GACxB3sG,IAAAA,CAAK4sG,aAAAA,GAAgBl3D,GACrB11C,IAAAA,CAAKysG,UAAAA,GAAazsG,IAAAA,CAAKm5D,IAAAA,EACvBn5D,IAAAA,CAAK0sG,QAAAA,GAAWz8F,GAOXjQ,IAAAA,CAAK6tG,YAAAA,AAAAA,IALV7tG,CAAAA,IAAAA,CAAKwsG,UAAAA,GAAAA,CAAa,GAClBxsG,IAAAA,CAAKm5D,IAAAA,GAAOlpD,GACL1L,QAAQC,OAAAA,CAAAA,CAAQ,EAAA;YAI3B;YAMA,IAAA,WAAW41B;gBACT,OAAIp6B,IAAAA,CAAKu2D,SAAAA,GACAv2D,IAAAA,CAAKu2D,SAAAA,GAGP,IAAIj7C,EAAY,GAAG,GAAG,GAAG;YAClC;YAMO,YAAeyyF,CAAAA,EAAAA;gBACpB/tG,IAAAA,CAAK2rG,iBAAAA,CAAkBhsG,IAAAA,CAAKouG;YAC9B;YAMO,eAAkBA,CAAAA,EAAAA;gBACvBztF,EAAoBytF,GAAgB/tG,IAAAA,CAAK2rG,iBAAAA;YAC3C;YAKO,qBAAAsC;gBACLjuG,IAAAA,CAAK2rG,iBAAAA,CAAkBrrG,MAAAA,GAAS;YAClC;YAUO,WAAW2Z,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAChC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,aAAa,IAAIg6C,GAAeloC,GAAQ68B,GAAS92C,IAAAA,IAClEA,IAAAA,CAAKopD,WAAAA,CAAYnvC,GAAQ68B;YAC3B;YASO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEnC;YAUO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACjC92C,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBnoC,GAAQ68B,GAAS92C,IAAAA,IACpEA,IAAAA,CAAKspD,YAAAA,CAAarvC,GAAQ68B;YAC5B;YASO,aAAa78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEpC;YAKA,IAAA,gBAAWgS;gBACT,OAAO9oD,IAAAA,CAAKkmD,cACd;YAAA;YAEO,YAAYjsC,CAAAA,EAAAA;gBACjB,IAAA,CAAKja,IAAAA,CAAK8oD,aAAAA,EAAe;oBACvB9oD,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GACfja,IAAAA,CAAKkuG,OAAAA,GAAUj0F,EAAOjG,MAAAA;oBAEtB,MAAMm6F,IAAanuG,IAAAA,CAAKkuG,OAAAA,CAAQt1C,WAAAA;oBAChC,IAAIt8C,IAAS5N,EAAIy/F,EAAWh0F,KAAAA,GAAQ,GAAGg0F,EAAW9zF,MAAAA,GAAS;oBAC3D,IAAA,CAAKra,IAAAA,CAAK2iE,OAAAA,CAAQyrC,eAAAA,EAAiB;wBAEjC,MAAMC,IAAMruG,IAAAA,CAAKkuG,OAAAA,CAAQl3C,cAAAA;wBACrBq3C,KACF/xF,CAAAA,IAAS5N,EAAI2/F,EAAIl0F,KAAAA,GAAQ,GAAGk0F,EAAIh0F,MAAAA,GAAS,EAAA;oBAE7C;oBACAra,IAAAA,CAAK8sG,UAAAA,GAAaxwF,EAAOhQ,CAAAA,EACzBtM,IAAAA,CAAK+sG,WAAAA,GAAczwF,EAAOlS,CAAAA,EAGrBpK,IAAAA,CAAK+rG,WAAAA,IACR/rG,CAAAA,IAAAA,CAAK6a,GAAAA,GAAMyB,CAAAA,GAEbtc,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,CAAMjS,IAAAA,CAAKo5D,OAAAA,GAKpBp5D,IAAAA,CAAKsuG,eAAAA,CAAgBtuG,IAAAA,CAAK6a,GAAAA,GAG1B7a,IAAAA,CAAKuuG,aAAAA,CAAct0F,GAAQA,EAAOyG,KAAAA,CAAMo2B,OAAAA,KAGxC92C,IAAAA,CAAK6wD,cAAAA,IAIL7wD,IAAAA,CAAKsuG,eAAAA,CAAgBtuG,IAAAA,CAAK6a,GAAAA,GAC1B7a,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,CAAMjS,IAAAA,CAAKqmG,OAAAA,GAEpBrmG,IAAAA,CAAKgpD,YAAAA,CAAa/uC,IAClBja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIy7C,GAAgB3pC,GAAQja,IAAAA,IAC3DA,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB;gBACxB;YACF;YAOO,aAAajsC,CAAAA,EAAAA,CAEpB;YAIO,KAAyDvS,CAAAA,EAAuBU,CAAAA,EAAAA;gBACrFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAuDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAEO,cAAcsS,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACnC,KAAK,MAAM9sC,KAAKhK,IAAAA,CAAK2rG,iBAAAA,CACnB3rG,IAAAA,CAAK6a,GAAAA,GAAM7Q,EAAEq6C,MAAAA,CAAOrhD,IAAAA,CAAKgH,GAAGA,EAAEqX,MAAAA,EAAQrhB,IAAAA,EAAMia,GAAQ68B;YAExD;YAEO,iBAAA+Z;gBAEL7wD,IAAAA,CAAKu2D,SAAAA,GAAY,IAAIj7C,EACnBtb,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAK8sG,UAAAA,EACd9sG,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAK+sG,WAAAA,EACd/sG,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAK8sG,UAAAA,EACd9sG,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAK+sG,WAAAA;YAElB;YAEO,OAAO9yF,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAc5B,IAbA92C,IAAAA,CAAKmtC,WAAAA,CAAYlzB,IACjBja,IAAAA,CAAKmpD,UAAAA,CAAWlvC,GAAQ68B,IACxB92C,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,CAAMjS,IAAAA,CAAKqmG,OAAAA,GAGpBrmG,IAAAA,CAAK6a,GAAAA,GAAM7a,IAAAA,CAAK6a,GAAAA,CAAIzK,GAAAA,CAAIpQ,IAAAA,CAAKwpD,GAAAA,CAAIv5C,KAAAA,CAAM6mC,IAAU,OACjD92C,IAAAA,CAAKm5D,IAAAA,IAASn5D,IAAAA,CAAK4rG,EAAAA,GAAK90D,IAAW,KAEnC92C,IAAAA,CAAKwpD,GAAAA,GAAMxpD,IAAAA,CAAKwpD,GAAAA,CAAIp5C,GAAAA,CAAIpQ,IAAAA,CAAKypD,GAAAA,CAAIx5C,KAAAA,CAAM6mC,IAAU,OACjD92C,IAAAA,CAAK4rG,EAAAA,IAAO5rG,IAAAA,CAAK6rG,EAAAA,GAAK/0D,IAAW,KAEjC92C,IAAAA,CAAK2iB,QAAAA,IAAa3iB,IAAAA,CAAK2pD,eAAAA,GAAkB7S,IAAW,KAEhD92C,IAAAA,CAAKwsG,UAAAA;oBACP,IAAIxsG,IAAAA,CAAK2sG,gBAAAA,GAAmB3sG,IAAAA,CAAK4sG,aAAAA,EAAe;wBAC9C,MACM4B,IAAAA,AAAUC,CAAAA,GADGzuG,IAAAA,CAAK6sG,WAAAA,AAAAA,EACG7sG,IAAAA,CAAK2sG,gBAAAA,EAAkB3sG,IAAAA,CAAKysG,UAAAA,EAAYzsG,IAAAA,CAAK0sG,QAAAA,EAAU1sG,IAAAA,CAAK4sG,aAAAA;wBAEvF5sG,IAAAA,CAAKm5D,IAAAA,GAAOq1C,GACZxuG,IAAAA,CAAK2sG,gBAAAA,IAAoB71D;oBAC3B,OACE92C,IAAAA,CAAKwsG,UAAAA,GAAAA,CAAa,GAClBxsG,IAAAA,CAAKm5D,IAAAA,GAAOn5D,IAAAA,CAAK0sG,QAAAA,EACjB1sG,IAAAA,CAAK2sG,gBAAAA,GAAmB,GACxB3sG,IAAAA,CAAK8tG,YAAAA,CAAAA,CAAa;;gBAItB,IAAI9tG,IAAAA,CAAKgsG,aAAAA;oBACP,IAAIhsG,IAAAA,CAAKi1F,gBAAAA,GAAmBj1F,IAAAA,CAAKk1F,aAAAA,EAAe;wBAC9C,MAEMwZ,IAFaxhB,GAAgBG,0BAAAA,CAA2BrtF,IAAAA,CAAK4wF,OAAAA,EAEtC5wF,IAAAA,CAAKi1F,gBAAAA,EAAkBj1F,IAAAA,CAAKm1F,UAAAA,EAAYn1F,IAAAA,CAAKo1F,QAAAA,EAAUp1F,IAAAA,CAAKk1F,aAAAA;wBAEzFl1F,IAAAA,CAAK6a,GAAAA,GAAM6zF,GAEX1uG,IAAAA,CAAKi1F,gBAAAA,IAAoBn+C;oBAC3B,OAAO;wBACL92C,IAAAA,CAAK6a,GAAAA,GAAM7a,IAAAA,CAAKo1F,QAAAA;wBAChB,MAAM7wD,IAAMvkC,IAAAA,CAAKo1F,QAAAA,CAASnjF,KAAAA;wBAE1BjS,IAAAA,CAAKm1F,UAAAA,GAAa,MAClBn1F,IAAAA,CAAKo1F,QAAAA,GAAW,MAChBp1F,IAAAA,CAAKi1F,gBAAAA,GAAmB,GACxBj1F,IAAAA,CAAKgsG,aAAAA,GAAAA,CAAgB,GAErBhsG,IAAAA,CAAKwtG,YAAAA,CAAajpE;oBACpB;;gBAGEvkC,IAAAA,CAAK4uG,cAAAA,KACP5uG,CAAAA,IAAAA,CAAKisG,UAAAA,GAAAA,CAAa,GAClBjsG,IAAAA,CAAKqsG,iBAAAA,GAAoB,GACzBrsG,IAAAA,CAAKksG,gBAAAA,GAAmB,GACxBlsG,IAAAA,CAAKmsG,gBAAAA,GAAmB,GACxBnsG,IAAAA,CAAKosG,cAAAA,GAAiB,GACtBpsG,IAAAA,CAAKssG,OAAAA,GAAU,GACftsG,IAAAA,CAAKusG,OAAAA,GAAU,CAAA,IAEfvsG,CAAAA,IAAAA,CAAKqsG,iBAAAA,IAAqBv1D,GAC1B92C,IAAAA,CAAKssG,OAAAA,GAA0D,IAA9ChnG,CAAAA,KAAKqI,MAAAA,KAAW3N,IAAAA,CAAKksG,gBAAAA,GAAoB,CAAA,GAC1DlsG,IAAAA,CAAKusG,OAAAA,GAA0D,IAA9CjnG,CAAAA,KAAKqI,MAAAA,KAAW3N,IAAAA,CAAKmsG,gBAAAA,GAAoB,CAAA,CAAA,GAG5DnsG,IAAAA,CAAKuuG,aAAAA,CAAct0F,GAAQ68B,IAE3B92C,IAAAA,CAAK6wD,cAAAA,IAIL7wD,IAAAA,CAAKsuG,eAAAA,CAAgBtuG,IAAAA,CAAK6a,GAAAA,GAC1B7a,IAAAA,CAAKqpD,WAAAA,CAAYpvC,GAAQ68B,IACzB92C,IAAAA,CAAK+rG,WAAAA,GAAAA,CAAc;YACrB;YAOO,KAAK30E,CAAAA,EAAAA;gBAMV,IAJAp3B,IAAAA,CAAK6a,GAAAA,CAAI5I,KAAAA,CAAMjS,IAAAA,CAAKo5D,OAAAA,GAIhBp5D,IAAAA,CAAK2iE,OAAAA,CAAQksC,mBAAAA,EAAqB;oBACpC,MAAMC,IAAQ9uG,IAAAA,CAAK2iE,OAAAA,CAAQosC,iBAAAA,GAAoB/uG,IAAAA,CAAK2iE,OAAAA,CAAQksC,mBAAAA,EACtDG,IAAkBhvG,IAAAA,CAAK6a,GAAAA,CAAI5K,KAAAA,CAAM6+F,GAAO1+F,GAAAA,CAAIpQ,IAAAA,CAAKqmG,OAAAA,CAAQp2F,KAAAA,CAAM,IAAM6+F;oBAC3EE,EAAgB/8F,KAAAA,CAAMjS,IAAAA,CAAKo5D,OAAAA,GAC3Bp5D,IAAAA,CAAKsuG,eAAAA,CAAgBU;gBACvB;gBAEA,IAAI53E,EAAIgO,WAAAA,EAAa;oBACnB,MAAM6pE,IAAUjvG,IAAAA,CAAKo5D,OAAAA,CAAQnnD,KAAAA,CAAMjS,IAAAA,CAAKgtG,QAAAA;oBACxCiC,EAAQ3iG,CAAAA,GAAAA,CAAAA,CAAO2iG,CAAAA,EAAQ3iG,CAAAA,GAAIg5B,KAAmB94B,EAAKyiG,EAAQ3iG,CAAAA,CAAAA,GAC3D2iG,EAAQ7kG,CAAAA,GAAAA,CAAAA,CAAO6kG,CAAAA,EAAQ7kG,CAAAA,GAAIk7B,KAAmB94B,EAAKyiG,EAAQ7kG,CAAAA,CAAAA,GAC3D6kG,EAAQh9F,KAAAA,CAAMjS,IAAAA,CAAKo5D,OAAAA,GACnBp5D,IAAAA,CAAKsuG,eAAAA,CAAgBW;gBACvB;gBACA73E,EAAI1jB,QAAAA,CAAS1T,IAAAA,CAAK+c,SAAAA;YACpB;YAEO,gBAAgBlC,CAAAA,EAAAA;gBAErB,MAAMq0F,IAAiBlvG,IAAAA,CAAKkuG,OAAAA,CAAQ9zF,UAAAA,CAAWD,KAAAA,GAAQna,IAAAA,CAAKm5D,IAAAA,EACtDg2C,IAAkBnvG,IAAAA,CAAKkuG,OAAAA,CAAQ9zF,UAAAA,CAAWC,MAAAA,GAASra,IAAAA,CAAKm5D,IAAAA,EACxDi2C,IAAY1gG,EAAAA,CAAKmM,EAAIvO,CAAAA,GAAI4iG,IAAiB,IAAIlvG,IAAAA,CAAKssG,OAAAA,EAAAA,CAAUzxF,EAAIzQ,CAAAA,GAAI+kG,IAAkB,IAAInvG,IAAAA,CAAKusG,OAAAA;gBAGtGvsG,IAAAA,CAAK+c,SAAAA,CAAUpB,KAAAA,IAEf3b,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,CAAMjQ,IAAAA,CAAKm5D,IAAAA,EAAMn5D,IAAAA,CAAKm5D,IAAAA,GAGrCn5D,IAAAA,CAAK+c,SAAAA,CAAUJ,SAAAA,CAAUuyF,IAAiB,GAAGC,IAAkB,IAC/DnvG,IAAAA,CAAK+c,SAAAA,CAAUlL,MAAAA,CAAO7R,IAAAA,CAAK2iB,QAAAA,GAC3B3iB,IAAAA,CAAK+c,SAAAA,CAAUJ,SAAAA,CAAAA,CAAWuyF,IAAiB,GAAA,CAAIC,IAAkB,IAEjEnvG,IAAAA,CAAK+c,SAAAA,CAAUJ,SAAAA,CAAUyyF,EAAU9iG,CAAAA,EAAG8iG,EAAUhlG,CAAAA,GAChDpK,IAAAA,CAAK+c,SAAAA,CAAUyJ,OAAAA,CAAQxmB,IAAAA,CAAKwmB,OAAAA;YAC9B;YAEQ,iBAAAooF;gBACN,OAAA,CAAQ5uG,IAAAA,CAAKisG,UAAAA,IAAcjsG,IAAAA,CAAKqsG,iBAAAA,IAAqBrsG,IAAAA,CAAKosG,cAC5D;YAAA;QAAA;QC70BK,MAAMiD,KAAgB;YAC3BC,aAAa;YACbC,cAAc;QAAA;QA8BT,MAAMC,WAAgBhmB;YAoB3B,YAAYvwE,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,CAAM;oBAAA,GAAK3T,CAAAA;gBAAAA,IApBN,IAAA,CAAAiB,MAAAA,GAAS,IAAIhT,GAsBlBlH,IAAAA,CAAKgI,MAAAA,GAAuB,SAAd,CAAA,IAAAiR,EAAQjR,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI,IAAA,CAAO,GACvChI,IAAAA,CAAK6uF,MAAAA,GAAuB,SAAd,CAAA,IAAA51E,EAAQ41E,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAA,IAC5B7uF,IAAAA,CAAKqkD,MAAAA,GAAuB,SAAd,CAAA,IAAAprC,EAAQorC,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI,KAAgB,GAChDrkD,IAAAA,CAAKqhB,MAAAA,GAASpI,EAAQoI,MAAAA,EAEtBrhB,IAAAA,CAAK8/C,QAAAA,CAASL,SAAAA,GAA2B,SAAf,CAAA,IAAAxmC,EAAQumC,OAAAA,AAAAA,KAAAA,KAAO,MAAA,KAAA,GACzCx/C,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,GAAgBjC,GAAcw0B,OAAAA,EAExCj/F,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,kBAAkB,CAAA,EAAGwX,OAAO6tD,CAAAA,EAAAA;oBACpC9sE,IAAAA,CAAKyvG,cAAAA,CAAe3iC,EAASl7B,KAAAA,KAIlC5xC,CAAAA,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS,IAAI87C,GAAkBjkD,IAAAA,EAAM8sE,EAASl7B,KAAAA,IAC/D5xC,IAAAA,CAAK0vG,eAAAA,CAAgB5iC,EAASl7B,KAAAA,GAEV,MAAhB5xC,IAAAA,CAAK6uF,MAAAA,IACP7uF,IAAAA,CAAKwmD,IAAAA,EAAAA;gBACP,IAGFxmD,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAG,gBAAgB,CAAA,EAAGwX,OAAO6tD,CAAAA,EAAAA;oBACnC9sE,IAAAA,CAAKyvG,cAAAA,CAAe3iC,EAASl7B,KAAAA,KAC/B5xC,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ,IAAIg8C,GAAiBnkD,IAAAA,EAAM8sE,EAASl7B,KAAAA;gBAC/D;YAEJ;YAEQ,eAAesS,CAAAA,EAAAA;gBACrB,OAAOlkD,IAAAA,CAAKgI,MAAAA,CAAOk8C,MAAAA,CAAAA,KAA4BpjD,MAAhBd,IAAAA,CAAKqhB,MAAAA,IAAwBrhB,IAAAA,CAAKqhB,MAAAA,KAAW6iC,CAAAA;YAC9E;YAEQ,gBAAgB7iC,CAAAA,EAAAA;gBACF,MAAhBrhB,IAAAA,CAAK6uF,MAAAA,IACP7uF,CAAAA,IAAAA,CAAKqkD,MAAAA,CAAOrhD,IAAAA,CAAKhD,IAAAA,EAAMqhB,IACvBrhB,IAAAA,CAAK6uF,MAAAA,EAAAA;YAET;QAAA;QCrGK,MAAM8gB,KAAiB;YAC5BC,SAAAA,KAAUhhG;YACVihG,QAAAA;YACAC,SAAS;YACTC,OAAO;YACPC,QAAQphG,IAAAA;QAAAA;QCDV,IAAYqhG;QAAAA,CAAZ,SAAYA,CAAAA;YACV,EAAA,MAAA,GAAA,UACA,EAAA,IAAA,GAAA;QACD,EAHWA,MAAAA,CAAAA,KAAU,CAAA,CAAA;QA+Bf,MAAeC;QAAAA;QAWN,GAAAnsE,QAAAA,GAAmB4rE,GAAeG,OAAAA;QC1C3C,MAAMK;YAMX,YAAoBC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GALb,IAAA,CAAAC,QAAAA,GAAqB,EAAA,EACrB,IAAA,CAAAC,YAAAA,GAA+C,CAAC,GAC/C,IAAA,CAAAC,qBAAAA,GAAwB,IAAIjiF,KAC5B,IAAA,CAAAkiF,uBAAAA,GAA0B,IAAIliF,KA4B9B,IAAA,CAAAmiF,wBAAAA,GAA2B,IAAOnxF,CAAAA;wBACxCtf,IAAAA,CAAK0wG,SAAAA,CAAUpxF;oBAAE,GAGX,IAAA,CAAAqxF,0BAAAA,GAA6B,IAAOrxF,CAAAA;wBAC1Ctf,IAAAA,CAAK4wG,YAAAA,CAAatxF,GAAAA,CAAG;oBAAM,GA2ErB,IAAA,CAAAuxF,iBAAAA,GAA8B,EA1GF;YAAA;YAO7B,eAAe7qD,CAAAA,EAAclP,CAAAA,EAAAA;gBAClC,IAAK,IAAIi6D,IAAc,GAAGA,IAAc/wG,IAAAA,CAAKqwG,QAAAA,CAAS/vG,MAAAA,EAAQywG,IAAe;oBAC3E,MAAM7sD,IAASlkD,IAAAA,CAAKqwG,QAAAA,CAASU,EAAAA;oBAC7B7sD,EAAOzW,MAAAA,CAAOuY,EAAM/rC,MAAAA,EAAQ68B,IACvBoN,EAAO+B,QAAAA,IACVjmD,IAAAA,CAAK4wG,YAAAA,CAAa1sD;gBAEtB;YACF;YAEO,yBAAA8sD;gBACL,IAAK,IAAID,IAAc,GAAGA,IAAc/wG,IAAAA,CAAKqwG,QAAAA,CAAS/vG,MAAAA,EAAQywG,IAAe;oBAC3E,MAAM7sD,IAASlkD,IAAAA,CAAKqwG,QAAAA,CAASU,EAAAA;oBACxB7sD,EAAO+B,QAAAA,IACVjmD,IAAAA,CAAK4wG,YAAAA,CAAa1sD;gBAEtB;YACF;YAcO,UAAUA,CAAAA,EAAAA;gBAGf,IAFAA,EAAO+B,QAAAA,GAAAA,CAAW,GAClB/B,EAAO8B,KAAAA,GAAQhmD,IAAAA,CAAKowG,MAAAA,CAAOpqD,KAAAA,EACvB9B,KAAAA,CAAWlkD,IAAAA,CAAKswG,YAAAA,CAAapsD,EAAOtkD,EAAAA,CAAAA,EAAK;oBAC3CI,IAAAA,CAAKswG,YAAAA,CAAapsD,EAAOtkD,EAAAA,CAAAA,GAAMskD,GAC/BlkD,IAAAA,CAAKqwG,QAAAA,CAAS1wG,IAAAA,CAAKukD,IACnBlkD,IAAAA,CAAKowG,MAAAA,CAAOa,YAAAA,CAAaP,SAAAA,CAAUxsD,IAGnCA,EAAOrT,QAAAA,CAASsN,OAAAA,CAAS1pC,CAAAA;wBACvBA,EAAEuxC,KAAAA,GAAQ9B,EAAO8B,KAAAA,EACjBhmD,IAAAA,CAAK0wG,SAAAA,CAAUj8F;oBAAE;oBAEnB,MAAMy8F,IAAalxG,IAAAA,CAAKywG,wBAAAA;oBACxBzwG,IAAAA,CAAKuwG,qBAAAA,CAAsBvlF,GAAAA,CAAIk5B,GAAQgtD;oBACvC,MAAMC,IAAenxG,IAAAA,CAAK2wG,0BAAAA;oBAC1B3wG,IAAAA,CAAKwwG,uBAAAA,CAAwBxlF,GAAAA,CAAIk5B,GAAQitD,IACzCjtD,EAAO7Q,cAAAA,CAAelB,SAAAA,CAAU++D,IAChChtD,EAAO5Q,gBAAAA,CAAiBnB,SAAAA,CAAUg/D;gBACpC;YACF;YAIO,aAAaC,CAAAA,EAA6BrzD,IAAAA,CAAW,CAAA,EAAA;gBAAA,IAAA,GAAA;gBAC1D,IAAIn+C,IAAK;gBAEPA,IADEwxG,aAAsBhsD,KACnBgsD,EAAWxxG,EAAAA,GAEXwxG;gBAEP,MAAMltD,IAASlkD,IAAAA,CAAKswG,YAAAA,CAAa1wG,EAAAA;gBAKjC,IAJIskD,KAAUA,EAAO+B,QAAAA,IACnB/B,CAAAA,EAAO+B,QAAAA,GAAAA,CAAW,CAAA,GAGhB/B,KAAUnG,GACZ/9C,IAAAA,CAAK6wG,iBAAAA,CAAkBlxG,IAAAA,CAAKukD;qBAK9B,IAAA,OADOlkD,IAAAA,CAAKswG,YAAAA,CAAa1wG,EAAAA,EACrBskD,GAAQ;oBACVA,EAAO8B,KAAAA,GAAQ,MACf1lC,EAAoB4jC,GAAQlkD,IAAAA,CAAKqwG,QAAAA,GACjCrwG,IAAAA,CAAKowG,MAAAA,CAAOa,YAAAA,CAAaL,YAAAA,CAAa1sD,IAGtCA,EAAOrT,QAAAA,CAASsN,OAAAA,CAAS1pC,CAAAA;wBACvBA,EAAEuxC,KAAAA,GAAQ,MACVhmD,IAAAA,CAAK4wG,YAAAA,CAAan8F,GAAGspC;oBAAS;oBAEhC,MAAMszD,IAAoBrxG,IAAAA,CAAKuwG,qBAAAA,CAAsB5tG,GAAAA,CAAIuhD;oBACrDmtD,KACFntD,EAAO7Q,cAAAA,CAAef,WAAAA,CAAY++D;oBAEpC,MAAMC,IAAsBtxG,IAAAA,CAAKwwG,uBAAAA,CAAwB7tG,GAAAA,CAAIuhD;oBACzDotD,KACFptD,EAAO5Q,gBAAAA,CAAiBhB,WAAAA,CAAYg/D,IAAAA,AAIhB,CAAA,SAAlB,CAAA,IAAW,SAAX,CAAA,IAAAtxG,IAAAA,CAAKowG,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEpqD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE/rC,MAAAA,AAAAA,KACtBja,IAAAA,CAAKowG,MAAAA,CAAOpqD,KAAAA,CAAM/rC,MAAAA,CAAOuoC,KAAAA,CAAM+uD,SAAAA,CAAUC,MAAAA,CAAOC,MAAAA;gBAEpD;YACF;YAGO,wBAAAC;gBACL,IAAK,IAAIX,IAAc,GAAGA,IAAc/wG,IAAAA,CAAK6wG,iBAAAA,CAAkBvwG,MAAAA,EAAQywG,IAAe;oBACpF,MAAM7sD,IAASlkD,IAAAA,CAAK6wG,iBAAAA,CAAkBE,EAAAA;oBAClC7sD,EAAO+B,QAAAA,IAGXjmD,IAAAA,CAAK4wG,YAAAA,CAAa1sD,GAAAA,CAAQ;gBAC5B;gBACAlkD,IAAAA,CAAK6wG,iBAAAA,CAAkBvwG,MAAAA,GAAS;YAClC;YAEO,2BAAAqxG;gBACL,IAAK,IAAIZ,IAAc,GAAGA,IAAc/wG,IAAAA,CAAKqwG,QAAAA,CAAS/vG,MAAAA,EAAQywG,IAC7C/wG,IAAAA,CAAKqwG,QAAAA,CAASU,EAAAA,CACtBloD,uBAAAA;YAEX;YAEO,QAAQjpD,CAAAA,EAAAA;gBACb,OAAOI,IAAAA,CAAKswG,YAAAA,CAAa1wG,EAC3B;YAAA;YAEO,UAAU6uB,CAAAA,EAAAA;gBACf,OAAOzuB,IAAAA,CAAKqwG,QAAAA,CAASroG,MAAAA,CAAQsX,CAAAA,IAAMA,EAAEmP,IAAAA,KAASA;YAChD;YAEO,QAAAjnB;gBACL,IAAK,IAAIhH,IAAIR,IAAAA,CAAKqwG,QAAAA,CAAS/vG,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAC7CR,IAAAA,CAAK4wG,YAAAA,CAAa5wG,IAAAA,CAAKqwG,QAAAA,CAAS7vG,EAAAA;YAEpC;QAAA;QCxIK,MAAMsxG;YAaX,YAA4BC,CAAAA,CAAAA;gBAC1B,IAD0B,IAAA,CAAAA,kBAAAA,GAAAA,GAXrB,IAAA,CAAAlsD,UAAAA,GAAa,IAAI5uC,KACjB,IAAA,CAAAo5F,QAAAA,GAA8D,EAAA,EAI9D,IAAA,CAAA2B,YAAAA,GAAe,IAAIlgE,IAInB,IAAA,CAAAmgE,cAAAA,GAAiB,IAAIngE,IAGQ,MAA9BigE,EAAmBzxG,MAAAA,EACrB,MAAM,IAAI6F,MAAM;gBAElB,KAAK,MAAMM,KAAQsrG,EACjB/xG,IAAAA,CAAK6lD,UAAAA,CAAWz1C,GAAAA,CAAI3J;gBAGtBzG,IAAAA,CAAKJ,EAAAA,GAAKkyG,GAAMtrG,QAAAA,CAASurG;YAC3B;YAEA,OAAA,SAAgBA,CAAAA,EAAAA;gBAId,OAAOA,EACJxmG,KAAAA,GACAtL,GAAAA,CAAKwU,CAAAA,IAAMA,EAAEga,IAAAA,EACbkjC,IAAAA,GACApxD,IAAAA,CAAK;YACV;YAMA,YAAY2jD,CAAAA,EAAAA;gBACV,OAAA,CAAKlkD,CAAAA,IAAAA,CAAKqwG,QAAAA,CAASpvF,QAAAA,CAASijC,MAAAA,CAAWA,EAAOiD,MAAAA,CAAOp9C,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK6lD,UAAAA,EAAAA,KACnE7lD,CAAAA,IAAAA,CAAKqwG,QAAAA,CAAS1wG,IAAAA,CAAKukD,IACnBlkD,IAAAA,CAAKgyG,YAAAA,CAAaz/D,SAAAA,CAAU2R,IAAAA,CACrB,CAAA;YAGX;YAEA,aAAaA,CAAAA,EAAAA;gBACX,MAAM14C,IAAQxL,IAAAA,CAAKqwG,QAAAA,CAAS5nG,OAAAA,CAAQy7C;gBAChC14C,IAAAA,MACFxL,CAAAA,IAAAA,CAAKqwG,QAAAA,CAAS3nG,MAAAA,CAAO8C,GAAO,IAC5BxL,IAAAA,CAAKiyG,cAAAA,CAAe1/D,SAAAA,CAAU2R,EAAAA;YAElC;YAMO,YAAYyN,CAAAA,EAAAA;gBAIjB,OAHIA,KACF3xD,IAAAA,CAAKqwG,QAAAA,CAAS1+C,IAAAA,CAAKA,IAEd3xD,IAAAA,CAAKqwG,QACd;YAAA;QAAA;QC5EK,MAAM+B;YAaX,YAA4B9qD,CAAAA,CAAAA;gBAC1B,IAD0B,IAAA,CAAAA,YAAAA,GAAAA,GAXrB,IAAA,CAAAX,IAAAA,GAAO,IAAI1vC,KACX,IAAA,CAAAo5F,QAAAA,GAA0B,EAAA,EAI1B,IAAA,CAAA2B,YAAAA,GAAe,IAAIlgE,IAInB,IAAA,CAAAmgE,cAAAA,GAAiB,IAAIngE,IAGE,MAAxBwV,EAAahnD,MAAAA,EACf,MAAM,IAAI6F,MAAM;gBAElB,KAAK,MAAM0gD,KAAOS,EAChBtnD,IAAAA,CAAK2mD,IAAAA,CAAKv2C,GAAAA,CAAIy2C;gBAGhB7mD,IAAAA,CAAKJ,EAAAA,GAAKwyG,GAAS5rG,QAAAA,CAAS8gD;YAC9B;YAEA,OAAA,SAAgByqD,CAAAA,EAAAA;gBACd,OAAOA,EAAmBxmG,KAAAA,GAAQomD,IAAAA,GAAOpxD,IAAAA,CAAK;YAChD;YAEA,YAAY2jD,CAAAA,EAAAA;gBACV,OAAA,CAAKlkD,CAAAA,IAAAA,CAAKqwG,QAAAA,CAASpvF,QAAAA,CAASijC,MAAAA,CAAWA,EAAOmD,UAAAA,CAAWt9C,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK2mD,IAAAA,EAAAA,KACvE3mD,CAAAA,IAAAA,CAAKqwG,QAAAA,CAAS1wG,IAAAA,CAAKukD,IACnBlkD,IAAAA,CAAKgyG,YAAAA,CAAaz/D,SAAAA,CAAU2R,IAAAA,CACrB,CAAA;YAGX;YAEA,aAAaA,CAAAA,EAAAA;gBACX,MAAM14C,IAAQxL,IAAAA,CAAKqwG,QAAAA,CAAS5nG,OAAAA,CAAQy7C;gBAChC14C,IAAAA,MACFxL,CAAAA,IAAAA,CAAKqwG,QAAAA,CAAS3nG,MAAAA,CAAO8C,GAAO,IAC5BxL,IAAAA,CAAKiyG,cAAAA,CAAe1/D,SAAAA,CAAU2R,EAAAA;YAElC;YAMO,YAAYyN,CAAAA,EAAAA;gBAIjB,OAHIA,KACF3xD,IAAAA,CAAKqwG,QAAAA,CAAS1+C,IAAAA,CAAKA,IAEd3xD,IAAAA,CAAKqwG,QACd;YAAA;QAAA;QChDK,MAAMgC;YAWX,YAAoBjC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GAVZ,IAAA,CAAAkC,QAAAA,GAAW,IAAIhkF,KACf,IAAA,CAAAikF,qBAAAA,GAAwB,IAAIjkF,KAC5B,IAAA,CAAAkkF,wBAAAA,GAA2B,IAAIlkF,KAC/B,IAAA,CAAAmkF,wBAAAA,GAA2B,IAAInkF,KAE/B,IAAA,CAAAokF,WAAAA,GAAc,IAAIpkF,KAClB,IAAA,CAAAqkF,eAAAA,GAAkB,IAAIrkF,KACtB,IAAA,CAAAskF,kBAAAA,GAAqB,IAAItkF,KACzB,IAAA,CAAAukF,kBAAAA,GAAqB,IAAIvkF,KA8DzB,IAAA,CAAAwkF,0BAAAA,GAA8B5uD,CAAAA,IAAoBzvC,CAAAA;wBACxDzU,IAAAA,CAAKsmD,YAAAA,CAAapC,GAAQzvC;oBAAE,GAGtB,IAAA,CAAAs+F,6BAAAA,GAAiC7uD,CAAAA,IAAoBzvC,CAAAA;wBAC3DzU,IAAAA,CAAKqoD,eAAAA,CAAgBnE,GAAQzvC;oBAAE,GAGzB,IAAA,CAAAu+F,oBAAAA,GAAwB9uD,CAAAA,IAAoB2C,CAAAA;wBAClD7mD,IAAAA,CAAK8mD,MAAAA,CAAO5C,GAAQ2C;oBAAI,GAGlB,IAAA,CAAAosD,uBAAAA,GAA2B/uD,CAAAA,IAAoB2C,CAAAA;wBACrD7mD,IAAAA,CAAK+mD,SAAAA,CAAU7C,GAAQ2C;oBAAI;YAzEO;YAE7B,YACLkrD,CAAAA,EAAAA;gBAEA,MAAMnyG,IAAKkyG,GAAMtrG,QAAAA,CAASurG;gBAC1B,IAAI/xG,IAAAA,CAAKsyG,QAAAA,CAASv6F,GAAAA,CAAInY,IAEpB,OAAOI,IAAAA,CAAKsyG,QAAAA,CAAS3vG,GAAAA,CAAI/C;gBAG3B,MAAM4vE,IAAQ,IAAIsiC,GAAMC;gBAExB/xG,IAAAA,CAAKsyG,QAAAA,CAAStnF,GAAAA,CAAIwkD,EAAM5vE,EAAAA,EAAI4vE;gBAG5B,KAAK,MAAM77B,KAAao+D,EAAoB;oBAC1C,MAAMoB,IAAUnzG,IAAAA,CAAKyyG,wBAAAA,CAAyB9vG,GAAAA,CAAIgxC;oBAC7Cw/D,IAGHA,EAAQxzG,IAAAA,CAAK6vE,KAFbxvE,IAAAA,CAAKyyG,wBAAAA,CAAyBznF,GAAAA,CAAI2oB,GAAW;wBAAC67B;qBAAAA;gBAIlD;gBAEA,KAAK,MAAMtrB,KAAUlkD,IAAAA,CAAKowG,MAAAA,CAAOC,QAAAA,CAC/BrwG,IAAAA,CAAK0wG,SAAAA,CAAUxsD;gBAGjB,OAAOsrB;YACT;YAEO,eAA0CloB,CAAAA,EAAAA;gBAC/C,MAAM1nD,IAAKwyG,GAAS5rG,QAAAA,CAAS8gD;gBAC7B,IAAItnD,IAAAA,CAAK0yG,WAAAA,CAAY36F,GAAAA,CAAInY,IAEvB,OAAOI,IAAAA,CAAK0yG,WAAAA,CAAY/vG,GAAAA,CAAI/C;gBAG9B,MAAM4vE,IAAQ,IAAI4iC,GAAS9qD;gBAE3BtnD,IAAAA,CAAK0yG,WAAAA,CAAY1nF,GAAAA,CAAIwkD,EAAM5vE,EAAAA,EAAI4vE;gBAG/B,KAAK,MAAM3oB,KAAOS,EAAc;oBAC9B,MAAM6rD,IAAUnzG,IAAAA,CAAK6yG,kBAAAA,CAAmBlwG,GAAAA,CAAIkkD;oBACvCssD,IAGHA,EAAQxzG,IAAAA,CAAK6vE,KAFbxvE,IAAAA,CAAK6yG,kBAAAA,CAAmB7nF,GAAAA,CAAI67B,GAAK;wBAAC2oB;qBAAAA;gBAItC;gBAEA,KAAK,MAAMtrB,KAAUlkD,IAAAA,CAAKowG,MAAAA,CAAOC,QAAAA,CAC/BrwG,IAAAA,CAAK0wG,SAAAA,CAAUxsD;gBAGjB,OAAOsrB;YACT;YAsBA,UAAUtrB,CAAAA,EAAAA;gBACR,MAAMmvD,IAAoBrzG,IAAAA,CAAKuyG,qBAAAA,CAAsB5vG,GAAAA,CAAIuhD,IACnDovD,IAAuBtzG,IAAAA,CAAKwyG,wBAAAA,CAAyB7vG,GAAAA,CAAIuhD,IACzDoC,IAAe+sD,QAAAA,IAAAA,IAAqBrzG,IAAAA,CAAK8yG,0BAAAA,CAA2B5uD,IACpEmE,IAAkBirD,QAAAA,IAAAA,IAAwBtzG,IAAAA,CAAK+yG,6BAAAA,CAA8B7uD;gBACnFlkD,IAAAA,CAAKuyG,qBAAAA,CAAsBvnF,GAAAA,CAAIk5B,GAAQoC,IACvCtmD,IAAAA,CAAKwyG,wBAAAA,CAAyBxnF,GAAAA,CAAIk5B,GAAQmE;gBAE1C,MAAMkrD,IAAcvzG,IAAAA,CAAK2yG,eAAAA,CAAgBhwG,GAAAA,CAAIuhD,IACvCsvD,IAAiBxzG,IAAAA,CAAK4yG,kBAAAA,CAAmBjwG,GAAAA,CAAIuhD,IAC7C4C,IAASysD,QAAAA,IAAAA,IAAevzG,IAAAA,CAAKgzG,oBAAAA,CAAqB9uD,IAClD6C,IAAYysD,QAAAA,IAAAA,IAAkBxzG,IAAAA,CAAKizG,uBAAAA,CAAwB/uD;gBACjElkD,IAAAA,CAAK2yG,eAAAA,CAAgB3nF,GAAAA,CAAIk5B,GAAQ4C,IACjC9mD,IAAAA,CAAK4yG,kBAAAA,CAAmB5nF,GAAAA,CAAIk5B,GAAQ6C;gBAEpC,KAAK,MAAMyoB,KAASxvE,IAAAA,CAAKsyG,QAAAA,CAASprD,MAAAA,GAChCsoB,EAAM0iC,WAAAA,CAAYhuD;gBAEpB,KAAK,MAAMuvD,KAAYzzG,IAAAA,CAAK0yG,WAAAA,CAAYxrD,MAAAA,GACtCusD,EAASvB,WAAAA,CAAYhuD;gBAEvBA,EAAOuB,eAAAA,CAAgBtT,SAAAA,CAAUmU,IACjCpC,EAAOwB,iBAAAA,CAAkBvT,SAAAA,CAAUkW,IACnCnE,EAAOyB,SAAAA,CAAUxT,SAAAA,CAAU2U,IAC3B5C,EAAO0B,WAAAA,CAAYzT,SAAAA,CAAU4U;YAC/B;YAMA,aAAa7C,CAAAA,EAAAA;gBAEX,MAAMoC,IAAetmD,IAAAA,CAAKuyG,qBAAAA,CAAsB5vG,GAAAA,CAAIuhD,IAC9CmE,IAAkBroD,IAAAA,CAAKwyG,wBAAAA,CAAyB7vG,GAAAA,CAAIuhD;gBAC1D,KAAK,MAAMsrB,KAASxvE,IAAAA,CAAKsyG,QAAAA,CAASprD,MAAAA,GAChCsoB,EAAMohC,YAAAA,CAAa1sD;gBAEjBoC,KACFpC,EAAOuB,eAAAA,CAAgBnT,WAAAA,CAAYgU,IAEjC+B,KACFnE,EAAOwB,iBAAAA,CAAkBpT,WAAAA,CAAY+V;gBAIvC,MAAMvB,IAAS9mD,IAAAA,CAAK2yG,eAAAA,CAAgBhwG,GAAAA,CAAIuhD,IAClC6C,IAAY/mD,IAAAA,CAAK4yG,kBAAAA,CAAmBjwG,GAAAA,CAAIuhD;gBAC9C,KAAK,MAAMuvD,KAAYzzG,IAAAA,CAAK0yG,WAAAA,CAAYxrD,MAAAA,GACtCusD,EAAS7C,YAAAA,CAAa1sD;gBAGpB4C,KACF5C,EAAOyB,SAAAA,CAAUrT,WAAAA,CAAYwU,IAE3BC,KACF7C,EAAO0B,WAAAA,CAAYtT,WAAAA,CAAYyU;YAEnC;YAOA,aAAa7C,CAAAA,EAAgBvQ,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC3B,MAAMw/D,IAAwF,SAA9E,CAAA,IAAAnzG,IAAAA,CAAKyyG,wBAAAA,CAAyB9vG,GAAAA,CAAIgxC,EAAUhtC,WAAAA,CAAAA,KAAAA,KAAkC,MAAA,IAAA,IAAI,EAAA;gBAClG,KAAK,MAAM6oE,KAAS2jC,EAClB3jC,EAAM0iC,WAAAA,CAAYhuD;YAEtB;YAOA,gBAAgBA,CAAAA,EAAgBvQ,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC9B,MAAMw/D,IAAwF,SAA9E,CAAA,IAAAnzG,IAAAA,CAAKyyG,wBAAAA,CAAyB9vG,GAAAA,CAAIgxC,EAAUhtC,WAAAA,CAAAA,KAAAA,KAAkC,MAAA,IAAA,IAAI,EAAA;gBAClG,KAAK,MAAM6oE,KAAS2jC,EAClB3jC,EAAMohC,YAAAA,CAAa1sD;YAEvB;YAOA,OAAOA,CAAAA,EAAgB2C,CAAAA,EAAAA;gBAAAA,IAAAA;gBACrB,MAAMssD,IAA0C,SAAhC,CAAA,IAAAnzG,IAAAA,CAAK6yG,kBAAAA,CAAmBlwG,GAAAA,CAAIkkD,EAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,EAAA;gBACpD,KAAK,MAAM2oB,KAAS2jC,EAClB3jC,EAAM0iC,WAAAA,CAAYhuD;YAEtB;YAOA,UAAUA,CAAAA,EAAgB2C,CAAAA,EAAAA;gBAAAA,IAAAA;gBACxB,MAAMssD,IAA0C,SAAhC,CAAA,IAAAnzG,IAAAA,CAAK6yG,kBAAAA,CAAmBlwG,GAAAA,CAAIkkD,EAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,EAAA;gBACpD,KAAK,MAAM2oB,KAAS2jC,EAClB3jC,EAAMohC,YAAAA,CAAa1sD;YAEvB;QAAA;QClMK,SAASwvD,GAAoBpnG,CAAAA;YAAAA,IAAAA,GAAAA;YAClC,OAAA,CAAA,CAASA,CAAAA,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,CAAAA,CAAwC,CAAA,SAAzB,CAAA,IAAY,SAAZ,CAAA,IAAAwJ,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE6D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE8nB,IAAAA,AAAAA;QACxD;QAMO,MAAMklF;YAMX,YAAoBvD,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GAFb,IAAA,CAAAwD,OAAAA,GAAoB,EAAA,EACpB,IAAA,CAAAC,WAAAA,GAAAA,CAAc;YACe;YAM7B,IAAsBC,CAAAA,EAAAA;gBAC3B,OAAO9zG,IAAAA,CAAK4zG,OAAAA,CAAQxiD,IAAAA,CAAMpnD,CAAAA,IAAMA,aAAa8pG;YAC/C;YAMO,UAAUE,CAAAA,EAAAA;gBACf,IAAIC;gBAEFA,IADED,aAAwB9D,KACjB8D,IAEA,IAAIA,EAAah0G,IAAAA,CAAKowG,MAAAA,GAGjCpwG,IAAAA,CAAK4zG,OAAAA,CAAQj0G,IAAAA,CAAKs0G,IAClBj0G,IAAAA,CAAK4zG,OAAAA,CAAQjiD,IAAAA,CAAK,CAACvvD,GAAGkQ,IAAOlQ,EAAEuE,WAAAA,CAA8Bo9B,QAAAA,GAAYzxB,EAAE3L,WAAAA,CAA8Bo9B,QAAAA,GAGrG/jC,IAAAA,CAAK6zG,WAAAA,IAAeI,EAAOrxE,UAAAA,IAC7BqxE,EAAOrxE,UAAAA,CAAW5iC,IAAAA,CAAKowG,MAAAA,EAAQpwG,IAAAA,CAAKowG,MAAAA,CAAOpqD,KAAAA;YAE/C;YAMO,aAAaiuD,CAAAA,EAAAA;gBAClB3zF,EAAoB2zF,GAAQj0G,IAAAA,CAAK4zG,OAAAA;YACnC;YAOO,aAAAhxE;gBACL,IAAA,CAAK5iC,IAAAA,CAAK6zG,WAAAA,EAAa;oBACrB7zG,IAAAA,CAAK6zG,WAAAA,GAAAA,CAAc;oBACnB,KAAK,MAAM7pG,KAAKhK,IAAAA,CAAK4zG,OAAAA,CACf5pG,EAAE44B,UAAAA,IACJ54B,EAAE44B,UAAAA,CAAW5iC,IAAAA,CAAKowG,MAAAA,EAAQpwG,IAAAA,CAAKowG,MAAAA,CAAOpqD,KAAAA;gBAG5C;YACF;YAQO,cAAcv/C,CAAAA,EAAkBu/C,CAAAA,EAAclP,CAAAA,EAAAA;gBACnD,MAAM88D,IAAU5zG,IAAAA,CAAK4zG,OAAAA,CAAQ5rG,MAAAA,CAAQgC,CAAAA,IAAMA,EAAE8pG,UAAAA,KAAertG;gBAC5D,KAAK,MAAMuD,KAAK4pG,EACV5pG,EAAEoqG,SAAAA,IACJpqG,EAAEoqG,SAAAA,CAAUpuD,GAAOlP;gBAIvB,KAAK,MAAM9sC,KAAK4pG,EACd5pG,EAAEyjC,MAAAA,CAAOqJ;gBAGX,KAAK,MAAM9sC,KAAK4pG,EACV5pG,EAAEqqG,UAAAA,IACJrqG,EAAEqqG,UAAAA,CAAWruD,GAAOlP;YAG1B;YAEO,QAAAtvC;gBACL,IAAK,IAAIhH,IAAIR,IAAAA,CAAK4zG,OAAAA,CAAQtzG,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAC5CR,IAAAA,CAAKk0G,YAAAA,CAAal0G,IAAAA,CAAK4zG,OAAAA,CAAQpzG,EAAAA;YAEnC;QAAA;QChGK,MAAM2yC;YAUX,YAAmB6S,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,KAAAA,GAAAA,GATX,IAAA,CAAAn5B,OAAAA,GAAUjW,EAAOS,WAAAA,IAClB,IAAA,CAAA45F,YAAAA,GAA6B,IAAIoB,GAAaryG,IAAAA,GAC9C,IAAA,CAAAs0G,aAAAA,GAA+B,IAAInE,GAAcnwG,IAAAA,GACjD,IAAA,CAAAu0G,aAAAA,GAA+B,IAAIZ,GAAc3zG,IAAAA;YAMtB;YAMlC,MAA6DonD,CAAAA,EAAAA;gBAC3D,OAAOpnD,IAAAA,CAAKixG,YAAAA,CAAaiC,WAAAA,CAAY9rD;YACvC;YAEA,UAAqCE,CAAAA,EAAAA;gBACnC,OAAOtnD,IAAAA,CAAKixG,YAAAA,CAAamC,cAAAA,CAAe9rD;YAC1C;YAKA,OAAO7gD,CAAAA,EAAkBqwC,CAAAA,EAAAA;gBACnBrwC,MAASwpG,GAAWwE,MAAAA,IACtBz0G,IAAAA,CAAKs0G,aAAAA,CAAcxD,cAAAA,CAAe9wG,IAAAA,CAAKgmD,KAAAA,EAAOlP,IAEhD92C,IAAAA,CAAKu0G,aAAAA,CAAcJ,aAAAA,CAAc1tG,GAAMzG,IAAAA,CAAKgmD,KAAAA,EAAOlP,IACnD92C,IAAAA,CAAKs0G,aAAAA,CAActD,sBAAAA,IACnBhxG,IAAAA,CAAKs0G,aAAAA,CAAc3C,wBAAAA,IACnB3xG,IAAAA,CAAKs0G,aAAAA,CAAc5C,qBAAAA;YACrB;YAaA,IAAIgD,CAAAA,EAAAA;gBACEA,aAA0BtvD,KAC5BplD,IAAAA,CAAKs0G,aAAAA,CAAc5D,SAAAA,CAAUgE,KAI3BA,aAA0BxE,MAAUwD,GAAoBgB,KAC1D10G,IAAAA,CAAKu0G,aAAAA,CAAcR,SAAAA,CAAUW,KAI/B10G,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,4BAAA,EAAgCq8F,EAAuB/tG,WAAAA,CAAY8nB,IAAAA,CAAAA,4PAAAA,CAAAA;YAIvE;YAKA,IAAIwlF,CAAAA,EAAAA;gBACF,OAAOj0G,IAAAA,CAAKu0G,aAAAA,CAAc5xG,GAAAA,CAAIsxG;YAChC;YAYA,OAAOS,CAAAA,EAAiC32D,IAAAA,CAAW,CAAA,EAAA;gBAC7C22D,aAA0BtvD,KAC5BplD,IAAAA,CAAKs0G,aAAAA,CAAc1D,YAAAA,CAAa8D,GAAgB32D,KAI9C22D,aAA0BxE,KAC5BlwG,IAAAA,CAAKu0G,aAAAA,CAAcL,YAAAA,CAAaQ,KAIlC10G,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,+BAAA,EAAmCq8F,EAAuB/tG,WAAAA,CAAY8nB,IAAAA,CAAAA,4PAAAA,CAAAA;YAI1E;YAEA,IAAA,WAAI4hF;gBACF,OAAOrwG,IAAAA,CAAKs0G,aAAAA,CAAcjE,QAC5B;YAAA;YAEA,gBAAAsE;gBACE30G,IAAAA,CAAKs0G,aAAAA,CAAc9sG,KAAAA;YACrB;YAEA,eAAAotG;gBACE50G,IAAAA,CAAKu0G,aAAAA,CAAc/sG,KAAAA;YACrB;QAAA;QCpHK,MAAMqtG,WAAqB3E;YAMhC,YACS4E,CAAAA,EACAljC,CAAAA,CAAAA;gBAEPhlD,KAAAA,IAHO,IAAA,CAAAkoF,KAAAA,GAAAA,GACA,IAAA,CAAAljC,OAAAA,GAAAA,GALF,IAAA,CAAAkiC,UAAAA,GAAa7D,GAAWwE,MAAAA,EACvB,IAAA,CAAAM,mBAAAA,GAAAA,CAAsB,GAO5BnjC,EAAQojC,aAAAA,CAAc7iE,SAAAA,CAAU,IAAOnyC,IAAAA,CAAK+0G,mBAAAA,GAAAA,CAAsB,IAClE/0G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoB4W;iBAAAA;YACrD;YAEA,OAAOzS,CAAAA,EAAAA;gBACL,IAAI/5B,GACAitC;gBACJ,MAAMqmD,IAAWrwG,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,EACtBr8B,IAAUh0E,IAAAA,CAAK4xE,OAAAA,CAAQsZ,MAAAA,CAAOlX,OAAAA;gBAEpC,IAAK,IAAIxzE,IAAI,GAAGA,IAAI6vG,EAAS/vG,MAAAA,EAAQE,IAAK;oBACxCuc,IAAYszF,CAAAA,CAAS7vG,EAAAA,CAAGmC,GAAAA,CAAIgwC,KAC5BqX,IAASqmD,CAAAA,CAAS7vG,EAAAA,CAAGmC,GAAAA,CAAI4mD;oBAEzB,MAAM0rD,IAAe5E,CAAAA,CAAS7vG,EAAAA,CAAGmC,GAAAA,CAAI6pE;oBAKrC,IAJIxsE,IAAAA,CAAK+0G,mBAAAA,IAAuBE,KAC9BA,EAAa9pB,mBAAAA,CAAoBnrF,IAAAA,CAAK4xE,OAAAA,CAAQsZ,MAAAA,CAAOhX,MAAAA,GAGnD+gC,QAAAA,IAAAA,KAAY,IAAZA,EAAc33B,UAAAA,EAChB;oBAGF,MAAMrzB,IAAWD,EAAOP,GAAAA,CAAIx3C,KAAAA;oBACxBgjG,CAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAcvoC,aAAAA,AAAAA,MAAkBjC,GAAcuH,MAAAA,IAAUijC,CAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAcvqB,UAAAA,AAAAA,KACxEzgC,EAASz5C,QAAAA,CAASxQ,IAAAA,CAAK4xE,OAAAA,CAAQsZ,MAAAA,CAAOrX,OAAAA,GAKnCw8B,CAAAA,CAAS7vG,EAAAA,CAAG0vC,MAAAA,IACflwC,IAAAA,CAAKk1G,+BAAAA,CAAgC7E,CAAAA,CAAS7vG,EAAAA,GAIhDspD,GAAgBC,SAAAA,CAAUhtC,GAAWitC,GAAQC,GAAUnT,IAAUk9B;gBACnE;gBACAh0E,IAAAA,CAAK+0G,mBAAAA,GAAAA,CAAsB;YAC7B;YAEA,gCAAgC7wD,CAAAA,EAAAA;gBAAAA,IAAAA;gBACL,SAAzB,CAAA,IAAAA,EAAOvhD,GAAAA,CAAI6pE,GAAAA,KAAAA,KAAc,MAAA,KAAA,EAAEqgB,mBAAAA;gBAE3B,IAAK,IAAIrsF,IAAI,GAAGA,IAAI0jD,EAAOrT,QAAAA,CAASvwC,MAAAA,EAAQE,IAC1CR,IAAAA,CAAKk1G,+BAAAA,CAAgChxD,EAAOrT,QAAAA,CAASrwC,EAAAA;YAEzD;QAAA;QAxDO,GAAAujC,QAAAA,GAAW4rE,GAAeE,MAAAA;QCO5B,MAAMsF;YAIX,YAAmBjqB,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GAHnB,IAAA,CAAAkqB,YAAAA,GAAe,IAAI9mF,KACnB,IAAA,CAAA+mF,WAAAA,GAAc,IAAI/mF;YAEiE;YAE5E,MAAMykD,CAAAA,EAAAA;gBAQX,IAAI2K;gBACJ,OAPA19E,IAAAA,CAAKu1G,QAAAA,CAASxiC,IAGdA,IAAWA,EAAS/qE,MAAAA,CAAQyM,CAAAA,IAAAA,CAAOA,EAAE+oE,UAAAA,KAI7Bx9E,IAAAA,CAAKkrF,MAAAA,CAAOtW,gBAAAA;oBAClB,KAAKjK,GAAiB8I,eAAAA;wBACpBiK,IAAOjK;wBACP;oBAEF,KAAK9I,GAAiB2I,aAAAA;wBACpBoK,IAAOpK;wBACP;oBAEF;wBACEoK,IAAOviE;gBAAAA;gBAOX43D,EAASphB,IAAAA,CAAK,CAACvvD,GAAGkQ;oBAChB,MAAMkjG,IAAOx1G,IAAAA,CAAKo1G,YAAAA,CAAazyG,GAAAA,CAAIP,EAAExC,EAAAA,GAC/B61G,IAAOz1G,IAAAA,CAAKo1G,YAAAA,CAAazyG,GAAAA,CAAI2P,EAAE1S,EAAAA,GAC/B81G,IAAQ11G,IAAAA,CAAKq1G,WAAAA,CAAY1yG,GAAAA,CAAIP,EAAExC,EAAAA,GAC/B+1G,IAAQ31G,IAAAA,CAAKq1G,WAAAA,CAAY1yG,GAAAA,CAAI2P,EAAE1S,EAAAA;oBACrC,OAAO89E,CAAAA,CAAK83B,EAAAA,GAAQ93B,CAAAA,CAAK+3B,EAAAA,IAASC,IAAQC;gBAAK;gBAGjD,KAAK,MAAMxyD,KAAW4vB,EAEpB/yE,IAAAA,CAAK41G,aAAAA,CAAczyD,IAGnBnjD,IAAAA,CAAK61G,aAAAA,CAAc1yD;gBAMrB,OAFAnjD,IAAAA,CAAK81G,SAAAA,CAAU/iC,IAERA;YACT;YAEO,SAASA,CAAAA,EAAAA;gBACd,MAAM1zD,IAAU;gBAChB,IAAK,IAAI7e,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA;oBACzB,IAAI8E,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAIzwE,CAAAA,IAAK+S,KAAW/Z,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAI3yE,CAAAA,IAAKiV,GAAS;wBAE1E8jC,EAAQs6B,MAAAA;wBACR;oBACF;oBACA,MAAMziE,IAAOtE,EAAK0E,aAAAA,CAAc+nC,EAAQ45B,GAAAA,GAClCA,IAAM55B,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAElBnC,IAAWvJ,KAAKyH,GAAAA,CAAIo2C,EAAQhrC,IAAAA,CAAKqnE,UAAAA;oBACvCx/E,IAAAA,CAAKq1G,WAAAA,CAAYrqF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIiP,IAEjC7O,IAAAA,CAAKo1G,YAAAA,CAAapqF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIob,MAAStE,EAAKtI,IAAAA,IAAQ4M,MAAStE,EAAKrI,KAAAA,GAAQ,eAAe,aAG7F80C,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAI+6C,GAAkBC,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAM+hE,GAAK55B,KACrHA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,gBACA,IAAI+6C,GAAkBC,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAO+hE,EAAI/rE,MAAAA,IAAUmyC;gBAEtG;YACF;YAEO,UAAU4vB,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACf,IAAK,IAAIvyE,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA;oBACzB,IAAI2iD,EAAQq6B,UAAAA,IACV;oBAEF,MAAMpR,IAAYjpB,EAAQipB,SAAAA,EACpBC,IAAYlpB,EAAQkpB,SAAAA,EACpBE,IAAuB,SAAf,CAAA,IAAAH,EAAUx6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC7BC,IAAuB,SAAf,CAAA,IAAAJ,EAAUz6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;oBACnC,IAAID,KAASE,KACPF,CAAAA,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,AAAAA,GACzF;oBAIJ,MAAMjkF,IAAOtE,EAAK0E,aAAAA,CAAc+nC,EAAQ45B,GAAAA,GAClCA,IAAM55B,EAAQ45B,GAAAA,CAAI/rE,MAAAA;oBAExBmyC,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,iBAAiB,IAAIi7C,GAAmBD,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAM+hE,GAAK55B,KACvHA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,iBACA,IAAIi7C,GAAmBD,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAO+hE,EAAI/rE,MAAAA,IAAUmyC;gBAEvG;YACF;YAEO,cAAcA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACnB,MAAM9jC,IAAU;gBAGhB,IAAA,CAAK8jC,EAAQipB,SAAAA,CAAUp3C,MAAAA,CAAO5V,QAAAA,CAAS+jC,EAAQkpB,SAAAA,CAAUr3C,MAAAA,EAAQ3V,IAG/D,OAAA,KADA8jC,EAAQs6B,MAAAA;gBAIV,IAAIn4E,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAIzwE,CAAAA,IAAK+S,KAAW/Z,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAI3yE,CAAAA,IAAKiV,GAGjE,OAAA,KADA8jC,EAAQs6B,MAAAA;gBAIV,IAAIV,IAAM55B,EAAQ45B,GAAAA;gBAClB,MAAM3Q,IAAYjpB,EAAQipB,SAAAA,EACpBC,IAAYlpB,EAAQkpB,SAAAA,EACpBE,IAAuB,SAAf,CAAA,IAAAH,EAAUx6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC7BC,IAAuB,SAAf,CAAA,IAAAJ,EAAUz6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;gBACnC,IAAID,KAASE,GAAO;oBAClB,IAAIF,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,EACzF;oBAGE1yB,EAAMG,aAAAA,KAAkBjC,GAAcuH,MAAAA,IAAUvF,EAAMC,aAAAA,KAAkBjC,GAAcuH,MAAAA,IAExF+K,CAAAA,IAAMA,EAAI9sE,KAAAA,CAAM,GAAA,GAIds8D,EAAMG,aAAAA,KAAkBjC,GAAcuH,MAAAA,IACxCzF,CAAAA,EAAMz7B,SAAAA,CAAUxkC,CAAAA,IAAKywE,EAAIzwE,CAAAA,EACzBigE,EAAMz7B,SAAAA,CAAU1mC,CAAAA,IAAK2yE,EAAI3yE,CAAAA,EACzBgiE,EAAU3+B,MAAAA,CAAO8+B,EAAMxvD,SAAAA,CAAUpa,GAAAA,GAAAA,GAG/B8pE,EAAMC,aAAAA,KAAkBjC,GAAcuH,MAAAA,IACxCvF,CAAAA,EAAM37B,SAAAA,CAAUxkC,CAAAA,IAAKywE,EAAIzwE,CAAAA,EACzBmgE,EAAM37B,SAAAA,CAAU1mC,CAAAA,IAAK2yE,EAAI3yE,CAAAA,EACzBiiE,EAAU5+B,MAAAA,CAAOg/B,EAAM1vD,SAAAA,CAAUpa,GAAAA,GAAAA;gBAErC;YACF;YAEO,cAAcwgD,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACnB,IAAIA,EAAQq6B,UAAAA,IACV;gBAGF,MAAMpR,IAAYjpB,EAAQipB,SAAAA,EACpBC,IAAYlpB,EAAQkpB,SAAAA,EACpBE,IAAuB,SAAf,CAAA,IAAAH,EAAUx6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC7BC,IAAuB,SAAf,CAAA,IAAAJ,EAAUz6B,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE;gBAEnC,IAAID,KAASE,GAAO;oBAClB,IAAIF,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,EACzF;oBAGF,MAAMluF,IAASoyC,EAAQpyC,MAAAA,EACjBglG,IAAWhlG,EAAOC,MAAAA;oBAExB,IAAIu7D,EAAMG,aAAAA,KAAkBjC,GAAcuH,MAAAA,IAGpCzF,EAAM/iB,GAAAA,CAAIx5C,SAAAA,GAAYW,GAAAA,CAAIolG,KAAY,GAAG;wBAE3C,MAAMC,IAASjlG,EAAOd,KAAAA,CAAMc,EAAOJ,GAAAA,CAAI47D,EAAM/iB,GAAAA,CAAIx4C,MAAAA;wBACjDu7D,EAAM/iB,GAAAA,GAAM+iB,EAAM/iB,GAAAA,CAAIp5C,GAAAA,CAAI4lG;oBAC5B;oBAGF,IAAIvpC,EAAMC,aAAAA,KAAkBjC,GAAcuH,MAAAA,IAGpCvF,EAAMjjB,GAAAA,CAAIx5C,SAAAA,GAAYW,GAAAA,CAAII,KAAU,GAAG;wBACzC,MAAMilG,IAASD,EAAS9lG,KAAAA,CAAM8lG,EAASplG,GAAAA,CAAI87D,EAAMjjB,GAAAA,CAAIx4C,MAAAA;wBACrDy7D,EAAMjjB,GAAAA,GAAMijB,EAAMjjB,GAAAA,CAAIp5C,GAAAA,CAAI4lG;oBAC5B;gBAEJ;YACF;QAAA;QCzMK,MAAMC;YACX,YACSr5F,CAAAA,EACAskE,CAAAA,EACA/9B,CAAAA,CAAAA;gBAFA,IAAA,CAAAvmC,KAAAA,GAAAA,GACA,IAAA,CAAAskE,KAAAA,GAAAA,GACA,IAAA,CAAA/9B,OAAAA,GAAAA,GA8DF,IAAA,CAAA+yD,aAAAA,GAAwB,GAKxB,IAAA,CAAAC,cAAAA,GAAyB,GAKzB,IAAA,CAAAC,UAAAA,GAAqB,GAKrB,IAAA,CAAAC,WAAAA,GAAsB,GAKtB,IAAA,CAAAC,UAAAA,GAAqB,IAAIxoG,EAAO,GAAG,IAKnC,IAAA,CAAAyoG,UAAAA,GAAqB,IAAIzoG,EAAO,GAAG,IAKnC,IAAA,CAAA0oG,8BAAAA,GAAyC,GA1F9Cx2G,IAAAA,CAAKytC,MAAAA;YACP;YAKA,SAAAA;gBACE,MAAM8+B,IAAQvsE,IAAAA,CAAKmjD,OAAAA,CAAQopB,KAAAA,EACrBH,IAAYpsE,IAAAA,CAAKmjD,OAAAA,CAAQipB,SAAAA,EACzBK,IAAQzsE,IAAAA,CAAKmjD,OAAAA,CAAQspB,KAAAA,EACrBJ,IAAYrsE,IAAAA,CAAKmjD,OAAAA,CAAQkpB,SAAAA;gBAE/B,IAAIE,KAASE,GAAO;oBAClB,MAAM17D,IAAS/Q,IAAAA,CAAKmjD,OAAAA,CAAQpyC,MAAAA,EACtBisE,IAAUh9E,IAAAA,CAAKmjD,OAAAA,CAAQ65B,OAAAA;oBAE7Bh9E,IAAAA,CAAKs2G,UAAAA,GAAat2G,IAAAA,CAAK4c,KAAAA,CAAMrM,GAAAA,CAAI67D,EAAU9vD,MAAAA,GAC3Ctc,IAAAA,CAAKu2G,UAAAA,GAAav2G,IAAAA,CAAK4c,KAAAA,CAAMrM,GAAAA,CAAI87D,EAAU/vD,MAAAA;oBAE3C,MAAMm6F,IAAmBz2G,IAAAA,CAAKs2G,UAAAA,CAAW1lG,KAAAA,CAAMG,IACzC2lG,IAAmB12G,IAAAA,CAAKu2G,UAAAA,CAAW3lG,KAAAA,CAAMG;oBAE/C/Q,IAAAA,CAAKo2G,UAAAA,GACH7pC,EAAMmf,WAAAA,GACNjf,EAAMif,WAAAA,GACNnf,EAAMyf,cAAAA,GAAiByqB,IAAmBA,IAC1ChqC,EAAMuf,cAAAA,GAAiB0qB,IAAmBA;oBAE5C,MAAMC,IAAoB32G,IAAAA,CAAKs2G,UAAAA,CAAW1lG,KAAAA,CAAMosE,IAC1C45B,IAAoB52G,IAAAA,CAAKu2G,UAAAA,CAAW3lG,KAAAA,CAAMosE;oBAEhDh9E,IAAAA,CAAKq2G,WAAAA,GACH9pC,EAAMmf,WAAAA,GACNjf,EAAMif,WAAAA,GACNnf,EAAMyf,cAAAA,GAAiB2qB,IAAoBA,IAC3ClqC,EAAMuf,cAAAA,GAAiB4qB,IAAoBA;gBAC/C;gBAEA,OAAO52G,IACT;YAAA;YAKO,sBAAA62G;gBACL,MAAMtqC,IAAQvsE,IAAAA,CAAKmjD,OAAAA,CAAQopB,KAAAA,EACrBE,IAAQzsE,IAAAA,CAAKmjD,OAAAA,CAAQspB,KAAAA;gBAC3B,IAAIF,KAASE,GAAO;oBAGlB,MAAMqqC,IAAOvqC,EAAM/iB,GAAAA,CAAIp5C,GAAAA,CAAItC,EAAO8C,KAAAA,CAAM27D,EAAM5iB,eAAAA,EAAiB3pD,IAAAA,CAAKs2G,UAAAA;oBAEpE,OADa7pC,EAAMjjB,GAAAA,CAAIp5C,GAAAA,CAAItC,EAAO8C,KAAAA,CAAM67D,EAAM9iB,eAAAA,EAAiB3pD,IAAAA,CAAKu2G,UAAAA,GACxDhmG,GAAAA,CAAIumG;gBAClB;gBACA,OAAOhpG,EAAOC,IAChB;YAAA;QAAA;QCtDK,MAAMgpG;YAIX,YAAmB7rB,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GAHnB,IAAA,CAAAkqB,YAAAA,GAAe,IAAI9mF,KACnB,IAAA,CAAA+mF,WAAAA,GAAc,IAAI/mF,KAGlB,IAAA,CAAA0oF,iBAAAA,GAAmD,IAAI1oF,KAGvD,IAAA,CAAA2oF,qBAAAA,GAA+D,IAAI3oF;YAJsB;YAMzF,sBAAsB1uB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACpB,OAAyC,SAAlC,CAAA,IAAAI,IAAAA,CAAKi3G,qBAAAA,CAAsBt0G,GAAAA,CAAI/C,EAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI,EAC/C;YAAA;YAEO,MAAMmzE,CAAAA,EAAAA;gBAOX,IAAI2K;gBACJ,OANA19E,IAAAA,CAAKu1G,QAAAA,CAASxiC,IAGdA,IAAWA,EAAS/qE,MAAAA,CAAQyM,CAAAA,IAAAA,CAAOA,EAAE+oE,UAAAA,KAG7Bx9E,IAAAA,CAAKkrF,MAAAA,CAAOtW,gBAAAA;oBAClB,KAAKjK,GAAiB8I,eAAAA;wBACpBiK,IAAOjK;wBACP;oBAEF,KAAK9I,GAAiB2I,aAAAA;wBACpBoK,IAAOpK;wBACP;oBAEF;wBACEoK,IAAOviE;gBAAAA;gBAwBX,OAjBA43D,EAASphB,IAAAA,CAAK,CAACvvD,GAAGkQ;oBAChB,MAAMkjG,IAAOx1G,IAAAA,CAAKo1G,YAAAA,CAAazyG,GAAAA,CAAIP,EAAExC,EAAAA,GAC/B61G,IAAOz1G,IAAAA,CAAKo1G,YAAAA,CAAazyG,GAAAA,CAAI2P,EAAE1S,EAAAA,GAC/B81G,IAAQ11G,IAAAA,CAAKq1G,WAAAA,CAAY1yG,GAAAA,CAAIP,EAAExC,EAAAA,GAC/B+1G,IAAQ31G,IAAAA,CAAKq1G,WAAAA,CAAY1yG,GAAAA,CAAI2P,EAAE1S,EAAAA;oBACrC,OAAO89E,CAAAA,CAAK83B,EAAAA,GAAQ93B,CAAAA,CAAK+3B,EAAAA,IAASC,IAAQC;gBAAK,IAIjD31G,IAAAA,CAAK61G,aAAAA,CAAc9iC,IAGnB/yE,IAAAA,CAAK41G,aAAAA,CAAc7iC,IAGnB/yE,IAAAA,CAAK81G,SAAAA,CAAU/iC,IAERA;YACT;YAEA,SAASA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACP,MAAM1zD,IAAU;gBAChB,IAAK,IAAI7e,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA;oBACzB,IAAI8E,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAIzwE,CAAAA,IAAK+S,KAAW/Z,KAAKyH,GAAAA,CAAIo2C,EAAQ45B,GAAAA,CAAI3yE,CAAAA,IAAKiV,GAAS;wBAE1E8jC,EAAQs6B,MAAAA;wBACR;oBACF;oBAEA,MAAMziE,IAAOtE,EAAK0E,aAAAA,CAAc+nC,EAAQ45B,GAAAA,GAClCluE,IAAWvJ,KAAKyH,GAAAA,CAAAA,AAAiB,CAAA,SAAb,CAAA,IAAAo2C,QAAAA,IAAAA,KAAO,IAAPA,EAAShrC,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEqnE,UAAAA,AAAAA,KAAc;oBAEvDx/E,IAAAA,CAAKq1G,WAAAA,CAAYrqF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIiP,IACjC7O,IAAAA,CAAKo1G,YAAAA,CAAapqF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIob,MAAStE,EAAKtI,IAAAA,IAAQ4M,MAAStE,EAAKrI,KAAAA,GAAQ,eAAe,aAE7F80C,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CACvB,gBACA,IAAI+6C,GAAkBC,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAMmoC,EAAQ45B,GAAAA,EAAK55B,KAEjFA,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CACvB,0BACA,IAAIq7C,GAAuBL,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAMmoC,EAAQ45B,GAAAA,EAAK55B,KAEtFA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,gBACA,IAAI+6C,GAAkBC,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAOmoC,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAAUmyC,KAE5GA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,0BACA,IAAIq7C,GAAuBL,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAOmoC,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAAUmyC,KAIjHA,EAAQk6B,UAAAA;gBACV;gBAGA,MAAM85B,IAAqBptG,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAKi3G,qBAAAA,CAAsB1wG,IAAAA;gBACjE,IAAK,IAAI/F,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EAEnBgL,IAAQ2rG,EAAmB1uG,OAAAA,CAAQ06C,EAAQvjD,EAAAA;oBAC7C4L,IAAAA,MACF2rG,EAAmBzuG,MAAAA,CAAO8C,GAAO;oBAEnC,MAAM4rG,IAA0D,SAA1C,CAAA,IAAAp3G,IAAAA,CAAKi3G,qBAAAA,CAAsBt0G,GAAAA,CAAIwgD,EAAQvjD,EAAAA,CAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI,EAAA;oBAEpE,IAAIy3G,IAAa;oBACjB,MAAM9qC,IAAQppB,EAAQopB,KAAAA,EAChBH,IAAYjpB,EAAQipB,SAAAA,EACpBK,IAAQtpB,EAAQspB,KAAAA,EAChBJ,IAAYlpB,EAAQkpB,SAAAA;oBAC1B,IAAIE,KAASE,GACX,IAAK,IAAIiF,IAAI,GAAGA,IAAIvuB,EAAQpnC,MAAAA,CAAOzb,MAAAA,EAAQoxE,IAAK;wBAC9C,MAAM90D,IAAQumC,EAAQpnC,MAAAA,CAAO21D,EAAAA,EACvB3gE,IAASoyC,EAAQpyC,MAAAA,EACjBisE,IAAU75B,EAAQ65B,OAAAA,EAElBs5B,IAAa15F,EAAMrM,GAAAA,CAAI67D,EAAU9vD,MAAAA,GACjCi6F,IAAa35F,EAAMrM,GAAAA,CAAI87D,EAAU/vD,MAAAA,GAEjCm6F,IAAmBH,EAAW1lG,KAAAA,CAAMG,IACpC2lG,IAAmBH,EAAW3lG,KAAAA,CAAMG,IAEpCqlG,IACJ7pC,EAAMmf,WAAAA,GACNjf,EAAMif,WAAAA,GACNnf,EAAMyf,cAAAA,GAAiByqB,IAAmBA,IAC1ChqC,EAAMuf,cAAAA,GAAiB0qB,IAAmBA,GAEtCC,IAAoBL,EAAW1lG,KAAAA,CAAMosE,IACrC45B,IAAoBL,EAAW3lG,KAAAA,CAAMosE,IAErCq5B,IACJ9pC,EAAMmf,WAAAA,GACNjf,EAAMif,WAAAA,GACNnf,EAAMyf,cAAAA,GAAiB2qB,IAAoBA,IAC3ClqC,EAAMuf,cAAAA,GAAiB4qB,IAAoBA;wBAGzCQ,CAAAA,CAAcC,EAAAA,IAAAA,AAA+C,CAAA,SAAhC,CAAA,IAAyB,SAAzB,CAAA,IAAAD,CAAAA,CAAcC,EAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAEz6F,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAElN,cAAAA,CAAekN,EAAAA,IAAS,IACzFw6F,CAAAA,CAAAA,CAAcC,EAAAA,CAAYz6F,KAAAA,GAAQA,GAClCw6F,CAAAA,CAAcC,EAAAA,CAAYn2B,KAAAA,GAAQ/9B,EAAQ85B,WAAAA,CAAYo6B,EAAAA,AAAAA,IAGtDD,CAAAA,CAAcC,EAAAA,GAAc,IAAIpB,GAAuBr5F,GAAOumC,EAAQ85B,WAAAA,CAAYo6B,EAAAA,EAAal0D,IAIjGi0D,CAAAA,CAAcC,EAAAA,CAAYf,UAAAA,GAAaA,GACvCc,CAAAA,CAAcC,EAAAA,CAAYd,UAAAA,GAAaA,GACvCa,CAAAA,CAAcC,EAAAA,CAAYjB,UAAAA,GAAa,IAAMA,GAC7CgB,CAAAA,CAAcC,EAAAA,CAAYhB,WAAAA,GAAc,IAAMA;wBAG9C,MAAMiB,IAAc/qC,EAAMie,UAAAA,GAAa/d,EAAM+d,UAAAA,GAAaje,EAAMie,UAAAA,GAAa/d,EAAM+d,UAAAA,EAC7E+sB,IAAmBp0D,EAAQpyC,MAAAA,CAAOJ,GAAAA,CAAIymG,CAAAA,CAAcC,EAAAA,CAAYR,mBAAAA;wBACtEO,CAAAA,CAAcC,EAAAA,CAAYb,8BAAAA,GAAiC,GACvDe,IAAAA,QAEFH,CAAAA,CAAAA,CAAcC,EAAAA,CAAYb,8BAAAA,GAAAA,CAAkCc,IAAcC,CAAAA,GAE5EF;oBACF;oBAEFr3G,IAAAA,CAAKi3G,qBAAAA,CAAsBjsF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIw3G;gBAC7C;gBAGA,KAAK,MAAMx3G,KAAMu3G,EACfn3G,IAAAA,CAAKi3G,qBAAAA,CAAsBpoF,MAAAA,CAAOjvB;gBAKpC,IAAII,IAAAA,CAAKkrF,MAAAA,CAAOhW,SAAAA,EACdl1E,IAAAA,CAAKk1E,SAAAA,CAAUnC;qBAEf,IAAK,IAAIvyE,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EACnB42G,IAAgBp3G,IAAAA,CAAKk3G,qBAAAA,CAAsB/zD,EAAQvjD,EAAAA;oBACzD,KAAK,MAAMgd,KAASw6F,EAClBx6F,EAAMs5F,aAAAA,GAAgB,GACtBt5F,EAAMu5F,cAAAA,GAAiB;gBAE3B;YAEJ;YAEA,UAAUpjC,CAAAA,EAAAA;gBACR,IAAK,IAAIvyE,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EACnB+rE,IAAQppB,EAAQopB,KAAAA,EAChBE,IAAQtpB,EAAQspB,KAAAA;oBAEtB,IAAIF,KAASE,GAAO;wBAElB,IAAIF,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,EACzF;wBAIF1yB,EAAMsf,YAAAA,IACNpf,EAAMof,YAAAA;oBACR;oBAGA,MAAM7wE,IAAOtE,EAAK0E,aAAAA,CAAc+nC,EAAQ45B,GAAAA;oBACxC55B,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CACvB,iBACA,IAAIi7C,GAAmBD,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAMmoC,EAAQ45B,GAAAA,EAAK55B,KAElFA,EAAQipB,SAAAA,CAAUlyD,MAAAA,CAAO/R,IAAAA,CACvB,yBACA,IAAIs7C,GAAwBN,EAAQipB,SAAAA,EAAWjpB,EAAQkpB,SAAAA,EAAWrxD,GAAMmoC,EAAQ45B,GAAAA,EAAK55B,KAEvFA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,iBACA,IAAIi7C,GAAmBD,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAOmoC,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAAUmyC,KAE7GA,EAAQkpB,SAAAA,CAAUnyD,MAAAA,CAAO/R,IAAAA,CACvB,yBACA,IAAIs7C,GAAwBN,EAAQkpB,SAAAA,EAAWlpB,EAAQipB,SAAAA,EAAW11D,EAAKqE,WAAAA,CAAYC,IAAOmoC,EAAQ45B,GAAAA,CAAI/rE,MAAAA,IAAUmyC;gBAEpH;gBAGAnjD,IAAAA,CAAKg3G,iBAAAA,CAAkBxvG,KAAAA;gBACvB,IAAK,IAAIhH,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAMiU,IAAIs+D,CAAAA,CAASvyE,EAAAA;oBACnBR,IAAAA,CAAKg3G,iBAAAA,CAAkBhsF,GAAAA,CAAIvW,EAAE7U,EAAAA,EAAI6U;gBACnC;YACF;YAMA,UAAUs+D,CAAAA,EAAAA;gBAAAA,IAAAA;gBACR,IAAK,IAAIvyE,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EACnB+rE,IAAQppB,EAAQopB,KAAAA,EAChBE,IAAQtpB,EAAQspB,KAAAA;oBACtB,IAAIF,KAASE,GAAO;wBAClB,MAAM2qC,IAA0D,SAA1C,CAAA,IAAAp3G,IAAAA,CAAKi3G,qBAAAA,CAAsBt0G,GAAAA,CAAIwgD,EAAQvjD,EAAAA,CAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI,EAAA;wBACpE,KAAK,MAAMgd,KAASw6F,EAClB,IAAIp3G,IAAAA,CAAKkrF,MAAAA,CAAOhW,SAAAA,EAAW;4BACzB,MAAMghC,IAAgB/yD,EAAQpyC,MAAAA,CAAOd,KAAAA,CAAM2M,EAAMs5F,aAAAA,GAC3CC,IAAiBhzD,EAAQ65B,OAAAA,CAAQ/sE,KAAAA,CAAM2M,EAAMu5F,cAAAA,GAC7C9pB,IAAU6pB,EAAc9lG,GAAAA,CAAI+lG;4BAElC5pC,EAAM6f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE,EAAQr7E,MAAAA,KACxCy7D,EAAM2f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE;wBAClC,OACEzvE,EAAMs5F,aAAAA,GAAgB,GACtBt5F,EAAMu5F,cAAAA,GAAiB;oBAG7B;gBACF;YACF;YAMA,cAAcpjC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ,IAAK,IAAIvyE,IAAI,GAAGA,IAAIR,IAAAA,CAAKkrF,MAAAA,CAAOpW,kBAAAA,EAAoBt0E,IAClD,IAAK,IAAIA,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EACnB+rE,IAAQppB,EAAQopB,KAAAA,EAChBE,IAAQtpB,EAAQspB,KAAAA;oBAEtB,IAAIF,KAASE,GAAO;wBAElB,IAAIF,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,EACzF;wBAGF,MAAMuY,IAAwD,SAA1C,CAAA,IAAAx3G,IAAAA,CAAKi3G,qBAAAA,CAAsBt0G,GAAAA,CAAIwgD,EAAQvjD,EAAAA,CAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI,EAAA;wBAClE,KAAK,MAAMgd,KAAS46F,EAAa;4BAC/B,MAAMzmG,IAASoyC,EAAQpyC,MAAAA,EACjByuE,IAAajD,GAAmB2G,qBAAAA,CAAsB//B,GAASvmC,EAAMskE,KAAAA,GAGrEu2B,IAAAA,IAKAC,IAAgBhrG,EANG1M,IAAAA,CAAKkrF,MAAAA,CAAOjW,cAAAA,GAMWuK,CAAAA,IAJnCx/E,IAAAA,CAAKkrF,MAAAA,CAAOlW,IAAAA,AAAAA,GAI2CyiC,GAAe,IAC7EprB,IAAUt7E,EAAOd,KAAAA,CAAAA,CAAOynG,IAAgB96F,EAAMw5F,UAAAA;4BAIpD,IAAI7pC,EAAMG,aAAAA,KAAkBjC,GAAcuH,MAAAA,EAAQ;gCAEhD,MAAM2lC,IAAetrB,EAAQr7E,MAAAA,GAASf,KAAAA,CAAMs8D,EAAMmf,WAAAA;gCAC9Cnf,EAAMoe,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBmC,CAAAA,KACtDorB,CAAAA,EAAarrG,CAAAA,GAAI,CAAA,GAEfigE,EAAMoe,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBoC,CAAAA,KACtDmrB,CAAAA,EAAavtG,CAAAA,GAAI,CAAA,GAGnBmiE,EAAMz7B,SAAAA,GAAYy7B,EAAMz7B,SAAAA,CAAU1gC,GAAAA,CAAIunG,IACjCprC,EAAMoe,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBqC,QAAAA,KACvDlgB,CAAAA,EAAM5pD,QAAAA,IAAY/F,EAAM05F,UAAAA,CAAW1lG,KAAAA,CAAMy7E,KAAW9f,EAAMyf,cAAAA,AAAAA;4BAE9D;4BAEA,IAAIvf,EAAMC,aAAAA,KAAkBjC,GAAcuH,MAAAA,EAAQ;gCAChD,MAAM2lC,IAAetrB,EAAQp8E,KAAAA,CAAMw8D,EAAMif,WAAAA;gCACrCjf,EAAMke,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBmC,CAAAA,KACtDorB,CAAAA,EAAarrG,CAAAA,GAAI,CAAA,GAEfmgE,EAAMke,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBoC,CAAAA,KACtDmrB,CAAAA,EAAavtG,CAAAA,GAAI,CAAA,GAGnBqiE,EAAM37B,SAAAA,GAAY27B,EAAM37B,SAAAA,CAAU1gC,GAAAA,CAAIunG,IACjClrC,EAAMke,oBAAAA,CAAqB1pE,QAAAA,CAASmpE,GAAgBqC,QAAAA,KACvDhgB,CAAAA,EAAM9pD,QAAAA,IAAY/F,EAAM25F,UAAAA,CAAW3lG,KAAAA,CAAMy7E,KAAW5f,EAAMuf,cAAAA,AAAAA;4BAE9D;wBACF;oBACF;gBACF;YAEJ;YAEA,cAAcjZ,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ,IAAK,IAAIvyE,IAAI,GAAGA,IAAIR,IAAAA,CAAKkrF,MAAAA,CAAOnW,kBAAAA,EAAoBv0E,IAClD,IAAK,IAAIA,IAAI,GAAGA,IAAIuyE,EAASzyE,MAAAA,EAAQE,IAAK;oBACxC,MAAM2iD,IAAU4vB,CAAAA,CAASvyE,EAAAA,EACnB+rE,IAAQppB,EAAQopB,KAAAA,EAChBE,IAAQtpB,EAAQspB,KAAAA;oBAEtB,IAAIF,KAASE,GAAO;wBAElB,IAAIF,EAAMG,aAAAA,KAAkBjC,GAAcw0B,OAAAA,IAAWxyB,EAAMC,aAAAA,KAAkBjC,GAAcw0B,OAAAA,EACzF;wBAGF,MAAMxU,IAAWnlF,KAAKkF,GAAAA,CAAI+hE,EAAMke,QAAAA,EAAUhe,EAAMge,QAAAA,GAE1C+sB,IAAwD,SAA1C,CAAA,IAAAx3G,IAAAA,CAAKi3G,qBAAAA,CAAsBt0G,GAAAA,CAAIwgD,EAAQvjD,EAAAA,CAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI,EAAA;wBAGlE,KAAK,MAAMgd,KAAS46F,EAAa;4BAK/B,IAAII,IAAAA,CAJqBh7F,EAAMi6F,mBAAAA,GAGWlmG,GAAAA,CAAIwyC,EAAQ65B,OAAAA,IACjBpgE,EAAMy5F,WAAAA;4BAM3C,MAAMwB,IAAcptB,IAAW7tE,EAAMs5F,aAAAA,EAC/B4B,IAAaprG,EAAMkQ,EAAMu5F,cAAAA,GAAiByB,GAAAA,CAAeC,GAAaA;4BAC5ED,IAAeE,IAAal7F,EAAMu5F,cAAAA,EAClCv5F,EAAMu5F,cAAAA,GAAiB2B;4BAEvB,MAAMzrB,IAAUlpC,EAAQ65B,OAAAA,CAAQ/sE,KAAAA,CAAM2nG;4BACtCrrC,EAAM6f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE,EAAQr7E,MAAAA,KACxCy7D,EAAM2f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE;wBAClC;wBAGA,KAAK,MAAMzvE,KAAS46F,EAAa;4BAE/B,MAGMO,IAHmBn7F,EAAMi6F,mBAAAA,GAGSlmG,GAAAA,CAAIwyC,EAAQpyC,MAAAA;4BAIpD,IAAI6mG,IAAAA,CAAgBh7F,EAAMw5F,UAAAA,GAAc2B,CAAAA,IAAiBn7F,EAAM45F,8BAAAA,AAAAA;4BAK/D,MAAMsB,IAAaxyG,KAAKC,GAAAA,CAAIqX,EAAMs5F,aAAAA,GAAgB0B,GAAc;4BAChEA,IAAeE,IAAal7F,EAAMs5F,aAAAA,EAClCt5F,EAAMs5F,aAAAA,GAAgB4B;4BAEtB,MAAMzrB,IAAUlpC,EAAQpyC,MAAAA,CAAOd,KAAAA,CAAM2nG;4BACrCrrC,EAAM6f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE,EAAQr7E,MAAAA,KACxCy7D,EAAM2f,YAAAA,CAAaxvE,EAAMA,KAAAA,EAAOyvE;wBAClC;oBACF;gBACF;YAEJ;QAAA;QCnYK,MAAM2rB,WAAwB9H;YAanC,IAAA,aAAY+H;gBACV,OAAOj4G,IAAAA,CAAKk4G,QAAAA,CAASC,kBACvB;YAAA;YAKA,YACErD,CAAAA,EACQoD,CAAAA,CAAAA;gBAERtrF,KAAAA,IAFQ,IAAA,CAAAsrF,QAAAA,GAAAA,GAnBH,IAAA,CAAApE,UAAAA,GAAa7D,GAAWwE,MAAAA,EAIvB,IAAA,CAAA2D,YAAAA,GAAAA,CAAe,GAGf,IAAA,CAAAC,kBAAAA,GAAqB,IAAI/pF,KACzB,IAAA,CAAAgqF,qBAAAA,GAAwB,IAAIhqF,KAclCtuB,IAAAA,CAAKu4G,aAAAA,GAAgB,IAAIpD,GAAa+C,EAAShtB,MAAAA,CAAOvW,MAAAA,GACtD30E,IAAAA,CAAKw4G,gBAAAA,GAAmB,IAAIzB,GAAgBmB,EAAShtB,MAAAA,CAAOrW,SAAAA,GAC5D70E,IAAAA,CAAKk4G,QAAAA,CAASlD,aAAAA,CAAc7iE,SAAAA,CAAU,IAAOnyC,IAAAA,CAAKo4G,YAAAA,GAAAA,CAAe,IACjEp4G,IAAAA,CAAKy4G,cAAAA,GAAkBhkG,CAAAA,IAAgBzU,IAAAA,CAAKi4G,UAAAA,CAAW/2C,KAAAA,CAAMzsD,IAC7DzU,IAAAA,CAAK04G,gBAAAA,GAAoBjkG,CAAAA,IAAgBzU,IAAAA,CAAKi4G,UAAAA,CAAW5mC,OAAAA,CAAQ58D,IACjEzU,IAAAA,CAAKwvE,KAAAA,GAAQslC,EAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoB4W;oBAAiBy/B;iBAAAA,GAC/DhpF,IAAAA,CAAKwvE,KAAAA,CAAMwiC,YAAAA,CAAa7/D,SAAAA,CAAW7yB,CAAAA;oBACjC,MAAMq5F,IAAoBr5F,EAAE3c,GAAAA,CAAIqmF;oBAChC2vB,EAAkB1vB,cAAAA,CAAe92C,SAAAA,CAAUnyC,IAAAA,CAAKy4G,cAAAA,GAChDE,EAAkBzvB,gBAAAA,CAAiB/2C,SAAAA,CAAUnyC,IAAAA,CAAK04G,gBAAAA;oBAClD,MAAM5rC,IAAW6rC,EAAkBh2G,GAAAA;oBAC/BmqE,KACF9sE,IAAAA,CAAKi4G,UAAAA,CAAW/2C,KAAAA,CAAM4L;gBACxB,IAEF9sE,IAAAA,CAAKwvE,KAAAA,CAAMyiC,cAAAA,CAAe9/D,SAAAA,CAAW7yB,CAAAA;oBACnC,MAAMq5F,IAAoBr5F,EAAE3c,GAAAA,CAAIqmF,KAC1Blc,IAAW6rC,EAAkBh2G,GAAAA;oBAC/Bg2G,KAAqB7rC,KACvB9sE,IAAAA,CAAKi4G,UAAAA,CAAW5mC,OAAAA,CAAQvE;gBAC1B,IAEF9sE,IAAAA,CAAK44G,aAAAA,GAAgB9D,EAAMnyG,GAAAA,CAAIkyG;YACjC;YAEA,WAAWC,CAAAA,EAAc9uD,CAAAA,EAAAA;gBACvBhmD,IAAAA,CAAK2iE,OAAAA,GAAU3c,EAAM/rC,MACvB;YAAA;YAEA,OAAO68B,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACL,IAAA,CAAK92C,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAOtX,OAAAA,EACxB;gBAKF,IAAIxC,IAAwB,EAAA;gBAC5B,IAAK,IAAI2/B,IAAc,GAAGA,IAAc/wG,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS/vG,MAAAA,EAAQywG,IAAe;oBACjF,MACM8H,IADS74G,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAASU,EAAAA,CACPpuG,GAAAA,CAAIqmF,KAC1Blc,IAAW+rC,QAAAA,IAAAA,KAAY,IAAZA,EAAcl2G,GAAAA;oBAC/B,IAAIk2G,KAAkC,CAAA,SAAlB,CAAA,IAAAA,EAAajnE,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEqU,QAAAA,AAAAA,KAAY6mB;wBAIlD,IAHA+rC,EAAaprE,MAAAA,IAGTq/B,aAAoBqE,IAAmB;4BACzC,MAAM2nC,IAAqBhsC,EAAS4D,YAAAA;4BAC/B5D,EAASmH,iBAAAA,IACZnH,CAAAA,EAASmH,iBAAAA,GAAoBj0E,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAO9Z,SAAAA,CAAU6C,iBAAAA,AAAAA,GAE9D7C,IAAYA,EAAU/wE,MAAAA,CAAOy4G;wBAC/B,OACE1nC,EAAUzxE,IAAAA,CAAKmtE;;gBAGrB;gBAKA9sE,IAAAA,CAAKi4G,UAAAA,CAAWxqE,MAAAA,CAAO2jC,GAAWt6B;gBAGlC,IAAI+6B,IAAQ7xE,IAAAA,CAAKi4G,UAAAA,CAAW1mC,UAAAA,CAAWH,GAAWt6B;gBAElD92C,IAAAA,CAAKs4G,qBAAAA,CAAsB9wG,KAAAA;gBAG3B,IAAIurE,IAA+B,EAAA;gBAEnC,MAAMe,IAA0B9zE,IAAAA,CAAK+4G,SAAAA,IAG/B/kC,IAAUh0E,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAOlX,OAAAA;gBACrC,IAAK,IAAIglC,IAAO,GAAGA,IAAOhlC,GAASglC,IAUjC,IATIA,IAAO,KAETh5G,IAAAA,CAAK44G,aAAAA,CAAcnrE,MAAAA,CAAOqJ,IAGxBi8B,EAASzyE,MAAAA,IACXuxE,CAAAA,IAAQkB,EAAS9yE,GAAAA,CAAKwU,CAAAA,IAAM,IAAI03D,GAAK13D,EAAE23D,SAAAA,EAAW33D,EAAE43D,SAAAA,EAAAA,GAGlDwF,EAAMvxE,MAAAA,EAAQ;oBAChByyE,IAAW/yE,IAAAA,CAAKi4G,UAAAA,CAAWnlC,WAAAA,CAAYjB,GAAiC,SAA1B,CAAA,IAAmB,SAAnB,CAAA,IAAY,SAAZ,CAAA,IAAA7xE,IAAAA,CAAK2iE,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAE3qD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEwqC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE+uD,SAAAA,GAC1Ex+B,IAAWe,EAAOwhC,KAAAA,CAAMviC;oBAGxB,KAAK,MAAM5vB,KAAW4vB,EAAU;wBAC9B,IAAI5vB,EAAQq6B,UAAAA,IACV;wBAGF,MAAMhyE,IAAQ23C,EAAQvjD,EAAAA,CAAG6I,OAAAA,CAAQ;wBACjC,IAAI+C,IAAQ,GAAG;4BACb,MAAMytG,IAAc91D,EAAQvjD,EAAAA,CAAGs5G,SAAAA,CAAU1tG,IAAQ;4BACjDxL,IAAAA,CAAKs4G,qBAAAA,CAAsBttF,GAAAA,CAAIiuF,GAAa91D;wBAC9C,OACEnjD,IAAAA,CAAKs4G,qBAAAA,CAAsBttF,GAAAA,CAAIm4B,EAAQvjD,EAAAA,EAAIujD;oBAE/C;gBACF;gBAIFnjD,IAAAA,CAAKm5G,kBAAAA,IAGLn5G,IAAAA,CAAKq4G,kBAAAA,CAAmB7wG,KAAAA,IAGxBxH,IAAAA,CAAKq4G,kBAAAA,GAAqB,IAAI/pF,IAAItuB,IAAAA,CAAKs4G,qBAAAA;gBAGvC,KAAK,MAAMp0D,KAAUlkD,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAU;oBACxC,MAAMvjC,IAAW5oB,EAAOvhD,GAAAA,CAAIqmF;oBACxBlc,KACFA,EAASuc,sBAAAA;gBAEb;YACF;YAEA,aAAAgrB;gBACEt2B,GAAewB,cAAAA,CAAelzC,IAAAA;YAChC;YAEA,YAAA0sE;gBAME,OALI/4G,IAAAA,CAAKo4G,YAAAA,IACPp4G,CAAAA,IAAAA,CAAKo4G,YAAAA,GAAAA,CAAe,GACpBp4G,IAAAA,CAAKu4G,aAAAA,GAAgB,IAAIpD,GAAan1G,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAOvW,MAAAA,GAC3D30E,IAAAA,CAAKw4G,gBAAAA,GAAmB,IAAIzB,GAAgB/2G,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAOrW,SAAAA,CAAAA,GAE5D70E,IAAAA,CAAKk4G,QAAAA,CAAShtB,MAAAA,CAAOpX,MAAAA,KAAWpJ,GAAe0uC,SAAAA,GAAYp5G,IAAAA,CAAKw4G,gBAAAA,GAAmBx4G,IAAAA,CAAKu4G,aACjG;YAAA;YAEA,MAAMz4F,CAAAA,EAAAA;gBACJ9f,IAAAA,CAAKi4G,UAAAA,CAAWjgG,KAAAA,CAAM8H,GAAI;YAC5B;YAEO,qBAAAq5F;gBAEL,KAAK,MAAA,CAAOv5G,GAAI6U,EAAAA,IAAMzU,IAAAA,CAAKs4G,qBAAAA,CAEzB,IAAA,CAAKt4G,IAAAA,CAAKq4G,kBAAAA,CAAmBtgG,GAAAA,CAAInY,IAAK;oBACpC,MAAMwsE,IAAY33D,EAAE23D,SAAAA,EACdC,IAAY53D,EAAE43D,SAAAA,EACdrxD,IAAOtE,EAAK0E,aAAAA,CAAc3G,EAAEsoE,GAAAA,GAC5Bg5B,IAAWr/F,EAAKqE,WAAAA,CAAYC;oBAClCoxD,EAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,kBAAkB,IAAIu7C,GAAoB0oB,GAAWC,GAAWrxD,GAAMvG,KAC5F23D,EAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAIk7C,GAAkB+oB,GAAWC,GAAWrxD,GAAMvG,KACxF43D,EAAUnyD,MAAAA,CAAO/R,IAAAA,CAAK,kBAAkB,IAAIu7C,GAAoB2oB,GAAWD,GAAW2pC,GAAUthG,KAChG43D,EAAUnyD,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAIk7C,GAAkBgpB,GAAWD,GAAW2pC,GAAUthG;gBAC9F;gBAIF,KAAK,MAAA,CAAO7U,GAAI6U,EAAAA,IAAMzU,IAAAA,CAAKq4G,kBAAAA,CACzB,IAAA,CAAKr4G,IAAAA,CAAKs4G,qBAAAA,CAAsBvgG,GAAAA,CAAInY,IAAK;oBACvC,MAAMwsE,IAAY33D,EAAE23D,SAAAA,EACdC,IAAY53D,EAAE43D,SAAAA,EACdrxD,IAAOtE,EAAK0E,aAAAA,CAAc3G,EAAEsoE,GAAAA,GAC5Bg5B,IAAWr/F,EAAKqE,WAAAA,CAAYC;oBAClCoxD,EAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAIw7C,GAAkByoB,GAAWC,GAAWrxD,GAAMvG,KACxF23D,EAAUlyD,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIm7C,GAAgB8oB,GAAWC,GAAWrxD,GAAMvG,KACpF43D,EAAUnyD,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAIw7C,GAAkB0oB,GAAWD,GAAW2pC,GAAUthG,KAC5F43D,EAAUnyD,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIm7C,GAAgB+oB,GAAWD,GAAW2pC,GAAUthG;gBAC1F;YAEJ;QAAA;QCnNK,SAAS4kG,GAAeC,CAAAA,EAAkBC,CAAAA,EAAkBzK,CAAAA,EAAeztF,CAAAA;YAChF,IAAIi4F,EAAMppE,MAAAA,KAAWqpE,EAAMrpE,MAAAA,EAAQ;gBAGjC,MAAMspE,IAAqBF,EAAMrnG,KAAAA,IAC3Bg6E,IAAeqtB,EAAMxoE,SAAAA,CAAU7+B,KAAAA,IAC/BwnG,IAAiBH,EAAMjpE,WAAAA,CAAYp+B,KAAAA,IACnCynG,IAAoBJ,EAAMroE,cAAAA;gBAChCuoE,EAAmBtpE,MAAAA,GAASqpE,EAAMrpE,MAAAA,EAClCspE,EAAmB1oE,SAAAA,GAAYm7C,GAC/ButB,EAAmBnpE,WAAAA,GAAcopE,GACjCD,EAAmBvoE,cAAAA,GAAiByoE,GACpCJ,IAAQE;YACV;YACA,IAAIxK,IAAkBuK,EAAM1+F,GAAAA,EACxB8+F,IAAoBJ,EAAMtpG,KAAAA,EAC1B2pG,IAAuBL,EAAM52F,QAAAA;YAEjCqsF,IAAkBuK,EAAM1+F,GAAAA,CAAI5K,KAAAA,CAAM6+F,GAAO1+F,GAAAA,CAAIkpG,EAAMz+F,GAAAA,CAAI5K,KAAAA,CAAM,IAAM6+F,KACnE6K,IAAoBJ,EAAMtpG,KAAAA,CAAMA,KAAAA,CAAM6+F,GAAO1+F,GAAAA,CAAIkpG,EAAMrpG,KAAAA,CAAMA,KAAAA,CAAM,IAAM6+F;YAEzE,MAAM5pF,IAAAA,AAAU,CAAA,IAAM4pF,CAAAA,IAASxpG,KAAKiJ,GAAAA,CAAI+qG,EAAM32F,QAAAA,IAAYmsF,IAAQxpG,KAAKiJ,GAAAA,CAAIgrG,EAAM52F,QAAAA,GAC3EsC,IAAAA,AAAQ,CAAA,IAAM6pF,CAAAA,IAASxpG,KAAKkJ,GAAAA,CAAI8qG,EAAM32F,QAAAA,IAAYmsF,IAAQxpG,KAAKkJ,GAAAA,CAAI+qG,EAAM52F,QAAAA;YAC/Ei3F,IAAuBt0G,KAAK4L,KAAAA,CAAM+T,GAAMC;YAExC,MAAMe,IAAK5E,QAAAA,IAAAA,IAAU,IAAI;YAEzB,OADA4E,EAAGsrB,YAAAA,CAAay9D,GAAiB4K,GAAsBD,IAChD1zF;QACT;QDVS,GAAA8d,QAAAA,GAAW4rE,GAAeE,MAAAA;QEJ5B,MAAMgK,WAAuB3J;YAWlC,IAAA,mBAAW4J;gBACT,OAAO95G,IAAAA,CAAK+5G,iBACd;YAAA;YAEA,YAAmBjF,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GAZH,IAAA,CAAAhB,UAAAA,GAAa7D,GAAW+J,IAAAA,EAChC,IAAA,CAAArU,MAAAA,GAAS,GAKT,IAAA,CAAAoU,iBAAAA,GAA0C,EAAA,EA8B1C,IAAA,CAAAE,YAAAA,GAAAA,CAAe,GACf,IAAA,CAAAC,aAAAA,GAAgB;oBACtBl6G,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe;gBAAI,GA2LlB,IAAA,CAAAE,6BAAAA,GAAgC,IAAI,IAnN1Cn6G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoB4M;iBAAAA,GACnDv/C,IAAAA,CAAKwvE,KAAAA,CAAMwiC,YAAAA,CAAa7/D,SAAAA,CAAW7yB,CAAAA;oBACjC,MAAM2G,IAAK3G,EAAE3c,GAAAA,CAAIgwC;oBACjB3yC,IAAAA,CAAK+5G,iBAAAA,CAAkBp6G,IAAAA,CAAKsmB,IAC5BA,EAAGgtB,cAAAA,CAAed,SAAAA,CAAUnyC,IAAAA,CAAKk6G,aAAAA,GACjCl6G,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe;gBAAI,IAE1Bj6G,IAAAA,CAAKwvE,KAAAA,CAAMyiC,cAAAA,CAAe9/D,SAAAA,CAAW7yB,CAAAA;oBACnC,MAAM2G,IAAK3G,EAAE3c,GAAAA,CAAIgwC;oBACjB1sB,EAAGgtB,cAAAA,CAAeX,WAAAA,CAAYtyC,IAAAA,CAAKk6G,aAAAA;oBACnC,MAAM1uG,IAAQxL,IAAAA,CAAK+5G,iBAAAA,CAAkBtxG,OAAAA,CAAQwd;oBACzCza,IAAAA,MACFxL,IAAAA,CAAK+5G,iBAAAA,CAAkBrxG,MAAAA,CAAO8C,GAAO;gBACvC;YAEJ;YAEO,WAAWspG,CAAAA,EAAc9uD,CAAAA,EAAAA;gBAC9BhmD,IAAAA,CAAK62D,OAAAA,GAAU7Q,EAAM4Q,MAAAA,EACrB52D,IAAAA,CAAK2iE,OAAAA,GAAU3c,EAAM/rC,MACvB;YAAA;YAOO,YAAAm6F;gBAELp0G,IAAAA,CAAKktC,gBAAAA,GAAmBltC,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,EACjC5sC,IAAAA,CAAKi6G,YAAAA,IACPj6G,CAAAA,IAAAA,CAAK+5G,iBAAAA,CAAkBpoD,IAAAA,CAAK,CAACvvD,GAAGkQ,IACvBlQ,EAAEgvC,OAAAA,GAAU9+B,EAAE8+B,OAAAA,GAEvBpxC,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe,CAAA;YAExB;YAEO,OAAOnjE,CAAAA,EAAAA;gBAEZ,IAAIgJ;gBADJ9/C,IAAAA,CAAK2lG,MAAAA,IAELtoD,GAAUS,kBAAAA,IAIV99C,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBvoB,IAAAA,CAAK62D,OAAAA,IACP72D,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA;gBAEzB,IAAK,IAAIktE,IAAiB,GAAGA,IAAiBp6G,IAAAA,CAAK+5G,iBAAAA,CAAkBz5G,MAAAA,EAAQ85G,IAAkB;oBAC7F,MAAMr9F,IAAY/c,IAAAA,CAAK+5G,iBAAAA,CAAkBK,EAAAA,EACnCl2D,IAASnnC,EAAU60B,KAAAA;oBAGzB,IAAIsS,EAAO0C,MAAAA,CAAO,iBAChB;oBAKF,IAFA9G,IAAWoE,EAAOvhD,GAAAA,CAAI48C,KAAAA,CAEjBO,EAASL,SAAAA,EACZ;oBAIEK,EAASO,kBAAAA,IACXP,EAASO,kBAAAA,CAAmBrgD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,IAErDoN,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,oBAAoB,IAAI45C,GAAsB/hD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,GAASoN,KAG7FnnC,EAAU22B,UAAAA,KAAe5E,GAAWykB,MAAAA,IACtCvzD,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IAGxBxoB,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBxL,EAAU22B,UAAAA,KAAe5E,GAAWykB,MAAAA,IACtCvzD,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAU3c,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYp+C,IAAAA,EAAMxa,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYn+C,GAAAA,GAIxGqlC,EAASrS,MAAAA,CAAOqJ,GAAS92C,IAAAA,CAAK2lG,MAAAA;oBAG9B,MAAM0U,IAAWn2D,EAAOvhD,GAAAA,CAAIm/F;oBAC5B,IAAIuY,GAAU;wBAIZ,MAAM1S,IAAiB75F,EAAOE,GAAAA,CAAIuC,GAAAA,CAAI8pG,EAAStY,cAAAA,GACzC6F,IAAiB5nG,IAAAA,CAAK62D,OAAAA,CAAQuC,OAAAA,CAAQnpD,KAAAA,CAAM03F;wBAClD3nG,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAUirF,EAAet7F,CAAAA,EAAGs7F,EAAex9F,CAAAA;oBACnE;oBAGApK,IAAAA,CAAKs6G,eAAAA,CAAgBp2D,IAGjBpE,EAAS/2B,QAAAA,IACX/oB,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBnkB,QAAAA,GAAW+2B,EAAS/2B,QAAAA,AAAAA,GAIxC+2B,EAASK,SAAAA,IACXL,EAASK,SAAAA,CAAUngD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,IAE5CoN,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,WAAW,IAAI05C,GAAa7hD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,GAASoN,KAG/ElkD,IAAAA,CAAKu6G,aAAAA,CAAcr2D,IAGnBlkD,IAAAA,CAAKw6G,sBAAAA,CAAuB16D,GAAU/iC,IAGlC+iC,EAASM,UAAAA,IACXN,EAASM,UAAAA,CAAWpgD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,IAE7CoN,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,YAAY,IAAI25C,GAAc9hD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,GAASoN,KAEjFlkD,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IAGlBzL,EAAU22B,UAAAA,KAAe5E,GAAWykB,MAAAA,IACtCvzD,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBvoB,IAAAA,CAAK62D,OAAAA,IACP72D,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,CAAAA,GAKvB4S,EAASQ,mBAAAA,IACXR,EAASQ,mBAAAA,CAAoBtgD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,IAEtDoN,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,qBAAqB,IAAI65C,GAAuBhiD,IAAAA,CAAKktC,gBAAAA,EAAkB4J,GAASoN;gBACrG;gBACAlkD,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA;YACxB;YAEQ,uBAAuBiyF,CAAAA,EAAsCC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACnE,IAAID,EAAkBh7D,SAAAA,EAAW;oBAC/B,MAAMn0B,IAAiBmvF,EAAkBnvF,cAAAA,EACnCE,IAAeivF,EAAkBjvF,YAAAA,EAEjC4pB,IAAUqlE,EAAkB/xF,OAAAA,EAC5BzP,IAA0C,SAAhC,CAAA,IAAAwhG,EAAkB95D,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAI,CAAC;oBAErD,IAAIvL,GAAS;wBACX,IAAItjC,IAAS2oG,EAAkB3oG,MAAAA,EAC3BmjB,IAASwlF,EAAkBxlF,MAAAA,EAC3B4lC,IAAS,GACTC,IAAS;wBAET7hD,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASnH,MAAAA,AAAAA,KACXA,CAAAA,IAASmH,EAAQnH,MAAAA,AAAAA,GAAAA,AAEfmH,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASgc,MAAAA,AAAAA,KACXA,CAAAA,IAAShc,EAAQgc,MAAAA,AAAAA;wBAEnB,MAAMob,IAAcqqE,EAAmBrqE,WAAAA;wBACvCwqB,KAAUzlB,EAAQnlC,KAAAA,CAAM3D,CAAAA,GAAI+jC,EAAY/jC,CAAAA,EACxCwuD,KAAU1lB,EAAQnlC,KAAAA,CAAM7F,CAAAA,GAAIimC,EAAYjmC,CAAAA;wBAGxC,MAAM82C,IAAAA,CAAW9L,EAAQj7B,KAAAA,GAAQrI,EAAOxF,CAAAA,GAAI2oB,EAAO3oB,CAAAA,GAAIuuD,GACjD1Z,IAAAA,CAAW/L,EAAQ/6B,MAAAA,GAASvI,EAAO1H,CAAAA,GAAI6qB,EAAO7qB,CAAAA,GAAI0wD,GAElD6/C,IAAoBvlE,EAAQ9pB,cAAAA,EAC5BsvF,IAAkBxlE,EAAQ5pB,YAAAA;wBAehC,IAAA,AAdIF,CAAAA,KAAkBE,CAAAA,KAEpB4pB,CAAAA,EAAQ9pB,cAAAA,GAAiBA,IAAAA,CAAkBqvF,IAAoBA,GAC/DvlE,EAAQ5pB,YAAAA,GAAeA,IAAAA,CAAgBovF,IAAkBA,CAAAA,GAG3DxlE,QAAAA,KAAAA,EAASv1B,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBgU,GAASC,IAAAA,AAE1C71B,CAAAA,KAAkBE,CAAAA,KACpB4pB,CAAAA,EAAQ9pB,cAAAA,GAAiBqvF,GACzBvlE,EAAQ5pB,YAAAA,GAAeovF,CAAAA,GAAAA,AAIT,CAAA,SAAZ,CAAA,IAAA56G,IAAAA,CAAK2iE,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAEk4C,OAAAA,AAAAA,KAAW76G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8nC,QAAAA,CAASg7D,UAAAA,EAAY;4BACnE,MAAM7lF,IAASvmB,EAAIwyC,GAASC;4BAC5B,IAAI/L,aAAmB4B,IACrB,KAAK,MAAMI,KAAUhC,EAAQ8B,OAAAA,CAAS;gCACpC,IAAI7kC,GACAwI,IAAc/M,EAAOC,IAAAA;gCACrBqpC,aAAkBjsB,KACpB9Y,IAAI+kC,IAEJ/kC,CAAAA,IAAI+kC,EAAOhC,OAAAA,EACXv6B,IAAMu8B,EAAOniB,MAAAA,AAAAA,GAGXmgB,EAAQ6B,SAAAA,GACV5kC,QAAAA,KAAAA,EAAG6Z,WAAAA,CAAYvP,SAAAA,CAAUsY,EAAO7kB,GAAAA,CAAIyK,IAAMgF,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBltC,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8nC,QAAAA,CAASi7D,WAAAA,IAElG1oG,QAAAA,KAAAA,EAAG6Z,WAAAA,CAAYvP,SAAAA,CAAU9B,GAAKgF,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBltC,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8nC,QAAAA,CAASi7D,WAAAA;4BAE1F;iCAGA3lE,QAAAA,KAAAA,EAASlpB,WAAAA,CAAYvP,SAAAA,CAAUsY,GAAQpV,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBltC,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8nC,QAAAA,CAASi7D,WAAAA;wBAEnG;oBACF;gBACF;YACF;YAOQ,gBAAgB72D,CAAAA,EAAAA;gBACtB,MAAM82D,IAAY92D,EAAOuD,YAAAA;gBACzB,IAAK,IAAIjnD,IAAI,GAAGA,IAAIw6G,EAAU16G,MAAAA,EAAQE,IAAK;oBACzC,MAAMy6G,IAAWD,CAAAA,CAAUx6G,EAAAA,EACrBuc,IAAYk+F,QAAAA,IAAAA,KAAQ,IAARA,EAAUt4G,GAAAA,CAAIgwC,KAC1BsiE,IAAegG,QAAAA,IAAAA,KAAQ,IAARA,EAAUt4G,GAAAA,CAAI6pE;oBACnC,IAAIzvD,GAAW;wBACb,IAAIkJ,IAAKlJ,EAAUpa,GAAAA;wBACnB,IAAIsyG,KACEj1G,IAAAA,CAAK2iE,OAAAA,CAAQksC,mBAAAA,IAAuBoG,EAAa5qB,sBAAAA,IAA0B4qB,EAAa3qB,4BAAAA,EAA8B;4BAExH,MAAMwkB,IAAQ9uG,IAAAA,CAAK2iE,OAAAA,CAAQosC,iBAAAA,GAAoB/uG,IAAAA,CAAK2iE,OAAAA,CAAQksC,mBAAAA;4BAC5D5oF,IAAKozF,GAAepE,EAAapjD,YAAAA,EAAc90C,EAAUpa,GAAAA,IAAOmsG,GAAO9uG,IAAAA,CAAKm6G,6BAAAA;wBAC9E;wBAEFn6G,IAAAA,CAAKktC,gBAAAA,CAAiBrkB,CAAAA,GAAI9L,EAAUq0B,OAAAA,EACpCpxC,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAUsJ,EAAGpL,GAAAA,CAAIvO,CAAAA,EAAG2Z,EAAGpL,GAAAA,CAAIzQ,CAAAA,GACjDpK,IAAAA,CAAKktC,gBAAAA,CAAiBj9B,KAAAA,CAAMgW,EAAGhW,KAAAA,CAAM3D,CAAAA,EAAG2Z,EAAGhW,KAAAA,CAAM7F,CAAAA,GACjDpK,IAAAA,CAAKktC,gBAAAA,CAAiBr7B,MAAAA,CAAOoU,EAAGtD,QAAAA;oBAClC;gBACF;YACF;YAEQ,cAAcuhC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACpB,MAAM82D,IAAY92D,EAAOuD,YAAAA;gBACzB,IAAK,IAAIjnD,IAAI,GAAGA,IAAIw6G,EAAU16G,MAAAA,EAAQE,IAAK;oBACzC,MAAMy6G,IAAWD,CAAAA,CAAUx6G,EAAAA,EACrB06G,IAAgBD,QAAAA,IAAAA,KAAQ,IAARA,EAAUt4G,GAAAA,CAAI48C;oBACpCv/C,IAAAA,CAAKktC,gBAAAA,CAAiBtkB,OAAAA,IAAiC,SAAtB,CAAA,IAAAsyF,QAAAA,IAAAA,KAAa,IAAbA,EAAetyF,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;gBAC7D;YACF;QAAA;QAtQO,GAAAmb,QAAAA,GAAW4rE,GAAeG,OAAAA;QCD5B,MAAMqL,WAAoBjL;YAU/B,YAAmB4E,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GAPH,IAAA,CAAAhB,UAAAA,GAAa7D,GAAW+J,IAAAA,EAStCh6G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;iBAAAA;YACjC;YAEO,WAAWmiE,CAAAA,EAAc9uD,CAAAA,EAAAA;gBAC9BhmD,IAAAA,CAAKktC,gBAAAA,GAAmB8Y,EAAM/rC,MAAAA,CAAO2yB,eAAAA,EACrC5sC,IAAAA,CAAK62D,OAAAA,GAAU7Q,EAAM4Q,MAAAA,EACrB52D,IAAAA,CAAK2iE,OAAAA,GAAU3c,EAAM/rC,MAAAA,EACrBja,IAAAA,CAAKo7G,gBAAAA,GAAmBtG,EAAMP,aAAAA,CAAc5xG,GAAAA,CAAIq1G;YAClD;YAEA,SAAAvqE;gBAAAA,IAAAA;gBACE,IAAA,CAAKztC,IAAAA,CAAK2iE,OAAAA,CAAQk4C,OAAAA,EAChB;gBAGF,MAAMQ,IAAiBr7G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAMhQ,MAAAA;gBAE1C,IAAIpI,GACA6uB;gBACJ,MAAM6sF,IAAiBt7G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAMksC,MAAAA;gBAE1C,IAAIj+B;gBACJ,MAAMs1F,IAAav7G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM+E,SAAAA;gBAEtC,IAAIitC;gBACJ,MAAMwxD,IAAiBx7G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAMgyC,MAAAA;gBAE1C,IAAI6uD;gBACJ,MAAM4C,IAAmBz7G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM80D,QAAAA,EAEtC4uC,IAAkB17G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM45D,OAAAA;gBAE3C,IAAI9xB;gBACJ,MAAM67D,IAAmB37G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8nC,QAAAA;gBAE5C,IAAI87D,GAEA9hG;gBACJ,MAAM+hG,IAAe77G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM8B,IAAAA,EAElCgiG,IAAiB97G,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAM4+C,MAAAA;gBAC1C,IAAK,IAAIp2D,IAAI,GAAGA,IAAIR,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS/vG,MAAAA,EAAQE,IAAK;oBACnD,MAAM0jD,IAASlkD,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS7vG,EAAAA;oBACnC,IAAI0jD,EAAO0C,MAAAA,CAAO,cAEhB;oBAEF,IAAI1C,aAAkBuG,IAEpB;oBAEF,IAAI4wD,EAAeU,SAAAA,EAAW;wBAG5B,IAAA,CAF6C,CAAA,MAA9BV,EAAeW,GAAAA,CAAI17G,MAAAA,IACR+6G,EAAeW,GAAAA,CAAI/6F,QAAAA,CAASijC,EAAOtkD,EAAAA,CAAAA,GAE3D;wBAIF,IAAA,CAF8C,CAAA,OAA7By7G,EAAeY,SAAAA,IACF/3D,EAAOz1B,IAAAA,CAAKxN,QAAAA,CAASo6F,EAAeY,SAAAA,CAAAA,GAEhE;oBAEJ;oBAEA,IAAIC,IAASpuG,EAAOC,IAAAA;oBACpB,MAAM0lB,IAAa/kB,EAAI,GAAG;oBAuD1B,IAtDA9O,IAAKskD,EAAOtkD,EAAAA,EACZ6uB,IAAOy1B,EAAOz1B,IAAAA,EACdxI,IAAKi+B,EAAOvhD,GAAAA,CAAIgwC,KAGhB3yC,IAAAA,CAAKm8G,oBAAAA,CAAqBl2F,IAE1BjmB,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBtC,EAAGytB,UAAAA,KAAe5E,GAAWykB,MAAAA,IAC/BvzD,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAU3c,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYp+C,IAAAA,EAAMxa,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYn+C,GAAAA,GAExGza,IAAAA,CAAKktC,gBAAAA,CAAiBrkB,CAAAA,GAAI0yF,EAAWa,WAAAA,EAErCp8G,IAAAA,CAAKs6G,eAAAA,CAAgBp2D,IACjBj+B,KAAAA,CAAAA,AACEs1F,CAAAA,EAAW/S,OAAAA,IAAW+S,EAAWc,YAAAA,AAAAA,KACnCr8G,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAM6zC,SAAAA,CAAU/9C,EAAOC,IAAAA,EAAM;wBAAE+B,MAAM;wBAAG6D,OAAO4nG,EAAWe,aAAAA;oBAAAA,IAAAA,AAE9Ef,CAAAA,EAAW/S,OAAAA,IAAW+S,EAAWgB,iBAAAA,AAAAA,KACnCv8G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,GAAA,EAAMvnC,EAAGpL,GAAAA,CAAI9a,QAAAA,CAAS,IAAA,EAAMm8G,IACjEA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAElB8nF,CAAAA,EAAW/S,OAAAA,IAAW+S,EAAWiB,UAAAA,AAAAA,KACnCx8G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,EAAA,EAAKvnC,EAAG4C,CAAAA,CAAE1W,OAAAA,CAAQ,GAAA,CAAA,CAAA,EAAO+pG,IAC9DA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlB6nF,CAAAA,EAAe9S,OAAAA,IAAW8S,EAAemB,MAAAA,AAAAA,KAC3Cz8G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,GAAA,EAAM5tD,EAAAA,EAAAA,EAAOskD,EAAOhU,MAAAA,GAAS,iBAA8B,CAAA,SAAb,CAAA,IAAAgU,EAAOhU,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEtwC,EAAAA,AAAAA,IAAK,MAAM,IAAA,EAAMs8G,IACnHA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlB6nF,CAAAA,EAAe9S,OAAAA,IAAW8S,EAAeoB,QAAAA,AAAAA,KAC3C18G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,KAAA,EAAQ/+B,EAAAA,CAAAA,CAAAA,EAASytF,IACtDA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlB8nF,CAAAA,EAAW/S,OAAAA,IAAW+S,EAAWoB,YAAAA,AAAAA,KACnC38G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBnC,QAAAA,CACpBj9B,EAAOC,IAAAA,EACPD,EAAOQ,SAAAA,CAAU2X,EAAGtD,QAAAA,EAAU1S,KAAAA,CAAM,IAAIG,GAAAA,CAAItC,EAAOC,IAAAA,GACnDwtG,EAAWqB,aAAAA,EACX,IAEF58G,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,QAAA,EAAWrgD,EAAU8Y,EAAGtD,QAAAA,EAAUxQ,OAAAA,CAAQ,GAAA,CAAA,CAAA,EAAO+pG,IACtFA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlB8nF,CAAAA,EAAW/S,OAAAA,IAAW+S,EAAWsB,SAAAA,AAAAA,KACnC78G,IAAAA,CAAKktC,gBAAAA,CAAiBnC,QAAAA,CAASj9B,EAAOC,IAAAA,EAAMkY,EAAGhW,KAAAA,CAAMG,GAAAA,CAAItC,EAAOC,IAAAA,GAAOwtG,EAAWuB,UAAAA,EAAY,EAAA,GAIlGh9D,IAAWoE,EAAOvhD,GAAAA,CAAI48C,KAClBO,KACE67D,CAAAA,EAAiBnT,OAAAA,IAAWmT,EAAiBb,UAAAA,AAAAA,GAChCh7D,EAAS5zB,WAAAA,CACjBrM,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkByuE,EAAiBZ,WAAAA;oBAmExD,IA/DAa,IAAY13D,EAAOvhD,GAAAA,CAAIq/F,KACnB4Z,KACGA,CAAAA,EAAU3Z,YAAAA,IACbjiG,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IAExBozF,EAAU/7F,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBltC,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,GAC9C4jG,EAAU3Z,YAAAA,IACbjiG,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IACtBvoB,IAAAA,CAAKs6G,eAAAA,CAAgBp2D,EAAAA,CAAAA,GAIzBpqC,IAAOoqC,EAAOvhD,GAAAA,CAAI6pE,KACd1yD,KAAAA,CAAAA,AACE+hG,CAAAA,EAAarT,OAAAA,IAAWqT,EAAakB,kBAAAA,AAAAA,KACvC/8G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,gBAAA,EAAmB1zC,EAAKoxD,KAAAA,CAAMz8C,IAAAA,CAAAA,CAAAA,CAAAA,EAASytF,IAC5EA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlBooF,CAAAA,EAAarT,OAAAA,IAAWqT,EAAamB,iBAAAA,AAAAA,KACvCh9G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,eAAA,EAAkB1zC,EAAK4yD,aAAAA,CAAAA,CAAAA,CAAAA,EAAkBwvC,IAC9EA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlBooF,CAAAA,EAAarT,OAAAA,IAAWqT,EAAaoB,QAAAA,AAAAA,KACvCj9G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,KAAA,EAAQ1zC,EAAKg8D,IAAAA,CAAAA,CAAAA,CAAAA,EAASomC,IAC3DA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlBooF,CAAAA,EAAarT,OAAAA,IAAWqT,EAAaqB,UAAAA,AAAAA,KACvCl9G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,OAAA,EAAU1zC,EAAKyjE,WAAAA,CAAAA,CAAAA,CAAAA,EAAgB2+B,IACpEA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlBooF,CAAAA,EAAarT,OAAAA,IAAWqT,EAAasB,YAAAA,AAAAA,KACvCn9G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,SAAA,EAAY1zC,EAAKwxE,QAAAA,GAAWxxE,EAAKwjE,UAAAA,GAAa,aAAA,CAAA,CAAA,EAAiB4+B,IACpGA,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,CAAAA,GAIxBzzB,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IAGtBxoB,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBtC,EAAGytB,UAAAA,KAAe5E,GAAWykB,MAAAA,IAC/BvzD,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAU3c,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYp+C,IAAAA,EAAMxa,IAAAA,CAAK2iE,OAAAA,CAAQ3uD,MAAAA,CAAO4kD,WAAAA,CAAYn+C,GAAAA,GAExGza,IAAAA,CAAKktC,gBAAAA,CAAiBrkB,CAAAA,GAAI0yF,EAAWa,WAAAA,EACrCpyD,IAAS9F,EAAOvhD,GAAAA,CAAI4mD,KAChBS,KAAAA,CAAAA,AACEwxD,CAAAA,EAAehT,OAAAA,IAAWgT,EAAe4B,YAAAA,AAAAA,KAC3Cp9G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,GAAA,EAAMxD,EAAOR,GAAAA,CAAIzpD,QAAAA,CAAS,IAAA,EAAMm8G,EAAO9rG,GAAAA,CAAI6V,EAAG6qB,SAAAA,IACnF9wC,IAAAA,CAAKktC,gBAAAA,CAAiBnC,QAAAA,CAAS9kB,EAAG6qB,SAAAA,EAAW7qB,EAAG6qB,SAAAA,CAAU1gC,GAAAA,CAAI45C,EAAOR,GAAAA,GAAMgyD,EAAe6B,aAAAA,EAAe,IACzGnB,IAASA,EAAO9rG,GAAAA,CAAIqjB,EAAAA,GAAAA,AAGlB+nF,CAAAA,EAAehT,OAAAA,IAAWgT,EAAe8B,gBAAAA,AAAAA,KAC3Ct9G,IAAAA,CAAKktC,gBAAAA,CAAiBnC,QAAAA,CAAS9kB,EAAG6qB,SAAAA,EAAW7qB,EAAG6qB,SAAAA,CAAU1gC,GAAAA,CAAI45C,EAAOP,GAAAA,GAAM+xD,EAAe+B,iBAAAA,EAAmB,EAAA,GAKjH1E,IAAe30D,EAAOvhD,GAAAA,CAAIqmF,KACtB6vB,GAAc;wBAChB,MAAM/rC,IAAW+rC,EAAal2G,GAAAA;wBAO9B,IAAA,AANK84G,CAAAA,EAAiBjT,OAAAA,IAAWiT,EAAiB+B,YAAAA,AAAAA,KAAiB1wC,KACjEA,EAAS90D,KAAAA,CAAMhY,IAAAA,CAAKktC,gBAAAA,EAAkBuuE,EAAiBvS,aAAAA,EAAe;4BACpElxD,WAAWyjE,EAAiBtS,iBAAAA;4BAC5BE,WAAWoS,EAAiBrS,iBAAAA;wBAAAA,IAG5BqS,EAAiBjT,OAAAA,IAAWiT,EAAiBX,UAAAA,EAC/C;4BAAA,IAAIhuC,aAAoBqE,IAAmB;gCACzC,MAAMC,IAAYtE,EAAS4D,YAAAA;gCAC3B,KAAK,MAAM5D,KAAYsE,EAAW;oCAChC,MAAMp8C,IAAS83C,EAAS93C,MAAAA,EAClBna,IAAMnM,EAAIsmB,EAAOxa,IAAAA,EAAMwa,EAAOva,GAAAA;oCACpCza,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAM+H,QAAAA,CAASlF,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA,EAAG4qB,EAAO7a,KAAAA,EAAO6a,EAAO3a,MAAAA,EAAQ;wCAAE1G,OAAO8nG,EAAiBV,WAAAA;oCAAAA,IAAAA,AACtGU,CAAAA,EAAiBjT,OAAAA,IAAWiT,EAAiBgC,SAAAA,AAAAA,KAC/Cz9G,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,SAAA,EAAYsf,EAASl7B,KAAAA,CAAMhyC,EAAAA,CAAAA,CAAAA,CAAAA,EAAOib;gCAE3E;gCACAg+F,EAAa7jF,MAAAA,CAAOnV,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,EAAkBuuE,EAAiBV,WAAAA;4BACnE,OAAO,IAAIjuC,GAAU;gCACnB,MAAM93C,IAAS6jF,EAAa7jF,MAAAA,EACtBna,IAAMnM,EAAIsmB,EAAOxa,IAAAA,EAAMwa,EAAOva,GAAAA;gCACpCza,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAM+H,QAAAA,CAASlF,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA,EAAG4qB,EAAO7a,KAAAA,EAAO6a,EAAO3a,MAAAA,EAAQ;oCAAE1G,OAAO8nG,EAAiBV,WAAAA;gCAAAA,IAAAA,AACtGU,CAAAA,EAAiBjT,OAAAA,IAAWiT,EAAiBgC,SAAAA,AAAAA,KAC/Cz9G,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,SAAA,EAAYqrD,EAAajnE,KAAAA,CAAMhyC,EAAAA,CAAAA,CAAAA,CAAAA,EAAOib;4BAE/E;wBAAA;oBAEJ;oBAEA7a,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IACtBxoB,IAAAA,CAAK09G,mBAAAA,CAAoBz3F;gBAC3B;gBAOA,IALAjmB,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IACtBvoB,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,GAAAA,AACnBwuE,CAAAA,EAAgBlT,OAAAA,IAAWkT,EAAgBiC,iCAAAA,AAAAA,KAC7C39G,IAAAA,CAAKo7G,gBAAAA,CAAiBpjG,KAAAA,CAAMhY,IAAAA,CAAKktC,gBAAAA,GAE/BwuE,EAAgBlT,OAAAA,IAAWkT,EAAgBkC,qBAAAA,IAAyBlC,EAAgBmC,oBAAAA,EACtF,KAAK,MAAA,CAAO18E,GAAGgiB,EAAAA,IAAYnjD,IAAAA,CAAK2iE,OAAAA,CAAQ3qD,KAAAA,CAAMwqC,KAAAA,CAAM+uD,SAAAA,CAAU3/B,OAAAA,CAAQmB,QAAAA,CAAU;oBAC9E,IAAI2oC,EAAgBlT,OAAAA,IAAWkT,EAAgBkC,qBAAAA,EAC7C,KAAK,MAAMhhG,KAASumC,EAAQpnC,MAAAA,CAC1B/b,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAM6zC,SAAAA,CAAUjvC,GAAO;wBAC3C9M,MAAM4rG,EAAgBoC,WAAAA;wBACtBnqG,OAAO+nG,EAAgBqC,qBAAAA;oBAAAA;oBAK7B,IAAIrC,EAAgBlT,OAAAA,IAAWkT,EAAgBmC,oBAAAA,EAC7C,KAAK,MAAMjhG,KAASumC,EAAQpnC,MAAAA,CAC1B/b,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAM+yB,QAAAA,CAASnuB,GAAOumC,EAAQpyC,MAAAA,CAAOd,KAAAA,CAAM,IAAIG,GAAAA,CAAIwM,IAAQ;wBAC/EjJ,OAAO+nG,EAAgBsC,oBAAAA;oBAAAA;gBAI/B;gBAEFh+G,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,IAElBszF,KACF97G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IACtBvoB,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,GAAAA,AACnB4uE,CAAAA,EAAetT,OAAAA,IAAWsT,EAAemC,SAAAA,AAAAA,KAC3Cj+G,IAAAA,CAAKktC,gBAAAA,CAAiB6jB,UAAAA,CAAW/wD,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,EAAK,GAAGihG,EAAeoC,UAAAA,GAAAA,AAEnEpC,CAAAA,EAAetT,OAAAA,IAAWsT,EAAeqC,QAAAA,AAAAA,KAC3Cn+G,IAAAA,CAAKktC,gBAAAA,CAAiBl1B,KAAAA,CAAMw1C,QAAAA,CAAS,CAAA,KAAA,EAAQxtD,IAAAA,CAAK62D,OAAAA,CAAQsC,IAAAA,CAAAA,CAAAA,CAAAA,EAASn5D,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,GAElF7a,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,EAAAA,GAGxBxoB,IAAAA,CAAKktC,gBAAAA,CAAiBzI,KAAAA;YACxB;YAEA,WAAWxqB,CAAAA,EAAwB68B,CAAAA,EAAAA;gBAC7B92C,IAAAA,CAAK2iE,OAAAA,CAAQk4C,OAAAA,IACf76G,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBvoB,IAAAA,CAAK62D,OAAAA,IACP72D,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,GAEzBj1B,GAAMwsB,KAAAA,CAAMzkC,IAAAA,CAAKktC,gBAAAA,GACjBltC,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA,EAAAA;YAE1B;YAMQ,gBAAgB07B,CAAAA,EAAAA;gBACtB,MAAM82D,IAAY92D,EAAOuD,YAAAA;gBACzB,KAAK,MAAMwzD,KAAYD,EAAW;oBAChC,MAAMj+F,IAAYk+F,QAAAA,IAAAA,KAAQ,IAARA,EAAUt4G,GAAAA,CAAIgwC;oBAC5B51B,KACF/c,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiBvwB,SAAAA,CAAUI,EAAUlC,GAAAA,CAAIvO,CAAAA,EAAGyQ,EAAUlC,GAAAA,CAAIzQ,CAAAA,GAC/DpK,IAAAA,CAAKktC,gBAAAA,CAAiBj9B,KAAAA,CAAM8M,EAAU9M,KAAAA,CAAM3D,CAAAA,EAAGyQ,EAAU9M,KAAAA,CAAM7F,CAAAA,GAC/DpK,IAAAA,CAAKktC,gBAAAA,CAAiBr7B,MAAAA,CAAOkL,EAAU4F,QAAAA,CAAAA;gBAE3C;YACF;YAMQ,qBAAqB5F,CAAAA,EAAAA;gBAEvBA,EAAU22B,UAAAA,KAAe5E,GAAWqE,KAAAA,IACtCnzC,CAAAA,IAAAA,CAAKktC,gBAAAA,CAAiB3kB,IAAAA,IAClBvoB,IAAAA,CAAK62D,OAAAA,IACP72D,IAAAA,CAAK62D,OAAAA,CAAQh3C,IAAAA,CAAK7f,IAAAA,CAAKktC,gBAAAA,CAAAA;YAG7B;YAMQ,oBAAoBnwB,CAAAA,EAAAA;gBACtBA,EAAU22B,UAAAA,KAAe5E,GAAWqE,KAAAA,IAEtCnzC,IAAAA,CAAKktC,gBAAAA,CAAiB1kB,OAAAA;YAE1B;QAAA;QAxUO,GAAAub,QAAAA,GAAW4rE,GAAeK,MAAAA;QCd5B,MAAMoO;YA2BX,YACSr9F,CAAAA,EACPs9F,CAAAA,CAAAA;gBADO,IAAA,CAAAt9F,MAAAA,GAAAA,GA3BT,IAAA,CAAAnhB,EAAAA,GAAAA,IAoBA,IAAA,CAAA0+G,KAAAA,GAA2B,EAAA,EAC3B,IAAA,CAAAC,aAAAA,GAAAA,CAAgB,GASdv+G,IAAAA,CAAKq+G,QAAAA,GAAWA,GAChBr+G,IAAAA,CAAKg1B,MAAAA,GAASjU,EAAOiU,MAAAA,EACrBh1B,IAAAA,CAAKu+G,aAAAA,GAAgBv+G,IAAAA,CAAKg1B,MAAAA,CAAO3Y,iBAAAA,IACjCrc,IAAAA,CAAKw+G,KAAAA,GAAQl5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAKq+G,QAAAA,GAChDr+G,IAAAA,CAAKy+G,MAAAA,GAASn5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKq+G,QAAAA,GAClDr+G,IAAAA,CAAK0+G,OAAAA,GAAUp5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOvZ,MAAAA,GAASzb,IAAAA,CAAKq+G,QAAAA,GACpDr+G,IAAAA,CAAK2+G,IAAAA,GAAOr5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAKq+G,QAAAA;YAChD;YAKA,aAAApR;gBACE,MAAMj4E,IAASh1B,IAAAA,CAAK+gB,MAAAA,CAAOiU,MAAAA,EACrBwpF,IAAQl5G,KAAKoF,KAAAA,CAAMsqB,EAAOxa,IAAAA,GAAOxa,IAAAA,CAAKq+G,QAAAA,GACtCI,IAASn5G,KAAKoF,KAAAA,CAAMsqB,EAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKq+G,QAAAA,GACxCK,IAAUp5G,KAAKoF,KAAAA,CAAMsqB,EAAOvZ,MAAAA,GAASzb,IAAAA,CAAKq+G,QAAAA,GAC1CM,IAAOr5G,KAAKoF,KAAAA,CAAMsqB,EAAOva,GAAAA,GAAMza,IAAAA,CAAKq+G,QAAAA;gBAC1C,OAAIr+G,IAAAA,CAAKw+G,KAAAA,KAAUA,KAASx+G,IAAAA,CAAKy+G,MAAAA,KAAWA,KAAUz+G,IAAAA,CAAK0+G,OAAAA,KAAYA,KAAW1+G,IAAAA,CAAK2+G,IAAAA,KAASA;YAIlG;YAKA,QAAAn3G;gBACE,KAAK,MAAMo3G,KAAQ5+G,IAAAA,CAAKs+G,KAAAA,CAAO;oBAC7B,MAAM9yG,IAAQozG,EAAKC,OAAAA,CAAQp2G,OAAAA,CAAQzI,IAAAA;oBAC/BwL,IAAAA,MACFozG,EAAKC,OAAAA,CAAQn2G,MAAAA,CAAO8C,GAAO;gBAG/B;YACF;YAKA,eAAAszG;gBACE9+G,IAAAA,CAAKg1B,MAAAA,GAASh1B,IAAAA,CAAK+gB,MAAAA,CAAOiU,MAC5B;YAAA;YAKA,SAAAyY;gBACEztC,IAAAA,CAAKg1B,MAAAA,GAASh1B,IAAAA,CAAK+gB,MAAAA,CAAOiU,MAAAA,EAE1Bh1B,IAAAA,CAAKw+G,KAAAA,GAAQl5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAKq+G,QAAAA,GAChDr+G,IAAAA,CAAKy+G,MAAAA,GAASn5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKq+G,QAAAA,GAClDr+G,IAAAA,CAAK0+G,OAAAA,GAAUp5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOvZ,MAAAA,GAASzb,IAAAA,CAAKq+G,QAAAA,GACpDr+G,IAAAA,CAAK2+G,IAAAA,GAAOr5G,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAKq+G,QAAAA,GAC9Cr+G,IAAAA,CAAKu+G,aAAAA,GAAgBv+G,IAAAA,CAAK+gB,MAAAA,CAAOiU,MAAAA,CAAO3Y,iBAAAA;YAC1C;QAAA;QAGK,MAAM0iG;YAAb,aAAA;gBACE,IAAA,CAAAF,OAAAA,GAAoB,EActB;YAAA;YATE,UAAUvyG,CAAAA,EAAWlC,CAAAA,EAAAA;gBACnBpK,IAAAA,CAAKsM,CAAAA,GAAIA,GACTtM,IAAAA,CAAKoK,CAAAA,GAAIA,GACTpK,IAAAA,CAAKsC,GAAAA,GAAMy8G,GAAaC,gBAAAA,CAAiB1yG,GAAGlC;YAC9C;YAEA,OAAA,iBAAwBkC,CAAAA,EAAWlC,CAAAA,EAAAA;gBACjC,OAAO,GAAGkC,EAAAA,CAAAA,EAAKlC,GACjB;YAAA;QAAA;QAGK,MAAMqqE;YAmBX,YAAYx7D,CAAAA,CAAAA;gBAdL,IAAA,CAAA+b,MAAAA,GAAS,IAAI1Z,GAEZ,IAAA,CAAA2jG,iBAAAA,GAAoB,IAAIx3F,EAC9B,IAAM,IAAIs3F,IACTG,CAAAA,IACCA,CAAAA,EAAS1zD,SAAAA,CAAU,GAAG,IACtB0zD,EAASL,OAAAA,CAAQv+G,MAAAA,GAAS,GACnB4+G,CAAAA,GAET,MAMAl/G,IAAAA,CAAKq+G,QAAAA,GAAWplG,EAAQnJ,IAAAA,EACxB9P,IAAAA,CAAK00E,cAAAA,GAAiB,IAAIpmD,KAC1BtuB,IAAAA,CAAKm/G,aAAAA,GAAgB,IAAI7wF,KACrBrV,EAAQmmG,YAAAA,GACVp/G,IAAAA,CAAKq/G,WAAAA,GAAet+F,CAAAA,IAAoB9H,EAAQmmG,YAAAA,CAAar+F,GAAQ/gB,IAAAA,CAAKq+G,QAAAA,IAE1Er+G,IAAAA,CAAKq/G,WAAAA,GAAet+F,CAAAA,IAAoB,IAAIq9F,GAAcr9F,GAAQ/gB,IAAAA,CAAKq+G,QAAAA;YAK3E;YAIA,MAAMiB,CAAAA,EAAAA;gBACJ,MAAMzrF,IAAU,IAAI5c;gBACpB,IAAIqoG,aAAyBhkG,GAAa;oBACxC,MAAM0Z,IAASsqF,GACTd,IAAQl5G,KAAKoF,KAAAA,CAAMsqB,EAAOxa,IAAAA,GAAOxa,IAAAA,CAAKq+G,QAAAA,GACtCI,IAASn5G,KAAKoF,KAAAA,CAAMsqB,EAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKq+G,QAAAA,GACxCK,IAAUp5G,KAAKoF,KAAAA,CAAMsqB,EAAOvZ,MAAAA,GAASzb,IAAAA,CAAKq+G,QAAAA,GAC1CM,IAAOr5G,KAAKoF,KAAAA,CAAMsqB,EAAOva,GAAAA,GAAMza,IAAAA,CAAKq+G,QAAAA;oBAC1C,IAAK,IAAI/xG,IAAIkyG,GAAOlyG,KAAKmyG,GAAQnyG,IAC/B,IAAK,IAAIlC,IAAIu0G,GAAMv0G,KAAKs0G,GAASt0G,IAAK;wBACpC,MAAM9H,IAAMy8G,GAAaC,gBAAAA,CAAiB1yG,GAAGlC,IAEvCw0G,IAAO5+G,IAAAA,CAAK00E,cAAAA,CAAe/xE,GAAAA,CAAIL;wBACrC,IAAIs8G,GACF,IAAK,IAAIp+G,IAAI,GAAGA,IAAIo+G,EAAKC,OAAAA,CAAQv+G,MAAAA,EAAQE,IACvCo+G,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGs+G,YAAAA,IACZF,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGw0B,MAAAA,CAAOxV,SAAAA,CAAUwV,MACnCnB,EAAQzjB,GAAAA,CAAIwuG,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGugB,MAAAA;oBAIpC;gBAEJ,OAAO;oBACL,MAAMnE,IAAQ0iG,GACRh9G,IAAMy8G,GAAaC,gBAAAA,CAAiB15G,KAAKoF,KAAAA,CAAMkS,EAAMtQ,CAAAA,GAAItM,IAAAA,CAAKq+G,QAAAA,GAAW/4G,KAAKoF,KAAAA,CAAMkS,EAAMxS,CAAAA,GAAIpK,IAAAA,CAAKq+G,QAAAA,IAEnGO,IAAO5+G,IAAAA,CAAK00E,cAAAA,CAAe/xE,GAAAA,CAAIL;oBACrC,IAAIs8G,GACF,IAAK,IAAIp+G,IAAI,GAAGA,IAAIo+G,EAAKC,OAAAA,CAAQv+G,MAAAA,EAAQE,IACvCo+G,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGs+G,YAAAA,IACZF,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGw0B,MAAAA,CAAOjW,QAAAA,CAASnC,MAClCiX,EAAQzjB,GAAAA,CAAIwuG,EAAKC,OAAAA,CAAQr+G,EAAAA,CAAGugB,MAAAA;gBAIpC;gBACA,OAAOhX,MAAMwD,IAAAA,CAAKsmB;YACpB;YAEA,IAAI0rF,CAAAA,EAAgBC,CAAAA,EAAAA;gBAClB,MAAMl9G,IAAMy8G,GAAaC,gBAAAA,CAAiBO,GAAQC;gBAElD,OADax/G,IAAAA,CAAK00E,cAAAA,CAAe/xE,GAAAA,CAAIL;YAEvC;YAEQ,QAAQgK,CAAAA,EAAWlC,CAAAA,EAAW04F,CAAAA,EAAAA;gBACpC,MAAMxgG,IAAMy8G,GAAaC,gBAAAA,CAAiB1yG,GAAGlC;gBAE7C,IAAIw0G,IAAO5+G,IAAAA,CAAK00E,cAAAA,CAAe/xE,GAAAA,CAAIL;gBAC9Bs8G,KACHA,CAAAA,IAAO5+G,IAAAA,CAAKi/G,iBAAAA,CAAkBh3F,IAAAA,IAC9B22F,EAAKpzD,SAAAA,CAAUl/C,GAAGlC,IAClBpK,IAAAA,CAAK00E,cAAAA,CAAe1pD,GAAAA,CAAI4zF,EAAKt8G,GAAAA,EAAKs8G,EAAAA,GAEpCA,EAAKC,OAAAA,CAAQl/G,IAAAA,CAAKmjG,IAClBA,EAAMwb,KAAAA,CAAM3+G,IAAAA,CAAKi/G,IACjB5+G,IAAAA,CAAKg1B,MAAAA,CAAOhW,OAAAA,CAAQ8jF,EAAM9tE,MAAAA,EAAQh1B,IAAAA,CAAKg1B,MAAAA;YACzC;YAEQ,QAAQ1oB,CAAAA,EAAWlC,CAAAA,EAAW04F,CAAAA,EAAAA;gBACpC,MAAMxgG,IAAMy8G,GAAaC,gBAAAA,CAAiB1yG,GAAGlC,IAEvCw0G,IAAO5+G,IAAAA,CAAK00E,cAAAA,CAAe/xE,GAAAA,CAAIL;gBACrC,IAAIs8G,GAAM;oBACR,MAAMa,IAAab,EAAKC,OAAAA,CAAQp2G,OAAAA,CAAQq6F;oBACpC2c,IAAAA,MACFb,EAAKC,OAAAA,CAAQn2G,MAAAA,CAAO+2G,GAAY;oBAElC,MAAMC,IAAY5c,EAAMwb,KAAAA,CAAM71G,OAAAA,CAAQm2G;oBAClCc,IAAAA,MACF5c,EAAMwb,KAAAA,CAAM51G,MAAAA,CAAOg3G,GAAW,IAEJ,MAAxBd,EAAKC,OAAAA,CAAQv+G,MAAAA,IACfN,CAAAA,IAAAA,CAAKi/G,iBAAAA,CAAkBx2F,MAAAA,CAAOm2F,IAC9B5+G,IAAAA,CAAK00E,cAAAA,CAAe7lD,MAAAA,CAAOvsB,EAAAA;gBAE/B;YACF;YAEA,MAAM+e,CAAAA,EAAAA;gBACJ,MAAMyhF,IAAQ9iG,IAAAA,CAAKq/G,WAAAA,CAAYh+F;gBAC/BrhB,IAAAA,CAAKm/G,aAAAA,CAAcn0F,GAAAA,CAAI3J,GAAQyhF;gBAC/B,IAAK,IAAIx2F,IAAIw2F,EAAM0b,KAAAA,EAAOlyG,KAAKw2F,EAAM2b,MAAAA,EAAQnyG,IAC3C,IAAK,IAAIlC,IAAI04F,EAAM6b,IAAAA,EAAMv0G,KAAK04F,EAAM4b,OAAAA,EAASt0G,IAC3CpK,IAAAA,CAAK0tE,OAAAA,CAAQphE,GAAGlC,GAAG04F;YAGzB;YAEA,QAAQzhF,CAAAA,EAAAA;gBACN,MAAMyhF,IAAQ9iG,IAAAA,CAAKm/G,aAAAA,CAAcx8G,GAAAA,CAAI0e;gBACjCyhF,KACFA,CAAAA,EAAMt7F,KAAAA,IACNxH,IAAAA,CAAKm/G,aAAAA,CAActwF,MAAAA,CAAOxN,EAAAA;YAE9B;YAEA,OAAOmwD,CAAAA,EAAAA;gBACL,IAAI0B,IAAU;gBAId,KAAK,MAAM7xD,KAAUmwD,EAAS;oBAC5B,MAAMsxB,IAAQ9iG,IAAAA,CAAKm/G,aAAAA,CAAcx8G,GAAAA,CAAI0e;oBACrC,IAAKyhF,KAGDA,EAAMmK,UAAAA,IAAc;wBAEtB,IAAK,IAAI3gG,IAAIw2F,EAAM0b,KAAAA,EAAOlyG,KAAKw2F,EAAM2b,MAAAA,EAAQnyG,IAC3C,IAAK,IAAIlC,IAAI04F,EAAM6b,IAAAA,EAAMv0G,KAAK04F,EAAM4b,OAAAA,EAASt0G,IAC3CpK,IAAAA,CAAKkpD,OAAAA,CAAQ58C,GAAGlC,GAAG04F;wBAGvBA,EAAMr1D,MAAAA;wBAEN,IAAK,IAAInhC,IAAIw2F,EAAM0b,KAAAA,EAAOlyG,KAAKw2F,EAAM2b,MAAAA,EAAQnyG,IAC3C,IAAK,IAAIlC,IAAI04F,EAAM6b,IAAAA,EAAMv0G,KAAK04F,EAAM4b,OAAAA,EAASt0G,IAC3CpK,IAAAA,CAAK0tE,OAAAA,CAAQphE,GAAGlC,GAAG04F;wBAGvB5vB;oBACF;gBACF;gBACA,OAAOA;YACT;YAEA,MAAMpzD,CAAAA,EAA8Bg3B,CAAAA,EAAAA;gBAClC,MAAM6oE,IAAcvtG,EAAM8D,WAAAA,EACpBvC,IAAQvB,EAAM0C,KAAAA;gBACpB,KAAK,MAAM8pG,KAAQ5+G,IAAAA,CAAK00E,cAAAA,CAAextB,MAAAA,GACrCpnC,EAAGkrB,aAAAA,CAAct8B,EAAIkwG,EAAKtyG,CAAAA,GAAItM,IAAAA,CAAKq+G,QAAAA,EAAUO,EAAKx0G,CAAAA,GAAIpK,IAAAA,CAAKq+G,QAAAA,GAAWr+G,IAAAA,CAAKq+G,QAAAA,EAAUr+G,IAAAA,CAAKq+G,QAAAA,EAAUsB,GAAahsG,GAAO;YAE5H;QAAA;QCxQK,MAAMisG,WAAsB1P;YAejC,YAAmB4E,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GAZH,IAAA,CAAAhB,UAAAA,GAAa7D,GAAWwE,MAAAA,EAKhC,IAAA,CAAAoL,iBAAAA,GAAoB,IAAIprC,GAAkC;oBAAE3kE,MAAM;gBAAA,IAClE,IAAA,CAAAkwC,SAAAA,GAAiC,EAAA,EACjC,IAAA,CAAA8/D,gBAAAA,GAAmB,IAAIxxF,KACvB,IAAA,CAAAi4E,uBAAAA,GAA0B,IAAIhE,IA2D/B,IAAA,CAAAwd,wBAAAA,GAAAA,CAA2B,GAI3B,IAAA,CAAAC,yBAAAA,GAAAA,CAA4B,GAS3B,IAAA,CAAAjG,iBAAAA,GAA0C,EAAA,EAC1C,IAAA,CAAAkG,eAAAA,GAA4B,EAAA,EAE5B,IAAA,CAAAhG,YAAAA,GAAAA,CAAe,GACf,IAAA,CAAAC,aAAAA,GAAgB;oBACtBl6G,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe;gBAAI,GAvExBj6G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoBo6C;iBAAAA,GAEnD/sF,IAAAA,CAAKwvE,KAAAA,CAAMwiC,YAAAA,CAAa7/D,SAAAA,CAAW7yB,CAAAA;oBACjC,MAAM2G,IAAK3G,EAAE3c,GAAAA,CAAIgwC,KACXosD,IAAUz/E,EAAE3c,GAAAA,CAAIoqF;oBACtB/sF,IAAAA,CAAKumG,uBAAAA,CAAwB1D,SAAAA,CAC3BvjF,GACCzE,CAAAA;wBAEC,IAAIkkF,KAAWA,EAAQ7yE,WAAAA,EAErB,OADsB6yE,EAAQ7yE,WAAAA,CAAYnP,SAAAA,CAAUkJ,EAAGtjB,GAAAA,GAAMqa,MAAAA,EACxC+B,QAAAA,CAASkH,EAAGytB,UAAAA,KAAe5E,GAAWqE,KAAAA,GAAQt4B,EAAI46D,QAAAA,GAAW56D,EAAIqlG,SAAAA;wBAExF,OAAA,CAAO;oBAAK,GAEd,IAAM5gG,EAAE2mC,QAAAA,GAEVjmD,IAAAA,CAAK8/G,gBAAAA,CAAiB90F,GAAAA,CAAI1L,GAAGy/E;oBAC7B,MAAMohB,IAAW7gG,EAAE3c,GAAAA,CAAI48C;oBACnB4gE,KACFngH,CAAAA,IAAAA,CAAKggD,SAAAA,CAAUrgD,IAAAA,CAAKwgH,IACpBngH,IAAAA,CAAK6/G,iBAAAA,CAAkB3+C,KAAAA,CAAMi/C,EAAAA,GAE/BngH,IAAAA,CAAK+5G,iBAAAA,CAAkBp6G,IAAAA,CAAKsmB,IAC5BjmB,IAAAA,CAAKigH,eAAAA,CAAgBtgH,IAAAA,CAAKsmB,EAAG2rB,KAAAA,GAC7B3rB,EAAGgtB,cAAAA,CAAed,SAAAA,CAAUnyC,IAAAA,CAAKk6G,aAAAA,GACjCl6G,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe;gBAAI,IAG1Bj6G,IAAAA,CAAKwvE,KAAAA,CAAMyiC,cAAAA,CAAe9/D,SAAAA,CAAW7yB,CAAAA;oBACnCtf,IAAAA,CAAKumG,uBAAAA,CAAwBvD,YAAAA,CAAa1jF;oBAC1C,MAAM2G,IAAK3G,EAAE3c,GAAAA,CAAIgwC;oBACjB3yC,IAAAA,CAAK8/G,gBAAAA,CAAiBjxF,MAAAA,CAAOvP;oBAC7B,MAAM6gG,IAAW7gG,EAAE3c,GAAAA,CAAI48C;oBACvB,IAAI4gE,GAAU;wBACZ,MAAM30G,IAAQxL,IAAAA,CAAKggD,SAAAA,CAAUv3C,OAAAA,CAAQ03G;wBACjC30G,IAAAA,MACFxL,IAAAA,CAAKggD,SAAAA,CAAUt3C,MAAAA,CAAO8C,GAAO,IAE/BxL,IAAAA,CAAK6/G,iBAAAA,CAAkBxuC,OAAAA,CAAQ8uC;oBACjC;oBACAl6F,EAAGgtB,cAAAA,CAAeX,WAAAA,CAAYtyC,IAAAA,CAAKk6G,aAAAA;oBACnC,MAAM1uG,IAAQxL,IAAAA,CAAK+5G,iBAAAA,CAAkBtxG,OAAAA,CAAQwd;oBACzCza,IAAAA,MACFxL,CAAAA,IAAAA,CAAK+5G,iBAAAA,CAAkBrxG,MAAAA,CAAO8C,GAAO,IACrCxL,IAAAA,CAAKigH,eAAAA,CAAgBv3G,MAAAA,CAAO8C,GAAO,EAAA;gBACrC;YAEJ;YAaO,WAAWspG,CAAAA,EAAc9uD,CAAAA,EAAAA;gBAC9BhmD,IAAAA,CAAK2iE,OAAAA,GAAU3c,EAAM/rC,MAAAA,EACrBja,IAAAA,CAAKogH,MAAAA,GAASp6D;YAChB;YAUO,YAAAouD;gBACDp0G,IAAAA,CAAKogH,MAAAA,CAAOxpD,MAAAA,CAAOq2C,UAAAA,MAErBjtG,IAAAA,CAAKogH,MAAAA,CAAOxpD,MAAAA,CAAO03C,eAAAA,CAAgBtuG,IAAAA,CAAKogH,MAAAA,CAAOxpD,MAAAA,CAAO/7C,GAAAA,GAIxD7a,IAAAA,CAAKqgH,UAAAA,GAAa;oBAACrgH,IAAAA,CAAK2iE,OAAAA,CAAQ+E,KAAAA,CAAM87B,QAAAA;oBAAUxjG,IAAAA,CAAKogH,MAAAA,CAAO14C,KAAAA,CAAM87B,QAAAA;iBAAAA,EAClExjG,IAAAA,CAAKsgH,eAAAA,GAAkBtgH,IAAAA,CAAK2iE,OAAAA,CAAQ+E,KAAAA,CAAM87B,QAAAA,EACtCxjG,IAAAA,CAAKi6G,YAAAA,IACPj6G,CAAAA,IAAAA,CAAK+5G,iBAAAA,CAAkBpoD,IAAAA,CAAK,CAACvvD,GAAGkQ,IACvBA,EAAEuW,CAAAA,GAAIzmB,EAAEymB,CAAAA,GAEjB7oB,IAAAA,CAAKigH,eAAAA,GAAkBjgH,IAAAA,CAAK+5G,iBAAAA,CAAkB95G,GAAAA,CAAKuW,CAAAA,IAAMA,EAAEo7B,KAAAA,GAC3D5xC,IAAAA,CAAKi6G,YAAAA,GAAAA,CAAe,CAAA;YAExB;YAEO,SAAAxsE;gBAELztC,IAAAA,CAAK6/G,iBAAAA,CAAkBpyE,MAAAA,CAAOztC,IAAAA,CAAKggD,SAAAA;gBAGnC,KAAK,MAAA,CAAOkjD,GAAWroF,EAAAA,IAAQ7a,IAAAA,CAAKsgH,eAAAA,CAAgB5b,yBAAAA,CAA0Bx2D,OAAAA,GAAW;oBACvF,MAAMkjC,IAAYpxE,IAAAA,CAAKogH,MAAAA,CAAOxuC,OAAAA,CAAQpC,KAAAA,CAAM30D,EAAI46D,QAAAA;oBAChD,IAAK,IAAIj1E,IAAI,GAAGA,IAAI4wE,EAAU9wE,MAAAA,EAAQE,IAAK;wBACzC,MAAMssE,IAAWsE,CAAAA,CAAU5wE,EAAAA,EACrB+/G,IAAevgH,IAAAA,CAAK8/G,gBAAAA,CAAiBn9G,GAAAA,CAAImqE,EAASl7B,KAAAA;wBACpD2uE,KAAiBA,CAAAA,EAAavzB,gBAAAA,IAAoBhtF,IAAAA,CAAK+/G,wBAAAA,AAAAA,KACzD//G,IAAAA,CAAKumG,uBAAAA,CAAwBlD,kBAAAA,CAAmBv2B,EAASl7B,KAAAA,EAAOsxD;oBAEpE;oBAEA,MAAMpjD,IAAW9/C,IAAAA,CAAK6/G,iBAAAA,CAAkBrwC,KAAAA,CAAM30D,EAAI46D,QAAAA;oBAClD,IAAK,IAAIj1E,IAAI,GAAGA,IAAIs/C,EAASx/C,MAAAA,EAAQE,IAAK;wBACxC,MAAM40C,IAAU0K,CAAAA,CAASt/C,EAAAA,EACnB+/G,IAAevgH,IAAAA,CAAK8/G,gBAAAA,CAAiBn9G,GAAAA,CAAIyyC,EAAQxD,KAAAA;wBACnD2uE,KAAiBA,CAAAA,EAAatzB,iBAAAA,IAAqBjtF,IAAAA,CAAKggH,yBAAAA,AAAAA,KAC1DhgH,IAAAA,CAAKumG,uBAAAA,CAAwBlD,kBAAAA,CAAmBjuD,EAAQxD,KAAAA,EAAOsxD;oBAEnE;gBACF;gBAEAljG,IAAAA,CAAKumG,uBAAAA,CAAwB/B,sBAAAA,CAAuBxkG,IAAAA,CAAKsgH,eAAAA,EAAiBtgH,IAAAA,CAAKigH,eAAAA,GAG/EjgH,IAAAA,CAAKumG,uBAAAA,CAAwB9C,cAAAA,CAAezjG,IAAAA,CAAKsgH,eAAAA,EAAiBtgH,IAAAA,CAAKigH,eAAAA,GAGvEjgH,IAAAA,CAAKqgH,UAAAA,CAAWliE,OAAAA,CAASl7C,CAAAA,IAAMA,EAAEwqC,MAAAA,KAGjCztC,IAAAA,CAAKumG,uBAAAA,CAAwB/+F,KAAAA,IAE7BxH,IAAAA,CAAKqgH,UAAAA,CAAWliE,OAAAA,CAASl7C,CAAAA,IAAMA,EAAEuE,KAAAA;YACnC;QAAA;QAjJO,GAAAu8B,QAAAA,GAAW4rE,GAAeE,MAAAA;QCd5B,MAAM2Q,WAAsBtQ;YAOjC,YAAmB4E,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GAJnB,IAAA,CAAAhB,UAAAA,GAAa7D,GAAWwE,MAAAA,EAChB,IAAA,CAAAzmB,QAAAA,GAA+B,EAAA,EAKrChuF,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC+mB;iBAAAA,GAE/Bv2F,IAAAA,CAAKwvE,KAAAA,CAAMwiC,YAAAA,CAAa7/D,SAAAA,CAAW7yB,CAAAA,IAAMtf,IAAAA,CAAKguF,QAAAA,CAASruF,IAAAA,CAAK2f,EAAE3c,GAAAA,CAAI4zF,OAClEv2F,IAAAA,CAAKwvE,KAAAA,CAAMyiC,cAAAA,CAAe9/D,SAAAA,CAAW7yB,CAAAA;oBACnC,MAAM+kC,IAAS/kC,EAAE3c,GAAAA,CAAI4zF,KACf/qF,IAAQxL,IAAAA,CAAKguF,QAAAA,CAASvlF,OAAAA,CAAQ47C;oBAChC74C,IAAAA,MACFxL,IAAAA,CAAKguF,QAAAA,CAAStlF,MAAAA,CAAO8C,GAAO;gBAC9B;YAEJ;YACA,OAAOsrC,CAAAA,EAAAA;gBACL,IAAK,IAAIt2C,IAAI,GAAGA,IAAIR,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA,EAAQE,IACzBR,IAAAA,CAAKguF,QAAAA,CAASxtF,EAAAA,CACtBitC,MAAAA,CAAOqJ;YAElB;QAAA;QAxBO,GAAA/S,QAAAA,GAAW4rE,GAAeE,MAAAA;QCK5B,MAAM4Q,WAAiC9uE;YAe5C,YAAY+uE,CAAAA,CAAAA;gBACV9zF,KAAAA,IAZK,IAAA,CAAA+zF,SAAAA,GAAoB,GAazB3gH,IAAAA,CAAK+1B,OAAAA,GAAU2qF,EAAa3qF,OAAAA,EAC5B/1B,IAAAA,CAAK81B,IAAAA,GAAO4qF,EAAa5qF,IAAAA,EACzB91B,IAAAA,CAAKylG,SAAAA,GAAYib,EAAajb,SAAAA,EAC9BzlG,IAAAA,CAAK0lG,UAAAA,GAAagb,EAAahb,UACjC;YAAA;QAAA;QC1BK,MAAMkb,WAA8B1Q;YAKzC,YAAmB4E,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GAFH,IAAA,CAAAhB,UAAAA,GAAa7D,GAAWwE,MAAAA,EAItCz0G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoB8tE;iBAAAA;YACrD;YAEA,SAAAhzE;gBACE,IAAI1wB,GACA8jG;gBACJ,IAAK,IAAIrgH,IAAI,GAAGA,IAAIR,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS/vG,MAAAA,EAAQE,IAAK;oBACnD,MAAM0jD,IAASlkD,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS7vG,EAAAA;oBACnCuc,IAAYmnC,EAAOvhD,GAAAA,CAAIgwC,KACvBkuE,IAAM38D,EAAOvhD,GAAAA,CAAI89G;oBAEjB,MAEMjhB,IAFwBl6F,KAAKC,GAAAA,CAAIs7G,EAAI9qF,OAAAA,GAAU8qF,EAAIpb,SAAAA,EAAWob,EAAI/qF,IAAAA,GAAO+qF,EAAInb,UAAAA,IAE9Cmb,EAAIF,SAAAA,GAAY5jG,EAAUlC,GAAAA,CAAIzQ,CAAAA;oBACnE2S,EAAU8L,CAAAA,GAAI22E;gBAChB;YACF;QAAA;QAtBO,GAAAz7D,QAAAA,GAAmB4rE,GAAeI,KAAAA;QCOpC,MAAM+Q,WAAwB5Q;YASnC,YAAmB4E,CAAAA,CAAAA;gBACjBloF,KAAAA,IADiB,IAAA,CAAAkoF,KAAAA,GAAAA,GANZ,IAAA,CAAAhB,UAAAA,GAAa7D,GAAW+J,IAAAA,EAQ7Bh6G,IAAAA,CAAKwvE,KAAAA,GAAQxvE,IAAAA,CAAK80G,KAAAA,CAAMtlC,KAAAA,CAAM;oBAAC78B;oBAAoB4M;iBAAAA;YACrD;YAEO,WAAWu1D,CAAAA,EAAc9uD,CAAAA,EAAAA;gBAC9BhmD,IAAAA,CAAK62D,OAAAA,GAAU7Q,EAAM4Q,MAAAA,EACrB52D,IAAAA,CAAKkuG,OAAAA,GAAUloD,EAAM/rC,MAAAA,CAAOjG,MAC9B;YAAA;YAEA,SAAAy5B;gBAEE,IAAI1wB,GACA+iC,GACA4nD;gBAHJ1nG,IAAAA,CAAK+gH,YAAAA,GAAe/gH,IAAAA,CAAKkuG,OAAAA,CAAQh1C,cAAAA;gBAKjC,IAAK,IAAI14D,IAAI,GAAGA,IAAIR,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS/vG,MAAAA,EAAQE,IAAK;oBACnD,MAAM0jD,IAASlkD,IAAAA,CAAKwvE,KAAAA,CAAM6gC,QAAAA,CAAS7vG,EAAAA;oBAKnC,IAAIonG;oBACJ,IALA9nD,IAAWoE,EAAOvhD,GAAAA,CAAI48C,KACtBxiC,IAAYmnC,EAAOvhD,GAAAA,CAAIgwC,KACvB+0D,IAAgBxjD,EAAOvhD,GAAAA,CAAIm/F,KAGvB4F,GAAe;wBAIjB,MAAMC,IAAiB75F,EAAOE,GAAAA,CAAIuC,GAAAA,CAAIm3F,EAAc3F,cAAAA;wBACpD6F,IAAiB5nG,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,CAAI5K,KAAAA,CAAM03F;oBAC1C;oBAGA,MAAMqZ,IAAkBhhH,IAAAA,CAAKihH,YAAAA,CAAalkG,GAAW+iC,GAAU8nD;oBAC3DoZ,KAAAA,CAAoB98D,EAAO0C,MAAAA,CAAO,mBACpC1C,CAAAA,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,gBAAgB,IAAI47C,GAAkBG,KACzDA,EAAO4C,MAAAA,CAAO,eAAA,GAAA,CAGXk6D,KAAmB98D,EAAO0C,MAAAA,CAAO,mBACpC1C,CAAAA,EAAOhqC,MAAAA,CAAO/R,IAAAA,CAAK,iBAAiB,IAAI67C,GAAmBE,KAC3DA,EAAO6C,SAAAA,CAAU,eAAA;gBAErB;YACF;YAEQ,aAAahqC,CAAAA,EAA+B+iC,CAAAA,EAA6B8nD,CAAAA,EAAAA;gBAC/E,IAAI9nD,EAASG,aAAAA,EACX,OAAA,CAAO;gBAET,IAAIljC,EAAU22B,UAAAA,KAAe5E,GAAWqE,KAAAA,EAAO;oBAC7C,IAAIne,IAAS8qB,EAAS5zB,WAAAA;oBAClB07E,KACF5yE,CAAAA,IAASA,EAAOrY,SAAAA,CAAUirF,EAAAA;oBAE5B,MAAMsZ,IAAoBlsF,EAAOjY,SAAAA,CAAUA,EAAUpa,GAAAA,GAAMqa,MAAAA;oBAE3D,OAAA,CAD2Bhd,IAAAA,CAAK+gH,YAAAA,CAAa3hG,QAAAA,CAAS8hG;gBAExD;gBAEE,OAAA,CAAO;YAEX;QAAA;QArEO,GAAAn9E,QAAAA,GAAmB4rE,GAAeE,MAAAA;QCSpC,MAAMsR,WAA0B/C;YA8BrC,YACStxC,CAAAA,EACPuxC,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBAEAzxF,KAAAA,CAAMkgD,GAAUuxC,IAHT,IAAA,CAAAvxC,QAAAA,GAAAA,GA9BT,IAAA,CAAAltE,EAAAA,GAAAA,IAIA,IAAA,CAAA2+G,aAAAA,GAAAA,CAAgB,GAoBhB,IAAA,CAAAD,KAAAA,GAAqD,EAAA,EAUnDt+G,IAAAA,CAAKq+G,QAAAA,GAAWA;gBAChB,MAAMrpF,IAAS83C,EAAS93C,MAAAA;gBACxBh1B,IAAAA,CAAKu+G,aAAAA,GAAgBvpF,EAAO3Y,iBAAAA,IAC5Brc,IAAAA,CAAKw+G,KAAAA,GAAQl5G,KAAKoF,KAAAA,CAAMsqB,EAAOxa,IAAAA,GAAOxa,IAAAA,CAAKq+G,QAAAA,GAC3Cr+G,IAAAA,CAAKy+G,MAAAA,GAASn5G,KAAKoF,KAAAA,CAAMsqB,EAAOxZ,KAAAA,GAAQxb,IAAAA,CAAKq+G,QAAAA,GAC7Cr+G,IAAAA,CAAK0+G,OAAAA,GAAUp5G,KAAKoF,KAAAA,CAAMsqB,EAAOvZ,MAAAA,GAASzb,IAAAA,CAAKq+G,QAAAA,GAC/Cr+G,IAAAA,CAAK2+G,IAAAA,GAAOr5G,KAAKoF,KAAAA,CAAMsqB,EAAOva,GAAAA,GAAMza,IAAAA,CAAKq+G,QAAAA,GACzCr+G,IAAAA,CAAK4xC,KAAAA,GAAQk7B,EAASl7B,KAAAA,EACtB5xC,IAAAA,CAAK8Z,IAAAA,GAAiB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC5BxsE,IAAAA,CAAK0sE,aAAAA,GAAuC,SAAvB,CAAA,IAAA1sE,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAIjC,GAAckC,gBAChE;YAAA;YAKA,SAAAl/B;gBAAAA,IAAAA,GAAAA;gBACE7gB,KAAAA,CAAM6gB,UACNztC,IAAAA,CAAK8Z,IAAAA,GAAiB,SAAV,CAAA,IAAA9Z,IAAAA,CAAK4xC,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEjvC,GAAAA,CAAI6pE,KAC5BxsE,IAAAA,CAAK0sE,aAAAA,GAAuC,SAAvB,CAAA,IAAA1sE,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAIjC,GAAckC,gBAAAA,EAC9D3sE,IAAAA,CAAKu+G,aAAAA,GAAgBv+G,IAAAA,CAAK8sE,QAAAA,CAAS5gD,WAAAA,CAAY7P,iBAAAA;YACjD;QAAA;QAOK,MAAM+kG;YAiBX,YAAYnoG,CAAAA,CAAAA;gBAbJ,IAAA,CAAAo3D,MAAAA,GAAS,IAAIp5D,KACb,IAAA,CAAAoqG,SAAAA,GAAY,IAAIpqG,KAEjB,IAAA,CAAAqqG,SAAAA,GAAY,IAAIz1E,GACrB,IAAM,IAAIsgC,GAAK;wBAAEvsE,IAAI4G,EAAS,YAAY;oBAAA,GAAkB;wBAAE5G,IAAI4G,EAAS,YAAY;oBAAA,IACtF04G,CAAAA,IACCA,CAAAA,EAAS9yC,SAAAA,GAAY,MACrB8yC,EAAS7yC,SAAAA,GAAY,MACd6yC,CAAAA,GAET,MAIAl/G,IAAAA,CAAKq+G,QAAAA,GAAWplG,EAAQnJ,IAAAA,EACxB9P,IAAAA,CAAKuhH,QAAAA,GAAW,IAAI9sC,GAA4C;oBAC9D3kE,MAAM9P,IAAAA,CAAKq+G,QAAAA;oBACXe,cAAc,CAACtyC,GAAUh9D,IAAS,IAAIqxG,GAAkBr0C,GAAUh9D;gBAAAA,IAEpE9P,IAAAA,CAAKshH,SAAAA,CAAUp1E,eAAAA,GAAAA,CAAkB;YAInC;YAEA,eAAAwkC;gBACE,OAAO3mE,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAKuhH,QAAAA,CAASpC,aAAAA,CAAc54G,IAAAA;YAChD;YAIA,MAAM+4G,CAAAA,EAAAA;gBAEJ,OAAOt/G,IAAAA,CAAKuhH,QAAAA,CAAS/xC,KAAAA,CAAM8vC;YAC7B;YAEA,QAAQrhG,CAAAA,EAAUhF,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBAEhB,MAAM4a,IAAwB,EAAA,EACxB+8C,IAAkC,SAApB,CAAA,IAAA33D,QAAAA,IAAAA,KAAO,IAAPA,EAAS23D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIhiE,IAAAA,GACtCiiE,IAAiB53D,QAAAA,IAAAA,KAAO,IAAPA,EAAS43D,cAAAA,EAC1BC,IAAiBD,IAAyEA,EAAetF,QAAAA,GAAjD,SAAtB,CAAA,IAAAtyD,QAAAA,IAAAA,KAAO,IAAPA,EAAS63D,aAAAA,AAAAA,KAAAA,KAAa,MAAA,IAAA,IAAI3F,GAAee,GAAAA,CAAIX,QAAAA,EAC/EwF,IAAgD,SAA3B,CAAA,IAAA93D,QAAAA,IAAAA,KAAO,IAAPA,EAAS83D,kBAAAA,AAAAA,KAAAA,KAAkB,MAAA,KAAA,GAEhDywC,IAAUvjG,EAAIK,GAAAA,CAAItO,SAAAA,IAElByxG,IAAOD,EAAQp3G,CAAAA,GAAIo3G,EAAQl1G,CAAAA,EAC3Bo1G,IAAOF,EAAQl1G,CAAAA,GAAIk1G,EAAQp3G,CAAAA,EAE3Bu3G,IAAYr8G,KAAK0J,IAAAA,CAAK,IAAIyyG,IAAOA,KAAQzhH,IAAAA,CAAKq+G,QAAAA,EAC9CuD,IAAYt8G,KAAK0J,IAAAA,CAAK,IAAI0yG,IAAOA,KAAQ1hH,IAAAA,CAAKq+G,QAAAA,EAE9CwD,IAAc5jG,EAAIpD,GAAAA,CAAIvO,CAAAA,GAAItM,IAAAA,CAAKq+G,QAAAA,EAC/ByD,IAAc7jG,EAAIpD,GAAAA,CAAIzQ,CAAAA,GAAIpK,IAAAA,CAAKq+G,QAAAA,EAE/B0D,IAAUrzG,EAAI,GAAG;gBAEvB,IAAIszG,IAAAA,CAAAA,CAAkBH,GAClBI,IAAAA,CAAAA,CAAkBH,GAClBI,IAAoB,GACpBC,IAAoB;gBAEpBX,EAAQl1G,CAAAA,GAAI,IACdy1G,CAAAA,EAAQz1G,CAAAA,GAAAA,IACR41G,IAAAA,AAAqBL,CAAAA,IAAcG,CAAAA,IAAiBL,CAAAA,IAEpDI,CAAAA,EAAQz1G,CAAAA,GAAI,GACZ41G,IAAAA,AAAqBF,CAAAA,IAAgB,IAAIH,CAAAA,IAAeF,CAAAA,GAGtDH,EAAQp3G,CAAAA,GAAI,IACd23G,CAAAA,EAAQ33G,CAAAA,GAAAA,IACR+3G,IAAAA,AAAqBL,CAAAA,IAAcG,CAAAA,IAAiBL,CAAAA,IAEpDG,CAAAA,EAAQ33G,CAAAA,GAAI,GACZ+3G,IAAAA,AAAqBF,CAAAA,IAAgB,IAAIH,CAAAA,IAAeF,CAAAA;gBAG1D,MAAMQ,IAAmB,IAAInrG;gBAE7B,IAAIo1B,IAAAA,CAAO,GACPg2E,IAAgB;gBACpB,MAAA,CAAQh2E,KAAQg2E,IAAgB,KAC9BA,CAAAA,KAEKriH,IAAAA,CAAKuhH,QAAAA,CAASvsF,MAAAA,CAAOjW,QAAAA,CAASrQ,EAAIszG,IAAgBhiH,IAAAA,CAAKq+G,QAAAA,EAAU4D,IAAgBjiH,IAAAA,CAAKq+G,QAAAA,EAAAA,GAH1D;oBAOjC,MAAM/7G,IAAMy8G,GAAaC,gBAAAA,CAAiBgD,GAAeC,IACnDrD,IAAO5+G,IAAAA,CAAKuhH,QAAAA,CAAS7sC,cAAAA,CAAe/xE,GAAAA,CAAIL;oBAC9C,IAAIs8G,GAAM;wBACR,MAAM0D,IAAyB,EAAA;wBAC/B,IAAK,IAAIC,IAAgB,GAAGA,IAAgB3D,EAAKC,OAAAA,CAAQv+G,MAAAA,EAAQiiH,IAAiB;4BAChF,MAAMz1C,IAAW8xC,EAAKC,OAAAA,CAAQ0D,EAAAA;4BAC9B,IAAA,CAAKH,EAAiBrqG,GAAAA,CAAI+0D,EAASA,QAAAA,CAASltE,EAAAA,CAAGwD,KAAAA,GAAQ;gCAGrD,IAFAg/G,EAAiBhyG,GAAAA,CAAI08D,EAASA,QAAAA,CAASltE,EAAAA,CAAGwD,KAAAA,GAAAA,AAEtC6V,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASg4D,uBAAAA,AAAAA,KAA2BnE,EAAShzD,IAAAA,CAAKoxD,KAAAA,KAAUC,GAAee,GAAAA,EAC7E;gCAGF,MAAMR,IAAAA,CAAAA,CAAcoF,CAAAA,IAAgBhE,EAAShzD,IAAAA,CAAKoxD,KAAAA,CAAMK,QAAAA,AAAAA;gCAGxD,IAAIuB,EAAShzD,IAAAA,CAAKoxD,KAAAA,IAAAA,CAAUQ,GAC1B;gCAGF,MAAMwF,IAAMpE,EAASA,QAAAA,CAAS9uD,OAAAA,CAAQC,GAAK2yD;gCAIvCM,KACFoxC,EAAS3iH,IAAAA,CAAKuxE;4BAElB;wBACF;wBACAoxC,EAAS3wD,IAAAA,CAAK,CAAC6wD,GAAMC,IAASD,EAAK3zG,QAAAA,GAAW4zG,EAAK5zG,QAAAA;wBACnD,IAAK,IAAIrO,IAAI,GAAGA,IAAI8hH,EAAShiH,MAAAA,EAAQE,IAAK;4BACxC,MAAM0wE,IAAMoxC,CAAAA,CAAS9hH,EAAAA;4BACrB,IAAIyY,QAAAA,IAAAA,KAAO,IAAPA,EAASjR,MAAAA,EACX;gCAAA,IAAIiR,EAAQjR,MAAAA,CAAOkpE,MACjBr9C,CAAAA,EAAQl0B,IAAAA,CAAKuxE,IAAAA,CACRH,CAAAA,GAAoB;oCACvB1kC,IAAAA,CAAO;oCACP;gCACF;4BAAA,OAIF,IADAxY,EAAQl0B,IAAAA,CAAKuxE,IAAAA,CACRH,GAAoB;gCACvB1kC,IAAAA,CAAO;gCACP;4BACF;wBAEJ;oBACF;oBAEI61E,IAAoBC,IACtBH,CAAAA,KAAiBD,EAAQz1G,CAAAA,EACzB41G,KAAqBP,CAAAA,IAErBM,CAAAA,KAAiBF,EAAQ33G,CAAAA,EACzB+3G,KAAqBP,CAAAA;gBAEzB;gBAIA,OADA/tF,EAAQ89B,IAAAA,CAAK,CAAC6wD,GAAMC,IAASD,EAAK3zG,QAAAA,GAAW4zG,EAAK5zG,QAAAA,GAAAA,CAC7CkiE,KAAsBl9C,EAAQvzB,MAAAA,GAC1B;oBAACuzB,CAAAA,CAAQ,EAAA;iBAAA,GAEXA;YACT;YAMA,MAAMxS,CAAAA,EAAAA;gBACJ,IAAI+vD,IAAY;oBAAC/vD;iBAAAA;gBACjB,IAAIA,aAAkB8vD,IAAmB;oBACvC,MAAMuxC,IAAgBrhG,EAAOqvD,YAAAA;oBAC7B,KAAK,MAAMj8D,KAAKiuG,EACdjuG,EAAEm9B,KAAAA,GAAQvwB,EAAOuwB,KAAAA;oBAEnBw/B,IAAYsxC;gBACd;gBAEA,KAAK,MAAMrhG,KAAU+vD,EACnBpxE,IAAAA,CAAKuhH,QAAAA,CAASrgD,KAAAA,CAAM7/C;YAExB;YAMA,QAAQA,CAAAA,EAAAA;gBACN,IAAI+vD,IAAY;oBAAC/vD;iBAAAA;gBACbA,aAAkB8vD,MACpBC,CAAAA,IAAY/vD,EAAOqvD,YAAAA,EAAAA;gBAGrB,KAAK,MAAMrvD,KAAU+vD,EACnBpxE,IAAAA,CAAKuhH,QAAAA,CAASlwC,OAAAA,CAAQhwD;YAE1B;YAEQ,YAAY+qD,CAAAA,EAA8BC,CAAAA,EAAAA;gBAEhD,OAAID,EAAUU,QAAAA,CAASltE,EAAAA,KAAOysE,EAAUS,QAAAA,CAASltE,EAAAA,IAAAA,AAAAA,CAAAA,CAK7CwsE,EAAUx6B,KAAAA,IAAAA,CAASy6B,EAAUz6B,KAAAA,IAASw6B,EAAUx6B,KAAAA,CAAMhyC,EAAAA,KAAOysE,EAAUz6B,KAAAA,CAAMhyC,EAAAA,AAAAA,KAAAA,CAK7EwsE,EAAUmyC,aAAAA,IAAAA,CAAiBlyC,EAAUkyC,aAAAA,IAAAA,CAAAA,CAKpCnyC,EAAUtyD,IAAAA,CAAKoxD,KAAAA,CAAMQ,UAAAA,CAAWW,EAAUvyD,IAAAA,CAAKoxD,KAAAA,KAAAA,AAKhDkB,CAAAA,EAAUM,aAAAA,KAAkBjC,GAAc1V,KAAAA,IAASsX,EAAUK,aAAAA,KAAkBjC,GAAc1V,KAAAA,AAAAA,KAK7FqX,EAAUM,aAAAA,KAAkBjC,GAAckC,gBAAAA,IAAoBN,EAAUK,aAAAA,KAAkBjC,GAAckC,gBAAAA,IAAAA,CAAAA,CAAAA,CAKvGP,EAAUx6B,KAAAA,CAAMqU,QAAAA,IAAAA,CAAaomB,EAAUz6B,KAAAA,CAAMqU,QAAAA,AAAAA;YAKpD;YAOA,WAAWurB,CAAAA,EAAqB16B,CAAAA,EAAAA;gBAC9B,MAAM+6B,IAAgB,EAAA;gBACtB7xE,IAAAA,CAAKqwE,MAAAA,CAAO7oE,KAAAA,IACZxH,IAAAA,CAAKqhH,SAAAA,CAAU75G,KAAAA;gBAEf,IAAIo7G,IAAU;gBACd,KAAK,MAAM9f,KAAS9iG,IAAAA,CAAKuhH,QAAAA,CAASpC,aAAAA,CAAcj4D,MAAAA,GAE9C,IADA47C,EAAMljG,EAAAA,GAAKgjH,KACN9f,EAAMlxD,KAAAA,CAAMqU,QAAAA,IAAY68C,EAAMp2B,aAAAA,KAAkBjC,GAAckC,gBAAAA,EAInE,IAAK,IAAI+yC,IAAY,GAAGA,IAAY5c,EAAMwb,KAAAA,CAAMh+G,MAAAA,EAAQo/G,IAAa;oBACnE,MAAMd,IAAO9b,EAAMwb,KAAAA,CAAMoB,EAAAA;oBAGzB,IAAK,IAAImD,IAAa,GAAGA,IAAajE,EAAKC,OAAAA,CAAQv+G,MAAAA,EAAQuiH,IAAc;wBACvE,MAAM5jG,IAAQ2/F,EAAKC,OAAAA,CAAQgE,EAAAA;wBAC3B,IAAI5jG,EAAMrf,EAAAA,KAAOkjG,EAAMljG,EAAAA,EAErB;wBAEF,MAAMA,IAAKusE,GAAKG,iBAAAA,CAAkBw2B,EAAMh2B,QAAAA,CAASltE,EAAAA,EAAIqf,EAAM6tD,QAAAA,CAASltE,EAAAA;wBACpE,IAAA,CAAII,IAAAA,CAAKqhH,SAAAA,CAAUtpG,GAAAA,CAAInY;4BAGvB,IAAA,CAAKI,IAAAA,CAAKqwE,MAAAA,CAAOt4D,GAAAA,CAAInY,MAAOI,IAAAA,CAAK2iH,WAAAA,CAAY7f,GAAO7jF,MAAU6jF,EAAM/hF,MAAAA,CAAOiU,MAAAA,CAAO5V,QAAAA,CAASH,EAAM8B,MAAAA,CAAOiU,MAAAA,GAAS;gCAC/G,MAAM28C,IAAO3xE,IAAAA,CAAKshH,SAAAA,CAAU3+G,GAAAA;gCAC5BgvE,EAAKvF,SAAAA,GAAY02B,EAAMh2B,QAAAA,EACvB6E,EAAKtF,SAAAA,GAAYptD,EAAM6tD,QAAAA,EACvB6E,EAAK/xE,EAAAA,GAAKA,GACVI,IAAAA,CAAKqwE,MAAAA,CAAOjgE,GAAAA,CAAIxQ,IAChBiyE,EAAMlyE,IAAAA,CAAKgyE;4BACb,OACE3xE,IAAAA,CAAKqhH,SAAAA,CAAUjxG,GAAAA,CAAIxQ;;oBAEvB;gBACF;gBAEF,OAAOiyE;YACT;YAOA,YAAYA,CAAAA,EAAervB,CAAAA,EAAAA;gBACzB,MAAMuwB,IAA+B,EAAA;gBACrC,IAAK,IAAIvyE,IAAI,GAAGA,IAAIqxE,EAAMvxE,MAAAA,EAAQE,IAAK;oBACrC,MAAMwyE,IAAcnB,CAAAA,CAAMrxE,EAAAA,CAAGosE,OAAAA;oBAC7B,IAAK,IAAI8E,IAAI,GAAGA,IAAIsB,EAAY1yE,MAAAA,EAAQoxE,IAAK;wBAC3C,MAAMj9D,IAAIu+D,CAAAA,CAAYtB,EAAAA;wBACtBqB,EAASpzE,IAAAA,CAAK8U,IACV+tC,KACFA,EAAMovB,OAAAA,CAAQmB,QAAAA,CAAS/nD,GAAAA,CAAIvW,EAAE7U,EAAAA,EAAI6U;oBAErC;gBACF;gBAKA,OAJAzU,IAAAA,CAAKshH,SAAAA,CAAUj1E,IAAAA,IACXmW,KACFA,CAAAA,EAAMovB,OAAAA,CAAQqB,UAAAA,IAAcF,EAASzyE,MAAAA,AAAAA,GAEhCyyE;YACT;YAKA,OAAOvB,CAAAA,EAAqB16B,CAAAA,EAAAA;gBAC1B,OAAO92C,IAAAA,CAAKuhH,QAAAA,CAAS9zE,MAAAA,CAAO+jC;YAC9B;YAOA,MAAM1xD,CAAAA,EAA8Bg3B,CAAAA,EAAAA;gBAClC92C,IAAAA,CAAKuhH,QAAAA,CAASvpG,KAAAA,CAAM8H,GAAIg3B;YAC1B;QAAA;QCjYK,MAAMgsE;YAKX,IAAA,SAAI53B;oB9KoCsCzkF,GAASokB;gB8KnCjD,O9KmCwCpkB,I8KnCvBzG,IAAAA,CAAKutE,OAAAA,E9KmC2B1iD,I8KnCjBA,CAAAA;oBAC9B7qB,IAAAA,CAAKg1G,aAAAA,CAAcziE,SAAAA,CAAU1nB;gBAAO,G9KmCnCpkB,KAAAA,KAG2B3F,MAA3B2F,EAAaqkB,SAAAA,GAET,IAAIC,MAAMtkB,GAAMwkB,GAAiB,EAAA,EAAIJ,GAAQpkB,MAJ7CA;Y8KlCT;YACA,IAAA,OAAWs8G,CAAAA,EAAAA;gBACT/iH,IAAAA,CAAKutE,OAAAA,GAAUw1C,GACf/iH,IAAAA,CAAKg1G,aAAAA,CAAcziE,SAAAA,CAAUwwE;YAC/B;YAMA,IAAA,qBAAW5K;gBACT,IAAIn4G,IAAAA,CAAKo4G,YAAAA,EAAc;oBACrBp4G,IAAAA,CAAKo4G,YAAAA,GAAAA,CAAe;oBAEpB,MAAMhnC,IAAYpxE,IAAAA,CAAKo1E,mBAAAA,CAAoB1E,YAAAA;oBACvC1wE,IAAAA,CAAKutE,OAAAA,CAAQiH,gBAAAA,KAAqBd,GAAyBe,cAAAA,GAC7Dz0E,IAAAA,CAAKo1E,mBAAAA,GAAsB,IAAIgsC,GAAiCphH,IAAAA,CAAKutE,OAAAA,CAAQmH,cAAAA,IAE7E10E,IAAAA,CAAKo1E,mBAAAA,GAAsB,IAAIhF,GAA8BpwE,IAAAA,CAAKutE,OAAAA;oBAEpE,KAAK,MAAMT,KAAYsE,EACrBpxE,IAAAA,CAAKo1E,mBAAAA,CAAoBlU,KAAAA,CAAM4L;gBAEnC;gBACA,OAAO9sE,IAAAA,CAAKo1E,mBACd;YAAA;YACA,YAAY8V,CAAAA,CAAAA;gBAlCZ,IAAA,CAAA8pB,aAAAA,GAAgB,IAAIljE,IAEZ,IAAA,CAAAsmE,YAAAA,GAAAA,CAAe,GAiCrBp4G,IAAAA,CAAKkrF,MAAAA,GAASA,GACdlrF,IAAAA,CAAKg1G,aAAAA,CAAc7iE,SAAAA,CAAW+4C,CAAAA;oBAC5BlrF,IAAAA,CAAKo4G,YAAAA,GAAAA,CAAe,GACpB5rC,GAAc+e,0BAAAA,CAA2BL,EAAOhX,MAAAA;gBAAO,IAErDl0E,IAAAA,CAAKutE,OAAAA,CAAQiH,gBAAAA,KAAqBd,GAAyBe,cAAAA,GAC7Dz0E,IAAAA,CAAKo1E,mBAAAA,GAAsB,IAAIgsC,GAAiCphH,IAAAA,CAAKutE,OAAAA,CAAQmH,cAAAA,IAE7E10E,IAAAA,CAAKo1E,mBAAAA,GAAsB,IAAIhF,GAA8BpwE,IAAAA,CAAKutE,OAAAA;YAEtE;YAOO,QAAQtvD,CAAAA,EAAUhF,CAAAA,EAAAA;gBACvB,OAAOjZ,IAAAA,CAAKm4G,kBAAAA,CAAmBn6F,OAAAA,CAAQC,GAAKhF;YAC9C;YAQO,MAAM03D,CAAAA,EAAAA;gBAEX,OAAO3wE,IAAAA,CAAKo1E,mBAAAA,CAAoB5F,KAAAA,CAAMmB;YACxC;QAAA;QC/DK,MAAMqyC;YAAb,aAAA;gBACS,IAAA,CAAA9oG,MAAAA,GAAS,IAAIhT,GAIb,IAAA,CAAA0sE,OAAAA,GAAAA,CAAU,GAKV,IAAA,CAAA/lB,SAAAA,GAAAA,CAAAA,CAAoBwc,UAAWC,WAAAA,EAO9B,IAAA,CAAA24C,kBAAAA,GAAqB;oBAAC;oBAAG;oBAAG;oBAAG;iBAAA,EAC/B,IAAA,CAAAC,QAAAA,GAAsB,EAAA,EACtB,IAAA,CAAAC,KAAAA,GAAmB,EAAA,EACnB,IAAA,CAAAC,YAAAA,GAAAA,CAAwB,GACxB,IAAA,CAAAC,UAAAA,GAAqCh5C,WACrC,IAAA,CAAAi5C,qBAAAA,GAA8C,MAC9C,IAAA,CAAAC,QAAAA,GAAAA,CAAW;YAiPrB;YA/OS,OAAAjhB;gBACAtiG,IAAAA,CAAK6tD,SAAAA,IAGN7tD,CAAAA,IAAAA,CAAKojH,YAAAA,IAMTpjH,CAAAA,IAAAA,CAAKkjH,QAAAA,GAAWljH,IAAAA,CAAKwjH,UAAAA,CAAWxjH,IAAAA,CAAKqjH,UAAAA,CAAW/4C,WAAAA,KAC5CtqE,IAAAA,CAAKkjH,QAAAA,CAAS5iH,MAAAA,IAAUN,IAAAA,CAAKkjH,QAAAA,CAAS,EAAA,IACxCljH,CAAAA,IAAAA,CAAKojH,YAAAA,GAAAA,CAAe,CAAA,CAAA,CAAA;YAExB;YAEO,cAAcxvC,CAAAA,EAAAA;gBACnB5zE,IAAAA,CAAKujH,QAAAA,GAAW3vC;YAClB;YAQO,+BAA+BsX,CAAAA,EAAAA;gBACpClrF,IAAAA,CAAK2jH,gBAAAA,IACL3jH,IAAAA,CAAKsjH,qBAAAA,GAAwBp4B;YAC/B;YAKQ,mBAAAy4B;gBACD3jH,IAAAA,CAAK4zE,OAAAA,IACR5zE,CAAAA,IAAAA,CAAK4zE,OAAAA,GAAAA,CAAU,GACf5zE,IAAAA,CAAKytC,MAAAA,EAAAA;YAET;YAKQ,gBAAgBo2E,CAAAA,EAAAA;gBACtB,IAAA,CAAK7jH,IAAAA,CAAKsjH,qBAAAA,EACR,OAAA,CAAO;gBAET,IAAA,CAAKO,GACH,OAAA,CAAO;gBAET,MAAMC,IAAaD,EAAInuC,IAAAA,CAAK1tE,MAAAA,CAAQ5E,CAAAA,IAAAA,MAEjC9C,MAAAA,EAEGyjH,IAAeF,EAAIG,OAAAA,CAAQh8G,MAAAA,CAAQ5E,CAAAA,IAAAA,MAEtC9C,MAAAA;gBACH,OAAOwjH,KAAc9jH,IAAAA,CAAKsjH,qBAAAA,CAAsBvgE,IAAAA,IAAQghE,KAAgB/jH,IAAAA,CAAKsjH,qBAAAA,CAAsBU,OAAAA,IAAWH,EAAII,SACpH;YAAA;YAIO,KAA0Dv8G,CAAAA,EAAuBU,CAAAA,EAAAA;gBACtFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAwDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBAEpF,OADA3H,IAAAA,CAAK2jH,gBAAAA,IACE3jH,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAA0DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAEtF,OADA3H,IAAAA,CAAK2jH,gBAAAA,IACE3jH,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF3H,IAAAA,CAAK2jH,gBAAAA,IACL3jH,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAKO,SAAA8lC;gBAAAA,IAAAA,GAAAA;gBACL,IAAA,CAAKztC,IAAAA,CAAK4zE,OAAAA,IAAAA,CAAY5zE,IAAAA,CAAK6tD,SAAAA,EACzB;gBAEF,IAAA,CAAK7tD,IAAAA,CAAKujH,QAAAA,EACR;gBAEFvjH,IAAAA,CAAKsiG,IAAAA;gBAEL,MAAM36B,IAAW3nE,IAAAA,CAAKqjH,UAAAA,CAAW/4C,WAAAA;gBACjC,IAAK,IAAI9pE,IAAI,GAAGA,IAAImnE,EAASrnE,MAAAA,EAAQE,IAAK;oBACxC,IAAA,CAAKmnE,CAAAA,CAASnnE,EAAAA,EAAI;wBAChB,MAAMkiD,IAAU1iD,IAAAA,CAAKkkH,EAAAA,CAAG1jH;wBAEpBkiD,EAAQuhE,SAAAA,IACVjkH,CAAAA,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIw6C,GAAuBniD,GAAGkiD,KAC7DA,EAAQxoC,MAAAA,CAAOvR,MAAAA,CAAO3I,IAAAA,CAAKka,MAAAA,CAAAA,GAG7BwoC,EAAQuhE,SAAAA,GAAAA,CAAY;wBACpB;oBACF;oBAAO;wBACL,MAAMvhE,IAAU1iD,IAAAA,CAAKkkH,EAAAA,CAAG1jH;wBAAAA,CACnBR,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGyjH,SAAAA,IAAajkH,IAAAA,CAAK4jH,eAAAA,CAAgBj8C,CAAAA,CAASnnE,EAAAA,KACzDkiD,CAAAA,EAAQxoC,MAAAA,CAAO3R,IAAAA,CAAKvI,IAAAA,CAAKka,MAAAA,GACzBla,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,WAAW,IAAIs6C,GAAoBjiD,GAAGR,IAAAA,CAAKkkH,EAAAA,CAAG1jH,IAAAA,GAGjER,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGyjH,SAAAA,GAAAA,CAAY;oBACzB;oBAKA,IAHAjkH,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGitC,MAAAA,IAGPk6B,CAAAA,CAASnnE,EAAAA,CAAG2jH,SAAAA,IAAax8C,CAAAA,CAASnnE,EAAAA,CAAG2jH,SAAAA,KAAcnkH,IAAAA,CAAKijH,kBAAAA,CAAmBziH,EAAAA,EAC7E;oBAGFR,IAAAA,CAAKijH,kBAAAA,CAAmBziH,EAAAA,GAAKmnE,CAAAA,CAASnnE,EAAAA,CAAG2jH,SAAAA,EAGzCnkH,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAG4jH,gBAAAA,GAAmBz8C,CAAAA,CAASnnE,EAAAA;oBAIvC,MAAMkiD,IAAUilB,CAAAA,CAASnnE,EAAAA;oBAEzB,IAAIkiD,GAAS;wBACX,IAAK,IAAI2hE,IAAc,GAAGA,IAAc3hE,EAAQshE,OAAAA,CAAQ1jH,MAAAA,EAAQ+jH,IAAe;4BAC7E,MAAMxhE,IAASH,EAAQshE,OAAAA,CAAQK,EAAAA,EACzBjhH,IAAQy/C,QAAAA,IAAAA,KAAM,IAANA,EAAQz/C,KAAAA;4BAClBA,MAA0B,CAAA,SAAhB,CAAA,IAAApD,IAAAA,CAAKkjH,QAAAA,CAAS1iH,EAAAA,AAAAA,KAAAA,KAAE,MAAA,IAAA,KAAA,IAAA,EAAE8jH,SAAAA,CAAUD,EAAAA,KAAAA,CAAAA,AACpCxhE,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ0hE,OAAAA,AAAAA,IACVvkH,CAAAA,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGgkH,YAAAA,CAAaH,GAAajhH,IAGrCpD,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAG0Z,MAAAA,CAAO/R,IAAAA,CAAK,UAAU,IAAIy6C,GACnCyhE,KAAeI,KAAUJ,IAAyBI,GAAQC,OAAAA,EAC1DL,GACAjhH,GACApD,IAAAA,CAAKkkH,EAAAA,CAAG1jH,IAAAA,IAGVR,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGgkH,YAAAA,CAAaH,GAAa,EAAA;wBAG3C;wBAEA,IAAK,IAAIM,IAAY,GAAGA,IAAYjiE,EAAQgzB,IAAAA,CAAKp1E,MAAAA,EAAQqkH,IAAa;4BACpE,MAAM5hE,IAAOL,EAAQgzB,IAAAA,CAAKivC,EAAAA;4BACtB5hE,MAAyB,CAAA,SAAhB,CAAA,IAAA/iD,IAAAA,CAAKkjH,QAAAA,CAAS1iH,EAAAA,AAAAA,KAAAA,KAAE,MAAA,IAAA,KAAA,IAAA,EAAEokH,OAAAA,CAAQD,EAAAA,KACrC3kH,CAAAA,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGqkH,UAAAA,CAAWF,GAAW5hE,IACjC/iD,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAG0Z,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ,IAAI26C,GAAiB6hE,GAAW5hE,GAAM/iD,IAAAA,CAAKkkH,EAAAA,CAAG1jH,IAAAA;wBAEjF;oBACF;oBACAR,IAAAA,CAAKkjH,QAAAA,CAAS1iH,EAAAA,GAAKR,IAAAA,CAAK8kH,SAAAA,CAAUn9C,CAAAA,CAASnnE,EAAAA;gBAC7C;YACF;YAKO,GAAGgL,CAAAA,EAAAA;gBAER,IADAxL,IAAAA,CAAK2jH,gBAAAA,IACDn4G,KAASxL,IAAAA,CAAKmjH,KAAAA,CAAM7iH,MAAAA,EAEtB,IAAK,IAAIE,IAAIR,IAAAA,CAAKmjH,KAAAA,CAAM7iH,MAAAA,GAAS,GAAGiF,IAAMiG,GAAOhL,IAAI+E,GAAK/E,IACxDR,IAAAA,CAAKmjH,KAAAA,CAAMxjH,IAAAA,CAAK,IAAIolH,KACpB/kH,IAAAA,CAAKkjH,QAAAA,CAASvjH,IAAAA,CAAK,IAAIolH;gBAI3B,OAAO/kH,IAAAA,CAAKmjH,KAAAA,CAAM33G,EACpB;YAAA;YAKO,mBAAAw5G;gBACLhlH,IAAAA,CAAK2jH,gBAAAA;gBACL,MAAMv4G,IAAoB,EAAA;gBAC1B,IAAK,IAAI5K,IAAI,GAAGA,IAAIR,IAAAA,CAAKmjH,KAAAA,CAAM7iH,MAAAA,EAAQE,IACjCR,IAAAA,CAAK4jH,eAAAA,CAAgB5jH,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAG4jH,gBAAAA,KAAqBpkH,IAAAA,CAAKkkH,EAAAA,CAAG1jH,GAAGyjH,SAAAA,IAClE74G,EAAOzL,IAAAA,CAAKK,IAAAA,CAAKkkH,EAAAA,CAAG1jH;gBAGxB,OAAO4K;YACT;YAKO,QAAA22B;gBACL,OAAO/hC,IAAAA,CAAKmjH,KAAAA,CAAMn7G,MAAAA,CAAQsO,CAAAA,IAAMA,EAAE2tG,SAAAA,EAAW3jH,MAC/C;YAAA;YAEQ,WAAW2kH,CAAAA,EAAAA;gBACjB,MAAMC,IAAM,EAAA;gBACZ,IAAK,IAAI1kH,IAAI,GAAGmX,IAAMstG,EAAK3kH,MAAAA,EAAQE,IAAImX,GAAKnX,IAC1C0kH,EAAIvlH,IAAAA,CAAKK,IAAAA,CAAK8kH,SAAAA,CAAUG,CAAAA,CAAKzkH,EAAAA;gBAE/B,OAAO0kH;YACT;YAKQ,UAAUrB,CAAAA,EAAAA;gBAChB,IAAIrjH,GAAGmX;gBACP,MAAMwtG,IAAY,IAAIJ;gBAEtB,IAAA,CAAKlB,GACH,OAAOsB;gBAGT,IAAK3kH,IAAI,GAAGmX,IAAMksG,EAAIG,OAAAA,CAAQ1jH,MAAAA,EAAQE,IAAImX,GAAKnX,IACzCqjH,EAAIG,OAAAA,CAAQxjH,EAAAA,IACd2kH,EAAUX,YAAAA,CAAahkH,GAAGqjH,EAAIG,OAAAA,CAAQxjH,EAAAA,CAAG4C,KAAAA;gBAG7C,IAAK5C,IAAI,GAAGmX,IAAMksG,EAAInuC,IAAAA,CAAKp1E,MAAAA,EAAQE,IAAImX,GAAKnX,IAC1C2kH,EAAUN,UAAAA,CAAWrkH,GAAGqjH,EAAInuC,IAAAA,CAAKl1E,EAAAA;gBAGnC,OAAO2kH;YACT;QAAA;QAxPc,GAAAC,oBAAAA,GAAuB;QA+PhC,MAAML;YASX,aAAAp+G;gBARO,IAAA,CAAAuT,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAA+8G,SAAAA,GAAAA,CAAY,GAEX,IAAA,CAAAoB,KAAAA,GAAkB,IAAIt7G,MAAM,IAC5B,IAAA,CAAAu7G,QAAAA,GAAqB,IAAIv7G,MAAM,KAC/B,IAAA,CAAAw7G,UAAAA,GAAuB,IAAIx7G,MAAM,KACjC,IAAA,CAAAy7G,YAAAA,GAAyB,IAAIz7G,MAAM;gBAGzC,IAAK,IAAIvJ,IAAI,GAAGA,IAAIR,IAAAA,CAAKslH,QAAAA,CAAShlH,MAAAA,EAAQE,IACxCR,IAAAA,CAAKslH,QAAAA,CAAS9kH,EAAAA,GAAK;gBAErB,IAAK,IAAIA,IAAI,GAAGA,IAAIR,IAAAA,CAAKqlH,KAAAA,CAAM/kH,MAAAA,EAAQE,IACrCR,IAAAA,CAAKqlH,KAAAA,CAAM7kH,EAAAA,GAAK;YAEpB;YAEO,SAAAitC;gBAELztC,IAAAA,CAAKwlH,YAAAA,GAAe,IAAIz7G,MAAM,KAC9B/J,IAAAA,CAAKulH,UAAAA,GAAa,IAAIx7G,MAAM;YAC9B;YAQO,gBAAgB84C,CAAAA,EAA0Bq1B,IAAoB,CAAA,EAAA;gBACnE,OAAOl4E,IAAAA,CAAKslH,QAAAA,CAASziE,EAAAA,IAAWq1B;YAClC;YAOO,aAAar1B,CAAAA,EAA0Bq1B,IAAoB,CAAA,EAAA;gBAChE,OAAOl4E,IAAAA,CAAKslH,QAAAA,CAASziE,EAAAA,IAAWq1B;YAClC;YAOO,iBAAiBr1B,CAAAA,EAA0Bq1B,IAAoB,CAAA,EAAA;gBACpE,OAAOl4E,IAAAA,CAAKwlH,YAAAA,CAAa3iE,EAAAA,IAAWq1B;YACtC;YAMO,kBAAkBr1B,CAAAA,EAAAA;gBACvB,OAAOgjE,QAAQ7lH,IAAAA,CAAKulH,UAAAA,CAAW1iE,EAAAA;YACjC;YAKO,UAAUA,CAAAA,EAAAA;gBACf,OAAO7iD,IAAAA,CAAKslH,QAAAA,CAASziE,EACvB;YAAA;YAMO,QAAQ6yB,CAAAA,EAAAA;gBACb,MAAMtyE,IAAQpD,IAAAA,CAAKqlH,KAAAA,CAAM3vC,EAAAA;gBAEzB,OAAIpwE,KAAKyH,GAAAA,CAAI3J,KAAS4/G,GAASoC,oBAAAA,GACtB,IAEAhiH;YAEX;YAEO,aAAaihH,CAAAA,EAAqBjhH,CAAAA,EAAAA;gBAEzB,MAAVA,KAAepD,IAAAA,CAAKslH,QAAAA,CAASjB,EAAAA,GAC/BrkH,IAAAA,CAAKulH,UAAAA,CAAWlB,EAAAA,GAAe,IAI/BrkH,IAAAA,CAAKwlH,YAAAA,CAAanB,EAAAA,GAAejhH,GAGnCpD,IAAAA,CAAKslH,QAAAA,CAASjB,EAAAA,GAAejhH;YAC/B;YAEO,WAAWuhH,CAAAA,EAAmBvhH,CAAAA,EAAAA;gBACnCpD,IAAAA,CAAKqlH,KAAAA,CAAMV,EAAAA,GAAavhH;YAC1B;YAIO,KAA0DsE,CAAAA,EAAuBU,CAAAA,EAAAA;gBACtFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAwDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAA0DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACtF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;QAAA;QAMF,IAAY88G,IAmFAqB,IC3eAC;QAAAA,CDwZZ,SAAYtB,CAAAA;YAIV,CAAA,CAAA,EAAA,OAAA,GAAA,GAAA,GAAA,WAIA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SAIA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SAIA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SAIA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SAIA,CAAA,CAAA,EAAA,UAAA,GAAA,EAAA,GAAA,cAIA,CAAA,CAAA,EAAA,WAAA,GAAA,EAAA,GAAA,eAIA,CAAA,CAAA,EAAA,WAAA,GAAA,EAAA,GAAA,eAIA,CAAA,CAAA,EAAA,YAAA,GAAA,EAAA,GAAA,gBAIA,CAAA,CAAA,EAAA,MAAA,GAAA,EAAA,GAAA,UAIA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SAIA,CAAA,CAAA,EAAA,SAAA,GAAA,GAAA,GAAA,aAIA,CAAA,CAAA,EAAA,UAAA,GAAA,GAAA,GAAA,cAIA,CAAA,CAAA,EAAA,MAAA,GAAA,GAAA,GAAA,UAIA,CAAA,CAAA,EAAA,QAAA,GAAA,GAAA,GAAA,YAIA,CAAA,CAAA,EAAA,QAAA,GAAA,GAAA,GAAA,YAIA,CAAA,CAAA,EAAA,SAAA,GAAA,GAAA,GAAA,aAIA,CAAA,CAAA,EAAA,YAAA,GAAA,GAAA,GAAA,gBAKA,CAAA,CAAA,EAAA,WAAA,GAAA,GAAA,GAAA;QACD,EA9EWA,MAAAA,CAAAA,KAAO,CAAA,CAAA,IAmFnB,SAAYqB,CAAAA;YAIV,CAAA,CAAA,EAAA,UAAA,GAAA,EAAA,GAAA,cAIA,CAAA,CAAA,EAAA,UAAA,GAAA,EAAA,GAAA,cAIA,CAAA,CAAA,EAAA,WAAA,GAAA,EAAA,GAAA,eAIA,CAAA,CAAA,EAAA,WAAA,GAAA,EAAA,GAAA;QACD,EAjBWA,MAAAA,CAAAA,KAAI,CAAA,CAAA;QEveT,MAAME;YAEX,YAAmBC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GADX,IAAA,CAAAC,SAAAA,GAAY,IAAI53F;YACmB;YAK3C,UAAA0qB;gBACE,KAAK,MAAA,CAAO0uB,GAAOy+C,EAAAA,IAAYnmH,IAAAA,CAAKkmH,SAAAA,CAAUh4E,OAAAA,GAAW;oBACvD,MAAMra,IAAU6zC,EAAM1nE,IAAAA,CAAKimH,MAAAA;oBACvBpyF,KACFsyF,EAAQtyF;gBAEZ;YACF;YAsBA,GACEuyF,CAAAA,EACAC,CAAAA,EAAAA;gBAEArmH,IAAAA,CAAKkmH,SAAAA,CAAUl7F,GAAAA,CAAIo7F,GAAcC;YACnC;QAAA;QCpDK,SAASC;YACd,IAAA;gBAOE,MAAMC,IAAO,KACL;gBAER/iH,OAAOiX,GAAAA,CAAI4P,gBAAAA,CAAiB,QAAQk8F,IACpC/iH,OAAOiX,GAAAA,CAAIm7C,mBAAAA,CAAoB,QAAQ2wD;YACzC,EAAE,OAAA,GAAA;gBACA,OAAA,CAAO;YACT;YACA,OAAA,CAAO;QACT;QAAA,CFVA,SAAYR,CAAAA;YAEV,EAAA,SAAA,GAAA,aACA,EAAA,SAAA,GAAA,aACA,EAAA,WAAA,GAAA,eACA,EAAA,YAAA,GAAA,gBACA,EAAA,KAAA,GAAA,SAGA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,IAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,MAAA,GAAA,UAEA,EAAA,KAAA,GAAA,SAEA,EAAA,aAAA,GAAA,iBACA,EAAA,MAAA,GAAA,UACA,EAAA,OAAA,GAAA,WAGA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,CAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QAGA,EAAA,KAAA,GAAA,SACA,EAAA,MAAA,GAAA,UACA,EAAA,KAAA,GAAA,SACA,EAAA,SAAA,GAAA,aACA,EAAA,KAAA,GAAA,SAGA,EAAA,OAAA,GAAA,WACA,EAAA,QAAA,GAAA,YACA,EAAA,GAAA,GAAA,OACA,EAAA,QAAA,GAAA,YACA,EAAA,SAAA,GAAA,aACA,EAAA,QAAA,GAAA,YACA,EAAA,WAAA,GAAA,eACA,EAAA,WAAA,GAAA,eACA,EAAA,YAAA,GAAA,gBACA,EAAA,KAAA,GAAA,SACA,EAAA,QAAA,GAAA,YACA,EAAA,SAAA,GAAA,aACA,EAAA,SAAA,GAAA,aACA,EAAA,UAAA,GAAA,cACA,EAAA,KAAA,GAAA,SACA,EAAA,GAAA,GAAA,OAEA,EAAA,OAAA,GAAA,WACA,EAAA,QAAA,GAAA,YACA,EAAA,UAAA,GAAA,cAGA,EAAA,MAAA,GAAA,UACA,EAAA,GAAA,GAAA,OACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA,QACA,EAAA,MAAA,GAAA,UACA,EAAA,QAAA,GAAA,YACA,EAAA,MAAA,GAAA,UAGA,EAAA,EAAA,GAAA,WACA,EAAA,IAAA,GAAA,aACA,EAAA,IAAA,GAAA,aACA,EAAA,KAAA,GAAA,cAEA,EAAA,OAAA,GAAA,WACA,EAAA,SAAA,GAAA,aACA,EAAA,SAAA,GAAA,aACA,EAAA,UAAA,GAAA,cAGA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,OAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WACA,EAAA,IAAA,GAAA,WAEA,EAAA,MAAA,GAAA,aACA,EAAA,SAAA,GAAA,aAEA,EAAA,UAAA,GAAA,iBACA,EAAA,aAAA,GAAA,iBAEA,EAAA,SAAA,GAAA,gBACA,EAAA,YAAA,GAAA,gBAEA,EAAA,QAAA,GAAA,eACA,EAAA,WAAA,GAAA,eAEA,EAAA,WAAA,GAAA,kBACA,EAAA,cAAA,GAAA,kBAEA,EAAA,WAAA,GAAA,kBACA,EAAA,cAAA,GAAA,kBAKA,EAAA,GAAA,GAAA,UACA,EAAA,MAAA,GAAA,UACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,EAAA,GAAA,MACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,GAAA,GAAA,OACA,EAAA,WAAA,GAAA,eACA,EAAA,UAAA,GAAA,cACA,EAAA,KAAA,GAAA,SAEA,EAAA,YAAA,GAAA;QACD,EAlNWA,MAAAA,CAAAA,KAAI,CAAA,CAAA;QAuNT,MAAMS,WAAiB;YAM5B,YACSlkH,CAAAA,EACAc,CAAAA,EACAqjH,CAAAA,CAAAA;gBAEP75F,KAAAA,IAJO,IAAA,CAAAtqB,GAAAA,GAAAA,GACA,IAAA,CAAAc,KAAAA,GAAAA,GACA,IAAA,CAAAqjH,aAAAA,GAAAA;YAGT;QAAA;QAuBK,MAAMC;YAAb,aAAA;gBACS,IAAA,CAAAxsG,MAAAA,GAAS,IAAIhT,GACZ,IAAA,CAAAq8G,QAAAA,GAAAA,CAAW,GAIX,IAAA,CAAAoD,KAAAA,GAAgB,EAAA,EAIhB,IAAA,CAAAC,OAAAA,GAAkB,EAAA,EAIlB,IAAA,CAAAC,SAAAA,GAAoB,EAAA,EAgEpB,IAAA,CAAAC,eAAAA,GAAmBC,CAAAA;oBACzB,KAAK,MAAMC,KAAQhnH,IAAAA,CAAK2mH,KAAAA,CAAO;wBAC7B,MAAMM,IAAW,IAAIT,GAASQ,GAAMD,EAAGzkH,GAAAA,EAAKykH;wBAC5C/mH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,MAAM8+G,IACvBjnH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,WAAW8+G;oBAC9B;oBACAjnH,IAAAA,CAAK4mH,OAAAA,GAAU78G,MAAMwD,IAAAA,CAAK,IAAI0J,IAAIjX,IAAAA,CAAK2mH,KAAAA,CAAMtmH,MAAAA,CAAOL,IAAAA,CAAK4mH,OAAAA,KACzD5mH,IAAAA,CAAK2mH,KAAAA,CAAMrmH,MAAAA,GAAS;gBAAC,GASf,IAAA,CAAA4mH,cAAAA,GAAkBH,CAAAA;oBACxB,IAAA,CAAK/mH,IAAAA,CAAKujH,QAAAA,EACR;oBAKGwD,EAAGI,OAAAA,IAAAA,CAAYnnH,IAAAA,CAAK2mH,KAAAA,CAAM1lG,QAAAA,CAAS8kG,GAAKqB,QAAAA,KAAAA,CAAapnH,IAAAA,CAAK2mH,KAAAA,CAAM1lG,QAAAA,CAAS8kG,GAAKsB,SAAAA,KACjFrnH,IAAAA,CAAK8mH,eAAAA,CAAgBC;oBAGvB,MAAMC,IAAOD,EAAGC,IAAAA;oBAChB,IAAA,OAAIhnH,IAAAA,CAAK2mH,KAAAA,CAAMl+G,OAAAA,CAAQu+G,IAAc;wBACnChnH,IAAAA,CAAK2mH,KAAAA,CAAMhnH,IAAAA,CAAKqnH,IAChBhnH,IAAAA,CAAK6mH,SAAAA,CAAUlnH,IAAAA,CAAKqnH;wBACpB,MAAMC,IAAW,IAAIT,GAASQ,GAAMD,EAAGzkH,GAAAA,EAAKykH;wBAC5C/mH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ8+G,IACzBjnH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,SAAS8+G;oBAC5B;gBAAA,GAGM,IAAA,CAAAK,YAAAA,GAAgBP,CAAAA;oBACtB,IAAA,CAAK/mH,IAAAA,CAAKujH,QAAAA,EACR;oBAEF,MAAMyD,IAAOD,EAAGC,IAAAA,EACV1kH,IAAMtC,IAAAA,CAAK2mH,KAAAA,CAAMl+G,OAAAA,CAAQu+G;oBAC/BhnH,IAAAA,CAAK2mH,KAAAA,CAAMj+G,MAAAA,CAAOpG,GAAK,IACvBtC,IAAAA,CAAK4mH,OAAAA,CAAQjnH,IAAAA,CAAKqnH;oBAClB,MAAMC,IAAW,IAAIT,GAASQ,GAAMD,EAAGzkH,GAAAA,EAAKykH;oBAG5C/mH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,MAAM8+G,IACvBjnH,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,WAAW8+G,IAIb,WAAXF,EAAGzkH,GAAAA,IACLtC,IAAAA,CAAK8mH,eAAAA,CAAgBC;gBACvB;YA8EJ;YAjMS,KAAsDr/G,CAAAA,EAAuBU,CAAAA,EAAAA;gBAClFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAoDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBAChF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAsDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBAClF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAqDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACjF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAKA,KAAK4/G,CAAAA,EAAAA;gBACH,IAAA,EAAI,QAAEC,CAAAA,EAAAA,GAAWD;gBACjB,MAAA,EAAM,iBAAEE,CAAAA,EAAAA,GAAoBF;gBACvBC,KACClB,CAAAA,OACFkB,CAAAA,IAAShkH,QAILikH,KACFjkH,OAAOwoD,KAAAA,IAGTp1C,EAAOS,WAAAA,GAAcgB,IAAAA,CAAK,uGAAA,IAE1BmvG,IAAShkH,OAAOiX,GAAAA,AAAAA,GAIpB+sG,EAAOn9F,gBAAAA,CAAiB,QAAQ;oBAC9BrqB,IAAAA,CAAK2mH,KAAAA,CAAMrmH,MAAAA,GAAS;gBAAC,IAIvBknH,EAAOn9F,gBAAAA,CAAiB,SAASrqB,IAAAA,CAAKsnH,YAAAA,GAGtCE,EAAOn9F,gBAAAA,CAAiB,WAAWrqB,IAAAA,CAAKknH,cAAAA;YAC1C;YAEA,cAActzC,CAAAA,EAAAA;gBACZ5zE,IAAAA,CAAKujH,QAAAA,GAAW3vC;YAClB;YAYO,QAAApsE;gBACLxH,IAAAA,CAAK6mH,SAAAA,CAAUvmH,MAAAA,GAAS,GACxBN,IAAAA,CAAK4mH,OAAAA,CAAQtmH,MAAAA,GAAS,GACtBN,IAAAA,CAAK2mH,KAAAA,CAAMrmH,MAAAA,GAAS;YACtB;YA4CO,SAAAmtC;gBAELztC,IAAAA,CAAK6mH,SAAAA,CAAUvmH,MAAAA,GAAS,GACxBN,IAAAA,CAAK4mH,OAAAA,CAAQtmH,MAAAA,GAAS;gBAGtB,IAAK,IAAIE,IAAI,GAAGA,IAAIR,IAAAA,CAAK2mH,KAAAA,CAAMrmH,MAAAA,EAAQE,IACrCR,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,QAAQ,IAAIq+G,GAASxmH,IAAAA,CAAK2mH,KAAAA,CAAMnmH,EAAAA;YAErD;YAKO,UAAAknH;gBACL,OAAO1nH,IAAAA,CAAK2mH,KACd;YAAA;YAMO,WAAWrkH,CAAAA,EAAAA;gBAChB,OAAA,CAAA,CAAKtC,IAAAA,CAAKujH,QAAAA,IAGHvjH,IAAAA,CAAK6mH,SAAAA,CAAUp+G,OAAAA,CAAQnG,KAAAA;YAChC;YAMO,OAAOA,CAAAA,EAAAA;gBACZ,OAAA,CAAA,CAAKtC,IAAAA,CAAKujH,QAAAA,IAGHvjH,IAAAA,CAAK2mH,KAAAA,CAAMl+G,OAAAA,CAAQnG,KAAAA;YAC5B;YAMO,YAAYA,CAAAA,EAAAA;gBACjB,OAAA,CAAA,CAAKtC,IAAAA,CAAKujH,QAAAA,IAGHvjH,IAAAA,CAAK4mH,OAAAA,CAAQn+G,OAAAA,CAAQnG,KAAAA;YAC9B;YAQO,aAAamE,CAAAA,EAAqBnE,CAAAA,EAAWylH,CAAAA,EAAAA;gBACrC,WAATthH,KACFzG,IAAAA,CAAKknH,cAAAA,CACH,IAAIc,cAAc,WAAW;oBAC3BhB,MAAM1kH;oBACNA,KAAKylH,QAAAA,IAAAA,IAAa;gBAAA,KAIX,SAATthH,KACFzG,IAAAA,CAAKsnH,YAAAA,CACH,IAAIU,cAAc,SAAS;oBACzBhB,MAAM1kH;oBACNA,KAAKylH,QAAAA,IAAAA,IAAa;gBAAA;YAI1B;QAAA;QGndK,MAAME;YAGJ,OAAA,iBAAwBE,CAAAA,EAAyBC,CAAAA,EAA4BC,CAAAA,EAAAA;gBAClF,IAAIC,GACAC,GACAjuG,GACAL;gBAEqB,MAArBk+D,UAAU73E,MAAAA,GACZgoH,CAAAA,IAAgBH,GAChBI,IAAgBH,GAChB9tG,IAAU,IAAIxM,EAAOw6G,GAAOC,IAC5BtuG,IAASouG,CAAAA,IAET/tG,CAAAA,IAAkB6tG,GAClBG,IAAQhuG,EAAQhO,CAAAA,EAChBi8G,IAAQjuG,EAAQlQ,CAAAA,EAChB6P,IAAiBmuG,CAAAA;gBAGnB,MAAMlI,IAAYjmG,EAAOjG,MAAAA,CAAOukD,uBAAAA,CAAwBj+C,IAClDm7D,IAAWx7D,EAAOjG,MAAAA,CAAO+kD,wBAAAA,CAAyBmnD;gBAExD,OAAO,IAAI+H,GAAkBxyC,GAAUn7D,GAAS4lG;YAClD;YAEA,YACSzqC,CAAAA,EACAn7D,CAAAA,EACA4lG,CAAAA,CAAAA;gBAFA,IAAA,CAAAzqC,QAAAA,GAAAA,GACA,IAAA,CAAAn7D,OAAAA,GAAAA,GACA,IAAA,CAAA4lG,SAAAA,GAAAA;YACN;QAAA;QC7BE,MAAMsI;YAEJ,SAAA/qC;gBACLz9E,IAAAA,CAAKumD,MAAAA,GAAAA,CAAS;YAChB;YAEA,IAAA,UAAIjsC;gBACF,OAAOta,IAAAA,CAAKyoH,WAAAA,CAAYnuG,OAC1B;YAAA;YAEA,IAAA,YAAI4lG;gBACF,OAAOlgH,IAAAA,CAAKyoH,WAAAA,CAAYvI,SAC1B;YAAA;YAEA,IAAA,WAAIzqC;gBACF,OAAOz1E,IAAAA,CAAKyoH,WAAAA,CAAYhzC,QAC1B;YAAA;YAEA,YACShvE,CAAAA,EACAy8F,CAAAA,EACArgD,CAAAA,EACA6lE,CAAAA,EACAD,CAAAA,EACAE,CAAAA,CAAAA;gBALA,IAAA,CAAAliH,IAAAA,GAAAA,GACA,IAAA,CAAAy8F,SAAAA,GAAAA,GACA,IAAA,CAAArgD,MAAAA,GAAAA,GACA,IAAA,CAAA6lE,WAAAA,GAAAA,GACA,IAAA,CAAAD,WAAAA,GAAAA,GACA,IAAA,CAAAE,WAAAA,GAAAA,GAvBF,IAAA,CAAApiE,MAAAA,GAAAA,CAAS;YAwBb;QAAA;QC5BE,MAAMqiE;YAEJ,SAAAnrC;gBACLz9E,IAAAA,CAAKumD,MAAAA,GAAAA,CAAS;YAChB;YACA,YACSj6C,CAAAA,EACAlC,CAAAA,EACAk+G,CAAAA,EACAC,CAAAA,EACAM,CAAAA,EACAC,CAAAA,EACAt9G,CAAAA,EACAgE,CAAAA,EACAC,CAAAA,EACAs5G,CAAAA,EACAC,CAAAA,EACAjC,CAAAA,CAAAA;gBAXA,IAAA,CAAAz6G,CAAAA,GAAAA,GACA,IAAA,CAAAlC,CAAAA,GAAAA,GACA,IAAA,CAAAk+G,KAAAA,GAAAA,GACA,IAAA,CAAAC,KAAAA,GAAAA,GACA,IAAA,CAAAM,OAAAA,GAAAA,GACA,IAAA,CAAAC,OAAAA,GAAAA,GACA,IAAA,CAAAt9G,KAAAA,GAAAA,GACA,IAAA,CAAAgE,MAAAA,GAAAA,GACA,IAAA,CAAAC,MAAAA,GAAAA,GACA,IAAA,CAAAs5G,MAAAA,GAAAA,GACA,IAAA,CAAAC,SAAAA,GAAAA,GACA,IAAA,CAAAjC,EAAAA,GAAAA,GAhBF,IAAA,CAAAxgE,MAAAA,GAAAA,CAAS;YAiBb;QAAA;QCbE,MAAM0iE;YAiBX,aAAAtiH;gBAhBO,IAAA,CAAAuT,MAAAA,GAAS,IAAIhT,GAIb,IAAA,CAAAgiH,WAAAA,GAAsBp7G,EAAOC,IAAAA,EAK7B,IAAA,CAAAo7G,aAAAA,GAAwBr7G,EAAOC,IAAAA,EAK/B,IAAA,CAAAq7G,YAAAA,GAAuBt7G,EAAOC,IAAAA,EA2C7B,IAAA,CAAAs7G,cAAAA,GAAkBtC,CAAAA;oBACxB/mH,IAAAA,CAAKkpH,WAAAA,GAAc,IAAIp7G,EAAOi5G,EAAGzsG,OAAAA,CAAQhO,CAAAA,EAAGy6G,EAAGzsG,OAAAA,CAAQlQ,CAAAA,GACvDpK,IAAAA,CAAKmpH,aAAAA,GAAgB,IAAIr7G,EAAOi5G,EAAG7G,SAAAA,CAAU5zG,CAAAA,EAAGy6G,EAAG7G,SAAAA,CAAU91G,CAAAA,GAC7DpK,IAAAA,CAAKopH,YAAAA,GAAe,IAAIt7G,EAAOi5G,EAAGtxC,QAAAA,CAASnpE,CAAAA,EAAGy6G,EAAGtxC,QAAAA,CAASrrE,CAAAA;gBAAE,GAGtD,IAAA,CAAAk/G,cAAAA,GAAkBvC,CAAAA;oBACxB/mH,IAAAA,CAAKkpH,WAAAA,GAAc,IAAIp7G,EAAOi5G,EAAGzsG,OAAAA,CAAQhO,CAAAA,EAAGy6G,EAAGzsG,OAAAA,CAAQlQ,CAAAA,GACvDpK,IAAAA,CAAKmpH,aAAAA,GAAgB,IAAIr7G,EAAOi5G,EAAG7G,SAAAA,CAAU5zG,CAAAA,EAAGy6G,EAAG7G,SAAAA,CAAU91G,CAAAA,GAC7DpK,IAAAA,CAAKopH,YAAAA,GAAe,IAAIt7G,EAAOi5G,EAAGtxC,QAAAA,CAASnpE,CAAAA,EAAGy6G,EAAGtxC,QAAAA,CAASrrE,CAAAA;gBAAE,GAjD5DpK,IAAAA,CAAKyH,EAAAA,CAAG,QAAQzH,IAAAA,CAAKqpH,cAAAA,GACrBrpH,IAAAA,CAAKyH,EAAAA,CAAG,QAAQzH,IAAAA,CAAKspH,cAAAA;YACvB;YAIO,KAA0D5hH,CAAAA,EAAuBU,CAAAA,EAAAA;gBACtFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAwDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAA0DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACtF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAOO,qBAAqBsS,CAAAA,EAAAA;gBAC1B,MAAM87B,IAAQkyE,GAAkBC,gBAAAA,CAAiBloH,IAAAA,CAAKkpH,WAAAA,EAAajvG;gBACnEja,IAAAA,CAAKmpH,aAAAA,GAAgBpzE,EAAMmqE,SAAAA,EAC3BlgH,IAAAA,CAAKopH,YAAAA,GAAerzE,EAAM0/B,QAC5B;YAAA;QAAA;QC/DF,IAAY+zC,ICGAC,ICAAC,ICAAC;QAAAA,CHHZ,SAAYH,CAAAA;YACV,EAAA,KAAA,GAAA,SACA,EAAA,IAAA,GAAA,QACA,EAAA,IAAA,GAAA;QACD,EAJWA,MAAAA,CAAAA,KAAc,CAAA,CAAA,ICG1B,SAAYC,CAAAA;YACV,CAAA,CAAA,EAAA,QAAA,GAAA,GAAA,GAAA,YACA,CAAA,CAAA,EAAA,IAAA,GAAA,EAAA,GAAA,QACA,CAAA,CAAA,EAAA,MAAA,GAAA,EAAA,GAAA,UACA,CAAA,CAAA,EAAA,KAAA,GAAA,EAAA,GAAA,SACA,CAAA,CAAA,EAAA,OAAA,GAAA,EAAA,GAAA;QACD,EANWA,MAAAA,CAAAA,KAAmB,CAAA,CAAA,ICA/B,SAAYC,CAAAA;YACV,EAAA,IAAA,GAAA,QACA,EAAA,MAAA,GAAA,UACA,EAAA,KAAA,GAAA,SACA,EAAA,OAAA,GAAA,WACA,EAAA,QAAA,GAAA;QACD,EANWA,MAAAA,CAAAA,KAAa,CAAA,CAAA,ICAzB,SAAYC,CAAAA;YACV,EAAA,KAAA,GAAA,SACA,EAAA,KAAA,GAAA,SACA,EAAA,GAAA,GAAA,OACA,EAAA,OAAA,GAAA;QACD,EALWA,MAAAA,CAAAA,KAAW,CAAA,CAAA;QCuDhB,MAAMC;YAmBX,YACkBvoG,CAAAA,EACTpH,CAAAA,CAAAA;gBADS,IAAA,CAAAoH,MAAAA,GAAAA,GACT,IAAA,CAAApH,MAAAA,GAAAA,GApBF,IAAA,CAAAC,MAAAA,GAAS,IAAIhT,GACb,IAAA,CAAA2iH,OAAAA,GAA8B,IAAIZ,IAEjC,IAAA,CAAAa,mCAAAA,GAAsC,IAAIx7F,KAC3C,IAAA,CAAAy7F,sBAAAA,GAAyB,IAAIz7F,KAC7B,IAAA,CAAAo2E,yBAAAA,GAA4B,IAAIp2E,KAEhC,IAAA,CAAA07F,uBAAAA,GAA0B,IAAI17F,KAC9B,IAAA,CAAA27F,oBAAAA,GAAuB,IAAI37F,KAE3B,IAAA,CAAAq2E,gBAAAA,GAAmC,EAAA,EACnC,IAAA,CAAAE,cAAAA,GAAiC,EAAA,EACjC,IAAA,CAAAE,gBAAAA,GAAmC,EAAA,EACnC,IAAA,CAAAE,kBAAAA,GAAqC,EAAA,EACrC,IAAA,CAAAC,iBAAAA,GAAkC,EAAA,EAEjC,IAAA,CAAAqe,QAAAA,GAAAA,CAAW,GAwBX,IAAA,CAAA2G,SAAAA,GAAkC;oBAAClqH,IAAAA,CAAK6pH,OAAAA;iBAAAA,EAyLxC,IAAA,CAAAM,YAAAA,GAAenqH,IAAAA,CAAKoqH,OAAAA,CAAQvpG,IAAAA,CAAK7gB,IAAAA,GACjC,IAAA,CAAAqqH,WAAAA,GAAcrqH,IAAAA,CAAKsqH,YAAAA,CAAazpG,IAAAA,CAAK7gB,IAAAA;YA7M1C;YAEI,cAAc4zE,CAAAA,EAAAA;gBACnB5zE,IAAAA,CAAKujH,QAAAA,GAAW3vC;YAClB;YAQO,SAASvyD,CAAAA,EAA2CpH,CAAAA,EAAAA;gBACzD,MAAMuwG,IAAgB,IAAIZ,GAAqBvoG,GAAQpH;gBAGvD,OAFAuwG,EAAcX,OAAAA,GAAU7pH,IAAAA,CAAK6pH,OAAAA,EAC7BW,EAAcN,SAAAA,GAAYlqH,IAAAA,CAAKkqH,SAAAA,EACxBM;YACT;YAOO,GAAGh/G,CAAAA,EAAAA;gBACR,IAAIA,KAASxL,IAAAA,CAAKkqH,SAAAA,CAAU5pH,MAAAA,EAE1B,IAAK,IAAIE,IAAIR,IAAAA,CAAKkqH,SAAAA,CAAU5pH,MAAAA,GAAS,GAAGiF,IAAMiG,GAAOhL,IAAI+E,GAAK/E,IAC5DR,IAAAA,CAAKkqH,SAAAA,CAAUvqH,IAAAA,CAAK,IAAIspH;gBAG5B,OAAOjpH,IAAAA,CAAKkqH,SAAAA,CAAU1+G,EACxB;YAAA;YAKO,QAAAu2B;gBACL,OAAO/hC,IAAAA,CAAKkqH,SAAAA,CAAU5pH,MACxB;YAAA;YAMO,OAAO4iG,CAAAA,EAAAA;gBAAAA,IAAAA;gBACZ,OAAA,CAAA,CAAKljG,IAAAA,CAAKujH,QAAAA,IAGwC,SAA3C,CAAA,IAAAvjH,IAAAA,CAAKgqH,uBAAAA,CAAwBrnH,GAAAA,CAAIugG,EAAAA,KAAAA,KAAU,MAAA,KAAA;YACpD;YAMO,QAAQA,CAAAA,EAAAA;gBAAAA,IAAAA;gBACb,OAAA,CAAA,CAAKljG,IAAAA,CAAKujH,QAAAA,IAGqC,SAAxC,CAAA,IAAAvjH,IAAAA,CAAKiqH,oBAAAA,CAAqBtnH,GAAAA,CAAIugG,EAAAA,KAAAA,KAAU,MAAA,KAAA;YACjD;YAKO,WAAWA,CAAAA,EAAAA;gBAChB,OAAA,CAAA,CAAKljG,IAAAA,CAAKujH,QAAAA,IAGHvjH,IAAAA,CAAKyqH,MAAAA,CAAOvnB;YACrB;YAKO,YAAYA,CAAAA,EAAAA;gBACjB,OAAA,CAAA,CAAKljG,IAAAA,CAAKujH,QAAAA,IAGHvjH,IAAAA,CAAKyqH,MAAAA,CAAOvnB,MAAAA,CAAeljG,IAAAA,CAAK0qH,OAAAA,CAAQxnB;YACjD;YAKO,UAAUA,CAAAA,EAAAA;gBACf,OAAA,CAAA,CAAKljG,IAAAA,CAAKujH,QAAAA,IAAAA,CAGFvjH,IAAAA,CAAKyqH,MAAAA,CAAOvnB,MAAcljG,IAAAA,CAAK0qH,OAAAA,CAAQxnB;YACjD;YAIO,KAA0Dx7F,CAAAA,EAAuBU,CAAAA,EAAAA;gBACtFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAwDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAA0DD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACtF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAUO,SAAA8lC;gBACLztC,IAAAA,CAAKiqH,oBAAAA,GAAuB,IAAI37F,IAAItuB,IAAAA,CAAKgqH,uBAAAA,GACzChqH,IAAAA,CAAK+pH,sBAAAA,GAAyB,IAAIz7F,IAAItuB,IAAAA,CAAK0kG,yBAAAA;gBAE3C,KAAK,MAAMt8F,KAASpI,IAAAA,CAAK2kG,gBAAAA,CAAkB;oBACzC,IAAA,CAAKv8F,EAAMm+C,MAAAA,EACT;oBAEFvmD,IAAAA,CAAKmI,IAAAA,CAAK,QAAQC;oBACFpI,IAAAA,CAAKkkH,EAAAA,CAAG97G,EAAM86F,SAAAA,EACtB/6F,IAAAA,CAAK,QAAQC,IACrBpI,IAAAA,CAAK6pH,OAAAA,CAAQ1hH,IAAAA,CAAK,eAAeC;gBACnC;gBAEA,KAAK,MAAMA,KAASpI,IAAAA,CAAK6kG,cAAAA,CAAgB;oBACvC,IAAA,CAAKz8F,EAAMm+C,MAAAA,EACT;oBAEFvmD,IAAAA,CAAKmI,IAAAA,CAAK,MAAMC;oBACApI,IAAAA,CAAKkkH,EAAAA,CAAG97G,EAAM86F,SAAAA,EACtB/6F,IAAAA,CAAK,MAAMC;gBACrB;gBAEA,KAAK,MAAMA,KAASpI,IAAAA,CAAK+kG,gBAAAA,CAAkB;oBACzC,IAAA,CAAK38F,EAAMm+C,MAAAA,EACT;oBAEFvmD,IAAAA,CAAKmI,IAAAA,CAAK,QAAQC;oBACFpI,IAAAA,CAAKkkH,EAAAA,CAAG97G,EAAM86F,SAAAA,EACtB/6F,IAAAA,CAAK,QAAQC;gBACvB;gBAEA,KAAK,MAAMA,KAASpI,IAAAA,CAAKilG,kBAAAA,CAAoB;oBAC3C,IAAA,CAAK78F,EAAMm+C,MAAAA,EACT;oBAEFvmD,IAAAA,CAAKmI,IAAAA,CAAK,UAAUC;oBACJpI,IAAAA,CAAKkkH,EAAAA,CAAG97G,EAAM86F,SAAAA,EACtB/6F,IAAAA,CAAK,UAAUC;gBACzB;gBAEA,KAAK,MAAMA,KAASpI,IAAAA,CAAKklG,iBAAAA,CAClB98F,EAAMm+C,MAAAA,IAGXvmD,CAAAA,IAAAA,CAAKmI,IAAAA,CAAK,gBAAgBC,IAC1BpI,IAAAA,CAAKmI,IAAAA,CAAK,SAASC,IACnBpI,IAAAA,CAAK6pH,OAAAA,CAAQ1hH,IAAAA,CAAK,gBAAgBC,IAClCpI,IAAAA,CAAK6pH,OAAAA,CAAQ1hH,IAAAA,CAAK,SAASC,EAAAA;gBAG7B,IAAIpI,IAAAA,CAAKia,MAAAA,CAAO4tF,YAAAA,CAAajxC,MAAAA,CAAOq2C,UAAAA,IAClC,KAAK,MAAMlO,KAAW/+F,IAAAA,CAAKkqH,SAAAA,CACzBnrB,EAAQwqB,oBAAAA,CAAqBvpH,IAAAA,CAAKia,MAAAA;YAGxC;YAKO,QAAAzS;gBACL,KAAK,MAAMY,KAASpI,IAAAA,CAAK6kG,cAAAA,CAAgB;oBACvC7kG,IAAAA,CAAK0kG,yBAAAA,CAA0B71E,MAAAA,CAAOzmB,EAAM86F,SAAAA;oBAC5C,MAAM8Y,IAAMh8G,IAAAA,CAAK8pH,mCAAAA,CAAoC57E,OAAAA;oBACrD,KAAK,MAAA,CAAOy8E,GAAQ3rF,EAAAA,IAAeg9E,EAC7Bh9E,MAAe52B,EAAM86F,SAAAA,IACvBljG,IAAAA,CAAK8pH,mCAAAA,CAAoCj7F,MAAAA,CAAO87F;gBAGtD;gBACA3qH,IAAAA,CAAK2kG,gBAAAA,CAAiBrkG,MAAAA,GAAS,GAC/BN,IAAAA,CAAK6kG,cAAAA,CAAevkG,MAAAA,GAAS,GAC7BN,IAAAA,CAAK+kG,gBAAAA,CAAiBzkG,MAAAA,GAAS,GAC/BN,IAAAA,CAAKilG,kBAAAA,CAAmB3kG,MAAAA,GAAS,GACjCN,IAAAA,CAAKklG,iBAAAA,CAAkB5kG,MAAAA,GAAS;YAClC;YAQO,KAAK2Y,CAAAA,EAAAA;gBAAAA,IAAAA;gBACV,IAAIjZ,IAAAA,CAAKia,MAAAA,CAAO2wG,UAAAA,IACd;gBAKE5qH,IAAAA,CAAKqhB,MAAAA,KAAWrhB,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,GAC9BtZ,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,CAAOK,KAAAA,CAAMkxG,WAAAA,GAAc,SAEvCtxG,SAASO,IAAAA,CAAKH,KAAAA,CAAMkxG,WAAAA,GAAc,QAGhCrnH,OAAOglH,YAAAA,GACTxoH,CAAAA,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,eAAerqB,IAAAA,CAAKmqH,YAAAA,GACjDnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,aAAarqB,IAAAA,CAAKmqH,YAAAA,GAC/CnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,eAAerqB,IAAAA,CAAKmqH,YAAAA,GACjDnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,iBAAiBrqB,IAAAA,CAAKmqH,YAAAA,CAAAA,IAGnDnqH,CAAAA,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,cAAcrqB,IAAAA,CAAKmqH,YAAAA,GAChDnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,YAAYrqB,IAAAA,CAAKmqH,YAAAA,GAC9CnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,aAAarqB,IAAAA,CAAKmqH,YAAAA,GAC/CnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,eAAerqB,IAAAA,CAAKmqH,YAAAA,GAGjDnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,aAAarqB,IAAAA,CAAKmqH,YAAAA,GAC/CnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,WAAWrqB,IAAAA,CAAKmqH,YAAAA,GAC7CnqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,aAAarqB,IAAAA,CAAKmqH,YAAAA,CAAAA;gBAIjD,MAAMW,IAAe;oBACnBC,SAAAA,CACE/qH,CAAAA,IAAAA,CAAKia,MAAAA,CAAO+wG,wBAAAA,KAA6BC,GAAqB/+C,GAAAA,IAC9DlsE,IAAAA,CAAKia,MAAAA,CAAO+wG,wBAAAA,KAA6BC,GAAqBnuD,MAAAA,AAAAA;gBAAAA;gBAG9D,aAAavjD,SAASC,aAAAA,CAAc,SAEtCxZ,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,SAASrqB,IAAAA,CAAKqqH,WAAAA,EAAaS,KAAAA,KACrBhqH,MAA1ByY,SAAS2xG,YAAAA,GAElBlrH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,cAAcrqB,IAAAA,CAAKqqH,WAAAA,EAAaS,KAG7D9qH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,uBAAuBrqB,IAAAA,CAAKqqH,WAAAA,EAAaS;gBAKxE,IAAA,AAFgD,CAAA,SAAxB,CAAA,IAAA7xG,QAAAA,IAAAA,KAAO,IAAPA,EAASwuG,eAAAA,AAAAA,KAAAA,KAAe,MAAA,KAAA,CAAA,KAEzBnB,MAAuB;oBAC5C,MAAM6E,IAAY;wBAChB3nH,OAAOwoD,KAAAA;oBAAO;oBAGZxoD,OAAOglH,YAAAA,GACTxoH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,eAAe8gG,KAG5CnrH,CAAAA,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,cAAc8gG,IAG3CnrH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,aAAa8gG,EAAAA;gBAE9C;YACF;YAEO,SAAAC;gBAED5nH,OAAOglH,YAAAA,GACTxoH,CAAAA,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,eAAe51D,IAAAA,CAAKmqH,YAAAA,GACpDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,aAAa51D,IAAAA,CAAKmqH,YAAAA,GAClDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,eAAe51D,IAAAA,CAAKmqH,YAAAA,GACpDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,iBAAiB51D,IAAAA,CAAKmqH,YAAAA,CAAAA,IAGtDnqH,CAAAA,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,cAAc51D,IAAAA,CAAKmqH,YAAAA,GACnDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,YAAY51D,IAAAA,CAAKmqH,YAAAA,GACjDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,aAAa51D,IAAAA,CAAKmqH,YAAAA,GAClDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,eAAe51D,IAAAA,CAAKmqH,YAAAA,GAGpDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,aAAa51D,IAAAA,CAAKmqH,YAAAA,GAClDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,WAAW51D,IAAAA,CAAKmqH,YAAAA,GAChDnqH,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,aAAa51D,IAAAA,CAAKmqH,YAAAA,CAAAA,GAGhD,aAAa5wG,SAASC,aAAAA,CAAc,SAEtCxZ,IAAAA,CAAKqhB,MAAAA,CAAOu0C,mBAAAA,CAAoB,SAAS51D,IAAAA,CAAKqqH,WAAAA,IAAAA,KACXvpH,MAA1ByY,SAAS2xG,YAAAA,GAElBlrH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,cAAcrqB,IAAAA,CAAKqqH,WAAAA,IAGhDrqH,IAAAA,CAAKqhB,MAAAA,CAAOgJ,gBAAAA,CAAiB,uBAAuBrqB,IAAAA,CAAKqqH,WAAAA;YAE7D;YAMQ,oBAAoBiB,CAAAA,EAAAA;gBAE1BtrH,IAAAA,CAAK8pH,mCAAAA,CAAoC9+F,GAAAA,CAAIsgG,GAAAA;gBAG7C,MAGM1rH,IAHoBmK,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK8pH,mCAAAA,CAAoCvjH,IAAAA,IAAQorD,IAAAA,CAAK,CAACvvD,GAAGkQ,IAAMlQ,IAAIkQ,GAG5Ei5G,SAAAA,CAAWj1G,CAAAA,IAAMA,MAAMg1G;gBAMpD,OAHAtrH,IAAAA,CAAK8pH,mCAAAA,CAAoC9+F,GAAAA,CAAIsgG,GAAiB1rH,IAGvDA;YACT;YAKQ,QAAQmnH,CAAAA,EAAAA;gBACd,IAAA,CAAK/mH,IAAAA,CAAKujH,QAAAA,EACR;gBAEFwD,EAAGyE,cAAAA;gBACH,MAAMC,IAAc,IAAIn9F;gBACxB,IAAIu0B,GACA6lE;gBACJ,IAhYkBtlH,IAgYD2jH,GA9XZ2E,WAAWC,UAAAA,IAAcvoH,aAAiBsoH,WAAWC,UAAAA,EA8XpC;oBACpB9oE,IAAS6mE,GAAchF,OAAAA,EACvBgE,IAAciB,GAAYiC,KAAAA;oBAE1B,IAAK,IAAIprH,IAAI,GAAGA,IAAIumH,EAAG8E,cAAAA,CAAevrH,MAAAA,EAAQE,IAAK;wBACjD,MAAMuvB,IAAQg3F,EAAG8E,cAAAA,CAAerrH,EAAAA,EAC1BioH,IAAcR,GAAkBC,gBAAAA,CAAiBn4F,EAAMu4F,KAAAA,EAAOv4F,EAAMw4F,KAAAA,EAAOvoH,IAAAA,CAAKia,MAAAA,GAChFqxG,IAAkB9qH,IAAI,GACtB0iG,IAAYljG,IAAAA,CAAKqrH,mBAAAA,CAAoBC;wBAC3CtrH,IAAAA,CAAK0kG,yBAAAA,CAA0B15E,GAAAA,CAAIk4E,GAAWulB,IAC9CgD,EAAYzgG,GAAAA,CAAIk4E,GAAWulB;oBAC7B;gBACF,OAAO;oBACL5lE,IAAS7iD,IAAAA,CAAK8rH,4BAAAA,CAA6B/E,EAAGlkE,MAAAA,GAC9C6lE,IAAciB,GAAYoC,KAAAA;oBAC1B,MAAMtD,IAAcR,GAAkBC,gBAAAA,CAAiBnB,EAAGuB,KAAAA,EAAOvB,EAAGwB,KAAAA,EAAOvoH,IAAAA,CAAKia,MAAAA;oBAChF,IAAIqxG,IAAkB;oBAxY5B,CAAA,SAAwBloH,CAAAA;wBAEtB,OAAOsoH,WAAWlD,YAAAA,IAAgBplH,aAAiBsoH,WAAWlD,YAChE;oBAAA,CAAA,EAsYyBzB,MACjBuE,CAAAA,IAAkBvE,EAAG7jB,SAAAA,EACrBwlB,IAAc1oH,IAAAA,CAAKisH,oBAAAA,CAAqBlF,EAAG2B,WAAAA,CAAAA;oBAE7C,MAAMxlB,IAAYljG,IAAAA,CAAKqrH,mBAAAA,CAAoBC;oBAC3CtrH,IAAAA,CAAK0kG,yBAAAA,CAA0B15E,GAAAA,CAAIk4E,GAAWulB,IAC9CgD,EAAYzgG,GAAAA,CAAIk4E,GAAWulB;gBAC7B;gBAxZJ,IAAsBrlH;gBA0ZlB,KAAK,MAAA,CAAO8/F,GAAWntD,EAAAA,IAAU01E,EAAYv9E,OAAAA,GAC3C,OAAQ64E,EAAGtgH,IAAAA;oBACT,KAAK;oBACL,KAAK;oBACL,KAAK;wBACHzG,IAAAA,CAAK2kG,gBAAAA,CAAiBhlG,IAAAA,CAAK,IAAI6oH,GAAa,QAAQtlB,GAAWrgD,GAAQ6lE,GAAa3yE,GAAOgxE,KAC3F/mH,IAAAA,CAAKgqH,uBAAAA,CAAwBh/F,GAAAA,CAAIk4E,GAAAA,CAAW;wBAC5C;oBACF,KAAK;oBACL,KAAK;oBACL,KAAK;wBACHljG,IAAAA,CAAK6kG,cAAAA,CAAellG,IAAAA,CAAK,IAAI6oH,GAAa,MAAMtlB,GAAWrgD,GAAQ6lE,GAAa3yE,GAAOgxE,KACvF/mH,IAAAA,CAAKgqH,uBAAAA,CAAwBh/F,GAAAA,CAAIk4E,GAAAA,CAAW;wBAC5C;oBACF,KAAK;oBACL,KAAK;oBACL,KAAK;wBACHljG,IAAAA,CAAK+kG,gBAAAA,CAAiBplG,IAAAA,CAAK,IAAI6oH,GAAa,QAAQtlB,GAAWrgD,GAAQ6lE,GAAa3yE,GAAOgxE;wBAC3F;oBACF,KAAK;oBACL,KAAK;wBACH/mH,IAAAA,CAAKilG,kBAAAA,CAAmBtlG,IAAAA,CAAK,IAAI6oH,GAAa,UAAUtlB,GAAWrgD,GAAQ6lE,GAAa3yE,GAAOgxE;gBAAAA;YAIvG;YAEQ,aAAaA,CAAAA,EAAAA;gBACnB,IAAA,CAAK/mH,IAAAA,CAAKujH,QAAAA,EACR;gBAIAvjH,CAAAA,IAAAA,CAAKia,MAAAA,CAAO+wG,wBAAAA,KAA6BC,GAAqB/+C,GAAAA,IAC7DlsE,IAAAA,CAAKia,MAAAA,CAAO+wG,wBAAAA,KAA6BC,GAAqBnuD,MAAAA,IAAUiqD,EAAG1lG,MAAAA,KAAWrhB,IAAAA,CAAKia,MAAAA,CAAOX,MAAAA,AAAAA,KAEnGytG,EAAGyE,cAAAA;gBAEL,MAAMx3G,IAAShU,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAOukD,uBAAAA,CAAwB7pD,EAAIq4G,EAAGuB,KAAAA,EAAOvB,EAAGwB,KAAAA,IACrEzT,IAAQ90G,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+kD,wBAAAA,CAAyB/kD,IAQpDk4G,IAAAA,KAAsC,IAEtC18G,IAASu3G,EAAGv3G,MAAAA,IAAUu3G,EAAGoF,WAAAA,GAAcD,KAAkC,GACzEz8G,IACJs3G,EAAGt3G,MAAAA,IAAUs3G,EAAGqF,WAAAA,GAAcF,KAAkCnF,EAAGsF,UAAAA,GAAaH,KAAkCnF,EAAGuF,MAAAA,IAAU,GAC3HvD,IAAShC,EAAGgC,MAAAA,IAAU;gBAC5B,IAAIC,IAAYQ,GAAe57F,KAAAA;gBAE3Bm5F,EAAGiC,SAAAA,IACgB,CAAA,MAAjBjC,EAAGiC,SAAAA,GACLA,IAAYQ,GAAe+C,IAAAA,GACD,MAAjBxF,EAAGiC,SAAAA,IACZA,CAAAA,IAAYQ,GAAegD,IAAAA,AAAAA,CAAAA;gBAI/B,MAAMC,IAAK,IAAI7D,GAAW9T,EAAMxoG,CAAAA,EAAGwoG,EAAM1qG,CAAAA,EAAG28G,EAAGuB,KAAAA,EAAOvB,EAAGwB,KAAAA,EAAOv0G,EAAO1H,CAAAA,EAAG0H,EAAO5J,CAAAA,EAAG,GAAGoF,GAAQC,GAAQs5G,GAAQC,GAAWjC;gBAC1H/mH,IAAAA,CAAKklG,iBAAAA,CAAkBvlG,IAAAA,CAAK8sH;YAC9B;YASO,aAAahmH,CAAAA,EAAyCoU,CAAAA,EAAAA;gBAC3D,MAAM6xG,IAAO1sH,IAAAA,CAAKia,MAAAA,CAAOjG,MAAAA,CAAO+hD,sBAAAA,CAAuBl7C;gBAEnDrX,OAAOglH,YAAAA,GACTxoH,IAAAA,CAAKoqH,OAAAA,CACH,IAAI5mH,OAAOglH,YAAAA,CAAa,YAAY/hH,GAAM;oBACxCy8F,WAAW;oBACXypB,SAASD,EAAKpgH,CAAAA;oBACdsgH,SAASF,EAAKtiH,CAAAA;gBAAAA,MAKlBpK,IAAAA,CAAKoqH,OAAAA,CACH,IAAI5mH,OAAOqpH,UAAAA,CAAW,UAAUpmH,GAAM;oBACpCkmH,SAASD,EAAKpgH,CAAAA;oBACdsgH,SAASF,EAAKtiH,CAAAA;gBAAAA;gBAMpB,MAAM0iH,IAAgB9sH,IAAAA,CAAKia,MAAAA,CAAO4tF,YAAAA,CAAaiN,KAAAA,CAAMnyG,GAAAA,CAAIi9G;gBACzDkN,EAAc1Y,SAAAA,CAAUp0G,IAAAA,CAAKia,MAAAA,CAAO4tF,YAAAA,EAAc,IAClDilB,EAAcr/E,MAAAA,CAAO;YACvB;YAEQ,6BAA6BzjC,CAAAA,EAAAA;gBACnC,OAAQA;oBACN,KAAKy/G,GAAoBsD,QAAAA;wBACvB,OAAOrD,GAAcqD,QAAAA;oBACvB,KAAKtD,GAAoBr7G,IAAAA;wBACvB,OAAOs7G,GAAct7G,IAAAA;oBACvB,KAAKq7G,GAAoBuD,MAAAA;wBACvB,OAAOtD,GAAcsD,MAAAA;oBACvB,KAAKvD,GAAoBp7G,KAAAA;wBACvB,OAAOq7G,GAAcr7G,KAAAA;oBACvB,KAAKo7G,GAAoB/E,OAAAA;wBACvB,OAAOgF,GAAchF,OAAAA;oBACvB;wBACE,OAAOnkG,EAAKvW;gBAAAA;YAElB;YAEQ,qBAAqBA,CAAAA,EAAAA;gBAC3B,OAAQA;oBACN,KAAK;wBACH,OAAO2/G,GAAYiC,KAAAA;oBACrB,KAAK;wBACH,OAAOjC,GAAYoC,KAAAA;oBACrB,KAAK;wBACH,OAAOpC,GAAYsD,GAAAA;oBACrB;wBACE,OAAOtD,GAAYjF,OAAAA;gBAAAA;YAEzB;QAAA;QCrjBK,MAAMwI;YAQX,YAAYj0G,CAAAA,CAAAA;gBAPJ,IAAA,CAAAsqG,QAAAA,GAAAA,CAAW;gBAQjB,MAAA,EAAM,eAAE4J,CAAAA,EAAa,iBAAE1F,CAAAA,EAAe,QAAExtG,CAAAA,EAAAA,GAAWhB;gBACnDjZ,IAAAA,CAAKotH,QAAAA,GAAW,IAAI1G,IACpB1mH,IAAAA,CAAKwjG,QAAAA,GAAW,IAAIomB,GAAqBuD,GAAelzG,IACxDja,IAAAA,CAAK2nE,QAAAA,GAAW,IAAIq7C,IAEpBhjH,IAAAA,CAAKotH,QAAAA,CAAS9qB,IAAAA,CAAK;oBAAEmlB,iBAAAA;gBAAAA,IACrBznH,IAAAA,CAAKwjG,QAAAA,CAASlB,IAAAA,CAAK;oBAAEmlB,iBAAAA;gBAAAA,IACrBznH,IAAAA,CAAK2nE,QAAAA,CAAS26B,IAAAA,IACdtiG,IAAAA,CAAKqtH,WAAAA,GAAc,IAAIrH,GAAY;oBACjCoH,UAAUptH,IAAAA,CAAKotH,QAAAA;oBACf5pB,UAAUxjG,IAAAA,CAAKwjG,QAAAA;oBACf77B,UAAU3nE,IAAAA,CAAK2nE,QAAAA;gBAAAA;YAEnB;YAEA,IAAA,UAAIiM;gBACF,OAAO5zE,IAAAA,CAAKujH,QACd;YAAA;YAEA,cAAc3vC,CAAAA,EAAAA;gBACZ5zE,IAAAA,CAAKujH,QAAAA,GAAW3vC,GAChB5zE,IAAAA,CAAKotH,QAAAA,CAAS3J,aAAAA,CAAczjH,IAAAA,CAAKujH,QAAAA,GACjCvjH,IAAAA,CAAKwjG,QAAAA,CAASigB,aAAAA,CAAczjH,IAAAA,CAAKujH,QAAAA,GACjCvjH,IAAAA,CAAK2nE,QAAAA,CAAS87C,aAAAA,CAAczjH,IAAAA,CAAKujH,QAAAA;YACnC;YAEA,SAAA91E;gBACMztC,IAAAA,CAAKujH,QAAAA,IACPvjH,CAAAA,IAAAA,CAAKqtH,WAAAA,CAAYr0E,OAAAA,IACjBh5C,IAAAA,CAAKotH,QAAAA,CAAS3/E,MAAAA,IACdztC,IAAAA,CAAK2nE,QAAAA,CAASl6B,MAAAA,EAAAA;YAElB;YAEA,QAAAjmC;gBACExH,IAAAA,CAAKotH,QAAAA,CAAS5lH,KAAAA,IACdxH,IAAAA,CAAKwjG,QAAAA,CAASh8F,KAAAA;YAEhB;QAAA;QCjBK,MAAM8lH;QAAAA;QAiBN,MAAMC,KAAc;YACzBvoE,YAAY;YACZwoE,UAAU;YACVC,YAAY;YACZxoE,WAAW;YACXC,YAAY;YACZq3C,SAAS;YACTC,UAAU;YACVG,cAAc;YACdC,eAAe;YACf8wB,SAAS;QAAA;QAOJ,SAASC,GAAmBrhH,CAAAA;YAAAA,IAAAA,GAAAA;YACjC,OAAA,CAAA,CAASA,CAAAA,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,CAAAA,CAAwC,CAAA,SAAzB,CAAA,IAAY,SAAZ,CAAA,IAAAwJ,QAAAA,IAAAA,KAAC,IAADA,EAAGxJ,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE6D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE8nB,IAAAA,AAAAA;QACxD;QASO,MAAMm/F;YA8BX,IAAA,SAAWpc;gBACT,OAAOxxG,IAAAA,CAAK80G,KAAAA,CAAMR,aAAAA,CAAcjE,QAAAA,CAASroG,MAAAA,CAAQsX,CAAAA,IACxCA,aAAakqE;YAExB;YAKA,IAAA,WAAW6mB;gBACT,OAAOrwG,IAAAA,CAAK80G,KAAAA,CAAMR,aAAAA,CAAcjE,QAClC;YAAA;YAKA,IAAA,WAAWwd;gBACT,OAAO7tH,IAAAA,CAAK80G,KAAAA,CAAMR,aAAAA,CAAcjE,QAAAA,CAASroG,MAAAA,CAAQsX,CAAAA,IACxCA,aAAakwF;YAExB;YAKA,IAAA,WAAWse;gBACT,OAAO9tH,IAAAA,CAAK80G,KAAAA,CAAMR,aAAAA,CAAcjE,QAAAA,CAASroG,MAAAA,CAAQsX,CAAAA,IACxCA,aAAa8lF;YAExB;YAcA,IAAA,SAAW2oB;gBACT,OAAO/tH,IAAAA,CAAKguH,OACd;YAAA;YAGA,aAAArnH;gBA7EQ,IAAA,CAAAkmB,OAAAA,GAAkBjW,EAAOS,WAAAA,IAC1B,IAAA,CAAA6C,MAAAA,GAAS,IAAIhT,GAKb,IAAA,CAAA0vD,MAAAA,GAAiB,IAAI80C,IAUrB,IAAA,CAAAoJ,KAAAA,GAAe,IAAI3hE,GAAMnzC,IAAAA,GAQzB,IAAA,CAAA4xE,OAAAA,GAAU,IAAIkxC,GAAanvC,OA8C1B,IAAA,CAAAztB,cAAAA,GAAAA,CAA0B,GAC1B,IAAA,CAAA8nE,OAAAA,GAAmB,EAAA,EAInB,IAAA,CAAAC,YAAAA,GAAwB,EAAA,EAM9BjuH,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAIowG,KACfxgH,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAI,IAAIykG,GAAa70G,IAAAA,CAAK80G,KAAAA,EAAO90G,IAAAA,CAAK4xE,OAAAA,IACjD5xE,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAI,IAAI4nG,GAAgBh4G,IAAAA,CAAK80G,KAAAA,EAAO90G,IAAAA,CAAK4xE,OAAAA,IACpD5xE,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAIwvG,KACf5/G,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAIwwG,KAEf5gH,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAI0wG,KACf9gH,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAIypG,KACf75G,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAI+qG;YACjB;YAIO,KAAwDzzG,CAAAA,EAAuBU,CAAAA,EAAAA;gBACpFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAsDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBAClF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAuDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YAQO,UAAUwmH,CAAAA,EAAAA,CAEjB;YAcO,aAAa9yG,CAAAA,EAAAA,CAGpB;YAMO,aAAapB,CAAAA,EAAAA,CAEpB;YAMO,WAAWoqB,CAAAA,EAAAA,CAElB;YAMO,aAAaA,CAAAA,EAAAA,CAEpB;YASO,YAAYpqB,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEnC;YASO,aAAa78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEpC;YAQO,UAAU1f,CAAAA,EAA+B0f,CAAAA,EAAAA,CAEhD;YAQO,WAAW1f,CAAAA,EAA+B0f,CAAAA,EAAAA,CAEjD;YAKQ,sBAAAy3E;gBACN,KAAK,MAAMx7E,KAAS/yC,IAAAA,CAAKqwG,QAAAA,CACvBt9D,EAAM5F,WAAAA,CAAYntC,IAAAA,CAAKia,MAAAA;YAE3B;YAKA,IAAA,gBAAW6uC;gBACT,OAAO9oD,IAAAA,CAAKkmD,cACd;YAAA;YASO,MAAA,YAAkBjsC,CAAAA,EAAAA;gBAAAA,IAAAA;gBACvB,IAAA,CAAKja,IAAAA,CAAK8oD,aAAAA,EAAe;oBACvB,IAAA;wBACE9oD,IAAAA,CAAKia,MAAAA,GAASA,GAEdja,IAAAA,CAAK4xE,OAAAA,CAAQsZ,MAAAA,GAASlrF,IAAAA,CAAKia,MAAAA,CAAO23D,OAAAA,EAClC5xE,IAAAA,CAAK0nE,KAAAA,GAAQ,IAAIwlD,GAAU;4BACzBC,eAAelzG,EAAOu0G,YAAAA,KAAiBnrH,EAAay5D,MAAAA,GAAS7iD,EAAOX,MAAAA,GAASC;4BAC7EkuG,iBAAiBxtG,EAAOwtG,eAAAA;4BACxBxtG,QAAAA;wBAAAA,IAGFja,IAAAA,CAAK42D,MAAAA,CAAOzpB,WAAAA,CAAYlzB,IAExBja,IAAAA,CAAK80G,KAAAA,CAAMP,aAAAA,CAAc3xE,UAAAA,IAAAA,MAInB5iC,IAAAA,CAAKgpD,YAAAA,CAAa/uC,IACxBja,IAAAA,CAAKuuH,mBAAAA,IAELvuH,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,sBAAsBhY,IAAAA,EAAMia,IAC/Cja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIy7C,GAAgB3pC,GAAQja,IAAAA;oBAC7D,EAAE,OAAOsf,GAAAA;wBAEP,MADAtf,IAAAA,CAAK6sB,OAAAA,CAAQ5lB,KAAAA,CAAM,CAAA,4CAAA,EAA8D,SAAf,CAAA,IAAAgT,EAAOw0G,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEC,YAAAA,CAAa1uH,IAAAA,EAAAA,CAAAA,CAAAA,GAC1Fsf;oBACR;oBACAtf,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB;gBACxB;YACF;YAQO,MAAA,UAAgB7hB,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBACrB,IAAA;oBACErkC,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,oBAAoBhY,IAAAA,GACvCA,IAAAA,CAAK0nE,KAAAA,CAAM+7C,aAAAA,CAAAA,CAAc,IAAA,MACnBzjH,IAAAA,CAAKquH,UAAAA,CAAWhqF;gBACxB,EAAE,OAAO/kB,GAAAA;oBAEP,MADAtf,IAAAA,CAAK6sB,OAAAA,CAAQ5lB,KAAAA,CAAM,CAAA,wCAAA,EAAgE,SAArB,CAAA,IAAW,SAAX,CAAA,IAAAjH,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEw0G,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEC,YAAAA,CAAa1uH,IAAAA,EAAAA,CAAAA,CAAAA,GAC5Fsf;gBACR;YACF;YAQO,MAAA,YAAkB+kB,CAAAA,EAAAA;gBACvBrkC,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,sBAAsBhY,IAAAA,GACzCA,IAAAA,CAAK0nE,KAAAA,CAAM+7C,aAAAA,CAAAA,CAAc,IAAA,MACnBzjH,IAAAA,CAAKsuH,YAAAA,CAAajqF;YAC1B;YAQO,WAAWpqB,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAChC92C,IAAAA,CAAKmI,IAAAA,CAAK,aAAa,IAAIg6C,GAAeloC,GAAQ68B,GAAS92C,IAAAA,IAC3DA,IAAAA,CAAKopD,WAAAA,CAAYnvC,GAAQ68B;YAC3B;YAQO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBACjC92C,IAAAA,CAAKmI,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBnoC,GAAQ68B,GAAS92C,IAAAA,IAC7DA,IAAAA,CAAKspD,YAAAA,CAAarvC,GAAQ68B;YAC5B;YAQO,SAAS1f,CAAAA,EAA+B0f,CAAAA,EAAAA;gBAC7C92C,IAAAA,CAAKmI,IAAAA,CAAK,WAAW,IAAI05C,GAAazqB,GAAK0f,GAAS92C,IAAAA,IACpDA,IAAAA,CAAKmgD,SAAAA,CAAU/oB,GAAK0f;YACtB;YAQO,UAAU1f,CAAAA,EAA+B0f,CAAAA,EAAAA;gBAC9C92C,IAAAA,CAAKmI,IAAAA,CAAK,YAAY,IAAI25C,GAAc1qB,GAAK0f,GAAS92C,IAAAA,IACtDA,IAAAA,CAAKogD,UAAAA,CAAWhpB,GAAK0f;YACvB;YAOO,OAAO78B,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC5B,IAAA,CAAK92C,IAAAA,CAAK8oD,aAAAA,EAER,OAAA,KADA9oD,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS,CAAA,gDAAA,EAAkE,SAAf,CAAA,IAAA0B,EAAOw0G,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEC,YAAAA,CAAa1uH,IAAAA,EAAAA,CAAAA,CAAAA;gBAMzG,IAAIQ,GAAWmX;gBAEf,IALA3X,IAAAA,CAAKmpD,UAAAA,CAAWlvC,GAAQ68B,IAKnBt2C,IAAI,GAAGmX,IAAM3X,IAAAA,CAAKiuH,YAAAA,CAAa3tH,MAAAA,EAAQE,IAAImX,GAAKnX,IACnDR,IAAAA,CAAK+uH,WAAAA,CAAY/uH,IAAAA,CAAKiuH,YAAAA,CAAaztH,EAAAA;gBAErCR,IAAAA,CAAKiuH,YAAAA,CAAa3tH,MAAAA,GAAS;gBAG3B,KAAK,MAAM0uH,KAAShvH,IAAAA,CAAKguH,OAAAA,CACvBgB,EAAMvhF,MAAAA,CAAOqJ;gBAGf92C,IAAAA,CAAK80G,KAAAA,CAAMrnE,MAAAA,CAAOwiE,GAAWwE,MAAAA,EAAQ39D,IAGjC92C,IAAAA,CAAK42D,MAAAA,IACP52D,IAAAA,CAAK42D,MAAAA,CAAOnpB,MAAAA,CAAOxzB,GAAQ68B,IAG7B92C,IAAAA,CAAKivH,kBAAAA,CAAmBh1G,IAExBja,IAAAA,CAAKqpD,WAAAA,CAAYpvC,GAAQ68B,IAEzB92C,IAAAA,CAAK0nE,KAAAA,CAAMj6B,MAAAA;YACb;YAOO,KAAKrW,CAAAA,EAA+B0f,CAAAA,EAAAA;gBAAAA,IAAAA;gBACpC92C,IAAAA,CAAK8oD,aAAAA,GAIV9oD,CAAAA,IAAAA,CAAK6uH,QAAAA,CAASz3F,GAAK0f,IAEnB92C,IAAAA,CAAK80G,KAAAA,CAAMrnE,MAAAA,CAAOwiE,GAAW+J,IAAAA,EAAMljE,IAAAA,AAEpB,CAAA,SAAX,CAAA,IAAA92C,IAAAA,CAAKia,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAE4gG,OAAAA,AAAAA,KACf76G,IAAAA,CAAK47G,SAAAA,CAAUxkF,IAEjBp3B,IAAAA,CAAK8uH,SAAAA,CAAU13F,GAAK0f,EAAAA,IAVlB92C,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CAAS;YAW1B;YAOO,UAAU6e,CAAAA,EAAAA;gBACfp3B,IAAAA,CAAKmI,IAAAA,CAAK,gBAAgB,IAAI85C,GAAkB7qB,GAAKp3B,IAAAA,IAErDA,IAAAA,CAAKmI,IAAAA,CAAK,iBAAiB,IAAI+5C,GAAmB9qB,GAAKp3B,IAAAA;YACzD;YAKO,SAASi3F,CAAAA,EAAAA;gBACd,OAAOj3F,IAAAA,CAAKwxG,MAAAA,CAAO/oG,OAAAA,CAAQwuF,KAAAA;YAC7B;YAoCO,IAAI/yC,CAAAA,EAAAA;gBACTlkD,IAAAA,CAAKmI,IAAAA,CAAK,eAAe;oBAAEkZ,QAAQ6iC;gBAAAA,IAC/BA,aAAkBq8C,KACf,EAAcvgG,IAAAA,CAAKguH,OAAAA,EAAS9pE,MAC/BlkD,IAAAA,CAAKkvH,QAAAA,CAAShrE,KAIlBlkD,CAAAA,IAAAA,CAAK80G,KAAAA,CAAM1kG,GAAAA,CAAI8zC,IACfA,EAAO8B,KAAAA,GAAQhmD,IAAAA,AAAAA;YACjB;YA+DO,SAASkkD,CAAAA,EAAAA;gBACd,IAAI8B;gBACA9B,aAAkBkB,MAAUlB,EAAO8B,KAAAA,IAAS9B,EAAO8B,KAAAA,KAAUhmD,IAAAA,IAC/DgmD,CAAAA,IAAQ9B,EAAO8B,KAAAA,EACf9B,EAAO8B,KAAAA,CAAM8uD,KAAAA,CAAM/zD,MAAAA,CAAOmD,GAAAA,CAAQ,EAAA,GAEhCA,aAAkBq8C,MAASr8C,EAAO8B,KAAAA,IACpCA,CAAAA,IAAQ9B,EAAO8B,KAAAA,EACf9B,EAAO8B,KAAAA,CAAM+oE,WAAAA,CAAY7qE,EAAAA,GAG3B8B,QAAAA,KAAAA,EAAO79C,IAAAA,CAAK,iBAAiB;oBAAEkZ,QAAQ6iC;gBAAAA,IACvClkD,IAAAA,CAAKoQ,GAAAA,CAAI8zC;YACX;YA2BO,OAAOA,CAAAA,EAAAA;gBACZlkD,IAAAA,CAAKmI,IAAAA,CAAK,iBAAiB;oBAAEkZ,QAAQ6iC;gBAAAA,IACjCA,aAAkBkB,MAChBlB,CAAAA,EAAO+B,QAAAA,IACT/B,EAAOsC,IAAAA,IAETxmD,IAAAA,CAAK80G,KAAAA,CAAM/zD,MAAAA,CAAOmD,EAAAA,GAEhBA,aAAkBq8C,MACpBvgG,IAAAA,CAAK+uH,WAAAA,CAAY7qE;YAErB;YAQO,MAAMnG,IAAAA,CAAoB,CAAA,EAAA;gBAC/B,IAAK,IAAIv9C,IAAIR,IAAAA,CAAKqwG,QAAAA,CAAS/vG,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAC7CR,IAAAA,CAAK80G,KAAAA,CAAM/zD,MAAAA,CAAO/gD,IAAAA,CAAKqwG,QAAAA,CAAS7vG,EAAAA,EAAIu9C;gBAEtC,IAAK,IAAIv9C,IAAIR,IAAAA,CAAK+tH,MAAAA,CAAOztH,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAC3CR,IAAAA,CAAK+uH,WAAAA,CAAY/uH,IAAAA,CAAK+tH,MAAAA,CAAOvtH,EAAAA;YAEjC;YAMO,SAASwuH,CAAAA,EAAAA;gBAGd,OAFAhvH,IAAAA,CAAKguH,OAAAA,CAAQruH,IAAAA,CAAKqvH,IAClBA,EAAMhpE,KAAAA,GAAQhmD,IAAAA,EACPgvH;YACT;YAOO,YAAYA,CAAAA,EAAAA;gBACjB,MAAMxuH,IAAIR,IAAAA,CAAKguH,OAAAA,CAAQvlH,OAAAA,CAAQumH;gBAI/B,OAAA,OAHIxuH,KACFR,IAAAA,CAAKguH,OAAAA,CAAQtlH,MAAAA,CAAOlI,GAAG,IAElBwuH;YACT;YAMO,YAAYA,CAAAA,EAAAA;gBAEjB,OADAhvH,IAAAA,CAAKiuH,YAAAA,CAAatuH,IAAAA,CAAKqvH,IAChBA;YACT;YAKO,cAAcA,CAAAA,EAAAA;gBACnB,OAAOhvH,IAAAA,CAAKguH,OAAAA,CAAQvlH,OAAAA,CAAQumH,KAAAA,MAAU,CAAMA,EAAM1rD,QACpD;YAAA;YAEO,iBAAA+rD;gBACL,OAAA,CAAA,CAAIrvH,IAAAA,CAAKia,MAAAA,IACAja,IAAAA,CAAKia,MAAAA,CAAO4tF,YAAAA,KAAiB7nG,IAGxC;YAAA;YAEQ,mBAAmBia,CAAAA,EAAAA;gBACzB,MAAMu3F,IAASxxG,IAAAA,CAAKwxG,MAAAA;gBACpB,IAAK,IAAIhxG,IAAI,GAAGA,IAAIgxG,EAAOlxG,MAAAA,EAAQE,IAAK;oBACtC,MAAMy2F,IAAQua,CAAAA,CAAOhxG,EAAAA;oBACjBy2F,aAAiBmJ,MACnBnmF,EAAOuoC,KAAAA,CAAM+uD,SAAAA,CAAUC,MAAAA,CAAO8d,EAAAA,IAEhCr1G,EAAOuoC,KAAAA,CAAM+uD,SAAAA,CAAUC,MAAAA,CAAO+d,KAAAA;oBAC9B,IAAK,IAAI79C,IAAI,GAAGA,IAAIulB,EAAMpmD,QAAAA,CAASvwC,MAAAA,EAAQoxE,IAErCyuB,GADUlJ,EAAMpmD,QAAAA,CAAS6gC,EAAAA,IAG3Bz3D,EAAOuoC,KAAAA,CAAM+uD,SAAAA,CAAUC,MAAAA,CAAO8d,EAAAA,KAE9Br1G,EAAOuoC,KAAAA,CAAM+uD,SAAAA,CAAUC,MAAAA,CAAO+d,KAAAA;gBAGpC;YACF;QAAA;QCruBF,IAAYC;QAAAA,CAAZ,SAAYA,CAAAA;YACV,EAAA,SAAA,GAAA,aACA,EAAA,WAAA,GAAA,eACA,EAAA,SAAA,GAAA;QACD,EAJWA,MAAAA,CAAAA,KAAkB,CAAA,CAAA;QCWvB,MAAMC;YAIX,YAAYthG,CAAAA,EAA4B4O,CAAAA,CAAAA;gBAStC/8B,IAAAA,CAAK2iC,OAAAA,GAAU,IAAIlG,GAAO;oBACxBtO,IAAAA;oBACA2O,cAAc;oBAYdC,gBAAgBA;gBAAAA,IAElB/8B,IAAAA,CAAK2iC,OAAAA,CAAQlF,OAAAA,IAEbz9B,IAAAA,CAAKmlC,OAAAA,GAAU,IAAI9D,GAAa;oBAC9BlT,IAAAA;oBACA1nB,MAAM;oBAENhF,MAAM,IAAIkgB,aAAa;wBAAA;wBACpB;wBAAO;wBAAG;wBAAA;wBAAO;wBAAG;wBAAG;wBAAG;wBAAA;wBAAO;wBAAG;wBAErC;wBAAA;wBAAO;wBAAG;wBAAA;wBAAO;wBAAG;wBAAG;wBAAG;wBAAG;wBAAG;wBAAG;qBAAA;gBAAA,IAGvC3hB,IAAAA,CAAKuiC,OAAAA,GAAU,IAAIL,GAAa;oBAC9B/T,IAAAA;oBACA+N,QAAQl8B,IAAAA,CAAK2iC,OAAAA;oBACbR,cAAcniC,IAAAA,CAAKmlC,OAAAA;oBACnBtI,YAAY;wBACV;4BAAC;4BAAc;yBAAA;wBACf;4BAAC;4BAAQ;yBAAA;qBAAA;gBAAA,IAGb78B,IAAAA,CAAKmlC,OAAAA,CAAQrD,MAAAA;YACf;YAEO,YAAA6D;gBACL,OAAO3lC,IAAAA,CAAK2iC,OACd;YAAA;YACO,YAAAiD;gBACL,OAAO5lC,IAAAA,CAAKuiC,OACd;YAAA;QAAA;QC9DK,MAAMmtF;YAGX,YACUC,CAAAA,EACRC,IAAAA,CAAW,CAAA,CAAA;gBADH,IAAA,CAAAD,mBAAAA,GAAAA,GAFF,IAAA,CAAAE,SAAAA,GAAAA,CAAY,GAKlB7vH,IAAAA,CAAK6vH,SAAAA,GAAYD;YACnB;YAEA,WAAWzhG,CAAAA,EAAAA;gBACTnuB,IAAAA,CAAK2iC,OAAAA,GAAU,IAAI8sF,GAAathG,GClBpC,g9DDmBInuB,IAAAA,CAAK4vH,QAAAA,GAAW5vH,IAAAA,CAAK6vH,SAAAA,EACrB7vH,IAAAA,CAAK8vH,kBAAAA,GAAqB9vH,IAAAA,CAAK2vH,mBACjC;YAAA;YAEA,YAAAhqF;gBACE,OAAO3lC,IAAAA,CAAK2iC,OAAAA,CAAQgD,SAAAA;YACtB;YAEA,YAAAC;gBACE,OAAO5lC,IAAAA,CAAK2iC,OAAAA,CAAQiD,SAAAA;YACtB;YAEA,IAAA,mBAAuBmqF,CAAAA,EAAAA;gBAErB,IADA/vH,IAAAA,CAAK2vH,mBAAAA,GAAsBI,GACvB/vH,IAAAA,CAAK2iC,OAAAA,EAAS;oBAChB,MAAMzG,IAASl8B,IAAAA,CAAK2iC,OAAAA,CAAQgD,SAAAA;oBAC5BzJ,EAAO3E,GAAAA,IACHv3B,IAAAA,CAAK2vH,mBAAAA,KAAwBH,GAAmBQ,SAAAA,GAClD9zF,EAAOiD,aAAAA,CAAc,UAAU,KACtBn/B,IAAAA,CAAK2vH,mBAAAA,KAAwBH,GAAmBS,WAAAA,GACzD/zF,EAAOiD,aAAAA,CAAc,UAAU,KACtBn/B,IAAAA,CAAK2vH,mBAAAA,KAAwBH,GAAmBU,SAAAA,IACzDh0F,EAAOiD,aAAAA,CAAc,UAAU;gBAEnC;YACF;YAEA,IAAA,qBAAI2wF;gBACF,OAAO9vH,IAAAA,CAAK2vH,mBACd;YAAA;YAEA,IAAA,SAAavsH,CAAAA,EAAAA;gBAEX,IADApD,IAAAA,CAAK6vH,SAAAA,GAAYzsH,GACbpD,IAAAA,CAAK2iC,OAAAA,EAAS;oBAChB,MAAMzG,IAASl8B,IAAAA,CAAK2iC,OAAAA,CAAQgD,SAAAA;oBAC5BzJ,EAAO3E,GAAAA,IACP2E,EAAOuD,iBAAAA,CAAkB,cAAcr8B;gBACzC;YACF;YAEA,IAAA,WAAIwsH;gBACF,OAAO5vH,IAAAA,CAAK6vH,SACd;YAAA;QAAA;QExDK,MAAMM;YAIX,YAAYl2G,CAAAA,CAAAA;gBACVja,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GACfja,IAAAA,CAAKowH,wBAAAA,GAA2B,IAAIV,GAA4BF,GAAmBQ,SAAAA;YACrF;YAMO,QAAQM,CAAAA,EAAAA;gBACTtwH,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,YAA2BK,MAC1CjtC,CAAAA,IAAAA,CAAKwH,KAAAA,IACLxH,IAAAA,CAAKowH,wBAAAA,CAAyBN,kBAAAA,GAAqBQ,GACnDtwH,IAAAA,CAAKowH,wBAAAA,CAAyBR,QAAAA,GAAAA,CAAW,GACzC5vH,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,CAAgBokB,gBAAAA,CAAiBhxD,IAAAA,CAAKowH,wBAAAA,CAAAA;YAEvD;YAMO,SAASE,CAAAA,EAAAA;gBACVtwH,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,YAA2BK,MAC1CjtC,CAAAA,IAAAA,CAAKwH,KAAAA,IACLxH,IAAAA,CAAKowH,wBAAAA,CAAyBN,kBAAAA,GAAqBQ,GACnDtwH,IAAAA,CAAKowH,wBAAAA,CAAyBR,QAAAA,GAAAA,CAAW,GACzC5vH,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,CAAgBokB,gBAAAA,CAAiBhxD,IAAAA,CAAKowH,wBAAAA,CAAAA;YAEvD;YAKO,QAAA5oH;gBACLxH,IAAAA,CAAK2iE,OAAAA,CAAQ/1B,eAAAA,CAAgBqkB,mBAAAA,CAAoBjxD,IAAAA,CAAKowH,wBAAAA;YACxD;QAAA;QC+GK,MAAMG;YAGX,YAAYt2G,CAAAA,CAAAA;gBAgDL,IAAA,CAAAuoC,KAAAA,GAAoB;oBAKzB+uD,WAAW,IAAIif;oBAMfC,WAAW,IAAID;gBAAAA,GAYV,IAAA,CAAAxoH,MAAAA,GAAmE;oBAIxE+zG,WAAAA,CAAW;oBAIXE,WAAW;oBAIXD,KAAK,EAAA;gBAAA,GAMA,IAAA,CAAA93D,MAAAA,GAAS;oBACdskD,SAAAA,CAAS;oBACTiU,QAAAA,CAAQ;oBACRC,UAAAA,CAAU;gBAAA,GAML,IAAA,CAAA3/F,SAAAA,GAAY;oBACjByrF,SAAAA,CAAS;oBAET4T,aAAa;oBACbC,cAAAA,CAAc;oBACdE,mBAAAA,CAAmB;oBACnBD,eAAelqG,EAAM8C,MAAAA;oBAErBsnG,YAAAA,CAAY;oBAEZK,WAAAA,CAAW;oBACXC,YAAY1qG,EAAM4D,KAAAA;oBAElB2mG,cAAAA,CAAc;oBACdC,eAAexqG,EAAMuD,IAAAA;gBAAAA,GAMhB,IAAA,CAAAmqC,QAAAA,GAAW;oBAChB0oD,SAAAA,CAAS;oBAETsS,YAAAA,CAAY;oBACZC,aAAa3oG,EAAM8C,MAAAA;gBAAAA,GAMd,IAAA,CAAA43D,QAAAA,GAAW;oBAChB07B,SAAAA,CAAS;oBAETsS,YAAAA,CAAY;oBACZC,aAAa3oG,EAAMuD,IAAAA;oBAEnB8nG,WAAAA,CAAW;oBAEXD,cAAAA,CAAc;oBACdtU,eAAe92F,EAAM4D,KAAAA;oBACrBmzF,mBAAmB;oBACnBC,mBAAmB;gBAAA,GAMd,IAAA,CAAAx3B,OAAAA,GAAU;oBACf42B,SAAAA,CAAS;oBAETmV,mCAAAA,CAAmC;oBAEnCE,sBAAAA,CAAsB;oBACtBG,sBAAsB5rG,EAAMyD,IAAAA;oBAE5B+nG,uBAAAA,CAAuB;oBACvBE,aAAa;oBACbC,uBAAuB3rG,EAAMgD,GAAAA;gBAAAA,GAMxB,IAAA,CAAA40C,MAAAA,GAAS;oBACdw+C,SAAAA,CAAS;oBAET4U,cAAAA,CAAc;oBACdC,eAAejrG,EAAM8C,MAAAA;oBAErBooG,kBAAAA,CAAkB;oBAClBC,mBAAmBnrG,EAAMgD,GAAAA;gBAAAA,GAMpB,IAAA,CAAA0E,IAAAA,GAAO;oBACZ0uF,SAAAA,CAAS;oBAETuU,oBAAAA,CAAoB;oBACpBC,mBAAAA,CAAmB;oBACnBG,cAAAA,CAAc;oBACdD,YAAAA,CAAY;oBACZD,UAAAA,CAAU;gBAAA,GAML,IAAA,CAAArmD,MAAAA,GAAS;oBACd4xC,SAAAA,CAAS;oBAETyV,WAAAA,CAAW;oBACXC,YAAY9rG,EAAMgD,GAAAA;oBAElB+oG,UAAAA,CAAU;gBAAA,GAGL,IAAA,CAAAlV,OAAAA,GAAU;oBACfT,SAAAA,CAAS;oBAETC,UAAAA,CAAU;oBACVC,WAAWt2F,EAAMgD,GAAAA;oBACjBuzF,WAAW;oBACXC,iBAAAA,CAAiB;oBACjBE,kBAAkB12F,EAAMS,OAAAA,CAAQ;oBAChCm2F,sBAAAA,CAAsB;gBAAA,GAGjB,IAAA,CAAA0nB,SAAAA,GAAY;oBACjBloB,SAAAA,CAAS;oBACT6T,cAAAA,CAAc;oBACdC,eAAelqG,EAAM8C,MAAAA;oBACrBy7G,cAAc;oBACdloB,UAAAA,CAAU;oBACVC,WAAWt2F,EAAMgD,GAAAA;oBACjBuzF,WAAW;oBACXK,sBAAAA,CAAsB;gBAAA,GAtNtBhpG,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GAEfja,IAAAA,CAAK+vH,cAAAA,GAAiB,IAAII,GAAgBnwH,IAAAA,CAAK2iE,OAAAA;YACjD;YAQO,eAAAiuD;gBACL,MAAMlwG,IAAQ1gB,IAAAA,CAAK2iE,OAAAA,CAAQjiD,KAAAA,EACrBmwG,IAAanwG,EAAMkhF,SAAAA;gBACzBlhF,EAAMu/C,IAAAA;gBAEN,MAAM6wD,IAAYpwG,EAAMqwG,WAAAA;gBAKxB,OAJIF,KACFC,EAAU9rH,KAAAA,IAEZhF,IAAAA,CAAK2iE,OAAAA,CAAQjiD,KAAAA,GAAQowG,GACdA;YACT;YASO,mBAAAE;gBACL,MAAMC,IAAejxH,IAAAA,CAAK2iE,OAAAA,CAAQjiD,KAAAA,EAC5BmwG,IAAaI,EAAarvB,SAAAA;gBAChCqvB,EAAahxD,IAAAA;gBAEb,MAAMixD,IAAgBD,EAAaE,eAAAA;gBAKnC,OAJIN,KACFK,EAAclsH,KAAAA,IAEhBhF,IAAAA,CAAK2iE,OAAAA,CAAQjiD,KAAAA,GAAQwwG,GACdA;YACT;QAAA;QAoLK,MAAMV;YAAb,aAAA;gBACU,IAAA,CAAAY,GAAAA,GAAc,GACd,IAAA,CAAAC,UAAAA,GAAqB,GACrB,IAAA,CAAAC,IAAAA,GAAe,GACf,IAAA,CAAAC,WAAAA,GAA+B;oBACrChC,OAAO;oBACP9d,QAAQ;oBACR6d,IAAI;oBACJ,IAAA,aAAIkC;wBACF,OAAOxxH,IAAAA,CAAKuvH,KAAAA,GAAQvvH,IAAAA,CAAKyxG,MAC3B;oBAAA;oBACA,IAAA,SAAI3sC;wBACF,OAAO9kE,IAAAA,CAAKwxH,SAAAA,GAAYxxH,IAAAA,CAAKsvH,EAC/B;oBAAA;gBAAA,GAEM,IAAA,CAAAmC,cAAAA,GAAqC;oBAC3ChkF,QAAQ;oBACR5tB,MAAM;oBACN,IAAA,SAAIilD;wBACF,OAAO9kE,IAAAA,CAAKytC,MAAAA,GAASztC,IAAAA,CAAK6f,IAC5B;oBAAA;gBAAA,GAGM,IAAA,CAAA6xG,aAAAA,GAA8B,IAAIC,IAElC,IAAA,CAAAC,cAAAA,GAAqC;oBAC3CC,WAAW;oBACXC,aAAa;gBAAA;YA+GjB;YAxGS,MAAMC,CAAAA,EAAAA;gBACPA,IACF/xH,CAAAA,IAAAA,CAAKJ,EAAAA,GAAKmyH,EAAWnyH,EAAAA,EACrBI,IAAAA,CAAKgyH,SAAAA,GAAYD,EAAWC,SAAAA,EAC5BhyH,IAAAA,CAAKiyH,GAAAA,GAAMF,EAAWE,GAAAA,EACtBjyH,IAAAA,CAAKwxG,MAAAA,CAAO+d,KAAAA,GAAQwC,EAAWvgB,MAAAA,CAAO+d,KAAAA,EACtCvvH,IAAAA,CAAKwxG,MAAAA,CAAOC,MAAAA,GAASsgB,EAAWvgB,MAAAA,CAAOC,MAAAA,EACvCzxG,IAAAA,CAAKwxG,MAAAA,CAAO8d,EAAAA,GAAKyC,EAAWvgB,MAAAA,CAAO8d,EAAAA,EACnCtvH,IAAAA,CAAK01C,QAAAA,CAASjI,MAAAA,GAASskF,EAAWr8E,QAAAA,CAASjI,MAAAA,EAC3CztC,IAAAA,CAAK01C,QAAAA,CAAS71B,IAAAA,GAAOkyG,EAAWr8E,QAAAA,CAAS71B,IAAAA,EACzC7f,IAAAA,CAAK0xH,aAAAA,CAAc/1G,KAAAA,CAAMo2G,EAAWngD,OAAAA,GACpC5xE,IAAAA,CAAK8/C,QAAAA,CAAS+xE,SAAAA,GAAYE,EAAWjyE,QAAAA,CAAS+xE,SAAAA,EAC9C7xH,IAAAA,CAAK8/C,QAAAA,CAASgyE,WAAAA,GAAcC,EAAWjyE,QAAAA,CAASgyE,WAAAA,AAAAA,IAEhD9xH,CAAAA,IAAAA,CAAKJ,EAAAA,GAAKI,IAAAA,CAAKgyH,SAAAA,GAAYhyH,IAAAA,CAAKiyH,GAAAA,GAAM,GACtCjyH,IAAAA,CAAKwxG,MAAAA,CAAO+d,KAAAA,GAAQvvH,IAAAA,CAAKwxG,MAAAA,CAAOC,MAAAA,GAASzxG,IAAAA,CAAKwxG,MAAAA,CAAO8d,EAAAA,GAAK,GAC1DtvH,IAAAA,CAAK01C,QAAAA,CAASjI,MAAAA,GAASztC,IAAAA,CAAK01C,QAAAA,CAAS71B,IAAAA,GAAO,GAC5C7f,IAAAA,CAAK0xH,aAAAA,CAAc/1G,KAAAA,IACnB3b,IAAAA,CAAK8/C,QAAAA,CAASgyE,WAAAA,GAAc9xH,IAAAA,CAAK8/C,QAAAA,CAAS+xE,SAAAA,GAAY,CAAA;YAE1D;YAKO,QAAA5/G;gBACL,MAAMigH,IAAK,IAAI1B;gBAIf,OAFA0B,EAAGv2G,KAAAA,CAAM3b,IAAAA,GAEFkyH;YACT;YAKA,IAAA,KAAWtyH;gBACT,OAAOI,IAAAA,CAAKoxH,GACd;YAAA;YAKA,IAAA,GAAchuH,CAAAA,EAAAA;gBACZpD,IAAAA,CAAKoxH,GAAAA,GAAMhuH;YACb;YAKA,IAAA,YAAW4uH;gBACT,OAAOhyH,IAAAA,CAAKqxH,UACd;YAAA;YAMA,IAAA,UAAqBjuH,CAAAA,EAAAA;gBACnBpD,IAAAA,CAAKqxH,UAAAA,GAAajuH;YACpB;YAKA,IAAA,MAAW6uH;gBACT,OAAOjyH,IAAAA,CAAKsxH,IACd;YAAA;YAMA,IAAA,IAAeluH,CAAAA,EAAAA;gBACbpD,IAAAA,CAAKsxH,IAAAA,GAAOluH;YACd;YAKA,IAAA,SAAWouG;gBACT,OAAOxxG,IAAAA,CAAKuxH,WACd;YAAA;YAKA,IAAA,WAAW77E;gBACT,OAAO11C,IAAAA,CAAKyxH,cACd;YAAA;YAKA,IAAA,UAAW7/C;gBACT,OAAO5xE,IAAAA,CAAK0xH,aACd;YAAA;YAKA,IAAA,WAAW5xE;gBACT,OAAO9/C,IAAAA,CAAK4xH,cACd;YAAA;QAAA;QAGK,MAAMD;YAAb,aAAA;gBACU,IAAA,CAAAthD,MAAAA,GAAiB,GACjB,IAAA,CAAA8hD,WAAAA,GAAsB,GACtB,IAAA,CAAAC,SAAAA,GAA2C,IAAI9jG,KAC/C,IAAA,CAAA+jG,WAAAA,GAAsB,GACtB,IAAA,CAAAC,mBAAAA,GAA8B,GAC9B,IAAA,CAAAC,WAAAA,GAAsB,GACtB,IAAA,CAAAC,YAAAA,GAAuB;YAwFjC;YAlFS,MAAMT,CAAAA,EAAAA;gBACPA,IACF/xH,CAAAA,IAAAA,CAAK6xE,KAAAA,GAAQkgD,EAAWlgD,KAAAA,EACxB7xE,IAAAA,CAAKizE,UAAAA,GAAa8+C,EAAW9+C,UAAAA,EAC7BjzE,IAAAA,CAAK+yE,QAAAA,GAAWg/C,EAAWh/C,QAAAA,EAC3B/yE,IAAAA,CAAKoyE,UAAAA,GAAa2/C,EAAW3/C,UAAAA,EAC7BpyE,IAAAA,CAAK6yE,kBAAAA,GAAqBk/C,EAAWl/C,kBAAAA,EACrC7yE,IAAAA,CAAKuxE,UAAAA,GAAawgD,EAAWxgD,UAAAA,EAC7BvxE,IAAAA,CAAK8yE,WAAAA,GAAci/C,EAAWj/C,WAAAA,AAAAA,IAE9B9yE,CAAAA,IAAAA,CAAK6xE,KAAAA,GAAQ7xE,IAAAA,CAAKizE,UAAAA,GAAajzE,IAAAA,CAAKoyE,UAAAA,GAAa,GACjDpyE,IAAAA,CAAK6yE,kBAAAA,GAAqB7yE,IAAAA,CAAKuxE,UAAAA,GAAavxE,IAAAA,CAAK8yE,WAAAA,GAAc,GAC/D9yE,IAAAA,CAAK+yE,QAAAA,CAASvrE,KAAAA,EAAAA;YAElB;YAKO,QAAAyK;gBACL,MAAMwgH,IAAK,IAAId;gBAIf,OAFAc,EAAG92G,KAAAA,CAAM3b,IAAAA,GAEFyyH;YACT;YAEA,IAAA,QAAW5gD;gBACT,OAAO7xE,IAAAA,CAAKqwE,MACd;YAAA;YAEA,IAAA,MAAiBjtE,CAAAA,EAAAA;gBACfpD,IAAAA,CAAKqwE,MAAAA,GAASjtE;YAChB;YAEA,IAAA,aAAW6vE;gBACT,OAAOjzE,IAAAA,CAAKmyH,WACd;YAAA;YAEA,IAAA,WAAsB/uH,CAAAA,EAAAA;gBACpBpD,IAAAA,CAAKmyH,WAAAA,GAAc/uH;YACrB;YAEA,IAAA,WAAW2vE;gBACT,OAAO/yE,IAAAA,CAAKoyH,SACd;YAAA;YAEA,IAAA,SAAoBr/C,CAAAA,EAAAA;gBAClB/yE,IAAAA,CAAKoyH,SAAAA,GAAYr/C;YACnB;YAEA,IAAA,aAAWX;gBACT,OAAOpyE,IAAAA,CAAKqyH,WACd;YAAA;YAEA,IAAA,WAAsBjvH,CAAAA,EAAAA;gBACpBpD,IAAAA,CAAKqyH,WAAAA,GAAcjvH;YACrB;YAEA,IAAA,qBAAWyvE;gBACT,OAAO7yE,IAAAA,CAAKsyH,mBACd;YAAA;YAEA,IAAA,mBAA8BlvH,CAAAA,EAAAA;gBAC5BpD,IAAAA,CAAKsyH,mBAAAA,GAAsBlvH;YAC7B;YAEA,IAAA,aAAWmuE;gBACT,OAAOvxE,IAAAA,CAAKuyH,WACd;YAAA;YAEA,IAAA,WAAsBnvH,CAAAA,EAAAA;gBACpBpD,IAAAA,CAAKuyH,WAAAA,GAAcnvH;YACrB;YAEA,IAAA,cAAW0vE;gBACT,OAAO9yE,IAAAA,CAAKwyH,YACd;YAAA;YAEA,IAAA,YAAuBpvH,CAAAA,EAAAA;gBACrBpD,IAAAA,CAAKwyH,YAAAA,GAAepvH;YACtB;QAAA;QCnmBK,MAAMsvH;YAIX,GAAGhrH,CAAAA,EAAmBC,CAAAA,EAAAA;gBAChB3H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA,IACvB1H,IAAAA,CAAK6H,GAAAA,CAAIH,GAAW1H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA,GAE3C1H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA,GAAa1H,IAAAA,CAAK4yH,SAAAA,CAAUjrH,IACjD3H,IAAAA,CAAKu1D,eAAAA,CAAgBlrC,gBAAAA,CAAiB3iB,GAAW1H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA;YACxE;YACA,IAAIA,CAAAA,EAAmBC,CAAAA,EAAAA;gBAChBA,KACHA,CAAAA,IAAU3H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA,AAAAA,GAEjC1H,IAAAA,CAAKu1D,eAAAA,CAAgBK,mBAAAA,CAAoBluD,GAAWC,IACpD3H,IAAAA,CAAK2yH,eAAAA,CAAgBjrH,EAAAA,GAAa;YACpC;YAEQ,UAAUC,CAAAA,EAAAA;gBAChB,OAAQu/D,CAAAA;oBACDlnE,IAAAA,CAAKmH,OAAAA,IACRQ,EAAQu/D;gBACV;YAEJ;YAEO,QAAAt+D;gBACL5I,IAAAA,CAAKmH,OAAAA,GAAAA,CAAU;YACjB;YAEO,SAAA+0D;gBACLl8D,IAAAA,CAAKmH,OAAAA,GAAAA,CAAU;YACjB;YAEO,QAAAK;gBACL,IAAK,MAAMY,KAASpI,IAAAA,CAAK2yH,eAAAA,CACvB3yH,IAAAA,CAAK6H,GAAAA,CAAIO;YAEb;YAEA,YAAmBmtD,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,eAAAA,GAAAA,GAxCX,IAAA,CAAApuD,OAAAA,GAAAA,CAAU,GACV,IAAA,CAAAwrH,eAAAA,GAA6D,CAAC;YAuC9B;QAAA;QAGnC,MAAME;YAGX,YACUC,CAAAA,EACAC,CAAAA,CAAAA;gBADA,IAAA,CAAAD,aAAAA,GAAAA,GACA,IAAA,CAAAC,eAAAA,GAAAA,GAER/yH,IAAAA,CAAKgzH,gBAAAA,GAAmB,IAAIN,GAAiB1yH,IAAAA,CAAK8yH,aAAAA,GAClD9yH,IAAAA,CAAKizH,kBAAAA,GAAqB,IAAIP,GAAiB1yH,IAAAA,CAAK+yH,eAAAA;YACtD;YAEA,IAAA,SAAWvvH;gBACT,OAAOxD,IAAAA,CAAKgzH,gBACd;YAAA;YAEA,IAAA,WAAWz5G;gBACT,OAAOvZ,IAAAA,CAAKizH,kBACd;YAAA;YAEO,QAAArqH;gBACL5I,IAAAA,CAAKwD,MAAAA,CAAOoF,KAAAA,IACZ5I,IAAAA,CAAKuZ,QAAAA,CAAS3Q,KAAAA;YAChB;YAEO,SAAAszD;gBACLl8D,IAAAA,CAAKwD,MAAAA,CAAO04D,MAAAA,IACZl8D,IAAAA,CAAKuZ,QAAAA,CAAS2iD,MAAAA;YAChB;YAEO,QAAA10D;gBACLxH,IAAAA,CAAKwD,MAAAA,CAAOgE,KAAAA,IACZxH,IAAAA,CAAKuZ,QAAAA,CAAS/R,KAAAA;YAChB;QAAA;QCzBK,MAAM0rH,KAAsD;YACjEzrF,iBAAAA,CAAiB;YACjB0rF,2BAAAA,CAA2B;YAC3B1kE,yBAAAA,CAAyB;YACzBn/B,WAAW7B,GAAeI,OAAAA;YAC1BonC,sBAAsB;QAAA,GAGXm+D,KAAqD;YAChE3rF,iBAAAA,CAAiB;YACjB0rF,2BAAAA,CAA2B;YAC3B1kE,yBAAAA,CAAyB;YACzBn/B,WAAW7B,GAAeI,OAAAA;YAC1BonC,sBAAsB;QAAA;QCrDjB,MAAMo+D;YASX,YAAYp6G,CAAAA,CAAAA;gBAAAA,IAAAA;gBAPJ,IAAA,CAAAq6G,aAAAA,GAAwB,KACxB,IAAA,CAAAC,iBAAAA,GAA4B,GAC5B,IAAA,CAAAC,OAAAA,GAAkB,GAClB,IAAA,CAAAC,mBAAAA,GAA8B,GAC9B,IAAA,CAAAC,eAAAA,GAA0B,GAIhC1zH,IAAAA,CAAKsxH,IAAAA,GAAOr4G,EAAQ06G,UAAAA,EACpB3zH,IAAAA,CAAKszH,aAAAA,GAAoC,SAApB,CAAA,IAAAr6G,EAAQ26G,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI5zH,IAAAA,CAAKszH,aAAAA,EAClDtzH,IAAAA,CAAKuzH,iBAAAA,GAAoB,MAAOt6G,EAAQ06G,UAAAA,EACxC3zH,IAAAA,CAAK6zH,MAAAA,GAAS56G,EAAQ66G,KAAAA,EACtB9zH,IAAAA,CAAKyzH,mBAAAA,GAAsBzzH,IAAAA,CAAK6zH,MAAAA;YAClC;YAKA,QAAA7uH;gBACEhF,IAAAA,CAAK0zH,eAAAA,GAAkB1zH,IAAAA,CAAK6zH,MAAAA;YAC9B;YAKA,MAAAtvF;gBACEvkC,IAAAA,CAAKwzH,OAAAA;gBACL,MAAMv1E,IAAOj+C,IAAAA,CAAK6zH,MAAAA;gBAElB7zH,IAAAA,CAAKuzH,iBAAAA,GAAoBt1E,IAAOj+C,IAAAA,CAAK0zH,eAAAA,EAEjCz1E,KAAQj+C,IAAAA,CAAKyzH,mBAAAA,GAAsBzzH,IAAAA,CAAKszH,aAAAA,IAC1CtzH,CAAAA,IAAAA,CAAKsxH,IAAAA,GAAuB,MAAftxH,IAAAA,CAAKwzH,OAAAA,GAAmBv1E,CAAAA,IAAOj+C,IAAAA,CAAKyzH,mBAAAA,AAAAA,GACjDzzH,IAAAA,CAAKyzH,mBAAAA,GAAsBx1E,GAC3Bj+C,IAAAA,CAAKwzH,OAAAA,GAAU,CAAA;YAEnB;YAKA,IAAA,MAAIvB;gBACF,OAAOjyH,IAAAA,CAAKsxH,IACd;YAAA;YAKA,IAAA,UAAIyC;gBACF,OAAO,MAAO/zH,IAAAA,CAAKuzH,iBACrB;YAAA;QAAA;QCtCK,MAAeS;YAYpB,YAAY/6G,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA;gBAVJ,IAAA,CAAAg7G,iBAAAA,GAAyC,KAAA,GAGzC,IAAA,CAAAC,OAAAA,GAAkBtlH,IAAAA,GAClB,IAAA,CAAAulH,SAAAA,GAAoB,GAGpB,IAAA,CAAAC,QAAAA,GAAmB,GACnB,IAAA,CAAAC,aAAAA,GAA0G,EAAA,EAC1G,IAAA,CAAAC,aAAAA,GAAwB,GAE9Bt0H,IAAAA,CAAKqZ,QAAAA,GAAWJ,GAChBjZ,IAAAA,CAAK62C,IAAAA,GAAO59B,EAAQ49B,IAAAA,EACpB72C,IAAAA,CAAKm0H,SAAAA,GAAsB,SAAV,CAAA,IAAAn0H,IAAAA,CAAKkF,GAAAA,EAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI,GAC/BlF,IAAAA,CAAKk0H,OAAAA,GAAwB,SAAd,CAAA,IAAAj7G,EAAQs7G,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIv0H,IAAAA,CAAKk0H,OAAAA,EACtCl0H,IAAAA,CAAKi0H,iBAAAA,GAA4C,SAAxB,CAAA,IAAAh7G,EAAQu7G,gBAAAA,AAAAA,KAAAA,KAAgB,MAAA,IAAA,IAAIx0H,IAAAA,CAAKi0H,iBAAAA,EAC1Dj0H,IAAAA,CAAKy0H,UAAAA,GAAa,IAAIpB,GAAW;oBAC/BM,YAAY;oBACZG,OAAO,IAAM9zH,IAAAA,CAAKkF,GAAAA;gBAAAA;YAEtB;YAKO,UAAA4xC;gBACL,OAAO92C,IAAAA,CAAKo0H,QACd;YAAA;YAKO,MAAAlvH;gBACL,OAAO0pC,YAAY1pC,GAAAA;YACrB;YAEO,cAAA6rH;gBAKL,OAJkB,IAAI2D,GAAU;oBAAA,GAC3B10H,IAAAA,CAAKqZ,QAAAA;oBACRs7G,iBAAiB;gBAAA;YAGrB;YAEO,kBAAAxD;gBAIL,OAHc,IAAIyD,GAAc;oBAAA,GAC3B50H,IAAAA,CAAKqZ,QAAAA;gBAAAA;YAGZ;YAEO,yBAAyB1R,CAAAA,EAAAA;gBAC9B3H,IAAAA,CAAKi0H,iBAAAA,GAAoBtsH;YAC3B;YAYO,SAAS5C,CAAAA,EAA8B+vH,IAAoB,CAAA,EAAGC,IAAkC,UAAA,EAAA;gBAErG,MAAMC,IAAgBh1H,IAAAA,CAAKs0H,aAAAA,GAAgBQ;gBAC3C90H,IAAAA,CAAKq0H,aAAAA,CAAc10H,IAAAA,CAAK;oBAACoF;oBAAIiwH;oBAAeD;iBAAAA;YAC9C;YAOO,kBAAkBA,IAAkC,UAAA,EAAA;gBAEzD,IAAK,IAAIv0H,IAAIR,IAAAA,CAAKq0H,aAAAA,CAAc/zH,MAAAA,GAAS,GAAGE,IAAAA,IAAQA,IAC9Cu0H,MAAW/0H,IAAAA,CAAKq0H,aAAAA,CAAc7zH,EAAAA,CAAG,EAAA,IAAMR,IAAAA,CAAKq0H,aAAAA,CAAc7zH,EAAAA,CAAG,EAAA,IAAMR,IAAAA,CAAKs0H,aAAAA,IAC1Et0H,CAAAA,IAAAA,CAAKq0H,aAAAA,CAAc7zH,EAAAA,CAAG,EAAA,CAAGR,IAAAA,CAAKo0H,QAAAA,GAC9Bp0H,IAAAA,CAAKq0H,aAAAA,CAAc3rH,MAAAA,CAAOlI,GAAG,EAAA;YAGnC;YAEU,OAAO00H,CAAAA,EAAAA;gBACf,IAAA;oBACEl1H,IAAAA,CAAKy0H,UAAAA,CAAWzvH,KAAAA;oBAEhB,MAAME,IAAMlF,IAAAA,CAAKkF,GAAAA;oBACjB,IAAI4xC,IAAU5xC,IAAMlF,IAAAA,CAAKm0H,SAAAA,IAAa;oBAGtC,MAAMgB,IAAc,MAAOn1H,IAAAA,CAAKk0H,OAAAA;oBAGhC,IAAIp9E,KAAWq+E,GAAa;wBAC1B,IAAIC,IAAW;wBACK,MAAhBD,KACFC,CAAAA,IAAWt+E,IAAUq+E,GACrBr+E,KAAoBs+E,CAAAA,GAOlBt+E,IAAU,OACZA,CAAAA,IAAU,CAAA,GAIZ92C,IAAAA,CAAKo0H,QAAAA,GAAWc,KAAoBp+E,GACpC92C,IAAAA,CAAKs0H,aAAAA,IAAiBt0H,IAAAA,CAAKo0H,QAAAA,EAC3Bp0H,IAAAA,CAAKi1H,iBAAAA,CAAkB,aACvBj1H,IAAAA,CAAK62C,IAAAA,CAAKq+E,KAAoBp+E,IAC9B92C,IAAAA,CAAKi1H,iBAAAA,CAAkB,cAGrBj1H,IAAAA,CAAKm0H,SAAAA,GADa,MAAhBgB,IACejwH,IAAMkwH,IAENlwH,GAEnBlF,IAAAA,CAAKy0H,UAAAA,CAAWlwF,GAAAA;oBAClB;gBACF,EAAE,OAAOjlB,GAAAA;oBACPtf,IAAAA,CAAKi0H,iBAAAA,CAAkB30G,IACvBtf,IAAAA,CAAKigE,IAAAA;gBACP;YACF;QAAA;QAqBK,MAAM20D,WAAsBZ;YAGjC,YAAY/6G,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM3T,IAHA,IAAA,CAAAynF,QAAAA,GAAAA,CAAW;YAInB;YAEO,YAAAkB;gBACL,OAAO5hG,IAAAA,CAAK0gG,QACd;YAAA;YAEO,QAAA17F;gBACL,IAAIhF,IAAAA,CAAK0gG,QAAAA,EACP;gBAEF1gG,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW;gBAChB,MAAM20B,IAAW;oBAEf,IAAKr1H,IAAAA,CAAK0gG,QAAAA,EAGV,IAAA;wBAEE1gG,IAAAA,CAAKs1H,UAAAA,GAAa9xH,OAAOE,qBAAAA,CAAsB2xH,IAC/Cr1H,IAAAA,CAAKytC,MAAAA;oBACP,EAAE,OAAOnuB,GAAAA;wBAEP,MADA9b,OAAOO,oBAAAA,CAAqB/D,IAAAA,CAAKs1H,UAAAA,GAC3Bh2G;oBACR;gBAAA;gBAIF+1G;YACF;YAEO,OAAAp1D;gBACLz8D,OAAOO,oBAAAA,CAAqB/D,IAAAA,CAAKs1H,UAAAA,GACjCt1H,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW;YAClB;QAAA;QAaK,MAAMg0B,WAAkBV;YAK7B,YAAY/6G,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM;oBAAA,GACD3T,CAAAA;gBAAAA,IANC,IAAA,CAAA4T,OAAAA,GAAUjW,EAAOS,WAAAA,IAEjB,IAAA,CAAAqpF,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAA60B,YAAAA,GAAe,GAKrBv1H,IAAAA,CAAKw1H,SAAAA,GAAYv8G,EAAQ07G,eAC3B;YAAA;YAKgB,MAAAzvH;gBAAAA,IAAAA;gBACd,OAAwB,SAAjB,CAAA,IAAAlF,IAAAA,CAAKu1H,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI;YAC9B;YAEO,YAAA3zB;gBACL,OAAO5hG,IAAAA,CAAK0gG,QACd;YAAA;YACO,QAAA17F;gBACLhF,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW;YAClB;YACO,OAAAzgC;gBACLjgE,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW;YAClB;YAMA,KAAKw0B,CAAAA,EAAAA;gBACH,MAAMj3E,IAAOi3E,QAAAA,IAAAA,IAAoBl1H,IAAAA,CAAKw1H,SAAAA;gBAElCx1H,IAAAA,CAAK0gG,QAAAA,GAGP1gG,CAAAA,IAAAA,CAAKytC,MAAAA,CAAOwQ,IACZj+C,IAAAA,CAAKu1H,YAAAA,IAAgBt3E,CAAAA,IAErBj+C,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK;YAEtB;YAOA,IAAIq9G,CAAAA,EAAuBR,CAAAA,EAAAA;gBACzB,IAAK,IAAI10H,IAAI,GAAGA,IAAIk1H,GAAel1H,IACjCR,IAAAA,CAAKg5G,IAAAA,CAAKkc,QAAAA,IAAAA,IAAoBl1H,IAAAA,CAAKw1H,SAAAA;YAEvC;QAAA;QAAA,IAAA,KAAA,EAAA;QC5RK,MAAMG;YAAb,aAAA;gBAGU,IAAA,CAAAC,WAAAA,GAAsB,GAAA,CAAA,CAAW71H,QAAAA,IAEjC,IAAA,CAAAmmD,cAAAA,GAAAA,CAAiB;YAoF3B;YAnFU,cAAA/Y;gBACDntC,IAAAA,CAAKkmD,cAAAA,IACRlmD,CAAAA,IAAAA,CAAK61H,UAAAA,GAAat8G,SAASC,aAAAA,CAAc,QACzCxZ,IAAAA,CAAK61H,UAAAA,CAAWj2H,EAAAA,GAAK,sBACrB2Z,SAASO,IAAAA,CAAKC,WAAAA,CAAY/Z,IAAAA,CAAK61H,UAAAA,GAC/B71H,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB,GAEtBlmD,IAAAA,CAAK+lE,WAAAA,GAAcxsD,SAASC,aAAAA,CAAc,UAC1CxZ,IAAAA,CAAK+lE,WAAAA,CAAYC,WAAAA,GAAchmE,IAAAA,CAAK41H,WAAAA,EACpCr8G,SAAS2sD,IAAAA,CAAKnsD,WAAAA,CAAY/Z,IAAAA,CAAK+lE,WAAAA,CAAAA;YAEnC;YAEO,UAAA32C;gBACLpvB,IAAAA,CAAK61H,UAAAA,CAAWv/D,aAAAA,CAAc/O,WAAAA,CAAYvnD,IAAAA,CAAK61H,UAAAA,GAE/C71H,IAAAA,CAAK+lE,WAAAA,CAAYzP,aAAAA,CAAc/O,WAAAA,CAAYvnD,IAAAA,CAAK+lE,WAAAA,GAEhD/lE,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB;YACxB;YAEQ,gBAAgBvrC,CAAAA,EAAAA;gBACtB,MAAMo7G,IAAex8G,SAASC,aAAAA,CAAc;gBAE5C,OADAu8G,EAAaC,SAAAA,GAAYr7G,GAClBo7G;YACT;YAQO,MAAMp7G,CAAAA,EAAiBu7G,CAAAA,EAAqBC,CAAAA,EAAAA;gBACjDn2H,IAAAA,CAAKmtC,WAAAA;gBACL,MAAM8oF,IAAQ18G,SAASC,aAAAA,CAAc;gBACrCy8G,EAAMG,SAAAA,GAAY;gBAElB,MAAMC,IAAkC17G,EAAQ0a,KAAAA,CAAM,UAAUp1B,GAAAA,CAAK0a,CAAAA,IAAY3a,IAAAA,CAAK81H,eAAAA,CAAgBn7G;gBAEtG,IAAIu7G,GAAY;oBACd,MAAMI,IAAO/8G,SAASC,aAAAA,CAAc;oBACpC88G,EAAKC,IAAAA,GAAOL,GAEVI,EAAKN,SAAAA,GADHG,KAGeD,GAEnBG,EAAiB3tH,MAAAA,CAAO,GAAG,GAAG4tH;gBAChC;gBAGA,MAAME,IAAej9G,SAASC,aAAAA,CAAc;gBAC5C68G,EAAiBl4E,OAAAA,CAASxjC,CAAAA;oBACxB67G,EAAaz8G,WAAAA,CAAYY;gBAAQ,IAEnCs7G,EAAMl8G,WAAAA,CAAYy8G;gBAGlB,MAAMC,IAAal9G,SAASC,aAAAA,CAAc;gBAC1Ci9G,EAAWT,SAAAA,GAAY,KACvBS,EAAWpsG,gBAAAA,CAAiB,SAAS;oBACnCrqB,IAAAA,CAAK61H,UAAAA,CAAWtuE,WAAAA,CAAY0uE;gBAAM,IAEpCA,EAAMl8G,WAAAA,CAAY08G;gBAGlB,MAAMC,IAAkBxvD,CAAAA;oBACtB,IAAgB,aAAZA,EAAI5kE,GAAAA,EACN,IAAA;wBACEtC,IAAAA,CAAK61H,UAAAA,CAAWtuE,WAAAA,CAAY0uE;oBAC9B,EAAE,OAAA,GAAA,CAEF;oBAEF18G,SAASq8C,mBAAAA,CAAoB,WAAW8gE;gBAAe;gBAEzDn9G,SAAS8Q,gBAAAA,CAAiB,WAAWqsG;gBAGrC,MAAMC,IAAQ32H,IAAAA,CAAK61H,UAAAA,CAAWe,UAAAA;gBAC9B52H,IAAAA,CAAK61H,UAAAA,CAAWgB,YAAAA,CAAaZ,GAAOU;YACtC;QAAA;QCvEK,MAAMG,KAAiB;YAC5BC,iBAAiB;YACjBC,YAAY;YACZC,eAAe;QAAA;QA0EV,MAAMC;YAoDX,IAAA,kBAAWC;gBACT,OAAOn3H,IAAAA,CAAKo3H,gBACd;YAAA;YAEA,YACUz0D,CAAAA,EACR00D,CAAAA,CAAAA;gBADQ,IAAA,CAAA10D,OAAAA,GAAAA,GAxDH,IAAA,CAAAzoD,MAAAA,GAAS,IAAIhT,GACZ,IAAA,CAAA2lB,OAAAA,GAAUjW,EAAOS,WAAAA,IAGjB,IAAA,CAAAorB,YAAAA,GAAAA,CAAe,GAkBP,IAAA,CAAA40F,MAAAA,GAA2C,CAAC,GAKpD,IAAA,CAAAC,gBAAAA,GAAmB,IAAIhpG,KAUvB,IAAA,CAAAipG,cAAAA,GAAiB,IAAIjpG,KACrB,IAAA,CAAAkpG,kBAAAA,GAAqB,IAAIlpG,KAIzB,IAAA,CAAAmpG,aAAAA,GAAgB,IAAIxgH,KAEpB,IAAA,CAAAmgH,gBAAAA,GAAAA,CAAmB,GAezBp3H,IAAAA,CAAK03H,SAAAA,GAAY13H,IAAAA,CAAK6nG,YAAAA,GAAe,IAAI+lB,IACzC5tH,IAAAA,CAAKoQ,GAAAA,CAAI,QAAQpQ,IAAAA,CAAK03H,SAAAA,GACtB13H,IAAAA,CAAK6nG,YAAAA,GAAe7nG,IAAAA,CAAK03H,SAAAA,EACzB13H,IAAAA,CAAK23H,gBAAAA,GAAmB;gBACxB,IAAK,MAAMC,KAAYP,EAAQ;oBAC7B,MAAMQ,IAAiBR,CAAAA,CAAOO,EAAAA;oBAC9B53H,IAAAA,CAAKoQ,GAAAA,CAAIwnH,GAAUC,IACF,WAAbD,KACF53H,CAAAA,IAAAA,CAAK03H,SAAAA,GAAY13H,IAAAA,CAAK83H,gBAAAA,CAAiB,SACvC93H,IAAAA,CAAK6nG,YAAAA,GAAe7nG,IAAAA,CAAK03H,SAAAA,AAAAA;gBAE7B;YACF;YAKA,MAAA,eAAM1uE;gBACJ,IAAA,CAAKhpD,IAAAA,CAAKyiC,YAAAA;oBAER,IADAziC,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe,GAChBziC,IAAAA,CAAK+3H,aAAAA,EAAe;wBACtB,MAAMC,IAAgBh4H,IAAAA,CAAK+3H,aAAAA;wBAC3B/3H,IAAAA,CAAK+3H,aAAAA,GAAAA,KAAgBj3H;wBACrB,MAAMm3H,IAAqBj4H,IAAAA,CAAKk4H,mBAAAA;wBAChCl4H,IAAAA,CAAKk4H,mBAAAA,GAAAA,KAAsBp3H;wBAC3B,MAAMq3H,IAAwBn4H,IAAAA,CAAK83H,gBAAAA,CAAiBE;wBAChDG,KAAyBF,KAC3BA,EAAmBG,iBAAAA,CAAkBp4H,IAAAA,CAAK2iE,OAAAA,EAASw1D,IAAAA,MAE/Cn4H,IAAAA,CAAKq4H,SAAAA,CAAUL,IACjBG,KAAyBF,KAAAA,MACrBj4H,IAAAA,CAAKs4H,cAAAA,CAAeL,GAAoBE;oBAElD,OAAA,MACQn4H,IAAAA,CAAKq4H,SAAAA,CAAU;;YAG3B;YAEA,IAAA,gBAAIvvE;gBACF,OAAO9oD,IAAAA,CAAKyiC,YACd;YAAA;YASA,eAAe+1F,CAAAA,EAAoCv/G,CAAAA,EAAAA;gBACjD,MAAMw/G,IAAoBx/G,QAAAA,IAAAA,KAAO,IAAPA,EAASk1G,MAAAA;gBASnC,IAAIuK;gBAEJ,IAVID,aAA6B10D,KAC/B/jE,IAAAA,CAAK24H,UAAAA,GAAaF,IACT30D,GAAoB20D,KAC7Bz4H,IAAAA,CAAK24H,UAAAA,GAAa,IAAIF,IAEtBz4H,IAAAA,CAAK24H,UAAAA,GAAa,IAAIvzD,IAKpBnsD,QAAAA,IAAAA,KAAO,IAAPA,EAAS2/G,YAAAA,EAAc;oBACzB,MAAA,EAAM,cAAEA,CAAAA,EAAAA,GAAiB3/G;oBACzBy/G,IAAuBE;gBACzB;gBAKA,IAHA54H,IAAAA,CAAKw4H,UAAAA,GAAaA,GAGdE,GAAsB;oBACxB,MAAMG,IAAqB74H,IAAAA,CAAK83H,gBAAAA,CAAiB93H,IAAAA,CAAKw4H,UAAAA;oBAClDK,KAEFH,CAAAA,EAAqBN,iBAAAA,CAAkBp4H,IAAAA,CAAK2iE,OAAAA,EAASk2D,IACrD74H,IAAAA,CAAKq4H,SAAAA,CAAUr4H,IAAAA,CAAKw4H,UAAAA,EAAYrrG,IAAAA,CAAK,IAE5BntB,IAAAA,CAAKs4H,cAAAA,CAAeI,GAAsBG,GAAAA;gBAGvD,OAEE74H,IAAAA,CAAKq4H,SAAAA,CAAUr4H,IAAAA,CAAKw4H,UAAAA;gBAGtBx4H,IAAAA,CAAK23H,gBAAAA,GAAmB33H,IAAAA,CAAKw4H,UAC/B;YAAA;YAEQ,WAAWO,CAAAA,EAAAA;gBACjB,OAAO/4H,IAAAA,CAAKu3H,cAAAA,CAAe50H,GAAAA,CAAIo2H;YACjC;YAEQ,iBAAiBA,CAAAA,EAAAA;gBAAAA,IAAAA;gBACvB,MAAME,IAAej5H,IAAAA,CAAKq3H,MAAAA,CAAO0B,EAAAA;gBACjC,IAAA,CAAIE,CAAAA,aAAwBrL,MAASD,GAAmBsL,EAAAA,GAGxD,OAAgC,SAAzB,CAAA,IAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAcr7D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE2B,EACpC;YAAA;YAEQ,kBAAkBw5D,CAAAA,EAAAA;gBAAAA,IAAAA;gBACxB,MAAME,IAAej5H,IAAAA,CAAKq3H,MAAAA,CAAO0B,EAAAA;gBACjC,IAAA,CAAIE,CAAAA,aAAwBrL,MAASD,GAAmBsL,EAAAA,GAGxD,OAAgC,SAAzB,CAAA,IAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAcr7D,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAEu7D,GACpC;YAAA;YAEA,mBAAAC;gBACE,MAAMC,IAAgBr5H,IAAAA,CAAKs5H,kBAAAA,CAAmBt5H,IAAAA,CAAK+3H,aAAAA;gBACnD,OAAI/3H,IAAAA,CAAK+3H,aAAAA,IAAiBsB,IACjBA,IAEF;YACT;YAMA,mBAAmB5qG,CAAAA,EAAAA;gBACjB,MAAM8qG,IAAav5H,IAAAA,CAAKq3H,MAAAA,CAAO5oG,EAAAA;gBAC/B,OAAI8qG,aAAsB3L,MAASD,GAAmB4L,KAC7CA,IACEA,IACFA,EAAWvzE,KAAAA,GAAAA,KADb;YAIT;YAMA,aAAaA,CAAAA,EAAAA;gBACX,KAAK,MAAA,CAAOv3B,GAAM8qG,EAAAA,IAAe/2H,OAAO0rC,OAAAA,CAAQluC,IAAAA,CAAKq3H,MAAAA,EACnD,IAAIkC,aAAsB3L,IAAAA;oBACxB,IAAI5nE,MAAUuzE,GACZ,OAAO9qG;gBAAAA,OAEJ,IAAA,CAAKk/F,GAAmB4L,MACzBvzE,MAAUuzE,EAAWvzE,KAAAA,EACvB,OAAOv3B;gBAKb,KAAK,MAAA,CAAOA,GAAM8qG,EAAAA,IAAe/2H,OAAO0rC,OAAAA,CAAQluC,IAAAA,CAAKq3H,MAAAA,EACnD,IAAI1J,GAAmB4L,IAAAA;oBACrB,IAAIvzE,EAAMr/C,WAAAA,KAAgB4yH,GACxB,OAAO9qG;gBAAAA,OAEJ,IAAA,CAAM8qG,CAAAA,aAAsB3L,EAAAA,KAC7B5nE,EAAMr/C,WAAAA,KAAgB4yH,EAAWvzE,KAAAA,EACnC,OAAOv3B;gBAIb,OAAO;YACT;YAMA,YAAmCA,CAAAA,EAAAA;gBACjC,OAAOzuB,IACT;YAAA;YAMA,cAAqCyuB,CAAAA,EAAAA;gBACnC,OAAOzuB,IACT;YAAA;YAOA,IAA2ByuB,CAAAA,EAAcwqG,CAAAA,EAAAA;gBACvC,IAAA,CAAMA,CAAAA,aAAwBrL,MAAWD,GAAmBsL,EAAAA,GAAe;oBACzE,MAAA,EAAM,QAAE9K,CAAAA,EAAM,aAAEvwD,CAAAA,EAAAA,GAAgBq7D,GAAAA,EACxB15D,IAAIq5D,CAAAA,EAAcO,KAAKO,CAAAA,EAAAA,GAAkB97D,QAAAA,IAAAA,IAAe,CAAC;oBACjE59D,IAAAA,CAAKw3H,kBAAAA,CAAmBxsG,GAAAA,CAAIyD,GAAM;wBAAE8wC,IAAIq5D;wBAAcO,KAAKO;oBAAAA,IAEvD51D,GAAoBqqD,KACtBnuH,IAAAA,CAAKu3H,cAAAA,CAAevsG,GAAAA,CAAIyD,GAAM,IAAI0/F,KACzBA,KACTnuH,IAAAA,CAAKu3H,cAAAA,CAAevsG,GAAAA,CAAIyD,GAAM0/F;gBAElC;gBAMA,OAJInuH,IAAAA,CAAKq3H,MAAAA,CAAO5oG,EAAAA,IACdzuB,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,SAASoW,GAAM,+BAEnCzuB,IAAAA,CAAKq3H,MAAAA,CAAO5oG,EAAAA,GAAmCwqG,GACxCj5H,IAAAA,CAAKw5H,WAAAA,CAAY/qG;YAC1B;YAKA,OAAOkrG,CAAAA,EAAAA;gBACL,IAAIA,aAAuB/L,MAASD,GAAmBgM,IAAc;oBACnE,MAAMC,IAAcD;oBAEpB,IAAK,MAAMr3H,KAAOtC,IAAAA,CAAKq3H,MAAAA,CACrB,IAAIr3H,IAAAA,CAAKq3H,MAAAA,CAAOt0H,cAAAA,CAAeT,IAAM;wBACnC,MAAMu3H,IAA0B75H,IAAAA,CAAKq3H,MAAAA,CAAO/0H,EAAAA;wBAC5C,IAAI0jD;wBAOJ,IALEA,IADE6zE,aAAmCjM,MAASD,GAAmBkM,KACzDA,IAEAA,EAAwB7zE,KAAAA,EAG9BA,MAAU4zE,GAAa;4BACzB,IAAIt3H,MAAQtC,IAAAA,CAAK23H,gBAAAA,EACf,MAAM,IAAIxxH,MAAM,CAAA,wCAAA,EAA2C7D,GAAAA;4BAG7DtC,IAAAA,CAAKs3H,gBAAAA,CAAiBzoG,MAAAA,CAAOvsB,IAC7BtC,IAAAA,CAAKw3H,kBAAAA,CAAmB3oG,MAAAA,CAAOvsB,IAC/BtC,IAAAA,CAAKu3H,cAAAA,CAAe1oG,MAAAA,CAAOvsB,IAAAA,OACpBtC,IAAAA,CAAKq3H,MAAAA,CAAO/0H,EACrB;wBAAA;oBACF;gBAEJ;gBACA,IAA2B,YAAA,OAAhBq3H,GAA0B;oBACnC,IAAIA,MAAgB35H,IAAAA,CAAK23H,gBAAAA,EACvB,MAAM,IAAIxxH,MAAM,CAAA,wCAAA,EAA2CwzH,GAAAA;oBAI7D35H,IAAAA,CAAKs3H,gBAAAA,CAAiBzoG,MAAAA,CAAO8qG,IAC7B35H,IAAAA,CAAKw3H,kBAAAA,CAAmB3oG,MAAAA,CAAO8qG,IAC/B35H,IAAAA,CAAKu3H,cAAAA,CAAe1oG,MAAAA,CAAO8qG,IAAAA,OACpB35H,IAAAA,CAAKq3H,MAAAA,CAAOsC,EACrB;gBAAA;YACF;YAOA,MAAA,UAAgBI,CAAAA,EAAyC9gH,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBACvD,MAAM+gH,IAAYh6H,IAAAA,CAAK83H,gBAAAA,CAAiBiC;gBACxC,IAAA,CAAKC,GAEH,OAAA,KADAh6H,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,MAAA,EAAS0hH,EAAAA,2DAAAA,CAAAA;gBAG7B,MAAME,IAAsBj6H,IAAAA,CAAK6nG,YAAAA,EAC3BqyB,IAAcl6H,IAAAA,CAAK23H,gBAAAA,EACnBwC,IAAgD,SAA3B,CAAA,IAAkB,SAAlB,CAAA,IAAAn6H,IAAAA,CAAK2iE,OAAAA,CAAQ+E,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEkM,OAAAA,AAAAA,KAAAA,KAAO,MAAA,KAAA;gBACtD5zE,IAAAA,CAAKo3H,gBAAAA,GAAAA,CAAmB;gBAExB,MAAMgD,IAAmD,SAAlC,CAAA,IAAAp6H,IAAAA,CAAK83H,gBAAAA,CAAiBoC,EAAAA,KAAAA,KAAY,MAAA,IAAA,KAAA,IAAA,EAAE9L,YAAAA,CAAa,QAClEiM,IAAqBL,QAAAA,IAAAA,KAAS,IAATA,EAAW5L,YAAAA,CAAa;gBAEnDn1G,IAAU;oBAEHqhH,WAAwD,SAA7C,CAAA,IAAAt6H,IAAAA,CAAKk5H,iBAAAA,CAAkBl5H,IAAAA,CAAK23H,gBAAAA,CAAAA,KAAAA,KAAiB,MAAA,IAAA,IAAIyC;oBAC5DG,eAAsD,SAAvC,CAAA,IAAAv6H,IAAAA,CAAKg5H,gBAAAA,CAAiBe,EAAAA,KAAAA,KAAiB,MAAA,IAAA,IAAIM;oBAAAA,GAE5DphH,CAAAA;gBAAAA;gBAGL,MAAA,EAAM,WAAEqhH,CAAAA,EAAS,eAAEC,CAAAA,EAAa,qBAAEC,CAAAA,EAAAA,GAAwBvhH,GAEpDygH,IAAgBY,QAAAA,IAAAA,IAAat6H,IAAAA,CAAKk5H,iBAAAA,CAAkBl5H,IAAAA,CAAK23H,gBAAAA,GACzDiB,IAAe2B,QAAAA,IAAAA,IAAiBv6H,IAAAA,CAAKg5H,gBAAAA,CAAiBe,IAEtDU,IAAAA,AAAaf,CAAAA,QAAAA,IAAAA,KAAa,IAAbA,EAAee,UAAAA,AAAAA,KAAc7B,CAAAA,QAAAA,IAAAA,KAAY,IAAZA,EAAc6B,UAAAA,AAAAA;gBAC1DA,KAIFz6H,IAAAA,CAAK06H,cAAAA,CAAeX,GAAkBU,IAGxCz6H,IAAAA,CAAK26H,UAAAA,CAAW,mBAAmBT,GAAaH,IAG5CL,KAAAA,MACI15H,IAAAA,CAAKs4H,cAAAA,CAAeoB,GAAeO,IAAAA,MAIrCj6H,IAAAA,CAAK06H,cAAAA,CAAeX,GAAkBU,IAGxC7B,KAAAA,MACIA,EAAagC,yBAAAA,CAA0B56H,IAAAA,CAAK6nG,YAAAA,GAKhD+wB,KACFA,EAAaR,iBAAAA,CAAkBp4H,IAAAA,CAAK2iE,OAAAA,EAASq3D,IAAAA,MAKzCh6H,IAAAA,CAAKq4H,SAAAA,CAAU0B,GAAkBS,IACvCx6H,IAAAA,CAAK26H,UAAAA,CAAW,cAAcT,GAAaH,IAGvCnB,KAAAA,MACI54H,IAAAA,CAAKs4H,cAAAA,CAAeM,GAAcoB,IAE1Ch6H,IAAAA,CAAK26H,UAAAA,CAAW,iBAAiBT,GAAaH,IAE5B,SAAlB,CAAA,IAAA/5H,IAAAA,CAAK2iE,OAAAA,CAAQ+E,KAAAA,AAAAA,KAAAA,KAAK,MAAA,KAAA,EAAE+7C,aAAAA,CAAc0W,IAClCn6H,IAAAA,CAAKo3H,gBAAAA,GAAAA,CAAmB;YAC1B;YAQA,iBAAiBpxE,CAAAA,EAAAA;gBACf,MAAM60E,IAAkB76H,IAAAA,CAAKs5H,kBAAAA,CAAmBtzE;gBAChD,IAAA,CAAK60E,GACH;gBAEF,IAAI76H,IAAAA,CAAKs3H,gBAAAA,CAAiBv/G,GAAAA,CAAIiuC,IAC5B,OAAOhmD,IAAAA,CAAKs3H,gBAAAA,CAAiB30H,GAAAA,CAAIqjD;gBAEnC,IAAI60E,aAA2BjN,IAE7B,OADA5tH,IAAAA,CAAKs3H,gBAAAA,CAAiBtsG,GAAAA,CAAIg7B,GAAO60E,IAC1BA;gBAET,MAAMC,IAAW,IAAID;gBAErB,OADA76H,IAAAA,CAAKs3H,gBAAAA,CAAiBtsG,GAAAA,CAAIg7B,GAAO80E,IAC1BA;YACT;YAOA,MAAA,eAAqB90E,CAAAA,EAAey0E,IAAAA,CAAa,CAAA,EAAA;gBAAA,IAAA;gBAC/C,MAAMtM,IAA+B,SAAtB,CAAA,IAAAnuH,IAAAA,CAAK84H,UAAAA,CAAW9yE,EAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI,IAAI+d,IACvCg3D,IAAc/6H,IAAAA,CAAKs5H,kBAAAA,CAAmBtzE,IACtCg1E,IAAsBh7H,IAAAA,CAAK83H,gBAAAA,CAAiB9xE;gBAC9C+0E,KAAeC,KAAAA,CAAwBh7H,IAAAA,CAAKy3H,aAAAA,CAAc1/G,GAAAA,CAAIijH,MAChEA,CAAAA,EAAoB9M,SAAAA,CAAUC,IAC9B6M,EAAoB9gH,MAAAA,CAAO/R,IAAAA,CAAK,WAAW;oBAAEgmH,QAAAA;gBAAAA,IACzCsM,IAGFz6H,IAAAA,CAAK2iE,OAAAA,CAAQ14C,IAAAA,CAAKkkG,GAAQsM,KAAAA,MAEpBz6H,IAAAA,CAAK2iE,OAAAA,CAAQ14C,IAAAA,CAAKkkG,IAE1BnuH,IAAAA,CAAKy3H,aAAAA,CAAcrnH,GAAAA,CAAI4qH,EAAAA;YAE3B;YAMA,MAAA,eAAqBC,CAAAA,EAAwBC,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBAC3C,IAAKl7H,IAAAA,CAAK8oD,aAAAA,EAAV;oBAKA,IAAImyE,GAAY;wBACdj7H,IAAAA,CAAKm7H,iBAAAA,GAAoBF;wBACzB,MAAMG,IAA8C,SAA1B,CAAA,IAAiB,SAAjB,CAAA,IAAAF,EAAYxzD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAEkM,OAAAA,AAAAA,KAAAA,KAAO,MAAA,KAAA;wBAEnC,SAAjB,CAAA,IAAAsnD,EAAYxzD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,KAAA,EAAE+7C,aAAAA,CAAAA,CAAewX,EAAWI,UAAAA,GAC3B,SAAlB,CAAA,IAAAr7H,IAAAA,CAAK2iE,OAAAA,CAAQ+E,KAAAA,AAAAA,KAAAA,KAAK,MAAA,KAAA,EAAE+7C,aAAAA,CAAAA,CAAewX,EAAWI,UAAAA,GAE9Cr7H,IAAAA,CAAKm7H,iBAAAA,CAAkB/C,iBAAAA,CAAkBp4H,IAAAA,CAAK2iE,OAAAA,EAASu4D,IAAAA,MACjDl7H,IAAAA,CAAKm7H,iBAAAA,CAAkBG,KAAAA,IAEZ,SAAjB,CAAA,IAAAJ,EAAYxzD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,KAAA,EAAE+7C,aAAAA,CAAc2X;oBACnC;oBACsB,SAAtB,CAAA,IAAAp7H,IAAAA,CAAKm7H,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,KAAA,EAAE30E,IAAAA,IACF,SAAtB,CAAA,IAAAxmD,IAAAA,CAAKm7H,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,KAAA,EAAEx/G,KAAAA,IACxB3b,IAAAA,CAAKm7H,iBAAAA,GAAAA,KAAoBr6H;gBAhBzB,OAFEd,IAAAA,CAAKk4H,mBAAAA,GAAsB+C;YAmB/B;YAOA,MAAA,UAAmClB,CAAAA,EAA0Bt4H,CAAAA,EAAAA;gBAC3D,MAAMwY,IAASja,IAAAA,CAAK2iE,OAAAA;gBAEpB,IAAA,CAAK3iE,IAAAA,CAAK8oD,aAAAA,EAER,OAAA,KADA9oD,CAAAA,IAAAA,CAAK+3H,aAAAA,GAAgBgC,CAAAA;gBAIvB,MAAMC,IAAYh6H,IAAAA,CAAK83H,gBAAAA,CAAiBiC;gBAExC,IAAIC,GAAW;oBACb,MAAMuB,IAAgBv7H,IAAAA,CAAK6nG,YAAAA,EACrB2zB,IAAYxB;oBAIlB,IAFAh6H,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,mBAAmB+hH,IAElC/5H,IAAAA,CAAK6nG,YAAAA,CAAa/+C,aAAAA,EAAe;wBACnC,MAAMzkB,IAAU;4BAAEpqB,QAAAA;4BAAQshH,eAAAA;4BAAeC,WAAAA;wBAAAA;wBAAAA,MACnCx7H,IAAAA,CAAK6nG,YAAAA,CAAa+mB,WAAAA,CAAYvqF,IACpCrkC,IAAAA,CAAK6nG,YAAAA,CAAa3tF,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAI27C,GAAgBzf,GAASrkC,IAAAA,CAAK6nG,YAAAA,IAC9E7nG,IAAAA,CAAK6nG,YAAAA,CAAangC,KAAAA,CAAMlgE,KAAAA;oBAC1B;oBAGA,MAAMi0H,IAAaz7H,IAAAA,CAAKu3H,cAAAA,CAAe50H,GAAAA,CAAIo3H;oBAAAA,MACrC0B,CAAAA,QAAAA,IAAAA,KAAU,IAAVA,EAAYz2D,kBAAAA,EAAAA,GAGlBhlE,IAAAA,CAAK6nG,YAAAA,GAAe2zB,GACpBx7H,IAAAA,CAAK23H,gBAAAA,GAAmBoC,GACxB9/G,EAAOjG,MAAAA,CAAO2iD,gBAAAA,CAAiB6kE,EAAU5kE,MAAAA,GAAAA,MAGnC52D,IAAAA,CAAK6nG,YAAAA,CAAa16D,WAAAA,CAAYlzB;oBAEpC,MAAMoqB,IAAU;wBAAEpqB,QAAAA;wBAAQshH,eAAAA;wBAAeC,WAAAA;wBAAW/5H,MAAAA;oBAAAA;oBAAAA,MAC9CzB,IAAAA,CAAK6nG,YAAAA,CAAa8mB,SAAAA,CAAUtqF,IAClCrkC,IAAAA,CAAK6nG,YAAAA,CAAa3tF,MAAAA,CAAO/R,IAAAA,CAAK,YAAY,IAAI07C,GAAcxf,GAASrkC,IAAAA,CAAK6nG,YAAAA;gBAC5E,OACE7nG,IAAAA,CAAK6sB,OAAAA,CAAQ5lB,KAAAA,CAAM,SAAS8yH,GAAkB;YAElD;YAEQ,WAAWryH,CAAAA,EAAiCwyH,CAAAA,EAAqBH,CAAAA,EAAAA;gBACvE,MAAMx4G,IAASvhB,IAAAA,CAAKs5H,kBAAAA,CAAmBY,IACjC5pH,IAAOtQ,IAAAA,CAAKs5H,kBAAAA,CAAmBS;gBACrC/5H,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAW;oBAC1BwyH,aAAa34G;oBACbm6G,YAAYxB;oBACZH,kBAAkBzpH;oBAClBqrH,iBAAiB5B;gBAAAA;YAErB;QAAA;QC3kBK,SAAS6B;YACd,MAAMxkG,IAAuB;gBAC3BykG,OAAO,CAACz4H,GAAO2B;oBACb,MAAM+2H,IAAM1kG,EAAIh0B,KAAAA;oBAChBg0B,EAAIh0B,KAAAA,GAAQA;oBACZ,IAAA;wBACE,OAAO2B;oBACT,EAAE,OAAOua,GAAAA;wBACP,MAAMA;oBACR,SAAA;wBACE8X,EAAIh0B,KAAAA,GAAQ04H;oBACd;gBAAA;gBAEF14H,OAAAA,KAAOtC;YAAAA;YAET,OAAOs2B;QACT;QAKO,SAAS2kG,GAAmB13F,CAAAA;YACjC,OAAOA,EAAQjhC,KACjB;QAAA;QC3BO,MAAM44H,KAA4D;YACvEC,wBAAwB;QAAA;QAanB,MAAMC;YAMX,YAAmBjjH,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,OAAAA,GAAAA,GAJX,IAAA,CAAAynF,QAAAA,GAAAA,CAAW,GACX,IAAA,CAAAy7B,cAAAA,GAAiB,IAAI7tG,KACrB,IAAA,CAAA8tG,WAAAA,GAAc,IAAI9tG,KAqCnB,IAAA,CAAA+tG,qBAAAA,GAAyBC,CAAAA;oBAC9B,IAAKt8H,IAAAA,CAAK0gG,QAAAA,EAAV;wBAGA,KAAK,MAAA,CAAOj6F,GAAAA,CAAO81H,GAAWC,EAAAA,CAAAA,IAAqBx8H,IAAAA,CAAKo8H,WAAAA,CAAYluF,OAAAA,GAAW;4BAC7E,MAAMhpC,IAAMlF,IAAAA,CAAKiZ,OAAAA,CAAQwjH,YAAAA;4BACzB,KAAK,MAAA,CAAOt3D,GAAAA,CAAWu3D,GAAcz+E,EAAAA,CAAAA,IAAUj+C,IAAAA,CAAKm8H,cAAAA,CAAejuF,OAAAA,GAAW;gCAC5E,IAAIznC,MAASi2H,KAAgBz+E,IAAOu+E,KAAmBt3H,GACrD;gCAGgBq3H,EAAUp3D,MAE1BnlE,IAAAA,CAAKm8H,cAAAA,CAAettG,MAAAA,CAAOs2C;4BAE/B;wBACF;wBAEAnlE,IAAAA,CAAK28H,cAAAA,GAAiB73H,oBAAoB9E,IAAAA,CAAKq8H,qBAAAA;oBAf/C;gBAeqE;YArDjB;YAQtD,kBAAkB51H,CAAAA,EAAc+1H,CAAAA,EAAyBI,CAAAA,EAAAA;gBACvD58H,IAAAA,CAAKo8H,WAAAA,CAAYpxG,GAAAA,CAAIvkB,GAAM;oBAACm2H;oBAASJ;iBAAAA;YACvC;YAOA,uBAAuB/1H,CAAAA,EAAc0+D,CAAAA,EAAAA;gBACnCnlE,IAAAA,CAAKm8H,cAAAA,CAAenxG,GAAAA,CAAIm6C,GAAU;oBAAC1+D;oBAAMzG,IAAAA,CAAKiZ,OAAAA,CAAQwjH,YAAAA;iBAAAA;YACxD;YAMA,MAAMt3D,CAAAA,EAAAA;gBACJ,MAAM03D,IAAiB78H,IAAAA,CAAKm8H,cAAAA,CAAex5H,GAAAA,CAAIwiE;gBAC3C03D,KACF78H,IAAAA,CAAKm8H,cAAAA,CAAenxG,GAAAA,CAAIm6C,GAAU;oBAAC03D,CAAAA,CAAe,EAAA;oBAAI78H,IAAAA,CAAKiZ,OAAAA,CAAQwjH,YAAAA;iBAAAA;YAEvE;YA8BO,kBAAAK;gBACL,KAAK,MAAA,CAAO37F,GAAAA,CAAIo7F,EAAAA,CAAAA,IAAev8H,IAAAA,CAAKo8H,WAAAA,CAAYluF,OAAAA,GAC9C,KAAK,MAAA,CAAOi3B,EAAAA,IAAanlE,IAAAA,CAAKm8H,cAAAA,CAAejuF,OAAAA,GACzBquF,EAAUp3D,MAE1BnlE,IAAAA,CAAKm8H,cAAAA,CAAettG,MAAAA,CAAOs2C;YAInC;YAKA,QAAAngE;gBACEhF,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GAChB1gG,IAAAA,CAAKq8H,qBAAAA;YACP;YAKA,OAAAp8D;gBACEjgE,IAAAA,CAAK0gG,QAAAA,GAAAA,CAAW,GAChBl7F,mBAAmBxF,IAAAA,CAAK28H,cAAAA;YAC1B;QAAA;QCtHFp5H;QAmEO,MAAMw5H,KAAe;YAC1BC,yBAAyB;YACzBh4E,YAAY;YACZi4E,SAAS;YACTC,QAAQ;YACRC,OAAO;YACPr7D,MAAM;YACN7c,WAAW;YACXC,YAAY;YACZk4E,UAAU;YACVC,WAAW;YACX9gC,SAAS;YACTC,UAAU;QAAA;QAMZ,IAAYyuB,ICxFAqS;QAAAA,CDwFZ,SAAYrS,CAAAA;YAIV,CAAA,CAAA,EAAA,IAAA,GAAA,EAAA,GAAA,QAIA,CAAA,CAAA,EAAA,MAAA,GAAA,EAAA,GAAA,UAIA,CAAA,CAAA,EAAA,GAAA,GAAA,EAAA,GAAA;QACD,EAbWA,MAAAA,CAAAA,KAAoB,CAAA,CAAA;QA+SzB,MAAMsS;YAEX,OAAA,YAAOC;gBACL,MAAMp6H,IAAQ24H,GAAWwB,GAAOE,OAAAA;gBAEhC,IAAA,CAAKr6H,GACH,MAAM,IAAI+C,MAAM;gBAGlB,OAAO/C;YACT;YA8GA,IAAA,cAAWk2D;gBACT,OAAOt5D,IAAAA,CAAKgU,MAAAA,CAAOslD,WACrB;YAAA;YAKA,IAAA,kBAAWC;gBACT,OAAOv5D,IAAAA,CAAKgU,MAAAA,CAAOulD,eACrB;YAAA;YAMA,IAAA,eAAWC;gBACT,OAAOx5D,IAAAA,CAAKgU,MAAAA,CAAOwlD,YACrB;YAAA;YAKA,IAAA,mBAAWC;gBACT,OAAOz5D,IAAAA,CAAKgU,MAAAA,CAAOylD,gBACrB;YAAA;YAKA,IAAA,YAAWC;gBACT,OAAO15D,IAAAA,CAAKgU,MAAAA,CAAO0lD,SACrB;YAAA;YAKA,IAAA,gBAAWC;gBACT,OAAO35D,IAAAA,CAAKgU,MAAAA,CAAO2lD,aACrB;YAAA;YAKA,IAAA,aAAWC;gBACT,OAAO55D,IAAAA,CAAKgU,MAAAA,CAAO4lD,UACrB;YAAA;YAKA,IAAA,iBAAWC;gBACT,OAAO75D,IAAAA,CAAKgU,MAAAA,CAAO6lD,cACrB;YAAA;YAKA,IAAA,UAAW5D;gBACT,OAAOj2D,IAAAA,CAAKgU,MAAAA,CAAOiiD,OACrB;YAAA;YA2BA,IAAA,QAAWzT;gBACT,OAAOxiD,IAAAA,CAAKgY,KAAAA,CAAMwqC,KACpB;YAAA;YAKA,IAAA,eAAWqlD;gBACT,OAAO7nG,IAAAA,CAAKyuH,QAAAA,CAAS5mB,YACvB;YAAA;YAKA,IAAA,mBAAW8vB;gBACT,OAAO33H,IAAAA,CAAKyuH,QAAAA,CAASkJ,gBACvB;YAAA;YAKA,IAAA,YAAWD;gBACT,OAAO13H,IAAAA,CAAKyuH,QAAAA,CAASiJ,SACvB;YAAA;YAKA,IAAA,SAAWL;gBACT,OAAOr3H,IAAAA,CAAKyuH,QAAAA,CAAS4I,MACvB;YAAA;YAKA,IAAA,eAAWpjE;gBACT,OAAOj0D,IAAAA,CAAKgU,MAAAA,CAAO0jD,YACrB;YAAA;YAKA,IAAA,cAAW5C;gBACT,OAAO90D,IAAAA,CAAKgU,MAAAA,CAAO8gD,WACrB;YAAA;YAMA,IAAA,aAAWP;gBACT,OAAOv0D,IAAAA,CAAKgU,MAAAA,CAAOugD,UACrB;YAAA;YAWA,IAAA,UAAWsmD;gBACT,OAAO76G,IAAAA,CAAK09H,QACd;YAAA;YAeA,IAAA,cAAWt4F;gBACT,OAAOplC,IAAAA,CAAK4sC,eAAAA,CAAgBxH,WAC9B;YAAA;YAEA,IAAA,YAAuBu4F,CAAAA,EAAAA;gBACrB39H,IAAAA,CAAK4sC,eAAAA,CAAgBxH,WAAAA,GAAcu4F;YACrC;YA8BO,KAAyDj2H,CAAAA,EAAuBU,CAAAA,EAAAA;gBACrFpI,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAKT,GAAWU;YAC9B;YAIO,GAAuDV,CAAAA,EAAuBC,CAAAA,EAAAA;gBACnF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOzS,EAAAA,CAAGC,GAAWC;YACnC;YAIO,KAAyDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACrF,OAAO3H,IAAAA,CAAKka,MAAAA,CAAOpS,IAAAA,CAAKJ,GAAWC;YACrC;YAKO,IAAwDD,CAAAA,EAAuBC,CAAAA,EAAAA;gBACpF3H,IAAAA,CAAKka,MAAAA,CAAOrS,GAAAA,CAAIH,GAAWC;YAC7B;YA4DA,YAAYsR,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA,GAAAA;gBAlYZ,IAAA,CAAA4iH,KAAAA,GAAkB92H,CAAAA,IAAsBw4H,GAAOE,OAAAA,CAAQ5B,KAAAA,CAAM77H,IAAAA,EAAM+E,IAWnD,IAAA,CAAA64H,OAAAA,GAAUC,IAKnB,IAAA,CAAA3jH,MAAAA,GAAS,IAAIhT,GA2Cb,IAAA,CAAAqtH,MAAAA,GAAiBh2G,OAAOypE,iBAAAA,EAmHvB,IAAA,CAAA81C,aAAAA,GAAAA,CAAyB,GA6DzB,IAAA,CAAAC,mBAAAA,GAAAA,CAA+B,GAWhC,IAAA,CAAAn7D,oBAAAA,GAAAA,CAAgC,GAK/B,IAAA,CAAA86D,QAAAA,GAAAA,CAAoB,GAarB,IAAA,CAAAM,wBAAAA,GAAAA,CAAoC,GAgBpC,IAAA,CAAAxJ,gBAAAA,GAAoBl1G,CAAAA;oBACzB1I,EAAOS,WAAAA,GAAcoB,KAAAA,CAAM6G,GAAGA,EAAE2+G,KAAAA;gBAAM,GAUhC,IAAA,CAAAC,QAAAA,GAAoB,IAAIvI,IAKxB,IAAA,CAAAwI,UAAAA,GAAqB,GAKrB,IAAA,CAAAj4E,cAAAA,GAAAA,CAA0B,GA0D1B,IAAA,CAAAmgB,gBAAAA,GAAkC,CAAC,GAmSnC,IAAA,CAAA+3D,uBAAAA,GAA2B9+G,CAAAA;oBAAAA,IAAAA;oBACjCA,EAAEksG,cAAAA,IACFxrH,IAAAA,CAAK0gB,KAAAA,CAAMu/C,IAAAA,IACXjgE,IAAAA,CAAK6sB,OAAAA,CAAQlU,SAAAA,CAAU,uBAAuB2G;oBAC9C,MAAM++G,IAAY9kH,SAASC,aAAAA,CAAc;oBACzC6kH,EAAUz+H,EAAAA,GAAK,kCACfy+H,EAAU1kH,KAAAA,CAAMC,QAAAA,GAAW,YAC3BykH,EAAU1kH,KAAAA,CAAME,MAAAA,GAAS,MACzBwkH,EAAU1kH,KAAAA,CAAMa,IAAAA,GAAO,OACvB6jH,EAAU1kH,KAAAA,CAAMc,GAAAA,GAAM,OACtB4jH,EAAU1kH,KAAAA,CAAMktD,OAAAA,GAAU,QAC1Bw3D,EAAU1kH,KAAAA,CAAM2kH,aAAAA,GAAgB,UAChCD,EAAU1kH,KAAAA,CAAMoD,SAAAA,GAAY,yBAC5BshH,EAAU1kH,KAAAA,CAAM60C,eAAAA,GAAkB,SAClC6vE,EAAU1kH,KAAAA,CAAMu+B,OAAAA,GAAU,QAC1BmmF,EAAU1kH,KAAAA,CAAM4kH,WAAAA,GAAc;oBAE9B,MAAMC,IAAMjlH,SAASC,aAAAA,CAAc;oBAmBnC,IAlBAglH,EAAIC,SAAAA,GAAY,0rBAiBhBJ,EAAUtkH,WAAAA,CAAYykH,IACP,SAAX,CAAA,IAAAx+H,IAAAA,CAAKsZ,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,KAAA,IAAA,EAAEg9C,aAAAA,EAAe;wBAC9Bt2D,IAAAA,CAAKsZ,MAAAA,CAAOg9C,aAAAA,CAAcv8C,WAAAA,CAAYskH;wBACtC,MAAMx7E,IAAS27E,EAAIE,aAAAA,CAAc;wBACjC77E,QAAAA,KAAAA,EAAQx4B,gBAAAA,CAAiB,SAAS,IAAMqU,SAASigG,MAAAA;oBACnD;gBAAA,GAGM,IAAA,CAAAC,8BAAAA,GAAAA,CAAiC,GACjC,IAAA,CAAAC,WAAAA,GAAwB,EAAA,EAoGxB,IAAA,CAAAlwE,SAAAA,GAAAA,CAAY,GA2cZ,IAAA,CAAAmwE,UAAAA,GAAAA,CAAa,GACb,IAAA,CAAAC,WAAAA,GAAAA,CAAc,GACd,IAAA,CAAAC,cAAAA,GAAiB,IAAIt4H,GAkEtB,IAAA,CAAAu4H,qBAAAA,GAAwB,GAKxB,IAAA,CAAAlwB,iBAAAA,GAAoB,GAEnB,IAAA,CAAAmwB,MAAAA,GAAS,GA+DT,IAAA,CAAAC,mBAAAA,GAA0G,EAAA,EA5+BhHlmH,IAAU;oBAAA,GAAKskH,GAAO6B,uBAAAA;oBAAAA,GAA4BnmH,CAAAA;gBAAAA,GAClDjZ,IAAAA,CAAKqmE,gBAAAA,GAAmBptD,GAExBvT,EAAMI,MAAAA,IAGN9F,IAAAA,CAAKm1D,OAAAA,GAAU,IAAI09D,GAAcrvH,QAAQ+V;gBAGzC,MAAM8lH,IAAW,IAAIx2D;gBACrB,IAAA,CAAK5vD,EAAQqmH,sCAAAA,IAAAA,CAA4Ct/H,CAAAA,IAAAA,CAAKu/H,WAAAA,GAAcF,EAASr1G,IAAAA,EAAAA,GAAS;oBAC5F,MAAMrP,IAAUpB,SAASC,aAAAA,CAAc;oBAUvC,IATAmB,EAAQq7G,SAAAA,GAAY,8EACpBz8G,SAASO,IAAAA,CAAKC,WAAAA,CAAYY,IAE1B0kH,EAASt2D,WAAAA,CAAY5qB,OAAAA,CAAQ,SAAUn0B,CAAAA;wBACrC,MAAMw1G,IAAcjmH,SAASC,aAAAA,CAAc;wBAC3CgmH,EAAYxJ,SAAAA,GAAY,6BAA6BhsG,GACrDzQ,SAASO,IAAAA,CAAKC,WAAAA,CAAYylH;oBAC5B,IAEIvmH,EAAQwmH,eAAAA,EAAiB;wBAC3B,MAAMnmH,IAASC,SAASw+C,cAAAA,CAAe9+C,EAAQwmH,eAAAA;wBAC3CnmH,KACFA,EAAOg9C,aAAAA,CAAc/O,WAAAA,CAAYjuC;oBAErC;oBAEA;gBACF;gBAuDA,IAtDEtZ,IAAAA,CAAKu/H,WAAAA,GAAAA,CAAc,GAKjB3mH,QAAQhB,GAAAA,IAAAA,CAAQqB,EAAQymH,0BAAAA,IAE1B9mH,CAAAA,QAAQhB,GAAAA,CACN,CAAA,4BAAA,EAA+BimH,GAAAA,CAAAA,CAAAA,EAC/B,+GAGFjlH,QAAQhB,GAAAA,CACN,uEAMFgB,QAAQhB,GAAAA,CAAI,SAAS,0BAA0B,uBAAA,GAI7CqB,EAAQytD,kBAAAA,IACV1mE,CAAAA,IAAAA,CAAK+9H,mBAAAA,GAAAA,CAAsB,CAAA,GAG7B/9H,IAAAA,CAAK6sB,OAAAA,GAAUjW,EAAOS,WAAAA,IAGlBrX,IAAAA,CAAK6sB,OAAAA,CAAQ/V,YAAAA,KAAiBL,EAASwB,KAAAA,IACzConH,EAASt1D,kBAAAA,IAGX/pE,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,uBAAA,CACe,MAA9BiB,EAAQ0mH,iBAAAA,GACV3/H,IAAAA,CAAK4/H,sBAAAA,GAAyB;oBAAA,GACzB5D,EAAAA;gBAAAA,IAAAA,CAEkC,MAA9B/iH,EAAQ0mH,iBAAAA,GACjB3/H,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,4HAEFrY,IAAAA,CAAK4/H,sBAAAA,GAAyB,IAAA,IAE9B5/H,IAAAA,CAAK4/H,sBAAAA,GAAyB;oBAAA,GACzB5D,EAAAA;oBAAAA,GACA/iH,EAAQ0mH,iBAAAA;gBAAAA,GAGf3/H,IAAAA,CAAKouB,iBAAAA,GAAoB,IAAI8tG,GAAiB;oBAAEO,cAAcx3H,KAAKC,GAAAA;gBAAAA,IAEnElF,IAAAA,CAAKy/H,eAAAA,GAAkBxmH,EAAQwmH,eAAAA,EAE3BxmH,EAAQwmH,eAAAA,EAAiB;oBAI3B,IAHAz/H,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,qCAAqCiB,EAAQwmH,eAAAA,GAGP,SAArDlmH,SAASw+C,cAAAA,CAAe9+C,EAAQwmH,eAAAA,GAClC,MAAM,IAAIt5H,MAAM;oBAGlBnG,IAAAA,CAAKsZ,MAAAA,GAA4BC,SAASw+C,cAAAA,CAAe9+C,EAAQwmH,eAAAA;gBACnE,OAAWxmH,EAAQ41C,aAAAA,GACjB7uD,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,mCAAmCiB,EAAQ41C,aAAAA,GAC9D7uD,IAAAA,CAAKsZ,MAAAA,GAASL,EAAQ41C,aAAAA,AAAAA,IAEtB7uD,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,mCACnBhY,IAAAA,CAAKsZ,MAAAA,GAA4BC,SAASC,aAAAA,CAAc,SAAA;gBAGtDxZ,IAAAA,CAAKsZ,MAAAA,IAAAA,CAAWL,EAAQ4mH,uBAAAA,IAC1B7/H,IAAAA,CAAKsZ,MAAAA,CAAO+Q,gBAAAA,CAAiB,eAAgB68C,CAAAA;oBAC3CA,EAAIskD,cAAAA;gBAAgB;gBAIxB,IAgBI/jF,GACAC,GACAyrF,GACAl+D,GACA3lC,GACAm/B,GArBAqG,IAAiC,SAAnB,CAAA,IAAA77C,EAAQ67C,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAIrC,GAAYsC,KAAAA;gBAChD97C,EAAQkB,KAAAA,IAASlB,EAAQoB,MAAAA,IAAWpB,EAAQmhB,QAAAA,GAAAA,CAAAA,KACnBt5B,MAAxBmY,EAAQ67C,WAAAA,IACVA,CAAAA,IAAcrC,GAAYsC,KAAAA,AAAAA,GAE5B/0D,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,6BAA6BiB,EAAQkB,KAAAA,GAAQ,QAAQlB,EAAQoB,MAAAA,CAAAA,IACtEpB,EAAQ67C,WAAAA,IAClB90D,CAAAA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,2BACnB88C,IAAcrC,GAAYgJ,SAAAA,AAAAA,GAG5Bz7D,IAAAA,CAAKynH,eAAAA,GAAkBxuG,EAAQwuG,eAAAA,EAC/BznH,IAAAA,CAAKwuH,YAAAA,GAAev1G,EAAQu1G,YAAAA,EAE5BxuH,IAAAA,CAAK8/H,oBAAAA,GAAuBhrE,GAQQ,YAAA,OAAzB77C,EAAQ81C,YAAAA,GAAAA,EACdtnB,iBAAAA,CAAAA,EAAiB0rF,2BAAAA,CAAAA,EAA2B1kE,yBAAAA,CAAAA,EAAyBn/B,WAAAA,CAAAA,EAAW2lC,sBAAAA,CAAAA,EAAAA,GAAyB;oBAAA,GACtGh8C,EAAQ8mH,QAAAA,GAAW3M,KAAyBF,EAAAA;oBAAAA,GAC7Cj6G,EAAQ81C,YAAAA;gBAAAA,IAGbtnB,CAAAA,IAAAA,CAAAA,CAAoBxuB,EAAQ8mH,QAAAA,EAC5B5M,IAAAA,CAA4B,GAC5B1kE,IAA0Bx1C,EAAQ81C,YAAAA,EAClCkG,IAAuBh8C,EAAQ81C,YAAAA,GAAe,SAAS,aACvDz/B,IAAYrW,EAAQ81C,YAAAA,GAAethC,GAAeI,OAAAA,GAAUJ,GAAeG,KAAAA,AAAAA,GAGzEulG,KAA6B1kE,KAC/BzuD,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,wLAKAU,EAAQ8mH,QAAAA,IACVr4F,CAAAA,IAAY,GAAA,GAGTzuB,EAAQ81C,YAAAA,IAAgBz/B,MAAc7B,GAAeG,KAAAA,IACxD8Z,CAAAA,IAAY,CAAA,GAIdA,IAA0C,SAA9B,CAAA,IAAiB,SAAjB,CAAA,IAAAzuB,EAAQyuB,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIA,CAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI;gBAG9C,IAAI/hC,IAA2BD,EAAMW,SAAAA,CAAU;gBAC/C,IAAA,CAAKV,GAEH,IAAA;oBACE3F,IAAAA,CAAK4sC,eAAAA,GAAkB,IAAIK,GAA8B;wBACvD4hB,eAAe7uD,IAAAA,CAAKsZ,MAAAA;wBACpBw1C,oBAAoB9uD,IAAAA,CAAKg+H,wBAAAA;wBACzBv2F,iBAAiBA;wBACjBsnB,cAAcokE;wBACd1kE,yBAAyBA;wBACzB/mB,WAAWA;wBACXsnB,iBAAiB/1C,EAAQ+1C,eAAAA;wBACzBR,iBAAiBv1C,EAAQu1C,eAAAA;wBACzBppB,aAAansB,EAAQmsB,WAAAA;wBACrB8oB,gBAAgBj1C,EAAQi1C,cAAAA;wBACxBh/B,kBAAkBlvB,IAAAA,CAAK4/H,sBAAAA,GACnB;4BACE1wG,kBAAkBlvB,IAAAA,CAAKouB,iBAAAA;4BACvBa,oBAAoBjvB,IAAAA,CAAK4/H,sBAAAA,CAAuB3D,sBAAAA;wBAAAA,IAElD;wBACJhtE,mBAA4C,SAAzB,CAAA,IAAAh2C,EAAQg2C,iBAAAA,AAAAA,KAAAA,KAAiB,MAAA,IAAA,IAAIjvD,IAAAA,CAAKo+H,uBAAAA;wBACrDlvE,uBAAuBj2C,EAAQi2C,qBAAAA;oBAAAA;gBAEnC,EAAE,OAAO5vC,GAAAA;oBACPtf,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,CAAA,gDAAA,EAAoDiH,EAAY3E,OAAAA,CAAAA,oKAAAA,CAAAA,GAKlEhV,IAAAA,CAA2B;gBAC7B;gBAGEA,KACF3F,CAAAA,IAAAA,CAAK4sC,eAAAA,GAAkB,IAAIwlB,GAAiC;oBAC1DvD,eAAe7uD,IAAAA,CAAKsZ,MAAAA;oBACpBw1C,oBAAoB9uD,IAAAA,CAAKg+H,wBAAAA;oBACzBjvE,cAAcokE;oBACd3kE,iBAAiBv1C,EAAQu1C,eAAAA;oBACzBppB,aAAansB,EAAQmsB,WAAAA;oBACrB8oB,gBAAgBj1C,EAAQi1C,cAAAA;gBAAAA,EAAAA,GAI5BluD,IAAAA,CAAKgU,MAAAA,GAAS,IAAIu/C,GAAO;oBACvBj6C,QAAQtZ,IAAAA,CAAKsZ,MAAAA;oBACb+qB,SAASrkC,IAAAA,CAAK4sC,eAAAA;oBACdmiB,cAAcokE;oBACdl+D,sBAAsBA;oBACtBE,SAASn1D,IAAAA,CAAKm1D,OAAAA;oBACd/6B,UAA0B,SAAhB,CAAA,IAAAnhB,EAAQmhB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAKnhB,EAAQkB,KAAAA,IAASlB,EAAQoB,MAAAA,GAAS;wBAAEF,OAAOlB,EAAQkB,KAAAA;wBAAOE,QAAQpB,EAAQoB,MAAAA;oBAAAA,IAAWq4C,GAAWC,IAAAA;oBAC/Hv4C,YAAYnB,EAAQmB,UAAAA;oBACpB06C,aAAAA;oBACAP,YAAYt7C,EAAQ+mH,oBAAAA,GAAuB,IAAsB,SAAlB,CAAA,IAAA/mH,EAAQs7C,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI;gBAAA,IAKvErmC,GAAcoB,SAAAA,GAAYA,GAEtBrW,EAAQu1C,eAAAA,IACVxuD,CAAAA,IAAAA,CAAKwuD,eAAAA,GAAkBv1C,EAAQu1C,eAAAA,CAAgBv8C,KAAAA,EAAAA,GAGjDjS,IAAAA,CAAKu0H,MAAAA,GAAuB,SAAd,CAAA,IAAAt7G,EAAQs7G,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIv0H,IAAAA,CAAKu0H,MAAAA,EAErCv0H,IAAAA,CAAK6uG,mBAAAA,GAAiD,SAA3B,CAAA,IAAA51F,EAAQ41F,mBAAAA,AAAAA,KAAAA,KAAmB,MAAA,IAAA,IAAI7uG,IAAAA,CAAK6uG,mBAAAA,EAC/D7uG,IAAAA,CAAKigI,cAAAA,GAAuC,SAAtB,CAAA,IAAAhnH,EAAQgnH,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAIjgI,IAAAA,CAAKigI,cAAAA,EACrDjgI,IAAAA,CAAK6uG,mBAAAA,GAAsB7uG,IAAAA,CAAK6uG,mBAAAA,IAAuB,MAAO7uG,IAAAA,CAAKigI,cAAAA,EAEnEjgI,IAAAA,CAAK0gB,KAAAA,GAAQ,IAAIk0G,GAAc;oBAC7BL,QAAQv0H,IAAAA,CAAKu0H,MAAAA;oBACb19E,MAAM72C,IAAAA,CAAKkgI,SAAAA,CAAUr/G,IAAAA,CAAK7gB,IAAAA;oBAC1Bw0H,kBAAmBl1G,CAAAA,IAAMtf,IAAAA,CAAKw0H,gBAAAA,CAAiBl1G;gBAAAA,IAGjDtf,IAAAA,CAAKg+H,wBAAAA,GAA2B/kH,EAAQ+kH,wBAAAA,EAET,aAAA,OAApB/kH,EAAQ24D,OAAAA,GACjB5xE,IAAAA,CAAK4xE,OAAAA,GAAU;oBAAA,GACV+B,IAAAA;oBACHC,SAAS36D,EAAQ24D,OAAAA;gBAAAA,IAGnB5xE,CAAAA,IAAAA,CAAK4xE,OAAAA,GAAU;oBAAA,GACV+B,IAAAA;gBAAAA,GAELvyD,EAAUphB,IAAAA,CAAK4xE,OAAAA,EAAS34D,EAAQ24D,OAAAA,CAAAA,GAGlC5xE,IAAAA,CAAKgY,KAAAA,GAAQ,IAAIu4G,GAAYvwH,IAAAA,GAE7BA,IAAAA,CAAKyuH,QAAAA,GAAW,IAAIyI,GAASl3H,IAAAA,EAAMiZ,EAAQo+G,MAAAA,GAE3Cr3H,IAAAA,CAAKmtC,WAAAA,CAAYl0B,IAEhBzV,OAAe28H,oBAAAA,GAAuBngI,IAAAA,EACvCu9H,GAAO6C,aAAAA;YACT;YA+CQ,iDAAAC;gBACN,MAAA,EAAM,OAAEC,CAAAA,EAAAA,GAAUtgI,IAAAA,CAAKqmE,gBAAAA,CAAiBk6D,oCAAAA;gBACxC,IAAA,EAAI,WAAEroD,CAAAA,EAAS,mBAAEsoD,CAAAA,EAAAA,GAAsBxgI,IAAAA,CAAKqmE,gBAAAA,CAAiBk6D,oCAAAA;gBAO7D,IAAA,KANkBz/H,MAAdo3E,KACFA,CAAAA,IAAYqlD,GAAO6B,uBAAAA,CAAwBmB,oCAAAA,CAAqCroD,SAAAA,AAAAA,GAAAA,KAExDp3E,MAAtB0/H,KACFA,CAAAA,IAAoBjD,GAAO6B,uBAAAA,CAAwBmB,oCAAAA,CAAqCC,iBAAAA,AAAAA,GAAAA,CAErF96H,EAAMW,SAAAA,CAAU,yBAAyBi6H,KAAStgI,IAAAA,CAAKktB,KAAAA,IAAAA,CAAUltB,IAAAA,CAAK4+H,8BAAAA,EAAgC;oBAErG5+H,IAAAA,CAAK6+H,WAAAA,CAAYv+H,MAAAA,KAAW43E,EAAUuoD,cAAAA,IACxCzgI,IAAAA,CAAK6+H,WAAAA,CAAYn2H,MAAAA,CAAO,GAAG,IAE7B1I,IAAAA,CAAK6+H,WAAAA,CAAYl/H,IAAAA,CAAKK,IAAAA,CAAK0gB,KAAAA,CAAM+zG,UAAAA,CAAWxC,GAAAA;oBAC5C,IAAIntD,IAAQ;oBACZ,IAAK,IAAItkE,IAAI,GAAGA,IAAIR,IAAAA,CAAK6+H,WAAAA,CAAYv+H,MAAAA,EAAQE,IAC3CskE,KAAS9kE,IAAAA,CAAK6+H,WAAAA,CAAYr+H,EAAAA;oBAE5B,MAAM2P,IAAU20D,IAAQ9kE,IAAAA,CAAK6+H,WAAAA,CAAYv+H,MAAAA;oBAErCN,IAAAA,CAAK6+H,WAAAA,CAAYv+H,MAAAA,KAAW43E,EAAUuoD,cAAAA,IACpCtwH,KAAW+nE,EAAU+5C,GAAAA,IACvBjyH,CAAAA,IAAAA,CAAK4+H,8BAAAA,GAAAA,CAAiC,GACtC5+H,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CACX,8pBAYEmoH,KACFxgI,IAAAA,CAAKk+H,QAAAA,CAASjI,KAAAA,CACZ,wLAGA,6CAGJj2H,IAAAA,CAAK0gI,mBAAAA,IACL1gI,IAAAA,CAAKmI,IAAAA,CAAK,2BAA2BnI,IAAAA,CAAK4sC,eAAAA,CAAAA;gBAGhD;YACF;YAMO,sBAAA8zF;gBAAAA,IAAAA,GAAAA,GAAAA;gBAEL,MAAMC,IAAY3gI,IAAAA,CAAKsZ,MAAAA,CAAOsnH,SAAAA,CAAAA,CAAU;gBACxC5gI,IAAAA,CAAKsZ,MAAAA,CAAOunH,UAAAA,CAAWC,YAAAA,CAAaH,GAAW3gI,IAAAA,CAAKsZ,MAAAA,GACpDtZ,IAAAA,CAAKsZ,MAAAA,GAASqnH;gBAEd,MAAM1nH,IAAU;oBAAA,GAAKjZ,IAAAA,CAAKqmE,gBAAAA;oBAAkBtX,cAAc/uD,IAAAA,CAAKgU,MAAAA,CAAO+6C,YAAAA;gBAAAA,GAChE+F,IAAc90D,IAAAA,CAAK8/H,oBAAAA;gBAGzB9/H,IAAAA,CAAK4sC,eAAAA,GAAkB,IAAIwlB,GAAiC;oBAC1DvD,eAAe7uD,IAAAA,CAAKsZ,MAAAA;oBACpBw1C,oBAAoB9uD,IAAAA,CAAKg+H,wBAAAA;oBACzBjvE,cAAc91C,EAAQ81C,YAAAA;oBACtBP,iBAAiBv1C,EAAQu1C,eAAAA;oBACzBppB,aAAansB,EAAQmsB,WAAAA;oBACrB8oB,gBAAgBj1C,EAAQi1C,cAAAA;gBAAAA,IAItBluD,IAAAA,CAAKgU,MAAAA,IACPhU,IAAAA,CAAKgU,MAAAA,CAAOob,OAAAA,IAGdpvB,IAAAA,CAAKgU,MAAAA,GAAS,IAAIu/C,GAAO;oBACvBj6C,QAAQtZ,IAAAA,CAAKsZ,MAAAA;oBACb+qB,SAASrkC,IAAAA,CAAK4sC,eAAAA;oBACdmiB,cAAkC,SAApB,CAAA,IAAA91C,EAAQ81C,YAAAA,AAAAA,KAAAA,KAAY,MAAA,KAAA;oBAClCoG,SAASn1D,IAAAA,CAAKm1D,OAAAA;oBACd/6B,UAA0B,SAAhB,CAAA,IAAAnhB,EAAQmhB,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAKnhB,EAAQkB,KAAAA,IAASlB,EAAQoB,MAAAA,GAAS;wBAAEF,OAAOlB,EAAQkB,KAAAA;wBAAOE,QAAQpB,EAAQoB,MAAAA;oBAAAA,IAAWq4C,GAAWC,IAAAA;oBAC/Hv4C,YAAYnB,EAAQmB,UAAAA;oBACpB06C,aAAAA;oBACAP,YAAYt7C,EAAQ+mH,oBAAAA,GAAuB,IAAsB,SAAlB,CAAA,IAAA/mH,EAAQs7C,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI;gBAAA,IAEvEv0D,IAAAA,CAAKgU,MAAAA,CAAO2iD,gBAAAA,CAAiB32D,IAAAA,CAAK6nG,YAAAA,CAAajxC,MAAAA,GAG/C52D,IAAAA,CAAK0nE,KAAAA,CAAM87B,QAAAA,CAAS4nB,MAAAA;gBACpB,MAAM+B,IAAgBl0G,KAAWA,EAAQu1G,YAAAA,KAAiBnrH,EAAa09H,QAAAA,GAAWxnH,WAAWvZ,IAAAA,CAAKsZ,MAAAA;gBAClGtZ,IAAAA,CAAK0nE,KAAAA,CAAM87B,QAAAA,GAAWxjG,IAAAA,CAAK0nE,KAAAA,CAAM87B,QAAAA,CAAS+mB,QAAAA,CAAS4C,GAAentH,IAAAA,GAClEA,IAAAA,CAAK0nE,KAAAA,CAAM87B,QAAAA,CAASlB,IAAAA;YACtB;YAQO,UAAAlzE;gBACApvB,IAAAA,CAAK2uD,SAAAA,IACR3uD,CAAAA,IAAAA,CAAK2uD,SAAAA,GAAAA,CAAY,GACjB3uD,IAAAA,CAAKigE,IAAAA,IACLjgE,IAAAA,CAAKouB,iBAAAA,CAAkB0uG,eAAAA,IACvB98H,IAAAA,CAAK0nE,KAAAA,CAAM+7C,aAAAA,CAAAA,CAAc,IACzBzjH,IAAAA,CAAKsZ,MAAAA,CAAOunH,UAAAA,CAAWt5E,WAAAA,CAAYvnD,IAAAA,CAAKsZ,MAAAA,GACxCtZ,IAAAA,CAAKsZ,MAAAA,GAAS,MACdtZ,IAAAA,CAAKgU,MAAAA,CAAOob,OAAAA,IACZpvB,IAAAA,CAAK4sC,eAAAA,CAAgBxd,OAAAA,IACrBpvB,IAAAA,CAAK4sC,eAAAA,GAAkB,MACvB2wF,GAAO6C,aAAAA,EAAAA;YAEX;YAEO,aAAAxV;gBACL,OAAO5qH,IAAAA,CAAK2uD,SACd;YAAA;YAMO,iBAAAuK;gBACL,OAAOl5D,IAAAA,CAAKgU,MAAAA,CAAOklD,cAAAA;YACrB;YAKA,IAAA,YAAW8nE;gBACT,OAAOhhI,IAAAA,CAAKm+H,UACd;YAAA;YAMA,IAAA,UAAqB/6H,CAAAA,EAAAA;gBACfA,IAAQ,IACVwT,EAAOS,WAAAA,GAAckB,QAAAA,CAAS,yDAIhCvY,IAAAA,CAAKm+H,UAAAA,GAAa/6H;YACpB;YAMO,SAAS4rH,CAAAA,EAAAA;gBACd,OAAOhvH,IAAAA,CAAK6nG,YAAAA,CAAaqnB,QAAAA,CAASF;YACpC;YAMO,YAAYA,CAAAA,EAAAA;gBACjB,OAAOhvH,IAAAA,CAAK6nG,YAAAA,CAAaknB,WAAAA,CAAYC;YACvC;YAQO,SAAgC1sH,CAAAA,EAAa0jD,CAAAA,EAAAA;gBAElD,OADAhmD,IAAAA,CAAKyuH,QAAAA,CAASr+G,GAAAA,CAAI9N,GAAK0jD,IAChBhmD,IACT;YAAA;YAeO,YAAYkkD,CAAAA,EAAAA;gBACjBlkD,IAAAA,CAAKyuH,QAAAA,CAAS1tE,MAAAA,CAAOmD;YACvB;YAsCO,IAAIA,CAAAA,EAAAA;gBACT,IAAyB,MAArBi0B,UAAU73E,MAAAA,EAEZ,OAAA,KADAN,IAAAA,CAAKyuH,QAAAA,CAASr+G,GAAAA,CAAY+nE,SAAAA,CAAU,EAAA,EAAiDA,SAAAA,CAAU,EAAA;gBAGjG,MAAMkhD,IAAgBr5H,IAAAA,CAAKyuH,QAAAA,CAAS2K,gBAAAA;gBAChCC,aAAyBzL,KAC3ByL,EAAcjpH,GAAAA,CAAI8zC,KAElBlkD,IAAAA,CAAK6nG,YAAAA,CAAaz3F,GAAAA,CAAI8zC;YAE1B;YAiCO,OAAOA,CAAAA,EAAAA;gBACRA,aAAkBkB,MACpBplD,IAAAA,CAAK6nG,YAAAA,CAAa9mD,MAAAA,CAAOmD,IAAAA,AAGvBA,CAAAA,aAAkB0pE,MAASD,GAAmBzpE,EAAAA,KAChDlkD,IAAAA,CAAKkhI,WAAAA,CAAYh9E,IAGG,YAAA,OAAXA,KACTlkD,IAAAA,CAAKkhI,WAAAA,CAAYh9E;YAErB;YAgCO,MAAA,UAAmC61E,CAAAA,EAA0C9gH,CAAAA,EAAAA;gBAAAA,MAC5EjZ,IAAAA,CAAK67H,KAAAA,CAAM52D;oBAAAA,MACTjlE,IAAAA,CAAKyuH,QAAAA,CAASqL,SAAAA,CAAUC,GAAkB9gH;gBAAQ;YAE5D;YAMO,yBAAyB2D,CAAAA,EAAAA;gBAC9B,OAAO5c,IAAAA,CAAKgU,MAAAA,CAAO+kD,wBAAAA,CAAyBn8C;YAC9C;YAMO,yBAAyBA,CAAAA,EAAAA;gBAC9B,OAAO5c,IAAAA,CAAKgU,MAAAA,CAAOglD,wBAAAA,CAAyBp8C;YAC9C;YAKQ,YAAY3D,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAClBjZ,IAAAA,CAAKgrH,wBAAAA,GAA2B/xG,EAAQkoH,oBAAAA;gBAGxC,MAAMhU,IAAgBl0G,KAAWA,EAAQu1G,YAAAA,KAAiBnrH,EAAa09H,QAAAA,GAAWxnH,WAAWvZ,IAAAA,CAAKsZ,MAAAA,EAC5FmuG,IAAwD,SAAtC,CAAA,IAAqB,SAArB,CAAA,IAAAznH,IAAAA,CAAKqmE,gBAAAA,AAAAA,KAAAA,KAAgB,MAAA,IAAA,KAAA,IAAA,EAAEohD,eAAAA,AAAAA,KAAAA,KAAe,MAAA,KAAA;gBAC9DznH,IAAAA,CAAK0nE,KAAAA,GAAQ,IAAIwlD,GAAU;oBACzBC,eAAAA;oBACA1F,iBAAAA;oBACAxtG,QAAQja,IAAAA;gBAAAA,IAEVA,IAAAA,CAAKqtH,WAAAA,GAAcrtH,IAAAA,CAAK0nE,KAAAA,CAAM2lD,WAAAA,EAK9BrtH,IAAAA,CAAKm1D,OAAAA,CAAQ57C,QAAAA,CAAS9R,EAAAA,CAAG,oBAAoB;oBACV,aAA7B8R,SAAS6nH,eAAAA,GACXphI,CAAAA,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,UAAU,IAAI86C,GAAYjjD,IAAAA,IAC3CA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,gBAAA,IACmB,cAA7BuB,SAAS6nH,eAAAA,IAClBphI,CAAAA,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,WAAW,IAAI66C,GAAahjD,IAAAA,IAC7CA,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,iBAAA;gBACrB,IAGGhY,IAAAA,CAAKy/H,eAAAA,IAAoBxmH,EAAQ41C,aAAAA,IACpCt1C,SAASO,IAAAA,CAAKC,WAAAA,CAAY/Z,IAAAA,CAAKsZ,MAAAA;YAEnC;YAEO,mBAAmBs6D,CAAAA,EAAAA;gBACxB5zE,IAAAA,CAAK89H,aAAAA,GAAgBlqD,GACrB5zE,IAAAA,CAAK0nE,KAAAA,CAAM+7C,aAAAA,CAAczjH,IAAAA,CAAK89H,aAAAA;YAChC;YAEO,aAAa7jH,CAAAA,EAAAA,CAEpB;YAKA,IAAA,gBAAW6uC;gBACT,OAAO9oD,IAAAA,CAAKkmD,cACd;YAAA;YAEQ,MAAA,oBAA0BjsC,CAAAA,EAAAA;gBAC3Bja,IAAAA,CAAK8oD,aAAAA,IAAAA,CAAAA,MACF9oD,IAAAA,CAAKyuH,QAAAA,CAASzlE,YAAAA,IAAAA,MACdhpD,IAAAA,CAAKgpD,YAAAA,CAAa/uC,IACxBja,IAAAA,CAAKka,MAAAA,CAAO/R,IAAAA,CAAK,cAAc,IAAIy7C,GAAgB3pC,GAAQja,IAAAA,IAC3DA,IAAAA,CAAKkmD,cAAAA,GAAAA,CAAiB,CAAA;YAE1B;YAMQ,QAAQpP,CAAAA,EAAAA;gBAAAA,IAAAA;gBACd,IAAI92C,IAAAA,CAAK8+H,UAAAA,EAKP,OAHY,SAAZ,CAAA,IAAA9+H,IAAAA,CAAKwhI,OAAAA,AAAAA,KAAAA,KAAO,MAAA,KAAA,EAAElwE,QAAAA,CAAStxD,IAAAA,EAAM82C,IAAAA,KAE7B92C,IAAAA,CAAK0nE,KAAAA,CAAMj6B,MAAAA;gBAKbztC,IAAAA,CAAK0gB,KAAAA,CAAMu0G,iBAAAA,CAAkB,cAC7Bj1H,IAAAA,CAAKmpD,UAAAA,CAAWrS,IAGhB92C,IAAAA,CAAK6nG,YAAAA,CAAap6D,MAAAA,CAAOztC,IAAAA,EAAM82C,IAG/B92C,IAAAA,CAAK4sC,eAAAA,CAAgBukB,oBAAAA,CAAqBra,IAG1C92C,IAAAA,CAAK0gB,KAAAA,CAAMu0G,iBAAAA,CAAkB,eAC7Bj1H,IAAAA,CAAKqpD,WAAAA,CAAYvS,IAGjB92C,IAAAA,CAAK0nE,KAAAA,CAAMj6B,MAAAA;YACb;YAKO,WAAWqJ,CAAAA,EAAAA;gBAChB92C,IAAAA,CAAKmI,IAAAA,CAAK,aAAa,IAAIg6C,GAAeniD,IAAAA,EAAM82C,GAAS92C,IAAAA,IACzDA,IAAAA,CAAKopD,WAAAA,CAAYppD,IAAAA,EAAM82C;YACzB;YAOO,YAAY78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEnC;YAKO,YAAYA,CAAAA,EAAAA;gBACjB92C,IAAAA,CAAKmI,IAAAA,CAAK,cAAc,IAAIi6C,GAAgBpiD,IAAAA,EAAM82C,GAAS92C,IAAAA,IAC3DA,IAAAA,CAAKspD,YAAAA,CAAatpD,IAAAA,EAAM82C;YAC1B;YAOO,aAAa78B,CAAAA,EAAgB68B,CAAAA,EAAAA,CAEpC;YAMQ,MAAMA,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA;gBAEZ92C,IAAAA,CAAK4sC,eAAAA,CAAgB4hB,eAAAA,GAAmD,SAAjC,CAAA,IAAAxuD,IAAAA,CAAK6nG,YAAAA,CAAar5C,eAAAA,AAAAA,KAAAA,KAAe,MAAA,IAAA,IAAIxuD,IAAAA,CAAKwuD,eAAAA,EACjFxuD,IAAAA,CAAK4sC,eAAAA,CAAgB8jB,kBAAAA,IACrB1wD,IAAAA,CAAK4sC,eAAAA,CAAgBplC,KAAAA,IACrBxH,IAAAA,CAAK0gB,KAAAA,CAAMu0G,iBAAAA,CAAkB,YAC7Bj1H,IAAAA,CAAK6uH,QAAAA,CAAS7uH,IAAAA,CAAK4sC,eAAAA,EAAiBkK,IAGhC92C,IAAAA,CAAK8+H,UAAAA,GACF9+H,IAAAA,CAAK++H,WAAAA,IACI,CAAA,SAAZ,CAAA,IAAA/+H,IAAAA,CAAKwhI,OAAAA,AAAAA,KAAAA,KAAO,MAAA,KAAA,EAAEloH,MAAAA,CAAOuG,IAAAA,CAAK7f,IAAAA,CAAK4sC,eAAAA,EAAiB,GAAG,IACnD5sC,IAAAA,CAAK0gB,KAAAA,CAAMu0G,iBAAAA,CAAkB,aAC7Bj1H,IAAAA,CAAK4sC,eAAAA,CAAgBnI,KAAAA,IACrBzkC,IAAAA,CAAK4sC,eAAAA,CAAgB+jB,gBAAAA,EAAAA,IAKzB3wD,CAAAA,IAAAA,CAAK6nG,YAAAA,CAAahoF,IAAAA,CAAK7f,IAAAA,CAAK4sC,eAAAA,EAAiBkK,IAE7C92C,IAAAA,CAAK0gB,KAAAA,CAAMu0G,iBAAAA,CAAkB,aAC7Bj1H,IAAAA,CAAK8uH,SAAAA,CAAU9uH,IAAAA,CAAK4sC,eAAAA,EAAiBkK,IAGrC92C,IAAAA,CAAK4sC,eAAAA,CAAgBnI,KAAAA,IACrBzkC,IAAAA,CAAK4sC,eAAAA,CAAgB+jB,gBAAAA,IAErB3wD,IAAAA,CAAK0hI,oBAAAA,EAAAA;YACP;YAKO,SAAStqG,CAAAA,EAA+B0f,CAAAA,EAAAA;gBAC7C92C,IAAAA,CAAKmI,IAAAA,CAAK,WAAW,IAAI05C,GAAazqB,GAAK0f,GAAS92C,IAAAA,IACpDA,IAAAA,CAAKmgD,SAAAA,CAAU/oB,GAAK0f;YACtB;YAOO,UAAU1f,CAAAA,EAA+B0f,CAAAA,EAAAA,CAEhD;YAKO,UAAU1f,CAAAA,EAA+B0f,CAAAA,EAAAA;gBAC9C92C,IAAAA,CAAKmI,IAAAA,CAAK,YAAY,IAAI25C,GAAc1qB,GAAK0f,GAAS92C,IAAAA,IACtDA,IAAAA,CAAKogD,UAAAA,CAAWhpB,GAAK0f;YACvB;YAOO,WAAW1f,CAAAA,EAA+B0f,CAAAA,EAAAA,CAEjD;YAMO,UAAU6qF,CAAAA,EAAAA;gBACf3hI,IAAAA,CAAK09H,QAAAA,GAAWiE;YAClB;YAKO,cAAAC;gBAEL,OADA5hI,IAAAA,CAAK09H,QAAAA,GAAAA,CAAY19H,IAAAA,CAAK09H,QAAAA,EACf19H,IAAAA,CAAK09H,QACd;YAAA;YAKA,IAAA,kBAAWtvB;gBACT,OAAA,CAAQpuG,IAAAA,CAAK8+H,UACf;YAAA;YAKA,IAAA,QAAW5xG;gBACT,OAAOltB,IAAAA,CAAKg/H,cAAAA,CAAeh4H,WAC7B;YAAA;YACO,UAAA66H;gBACL,OAAO7hI,IAAAA,CAAKg/H,cAAAA,CAAen4H,OAC7B;YAAA;YAuBO,MAAA,MAAYi7H,CAAAA,EAA4D7oH,CAAAA,EAAAA;gBAAAA,MACvEjZ,IAAAA,CAAK67H,KAAAA,CAAM52D;oBACf,IAAA,CAAKjlE,IAAAA,CAAKu/H,WAAAA,EACR,MAAM,IAAIp5H,MAAM;oBAGlB,IAAIgoH;oBAwBJ,OAzBAnuH,IAAAA,CAAK8+H,UAAAA,GAAAA,CAAa,GAEdgD,aAA6B/9D,KAC/BoqD,IAAS2T,IAC6B,YAAA,OAAtBA,KAChB9hI,CAAAA,IAAAA,CAAKyuH,QAAAA,CAAS8J,cAAAA,CAAeuJ,GAAmB7oH,IAChDk1G,IAASnuH,IAAAA,CAAKyuH,QAAAA,CAASkK,UAAAA,AAAAA,GAIzB34H,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,2BACnBhY,IAAAA,CAAKm1D,OAAAA,CAAQ+G,MAAAA,IACbl8D,IAAAA,CAAK0gB,KAAAA,CAAM1b,KAAAA,IACPhF,IAAAA,CAAK4/H,sBAAAA,IACP5/H,IAAAA,CAAKouB,iBAAAA,CAAkBppB,KAAAA,IAEzBhF,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,uBAAA,MAEbhY,IAAAA,CAAKiqB,IAAAA,CAAKkkG,QAAAA,IAAAA,IAAU,IAAI/oD,KAAAA,MAGxBplE,IAAAA,CAAKshI,mBAAAA,CAAoBthI,IAAAA,GAE/BA,IAAAA,CAAKg/H,cAAAA,CAAex6H,OAAAA,IACpBxE,IAAAA,CAAKmI,IAAAA,CAAK,SAAS,IAAIw5C,GAAe3hD,IAAAA,IAC/BA,IAAAA,CAAKg/H,cAAAA,CAAen4H,OAAO;gBAAA;YAEtC;YAaQ,UAAUiwC,CAAAA,EAAAA;gBAChB92C,IAAAA,CAAK67H,KAAAA,CAAM;oBACT77H,IAAAA,CAAKmI,IAAAA,CAAK,YAAY,IAAIk6C,GAAcriD,IAAAA,EAAMA,IAAAA,CAAKwiD,KAAAA,CAAMiuE,SAAAA;oBACzD,MAAMuB,IAAYl7E,IAAU92C,IAAAA,CAAKghI,SAAAA;oBACjChhI,IAAAA,CAAKi/H,qBAAAA,GAAwBjN;oBAG7B,MAAM+P,IAAU/hI,IAAAA,CAAKwiD,KAAAA,CAAMiuE,SAAAA,CAAU7wH,EAAAA,GAAK;oBAC1CI,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAU51F,KAAAA,IACrB3b,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAU3xG,EAAAA,GAAKmiI,GAC1B/hI,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAUygB,SAAAA,GAAYA,GACjChyH,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAU0gB,GAAAA,GAAMjyH,IAAAA,CAAK0gB,KAAAA,CAAM+zG,UAAAA,CAAWxC,GAAAA,EACjDtuF,GAAoBn8B,KAAAA;oBAEpB,MAAMw6H,IAAehiI,IAAAA,CAAK0gB,KAAAA,CAAMxb,GAAAA,IAC1B+8H,IAAkBjiI,IAAAA,CAAK6uG,mBAAAA;oBAC7B,IAAI7uG,IAAAA,CAAK6uG,mBAAAA,EAEP,IADA7uG,IAAAA,CAAKk/H,MAAAA,IAAUlN,GACRhyH,IAAAA,CAAKk/H,MAAAA,IAAU+C,GACpBjiI,IAAAA,CAAKuhI,OAAAA,CAAQU,IACbjiI,IAAAA,CAAKk/H,MAAAA,IAAU+C;yBAGjBjiI,IAAAA,CAAKuhI,OAAAA,CAAQvP;oBAEf,MAAMkQ,IAAcliI,IAAAA,CAAK0gB,KAAAA,CAAMxb,GAAAA;oBAC/BlF,IAAAA,CAAK+uG,iBAAAA,GAAoB/uG,IAAAA,CAAKk/H,MAAAA,EAC9Bl/H,IAAAA,CAAKyhI,KAAAA,CAAMzP;oBACX,MAAMmQ,IAAYniI,IAAAA,CAAK0gB,KAAAA,CAAMxb,GAAAA;oBAE7BlF,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAU77D,QAAAA,CAASjI,MAAAA,GAASy0F,IAAcF,GACrDhiI,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAU77D,QAAAA,CAAS71B,IAAAA,GAAOsiH,IAAYD,GACjDliI,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAUzxD,QAAAA,CAASgyE,WAAAA,GAAcnuF,GAAoBE,gBAAAA,EAChE7jC,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,CAAUzxD,QAAAA,CAAS+xE,SAAAA,GAAYluF,GAAoBC,aAAAA,EAE9D5jC,IAAAA,CAAKmI,IAAAA,CAAK,aAAa,IAAIo6C,GAAeviD,IAAAA,EAAMA,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,IAC3DvxG,IAAAA,CAAKwiD,KAAAA,CAAMiuE,SAAAA,CAAU90G,KAAAA,CAAM3b,IAAAA,CAAKwiD,KAAAA,CAAM+uD,SAAAA,GAEtCvxG,IAAAA,CAAKqgI,8CAAAA;gBAAgD;YAEzD;YAKO,OAAApgE;gBACDjgE,IAAAA,CAAK0gB,KAAAA,CAAMkhF,SAAAA,MACb5hG,CAAAA,IAAAA,CAAKmI,IAAAA,CAAK,QAAQ,IAAIy5C,GAAc5hD,IAAAA,IACpCA,IAAAA,CAAKm1D,OAAAA,CAAQvsD,KAAAA,IACb5I,IAAAA,CAAK0gB,KAAAA,CAAMu/C,IAAAA,IACXjgE,IAAAA,CAAKouB,iBAAAA,CAAkB6xC,IAAAA,IACvBjgE,IAAAA,CAAK6sB,OAAAA,CAAQ7U,KAAAA,CAAM,eAAA;YAEvB;YAKO,YAAA4pF;gBACL,OAAO5hG,IAAAA,CAAK0gB,KAAAA,CAAMkhF,SAAAA;YACpB;YAQO,WAAWygC,IAAAA,CAA0B,CAAA,EAAA;gBAI1C,OAH0B,IAAI99H,QAA2BC,CAAAA;oBACvDxE,IAAAA,CAAKm/H,mBAAAA,CAAoBx/H,IAAAA,CAAK;wBAAE0iI,yBAAAA;wBAAyB79H,SAAAA;oBAAAA;gBAAU;YAGvE;YAEQ,uBAAAk9H;gBAKN,KAAK,MAAMx3G,KAAWlqB,IAAAA,CAAKm/H,mBAAAA,CAAqB;oBAC9C,MAAMmD,IAAap4G,EAAQm4G,uBAAAA,GAA0BriI,IAAAA,CAAKsZ,MAAAA,CAAOa,KAAAA,GAAQna,IAAAA,CAAKgU,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EAC1FooH,IAAcr4G,EAAQm4G,uBAAAA,GAA0BriI,IAAAA,CAAKsZ,MAAAA,CAAOe,MAAAA,GAASra,IAAAA,CAAKgU,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA,EAC5F+nH,IAAa7oH,SAASC,aAAAA,CAAc;oBAC1C4oH,EAAWjoH,KAAAA,GAAQmoH,GACnBF,EAAW/nH,MAAAA,GAASkoH;oBACpB,MAAMnrG,IAAMgrG,EAAW1oH,UAAAA,CAAW;oBAClC0d,EAAI6hB,qBAAAA,GAAwBj5C,IAAAA,CAAKgU,MAAAA,CAAO+6C,YAAAA,EACxC33B,EAAI5J,SAAAA,CAAUxtB,IAAAA,CAAKsZ,MAAAA,EAAQ,GAAG,GAAGgpH,GAAYC;oBAE7C,MAAMn3H,IAAS,IAAI2mB,OACbywG,IAAMJ,EAAW94D,SAAAA,CAAU;oBACjCl+D,EAAOwnB,MAAAA,GAAS;wBACd1I,EAAQ1lB,OAAAA,CAAQ4G;oBAAO,GAEzBA,EAAOwmB,GAAAA,GAAM4wG;gBACf;gBAEAxiI,IAAAA,CAAKm/H,mBAAAA,CAAoB7+H,MAAAA,GAAS;YACpC;YAQO,MAAA,KAAW6tH,CAAAA,EAAuBsM,IAAAA,CAAa,CAAA,EAAA;gBAAA,MAC9Cz6H,IAAAA,CAAK67H,KAAAA,CAAM52D;oBACf,IAAA;wBAEE,IAAIkpD,EAAOtkG,QAAAA,IACT;wBAEF7pB,IAAAA,CAAKwhI,OAAAA,GAAUrT,GACfnuH,IAAAA,CAAK8+H,UAAAA,GAAAA,CAAa,GAClB9+H,IAAAA,CAAK++H,WAAAA,GAActE,GAEftM,aAAkB/oD,MACpB+oD,CAAAA,EAAOznD,kBAAAA,GAAqBynD,EAAOznD,kBAAAA,IAAsB1mE,IAAAA,CAAK+9H,mBAAAA,AAAAA,GAEhE/9H,IAAAA,CAAKwhI,OAAAA,CAAQx4E,YAAAA,CAAahpD,IAAAA,GAAAA,MAEpBmuH,EAAOlkG,IAAAA;oBACf,EAAE,OAAO3K,GAAAA;wBACPtf,IAAAA,CAAK6sB,OAAAA,CAAQ5lB,KAAAA,CAAM,2DAA2DqY,IAAAA,MACxE/a,QAAQC,OAAAA;oBAChB,SAAA;wBACExE,IAAAA,CAAK8+H,UAAAA,GAAAA,CAAa,GAClB9+H,IAAAA,CAAK++H,WAAAA,GAAAA,CAAc,GACnB/+H,IAAAA,CAAKwhI,OAAAA,GAAU;oBACjB;gBAAA;YAEJ;QAAA;QAt8CO,GAAA/D,OAAAA,GAAkC7B,MAUlC,GAAAwE,aAAAA,GAAgB,GAiVR,GAAAhB,uBAAAA,GAAyC;YACtDjlH,OAAO;YACPE,QAAQ;YACR2jH,0BAAAA,CAA0B;YAC1B9vE,gBAAAA,CAAgB;YAChBqyE,sCAAsC;gBACpCD,OAAAA,CAAO;gBACPE,mBAAAA,CAAmB;gBACnBtoD,WAAW;oBAAE+5C,KAAK;oBAAIwO,gBAAgB;gBAAA;YAAA;YAExChB,iBAAiB;YACjB5wE,eAAAA,KAAe/tD;YACf++H,yBAAAA,CAAyB;YACzBz6F,aAAAA,CAAa;YACb2pB,cAAAA,CAAc;YACdgxE,UAAAA,CAAU;YACVJ,mBAAAA,CAAmB;YACnB3wE,iBAAiB;YACjBw/D,cAAcnrH,EAAay5D,MAAAA;YAC3B4iE,4BAA4B;YAC5BJ,wCAAwC;YACxCU,sBAAsB;YACtBt5D,oBAAoB;YACpB+gD,iBAAAA,CAAiB;YACjB0Z,sBAAsBlW,GAAqBnuD,MAAAA;YAC3CtO,iBAAiBp8C,EAAMS,OAAAA,CAAQ;QAAA;QEltB5B,MAAM4vH,WAAcj5C;YAIzB,IAAA,SAAoBrvE,CAAAA,EAAAA;gBAClBna,IAAAA,CAAKozB,KAAAA,CAAMkB,QAAAA,GAAWna;YACxB;YAEA,IAAA,WAAWma;gBACT,OAAOt0B,IAAAA,CAAKozB,KAAAA,CAAMkB,QACpB;YAAA;YAEA,IAAA,OAAWymB;gBACT,OAAO/6C,IAAAA,CAAKq/C,KACd;YAAA;YAEA,IAAA,KAAgBqjF,CAAAA,EAAAA;gBACd1iI,IAAAA,CAAKq/C,KAAAA,GAAQqjF,GACb1iI,IAAAA,CAAKozB,KAAAA,CAAM2nB,IAAAA,GAAO2nF;YACpB;YAKA,IAAA,OAAW9uG;gBACT,OAAO5zB,IAAAA,CAAKozB,KAAAA,CAAMQ,IACpB;YAAA;YAEA,IAAA,KAAgBA,CAAAA,EAAAA;gBACd5zB,IAAAA,CAAKozB,KAAAA,CAAMQ,IAAAA,GAAOA;YACpB;YAEA,IAAA,QAAoBjgB;gBAClB,OAAO3T,IAAAA,CAAKozB,KAAAA,CAAMzf,KACpB;YAAA;YAEA,IAAA,MAA0BA,CAAAA,EAAAA;gBACpB3T,IAAAA,CAAKozB,KAAAA,IACPpzB,CAAAA,IAAAA,CAAKozB,KAAAA,CAAMzf,KAAAA,GAAQA,CAAAA;YAEvB;YAEA,IAAA,UAAWiV;gBACT,OAAO5oB,IAAAA,CAAK8/C,QAAAA,CAASl3B,OACvB;YAAA;YAEA,IAAA,QAAmBA,CAAAA,EAAAA;gBACjB5oB,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUA;YAC1B;YAMA,IAAA,aAAW+5G;gBACT,OAAO3iI,IAAAA,CAAKk3B,WACd;YAAA;YAEA,IAAA,WAAsB0rG,CAAAA,EAAAA;gBAChBA,KACF5iI,CAAAA,IAAAA,CAAKk3B,WAAAA,GAAc0rG,GACnB5iI,IAAAA,CAAKozB,KAAAA,CAAM2nB,IAAAA,GAAO/6C,IAAAA,CAAKk3B,WAAAA,AAAAA;YAE3B;YAMA,YAAYje,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM3T,IArEA,IAAA,CAAAomC,KAAAA,GAAc,IAAId,IAClB,IAAA,CAAAnrB,KAAAA,GAAc,IAAI6rB,GAAK;oBAAErrB,MAAM;oBAAImnB,MAAM/6C,IAAAA,CAAKq/C,KAAAA;gBAAAA;gBAqEpD,MAAA,EAAM,MAAEzrB,CAAAA,EAAI,KAAE/Y,CAAAA,EAAG,GAAEvO,CAAAA,EAAC,GAAElC,CAAAA,EAAC,YAAEu4H,CAAAA,EAAU,MAAE5nF,CAAAA,EAAI,OAAEpnC,CAAAA,EAAK,UAAE2gB,CAAAA,EAAAA,GAAa;oBAAEV,MAAM;oBAAA,GAAO3a,CAAAA;gBAAAA;gBAE9EjZ,IAAAA,CAAK6a,GAAAA,GAAMA,QAAAA,IAAAA,IAAQvO,KAAKlC,IAAIsE,EAAIpC,GAAGlC,KAAKpK,IAAAA,CAAK6a,GAAAA,EAC7C7a,IAAAA,CAAK4zB,IAAAA,GAAOA,QAAAA,IAAAA,IAAQ5zB,IAAAA,CAAK4zB,IAAAA,EACzB5zB,IAAAA,CAAK+6C,IAAAA,GAAOA,QAAAA,IAAAA,IAAQ/6C,IAAAA,CAAK+6C,IAAAA,EACzB/6C,IAAAA,CAAKs0B,QAAAA,GAAWA,QAAAA,IAAAA,IAAYt0B,IAAAA,CAAKs0B,QAAAA,EACjCt0B,IAAAA,CAAK2iI,UAAAA,GAAaA,QAAAA,IAAAA,IAAc3iI,IAAAA,CAAK2iI,UAAAA,EACrC3iI,IAAAA,CAAKozB,KAAAA,CAAMzf,KAAAA,GAAQA,QAAAA,IAAAA,IAAS3T,IAAAA,CAAK2T,KAAAA;gBACjC,MAAM40F,IAAMvoG,IAAAA,CAAK2C,GAAAA,CAAI48C;gBACrBgpD,EAAIz2F,MAAAA,GAAShE,EAAOC,IAAAA,EACpBw6F,EAAIhxE,GAAAA,CAAIv3B,IAAAA,CAAKozB,KAAAA;YACf;YAEO,YAAYnZ,CAAAA,EAAAA;gBACjB2S,KAAAA,CAAMugB,YAAYlzB;YACpB;YAKO,eAAA4oH;gBACL,OAAO7iI,IAAAA,CAAKozB,KAAAA,CAAMjZ,KACpB;YAAA;QAAA;QAAA,CDvIF,SAAYmjH,CAAAA;YAIV,EAAA,MAAA,GAAA,UAIA,EAAA,SAAA,GAAA;QACD,EATWA,MAAAA,CAAAA,KAAW,CAAA,CAAA;QEchB,MAAMwF,WAAwBt5C;YA0DnC,YAAY0B,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACVt+D,KAAAA,CAAM;oBAAEzS,OAAmB,SAAZ,CAAA,IAAA+wE,EAAO/wE,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI;oBAAGE,QAAqB,SAAb,CAAA,IAAA6wE,EAAO7wE,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;gBAAA,IA1DrD,IAAA,CAAA0oH,gBAAAA,GAA2B,GAE3B,IAAA,CAAAC,aAAAA,GAAgB,IAAIv7G,EAC1B,IAAM,IAAIgjC,GAAS,CAAC,IACnBn0C,CAAAA,IAAMA,GACP,MAGK,IAAA,CAAA2sH,YAAAA,GAAuB,GAUvB,IAAA,CAAAC,UAAAA,GAAAA,CAAsB,GAKtB,IAAA,CAAAC,aAAAA,GAA4B,EAAA,EAK5B,IAAA,CAAAC,QAAAA,GAAmB,GAKnB,IAAA,CAAAC,WAAAA,GAA2B/F,GAAYxwC,SAAAA,EAKvC,IAAA,CAAAlhD,MAAAA,GAAiB,GAEjB,IAAA,CAAA2gB,QAAAA,GAA2B;oBAIhC3B,MAAM;oBACN7tC,WAAWuuC,GAAkBC,MAAAA;oBAC7BnW,SAAAA,KAASt0C;oBACT8nB,SAAS;oBACT+gC,iBAAiB;oBACjBqC,OAAAA,KAAOlrD;oBACPmrD,YAAAA,KAAYnrD;oBACZwiI,gBAAAA,CAAgB;gBAAA,GA6BV,IAAA,CAAAC,gBAAAA,GAA+B,EAAA;gBApBrC,MAAA,EAAM,UAAEh3E,CAAAA,EAAQ,GAAEjgD,CAAAA,EAAC,GAAElC,CAAAA,EAAC,GAAEye,CAAAA,EAAC,KAAEhO,CAAAA,EAAG,YAAEqoH,CAAAA,EAAU,UAAEE,CAAAA,EAAQ,aAAEC,CAAAA,EAAW,QAAEz3F,CAAAA,EAAM,QAAEj+B,CAAAA,EAAAA,GAAW;oBAAA,GAAKu9E,CAAAA;gBAAAA;gBAE3FlrF,IAAAA,CAAKusD,QAAAA,GAAW;oBAAA,GAAKvsD,IAAAA,CAAKusD,QAAAA;oBAAAA,GAAaA,CAAAA;gBAAAA,GAEvCvsD,IAAAA,CAAK6a,GAAAA,GAAMA,QAAAA,IAAAA,IAAOnM,EAAIpC,QAAAA,IAAAA,IAAK,GAAGlC,QAAAA,IAAAA,IAAK,IACnCpK,IAAAA,CAAK6oB,CAAAA,GAAIA,QAAAA,IAAAA,IAAK,GACd7oB,IAAAA,CAAKkjI,UAAAA,GAAaA,QAAAA,IAAAA,IAAcljI,IAAAA,CAAKkjI,UAAAA,EACrCljI,IAAAA,CAAKojI,QAAAA,GAAWA,QAAAA,IAAAA,IAAYpjI,IAAAA,CAAKojI,QAAAA,EACjCpjI,IAAAA,CAAKqjI,WAAAA,GAAcA,QAAAA,IAAAA,IAAerjI,IAAAA,CAAKqjI,WAAAA,EACvCrjI,IAAAA,CAAK4rC,MAAAA,GAASA,QAAAA,IAAAA,IAAU5rC,IAAAA,CAAK4rC,MAAAA,EAE7B5rC,IAAAA,CAAK8Z,IAAAA,CAAK4yD,aAAAA,GAAgBjC,GAAckC,gBAAAA,EAExC3sE,IAAAA,CAAK2N,MAAAA,GAASA,QAAAA,IAAAA,IAAU,IAAI5E;YAC9B;YAEO,eAAewjD,CAAAA,EAAAA;gBACpBvsD,IAAAA,CAAKmjI,aAAAA,CAAcxjI,IAAAA,CAAK4sD;YAC1B;YAQO,cAAck3E,CAAAA,EAAAA;gBAAAA,IAAAA;gBACnB,IAAA,CAAIA,CAAAA,KAAiB,CAAA,GAArB;oBAGAA,KAAgC;oBAChC,IAAK,IAAIjjI,IAAI,GAAGA,IAAIijI,GAAejjI,IAAK;wBACtC,MAAM8V,IAAItW,IAAAA,CAAK0jI,eAAAA;wBACA,CAAA,SAAX,CAAA,IAAA1jI,QAAAA,IAAAA,GAAAA,KAAI,IAAJA,IAAAA,CAAMgmD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE8uD,KAAAA,AAAAA,KACX90G,CAAAA,IAAAA,CAAKusD,QAAAA,CAASxvC,SAAAA,KAAcuuC,GAAkBC,MAAAA,GAChDvrD,IAAAA,CAAKgmD,KAAAA,CAAM8uD,KAAAA,CAAM1kG,GAAAA,CAAIkG,KAErBtW,IAAAA,CAAKwnD,QAAAA,CAASlxC,EAAAA,GAGlBtW,IAAAA,CAAKujI,gBAAAA,CAAiB5jI,IAAAA,CAAK2W;oBAC7B;gBAZA;YAaF;YAEO,iBAAAqtH;gBACL,IAAK,IAAInjI,IAAI,GAAGA,IAAIR,IAAAA,CAAKujI,gBAAAA,CAAiBjjI,MAAAA,EAAQE,IAChDR,IAAAA,CAAK8rD,cAAAA,CAAe9rD,IAAAA,CAAKujI,gBAAAA,CAAiB/iI,EAAAA;YAE9C;YAGQ,kBAAAkjI;gBACN,IAAIE,IAAO,GACPC,IAAO;gBAEX,MAAM52H,IAAQS,EAAc1N,IAAAA,CAAKusD,QAAAA,CAASu3E,QAAAA,IAAY,GAAG9jI,IAAAA,CAAKusD,QAAAA,CAASw3E,QAAAA,IAAsB,IAAVz+H,KAAK8G,EAAAA,EAAQpM,IAAAA,CAAK2N,MAAAA,GAC/F67C,IAAM97C,EAAc1N,IAAAA,CAAKusD,QAAAA,CAASy3E,QAAAA,IAAY,GAAGhkI,IAAAA,CAAKusD,QAAAA,CAAS03E,QAAAA,IAAY,GAAGjkI,IAAAA,CAAK2N,MAAAA,GACnFmC,IAAO9P,IAAAA,CAAKusD,QAAAA,CAASZ,SAAAA,IAAaj+C,EAAc1N,IAAAA,CAAKusD,QAAAA,CAAS23E,OAAAA,IAAW,GAAGlkI,IAAAA,CAAKusD,QAAAA,CAAS43E,OAAAA,IAAW,GAAGnkI,IAAAA,CAAK2N,MAAAA,GAC7G07B,IAAKmgB,IAAMlkD,KAAKiJ,GAAAA,CAAItB,IACpBq8B,IAAKkgB,IAAMlkD,KAAKkJ,GAAAA,CAAIvB;gBAE1B,IAAIjN,IAAAA,CAAKqjI,WAAAA,KAAgB/F,GAAYxwC,SAAAA,EACnC82C,IAAOl2H,EAAc,GAAG1N,IAAAA,CAAKma,KAAAA,EAAOna,IAAAA,CAAK2N,MAAAA,GACzCk2H,IAAOn2H,EAAc,GAAG1N,IAAAA,CAAKqa,MAAAA,EAAQra,IAAAA,CAAK2N,MAAAA;qBACrC,IAAI3N,IAAAA,CAAKqjI,WAAAA,KAAgB/F,GAAYz0C,MAAAA,EAAQ;oBAClD,MAAMj9C,IAASl+B,EAAc,GAAG1N,IAAAA,CAAK4rC,MAAAA,EAAQ5rC,IAAAA,CAAK2N,MAAAA;oBAClDi2H,IAAOh4F,IAAStmC,KAAKiJ,GAAAA,CAAItB,IACzB42H,IAAOj4F,IAAStmC,KAAKkJ,GAAAA,CAAIvB;gBAC3B;gBAEA,MAAMqJ,IAAItW,IAAAA,CAAKgjI,aAAAA,CAAc/6G,IAAAA;gBAwB7B,OAvBA3R,EAAEk1C,SAAAA,CAAU;oBACVZ,MAAM5qD,IAAAA,CAAKusD,QAAAA,CAAS3B,IAAAA;oBACpBhiC,SAAS5oB,IAAAA,CAAKusD,QAAAA,CAAS3jC,OAAAA;oBACvB8hC,YAAY1qD,IAAAA,CAAKusD,QAAAA,CAAS7B,UAAAA;oBAC1BC,UAAU3qD,IAAAA,CAAKusD,QAAAA,CAAS5B,QAAAA;oBACxB9vC,KAAKnM,EAAIk1H,GAAMC;oBACfr6E,KAAK96C,EAAI26B,GAAIC;oBACbmgB,KAAKzpD,IAAAA,CAAKusD,QAAAA,CAAS9C,GAAAA;oBACnBE,iBAAiB3pD,IAAAA,CAAKusD,QAAAA,CAAS5C,eAAAA;oBAC/BgC,WAAW3rD,IAAAA,CAAKusD,QAAAA,CAASZ,SAAAA;oBACzBC,SAAS5rD,IAAAA,CAAKusD,QAAAA,CAASX,OAAAA;oBACvB97C,MAAMA;oBACNslC,SAASp1C,IAAAA,CAAKusD,QAAAA,CAASnX,OAAAA;oBACvByV,MAAM7qD,IAAAA,CAAKusD,QAAAA,CAAS1B,IAAAA;gBAAAA,IAEtBv0C,EAAEm1C,eAAAA,CAAgBzrD,IAAAA,GACdA,IAAAA,CAAKusD,QAAAA,CAAS+2E,cAAAA,IAChBhtH,CAAAA,EAAEyG,SAAAA,CAAU4F,QAAAA,GAAWjV,EAAc,GAAa,IAAVpI,KAAK8G,EAAAA,EAAQpM,IAAAA,CAAK2N,MAAAA,CAAAA,GAExD3N,IAAAA,CAAKusD,QAAAA,CAASP,KAAAA,IAChB11C,CAAAA,EAAE01C,KAAAA,GAAQhsD,IAAAA,CAAKusD,QAAAA,CAASP,KAAAA,CAAM57C,GAAAA,CAAI1B,EAAI1O,IAAAA,CAAK6a,GAAAA,CAAIvO,CAAAA,EAAGtM,IAAAA,CAAK6a,GAAAA,CAAIzQ,CAAAA,IAC3DkM,EAAE21C,UAAAA,GAAajsD,IAAAA,CAAKusD,QAAAA,CAASN,UAAAA,AAAAA,GAExB31C;YACT;YAEO,OAAO2D,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAAAA,IAAAA;gBAC5BlqB,KAAAA,CAAM6gB,OAAOxzB,GAAQ68B,IAEjB92C,IAAAA,CAAKkjI,UAAAA,IACPljI,CAAAA,IAAAA,CAAK+iI,gBAAAA,IAAoB/iI,IAAAA,CAAKojI,QAAAA,GAAYtsF,CAAAA,IAAU,GAAA,GAChD92C,IAAAA,CAAK+iI,gBAAAA,GAAmB,KAC1B/iI,CAAAA,IAAAA,CAAKwjI,aAAAA,CAAcl+H,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAK+iI,gBAAAA,IACnC/iI,IAAAA,CAAK+iI,gBAAAA,GAAmB/iI,IAAAA,CAAK+iI,gBAAAA,GAAmBz9H,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAK+iI,gBAAAA,CAAAA,CAAAA;gBAKpE,IAAK,IAAIviI,IAAI,GAAGA,IAAIR,IAAAA,CAAKmjI,aAAAA,CAAc7iI,MAAAA,EAAQE,IAAK;oBACnC,CAAA,SAAX,CAAA,IAAAR,QAAAA,IAAAA,GAAAA,KAAI,IAAJA,IAAAA,CAAMgmD,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,KAAA,IAAA,EAAE8uD,KAAAA,AAAAA,KACf90G,CAAAA,IAAAA,CAAKgmD,KAAAA,CAAM8uD,KAAAA,CAAM/zD,MAAAA,CAAO/gD,IAAAA,CAAKmjI,aAAAA,CAAc3iI,EAAAA,EAAAA,CAAI,IAC/CR,IAAAA,CAAKgjI,aAAAA,CAAcv6G,MAAAA,CAAOzoB,IAAAA,CAAKmjI,aAAAA,CAAc3iI,EAAAA,CAAAA;oBAE/C,MAAMgL,IAAQxL,IAAAA,CAAKujI,gBAAAA,CAAiB96H,OAAAA,CAAQzI,IAAAA,CAAKmjI,aAAAA,CAAc3iI,EAAAA;oBAC3DgL,IAAAA,MACFxL,IAAAA,CAAKujI,gBAAAA,CAAiB76H,MAAAA,CAAO8C,GAAO;gBAExC;gBACAxL,IAAAA,CAAKmjI,aAAAA,CAAc7iI,MAAAA,GAAS;YAC9B;QAAA;QCnMK,SAAS8jI,GAAOzpH,CAAAA,EAAiB0pH,CAAAA,GAMxC;QCgBO,MAAMC;YAwBX,YAAY97H,CAAAA,EAA6BmF,CAAAA,EAAgBsL,CAAAA,CAAAA;gBAAAA,IAAAA;gBArBzD,IAAA,CAAAmqH,QAAAA,GAAmB,GAGX,IAAA,CAAA3gG,YAAAA,GAAAA,CAAwB,GACxB,IAAA,CAAA8hG,KAAAA,GAAkC,EAAA,EAClC,IAAA,CAAAC,QAAAA,GAA0B,EAAA,EAG1B,IAAA,CAAAC,UAAAA,GAAa,GAIb,IAAA,CAAAC,eAAAA,GAAkB,GAElB,IAAA,CAAAC,cAAAA,GAAiB,GACjB,IAAA,CAAAC,YAAAA,GAAuB,GAEvB,IAAA,CAAAC,YAAAA,GAAe,GACf,IAAA,CAAAC,iBAAAA,GAAoB,GACpB,IAAA,CAAAC,aAAAA,GAAgB,GA0GhB,IAAA,CAAAC,eAAAA,GAAAA,CAAkB,GAMlB,IAAA,CAAAC,QAAAA,GAA4C,EAAA,EA7GlDjlI,IAAAA,CAAKwI,OAAAA,GAAUA,GACfxI,IAAAA,CAAKusD,QAAAA,GAAWtzC,GAChBjZ,IAAAA,CAAKklI,aAAAA,GAAgB,IAAIvjH,aAAa3hB,IAAAA,CAAKwI,OAAAA,CAAQ28H,YAAAA,GAAenlI,IAAAA,CAAK0kI,eAAAA,GACvE1kI,IAAAA,CAAKolI,OAAAA,GAAUz3H,GACf3N,IAAAA,CAAK+kI,aAAAA,GAAkC,SAAlB,CAAA,IAAA/kI,IAAAA,CAAKusD,QAAAA,CAAS3B,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI;YAC7C;YAEA,IAAA,gBAAW9B;gBACT,OAAO9oD,IAAAA,CAAKyiC,YACd;YAAA;YAEA,IAAA,eAAW0iG;gBACT,OAAOnlI,IAAAA,CAAKwI,OAAAA,CAAQ28H,YACtB;YAAA;YAEA,WAAWh3G,CAAAA,EAA4BkW,CAAAA,EAAAA;gBACrC,IAAIrkC,IAAAA,CAAKyiC,YAAAA,EACP;gBAGF,MAAMwgG,IAAejjI,IAAAA,CAAKwI,OAAAA,CAAQ28H,YAAAA,EAC5BE,IAAiBrlI,IAAAA,CAAK0kI,eAAAA,EACtBY,IAAetlI,IAAAA,CAAKklI,aAAAA,EAGpBK,IAAsBp3G,EAAGoT,YAAAA,IACzBikG,IAAOr3G,EAAGiV,iBAAAA;gBAChBjV,EAAGkV,eAAAA,CAAgBmiG,IACnBr3G,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc6jG,IAC/Bp3G,EAAGqT,UAAAA,CAAWrT,EAAGuT,YAAAA,EAAcuhG,IAAeoC,IANxB,GAMwDl3G,EAAGyT,YAAAA,GACjFzT,EAAG6T,aAAAA,CAAc7T,EAAGuT,YAAAA,EAAc,GAAG4jG;gBACrC,IAAIrwG,IAAS;gBAEb9G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAVjB,IAUwB6qG,GAAgC,IAC9EpwG,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAbjB,IAawB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAhBjB,IAgBwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAnBjB,IAmBwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAtBjB,IAsBwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAGVt3G,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAE3BzjC,IAAAA,CAAKukI,KAAAA,CAAM5kI,IAAAA,CAAK6lI,IAChBxlI,IAAAA,CAAKwkI,QAAAA,CAAS7kI,IAAAA,CAAK4lI,IAEnBp3G,EAAGkV,eAAAA,CAAgB,OACnBlV,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc;gBAE/B,MAAMgkG,IAAsBv3G,EAAGoT,YAAAA,IACzBokG,IAAOx3G,EAAGiV,iBAAAA;gBAChBjV,EAAGkV,eAAAA,CAAgBsiG,IACnBx3G,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAcgkG,IAC/Bv3G,EAAGqT,UAAAA,CAAWrT,EAAGuT,YAAAA,EAAcuhG,IAAeoC,IA1CxB,GA0CwDl3G,EAAGyT,YAAAA,GACjF3M,IAAS,GAET9G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GA7CjB,IA6CwB6qG,GAAgC,IAC9EpwG,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAhDjB,IAgDwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAnDjB,IAmDwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAtDjB,IAsDwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAEVt3G,EAAGqV,mBAAAA,CAAoB,GAAG,GAAGrV,EAAGqM,KAAAA,EAAAA,CAAO,GAzDjB,IAyDwB6qG,GAAgCpwG,IAC9EA,KAAUwwG,GAGVt3G,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAC3BtV,EAAGsV,uBAAAA,CAAwB,IAE3BzjC,IAAAA,CAAKukI,KAAAA,CAAM5kI,IAAAA,CAAKgmI,IAChB3lI,IAAAA,CAAKwkI,QAAAA,CAAS7kI,IAAAA,CAAK+lI,IAGnBv3G,EAAGkV,eAAAA,CAAgB,OACnBlV,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc,OAE/B1hC,IAAAA,CAAK4lI,WAAAA,GAAc5lI,IAAAA,CAAKukI,KAAAA,CAAMvkI,IAAAA,CAAKykI,UAAAA,GAAa,EAAA,EAChDzkI,IAAAA,CAAK6lI,cAAAA,GAAiB7lI,IAAAA,CAAKwkI,QAAAA,CAAAA,AAAUxkI,CAAAA,IAAAA,CAAKykI,UAAAA,GAAa,CAAA,IAAK,EAAA,EAE5DzkI,IAAAA,CAAKyiC,YAAAA,GAAAA,CAAe;YACtB;YAGA,iBAAAkhG;gBACE3jI,IAAAA,CAAKklI,aAAAA,CAAc5qF,IAAAA,CAAK,IACxBt6C,IAAAA,CAAKglI,eAAAA,GAAAA,CAAkB;YACzB;YAGA,cAAcvB,CAAAA,EAAAA;gBACZ,MAAMqC,IAAa9lI,IAAAA,CAAK2kI,cAAAA,EAClBR,IAAUnkI,IAAAA,CAAKmlI,YAAAA,GAAenlI,IAAAA,CAAK0kI,eAAAA,EACnCqB,IAAWtC,IAAgBzjI,IAAAA,CAAK0kI,eAAAA,GAAkBoB;gBAExD,IAAK,IAAItlI,IAAIslI,GAAYtlI,IAAIulI,GAAUvlI,KAAKR,IAAAA,CAAK0kI,eAAAA,CAAiB;oBAChE,MAAMz3H,IAAQjN,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAASvK,IAAAA,CAAKusD,QAAAA,CAASu3E,QAAAA,IAAY,GAAG9jI,IAAAA,CAAKusD,QAAAA,CAASw3E,QAAAA,IAAY53H,IACrFmnF,IAAStzF,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAASvK,IAAAA,CAAKusD,QAAAA,CAASy3E,QAAAA,IAAY,GAAGhkI,IAAAA,CAAKusD,QAAAA,CAAS03E,QAAAA,IAAY,IACtF1wC,IAASvzF,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAASvK,IAAAA,CAAKusD,QAAAA,CAASy3E,QAAAA,IAAY,GAAGhkI,IAAAA,CAAKusD,QAAAA,CAAS03E,QAAAA,IAAY,IACtF56F,IAAKiqD,IAAShuF,KAAKiJ,GAAAA,CAAItB,IACvBq8B,IAAKiqD,IAASjuF,KAAKkJ,GAAAA,CAAIvB;oBAC7B,IAAI22H,IAAe,GACfC,IAAe;oBACnB,IAAI7jI,IAAAA,CAAKwI,OAAAA,CAAQ66H,WAAAA,KAAgB/F,GAAYxwC,SAAAA,EAC3C82C,IAAO5jI,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAAAA,MAAe,MAAOvK,IAAAA,CAAKwI,OAAAA,CAAQ2R,KAAAA,EACvD0pH,IAAO7jI,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAAAA,MAAe,MAAOvK,IAAAA,CAAKwI,OAAAA,CAAQ6R,MAAAA;yBAClD;wBACL,MAAMuxB,IAAS5rC,IAAAA,CAAKolI,OAAAA,CAAQ76H,QAAAA,CAAS,GAAGvK,IAAAA,CAAKwI,OAAAA,CAAQojC,MAAAA;wBACrDg4F,IAAOh4F,IAAStmC,KAAKiJ,GAAAA,CAAItB,IACzB42H,IAAOj4F,IAAStmC,KAAKkJ,GAAAA,CAAIvB;oBAC3B;oBACA,MAAMgZ,IAAKjmB,IAAAA,CAAKwI,OAAAA,CAAQuU,SAAAA,CAAUhE,KAAAA,CAAMrK,EAAIk1H,GAAMC,KAC5CpiI,IAAO;wBACXzB,IAAAA,CAAKusD,QAAAA,CAASxvC,SAAAA,KAAcuuC,GAAkBkB,KAAAA,GAAQo3E,IAAO39G,EAAG3Z,CAAAA;wBAChEtM,IAAAA,CAAKusD,QAAAA,CAASxvC,SAAAA,KAAcuuC,GAAkBkB,KAAAA,GAAQq3E,IAAO59G,EAAG7b,CAAAA;wBAChEi/B;wBACAC;wBACAtpC,IAAAA,CAAKusD,QAAAA,CAAS+2E,cAAAA,GAAiB51H,EAAc,GAAGvB,GAAOnM,IAAAA,CAAKolI,OAAAA,IAAWplI,IAAAA,CAAKusD,QAAAA,CAAS5pC,QAAAA,IAAY;wBACjG3iB,IAAAA,CAAKusD,QAAAA,CAAS5C,eAAAA,IAAmB;wBACjC3pD,IAAAA,CAAK+kI,aAAAA;qBAAAA;oBAIP/kI,IAAAA,CAAKklI,aAAAA,CAAcl6G,GAAAA,CAAIvpB,GAAMjB,IAAIR,IAAAA,CAAKklI,aAAAA,CAAc5kI,MAAAA;gBACtD;gBAEIylI,KAAY5B,IACdnkI,CAAAA,IAAAA,CAAK8kI,iBAAAA,IAAAA,AAAsBiB,CAAAA,IAAW5B,CAAAA,IAAWnkI,IAAAA,CAAK0kI,eAAAA,EACtD1kI,IAAAA,CAAK6kI,YAAAA,GAAe7kI,IAAAA,CAAK+kI,aAAAA,AAAAA,IAChB/kI,IAAAA,CAAK6kI,YAAAA,GAAe,KAC7B7kI,CAAAA,IAAAA,CAAK8kI,iBAAAA,IAAqBrB,CAAAA,GAG5BzjI,IAAAA,CAAK2kI,cAAAA,GAAiBoB,IAAW5B,GACjCnkI,IAAAA,CAAKilI,QAAAA,CAAStlI,IAAAA,CAAK;oBAACK,IAAAA,CAAK+kI,aAAAA;oBAAee;iBAAAA;YAC1C;YAEQ,eAAe33G,CAAAA,EAAAA;gBAGjBnuB,IAAAA,CAAK2kI,cAAAA,KAAmB3kI,IAAAA,CAAK4kI,YAAAA,IAE/Bz2G,CAAAA,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKwkI,QAAAA,CAAAA,AAAUxkI,CAAAA,IAAAA,CAAKykI,UAAAA,GAAa,CAAA,IAAK,EAAA,GACjEzkI,IAAAA,CAAK2kI,cAAAA,IAAkB3kI,IAAAA,CAAK4kI,YAAAA,GAC9Bz2G,EAAG6T,aAAAA,CACD7T,EAAGuT,YAAAA,EACiB,IAApB1hC,IAAAA,CAAK4kI,YAAAA,EACL5kI,IAAAA,CAAKklI,aAAAA,EACLllI,IAAAA,CAAK4kI,YAAAA,EACL5kI,IAAAA,CAAK2kI,cAAAA,GAAiB3kI,IAAAA,CAAK4kI,YAAAA,IAK7Bz2G,CAAAA,EAAG6T,aAAAA,CACD7T,EAAGuT,YAAAA,EACiB,IAApB1hC,IAAAA,CAAK4kI,YAAAA,EACL5kI,IAAAA,CAAKklI,aAAAA,EACLllI,IAAAA,CAAK4kI,YAAAA,EACL5kI,IAAAA,CAAKklI,aAAAA,CAAc5kI,MAAAA,GAASN,IAAAA,CAAK4kI,YAAAA,GAG/B5kI,IAAAA,CAAK8kI,iBAAAA,IAEP32G,EAAG6T,aAAAA,CACD7T,EAAGuT,YAAAA,EACH,GACA1hC,IAAAA,CAAKklI,aAAAA,EACL,GACAllI,IAAAA,CAAK8kI,iBAAAA,GAAoB9kI,IAAAA,CAAK0kI,eAAAA,GAGlC1kI,IAAAA,CAAK6kI,YAAAA,GAAe7kI,IAAAA,CAAK+kI,aAAAA,AAAAA,GAE3B52G,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc,KAAA,GAEjC1hC,IAAAA,CAAK4kI,YAAAA,GAAe5kI,IAAAA,CAAK2kI,cAAAA,GAAkB3kI,CAAAA,IAAAA,CAAKmlI,YAAAA,GAAenlI,IAAAA,CAAK0kI,eAAAA,AAAAA;YACtE;YAEA,OAAO5tF,CAAAA,EAAAA;gBAAAA,IAAAA;gBAQL,IAPA92C,IAAAA,CAAK+kI,aAAAA,GAAkC,SAAlB,CAAA,IAAA/kI,IAAAA,CAAKusD,QAAAA,CAAS3B,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI5qD,IAAAA,CAAK+kI,aAAAA,EAC5C/kI,IAAAA,CAAK6kI,YAAAA,GAAe,IACtB7kI,IAAAA,CAAK6kI,YAAAA,IAAgB/tF,IAErB92C,CAAAA,IAAAA,CAAK6kI,YAAAA,GAAe,GACpB7kI,IAAAA,CAAK8kI,iBAAAA,GAAoB,CAAA,GAEtB9kI,IAAAA,CAAKilI,QAAAA,CAAS3kI,MAAAA,EAAnB;oBAGA,IAAK,IAAIE,IAAIR,IAAAA,CAAKilI,QAAAA,CAAS3kI,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IAAK;wBAClD,MAAM+rD,IAAWvsD,IAAAA,CAAKilI,QAAAA,CAASzkI,EAAAA;wBAC/B+rD,CAAAA,CAAS,EAAA,IAAMzV;wBACFyV,CAAAA,CAAS,EAAA,IACV,KACVvsD,IAAAA,CAAKilI,QAAAA,CAASv8H,MAAAA,CAAOlI,GAAG;oBAE5B;oBAEAR,IAAAA,CAAKilI,QAAAA,CAAStzE,IAAAA,CAAK,CAACvvD,GAAGkQ,IAAMlQ,CAAAA,CAAE,EAAA,GAAKkQ,CAAAA,CAAE,EAAA;gBAVtC;YAWF;YAEA,KAAK6b,CAAAA,EAAAA;gBACH,IAAInuB,IAAAA,CAAKyiC,YAAAA,EAAc;oBAgBrB,IAdIziC,IAAAA,CAAKglI,eAAAA,GACP72G,CAAAA,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc1hC,IAAAA,CAAKwkI,QAAAA,CAAAA,AAAUxkI,CAAAA,IAAAA,CAAKykI,UAAAA,GAAa,CAAA,IAAK,EAAA,GACrEt2G,EAAG6T,aAAAA,CAAc7T,EAAGuT,YAAAA,EAAc,GAAG1hC,IAAAA,CAAKklI,aAAAA,GAC1C/2G,EAAGsT,UAAAA,CAAWtT,EAAGuT,YAAAA,EAAc,OAC/B1hC,IAAAA,CAAKglI,eAAAA,GAAAA,CAAkB,CAAA,IAEvBhlI,IAAAA,CAAKgmI,cAAAA,CAAe73G,IAItBA,EAAGkV,eAAAA,CAAgBrjC,IAAAA,CAAK4lI,WAAAA,GACxBz3G,EAAG83G,cAAAA,CAAe93G,EAAG+3G,yBAAAA,EAA2B,GAAGlmI,IAAAA,CAAK6lI,cAAAA,GAGpD7lI,IAAAA,CAAK6kI,YAAAA,IAAgB7kI,IAAAA,CAAKilI,QAAAA,CAAS,EAAA,IAAMjlI,IAAAA,CAAKilI,QAAAA,CAAS,EAAA,CAAG,EAAA,GAAK,GAAG;wBACpE,MAAM7tD,IAAWp3E,IAAAA,CAAKilI,QAAAA,CAAS,EAAA,CAAG,EAAA,GAAKjlI,IAAAA,CAAK0kI,eAAAA;wBAE5CN,MACAA,MACAj2G,EAAGg4G,eAAAA,CACDh4G,EAAG+3G,yBAAAA,EACH,GACAlmI,IAAAA,CAAK6lI,cAAAA,EACiB,IAAtB7lI,IAAAA,CAAKilI,QAAAA,CAAS,EAAA,CAAG,EAAA,EAAA,AAChBjlI,CAAAA,IAAAA,CAAKmlI,YAAAA,GAAe/tD,CAAAA,IAAYp3E,IAAAA,CAAK0kI,eAAAA,GAAkB,IAE1Dv2G,EAAGi4G,sBAAAA,CAAuBj4G,EAAGoX,MAAAA,GAC7BpX,EAAG2W,UAAAA,CAAW3W,EAAGoX,MAAAA,EAAQ6xC,GAAUp3E,IAAAA,CAAKmlI,YAAAA,GAAe/tD,IACvDjpD,EAAGk4G,oBAAAA,IAGHl4G,EAAGg4G,eAAAA,CAAgBh4G,EAAG+3G,yBAAAA,EAA2B,GAAGlmI,IAAAA,CAAK6lI,cAAAA,EAAgB,GAAyB,IAAtB7lI,IAAAA,CAAKilI,QAAAA,CAAS,EAAA,CAAG,EAAA,GAC7F92G,EAAGi4G,sBAAAA,CAAuBj4G,EAAGoX,MAAAA,GAC7BpX,EAAG2W,UAAAA,CAAW3W,EAAGoX,MAAAA,EAAQ,GAAG6xC,IAC5BjpD,EAAGk4G,oBAAAA;oBACL,OACEl4G,EAAGg4G,eAAAA,CAAgBh4G,EAAG+3G,yBAAAA,EAA2B,GAAGlmI,IAAAA,CAAK6lI,cAAAA,EAAgB,GAA+B,IAA5B7lI,IAAAA,CAAKklI,aAAAA,CAAc5kI,MAAAA,GAC/F6tB,EAAGi4G,sBAAAA,CAAuBj4G,EAAGoX,MAAAA,GAC7BpX,EAAG2W,UAAAA,CAAW3W,EAAGoX,MAAAA,EAAQ,GAAGvlC,IAAAA,CAAKmlI,YAAAA,GACjCh3G,EAAGk4G,oBAAAA;oBAILl4G,EAAGkV,eAAAA,CAAgB,OACnBlV,EAAG83G,cAAAA,CAAe93G,EAAG+3G,yBAAAA,EAA2B,GAAG,OAGnDlmI,IAAAA,CAAK4lI,WAAAA,GAAc5lI,IAAAA,CAAKukI,KAAAA,CAAMvkI,IAAAA,CAAKykI,UAAAA,GAAa,EAAA,EAChDzkI,IAAAA,CAAK6lI,cAAAA,GAAiB7lI,IAAAA,CAAKwkI,QAAAA,CAAAA,AAAUxkI,CAAAA,IAAAA,CAAKykI,UAAAA,GAAa,CAAA,IAAK,EAAA,EAC5DzkI,IAAAA,CAAKykI,UAAAA,GAAAA,AAAczkI,CAAAA,IAAAA,CAAKykI,UAAAA,GAAa,CAAA,IAAK;gBAC5C;YACF;QAAA;QA5SgB,GAAA6B,iBAAAA,GAA4B;QCdvC,MAAMC,WAA2B/8C;YAwBtC,IAAA,MAAW3uE;gBACT,OAAO7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GACxB;YAAA;YAEA,IAAA,IAAeA,CAAAA,EAAAA;gBACb7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMA;YACvB;YAEA,IAAA,IAAWgO;gBACT,OAAO7oB,IAAAA,CAAK+c,SAAAA,CAAU8L,CACxB;YAAA;YAEA,IAAA,EAAaA,CAAAA,EAAAA;gBACX7oB,IAAAA,CAAK+c,SAAAA,CAAU8L,CAAAA,GAAIA;YACrB;YAEA,YAAYqiE,CAAAA,CAAAA;gBACVt+D,KAAAA,CAAM;oBAAE6B,MAAM;oBAAsBtU,OAAO+wE,EAAO/wE,KAAAA;oBAAOE,QAAQ6wE,EAAO7wE,MAAAA;gBAAAA,IAxCnE,IAAA,CAAAkyC,QAAAA,GAA8B;oBAInC3B,MAAM;oBACN7tC,WAAWuuC,GAAkBC,MAAAA;oBAC7BnW,SAAAA,KAASt0C;oBACT8nB,SAAS;oBACT+gC,iBAAiB;oBACjBqC,OAAAA,KAAOlrD;oBACPmrD,YAAAA,KAAYnrD;oBACZwiI,gBAAAA,CAAgB;gBAAA,GAGX,IAAA,CAAAxjF,QAAAA,GAAW,IAAIP,IAEf,IAAA,CAAA2jF,UAAAA,GAAAA,CAAsB,GACtB,IAAA,CAAAE,QAAAA,GAAmB,GACnB,IAAA,CAAAC,WAAAA,GAA2B/F,GAAYxwC,SAAAA,EACvC,IAAA,CAAAlhD,MAAAA,GAAiB,GACR,IAAA,CAAAu5F,YAAAA,GAAuB,KAqD/B,IAAA,CAAApC,gBAAAA,GAAmB,GAhCzB/iI,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8/C,QAAAA,EAAAA,CAAU,IAChC9/C,IAAAA,CAAK8/C,QAAAA,CAASM,UAAAA,GAAqBpgD,IAAAA,CAAK6f,IAAAA,CAAKgB,IAAAA,CAAK7gB,IAAAA;gBAEnD,MAAA,EAAM,UAAEusD,CAAAA,EAAQ,cAAE44E,CAAAA,EAAY,GAAE74H,CAAAA,EAAC,GAAElC,CAAAA,EAAC,GAAEye,CAAAA,EAAC,KAAEhO,CAAAA,EAAG,YAAEqoH,CAAAA,EAAU,UAAEE,CAAAA,EAAQ,aAAEC,CAAAA,EAAW,QAAEz3F,CAAAA,EAAM,QAAEj+B,CAAAA,EAAAA,GAAW;oBAAA,GAAKu9E,CAAAA;gBAAAA;gBAEzGlrF,IAAAA,CAAKmlI,YAAAA,GAAez4H,EAAMy4H,QAAAA,IAAAA,IAAgBnlI,IAAAA,CAAKmlI,YAAAA,EAAc,GAAGb,GAAoBgC,iBAAAA,GAEpFtmI,IAAAA,CAAK6a,GAAAA,GAAMA,QAAAA,IAAAA,IAAOnM,EAAIpC,QAAAA,IAAAA,IAAK,GAAGlC,QAAAA,IAAAA,IAAK,IAEnCpK,IAAAA,CAAK6oB,CAAAA,GAAIA,QAAAA,IAAAA,IAAK,GAEd7oB,IAAAA,CAAKkjI,UAAAA,GAAaA,QAAAA,IAAAA,IAAcljI,IAAAA,CAAKkjI,UAAAA,EAErCljI,IAAAA,CAAKojI,QAAAA,GAAWA,QAAAA,IAAAA,IAAYpjI,IAAAA,CAAKojI,QAAAA,EAEjCpjI,IAAAA,CAAKqjI,WAAAA,GAAcA,QAAAA,IAAAA,IAAerjI,IAAAA,CAAKqjI,WAAAA,EAEvCrjI,IAAAA,CAAK4rC,MAAAA,GAASA,QAAAA,IAAAA,IAAU5rC,IAAAA,CAAK4rC,MAAAA,EAE7B5rC,IAAAA,CAAKusD,QAAAA,GAAW;oBAAA,GAAKvsD,IAAAA,CAAKusD,QAAAA;oBAAAA,GAAaA,CAAAA;gBAAAA,GAEvCvsD,IAAAA,CAAK2N,MAAAA,GAASA,QAAAA,IAAAA,IAAU,IAAI5E,GAE5B/I,IAAAA,CAAKysC,QAAAA,GAAW,IAAI63F,GAAoBtkI,IAAAA,EAAMA,IAAAA,CAAK2N,MAAAA,EAAQ3N,IAAAA,CAAKusD,QAAAA;YAClE;YAEO,YAAYtyC,CAAAA,EAAAA;gBACjB2S,KAAAA,CAAMugB,YAAYlzB;gBAClB,MAAMoqB,IAAUpqB,EAAO2yB,eAAAA;gBACvB5sC,IAAAA,CAAKysC,QAAAA,CAAS7J,UAAAA,CAAWyB,EAAQiJ,IAAAA,EAAMjJ;YACzC;YAGO,OAAOpqB,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAC5BlqB,KAAAA,CAAM6gB,OAAOxzB,GAAQ68B,IAEjB92C,IAAAA,CAAKkjI,UAAAA,IACPljI,CAAAA,IAAAA,CAAK+iI,gBAAAA,IAAoB/iI,IAAAA,CAAKojI,QAAAA,GAAYtsF,CAAAA,IAAU,GAAA,GAChD92C,IAAAA,CAAK+iI,gBAAAA,GAAmB,KAC1B/iI,CAAAA,IAAAA,CAAKwjI,aAAAA,CAAcl+H,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAK+iI,gBAAAA,IACnC/iI,IAAAA,CAAK+iI,gBAAAA,GAAmB/iI,IAAAA,CAAK+iI,gBAAAA,GAAmBz9H,KAAKoF,KAAAA,CAAM1K,IAAAA,CAAK+iI,gBAAAA,CAAAA,CAAAA,GAGpE/iI,IAAAA,CAAKysC,QAAAA,CAASgB,MAAAA,CAAOqJ;YACvB;YAEO,cAAc2sF,CAAAA,EAAAA;gBACfA,KAAiB,KAGrBzjI,IAAAA,CAAKysC,QAAAA,CAAS+2F,aAAAA,CAA8B,IAAhBC;YAC9B;YAEO,iBAAAE;gBACL3jI,IAAAA,CAAKysC,QAAAA,CAASk3F,cAAAA;YAChB;YAEA,KAAKvsG,CAAAA,EAAoC0f,CAAAA,EAAAA;gBACvC1f,EAAIvX,IAAAA,CAAuB,eAAe7f,IAAAA,CAAKysC,QAAAA,EAAUqK;YAC3D;QAAA;QCtFK,MAAM0vF,WAAsBphF;YAW1B,cAAAkjD;gBACL,OAAOtoG,IAAAA,CAAKggD,SACd;YAAA;YAIO,WAAW5K,CAAAA,EAAkBn8B,CAAAA,EAAAA;gBAClCjZ,IAAAA,CAAKggD,SAAAA,CAAUrgD,IAAAA,CAAKy1C,IACpBp1C,IAAAA,CAAKymI,IAAAA,CAAKhnF,SAAAA,GAAYz/C,IAAAA,CAAKC,GAAAA,CAAIw/C,SAAAA,EAC/Bz/C,IAAAA,CAAKymI,IAAAA,CAAK79G,OAAAA,GAAU5oB,IAAAA,CAAKC,GAAAA,CAAI2oB,OAAAA,EAAAA,AACzB3P,CAAAA,QAAAA,IAAAA,KAAO,IAAPA,EAASgc,MAAAA,AAAAA,KACXj1B,CAAAA,IAAAA,CAAKymI,IAAAA,CAAKxxG,MAAAA,GAAShc,EAAQgc,MAAAA,AAAAA,GAG7Bj1B,IAAAA,CAAKymI,IAAAA,CAAKv6G,WAAAA,GAAclsB,IAAAA,CAAK0mI,kBAAAA;YAC/B;YAEQ,qBAAAA;gBACN,IAAI1xG,IAASh1B,IAAAA,CAAK2mI,WAAAA,CAAY10H,KAAAA;gBAC9B,KAAK,MAAMmjC,KAAWp1C,IAAAA,CAAKggD,SAAAA,CAAW;oBACpC,MAAM/qB,IAASvmB,EACb1O,IAAAA,CAAKC,GAAAA,CAAI2mI,cAAAA,CAAet6H,CAAAA,GAAItM,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,GAAY,GACjDzlG,IAAAA,CAAKC,GAAAA,CAAI2mI,cAAAA,CAAex8H,CAAAA,GAAKpK,CAAAA,IAAAA,CAAKC,GAAAA,CAAI6lG,sBAAAA,GAAyB,IAAI1wD,EAAQ/6B,MAAAA,GAASra,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,AAAAA;oBAE/F1wE,IAASA,EAAOhW,OAAAA,CAAQo2B,EAAQlpB,WAAAA,CAAYvP,SAAAA,CAAUsY;gBACxD;gBACA,OAAOD;YACT;YAEO,cAAcogB,CAAAA,EAAAA;gBACnB,MAAM5pC,IAAQxL,IAAAA,CAAKggD,SAAAA,CAAUv3C,OAAAA,CAAQ2sC;gBACjC5pC,IAAAA,MACFxL,IAAAA,CAAKggD,SAAAA,CAAUt3C,MAAAA,CAAO8C,GAAO,IAE/BxL,IAAAA,CAAKymI,IAAAA,CAAKv6G,WAAAA,GAAclsB,IAAAA,CAAK0mI,kBAAAA;YAC/B;YAEO,gBAAA98B;gBACL5pG,IAAAA,CAAKggD,SAAAA,CAAU1/C,MAAAA,GAAS,GACxBN,IAAAA,CAAKymI,IAAAA,CAAKhnF,SAAAA,GAAAA,CAAY,GACtBz/C,IAAAA,CAAKymI,IAAAA,CAAKv6G,WAAAA,GAAclsB,IAAAA,CAAK0mI,kBAAAA;YAC/B;YAMO,eAAAh2D;gBACL,OAAO1wE,IAAAA,CAAKuwE,UACd;YAAA;YAQO,YAAYzD,CAAAA,EAAAA;gBACjB9sE,IAAAA,CAAKuwE,UAAAA,CAAW5wE,IAAAA,CAAKmtE,IACrB9sE,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAMO,eAAev4B,CAAAA,EAAAA;gBACpB,MAAMthE,IAAQxL,IAAAA,CAAKuwE,UAAAA,CAAW9nE,OAAAA,CAAQqkE;gBAClCthE,IAAAA,MACFxL,IAAAA,CAAKuwE,UAAAA,CAAW7nE,MAAAA,CAAO8C,GAAO,IAEhCxL,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAKO,iBAAA9vB;gBACLv1E,IAAAA,CAAKuwE,UAAAA,CAAWjwE,MAAAA,GAAS,GACzBN,IAAAA,CAAKC,GAAAA,CAAIolG,kBAAAA;YACX;YAqBA,IAAA,MAAWxqF;gBACT,OAAO7a,IAAAA,CAAKC,GAAAA,CAAI4mI,WAAAA,CAAYn4H,EAAI1O,IAAAA,CAAKsM,CAAAA,EAAGtM,IAAAA,CAAKoK,CAAAA;YAC/C;YAKA,IAAA,SAAWkS;gBACT,OAAOtc,IAAAA,CAAK6a,GAAAA,CAAIzK,GAAAA,CAAI1B,EAAI,GAAG1O,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,GAAa;YACnD;YAcA,YAAYp5F,CAAAA,EAAWlC,CAAAA,EAAWw8H,CAAAA,EAA+B3mI,CAAAA,CAAAA;gBAC/D2sB,KAAAA,CAAM;oBACJ,IAAI+lB;oBACJ,IAAI4M,GAAkB;wBACpBtqB,QAAQ2xG,QAAAA,IAAAA,IAAkB94H,EAAOC,IAAAA;wBACjCqyC,YAAY,CAACmoD,GAAKzxD,IAAY92C,IAAAA,CAAK6f,IAAAA,CAAK0oF,GAAKzxD;oBAAAA;oBAE/C,IAAI2pE,GAAyBxgH;iBAAAA,GA1I1B,IAAA,CAAAgnG,KAAAA,GAAAA,CAAiB,GAEjB,IAAA,CAAA/sF,MAAAA,GAAS,IAAIhT,GAGZ,IAAA,CAAAy/H,WAAAA,GAAc,IAAIrrH,GAClB,IAAA,CAAA0kC,SAAAA,GAAuB,EAAA,EA+CvB,IAAA,CAAAuwB,UAAAA,GAAyB,EAAA,EAqE1B,IAAA,CAAA9uE,IAAAA,GAAO,IAAI6sB,KAkBhBtuB,IAAAA,CAAKsM,CAAAA,GAAIA,GACTtM,IAAAA,CAAKoK,CAAAA,GAAIA,GACTpK,IAAAA,CAAKC,GAAAA,GAAMA,GACXD,IAAAA,CAAK6yC,UAAAA,GAAa7yC,IAAAA,CAAK2C,GAAAA,CAAIgwC,KAC3B3yC,IAAAA,CAAK8mI,yBAAAA,GAA4B9mI,IAAAA,CAAK2C,GAAAA,CAAI89G;gBAE1C,MAAMsmB,IAAgB/mI,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,GAAY,GACrCuhC,IAAiBhnI,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,GAAa,GAGvChrF,IAAAA,AAAQ1a,CAAAA,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKoK,CAAAA,AAAAA,IAAK28H,GAE3BE,IAAAA,AAAQjnI,CAAAA,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKoK,CAAAA,AAAAA,IAAK48H;gBACjChnI,IAAAA,CAAK6yC,UAAAA,CAAWh4B,GAAAA,GAAMnM,EAAIgM,GAAMusH,IAChCjnI,IAAAA,CAAK8mI,yBAAAA,CAA0BnmB,SAAAA,GAAY1gH,EAAI0gH,SAAAA,EAE/C3gH,IAAAA,CAAKymI,IAAAA,GAAOzmI,IAAAA,CAAK2C,GAAAA,CAAI48C,KACrBv/C,IAAAA,CAAKymI,IAAAA,CAAKhnF,SAAAA,GAAAA,CAAY;gBACtB,MAAMynF,IAAalnI,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,EACtB0hC,IAAcnnI,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,EAGvBzwE,IAASvmB,EAAI,GAAG1O,IAAAA,CAAKC,GAAAA,CAAI6lG,sBAAAA,GAAyBqhC,IAAc;gBACtEnnI,IAAAA,CAAKymI,IAAAA,CAAKv6G,WAAAA,GAAclsB,IAAAA,CAAK2mI,WAAAA,GAAc,IAAIrrH,EAAY;oBACzDd,MAAAA,CAAO0sH,IAAa;oBACpBzsH,KAAAA,CAAM0sH;oBACN3rH,OAAO0rH,IAAa;oBACpBzrH,QAAQ0rH;gBAAAA,GACPxqH,SAAAA,CAAUsY;YACf;YAEA,KAAKszE,CAAAA,EAA+B6rB,CAAAA,EAAAA;gBAClC,MAAM2S,IAAgB/mI,IAAAA,CAAKC,GAAAA,CAAIwlG,SAAAA,GAAY;gBAC3C8C,EAAIhgF,IAAAA,IAEJggF,EAAI5rF,SAAAA,CAAAA,CAAWoqH,GAAe;gBAC9B,KAAK,MAAM3xF,KAAWp1C,IAAAA,CAAKggD,SAAAA,CACzB5K,EAAQv1B,IAAAA,CACN0oF,GACAvoG,IAAAA,CAAKC,GAAAA,CAAI2mI,cAAAA,CAAet6H,CAAAA,EACxBtM,IAAAA,CAAKC,GAAAA,CAAI2mI,cAAAA,CAAex8H,CAAAA,GAAKpK,CAAAA,IAAAA,CAAKC,GAAAA,CAAI6lG,sBAAAA,GAAyB,IAAI1wD,EAAQ/6B,MAAAA,GAASra,IAAAA,CAAKC,GAAAA,CAAIylG,UAAAA,AAAAA;gBAGjG6C,EAAI//E,OAAAA;YACN;QAAA;QAiDK,MAAM4+G,WAAqBhiF;YA4BhC,IAAA,UAAW5F;gBACT,OAAOx/C,IAAAA,CAAKy/C,SACd;YAAA;YAMA,IAAA,QAAmBhzC,CAAAA,EAAAA;gBACjBzM,IAAAA,CAAKy/C,SAAAA,GAAYhzC;YACnB;YAmCA,YAAYwM,CAAAA,CAAAA;gBACV2T,KAAAA,CACE;oBACE,IAAI+lB;oBACJ,IAAI65B,GAAc;wBAChB/lE,MAAMgkE,GAAc1V,KAAAA;oBAAAA;oBAEtB,IAAIi0B;oBACJ,IAAI+D;oBACJ,IAAIiV,GAAuB,CAAC5qE,GAAK+uE,IAAenmG,IAAAA,CAAKgY,KAAAA,CAAMof,GAAK+uE,IAAAA,CAAa;iBAAA,EAE/EltF,EAAQwV,IAAAA,GAnFI,IAAA,CAAAkyF,SAAAA,GAAoB,GA0C7B,IAAA,CAAAlhE,SAAAA,GAAAA,CAAY,GAKZ,IAAA,CAAA72B,OAAAA,GAAU,GAOV,IAAA,CAAAk9E,sBAAAA,GAAAA,CAAkC,GAClC,IAAA,CAAA8gC,cAAAA,GAAyBl4H,EAAI,GAAG,IAqG/B,IAAA,CAAA42F,eAAAA,GAAAA,CAAkB,GAKlB,IAAA,CAAAW,gBAAAA,GAAmB,IAAIC;gBA5E7B,MAAA,EAAM,KAAErrF,CAAAA,EAAG,WAAE4qF,CAAAA,EAAS,YAAEC,CAAAA,EAAY3vE,SAAS5b,CAAAA,EAAO2b,MAAMzb,CAAAA,EAAM,wBAAEyrF,CAAAA,EAAsB,gBAAE8gC,CAAAA,EAAc,WAAEjmB,CAAAA,EAAAA,GAAc1nG;gBAExHjZ,IAAAA,CAAK+c,SAAAA,GAAY/c,IAAAA,CAAK2C,GAAAA,CAAIgwC,KACtB93B,KACF7a,CAAAA,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMA,CAAAA,GAGvB7a,IAAAA,CAAK8sE,QAAAA,GAAW9sE,IAAAA,CAAK2C,GAAAA,CAAIqmF,KACrBhpF,IAAAA,CAAK8sE,QAAAA,IACP9sE,IAAAA,CAAK8sE,QAAAA,CAAS9hD,GAAAA,CAAKhrB,IAAAA,CAAKomG,UAAAA,GAAa,IAAIj1B,GAAkB,EAAA,IAG7DnxE,IAAAA,CAAK++F,OAAAA,GAAU/+F,IAAAA,CAAK2C,GAAAA,CAAIoqF,KAExB/sF,IAAAA,CAAK8lG,sBAAAA,GAAyBA,QAAAA,IAAAA,IAA0B9lG,IAAAA,CAAK8lG,sBAAAA,EAC7D9lG,IAAAA,CAAK4mI,cAAAA,GAAiBA,QAAAA,IAAAA,IAAkB5mI,IAAAA,CAAK4mI,cAAAA,EAE7C5mI,IAAAA,CAAK2gH,SAAAA,GAAYA,QAAAA,IAAAA,IAAa3gH,IAAAA,CAAK2gH,SAAAA,EACnC3gH,IAAAA,CAAKylG,SAAAA,GAAYA,GACjBzlG,IAAAA,CAAK0lG,UAAAA,GAAaA,GAClB1lG,IAAAA,CAAK+1B,OAAAA,GAAU5b,GACfna,IAAAA,CAAK81B,IAAAA,GAAOzb,GAEZra,IAAAA,CAAKumG,uBAAAA,GAA0B,IAAIhE,IAEnCviG,IAAAA,CAAKwlG,KAAAA,GAAQ,IAAIz7F,MAAMoQ,IAAQE;gBAG/B,IAAK,IAAIjQ,IAAI,GAAGA,IAAIiQ,GAAQjQ,IAC1B,IAAK,IAAIkC,IAAI,GAAGA,IAAI6N,GAAO7N,IAAK;oBAC9B,MAAMm6F,IAAO,IAAI+/B,GAAcl6H,GAAGlC,GAAGpK,IAAAA,CAAK4mI,cAAAA,EAAgB5mI,IAAAA;oBAC1DA,IAAAA,CAAKwlG,KAAAA,CAAMl5F,IAAIlC,IAAI+P,EAAAA,GAASssF,GAC5BzmG,IAAAA,CAAKwnD,QAAAA,CAASi/C,IACdzmG,IAAAA,CAAKumG,uBAAAA,CAAwB1D,SAAAA,CAC3B4D,GACCnwF,CAAAA,IAAMtW,IAAAA,CAAKqnG,cAAAA,CAAe/wF,EAAEm/D,QAAAA,MAAcgxB,GAC3C,IAAA,CAAM;gBAEV;gBAGFzmG,IAAAA,CAAK++F,OAAAA,CAAQ7yE,WAAAA,GAAc5Q,EAAYc,aAAAA,CACrCqpF,IAAYtrF,IAAQna,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,CAAM3D,CAAAA,EACzCo5F,IAAarrF,IAASra,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,CAAM7F,CAAAA,EAC3CsE,EAAI,IAAK;YAEb;YAKO,wBAAwBg1F,CAAAA,EAAAA;gBAC7B1jG,IAAAA,CAAKumG,uBAAAA,CAAwB/B,sBAAAA,CAAuBd,GAAU1jG,IAAAA,CAAKwlG,KAAAA;YACrE;YAKO,uBAAuB9B,CAAAA,EAAAA;gBAC5B1jG,IAAAA,CAAKumG,uBAAAA,CAAwB9C,cAAAA,CAAeC,GAAU1jG,IAAAA,CAAKwlG,KAAAA;YAC7D;YAEO,SAAA/3D;gBACDztC,IAAAA,CAAKslG,eAAAA,IACPtlG,CAAAA,IAAAA,CAAKqnI,eAAAA,IACLrnI,IAAAA,CAAKslG,eAAAA,GAAAA,CAAkB,CAAA,GAGzBtlG,IAAAA,CAAKumG,uBAAAA,CAAwB/+F,KAAAA;YAC/B;YAGO,qBAAA69F;gBACLrlG,IAAAA,CAAKslG,eAAAA,GAAAA,CAAkB;YACzB;YAGQ,gCAAgCx4B,CAAAA,EAAAA;gBAAAA,IAAAA;gBACtC,IAAK9sE,IAAAA,CAAKimG,gBAAAA,CAAiBluF,GAAAA,CAAI+0D,IAK7B,OAA0C,SAAnC,CAAA,IAAA9sE,IAAAA,CAAKimG,gBAAAA,CAAiBtjG,GAAAA,CAAImqE,EAAAA,KAAAA,KAAS,MAAA,IAAA,IAAIh/D,EAAOC,IAAAA;gBALb;oBACxC,MAAM64F,IAAiB95B,EAAS73C,MAAAA;oBAEhC,OADAj1B,IAAAA,CAAKimG,gBAAAA,CAAiBj7E,GAAAA,CAAI8hD,GAAU85B,IAC7BA;gBACT;YAGF;YACO,kBAAAygC;gBACLrnI,IAAAA,CAAKomG,UAAAA,CAAW7wB,cAAAA;gBAChB,MAAM16D,IAAM7a,IAAAA,CAAK2C,GAAAA,CAAIgwC,IAAoB93B,GAAAA;gBACzC,KAAK,MAAM4rF,KAAQzmG,IAAAA,CAAKwlG,KAAAA,CACtB,IAAIiB,EAAKQ,KAAAA,EACP,KAAK,MAAMn6B,KAAY25B,EAAK/1B,YAAAA,GAAgB;oBAC1C,MAAMk2B,IAAiB5mG,IAAAA,CAAK2mG,+BAAAA,CAAgC75B;oBAC5DA,EAAS73C,MAAAA,GAASj1B,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAI+3F,EAAKn6F,CAAAA,EAAGm6F,EAAKr8F,CAAAA,GACjDmG,GAAAA,CAAIsK,GACJzK,GAAAA,CAAIw2F,GACJr2F,GAAAA,CAAI7B,EAAI1O,IAAAA,CAAKylG,SAAAA,GAAY,GAAGzlG,IAAAA,CAAK0lG,UAAAA,IACpC54B,EAASl7B,KAAAA,GAAQ5xC,IAAAA,EACjBA,IAAAA,CAAKomG,UAAAA,CAAW9wB,WAAAA,CAAYxI;gBAC9B;gBAGJ9sE,IAAAA,CAAK8sE,QAAAA,CAASr/B,MAAAA;YAChB;YAMO,YAAY85F,CAAAA,EAAAA;gBAEjBA,IAAkBA,EAAgBh3H,GAAAA,CAAIvQ,IAAAA,CAAK+c,SAAAA,CAAU+zB,SAAAA;gBAErD,MAAMi2F,IAAgB/mI,IAAAA,CAAKylG,SAAAA,GAAY,GACjCuhC,IAAiBhnI,IAAAA,CAAK0lG,UAAAA,GAAa;gBAEzC,OAAOh3F,EAAAA,CAAAA,CAAAA,CAAAA,AACD64H,CAAAA,EAAgBj7H,CAAAA,GAAIy6H,IAAgBQ,EAAgBn9H,CAAAA,GAAI48H,CAAAA,IAAkB,CAAA,GAAA,CAAA,CAAA,CAAA,AAC1EO,CAAAA,EAAgBn9H,CAAAA,GAAI48H,IAAiBO,EAAgBj7H,CAAAA,GAAIy6H,CAAAA,IAAiB,CAAA;YAElF;YAMO,YAAYS,CAAAA,EAAAA;gBACjB,MAAMT,IAAgB/mI,IAAAA,CAAKylG,SAAAA,GAAY,GACjCuhC,IAAiBhnI,IAAAA,CAAK0lG,UAAAA,GAAa;gBAKzC,OAAOh3F,EAAAA,AAHO84H,CAAAA,EAAel7H,CAAAA,GAAIk7H,EAAep9H,CAAAA,AAAAA,IAAK28H,GAAAA,AAEvCS,CAAAA,EAAel7H,CAAAA,GAAIk7H,EAAep9H,CAAAA,AAAAA,IAAK48H,GAC9B52H,GAAAA,CAAIpQ,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA;YAC5C;YAKO,QAAQvO,CAAAA,EAAWlC,CAAAA,EAAAA;gBACxB,OAAIkC,IAAI,KAAKlC,IAAI,KAAKkC,KAAKtM,IAAAA,CAAK+1B,OAAAA,IAAW3rB,KAAKpK,IAAAA,CAAK81B,IAAAA,GAC5C,OAEF91B,IAAAA,CAAKwlG,KAAAA,CAAMl5F,IAAIlC,IAAIpK,IAAAA,CAAK+1B,OAAAA,CACjC;YAAA;YAMO,eAAenZ,CAAAA,EAAAA;gBACpB,MAAM6qH,IAAYznI,IAAAA,CAAKsnI,WAAAA,CAAY1qH;gBAEnC,OADa5c,IAAAA,CAAKonG,OAAAA,CAAQqgC,EAAUn7H,CAAAA,EAAGm7H,EAAUr9H,CAAAA;YAEnD;YAEQ,gBAAAs9H;gBACN,IAAIC,IAAOppH,OAAOqpH,iBAAAA;gBAClB,KAAK,MAAMnhC,KAAQzmG,IAAAA,CAAKwlG,KAAAA,CAAO;oBAC7B,MAAMqiC,IAAWphC,EAAK9jG,GAAAA,CAAIgwC,IAAoB9pB,CAAAA;oBAC1Cg/G,IAAWF,KACbA,CAAAA,IAAOE,CAAAA;gBAEX;gBACA,OAAOF;YACT;YAMO,MAAMp/B,CAAAA,EAA+BpC,CAAAA,EAAAA;gBAC1C,MAAA,EAAM,SAAEqC,CAAAA,EAAO,cAAE6T,CAAAA,EAAY,eAAEC,CAAAA,EAAa,cAAEqU,CAAAA,EAAY,UAAEloB,CAAAA,EAAQ,WAAEC,CAAAA,EAAS,WAAEC,CAAAA,EAAS,sBAAEK,CAAAA,EAAAA,GAC1F7C,EAAWuqB,SAAAA,EAAAA,EAEP,eAAExnB,CAAAA,EAAa,mBAAEC,CAAAA,EAAiB,mBAAEC,CAAAA,EAAAA,GAAsBjD,EAAWr5B,QAAAA;gBAG3E,IAFAy7B,EAAIhgF,IAAAA,IACJggF,EAAI1/E,CAAAA,GAAI7oB,IAAAA,CAAK0nI,aAAAA,KAAkB,IAC3Bl/B,KAAWC,GAAU;oBACvB,IAAK,IAAIr+F,IAAI,GAAGA,IAAIpK,IAAAA,CAAK81B,IAAAA,GAAO,GAAG1rB,IAAK;wBACtC,MAAMoQ,IAAOxa,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAI,GAAGtE,KAC/BoR,IAAQxb,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAI1O,IAAAA,CAAK+1B,OAAAA,EAAS3rB;wBACjDm+F,EAAIx9D,QAAAA,CAASvwB,GAAMgB,GAAOktF,GAAWC;oBACvC;oBAEA,IAAK,IAAIr8F,IAAI,GAAGA,IAAItM,IAAAA,CAAK+1B,OAAAA,GAAU,GAAGzpB,IAAK;wBACzC,MAAMmO,IAAMza,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAIpC,GAAG,KAC9BmP,IAASzb,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAIpC,GAAGtM,IAAAA,CAAK81B,IAAAA;wBAC5CyyE,EAAIx9D,QAAAA,CAAStwB,GAAKgB,GAAQitF,GAAWC;oBACvC;gBACF;gBAEA,IAAIH,KAAW6T,GACb,KAAK,MAAM5V,KAAQzmG,IAAAA,CAAKwlG,KAAAA,CACtB+C,EAAIx3C,UAAAA,CAAW/wD,IAAAA,CAAK6mI,WAAAA,CAAYn4H,EAAI+3F,EAAKn6F,CAAAA,EAAGm6F,EAAKr8F,CAAAA,IAAKumH,GAAcrU;gBAGxE,IAAI9T,KAAWQ,GACb;oBAAA,KAAK,MAAMvC,KAAQzmG,IAAAA,CAAKwlG,KAAAA,CACtB,IAAIiB,EAAKQ,KAAAA,EAEP,KAAK,MAAMn6B,KAAY25B,EAAK/1B,YAAAA,GAC1B5D,EAAS90D,KAAAA,CAAMuwF,GAAKW,GAAe;wBAAElxD,WAAWmxD;wBAAmBE,WAAWD;oBAAAA;gBAAAA;gBAKtFb,EAAI//E,OAAAA;YACN;QAAA;QCriBK,MAAMs/G;YAMX,YAAY5jF,CAAAA,EAAgB6jF,CAAAA,CAAAA;gBAL5B,IAAA,CAAAnoI,EAAAA,GAAK+uF,MAEG,IAAA,CAAAG,QAAAA,GAAAA,CAAoB,GAI1B9uF,IAAAA,CAAKgoI,gBAAAA,GAAmBD,GACxB/nI,IAAAA,CAAKioI,gBAAAA,GAAmB,IAAIh5C,GAAc/qC,IAC1ClkD,IAAAA,CAAKkvF,YAAAA,GAAelvF,IAAAA,CAAKioI,gBAAAA,CAAiB94C,QAAAA,IAC1CnvF,IAAAA,CAAKgoI,gBAAAA,CAAiBhoI,IAAAA,CAAKioI,gBAAAA;YAC7B;YAEO,OAAOnxF,CAAAA,EAAAA;gBACZ92C,IAAAA,CAAKkvF,YAAAA,CAAazhD,MAAAA,CAAOqJ;YAC3B;YAEO,aAAA23C;gBACL,OAAOzuF,IAAAA,CAAK8uF,QAAAA,IAAY9uF,IAAAA,CAAKkvF,YAAAA,CAAaT,UAAAA;YAC5C;YAEO,OAAAxuB;gBACLjgE,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW;YAClB;YAEO,QAAAnzE;gBACL3b,IAAAA,CAAK8uF,QAAAA,GAAAA,CAAW,GAChB9uF,IAAAA,CAAKkvF,YAAAA,CAAavzE,KAAAA;YACpB;YAEO,MAAMuoC,CAAAA,EAAAA;gBACX,OAAO,IAAI4jF,GAAe5jF,GAAQlkD,IAAAA,CAAKgoI,gBAAAA;YACzC;QAAA;QCnCK,MAAME;YAIX,YAAYC,CAAAA,CAAAA;gBAHZ,IAAA,CAAAvoI,EAAAA,GAAK+uF,MAIH3uF,IAAAA,CAAKguF,QAAAA,GAAWm6C;YAClB;YAEA,OAAOrxF,CAAAA,EAAAA;gBACL,IAAK,IAAIt2C,IAAI,GAAGA,IAAIR,IAAAA,CAAKguF,QAAAA,CAAS1tF,MAAAA,EAAQE,IACxCR,IAAAA,CAAKguF,QAAAA,CAASxtF,EAAAA,CAAGitC,MAAAA,CAAOqJ;YAE5B;YACA,WAAWoN,CAAAA,EAAAA;gBACT,OAAOlkD,IAAAA,CAAKguF,QAAAA,CAASo6C,KAAAA,CAAOhmI,CAAAA,IAAMA,EAAEqsF,UAAAA,CAAWvqC;YACjD;YACA,QAAAvoC;gBACE3b,IAAAA,CAAKguF,QAAAA,CAAS7vC,OAAAA,CAAS/7C,CAAAA,IAAMA,EAAEuZ,KAAAA;YACjC;YACA,OAAAskD;gBACEjgE,IAAAA,CAAKguF,QAAAA,CAAS7vC,OAAAA,CAAS/7C,CAAAA,IAAMA,EAAE69D,IAAAA;YACjC;QAAA;QCTK,MAAMooE;YAiBX,YACSrzG,CAAAA,EACA/b,CAAAA,CAAAA;gBADA,IAAA,CAAA+b,MAAAA,GAAAA,GACA,IAAA,CAAA/b,OAAAA,GAAAA,GAlBD,IAAA,CAAAqvH,eAAAA,GAAmC;oBACzCC,UAAU;oBACVC,UAAU;oBACV/wH,OAAO;gBAAA,GAKF,IAAA,CAAAgxH,KAAAA,GAAiB,EAAA,EAChB,IAAA,CAAAC,UAAAA,GAAAA,CAAa,GAEd,IAAA,CAAAnsH,OAAAA,GAAkC,MAClC,IAAA,CAAAE,QAAAA,GAAmC,MACnC,IAAA,CAAAC,UAAAA,GAAqC,MACrC,IAAA,CAAAF,WAAAA,GAAsC,MAM3Cxc,IAAAA,CAAKiZ,OAAAA,GAAU;oBAAA,GAAKjZ,IAAAA,CAAKsoI,eAAAA;oBAAAA,GAAoBrvH,CAAAA;gBAAAA,GAC7CjZ,IAAAA,CAAK2oI,SAAAA,GAAY3zG,EAAO7a,KAAAA,GAAQ,GAChCna,IAAAA,CAAK4oI,UAAAA,GAAa5zG,EAAO3a,MAAAA,GAAS;YACpC;YAKQ,SAAAwuH;gBACN7oI,IAAAA,CAAK0oI,UAAAA,GAAAA,CAAa;gBAClB,MAAMI,IAAkB;oBACtBP,UAAUvoI,IAAAA,CAAKiZ,OAAAA,CAAQsvH,QAAAA;oBACvBC,UAAUxoI,IAAAA,CAAKiZ,OAAAA,CAAQuvH,QAAAA;oBACvB/wH,OAAOzX,IAAAA,CAAKiZ,OAAAA,CAAQxB,KAAAA,GAAQ;gBAAA;gBAE9BzX,IAAAA,CAAKuc,OAAAA,GAAU,IAAI8rH,GACjB,IAAI/sH,EAAY;oBACdd,MAAMxa,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA;oBAClBC,KAAKza,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA;oBACjBe,OAAOxb,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAK2oI,SAAAA;oBAC/BltH,QAAQzb,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAK4oI,UAAAA;gBAAAA,IAEjCE,IAEF9oI,IAAAA,CAAKyc,QAAAA,GAAW,IAAI4rH,GAClB,IAAI/sH,EAAY;oBACdd,MAAMxa,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAK2oI,SAAAA;oBAC9BluH,KAAKza,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA;oBACjBe,OAAOxb,IAAAA,CAAKg1B,MAAAA,CAAOxZ,KAAAA;oBACnBC,QAAQzb,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAK4oI,UAAAA;gBAAAA,IAEjCE,IAEF9oI,IAAAA,CAAK0c,UAAAA,GAAa,IAAI2rH,GACpB,IAAI/sH,EAAY;oBACdd,MAAMxa,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA;oBAClBC,KAAKza,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAK4oI,UAAAA;oBAC5BptH,OAAOxb,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAK2oI,SAAAA;oBAC/BltH,QAAQzb,IAAAA,CAAKg1B,MAAAA,CAAOvZ,MAAAA;gBAAAA,IAEtBqtH,IAEF9oI,IAAAA,CAAKwc,WAAAA,GAAc,IAAI6rH,GACrB,IAAI/sH,EAAY;oBACdd,MAAMxa,IAAAA,CAAKg1B,MAAAA,CAAOxa,IAAAA,GAAOxa,IAAAA,CAAK2oI,SAAAA;oBAC9BluH,KAAKza,IAAAA,CAAKg1B,MAAAA,CAAOva,GAAAA,GAAMza,IAAAA,CAAK4oI,UAAAA;oBAC5BptH,OAAOxb,IAAAA,CAAKg1B,MAAAA,CAAOxZ,KAAAA;oBACnBC,QAAQzb,IAAAA,CAAKg1B,MAAAA,CAAOvZ,MAAAA;gBAAAA,IAEtBqtH;YAEJ;YAEQ,oBAAoB5oI,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACV,CAAA,SAAZ,CAAA,IAAAF,IAAAA,CAAKuc,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAEyY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACrCh1B,IAAAA,CAAKuc,OAAAA,CAAQysH,MAAAA,CAAO9oI,IAAAA,AAGL,CAAA,SAAb,CAAA,IAAAF,IAAAA,CAAKyc,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEuY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACtCh1B,IAAAA,CAAKyc,QAAAA,CAASusH,MAAAA,CAAO9oI,IAAAA,AAGJ,CAAA,SAAf,CAAA,IAAAF,IAAAA,CAAK0c,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEsY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACxCh1B,IAAAA,CAAK0c,UAAAA,CAAWssH,MAAAA,CAAO9oI,IAAAA,AAGL,CAAA,SAAhB,CAAA,IAAAF,IAAAA,CAAKwc,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAEwY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACzCh1B,IAAAA,CAAKwc,WAAAA,CAAYwsH,MAAAA,CAAO9oI;YAE5B;YAMA,OAAOA,CAAAA,EAAAA;gBAEL,IAAIF,IAAAA,CAAK0oI,UAAAA,EACP1oI,IAAAA,CAAK+oI,mBAAAA,CAAoB7oI;qBAQ3B,IAHAF,IAAAA,CAAKyoI,KAAAA,CAAM9oI,IAAAA,CAAKO,IAGZF,IAAAA,CAAKyoI,KAAAA,CAAMnoI,MAAAA,GAASN,IAAAA,CAAKiZ,OAAAA,CAAQuvH,QAAAA,IAAYxoI,IAAAA,CAAKiZ,OAAAA,CAAQxB,KAAAA,GAAQzX,IAAAA,CAAKiZ,OAAAA,CAAQsvH,QAAAA,EAAU;oBACtFvoI,IAAAA,CAAK0oI,UAAAA,IACR1oI,IAAAA,CAAK6oI,MAAAA;oBAGP,KAAK,MAAM3oI,KAAQF,IAAAA,CAAKyoI,KAAAA,CACtBzoI,IAAAA,CAAK+oI,mBAAAA,CAAoB7oI;oBAG3BF,IAAAA,CAAKyoI,KAAAA,CAAMnoI,MAAAA,GAAS;gBACtB;YACF;YAMA,OAAOJ,CAAAA,EAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACL,IAAKF,IAAAA,CAAKg1B,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA;oBAI/B,IAAKh1B,IAAAA,CAAK0oI,UAAAA,EAAAA,AAQM,CAAA,SAAZ,CAAA,IAAA1oI,IAAAA,CAAKuc,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,KAAA,IAAA,EAAEyY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACrCh1B,IAAAA,CAAKuc,OAAAA,CAAQwkC,MAAAA,CAAO7gD,IAAAA,AAGL,CAAA,SAAb,CAAA,IAAAF,IAAAA,CAAKyc,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,KAAA,IAAA,EAAEuY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACtCh1B,IAAAA,CAAKyc,QAAAA,CAASskC,MAAAA,CAAO7gD,IAAAA,AAGJ,CAAA,SAAf,CAAA,IAAAF,IAAAA,CAAK0c,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,KAAA,IAAA,EAAEsY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACxCh1B,IAAAA,CAAK0c,UAAAA,CAAWqkC,MAAAA,CAAO7gD,IAAAA,AAGL,CAAA,SAAhB,CAAA,IAAAF,IAAAA,CAAKwc,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAEwY,MAAAA,CAAO5V,QAAAA,CAASlf,EAAK80B,MAAAA,CAAAA,KACzCh1B,IAAAA,CAAKwc,WAAAA,CAAYukC,MAAAA,CAAO7gD;yBArB1B;wBACE,MAAMsL,IAAQxL,IAAAA,CAAKyoI,KAAAA,CAAMhgI,OAAAA,CAAQvI;wBAC7BsL,IAAAA,MACFxL,IAAAA,CAAKyoI,KAAAA,CAAM//H,MAAAA,CAAO8C,GAAO;oBAG7B;;YAiBF;YAOA,MAAM84E,CAAAA,EAAAA;gBACJ,IAAIzwD,IAAU7zB,IAAAA,CAAKyoI,KAAAA;gBAqBnB,OAnBIzoI,IAAAA,CAAK0oI,UAAAA,IACH1oI,CAAAA,IAAAA,CAAKuc,OAAAA,CAAQyY,MAAAA,CAAO5V,QAAAA,CAASklE,MAC/BzwD,CAAAA,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKuc,OAAAA,CAAQizD,KAAAA,CAAM8U,GAAAA,GAE1CtkF,IAAAA,CAAKyc,QAAAA,CAASuY,MAAAA,CAAO5V,QAAAA,CAASklE,MAChCzwD,CAAAA,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKyc,QAAAA,CAAS+yD,KAAAA,CAAM8U,GAAAA,GAE3CtkF,IAAAA,CAAK0c,UAAAA,CAAWsY,MAAAA,CAAO5V,QAAAA,CAASklE,MAClCzwD,CAAAA,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAK0c,UAAAA,CAAW8yD,KAAAA,CAAM8U,GAAAA,GAE7CtkF,IAAAA,CAAKwc,WAAAA,CAAYwY,MAAAA,CAAO5V,QAAAA,CAASklE,MACnCzwD,CAAAA,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKwc,WAAAA,CAAYgzD,KAAAA,CAAM8U,GAAAA,CAAAA,GAIpDzwD,IAAUA,EAAQ7rB,MAAAA,CAAO,CAAC9H,GAAMsL,IACvBqoB,EAAQprB,OAAAA,CAAQvI,MAASsL,IAG3BqoB;YACT;YAEA,QAAArsB;gBACExH,IAAAA,CAAKyoI,KAAAA,GAAQ,EAAA,EACbzoI,IAAAA,CAAK0oI,UAAAA,GAAAA,CAAa,GAElB1oI,IAAAA,CAAKuc,OAAAA,GAAU,MACfvc,IAAAA,CAAKyc,QAAAA,GAAW,MAChBzc,IAAAA,CAAK0c,UAAAA,GAAa,MAClB1c,IAAAA,CAAKwc,WAAAA,GAAc;YACrB;YAEA,cAAAysH;gBACE,IAAIp1G,IAAU7zB,IAAAA,CAAKyoI,KAAAA;gBAanB,OAXIzoI,IAAAA,CAAK0oI,UAAAA,IACP70G,CAAAA,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKuc,OAAAA,CAAQ0sH,WAAAA,KACtCp1G,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKyc,QAAAA,CAASwsH,WAAAA,KACvCp1G,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAK0c,UAAAA,CAAWusH,WAAAA,KACzCp1G,IAAUA,EAAQxzB,MAAAA,CAAOL,IAAAA,CAAKwc,WAAAA,CAAYysH,WAAAA,GAAAA,GAG5Cp1G,IAAUA,EAAQ7rB,MAAAA,CAAO,CAAC9H,GAAMsL,IACvBqoB,EAAQprB,OAAAA,CAAQvI,MAASsL,IAG3BqoB;YACT;YAEA,eAAAq1G;gBACE,OAAKlpI,IAAAA,CAAK0oI,UAAAA,GAKR,IACApjI,KAAKC,GAAAA,CAAIvF,IAAAA,CAAKuc,OAAAA,CAAQ2sH,YAAAA,IAAgBlpI,IAAAA,CAAKyc,QAAAA,CAASysH,YAAAA,IAAgBlpI,IAAAA,CAAK0c,UAAAA,CAAWwsH,YAAAA,IAAgBlpI,IAAAA,CAAKwc,WAAAA,CAAY0sH,YAAAA,MAL9G;YAOX;YAEA,MAAM9xG,CAAAA,EAAAA;gBACJp3B,IAAAA,CAAKg1B,MAAAA,CAAOnV,IAAAA,CAAKuX,GAAKhlB,EAAM8C,MAAAA,GACxBlV,IAAAA,CAAK0oI,UAAAA,IACP1oI,CAAAA,IAAAA,CAAKuc,OAAAA,CAAQyY,MAAAA,CAAOnV,IAAAA,CAAKuX,GAAKhlB,EAAM8C,MAAAA,GACpClV,IAAAA,CAAKyc,QAAAA,CAASuY,MAAAA,CAAOnV,IAAAA,CAAKuX,GAAKhlB,EAAM8C,MAAAA,GACrClV,IAAAA,CAAK0c,UAAAA,CAAWsY,MAAAA,CAAOnV,IAAAA,CAAKuX,GAAKhlB,EAAM8C,MAAAA,GACvClV,IAAAA,CAAKwc,WAAAA,CAAYwY,MAAAA,CAAOnV,IAAAA,CAAKuX,GAAKhlB,EAAM8C,MAAAA,CAAAA;YAE5C;QAAA;QCjOK,SAASi0H,GAAe/mI,CAAAA;YAC7B,OAAA,CAAA,CAASA,EAAE+qC,WACb;QAAA;QAKO,SAASi8F,GAAQhnI,CAAAA;YACtB,OAAA,CAAA,CAASA,EAAEgxC,KACb;QAAA;QAKO,SAASi2F,GAAWjnI,CAAAA;YACzB,OAAA,CAAA,CAASA,EAAEmxC,QACb;QAAA;QASO,SAAS+1F,GAAgBlnI,CAAAA;YAC9B,OAAA,CAAA,CAASA,EAAE4mD,YACb;QAAA;QAUO,SAASugF,GAAcnnI,CAAAA;YAC5B,OAAA,CAAA,CAASA,EAAE+mD,UACb;QAAA;QASO,SAASqgF,GAAepnI,CAAAA;YAC7B,OAAA,CAAA,CAASA,EAAEgnD,WACb;QAAA;QAUO,SAASqgF,GAAernI,CAAAA;YAC7B,OAAA,CAAA,CAASA,EAAEknD,YACb;QAAA;QASO,SAASogF,GAAgBtnI,CAAAA;YAC9B,OAAA,CAAA,CAASA,EAAEknD,YACb;QAAA;QAuBO,SAASqgF,GAASvnI,CAAAA;YACvB,OAAA,CAAA,CAASA,EAAEgxC,KACb;QAAA;QAiBO,SAASw2F,GAAYxnI,CAAAA;YAC1B,OAAA,CAAA,CAASA,EAAEmxC,QACb;QAAA;QAiHO,SAASs2F,GAAWznI,CAAAA;YACzB,OAAA,CAAA,CAASA,EAAE+9C,SACb;QAAA;QAKO,SAAS2pF,GAAY1nI,CAAAA;YAC1B,OAAA,CAAA,CAASA,EAAEg+C,UACb;QAAA;QC3PO,MAAM2pF;YAyBX,YACStgH,CAAAA,EACPE,IAAAA,CAAY,CAAA,CAAA;gBADL,IAAA,CAAAF,IAAAA,GAAAA,GApBF,IAAA,CAAAtP,KAAAA,GAAgB,GAKhB,IAAA,CAAAE,MAAAA,GAAiB,GAIhB,IAAA,CAAA6sB,OAAAA,GAAyB,EAAA,EAG1B,IAAA,CAAAzlC,IAAAA,GAAsB,EAAA,EACrB,IAAA,CAAAuoI,QAAAA,GAAqB,EAAA,EAU3BhqI,IAAAA,CAAKiyB,SAAAA,GAAY,IAAIzI,GAASC,GAAM,eAAeE;YACrD;YAMA,IAAA,YAAWA;gBACT,OAAO3pB,IAAAA,CAAKiyB,SAAAA,CAAUtI,SACxB;YAAA;YAEA,IAAA,UAAqBld,CAAAA,EAAAA;gBACnBzM,IAAAA,CAAKiyB,SAAAA,CAAUtI,SAAAA,GAAYld;YAC7B;YAKO,MAAA,OAAMwd;gBACX,MAAMkzC,IAAAA,MAAoBn9D,IAAAA,CAAKiyB,SAAAA,CAAUhI,IAAAA;gBACzCjqB,IAAAA,CAAKiqI,OAAAA,GAAU,IAAIC,GAAO/sE,IAC1Bn9D,IAAAA,CAAKmqI,IAAAA,GAAO,IAAIC,GAAUpqI,IAAAA,CAAKiqI,OAAAA;gBAC/B,MAAMp9F,IAAS7sC,IAAAA,CAAKmqI,IAAAA,CAAKt9F,MAAAA,CAAO5sC,GAAAA,CAAKO,CAAAA,IAAM,IAAIgxB,GAAYhxB,EAAEoxB,GAAAA,EAAAA,CAAK;gBAOlE,OAAA,MALMrtB,QAAQ8+D,GAAAA,CAAIx2B,EAAO5sC,GAAAA,CAAKuW,CAAAA,IAAMA,EAAEyT,IAAAA,MACtCjqB,IAAAA,CAAKyB,IAAAA,GAAOzB,IAAAA,CAAKknC,OAAAA,GAAU2F,GAC3B7sC,IAAAA,CAAKgqI,QAAAA,GAAWhqI,IAAAA,CAAKknC,OAAAA,CAAQjnC,GAAAA,CAAK0sB,CAAAA,IACzBA,EAAMsG,QAAAA,KAERjzB,IAAAA,CAAKyB,IACd;YAAA;YAEO,WAAAooB;gBACL,OAAA,CAAA,CAAS7pB,IAAAA,CAAKyB,IAChB;YAAA;YAMO,SAAS7B,IAAa,CAAA,EAAA;gBAAA,IAAA;gBAC3B,OAAwB,SAAjB,CAAA,IAAAI,IAAAA,CAAKgqI,QAAAA,CAASpqI,EAAAA,AAAAA,KAAAA,KAAG,MAAA,IAAA,IAAI;YAC9B;YAKO,gBAAAyqI;gBACL,MAAMj2G,IAAoBp0B,IAAAA,CAAKgqI,QAAAA;gBAC/B,OAAI51G,EAAQ9zB,MAAAA,GACH,IAAIu1B,GAAY;oBAAEzB,SAAAA;gBAAAA,KAGpB;YACT;YAMO,YAAYmhB,CAAAA,EAAAA;gBAAAA,IAAAA;gBACjB,MAAM1I,IAAkB,SAAT,CAAA,IAAA7sC,IAAAA,CAAKmqI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEt9F,MAAAA;gBAC1B,IAAIA,QAAAA,IAAAA,KAAM,IAANA,EAAQvsC,MAAAA,EAAQ;oBAClB,MAAM2zC,IAASpH,EAAO5sC,GAAAA,CAAI,CAAC0sB,GAAOnhB;wBAAAA,IAAAA;wBAChC,OAAO;4BACL4pC,SAASp1C,IAAAA,CAAKgqI,QAAAA,CAASx+H,EAAAA;4BACvBkqC,UAAAA,AAAmB,CAAA,SAAT,CAAA,IAAA11C,IAAAA,CAAKmqI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEl2F,MAAAA,CAAOzoC,EAAAA,CAAO++H,OAAAA,AAAAA,KAAAA,KAAWzpI;wBAAAA;oBAC/C;oBAOH,OALAd,IAAAA,CAAKwqI,UAAAA,GAAa,IAAIx2F,GAAU;wBAC9BC,QAAAA;wBACAE,eAAeoB;oBAAAA,IAGVv1C,IAAAA,CAAKwqI,UACd;gBAAA;gBACA,OAAO;YACT;YAEA,IAAA,iBAAWC;gBAAAA,IAAAA,GAAAA;gBACT,OAA4B,SAArB,CAAA,IAAS,SAAT,CAAA,IAAAzqI,IAAAA,CAAKmqI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEO,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI,EAClC;YAAA;QAAA;QAsBF,MAAMC,KAAaC,CAAAA,IACVA,EAAGl2G,MAAAA,CAAO,SAAU1qB,CAAAA,EAAWhI,CAAAA;gBACpC,OAAW,IAAJgI,IAAQhI;YACjB,GAAG,IAGC6oI,KAAgBC,CAAAA;YACpB,MAAM1oI,IAAI,EAAA;YACV,IAAK,IAAI5B,IAAI,GAAGA,KAAK,GAAGA,IACtB4B,EAAEzC,IAAAA,CAAAA,CAAAA,CAAQmrI,CAAAA,IAAQ,KAAKtqI,CAAAA;YAEzB,OAAO4B;QAA6E;QAG/E,MAAM8nI;YAKX,YAAYa,CAAAA,CAAAA;gBAGV,IANF,IAAA,CAAApzH,GAAAA,GAAc,GACd,IAAA,CAAAiC,QAAAA,GAAmB,GAUZ,IAAA,CAAAoxH,QAAAA,GAAW;oBAChB,IAAIhrI,IAAAA,CAAK4Z,QAAAA,IAAY5Z,IAAAA,CAAKyB,IAAAA,CAAKwpI,UAAAA,EAC7B,MAAM,IAAI9kI,MAAM;oBAElB,OAAOnG,IAAAA,CAAKyB,IAAAA,CAAKzB,IAAAA,CAAK4Z,QAAAA,GAAW;gBAAA,GAG5B,IAAA,CAAAsxH,SAAAA,GAAalpI,CAAAA;oBAClB,MAAMmpI,IAAQ,EAAA;oBACd,IAAK,IAAI3qI,IAAI,GAAGA,IAAIwB,GAAGxB,IACrB2qI,EAAMxrI,IAAAA,CAAKK,IAAAA,CAAKgrI,QAAAA;oBAElB,OAAOG;gBAAK,GAGP,IAAA,CAAAC,IAAAA,GAAQppI,CAAAA;oBACb,IAAIgI,IAAI;oBACR,IAAK,IAAIxJ,IAAI,GAAGA,IAAIwB,GAAGxB,IACrBwJ,KAAK2K,OAAO02H,YAAAA,CAAarrI,IAAAA,CAAKgrI,QAAAA;oBAEhC,OAAOhhI;gBAAC,GAGH,IAAA,CAAAshI,YAAAA,GAAe;oBAEpB,MAAMlpI,IAAIpC,IAAAA,CAAKkrI,SAAAA,CAAU;oBACzB,OAAA,AAAQ9oI,CAAAA,CAAAA,CAAE,EAAA,IAAM,CAAA,IAAKA,CAAAA,CAAE,EAAE;gBAAA,GAjCzBpC,IAAAA,CAAKyB,IAAAA,GAAO,IAAI8pI,WAAWR,IAC3B/qI,IAAAA,CAAK2X,GAAAA,GAAM3X,IAAAA,CAAKyB,IAAAA,CAAKwpI,UAAAA,EACJ,MAAbjrI,IAAAA,CAAK2X,GAAAA,EACP,MAAM,IAAIxR,MAAM;YAEpB;QAAA;QA4IK,MAAMikI;YAYX,YAAYoB,CAAAA,CAAAA;gBAVJ,IAAA,CAAAC,QAAAA,GAAgB,CAAC,GAClB,IAAA,CAAAx3F,MAAAA,GAAqB,EAAA,EACrB,IAAA,CAAApH,MAAAA,GAA6B,EAAA,EAG7B,IAAA,CAAA6+F,qBAAAA,GAAoD,EAAA,EACpD,IAAA,CAAAhB,UAAAA,GAAuB,EAAA,EAa9B,IAAA,CAAAiB,oBAAAA,GAAwBz9F,CAAAA;oBAEtB,MAAM09F,IAAyC,EAAA;oBAC/C,IAAK,IAAIprI,IAAI,GAAGA,IAAI0tC,GAAS1tC,IAAK;wBAChC,MAAMqrI,IAAM7rI,IAAAA,CAAK8rI,GAAAA,CAAIZ,SAAAA,CAAU;wBAC/BU,EAAWjsI,IAAAA,CAAKksI;oBAClB;oBACA,OAAOD;gBAAU,GAGnB,IAAA,CAAAG,aAAAA,GAAgB;oBACd,IAAIj8H,GAAMrO;oBACVA,IAAO;oBACP,GACEqO,IAAO9P,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IAChBvpI,KAAQzB,IAAAA,CAAK8rI,GAAAA,CAAIV,IAAAA,CAAKt7H;2BACN,MAATA,GACT;oBAAA,OAAOrO;gBAAI,GAGb,IAAA,CAAAuqI,WAAAA,GAAc;oBACZ,MAAMC,IAAiB;wBACrBC,KAAK;wBACLC,KAAK;wBACLhyH,OAAO;wBACPE,QAAQ;wBACR+xH,iBAAiB;wBACjBC,sBAAsB;wBACtBC,SAAAA,CAAS;wBACTC,YAAAA,CAAY;wBACZC,kBAAkB,EAAA;wBAClBC,sBAAsB;wBACtBC,kBAAkB;oBAAA;oBAKpB,IAFAT,EAAIC,GAAAA,GAAMlsI,IAAAA,CAAK8rI,GAAAA,CAAIV,IAAAA,CAAK,IACxBa,EAAIE,GAAAA,GAAMnsI,IAAAA,CAAK8rI,GAAAA,CAAIV,IAAAA,CAAK,IACR,UAAZa,EAAIC,GAAAA,EACN,MAAM,IAAI/lI,MAAM;oBAGlB8lI,EAAI9xH,KAAAA,GAAQna,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IACrBW,EAAI5xH,MAAAA,GAASra,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IAEtBtrI,IAAAA,CAAK2sI,mBAAAA,CAAoBxyH,KAAAA,GAAQ8xH,EAAI9xH,KAAAA,EACrCna,IAAAA,CAAK2sI,mBAAAA,CAAoBtyH,MAAAA,GAAS4xH,EAAI5xH,MAAAA;oBAEtC,MAAMuyH,IAAO/B,GAAa7qI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;oBACnCiB,EAAIK,OAAAA,GAAUM,EAAKprH,KAAAA,IACnByqH,EAAIG,eAAAA,GAAkBzB,GAAUiC,EAAKlkI,MAAAA,CAAO,GAAG,KAC/CujI,EAAIM,UAAAA,GAAaK,EAAKprH,KAAAA,IACtByqH,EAAII,oBAAAA,GAAuB1B,GAAUiC,EAAKlkI,MAAAA,CAAO,GAAG,KAEpDujI,EAAIQ,oBAAAA,GAAuBzsI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IACpCiB,EAAIS,gBAAAA,GAAmB1sI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IAE5BiB,EAAIK,OAAAA,IAENtsI,CAAAA,IAAAA,CAAK0rI,qBAAAA,GAAwB1rI,IAAAA,CAAK2rI,oBAAAA,CAAqB,KAAMM,EAAII,oBAAAA,GAAuB,EAAA,GAEtFrsI,IAAAA,CAAKyrI,QAAAA,CAASQ,GAAAA,IAAOjsI,IAAAA,CAAKyrI,QAAAA,CAASQ,GAAAA,CAAIA,MACzCjsI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAASQ,GAAAA;gBACrC,GAGF,IAAA,CAAAY,QAAAA,GAAYC,CAAAA;oBACV,MAAMC,IAAcD,CAAAA;wBAClB9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;wBAE9B,MAAM4B,IAAO/B,GAAa7qI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;wBAenC,OAdA8B,EAAME,QAAAA,GAAWJ,EAAKlkI,MAAAA,CAAO,GAAG,IAChCokI,EAAMG,cAAAA,GAAiBtC,GAAUiC,EAAKlkI,MAAAA,CAAO,GAAG,KAChDokI,EAAMI,aAAAA,GAAgBN,EAAKprH,KAAAA,IAC3BsrH,EAAMK,oBAAAA,GAAuBP,EAAKprH,KAAAA,IAElCsrH,EAAMM,SAAAA,GAAYptI,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IAE3BwB,EAAMO,qBAAAA,GAAwBrtI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IAEvC8B,EAAMQ,UAAAA,GAAattI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IAExBhrI,IAAAA,CAAKyrI,QAAAA,CAAS8B,GAAAA,IAAOvtI,IAAAA,CAAKyrI,QAAAA,CAAS8B,GAAAA,CAAIT,MACzC9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAAS8B,GAAAA,GAE9BT;oBAAK,GAGRU,IAAeV,CAAAA;wBACnBA,EAAMW,OAAAA,GAAUztI,IAAAA,CAAK+rI,aAAAA,IACjB/rI,IAAAA,CAAKyrI,QAAAA,CAASiC,GAAAA,IAAO1tI,IAAAA,CAAKyrI,QAAAA,CAASiC,GAAAA,CAAIZ,MACzC9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAASiC,GAAAA;oBACrC,GAGIC,IAAcb,CAAAA;wBAClB9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,KAC9B8B,EAAMc,QAAAA,GAAW5tI,IAAAA,CAAK8rI,GAAAA,CAAIZ,SAAAA,CAAU,KACpC4B,EAAMe,MAAAA,GAAS7tI,IAAAA,CAAK+rI,aAAAA,IAChB/rI,IAAAA,CAAKyrI,QAAAA,CAASqC,GAAAA,IAAO9tI,IAAAA,CAAKyrI,QAAAA,CAASqC,GAAAA,CAAIhB,MACzC9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAASqC,GAAAA;oBACrC,GAGIC,IAAejB,CAAAA;wBACnB,MAAMkB,IAAoBlB,CAAAA;4BACxB9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,KAC9B8B,EAAMmB,OAAAA,GAAUjuI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IACzB8B,EAAMoB,UAAAA,GAAaluI,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IAC5BwB,EAAMQ,UAAAA,GAAattI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IACxBhrI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,IAAOnuI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,CAAIC,QAAAA,IAAYpuI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,CAAIC,QAAAA,CAAStB,MAChF9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA;wBACrC,GAGIE,IAAsBvB,CAAAA;4BAC1BA,EAAMwB,OAAAA,GAAUtuI,IAAAA,CAAK+rI,aAAAA,IAEjB/rI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,IAAOnuI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,CAAIrB,EAAMyB,UAAAA,CAAAA,IAAevuI,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,CAAIrB,EAAMyB,UAAAA,CAAAA,CAAYzB,MAClG9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAAS0C,GAAAA,CAAIrB,EAAMyB,UAAAA,CAAAA;wBAC/C;wBAMF,IAHAvuI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,KAC9B8B,EAAMyB,UAAAA,GAAavuI,IAAAA,CAAK8rI,GAAAA,CAAIV,IAAAA,CAAK,IACjC0B,EAAM0B,QAAAA,GAAWxuI,IAAAA,CAAK8rI,GAAAA,CAAIV,IAAAA,CAAK,IAExB,eADC0B,EAAMyB,UAAAA,EAEVP,EAAiBlB;6BAGjBuB,EAAmBvB;oBAEvB,GAGI2B,IAAmB3B,CAAAA;wBACvBA,EAAMrrI,IAAAA,GAAOzB,IAAAA,CAAK+rI,aAAAA,IACd/rI,IAAAA,CAAKyrI,QAAAA,CAASwC,OAAAA,IAAWjuI,IAAAA,CAAKyrI,QAAAA,CAASwC,OAAAA,CAAQnB,MACjD9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAASwC,OAAAA;oBACrC;oBAIF,OADAnB,EAAM4B,KAAAA,GAAQ1uI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA,IACf8B,EAAM4B,KAAAA;wBACZ,KAAK;4BACH5B,EAAM6B,OAAAA,GAAU,OAChB3uI,IAAAA,CAAK4uI,IAAAA,GAAO7B,EAAWD;4BACvB;wBACF,KAAK;4BACHA,EAAM6B,OAAAA,GAAU,OAChBnB,EAAYV;4BACZ;wBACF,KAAK;4BACHA,EAAM6B,OAAAA,GAAU,OAChBhB,EAAWb;4BACX;wBACF,KAAK;4BACHA,EAAM6B,OAAAA,GAAU,OAChBZ,EAAYjB;4BACZ;wBACF;4BACEA,EAAM6B,OAAAA,GAAU,WAChBF,EAAgB3B;oBAAAA;gBAEpB,GAGF,IAAA,CAAA+B,QAAAA,GAAYC,CAAAA;oBAAAA,IAAAA;oBA0BVA,EAAIC,OAAAA,GAAU/uI,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IACvBwD,EAAIE,MAAAA,GAAShvI,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IACtBwD,EAAI30H,KAAAA,GAAQna,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA,IACrBwD,EAAIz0H,MAAAA,GAASra,IAAAA,CAAK8rI,GAAAA,CAAIR,YAAAA;oBAEtB,MAAMsB,IAAO/B,GAAa7qI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;oBACnC8D,EAAIG,OAAAA,GAAUrC,EAAKprH,KAAAA,IACnBstH,EAAII,UAAAA,GAAatC,EAAKprH,KAAAA,IACtBstH,EAAIK,MAAAA,GAASvC,EAAKprH,KAAAA,IAClBstH,EAAI9B,QAAAA,GAAWJ,EAAKlkI,MAAAA,CAAO,GAAG,IAC9BomI,EAAIM,OAAAA,GAAUzE,GAAUiC,EAAKlkI,MAAAA,CAAO,GAAG,KAEnComI,EAAIG,OAAAA,IACNH,CAAAA,EAAIO,QAAAA,GAAWrvI,IAAAA,CAAK2rI,oBAAAA,CAAqB,KAAMmD,EAAIM,OAAAA,GAAU,EAAA,GAG/DN,EAAIQ,cAAAA,GAAiBtvI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;oBAE9B,MAAMuE,IAAUvvI,IAAAA,CAAK+rI,aAAAA;oBAErB+C,EAAIU,MAAAA,GAtVU,SAAUC,CAAAA,EAAqBhuI,CAAAA;wBAE/C,IAAIoZ,IAAM;wBAEV,MAAM60H,IAAW,SAAU5/H,CAAAA;4BACzB,IAAIk3G,IAAO;4BACX,IAAK,IAAIxmH,IAAI,GAAGA,IAAIsP,GAAMtP,IACpBiB,EAAKkuI,UAAAA,CAAW90H,KAAO,KAAM,KAAY,CAAA,IAANA,CAAAA,KACrCmsG,CAAAA,KAAQ,KAAKxmH,CAAAA,GAEfqa;4BAEF,OAAOmsG;wBACT,GAEM4oB,IAAgB,EAAA,EAEhBC,IAAY,KAAKJ,GACjBK,IAAUD,IAAY;wBAE5B,IAAIE,IAAWN,IAAc,GAEzBO,IAAc,EAAA;wBAElB,MAAMxoI,IAAQ;4BACZwoI,IAAO,EAAA,EACPD,IAAWN,IAAc;4BACzB,IAAK,IAAIjvI,IAAI,GAAGA,IAAIqvI,GAAWrvI,IAC7BwvI,CAAAA,CAAKxvI,EAAAA,GAAK;gCAACA;6BAAAA;4BAEbwvI,CAAAA,CAAKH,EAAAA,GAAa,EAAA,EAClBG,CAAAA,CAAKF,EAAAA,GAAW;wBAClB;wBAEA,IAAI9oB,IAAO,GACPipB,IAAO;wBAEX,OAGE,IAFAA,IAAOjpB,GACPA,IAAO0oB,EAASK,IACZ/oB,MAAS6oB,GAAb;4BAIA,IAAI7oB,MAAS8oB,GACX;4BAGF,IAAI9oB,IAAOgpB,EAAK1vI,MAAAA,EACV2vI,MAASJ,KACXG,EAAKrwI,IAAAA,CAAKqwI,CAAAA,CAAKC,EAAAA,CAAM5vI,MAAAA,CAAO2vI,CAAAA,CAAKhpB,EAAAA,CAAM,EAAA;iCAEpC;gCACL,IAAIA,MAASgpB,EAAK1vI,MAAAA,EAChB,MAAM,IAAI6F,MAAM;gCAElB6pI,EAAKrwI,IAAAA,CAAKqwI,CAAAA,CAAKC,EAAAA,CAAM5vI,MAAAA,CAAO2vI,CAAAA,CAAKC,EAAAA,CAAM,EAAA;4BACzC;4BACAL,EAAOjwI,IAAAA,CAAKoZ,KAAAA,CAAM62H,GAAQI,CAAAA,CAAKhpB,EAAAA,GAE3BgpB,EAAK1vI,MAAAA,KAAW,KAAKyvI,KAAYA,IAAW,MAE9CA;wBAnBF,OAFEvoI;wBA2BJ,OAAOooI;oBACT,EAiR2Bd,EAAIQ,cAAAA,EAAgBC,IAEvCT,EAAII,UAAAA,IAENJ,CAAAA,EAAIU,MAAAA,GAjDc,AAAA,CAAA,CAACA,GAAkBr1H;wBAIrC,MAAMg2H,IAAsB,IAAIpmI,MAAMylI,EAAOlvI,MAAAA,GACvCw1B,IAAO05G,EAAOlvI,MAAAA,GAAS6Z,GACvBi2H,IAAQ,CAACC,GAAeC;4BAC5B,MAAMC,IAAaf,EAAOjkI,KAAAA,CAAM+kI,IAAUn2H,GAAAA,AAAQm2H,CAAAA,IAAU,CAAA,IAAKn2H;4BACjEg2H,EAAUznI,MAAAA,CAAOqQ,KAAAA,CAAMo3H,GAAW;gCAACE,IAAQl2H;gCAAOA;6BAAAA,CAAO9Z,MAAAA,CAAOkwI;wBAAmB,GAG/EnoC,IAAU;4BAAC;4BAAG;4BAAG;4BAAG;yBAAA,EACpBooC,IAAQ;4BAAC;4BAAG;4BAAG;4BAAG;yBAAA;wBAExB,IAAIF,IAAU;wBACd,IAAK,IAAIG,IAAO,GAAGA,IAAO,GAAGA,IAC3B,IAAK,IAAIJ,IAAQjoC,CAAAA,CAAQqoC,EAAAA,EAAOJ,IAAQv6G,GAAMu6G,KAASG,CAAAA,CAAMC,EAAAA,CAC3DL,EAAMC,GAAOC,IACbA;wBAIJ,OAAOH;oBAAS,CAAA,EA2BSrB,EAAIU,MAAAA,EAAQV,EAAI30H,KAAAA,CAAAA,GAAAA,AAG9B,CAAA,SAAT,CAAA,IAAAna,IAAAA,CAAK4uI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAExB,SAAAA,AAAAA,KACb0B,CAAAA,EAAIvE,OAAAA,GAAgC,KAAtBvqI,IAAAA,CAAK4uI,IAAAA,CAAKxB,SAAAA,AAAAA,GAG1BptI,IAAAA,CAAKi0C,MAAAA,CAAOt0C,IAAAA,CAAKmvI,IACjB9uI,IAAAA,CAAK2wI,YAAAA,CAAa7B,GAAKA,EAAIG,OAAAA,GAAUH,EAAIO,QAAAA,GAAWrvI,IAAAA,CAAK0rI,qBAAAA,GACrD1rI,IAAAA,CAAKyrI,QAAAA,CAASqD,GAAAA,IAAO9uI,IAAAA,CAAKyrI,QAAAA,CAASqD,GAAAA,CAAIA,MACzC9uI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA;gBAC5B,GAGK,IAAA,CAAAmF,WAAAA,GAAc;oBACnB,MAAM9D,IAAkB;wBACtB+D,UAAU7wI,IAAAA,CAAK8rI,GAAAA,CAAId,QAAAA;wBACnBvkI,MAAM;oBAAA;oBAGR,OADkBkO,OAAO02H,YAAAA,CAAayB,EAAM+D,QAAAA;wBAE1C,KAAK;4BACH/D,EAAMrmI,IAAAA,GAAO,OACbzG,IAAAA,CAAK6sI,QAAAA,CAASC;4BACd;wBACF,KAAK;4BACHA,EAAMrmI,IAAAA,GAAO,OACbzG,IAAAA,CAAK6uI,QAAAA,CAAS/B;4BACd;wBACF,KAAK;4BACHA,EAAMrmI,IAAAA,GAAO,OACTzG,IAAAA,CAAKyrI,QAAAA,CAASqF,GAAAA,IAAO9wI,IAAAA,CAAKyrI,QAAAA,CAASqF,GAAAA,CAAIhE,MACzC9sI,IAAAA,CAAK0qI,UAAAA,CAAW/qI,IAAAA,CAAKK,IAAAA,CAAKyrI,QAAAA,CAASqF,GAAAA;4BAErC;wBACF;4BACE,MAAM,IAAI3qI,MAAM,sBAAsB2mI,EAAM+D,QAAAA,CAAS9wI,QAAAA,CAAS;oBAAA;oBAG/C,UAAf+sI,EAAMrmI,IAAAA,IACRzG,IAAAA,CAAK4wI,WAAAA;gBACP,GAGF,IAAA,CAAAD,YAAAA,GAAe,CAACI,GAAiBnF;oBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;oBAC/B,MAAMtyH,IAASC,SAASC,aAAAA,CAAc;oBACtCF,EAAOa,KAAAA,GAAQ42H,EAAM52H,KAAAA,EACrBb,EAAOe,MAAAA,GAAS02H,EAAM12H,MAAAA;oBACtB,MAAMgqB,IAAU/qB,EAAOI,UAAAA,CAAW,OAC5Bs3H,IAAY3sG,EAAQ4sG,YAAAA,CAAa,GAAG,GAAG33H,EAAOa,KAAAA,EAAOb,EAAOe,MAAAA;oBAElE,IAAIgzH,IAAAA;oBACS,CAAA,SAAT,CAAA,IAAArtI,IAAAA,CAAK4uI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEzB,oBAAAA,AAAAA,KACbE,CAAAA,IAAwBrtI,IAAAA,CAAK4uI,IAAAA,CAAKvB,qBAAAA,AAAAA;oBAGpC,IAAK,IAAI6D,IAAQ,GAAGA,IAAQH,EAAMvB,MAAAA,CAAOlvI,MAAAA,EAAQ4wI,IAAS;wBACxD,MAAMC,IAAaJ,EAAMvB,MAAAA,CAAO0B,EAAAA,EAC1Bv9H,IAAQi4H,CAAAA,CAAWuF,EAAAA;wBACrBA,MAAe9D,IACjB2D,EAAUvvI,IAAAA,CAAKupB,GAAAA,CAAI;4BAAC;4BAAG;4BAAG;4BAAG;yBAAA,EAAY,IAARkmH,KAEjCF,EAAUvvI,IAAAA,CAAKupB,GAAAA,CAAI;+BAAIrX;4BAAO;yBAAA,EAAc,IAARu9H;oBAExC;oBAOA,IANA7sG,EAAQ+sG,YAAAA,CAAaJ,GAAW,GAAG,IAMD,MAArB,CAAA,SAAT,CAAA,IAAAhxI,IAAAA,CAAK4uI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAE3B,cAAAA,AAAAA,KAAwBjtI,IAAAA,CAAK6sC,MAAAA,CAAOvsC,MAAAA,EACjDN,IAAAA,CAAKqxI,oBAAAA,CAAqB7jH,SAAAA,CAAUxtB,IAAAA,CAAK6sC,MAAAA,CAAO7sC,IAAAA,CAAK6sC,MAAAA,CAAOvsC,MAAAA,GAAS,EAAA,EAAK,GAAG;yBACxE,IAAkC,MAArB,CAAA,SAAT,CAAA,IAAAN,IAAAA,CAAK4uI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAE3B,cAAAA,AAAAA,KAAiC,CAAA,SAAT,CAAA,IAAAjtI,IAAAA,CAAKsxI,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAEhF,OAAAA,AAAAA,GAAS;wBAChE,MAAMiF,IAAK3F,CAAAA,CAAW5rI,IAAAA,CAAKsxI,IAAAA,CAAK7E,oBAAAA,CAAAA;wBAChCzsI,IAAAA,CAAKqxI,oBAAAA,CAAqBz8H,SAAAA,GAAY,CAAA,IAAA,EAAO28H,CAAAA,CAAG,EAAA,CAAA,EAAA,EAAOA,CAAAA,CAAG,EAAA,CAAA,EAAA,EAAOA,CAAAA,CAAG,EAAA,CAAA,CAAA,CAAA,EACpEvxI,IAAAA,CAAKqxI,oBAAAA,CAAqB9+E,QAAAA,CAAS,GAAG,GAAGvyD,IAAAA,CAAKsxI,IAAAA,CAAKn3H,KAAAA,EAAOna,IAAAA,CAAKsxI,IAAAA,CAAKj3H,MAAAA;oBACtE,OACEra,IAAAA,CAAKqxI,oBAAAA,CAAqBz2H,SAAAA,CAAU,GAAG,GAAG5a,IAAAA,CAAK2sI,mBAAAA,CAAoBxyH,KAAAA,EAAOna,IAAAA,CAAK2sI,mBAAAA,CAAoBtyH,MAAAA;oBAGrGra,IAAAA,CAAKqxI,oBAAAA,CAAqB7jH,SAAAA,CAAUlU,GAAQy3H,EAAMhC,OAAAA,EAASgC,EAAM/B,MAAAA,EAAQ+B,EAAM52H,KAAAA,EAAO42H,EAAM12H,MAAAA;oBAE5F,MAAMy0H,IAAM,IAAI/8G;oBAChB+8G,EAAIl9G,GAAAA,GAAM5xB,IAAAA,CAAK2sI,mBAAAA,CAAoBrjE,SAAAA,IACnCtpE,IAAAA,CAAK6sC,MAAAA,CAAOltC,IAAAA,CAAKmvI;gBAAI,GAtTrB9uI,IAAAA,CAAK8rI,GAAAA,GAAMN,GACXxrI,IAAAA,CAAKyrI,QAAAA,GAAW,CAAC,GACjBzrI,IAAAA,CAAK2sI,mBAAAA,GAAsBpzH,SAASC,aAAAA,CAAc,WAClDxZ,IAAAA,CAAKqxI,oBAAAA,GAAuBrxI,IAAAA,CAAK2sI,mBAAAA,CAAoBjzH,UAAAA,CAAW,OAChE1Z,IAAAA,CAAKgsI,WAAAA,IACLhsI,IAAAA,CAAK4wI,WAAAA;YACP;QAAA;QC1TK,MAAMY;YAOX,YAIkB/nH,CAAAA,EAIA+0B,CAAAA,EAAAA,EAChB,WAAE70B,CAAAA,EAAAA,GAAc1Q,GAAAA,GAA+B,CAAC,CAAA,CAAA;gBALhC,IAAA,CAAAwQ,IAAAA,GAAAA,GAIA,IAAA,CAAA+0B,MAAAA,GAAAA,GAbV,IAAA,CAAAizF,SAAAA,GAAAA,CAAY,GAgBlBzxI,IAAAA,CAAKiyB,SAAAA,GAAY,IAAIzI,GAASC,GAAM,QAAQE,IAC5C3pB,IAAAA,CAAKqZ,QAAAA,GAAWJ;YAClB;YAEA,MAAA,OAAMgR;gBACJ,IAAIjqB,IAAAA,CAAK6pB,QAAAA,IACP,OAAO7pB,IAAAA,CAAKyB,IAAAA;gBAGd,IAAA;oBACE,MAAM+wB,IAAAA,MAAaxyB,IAAAA,CAAKiyB,SAAAA,CAAUhI,IAAAA,IAC5BwI,IAAMC,IAAIC,eAAAA,CAAgBH;oBAE3BxyB,IAAAA,CAAKyB,IAAAA,IACRzB,CAAAA,IAAAA,CAAKyB,IAAAA,GAAO,IAAIiwI,SAAS1xI,IAAAA,CAAKw+C,MAAAA,EAAQ,CAAA,IAAA,EAAO/rB,EAAAA,CAAAA,CAAAA,GAC7ClZ,SAASo4H,KAAAA,CAAMvhI,GAAAA,CAAIpQ,IAAAA,CAAKyB,IAAAA,CAAAA,GAAAA,MAGpBzB,IAAAA,CAAKyB,IAAAA,CAAKwoB,IAAAA,IAChBjqB,IAAAA,CAAKyxI,SAAAA,GAAAA,CAAY;gBACnB,EAAE,OAAOxqI,GAAAA;oBACP,MAAM,CAAA,oCAAA,EAAuCjH,IAAAA,CAAKypB,IAAAA,CAAAA,cAAAA,EAAsBxiB,EAAgB0T,OAAAA,CAAAA,CAAAA,CAC1F;gBAAA;gBACA,OAAO3a,IAAAA,CAAKyB,IACd;YAAA;YAEA,WAAAooB;gBACE,OAAO7pB,IAAAA,CAAKyxI,SACd;YAAA;YAMA,OAAOx4H,CAAAA,EAAAA;gBACL,OAAO,IAAIslC,GAAK;oBAAEC,QAAQx+C,IAAAA,CAAKw+C,MAAAA;oBAAAA,GAAWx+C,IAAAA,CAAKqZ,QAAAA;oBAAAA,GAAaJ,CAAAA;gBAAAA;YAC9D;QAAA;QC7DF,MAAM44H,KAAyBjW,MAEzBkW,KAA+B;QAIrC,SAASC,GAAqBzlI,CAAAA;YAC5B,OAAiB,cAAA,OAANA,KAAAA,CAAAA,CAAAA,CAGPwlI,GAA6B9nH,IAAAA,CAAKgoH,SAASlvI,SAAAA,CAAU/C,QAAAA,CAASiD,IAAAA,CAAKsJ,OAAAA,CAAAA,CAGlE9J,OAAO4lD,cAAAA,IAGL5lD,OAAO4lD,cAAAA,CAAe97C,OAAO9J,OAAO4lD,cAAAA,CAAe,IAAI4pF,SAAS,6BAAb;QAC5D;QAsFO,SAASC,GAAAA,GAAav6H,CAAAA;YAAAA,IAAAA;YAC3B,MAAMkS,IAAShT,EAAOS,WAAAA;YACtB,IAAI66H,GACAC,GACAl5H,GACAm5H;YAGAL,GAAqBr6H,CAAAA,CAAK,EAAA,KAC5By6H,CAAAA,IAAUzmB,YACVwmB,IAAqBx6H,CAAAA,CAAK,EAAA,EAC1BuB,IAAUvB,CAAAA,CAAK,EAAA,AAAA,GAIbq6H,GAAqBr6H,CAAAA,CAAK,EAAA,KAC5By6H,CAAAA,IAAUz6H,CAAAA,CAAK,EAAA,EACfw6H,IAAqBx6H,CAAAA,CAAK,EAAA,EAC1BuB,IAAUvB,CAAAA,CAAK,EAAA,AAAA,GAIbA,CAAAA,CAAK,EAAA,YAAc6lH,MACrB4U,CAAAA,IAAUz6H,CAAAA,CAAK,EAAA,EACf06H,IAAe16H,CAAAA,CAAK,EAAA,EACpBw6H,IAAqBx6H,CAAAA,CAAK,EAAA,EAC1BuB,IAAUvB,CAAAA,CAAK,EAAA,AAAA,GAIbA,CAAAA,CAAK,EAAA,YAAc6lH,MACrB4U,CAAAA,IAAUzmB,YACV0mB,IAAe16H,CAAAA,CAAK,EAAA,EACpBw6H,IAAqBx6H,CAAAA,CAAK,EAAA,EAC1BuB,IAAUvB,CAAAA,CAAK,EAAA,AAAA;YAGjB,MAAM26H,IAAStW,GAAW8V,KACpBjxH,IAAW3H,QAAAA,IAAAA,KAAO,IAAPA,EAAS87G,MAAAA,EACpBud,IAAAA,CAAYD,KAAmC,CAAA,SAAlB,CAAA,IAAAp5H,QAAAA,IAAAA,KAAO,IAAPA,EAASq5H,SAAAA,AAAAA,KAAAA,KAAS,MAAA,KAAA,CAAA;YACrD,IAAIr4H;YACJ,IAAA;gBACEA,IAASm4H,QAAAA,IAAAA,IAAgB7U,GAAOC,SAAAA;YAClC,EAAE,OAAOr8F,GAAAA;gBACP,MAAMh7B,MACJ;YAGJ;YAEA,IAAIosI,IAAAA,CAAU,GACVC,IAAAA,CAAY,GACZC,IAAAA,CAAY;YAChB,MAAMC,IAAeR,EAAmBrxH,IAAAA,CAAKsxH,IACvCQ,IAAYD;YAClB,IAAI7zE;YACJ,MAAMyE,IAAW,IAAI/+D,QAAc,CAACC,GAASC;gBAC3Co6D,IAAQ/nB,CAAAA;oBACN,IAAA;wBACE,IAAI27F,GAGF,OAFAD,IAAAA,CAAY,GAAA,KACZhuI;wBAGF,MAAA,EAAM,MAAE6nC,CAAAA,EAAI,OAAEjpC,CAAAA,EAAAA,GAAUyuI,GAAuBhW,KAAAA,CAAAA,CAAM,GAAM,IAAM8W,EAAUroI,IAAAA,CAAKwsC;wBAChF,IAAIzK,KAAQomG,GAGV,OAFAD,IAAAA,CAAY,GAAA,KACZhuI;wBAIEpB,aAAiBmB,UACnBnB,EAAM+pB,IAAAA,CAAK;4BAETlT,EAAOyG,KAAAA,CAAME,QAAAA,CAASi+C,GAAM,GAAGj+C;wBAAS,KAAA,KAEvB9f,MAAVsC,KAAAA,KAAiC,MAAVA,IAEhC6W,EAAOyG,KAAAA,CAAME,QAAAA,CAASi+C,GAAM,GAAGj+C,KAG/B3G,EAAOyG,KAAAA,CAAME,QAAAA,CAASi+C,GAAMz7D,KAAS,GAAGwd;oBAE5C,EAAE,OAAOtB,GAAAA;wBAEP,OAAA,KADA7a,EAAO6a;oBAET;gBAAA,GAEEgzH,KACFC,CAAAA,IAAAA,CAAU,GACV1zE,EAAK5kD,EAAOyG,KAAAA,CAAMo2B,OAAAA,GAAAA;YACpB,IAGI87F,IAAwB;gBAC5BhxC,WAAW,IACF2wC,KAAAA,CAAYE,KAAAA,CAAcD;gBAEnC/jD,YAAY,IACH+jD;gBAET/0D,QAAQ;oBACNg1D,IAAAA,CAAY;gBAAI;gBAElBztI,OAAO,IACAutI,CAAAA,IAIH3oH,EAAOvR,IAAAA,CACL,0FACA25H,SAASlvI,SAAAA,CAAU/C,QAAAA,CAASiD,IAAAA,CAAK0vI,MALnCH,CAAAA,IAAAA,CAAU,GACV1zE,EAAK5kD,EAAOyG,KAAAA,CAAMo2B,OAAAA,GAAAA,GAOb87F,CAAAA;gBAETD,WAAAA;gBACAtmG,MAAMi3B;gBACNn2C,MAAMm2C,EAASn2C,IAAAA,CAAKtM,IAAAA,CAAKyiD;gBACzB,CAACpgE,OAAO2vI,QAAAA,CAAAA,EAAW,IAGVF;YAAAA;YAIX,OAAOC;QACT;QC1LO,MAAME,WAAmB1tF;YA0B9B,IAAA,WAAIyf;gBACF,OAAO7kE,IAAAA,CAAK+yI,gBACd;YAAA;YAEA,IAAA,WAAIzvE;gBACF,OAAuB,UAAnBtjE,IAAAA,CAAKqb,SAAAA,GACArb,IAAAA,CAAK6kE,QAAAA,IAAY,IAEjB7kE,IAAAA,CAAK6kE,QAAAA,IAAY;YAE5B;YAEA,YAAY5rD,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA,GAAAA,GAAAA;gBACV2T,KAAAA,IAtCM,IAAA,CAAAC,OAAAA,GAAkBjW,EAAOS,WAAAA,IACjC,IAAA,CAAA0F,SAAAA,GAAY,IAAI41B,IAChB,IAAA,CAAAmN,QAAAA,GAAW,IAAIP,IAMP,IAAA,CAAAyzF,eAAAA,GAAkB,IAAItsI,GAKvB,IAAA,CAAA6rI,OAAAA,GAAAA,CAAU,GACT,IAAA,CAAAU,gBAAAA,GAA2B,GAC3B,IAAA,CAAAF,gBAAAA,GAA2B,GAE5B,IAAA,CAAA1mG,IAAAA,GAAOrsC,IAAAA,CAAKgzI,eAAAA,CAAgBnsI,OAAAA,EAsBjC7G,IAAAA,CAAKyuB,IAAAA,GAAO,CAAA,WAAA,EAAczuB,IAAAA,CAAKJ,EAAAA,EAAAA,EAC/BI,IAAAA,CAAK01C,QAAAA,GAAWz8B,EAAQy8B,QAAAA,EACxB11C,IAAAA,CAAKotF,MAAAA,GAAuB,SAAd,CAAA,IAAAn0E,EAAQm0E,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIF,GAAgBI,MAAAA,EAChDttF,IAAAA,CAAKqb,SAAAA,GAA6B,SAAjB,CAAA,IAAApC,EAAQoC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,OACtCrb,IAAAA,CAAKy6H,UAAAA,GAA+B,SAAlB,CAAA,IAAAxhH,EAAQwhH,UAAAA,AAAAA,KAAAA,KAAU,MAAA,KAAA,GACpCz6H,IAAAA,CAAKq7H,UAAAA,GAA+B,SAAlB,CAAA,IAAApiH,EAAQoiH,UAAAA,AAAAA,KAAAA,KAAU,MAAA,KAAA,GACpCr7H,IAAAA,CAAK+c,SAAAA,CAAU22B,UAAAA,GAAa5E,GAAWykB,MAAAA,EACvCvzD,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAM/M,EAAOC,IAAAA,EAC5B/N,IAAAA,CAAK+c,SAAAA,CAAU8L,CAAAA,GAAIja,IAAAA,GACnB5O,IAAAA,CAAK8/C,QAAAA,CAAShuC,MAAAA,GAAShE,EAAOC,IAAAA,EAC9B/N,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK+c,SAAAA,GACvB/c,IAAAA,CAAKsmD,YAAAA,CAAatmD,IAAAA,CAAK8/C,QAAAA,GAEA,UAAnB9/C,IAAAA,CAAKqb,SAAAA,GACPrb,IAAAA,CAAK+yI,gBAAAA,GAAmB,IAExB/yI,IAAAA,CAAK+yI,gBAAAA,GAAmB;YAE5B;YASO,iBAAiB94H,CAAAA,EAAgB68B,CAAAA,EAAAA;gBAClC92C,IAAAA,CAAKsjE,QAAAA,IAITtjE,CAAAA,IAAAA,CAAKizI,gBAAAA,IAAoBvmI,EAAMoqC,IAAU92C,IAAAA,CAAK01C,QAAAA,EAAU,GAAG,IACvD11C,IAAAA,CAAKizI,gBAAAA,IAAoB,KAC3BjzI,CAAAA,IAAAA,CAAKizI,gBAAAA,GAAmB,CAAA,GAGH,UAAnBjzI,IAAAA,CAAKqb,SAAAA,GACPrb,IAAAA,CAAK+yI,gBAAAA,GAAmBrmI,EAAM1M,IAAAA,CAAKotF,MAAAA,CAAOptF,IAAAA,CAAKizI,gBAAAA,EAAkB,GAAG,GAAG,IAAI,GAAG,KAE9EjzI,IAAAA,CAAK+yI,gBAAAA,GAAmBrmI,EAAM1M,IAAAA,CAAKotF,MAAAA,CAAOptF,IAAAA,CAAKizI,gBAAAA,EAAkB,GAAG,GAAG,IAAI,GAAG,EAAA;YAElF;YAQA,MAAA,0BAAgCjtF,CAAAA,EAAAA,CAEhC;YAQA,QAAQ6e,CAAAA,EAAAA,CAER;YAQA,SAASA,CAAAA,EAAAA,CAET;YAQA,MAAMA,CAAAA,EAAAA,CAEN;YAOA,UAAAwuE,CAEA;YAKA,QAAA13H;gBACE3b,IAAAA,CAAKuyI,OAAAA,GAAAA,CAAU,GACfvyI,IAAAA,CAAKgzI,eAAAA,GAAkB,IAAItsI,GAC3B1G,IAAAA,CAAKqsC,IAAAA,GAAOrsC,IAAAA,CAAKgzI,eAAAA,CAAgBnsI,OAAAA,EACjC7G,IAAAA,CAAKizI,gBAAAA,GAAmB,GACD,UAAnBjzI,IAAAA,CAAKqb,SAAAA,GACPrb,IAAAA,CAAK+yI,gBAAAA,GAAmB,IAExB/yI,IAAAA,CAAK+yI,gBAAAA,GAAmB,GAE1B/yI,IAAAA,CAAKqzI,OAAAA;YACP;YAKA,kBAAkBp5H,CAAAA,EAAgBihH,CAAAA,EAAAA;gBAChC,MAAMrzB,IAAeqzB;gBAKrB,IAJIl7H,IAAAA,CAAKuyI,OAAAA,IACPvyI,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,8BAAA,EAAiCrY,IAAAA,CAAKyuB,IAAAA,CAAAA,yBAAAA,CAAAA,GAGtDo5E,EAAaiN,KAAAA,CAAMR,aAAAA,CAAc1C,OAAAA,CAAQ5xG,IAAAA,CAAKJ,EAAAA,GAChD,OAAOI,IAAAA,CAAKszI,GAAAA;gBAEdtzI,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GACf4tF,EAAaz3F,GAAAA,CAAIpQ,IAAAA;gBACjB,MAAMP,IAAOO,IAAAA;gBAcb,OAbAA,IAAAA,CAAKszI,GAAAA,GAAMrB,GACTh4H,GACA;oBACE,MAAA,CAAQxa,EAAK6jE,QAAAA,EAAU;wBACrB,MAAMxsB,IAAAA;wBACNr3C,EAAKyzI,gBAAAA,CAAiBzzI,EAAKkjE,OAAAA,EAAU7rB,IACrCr3C,EAAK8zI,QAAAA;oBACP;gBACF,GACA;oBACEjB,WAAAA,CAAW;gBAAA,IAGRtyI,IAAAA,CAAKszI,GACd;YAAA;YAMA,MAAA,QAAMhY;gBACAt7H,IAAAA,CAAKuyI,OAAAA,IACPvyI,CAAAA,IAAAA,CAAK2b,KAAAA,IACL3b,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,+BAAA,EAAkCrY,IAAAA,CAAKyuB,IAAAA,CAAAA,2CAAAA,CAAAA,CAAAA,GAGtDzuB,IAAAA,CAAK2iE,OAAAA,IAAY3iE,IAAAA,CAAKszI,GAAAA,IACzBtzI,CAAAA,IAAAA,CAAK2b,KAAAA,IACL3b,IAAAA,CAAK6sB,OAAAA,CAAQxU,IAAAA,CAAK,CAAA,+BAAA,EAAkCrY,IAAAA,CAAKyuB,IAAAA,CAAAA,uBAAAA,CAAAA,CAAAA,GAGvDzuB,IAAAA,CAAKszI,GAAAA,IAAAA,MACDtzI,IAAAA,CAAKszI,GAAAA,CAAItuI,KAAAA;YAEnB;YAMA,WAAAuuI;gBACOvzI,IAAAA,CAAK8oD,aAAAA,IAIL9oD,CAAAA,IAAAA,CAAKuyI,OAAAA,IACRvyI,CAAAA,IAAAA,CAAKuyI,OAAAA,GAAAA,CAAU,GACfvyI,IAAAA,CAAKmzI,OAAAA,CAAQnzI,IAAAA,CAAK6kE,QAAAA,CAAAA,GAGpB7kE,IAAAA,CAAKsxD,QAAAA,CAAStxD,IAAAA,CAAK6kE,QAAAA,GAEf7kE,IAAAA,CAAKsjE,QAAAA,IAAAA,CAAatjE,IAAAA,CAAKgzI,eAAAA,CAAgBhsI,WAAAA,IACzChH,CAAAA,IAAAA,CAAKozI,KAAAA,CAAMpzI,IAAAA,CAAK6kE,QAAAA,GAChB7kE,IAAAA,CAAKgzI,eAAAA,CAAgBxuI,OAAAA,EAAAA,CAAAA;YAEzB;QAAA;QCpQK,MAAMgvI,WAAkBV;YAG7B,YAAY75H,CAAAA,CAAAA;gBAAAA,IAAAA,GAAAA;gBACV2T,KAAAA,CAAM;oBAAA,GACD3T,CAAAA;oBACHy8B,UAA0B,SAAhB,CAAA,IAAAz8B,EAAQy8B,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI;gBAAA,IAEhC11C,IAAAA,CAAKyuB,IAAAA,GAAO,CAAA,UAAA,EAAazuB,IAAAA,CAAKJ,EAAAA,EAAAA,EAC9BI,IAAAA,CAAK2T,KAAAA,GAAqB,SAAb,CAAA,IAAAsF,EAAQtF,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIvB,EAAMyC,KACtC;YAAA;YAEO,aAAaoF,CAAAA,EAAAA;gBAClBja,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMZ,EAAOjG,MAAAA,CAAO8lD,UAAAA,CAAWv9C,OAAAA,EAC9Cvc,IAAAA,CAAKyzI,WAAAA,GAAc,IAAI3mD,GAAU;oBAC/B3yE,OAAOF,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA;oBAChCE,QAAQJ,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA;oBACjC1G,OAAO3T,IAAAA,CAAK2T,KAAAA;gBAAAA,IAEd3T,IAAAA,CAAK8/C,QAAAA,CAAS1vC,GAAAA,CAAIpQ,IAAAA,CAAKyzI,WAAAA,GACvBzzI,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK6kE,QAC/B;YAAA;YAES,UAAAwuE;gBACPrzI,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK6kE,QAC/B;YAAA;YAES,QAAQA,CAAAA,EAAAA;gBACf7kE,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUi8C;YAC1B;YAES,MAAMA,CAAAA,EAAAA;gBACb7kE,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUi8C;YAC1B;YAES,SAASA,CAAAA,EAAAA;gBAChB7kE,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUi8C;YAC1B;QAAA;QChCK,MAAM6uE,WAAkBZ;YAI7B,YAAY75H,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM;oBAAEvR,WAAW;oBAAA,GAASpC,CAAAA;gBAAAA,IAC5BjZ,IAAAA,CAAKyuB,IAAAA,GAAO,CAAA,UAAA,EAAazuB,IAAAA,CAAKJ,EAAAA,EAChC;YAAA;YAES,MAAA,0BAAgComD,CAAAA,EAAAA;gBACvChmD,IAAAA,CAAK2sB,KAAAA,GAAAA,MAAcq5B,EAAM/rC,MAAAA,CAAOmoH,UAAAA,CAAAA,CAAW,IAAA,MAGrCpiI,IAAAA,CAAK2sB,KAAAA,CAAMk7C,MAAAA;YACnB;YAES,aAAa5tD,CAAAA,EAAAA;gBACpBja,IAAAA,CAAKia,MAAAA,GAASA,GACdja,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAMZ,EAAOjG,MAAAA,CAAO8lD,UAAAA,CAAWv9C,OAAAA,EAC9Cvc,IAAAA,CAAKyzI,WAAAA,GAAcjiH,GAAYW,oBAAAA,CAAqBnyB,IAAAA,CAAK2sB,KAAAA,EAAOsG,QAAAA,IAChEjzB,IAAAA,CAAK8/C,QAAAA,CAAS1vC,GAAAA,CAAIpQ,IAAAA,CAAKyzI,WAAAA,GAGvBzzI,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,GAAQvB,EAAI,IAAIuL,EAAOjG,MAAAA,CAAOugD,UAAAA,EAAY,IAAIt6C,EAAOjG,MAAAA,CAAOugD,UAAAA,GAC3Ev0D,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK6kE,QAC/B;YAAA;YAES,QAAQ8uE,CAAAA,EAAAA;gBACf3zI,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK6kE,QAC/B;YAAA;YAES,UAAAwuE;gBACPrzI,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAU5oB,IAAAA,CAAK6kE,QAC/B;YAAA;YAES,MAAMA,CAAAA,EAAAA;gBACb7kE,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUi8C;YAC1B;YAES,SAASA,CAAAA,EAAAA;gBAChB7kE,IAAAA,CAAK8/C,QAAAA,CAASl3B,OAAAA,GAAUi8C;YAC1B;QAAA;QC3BK,MAAM+uE,WAAcd;YAMzB,YAAY75H,CAAAA,CAAAA;gBAAAA,IAAAA;gBACV2T,KAAAA,CAAM;oBAAEvR,WAAW;oBAAA,GAASpC,CAAAA;gBAAAA,IAJtB,IAAA,CAAA23E,OAAAA,GAAU1D,GAAgBI,MAAAA,EAKhCttF,IAAAA,CAAKyuB,IAAAA,GAAO,CAAA,MAAA,EAASzuB,IAAAA,CAAKJ,EAAAA,EAAAA,EAC1BI,IAAAA,CAAK6zI,cAAAA,GAAiB56H,EAAQ46H,cAAAA,EAC9B7zI,IAAAA,CAAK+c,SAAAA,CAAU22B,UAAAA,GAAa5E,GAAWqE,KAAAA,EACvCnzC,IAAAA,CAAK8/C,QAAAA,CAASG,aAAAA,GAAAA,CAAgB,GAC9BjgD,IAAAA,CAAK4wF,OAAAA,GAAgC,SAAtB,CAAA,IAAA33E,EAAQ66H,cAAAA,AAAAA,KAAAA,KAAc,MAAA,IAAA,IAAI9zI,IAAAA,CAAK4wF,OAAAA,EAC9C5wF,IAAAA,CAAK+zI,aAAAA,GAAgB7mD,GAAgBG,0BAAAA,CAA2BrtF,IAAAA,CAAK4wF,OAAAA;YACvE;YAES,MAAA,0BAAgC5qC,CAAAA,EAAAA;gBACvChmD,IAAAA,CAAKqlE,MAAAA,GAAAA,MAAerf,EAAM/rC,MAAAA,CAAOmoH,UAAAA,CAAAA,CAAW,IAAA,MAGtCpiI,IAAAA,CAAKqlE,MAAAA,CAAOwC,MAAAA,IAClB7nE,IAAAA,CAAKg0I,YAAAA,GAAexiH,GAAYW,oBAAAA,CAAqBnyB,IAAAA,CAAKqlE,MAAAA,EAAQpyC,QAAAA;YACpE;YAMS,aAAahZ,CAAAA,EAAAA;gBAEpB,OADAja,IAAAA,CAAK2iE,OAAAA,GAAU1oD,GACPja,IAAAA,CAAK6zI,cAAAA;oBACX,KAAK;wBACH7zI,IAAAA,CAAKi0I,gBAAAA,GAAmBvlI,EAAI,GAAA,CAAIuL,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA;wBACzD;oBAEF,KAAK;wBACHra,IAAAA,CAAKi0I,gBAAAA,GAAmBvlI,EAAI,GAAGuL,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWC,MAAAA;wBACxD;oBAEF,KAAK;wBACHra,IAAAA,CAAKi0I,gBAAAA,GAAmBvlI,EAAAA,CAAKuL,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EAAO;wBAC7D;oBAEF,KAAK;wBACHna,IAAAA,CAAKi0I,gBAAAA,GAAmBvlI,EAAIuL,EAAOjG,MAAAA,CAAOoG,UAAAA,CAAWD,KAAAA,EAAO;gBAAA;gBAKhEna,IAAAA,CAAK62D,OAAAA,GAAU72D,IAAAA,CAAK2iE,OAAAA,CAAQklC,YAAAA,CAAajxC,MAAAA,EACzC52D,IAAAA,CAAKk0I,0BAAAA,GAA6Bl0I,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,CAAI5I,KAAAA,IAGnDjS,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,GAAM7a,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,CAAIzK,GAAAA,CAAIpQ,IAAAA,CAAKi0I,gBAAAA,GAC7Cj0I,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,GAAM7a,IAAAA,CAAK+c,SAAAA,CAAUlC,GAAAA,CAAIzK,GAAAA,CAAIpQ,IAAAA,CAAKi0I,gBAAAA,GAEjDj0I,IAAAA,CAAKm0I,oBAAAA,GAAuBn0I,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,CAAI5I,KAAAA,IAE7CjS,IAAAA,CAAK8/C,QAAAA,CAASvoB,GAAAA,CAAIv3B,IAAAA,CAAKg0I,YAAAA,GAGvBh0I,IAAAA,CAAK+c,SAAAA,CAAU9M,KAAAA,GAAQvB,EAAI,IAAIuL,EAAOjG,MAAAA,CAAOugD,UAAAA,EAAY,IAAIt6C,EAAOjG,MAAAA,CAAOugD,UAAAA;YAC7E;YAES,SAASsQ,CAAAA,EAAAA;gBAEhB7kE,IAAAA,CAAK62D,OAAAA,CAAQh8C,GAAAA,GAAM7a,IAAAA,CAAK+zI,aAAAA,CAAclvE,GAAU7kE,IAAAA,CAAKk0I,0BAAAA,EAA4Bl0I,IAAAA,CAAKm0I,oBAAAA,EAAsB;YAC9G;QAAA;QCpFK,MAAM5nB,WAAaphG;YAMxB,YAAYlS,CAAAA,CAAAA;gBACV2T,KAAAA,IAJF,IAAA,CAAAjZ,KAAAA,GAAevB,EAAMyC,KAAAA,EACrB,IAAA,CAAAo2B,SAAAA,GAAoB;gBAIlB,MAAA,EAAM,OAAEjmC,CAAAA,EAAK,KAAEu/B,CAAAA,EAAG,OAAE5wB,CAAAA,EAAK,WAAEs3B,CAAAA,EAAAA,GAAchyB;gBACzCjZ,IAAAA,CAAKgF,KAAAA,GAAQA,GACbhF,IAAAA,CAAKukC,GAAAA,GAAMA,GACXvkC,IAAAA,CAAK2T,KAAAA,GAAQA,QAAAA,IAAAA,IAAS3T,IAAAA,CAAK2T,KAAAA,EAC3B3T,IAAAA,CAAKirC,SAAAA,GAAYA,QAAAA,IAAAA,IAAajrC,IAAAA,CAAKirC,SAAAA,EACnCjrC,IAAAA,CAAKihD,YAAAA,GAAejhD,IAAAA,CAAKo0I,gBAAAA;gBACzB,MAAA,EAAM,OAAEj6H,CAAAA,EAAK,QAAEE,CAAAA,EAAAA,GAAWra,IAAAA,CAAKihD,YAAAA;gBAE/BjhD,IAAAA,CAAKma,KAAAA,GAAQA,GACbna,IAAAA,CAAKqa,MAAAA,GAASA;YAChB;YAEA,IAAA,cAAW6R;gBACT,OAAOlsB,IAAAA,CAAKihD,YACd;YAAA;YAEQ,mBAAAmzF;gBACN,MAAMC,IAAar0I,IAAAA,CAAKukC,GAAAA,CAAIh0B,GAAAA,CAAIvQ,IAAAA,CAAKgF,KAAAA,EAAO+L,MAAAA,IAEtCujI,IAAgBt0I,IAAAA,CAAKirC,SAAAA,GAAY,GAEjClvB,IAAS;oBACb/b,IAAAA,CAAKgF,KAAAA,CAAMoL,GAAAA,CAAIikI,EAAWpkI,KAAAA,CAAMqkI;oBAChCt0I,IAAAA,CAAKukC,GAAAA,CAAIn0B,GAAAA,CAAIikI,EAAWpkI,KAAAA,CAAMqkI;oBAC9Bt0I,IAAAA,CAAKukC,GAAAA,CAAIn0B,GAAAA,CAAIikI,EAAWpkI,KAAAA,CAAAA,CAAOqkI;oBAC/Bt0I,IAAAA,CAAKgF,KAAAA,CAAMoL,GAAAA,CAAIikI,EAAWpkI,KAAAA,CAAAA,CAAOqkI;iBAAAA;gBAGnC,OAAOh5H,EAAYQ,UAAAA,CAAWC;YAChC;YAEU,WAAWqb,CAAAA,EAA+B3pB,CAAAA,EAAYyB,CAAAA,EAAAA;gBAC9DkoB,EAAI2T,QAAAA,CAAS/qC,IAAAA,CAAKgF,KAAAA,EAAOhF,IAAAA,CAAKukC,GAAAA,EAAKvkC,IAAAA,CAAK2T,KAAAA,EAAO3T,IAAAA,CAAKirC,SAAAA;YACtD;YAEA,QAAAh5B;gBACE,OAAO,IAAIs6G,GAAK;oBACdvnH,OAAOhF,IAAAA,CAAKgF,KAAAA;oBACZu/B,KAAKvkC,IAAAA,CAAKukC,GAAAA;oBACV5wB,OAAO3T,IAAAA,CAAK2T,KAAAA;oBACZs3B,WAAWjrC,IAAAA,CAAKirC,SAAAA;gBAAAA;YAEpB;QAAA;QCjDK,MAAM66C,WAAgBvuC;YAE3B,IAAA,SAAWx7B;gBACT,OAAO/b,IAAAA,CAAK0b,OACd;YAAA;YACA,IAAA,OAAkBK,CAAAA,EAAAA;gBAChB/b,IAAAA,CAAK0b,OAAAA,GAAUK;gBACf,MAAMvR,IAAMxK,IAAAA,CAAKu0I,QAAAA;gBACjBv0I,IAAAA,CAAKma,KAAAA,GAAQna,IAAAA,CAAK0b,OAAAA,CAAQgZ,MAAAA,CAAO,CAACnvB,GAAK+Q,IAAMhR,KAAKC,GAAAA,CAAI+Q,EAAEhK,CAAAA,EAAG/G,IAAM,KAAKiF,EAAI8B,CAAAA,EAC1EtM,IAAAA,CAAKqa,MAAAA,GAASra,IAAAA,CAAK0b,OAAAA,CAAQgZ,MAAAA,CAAO,CAACnvB,GAAK+Q,IAAMhR,KAAKC,GAAAA,CAAI+Q,EAAElM,CAAAA,EAAG7E,IAAM,KAAKiF,EAAIJ,CAAAA,EAC3EpK,IAAAA,CAAKgwC,SAAAA;YACP;YAEA,IAAA,WAAWukG;gBAGT,OAAO7lI,EAFM1O,IAAAA,CAAK0b,OAAAA,CAAQgZ,MAAAA,CAAO,CAAClqB,GAAK8L,IAAMhR,KAAKkF,GAAAA,CAAI8L,EAAEhK,CAAAA,EAAG9B,IAAMoE,IAAAA,IACpD5O,IAAAA,CAAK0b,OAAAA,CAAQgZ,MAAAA,CAAO,CAAClqB,GAAK8L,IAAMhR,KAAKkF,GAAAA,CAAI8L,EAAElM,CAAAA,EAAGI,IAAMoE,IAAAA;YAEnE;YAEA,YAAYqK,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM3T,IAnBA,IAAA,CAAAyC,OAAAA,GAAoB,EAAA,EAoB1B1b,IAAAA,CAAK+b,MAAAA,GAAS9C,EAAQ8C,MAAAA,EACtB/b,IAAAA,CAAKsvB,SAAAA,GAAY7B,GAAeI,OAAAA,EAChC7tB,IAAAA,CAAK84C,SAAAA;YACP;YAEO,QAAA7mC;gBACL,OAAO,IAAI6zE,GAAQ;oBACjB/pE,QAAQ/b,IAAAA,CAAK+b,MAAAA,CAAO9b,GAAAA,CAAKqW,CAAAA,IAAMA,EAAErE,KAAAA;oBAAAA,GAC9BjS,IAAAA,CAAKisB,mBAAAA,EAAAA;oBAAAA,GACLjsB,IAAAA,CAAKu4C,kBAAAA,EAAAA;gBAAAA;YAEZ;YAEA,QAAQnhB,CAAAA,EAAAA;gBACN,IAAIp3B,IAAAA,CAAK+b,MAAAA,IAAU/b,IAAAA,CAAK+b,MAAAA,CAAOzb,MAAAA,EAAQ;oBACrC82B,EAAI4iB,SAAAA;oBAEJ,MAAMxvC,IAAMxK,IAAAA,CAAKu0I,QAAAA,CAASvjI,MAAAA,IACpBozE,IAAapkF,IAAAA,CAAK+b,MAAAA,CAAO,EAAA,CAAG3L,GAAAA,CAAI5F;oBACtC4sB,EAAI6iB,MAAAA,CAAOmqC,EAAW93E,CAAAA,EAAG83E,EAAWh6E,CAAAA,GACpCpK,IAAAA,CAAK+b,MAAAA,CAAOoiC,OAAAA,CAASvhC,CAAAA;wBACnBwa,EAAI8iB,MAAAA,CAAOt9B,EAAMtQ,CAAAA,GAAI9B,EAAI8B,CAAAA,EAAGsQ,EAAMxS,CAAAA,GAAII,EAAIJ,CAAAA;oBAAE,IAE9CgtB,EAAI8iB,MAAAA,CAAOkqC,EAAW93E,CAAAA,EAAG83E,EAAWh6E,CAAAA,GACpCgtB,EAAI+iB,SAAAA,IACAn6C,IAAAA,CAAK2T,KAAAA,IACPyjB,EAAIkjB,IAAAA,IAEFt6C,IAAAA,CAAK83C,WAAAA,IACP1gB,EAAImU,MAAAA;gBAER;YACF;QAAA;QCzDF,IAAYipG;QAAAA,CAAZ,SAAYA,CAAAA;YAIV,EAAA,OAAA,GAAA,WAIA,EAAA,IAAA,GAAA,QAIA,EAAA,OAAA,GAAA;QACD,EAbWA,MAAAA,CAAAA,KAAgB,CAAA,CAAA;QAyErB,MAAMC,WAAkBtpH;YAgB7B,YAAY+/D,CAAAA,CAAAA;gBACVt+D,KAAAA,CAAMs+D,IAJA,IAAA,CAAAr+D,OAAAA,GAAUjW,EAAOS,WAAAA,IAKvBrX,IAAAA,CAAKutE,OAAAA,GAAU2d,GACflrF,IAAAA,CAAK00I,UAAAA,GAAaxpD,EAAO3pE,MAAAA,EAEzBvhB,IAAAA,CAAK20I,QAAAA,GAAWp7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAK40I,QAAAA,GAAWr7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAK60I,QAAAA,GAAWt7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAK80I,QAAAA,GAAWv7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAK+0I,QAAAA,GAAWx7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAKg1I,QAAAA,GAAWz7H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAKi1I,QAAAA,GAAW17H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAKk1I,QAAAA,GAAW37H,SAASC,aAAAA,CAAc,WACvCxZ,IAAAA,CAAKm1I,QAAAA,GAAW57H,SAASC,aAAAA,CAAc,WAEvCxZ,IAAAA,CAAKmtC,WAAAA,IAELntC,IAAAA,CAAK00I,UAAAA,CAAWxnH,KAAAA,CAAMC,IAAAA,CAAK;oBACzBntB,IAAAA,CAAKmtC,WAAAA;gBAAa;YAEtB;YAOA,eAAe/f,CAAAA,EAAkBioH,IAAAA,CAAgB,CAAA,EAAA;gBAC/Cr1I,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQiT,GACjBioH,KACFr1I,IAAAA,CAAKmtC,WAAAA;YAET;YAOA,gBAAgB9f,CAAAA,EAAmBgoH,IAAAA,CAAgB,CAAA,EAAA;gBACjDr1I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASgT,GAClBgoH,KACFr1I,IAAAA,CAAKmtC,WAAAA;YAET;YAKA,WAAW3yB,CAAAA,EAAcC,CAAAA,EAAae,CAAAA,EAAeC,CAAAA,EAAgB45H,IAAAA,CAAgB,CAAA,EAAA;gBACnFr1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaj7H,GACvCxa,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAAYj7H,GACtCza,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,GAAcn6H,GACxCxb,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAAen6H,GACrC45H,KACFr1I,IAAAA,CAAKmtC,WAAAA;YAET;YAMA,WAAW1mC,CAAAA,EAA0C4kG,CAAAA,EAA2BgqC,IAAAA,CAAgB,CAAA,EAAA;gBACjF,iBAAT5uI,IACFzG,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,GAAoB1qC,IACjC,CAAA,eAAT5kG,KAGTzG,CAAAA,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,GAAoB1qC,CAAAA,GAFnDrrG,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,GAAkB3qC,CAAAA,GAK/CgqC,KACFr1I,IAAAA,CAAKmtC,WAAAA;YAET;YAKA,YAAA8oG;gBACE,OAAOj2I,IAAAA,CAAKutE,OACd;YAAA;YAiBU,UACRlpC,CAAAA,EACA8xG,CAAAA,EACAC,CAAAA,EACAL,CAAAA,EACAC,CAAAA,EACAK,CAAAA,EACAC,CAAAA,EAAAA;gBAEA,MAAMC,IAAcF,KAAe,GAC7BG,IAAcF,KAAgB;gBACpC,IAAIG,GAAmBC,GAAuBC,GAAmBC;gBACjE,MAAMC,IAAY72I,IAAAA,CAAK82I,iBAAAA,CAAkBX,EAAah8H,KAAAA,EAAOi8H,EAAgB9pI,CAAAA,EAAGypI,IAC1EgB,IAAY/2I,IAAAA,CAAK82I,iBAAAA,CAAkBX,EAAa97H,MAAAA,EAAQ+7H,EAAgBhsI,CAAAA,EAAG4rI;gBAEjF,IAAK,IAAIx1I,IAAI,GAAGA,IAAIq2I,GAAWr2I,IAC7B,IAAK,IAAIkxE,IAAI,GAAGA,IAAIqlE,GAAWrlE,IAAK;oBAClC,IAAA,EAAI,UAAEslE,CAAAA,EAAQ,cAAEC,CAAAA,EAAAA,GAAiBj3I,IAAAA,CAAKk3I,gBAAAA,CACpC12I,GACAq2I,GACAV,EAAah8H,KAAAA,EACbi8H,EAAgB9pI,CAAAA,EAChBtM,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA;oBAEjCU,IAAYO,GACZN,IAAgBO,GAAAA,CAAAA,EAEbD,UAAAA,CAAAA,EAAUC,cAAAA,CAAAA,EAAAA,GAAiBj3I,IAAAA,CAAKk3I,gBAAAA,CACjCxlE,GACAqlE,GACAZ,EAAa97H,MAAAA,EACb+7H,EAAgBhsI,CAAAA,EAChBpK,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,CAAAA,GAEjCW,IAAYK,GACZJ,IAAgBK,GAEhB5yG,EAAQ7W,SAAAA,CACN2oH,GACA,GACA,GACAA,EAAah8H,KAAAA,EACbg8H,EAAa97H,MAAAA,EACbk8H,IAAcG,GACdF,IAAcI,GACdH,GACAE;gBAEJ;YAEJ;YAKU,WAAW72H,CAAAA,EAA8BxT,CAAAA,EAAWlC,CAAAA,EAAAA;gBACxDpK,IAAAA,CAAK00I,UAAAA,CAAW7qH,QAAAA,KAGlB7pB,CAAAA,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAK20I,QAAAA,EAEL,IAAI7mI,EAAO9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAAYz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAC3E11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,GAIjCh2I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAK40I,QAAAA,EAEL,IAAI9mI,EACF9N,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACtF31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAE5B11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAC/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAC1B,IAKFz1I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAK60I,QAAAA,EAEL,IAAI/mI,EAAO9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAAa31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAC5E11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAE/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAC/C,IAKF31I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAK80I,QAAAA,EACL,IAAIhnI,EACF9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAE1Bz1I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAAe51I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAE3F11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAC/B,GACAh2I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAIxB11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBqB,UAAAA,IACjCn3I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAK+0I,QAAAA,EACL,IAAIjnI,EACF9N,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAEtF31I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAAe51I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAE3F11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAC/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAC1Bz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAI9B11I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAKg1I,QAAAA,EAEL,IAAIlnI,EACF9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAE1B31I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAAe51I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAE3F11I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAE/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAC/C31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAI5B11I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAKi1I,QAAAA,EACL,IAAInnI,EAAO9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAAYz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAC3E51I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAC/B,GAEAh2I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAIlD51I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAKk1I,QAAAA,EAEL,IAAIpnI,EACF9N,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACtF31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAE5B51I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAC/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAE1Bz1I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAIlD51I,IAAAA,CAAKk2I,SAAAA,CACHp2H,GACA9f,IAAAA,CAAKm1I,QAAAA,EACL,IAAIrnI,EAAO9N,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAAa31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,GAC5E51I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBC,iBAAAA,EAC/B/1I,IAAAA,CAAKutE,OAAAA,CAAQuoE,iBAAAA,CAAkBE,eAAAA,EAE/Bh2I,IAAAA,CAAKutE,OAAAA,CAAQpzD,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAE/C31I,IAAAA,CAAKutE,OAAAA,CAAQlzD,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,CAAAA,IAGlD51I,IAAAA,CAAK6sB,OAAAA,CAAQtU,QAAAA,CACX,CAAA,sBAAA,EAAyBvY,IAAAA,CAAK00I,UAAAA,CAAWjrH,IAAAA,CAAAA,yJAAAA,CAAAA;YAK/C;YAKU,cAAA0jB;gBACRntC,IAAAA,CAAKo3I,aAAAA,GAAgBp3I,IAAAA,CAAK00I,UAAAA,CAAW/nH,KAAAA,EAGrC3sB,IAAAA,CAAK20I,QAAAA,CAASx6H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAChDz1I,IAAAA,CAAK20I,QAAAA,CAASt6H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA;gBACjD,MAAM2B,IAAOr3I,IAAAA,CAAK20I,QAAAA,CAASj7H,UAAAA,CAAW;gBAEtC29H,QAAAA,KAAAA,EAAM7pH,SAAAA,CAAUxtB,IAAAA,CAAKo3I,aAAAA,EAAe,GAAG,GAAGp3I,IAAAA,CAAK20I,QAAAA,CAASx6H,KAAAA,EAAOna,IAAAA,CAAK20I,QAAAA,CAASt6H,MAAAA,EAAQ,GAAG,GAAGra,IAAAA,CAAK20I,QAAAA,CAASx6H,KAAAA,EAAOna,IAAAA,CAAK20I,QAAAA,CAASt6H,MAAAA,GAI9Hra,IAAAA,CAAK40I,QAAAA,CAASz6H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAar7H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACzH31I,IAAAA,CAAK40I,QAAAA,CAASv6H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA;gBAEjD,MAAM4B,IAAOt3I,IAAAA,CAAK40I,QAAAA,CAASl7H,UAAAA,CAAW;gBACtC49H,QAAAA,KAAAA,EAAM9pH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACLp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAC1B,GACAz1I,IAAAA,CAAK40I,QAAAA,CAASz6H,KAAAA,EACdna,IAAAA,CAAK40I,QAAAA,CAASv6H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAK40I,QAAAA,CAASz6H,KAAAA,EACdna,IAAAA,CAAK40I,QAAAA,CAASv6H,MAAAA,GAIhBra,IAAAA,CAAK60I,QAAAA,CAAS16H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAChD31I,IAAAA,CAAK60I,QAAAA,CAASx6H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA;gBACjD,MAAM6B,IAAOv3I,IAAAA,CAAK60I,QAAAA,CAASn7H,UAAAA,CAAW;gBACtC69H,QAAAA,KAAAA,EAAM/pH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACLp3I,IAAAA,CAAKo3I,aAAAA,CAAcj9H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACrD,GACA31I,IAAAA,CAAK60I,QAAAA,CAAS16H,KAAAA,EACdna,IAAAA,CAAK60I,QAAAA,CAASx6H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAK60I,QAAAA,CAAS16H,KAAAA,EACdna,IAAAA,CAAK60I,QAAAA,CAASx6H,MAAAA,GAIhBra,IAAAA,CAAK80I,QAAAA,CAAS36H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAChDz1I,IAAAA,CAAK80I,QAAAA,CAASz6H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAAY11I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBAC1H,MAAM4B,IAAOx3I,IAAAA,CAAK80I,QAAAA,CAASp7H,UAAAA,CAAW;gBACtC89H,QAAAA,KAAAA,EAAMhqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACL,GACAp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,EAC1B11I,IAAAA,CAAK80I,QAAAA,CAAS36H,KAAAA,EACdna,IAAAA,CAAK80I,QAAAA,CAASz6H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAK80I,QAAAA,CAAS36H,KAAAA,EACdna,IAAAA,CAAK80I,QAAAA,CAASz6H,MAAAA,GAIhBra,IAAAA,CAAK+0I,QAAAA,CAAS56H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAar7H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACzH31I,IAAAA,CAAK+0I,QAAAA,CAAS16H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAAY11I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBAC1H,MAAM6B,IAAOz3I,IAAAA,CAAK+0I,QAAAA,CAASr7H,UAAAA,CAAW;gBACtC+9H,QAAAA,KAAAA,EAAMjqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACLp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAC1Bz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,EAC1B11I,IAAAA,CAAK+0I,QAAAA,CAAS56H,KAAAA,EACdna,IAAAA,CAAK+0I,QAAAA,CAAS16H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAK+0I,QAAAA,CAAS56H,KAAAA,EACdna,IAAAA,CAAK+0I,QAAAA,CAAS16H,MAAAA,GAIhBra,IAAAA,CAAKg1I,QAAAA,CAAS76H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAChD31I,IAAAA,CAAKg1I,QAAAA,CAAS36H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,GAAY11I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBAC1H,MAAM8B,IAAO13I,IAAAA,CAAKg1I,QAAAA,CAASt7H,UAAAA,CAAW;gBACtCg+H,QAAAA,KAAAA,EAAMlqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EAELp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAar7H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAC5D31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaE,SAAAA,EAC1B11I,IAAAA,CAAKg1I,QAAAA,CAAS76H,KAAAA,EACdna,IAAAA,CAAKg1I,QAAAA,CAAS36H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAKg1I,QAAAA,CAAS76H,KAAAA,EACdna,IAAAA,CAAKg1I,QAAAA,CAAS36H,MAAAA,GAIhBra,IAAAA,CAAKi1I,QAAAA,CAAS96H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAChDz1I,IAAAA,CAAKi1I,QAAAA,CAAS56H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBACjD,MAAM+B,IAAO33I,IAAAA,CAAKi1I,QAAAA,CAASv7H,UAAAA,CAAW;gBACtCi+H,QAAAA,KAAAA,EAAMnqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACL,GACAp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,EAC7D51I,IAAAA,CAAKi1I,QAAAA,CAAS96H,KAAAA,EACdna,IAAAA,CAAKi1I,QAAAA,CAAS56H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAKi1I,QAAAA,CAAS96H,KAAAA,EACdna,IAAAA,CAAKi1I,QAAAA,CAAS56H,MAAAA,GAIhBra,IAAAA,CAAKk1I,QAAAA,CAAS/6H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAar7H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,GAAaz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACzH31I,IAAAA,CAAKk1I,QAAAA,CAAS76H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBACjD,MAAMgC,IAAO53I,IAAAA,CAAKk1I,QAAAA,CAASx7H,UAAAA,CAAW;gBACtCk+H,QAAAA,KAAAA,EAAMpqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACLp3I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaC,UAAAA,EAC1Bz1I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,EAC7D51I,IAAAA,CAAKk1I,QAAAA,CAAS/6H,KAAAA,EACdna,IAAAA,CAAKk1I,QAAAA,CAAS76H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAKk1I,QAAAA,CAAS/6H,KAAAA,EACdna,IAAAA,CAAKk1I,QAAAA,CAAS76H,MAAAA,GAIhBra,IAAAA,CAAKm1I,QAAAA,CAASh7H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EAChD31I,IAAAA,CAAKm1I,QAAAA,CAAS96H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA;gBACjD,MAAMiC,IAAO73I,IAAAA,CAAKm1I,QAAAA,CAASz7H,UAAAA,CAAW;gBACtCm+H,QAAAA,KAAAA,EAAMrqH,SAAAA,CACJxtB,IAAAA,CAAKo3I,aAAAA,EACLp3I,IAAAA,CAAKo3I,aAAAA,CAAcj9H,KAAAA,GAAQna,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaG,WAAAA,EACrD31I,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAan7H,MAAAA,GAASra,IAAAA,CAAKutE,OAAAA,CAAQioE,YAAAA,CAAaI,YAAAA,EAC7D51I,IAAAA,CAAKm1I,QAAAA,CAASh7H,KAAAA,EACdna,IAAAA,CAAKm1I,QAAAA,CAAS96H,MAAAA,EACd,GACA,GACAra,IAAAA,CAAKm1I,QAAAA,CAASh7H,KAAAA,EACdna,IAAAA,CAAKm1I,QAAAA,CAAS96H,MAAAA;YAElB;YAMA,QAAApI;gBACE,OAAO,IAAIwiI,GAAUz0I,IAAAA,CAAKutE,OAAAA;YAC5B;YAKU,kBAAkBuqE,CAAAA,EAAkB1B,CAAAA,EAAyBliG,CAAAA,EAAAA;gBACrE,OAAQA;oBACN,KAAKsgG,GAAiBuD,OAAAA;wBACpB,OAAO;oBACT,KAAKvD,GAAiB9tC,IAAAA;oBAEtB,KAAK8tC,GAAiBwD,OAAAA;wBACpB,OAAO1yI,KAAKiH,IAAAA,CAAK6pI,IAAkB0B;gBAAAA;YAEzC;YAKU,iBACRG,CAAAA,EACAC,CAAAA,EACAJ,CAAAA,EACA1B,CAAAA,EACAliG,CAAAA,EAAAA;gBAEA,OAAQA;oBACN,KAAKsgG,GAAiBuD,OAAAA;wBACpB,OAAO;4BACLd,cAAc;4BACdD,UAAUZ;wBAAAA;oBAEd,KAAK5B,GAAiB9tC,IAAAA;wBAEpB,OAAIuxC,MAAYC,IAAW,IAElB;4BACLjB,cAAcgB,IAAUH;4BACxBd,UAAUc,IAAYI,CAAAA,IAAWJ,IAAW1B,CAAAA;wBAAAA,IAGvC;4BACLa,cAAcgB,IAAUH;4BACxBd,UAAUc;wBAAAA;oBAIhB,KAAKtD,GAAiBwD,OAAAA;wBACpB,MAAMG,KAAkB/B,IAAkB8B;wBAE1C,OAAO;4BACLjB,cAFegB,IAAUE;4BAGzBnB,UAAUmB;wBAAAA;gBAAAA;YAGlB;QAAA;QCjjBK,MAAMC,WAAuBpkG;YAMlC,YAAY/6B,CAAAA,CAAAA;gBACV2T,KAAAA,CAAM;oBAAA,GACD3T,CAAAA;oBACHg7B,QAAQh7B,EAAQo/H,SAAAA,CAAUpkG,MAAAA,CAAO1oC,KAAAA;oBACjC2oC,UAAUj7B,EAAQo/H,SAAAA,CAAUnkG,QAAAA;oBAC5BC,eAAel7B,EAAQo/H,SAAAA,CAAUlkG,aAAAA;oBACjCU,OAAO57B,EAAQo/H,SAAAA,CAAUxjG,KAAAA;oBACzBE,SAAS97B,EAAQo/H,SAAAA,CAAUliG,UAAAA;gBAAAA,IAZvB,IAAA,CAAA3gB,MAAAA,GAAS,IAAI9uB,GACd,IAAA,CAAAwmB,KAAAA,GAAQltB,IAAAA,CAAKw1B,MAAAA,CAAO3uB,OAAAA,EACnB,IAAA,CAAAyxI,WAAAA,GAAsB,GACtB,IAAA,CAAAC,YAAAA,GAAuB,GACvB,IAAA,CAAAC,WAAAA,GAAmC,CAAC,GAU1Cx4I,IAAAA,CAAKw4I,WAAAA,GAAc;oBAAA,GAAKv/H,EAAQ8T,UAAAA;gBAAAA,GAChC/sB,IAAAA,CAAKs4I,WAAAA,GAAcr/H,EAAQkB,KAAAA,EAC3Bna,IAAAA,CAAKu4I,YAAAA,GAAet/H,EAAQoB,MAAAA;gBAE5B,MAAMo+H,IAA4B,EAAA;gBAClC,IAAK,IAAIj4I,IAAI,GAAGA,IAAIR,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,EAAQE,IAAK;oBAC3C,MAAM40C,IAAUp1C,IAAAA,CAAKi0C,MAAAA,CAAOzzC,EAAAA,CAAG40C,OAAAA;oBAC/B,IAAIA,KAAWA,aAAmB1oB,IAAQ;wBACxC,MAAMgsH,IAAc,IAAInjH,GAAY;4BAClC5I,OAAOyoB,EAAQzoB,KAAAA;4BACfxS,OAAOlB,EAAQkB,KAAAA;4BACfE,QAAQpB,EAAQoB,MAAAA;4BAChB0S,YAAY;gCAAA,GAAKqoB,EAAQroB,UAAAA;4BAAAA;4BACzBwC,UAAUtW,EAAQsW,QAAAA;4BAClBD,WAAWrW,EAAQqW,SAAAA;wBAAAA;wBAErBtvB,IAAAA,CAAKi0C,MAAAA,CAAOzzC,EAAAA,CAAG40C,OAAAA,GAAUsjG,GAGzBA,EAAYxrH,KAAAA,CAAMC,IAAAA,CAAK;4BACrBurH,EAAY3rH,UAAAA,GAAa;gCAAA,GAAK2rH,EAAY3rH,UAAAA;gCAAAA,GAAe/sB,IAAAA,CAAKw4I,WAAAA;4BAAAA;wBAAa,IAE7EC,EAAS94I,IAAAA,CAAK+4I,EAAYxrH,KAAAA;oBAC5B;gBACF;gBACA3oB,QAAQ8+D,GAAAA,CAAIo1E,GAAUtrH,IAAAA,CAAK,IAAMntB,IAAAA,CAAKw1B,MAAAA,CAAOhxB,OAAAA;YAC/C;YAEO,OAAA,cAAqB6zI,CAAAA,EAAsBp/H,CAAAA,EAAAA;gBAChD,OAAO,IAAIm/H,GAAe;oBACxBj+H,OAAOk+H,EAAUl+H,KAAAA;oBACjBE,QAAQg+H,EAAUh+H,MAAAA;oBAAAA,GACfpB,CAAAA;oBACHo/H,WAAAA;gBAAAA;YAEJ;YAEQ,oBAAAO;gBACN,IAAK,IAAIp4I,IAAI,GAAGA,IAAIR,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,EAAQE,IAAK;oBAC3C,MAAM40C,IAAUp1C,IAAAA,CAAKi0C,MAAAA,CAAOzzC,EAAAA,CAAG40C,OAAAA;oBAC3BA,KAAWA,aAAmB1oB,MAChC0oB,CAAAA,EAAQroB,UAAAA,GAAa;wBAAA,GAAKqoB,EAAQroB,UAAAA;wBAAAA,GAAe/sB,IAAAA,CAAKw4I,WAAAA;oBAAAA,CAAAA;gBAE1D;YACF;YAEA,IAAA,aAAIzrH;gBACF,OAAOnC,GAAM5qB,IAAAA,CAAKw4I,WAAAA,EAAa,IAAMx4I,IAAAA,CAAK44I,iBAAAA;YAC5C;YAEA,IAAA,WAAe7rH,CAAAA,EAAAA;gBACb/sB,IAAAA,CAAKw4I,WAAAA,GAAc5tH,GAAMmC,GAAY,IAAM/sB,IAAAA,CAAK44I,iBAAAA,KAChD54I,IAAAA,CAAK44I,iBAAAA;YACP;YAEQ,qBAAAC;gBACN,IAAK,IAAIr4I,IAAI,GAAGA,IAAIR,IAAAA,CAAKi0C,MAAAA,CAAO3zC,MAAAA,EAAQE,IAAK;oBAC3C,MAAM40C,IAAUp1C,IAAAA,CAAKi0C,MAAAA,CAAOzzC,EAAAA,CAAG40C,OAAAA;oBAC3BA,KAAWA,aAAmB1oB,MAChC0oB,CAAAA,EAAQroB,UAAAA,CAAW1S,MAAAA,GAASra,IAAAA,CAAKu4I,YAAAA,IAAgBnjG,EAAQ/6B,MAAAA,EACzD+6B,EAAQpoB,QAAAA,CAAS3S,MAAAA,GAASra,IAAAA,CAAKu4I,YAAAA,IAAgBnjG,EAAQ/6B,MAAAA,EACvD+6B,EAAQroB,UAAAA,CAAW5S,KAAAA,GAAQna,IAAAA,CAAKs4I,WAAAA,IAAeljG,EAAQj7B,KAAAA,EACvDi7B,EAAQpoB,QAAAA,CAAS7S,KAAAA,GAAQna,IAAAA,CAAKs4I,WAAAA,IAAeljG,EAAQj7B,KAAAA,AAAAA;gBAEzD;YACF;YAEA,IAAA,QAAIA;gBACF,OAAOna,IAAAA,CAAKs4I,WACd;YAAA;YAEA,IAAA,SAAIj+H;gBACF,OAAOra,IAAAA,CAAKu4I,YACd;YAAA;YAEA,IAAA,MAAmBp+H,CAAAA,EAAAA;gBACjBna,IAAAA,CAAKs4I,WAAAA,GAAcn+H,GACnBna,IAAAA,CAAK64I,kBAAAA;YACP;YAEA,IAAA,OAAoBx+H,CAAAA,EAAAA;gBAClBra,IAAAA,CAAKu4I,YAAAA,GAAel+H,GACpBra,IAAAA,CAAK64I,kBAAAA;YACP;QAAA;QCxHK,MAAMC,KAAc,GACrBC,KAAsD,CAAC,GAChDC,KAAuB;YAClC,IAAK,MAAMr+H,KAAWo+H,GACpBA,EAAAA,CAAgBp+H,EAAAA,GAAW;QAC7B,GAGIs+H,KAAa,CAACt+H,GAAiB1B;YACnC,MAAMigI,IAA2BxzI,EAAMW,SAAAA,CAAU;YAC7C0yI,EAAAA,CAAgBp+H,EAAAA,GAAWm+H,MAAAA,CAAgBI,KAC7CtiI,CAAAA,EAAOS,WAAAA,GAAcgB,IAAAA,CAAKsC,IAGtB/B,QAAQk4C,KAAAA,IAAS73C,EAAQkgI,cAAAA,IAE3BvgI,QAAQk4C,KAAAA,EAAAA,GAGZioF,EAAAA,CAAgBp+H,EAAAA;QAAU;QAOrB,SAASy+H,GAASngI,CAAAA;YAQvB,OAPAA,IAAU;gBACR0B,SAAS;gBACT0+H,iBAAiB;gBACjBF,gBAAAA,CAAgB;gBAAA,GACblgI,CAAAA;YAAAA,GAGE,SAAUoI,CAAAA,EAAai4H,CAAAA,EAAkBC,CAAAA;gBAC9C,IACEA,KAC8B,cAAA,OAArBA,EAAWn2I,KAAAA,IAAkD,cAAA,OAAnBm2I,EAAW52I,GAAAA,IAAgD,cAAA,OAAnB42I,EAAWvuH,GAAAA,EAEtG,MAAM,IAAIwuH,YAAY;gBAExB,MAEM7+H,IACJ,GAHsB,GAAG0G,EAAOoN,IAAAA,IAAQ,KAAKpN,EAAOoN,IAAAA,IAAQ6qH,IAAW,MAAM,KAAKA,KAAsB,IAAA,CAAA,qBAAA,EAG9DrgI,EAAQ0B,OAAAA,EAAAA,GACjD1B,CAAAA,EAAQogI,eAAAA,GAAkB,CAAA,KAAA,EAAQpgI,EAAQogI,eAAAA,CAAAA,QAAAA,CAAAA,GAA4B,EAAA;gBAEpEN,EAAAA,CAAgBp+H,EAAAA,IACnBo+H,CAAAA,EAAAA,CAAgBp+H,EAAAA,GAAW,CAAA;gBAI7B,MAAMi6E,IAAS2kD,IAAa;oBAAA,GAAKA,CAAAA;gBAAAA,IAAel4H;gBAChD,IAAA,CAAKk4H,GAAY;oBAEf,MAAME,UAAuB7kD;wBAC3B,YAAAjuF,GAAe+Q,CAAAA,CAAAA;4BACbuhI,GAAWt+H,GAAS1B,IACpB2T,KAAAA,IAASlV;wBACX;oBAAA;oBAEF,OAAO+hI;gBACT;gBAEA,OAAIF,KAAcA,EAAWn2I,KAAAA,GAC3BwxF,CAAAA,EAAOxxF,KAAAA,GAAQ;oBAEb,OADA61I,GAAWt+H,GAAS1B,IACbsgI,EAAWn2I,KAAAA,CAAM2V,KAAAA,CAAM/Y,IAAAA,EAAMm4E;gBACtC,GACOyc,CAAAA,IAGL2kD,CAAAA,KAAcA,EAAW52I,GAAAA,IAC3BiyF,CAAAA,EAAOjyF,GAAAA,GAAM;oBAEX,OADAs2I,GAAWt+H,GAAS1B,IACbsgI,EAAW52I,GAAAA,CAAIoW,KAAAA,CAAM/Y,IAAAA,EAAMm4E;gBACpC,CAAA,GAGEohE,KAAcA,EAAWvuH,GAAAA,IAC3B4pE,CAAAA,EAAO5pE,GAAAA,GAAM;oBAEX,OADAiuH,GAAWt+H,GAAS1B,IACbsgI,EAAWvuH,GAAAA,CAAIjS,KAAAA,CAAM/Y,IAAAA,EAAMm4E;gBACpC,CAAA,GAEKyc,CAAAA;YACT;QACF;QCpGA,MAAM8kD;YAAN,aAAA;gBAEU,IAAA,CAAApgD,MAAAA,GAAsB,EAgBhC;YAAA;YAdE,IAAA,SAAWh5F;gBACT,OAAON,IAAAA,CAAKs5F,MAAAA,CAAOh5F,MACrB;YAAA;YAEO,UAAAq5I;gBACL,MAAMh5H,IAAS,IAAIja;gBAEnB,OADA1G,IAAAA,CAAKs5F,MAAAA,CAAO35F,IAAAA,CAAKghB,IACVA,EAAO9Z,OAChB;YAAA;YAEO,QAAQzD,CAAAA,EAAAA;gBACEpD,IAAAA,CAAKs5F,MAAAA,CAAO93E,KAAAA,GACpBhd,OAAAA,CAAQpB;YACjB;QAAA;QASK,MAAMy2I;YAEX,YAAoBC,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,MAAAA,GAAAA,GADZ,IAAA,CAAAC,UAAAA,GAAa,IAAIL;YACY;YAErC,IAAA,QAAW33G;gBACT,OAAO/hC,IAAAA,CAAK85I,MACd;YAAA;YAEA,IAAA,UAAWE;gBACT,OAAOh6I,IAAAA,CAAK+5I,UAAAA,CAAWz5I,MACzB;YAAA;YAGO,MAAA,QAAM25I;gBACX,OAAoB,MAAhBj6I,IAAAA,CAAK85I,MAAAA,GACP95I,CAAAA,IAAAA,CAAK85I,MAAAA,IACEv1I,QAAQC,OAAAA,EAAAA,IAEVxE,IAAAA,CAAK+5I,UAAAA,CAAWJ,OAAAA;YACzB;YAEO,KAAK53G,IAAgB,CAAA,EAAA;gBAC1B,IAAc,MAAVA,GAAJ;oBAGA,MAAiB,MAAVA,KAA0C,MAA3B/hC,IAAAA,CAAK+5I,UAAAA,CAAWz5I,MAAAA,EACpCN,IAAAA,CAAK+5I,UAAAA,CAAWH,OAAAA,CAAQ,OACxB73G;oBAEF/hC,IAAAA,CAAK85I,MAAAA,IAAU/3G;gBALf;YAMF;QAAA;QCtDK,MAAM87F,KAAa;QAAA,OAE1Bt6H,KAAAA;IAAAA,CAAAA;;;ACNA,YAAY;;;0DAMC;AAEb,4CAAa;AANb;AACA;AACA;AAEO,MAAM,uBAAuB,CAAA,GAAA,gCAAqB,AAAD,EAAE,MAAM,CAAC;AAE1D,MAAM,eAAe,CAAA,GAAA,0BAAY,AAAD;IAYnC,YAAY,MAAc,CAAE;QACxB,KAAK,CAAC;YACF,KAAK,CAAA,GAAA,cAAG,AAAD,EAAE,OAAO,MAAM,CAAC,KAAK,GAAG,GAAG,OAAO,MAAM,CAAC,MAAM,GAAG;YACzD,OAAO;YACP,QAAQ;YACR,OAAO,CAAA,GAAA,gBAAK,AAAD,EAAE,MAAM;YACnB,eAAe,CAAA,GAAA,wBAAa,AAAD,EAAE,OAAO;YACpC,gBAAgB;QACpB,SAnBG,SAAiB,SACjB,YAAoB,SACpB,YAAoB,UAEpB,OAAe,QACf,UAAkB,QAClB,WAAoB,WAEpB,qBAAqB,WACrB,oBAAoB;IAW3B;IAEO,SAAS,MAAc,EAAE;QAC5B,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,MAAM,WAAkB,IAAI,CAAA,GAAA,gBAAK,AAAD,EAAE;gBAC9B,KAAK,IAAM,IAAI,CAAC,QAAQ,GAAG;gBAC3B,SAAS;gBACT,UAAU,IAAI,CAAC,iBAAiB;YACpC;YAEA,MAAM,SAAS,IAAI,CAAA,GAAA,cAAM,AAAD,EACpB,IAAI,CAAC,GAAG,EACR,CAAA,GAAA,uBAAe,AAAD,EACV,IAAI,CAAC,GAAG,EACR,OAAO,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,GAE/C;YAGJ,OAAO,YAAY,CAAC,GAAG,CAAC;YACxB,OAAO,YAAY,CAAC,GAAG,CAAC;YAExB,IAAI,CAAC,QAAQ,GAAG;YAChB,SAAS,KAAK;QAClB;IACJ;IAES,aAAa,MAAc,EAAE;QAClC,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,CAAC;QACd,OAAO,MAAM,CAAC;QAEd,OAAO,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,SAAU,GAAG;YAClD,OAAO,QAAQ,CAAC;QACpB;QAEA,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC;YACvB,IAAI,YAAY,MAAM,KAAK,CAAC,KAAK,EAC7B,OAAO,UAAU,CAAC,QAAQ,MAAM,KAAK,CAAC,KAAK,CAAC,MAAM;QAE1D;IACJ;IAES,aAAa,MAAc,EAAE,EAAU,EAAQ;QACpD,MAAM,aAAqB,CAAA,GAAA,cAAG,AAAD,EACzB,AAAC,CAAA,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,GAAA,eAAI,AAAD,EAAE,CAAC,IAAI,KAAK,CAAA,IAAM,CAAA,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,GAAA,eAAI,AAAD,EAAE,CAAC,IAAI,IAAI,CAAA,GAC9F,AAAC,CAAA,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,GAAA,eAAI,AAAD,EAAE,CAAC,IAAI,KAAK,CAAA,IAAM,CAAA,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,GAAA,eAAI,AAAD,EAAE,CAAC,IAAI,IAAI,CAAA,GAChG,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,SAAS;QAEvC,IAAI,CAAC,GAAG,GAAG;IACf;AACJ;;;;;AC9EA,4CAAa;AA6Cb,qDAAgB;AA/ChB;AAEO,MAAM,eAAe,CAAA,GAAA,gBAAK,AAAD;IAI5B,YAAY,GAAW,EAAE,QAAgB,EAAE,cAAc,CAAE;QACvD,KAAK,CAAC;YACF,OAAO;YACP,QAAQ;YACR,OAAO,CAAA,GAAA,gBAAK,AAAD,EAAE,KAAK;YAClB,UAAU;YACV,KAAK;YACL,gBAAgB;QACpB,SAXG,eAAuB,WACvB,SAAS;IAWhB;IAES,aAAa,MAAc,EAAE;QAClC,MAAM,SAAS,IAAI;QAEnB,uBAAuB;QACvB,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAK,AAAD,EAAE;YACpB,KAAK;gBACD,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;YACnC;YACA,SAAS;YACT,UAAU;QACd;QAEA,OAAO,YAAY,CAAC,GAAG,CAAC;QACxB,MAAM,KAAK;QAEX,mDAAmD;QACnD,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC;YACvB,IAAI,gBAAgB,MAAM,KAAK,CAAC,KAAK,EACjC,MAAM,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,OAAO,MAAM;YAGtD,OAAO,YAAY,CAAC,MAAM,CAAC;QAC/B;IACJ;IAES,aAAa,MAAc,EAAE,EAAU,EAAQ;QACpD,IAAI,CAAC,GAAG,GAAG,CAAA,GAAA,iBAAM,AAAD,EAAE,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,IAAI,CAAC,YAAY;IAC3E;AACJ;AAEO,SAAS,gBAAgB,IAAY,EAAE,EAAU;IACpD,OAAO,KAAK,IAAI,CAAC,AAAC,CAAA,GAAG,CAAC,GAAG,KAAK,CAAC,AAAD,IAAM,CAAA,GAAG,CAAC,GAAG,KAAK,CAAC,AAAD,KAAO,CAAA,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,IAAI,KAAK,EAAE,GAAG,KAAK,EAAE,AAAD,KAAM;AACrG;;;ACjDA,QAAQ,cAAc,GAAG,SAAU,CAAC;IAClC,OAAO,KAAK,EAAE,UAAU,GAAG,IAAI;QAAC,SAAS;IAAC;AAC5C;AAEA,QAAQ,iBAAiB,GAAG,SAAU,CAAC;IACrC,OAAO,cAAc,CAAC,GAAG,cAAc;QAAC,OAAO;IAAI;AACrD;AAEA,QAAQ,SAAS,GAAG,SAAU,MAAM,EAAE,IAAI;IACxC,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,SAAU,GAAG;QACvC,IACE,QAAQ,aACR,QAAQ,gBACR,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,MAE3C;QAGF,OAAO,cAAc,CAAC,MAAM,KAAK;YAC/B,YAAY;YACZ,KAAK;gBACH,OAAO,MAAM,CAAC,IAAI;YACpB;QACF;IACF;IAEA,OAAO;AACT;AAEA,QAAQ,MAAM,GAAG,SAAU,IAAI,EAAE,QAAQ,EAAE,GAAG;IAC5C,OAAO,cAAc,CAAC,MAAM,UAAU;QACpC,YAAY;QACZ,KAAK;IACP;AACF;;;;;AChCA,kDAAsB;AAFtB;AAEO,MAAe,qBAAqB,CAAA,GAAA,gBAAK,AAAD;IAQpC,WAAW,MAAc,EAAE,GAAW,EAAE;QAC3C,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YAClB,IAAI,CAAC,MAAM,IAAI;YAEf,IAAI,IAAI,CAAC,kBAAkB,GAAG,GAAG;gBAC7B,IAAI,CAAC,UAAU,GAAG;gBAElB,MAAM,qBAA4B,IAAI,CAAA,GAAA,gBAAK,AAAD,EAAE;oBACxC,KAAK,IAAM,IAAI,CAAC,UAAU,GAAG;oBAC7B,SAAS;oBACT,UAAU,IAAI,CAAC,kBAAkB;gBACrC;gBAEA,OAAO,YAAY,CAAC,GAAG,CAAC;gBACxB,mBAAmB,KAAK;YAC5B;QACJ;IACJ;IAEO,KAAK,GAAW,EAAE;QACrB,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,CAAC,SAAS;IAC5D;;QA7BG,qBAII,aAAsB;;AA0BjC;;;;;AC7BA,2CAAa;AAHb;AACA;AAEO,MAAM,cAAc,CAAA,GAAA,YAAK,AAAD;IAQ3B,YAAY,GAAW,CAAE;QACrB,KAAK,CAAC;YACF,KAAK;YACL,OAAO;YACP,QAAQ;YACR,OAAO,CAAA,GAAA,gBAAK,AAAD,EAAE,KAAK;YAClB,eAAe,CAAA,GAAA,wBAAa,AAAD,EAAE,MAAM;QACvC,SAdG,SAAiB,QACjB,YAAoB,QACpB,YAAoB,UAEpB,qBAA6B,QAC7B,SAAiB;IAUxB;IAES,aAAa,MAAc,EAAE;QAClC,IAAI,CAAC,MAAM,CAAC;QACZ,IAAI,CAAC,MAAM,CAAC;IAChB;IAES,aAAa,MAAc,EAAE,EAAU,EAAQ;QACpD,MAAM,SAAS,OAAO,YAAY,CAAC,KAAK,CAAC,SAAS,CAAC;YAAC;SAAS,EAAE,QAAQ,CAAC,EAAE;QAE1E,IAAI,QAAQ;YACR,IAAI,CAAC,MAAM,GAAG,OAAO,GAAG;YACxB,IAAI,CAAC,MAAM,GAAG;QAClB,OACI,IAAI,CAAC,MAAM,GAAG;QAGlB,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,YAAY,CAAC;IACtB;AACJ;;;;;ACnCA,2CAAsB;AAJtB;AACA;AACA;AAEO,MAAe,cAAc,CAAA,GAAA,0BAAY,AAAD;IAKpC,aAAa,MAAc,EAAE;QAChC,IAAI,IAAI,CAAC,MAAM,IAAI,GACf,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;IAEvC;IAEO,oBAAoB;QACvB,IAAI,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,GAAG,GAAG,CAAA,GAAA,iBAAM,AAAD,EAAE,SAAS,CAAC,CAAA,GAAA,uBAAe,AAAD,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,GAC5D,UAAU,CAAC,IAAI,CAAC,SAAS;IAEtC;AACJ","sources":["../../../AppData/Local/npm-cache/_npx/b4a9aa12c0cf34a6/node_modules/@parcel/runtime-browser-hmr/lib/runtime-ff702b7428eb86be.js","src/main.ts","node_modules/excalibur/build/dist/excalibur.min.js","node_modules/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.css","node_modules/excalibur/build/dist/webpack:/ex/Util/Toaster.css","node_modules/excalibur/build/dist/node_modules/css-loader/dist/runtime/api.js","node_modules/excalibur/build/dist/node_modules/css-loader/dist/runtime/sourceMaps.js","node_modules/excalibur/build/dist/webpack:/ex/webpack/bootstrap","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerScope.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/rotation-type.ts","node_modules/excalibur/build/dist/webpack:/ex/Polyfill.ts","node_modules/excalibur/build/dist/webpack:/ex/Flags.ts","node_modules/excalibur/build/dist/webpack:/ex/Id.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Future.ts","node_modules/excalibur/build/dist/webpack:/ex/EventEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/Random.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/util.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector.ts","node_modules/excalibur/build/dist/webpack:/ex/Color.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Log.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Side.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/matrix.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Util.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/affine-matrix.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/RentalPool.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Watch.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Filtering.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Wrapping.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TiledSprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/render-source.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/render-target.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-buffer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-layout.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/quad-index-buffer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Util/Pool.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/draw-call.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/material.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/material-renderer/material-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/coord-plane.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/watch-vector.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/transform.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Observable.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","node_modules/excalibur/build/dist/webpack:/ex/Events.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontTextInstance.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontCache.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/Particles.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Screen.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/StateMachine.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","node_modules/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/DefaultLoader.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.logo.png","node_modules/excalibur/build/dist/webpack:/ex/Util/Detector.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/SolverStrategy.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactBias.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/projection.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/ray.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SpatialPartitionStrategy.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/PhysicsConfig.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/line-segment.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Debug.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/lerp.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/EaseBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Flash.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/bezier-curve.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CurveTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CurveBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Actor.ts","node_modules/excalibur/build/dist/webpack:/ex/ScreenElement.ts","node_modules/excalibur/build/dist/webpack:/ex/Timer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/ParallaxComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/DebugGraphicsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEventsToObjectDispatcher.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/TileMap.ts","node_modules/excalibur/build/dist/webpack:/ex/Camera.ts","node_modules/excalibur/build/dist/webpack:/ex/Trigger.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Priority.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/TagQuery.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TransformInterpolation.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SparseHashGrid.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionsSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntityComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntitySystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/OffscreenSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SparseHashGridCollisionProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/PhysicsWorld.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/InputMapper.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/IFrame.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEvent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/WheelEvent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerAbstraction.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/WheelDeltaMode.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/NativePointerButton.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerButton.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerType.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEventReceiver.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/InputHost.ts","node_modules/excalibur/build/dist/webpack:/ex/Scene.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessMode.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ScreenShader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/color-blind-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugConfig.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Browser.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Fps.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Clock.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Toaster.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Director.ts","node_modules/excalibur/build/dist/webpack:/ex/Context.ts","node_modules/excalibur/build/dist/webpack:/ex/GarbageCollector.ts","node_modules/excalibur/build/dist/webpack:/ex/Engine.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/EmitterType.ts","node_modules/excalibur/build/dist/webpack:/ex/Label.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/ParticleEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Assert.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/GpuParticleRenderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/GpuParticleEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricMap.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ActionSequence.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ParallelActions.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/QuadTree.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Font.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Coroutine.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Transition.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/FadeInOut.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/CrossFade.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Slide.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Line.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/NineSlice.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TiledAnimation.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Semaphore.ts","node_modules/excalibur/build/dist/webpack:/ex/index.ts","src/wester.ts","src/bullet.ts","../../../AppData/Local/npm-cache/_npx/b4a9aa12c0cf34a6/node_modules/@parcel/transformer-js/src/esmodule-helpers.js","src/livingentity.ts","src/slime.ts","src/enemy.ts"],"sourcesContent":["var HMR_HOST = null;var HMR_PORT = null;var HMR_SECURE = false;var HMR_ENV_HASH = \"d6ea1d42532a7575\";var HMR_USE_SSE = false;module.bundle.HMR_BUNDLE_ID = \"7dd44675b7a05eb9\";\"use strict\";\n\n/* global HMR_HOST, HMR_PORT, HMR_ENV_HASH, HMR_SECURE, HMR_USE_SSE, chrome, browser, __parcel__import__, __parcel__importScripts__, ServiceWorkerGlobalScope */\n/*::\nimport type {\n  HMRAsset,\n  HMRMessage,\n} from '@parcel/reporter-dev-server/src/HMRServer.js';\ninterface ParcelRequire {\n  (string): mixed;\n  cache: {|[string]: ParcelModule|};\n  hotData: {|[string]: mixed|};\n  Module: any;\n  parent: ?ParcelRequire;\n  isParcelRequire: true;\n  modules: {|[string]: [Function, {|[string]: string|}]|};\n  HMR_BUNDLE_ID: string;\n  root: ParcelRequire;\n}\ninterface ParcelModule {\n  hot: {|\n    data: mixed,\n    accept(cb: (Function) => void): void,\n    dispose(cb: (mixed) => void): void,\n    // accept(deps: Array<string> | string, cb: (Function) => void): void,\n    // decline(): void,\n    _acceptCallbacks: Array<(Function) => void>,\n    _disposeCallbacks: Array<(mixed) => void>,\n  |};\n}\ninterface ExtensionContext {\n  runtime: {|\n    reload(): void,\n    getURL(url: string): string;\n    getManifest(): {manifest_version: number, ...};\n  |};\n}\ndeclare var module: {bundle: ParcelRequire, ...};\ndeclare var HMR_HOST: string;\ndeclare var HMR_PORT: string;\ndeclare var HMR_ENV_HASH: string;\ndeclare var HMR_SECURE: boolean;\ndeclare var HMR_USE_SSE: boolean;\ndeclare var chrome: ExtensionContext;\ndeclare var browser: ExtensionContext;\ndeclare var __parcel__import__: (string) => Promise<void>;\ndeclare var __parcel__importScripts__: (string) => Promise<void>;\ndeclare var globalThis: typeof self;\ndeclare var ServiceWorkerGlobalScope: Object;\n*/\nvar OVERLAY_ID = '__parcel__error__overlay__';\nvar OldModule = module.bundle.Module;\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData[moduleName],\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n  module.bundle.hotData[moduleName] = undefined;\n}\nmodule.bundle.Module = Module;\nmodule.bundle.hotData = {};\nvar checkedAssets /*: {|[string]: boolean|} */, disposedAssets /*: {|[string]: boolean|} */, assetsToDispose /*: Array<[ParcelRequire, string]> */, assetsToAccept /*: Array<[ParcelRequire, string]> */;\nfunction getHostname() {\n  return HMR_HOST || (location.protocol.indexOf('http') === 0 ? location.hostname : 'localhost');\n}\nfunction getPort() {\n  return HMR_PORT || location.port;\n}\n\n// eslint-disable-next-line no-redeclare\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = getHostname();\n  var port = getPort();\n  var protocol = HMR_SECURE || location.protocol == 'https:' && !['localhost', '127.0.0.1', '0.0.0.0'].includes(hostname) ? 'wss' : 'ws';\n  var ws;\n  if (HMR_USE_SSE) {\n    ws = new EventSource('/__parcel_hmr');\n  } else {\n    try {\n      ws = new WebSocket(protocol + '://' + hostname + (port ? ':' + port : '') + '/');\n    } catch (err) {\n      if (err.message) {\n        console.error(err.message);\n      }\n      ws = {};\n    }\n  }\n\n  // Web extension context\n  var extCtx = typeof browser === 'undefined' ? typeof chrome === 'undefined' ? null : chrome : browser;\n\n  // Safari doesn't support sourceURL in error stacks.\n  // eval may also be disabled via CSP, so do a quick check.\n  var supportsSourceURL = false;\n  try {\n    (0, eval)('throw new Error(\"test\"); //# sourceURL=test.js');\n  } catch (err) {\n    supportsSourceURL = err.stack.includes('test.js');\n  }\n\n  // $FlowFixMe\n  ws.onmessage = async function (event /*: {data: string, ...} */) {\n    checkedAssets = {} /*: {|[string]: boolean|} */;\n    disposedAssets = {} /*: {|[string]: boolean|} */;\n    assetsToAccept = [];\n    assetsToDispose = [];\n    var data /*: HMRMessage */ = JSON.parse(event.data);\n    if (data.type === 'reload') {\n      fullReload();\n    } else if (data.type === 'update') {\n      // Remove error overlay if there is one\n      if (typeof document !== 'undefined') {\n        removeErrorOverlay();\n      }\n      let assets = data.assets.filter(asset => asset.envHash === HMR_ENV_HASH);\n\n      // Handle HMR Update\n      let handled = assets.every(asset => {\n        return asset.type === 'css' || asset.type === 'js' && hmrAcceptCheck(module.bundle.root, asset.id, asset.depsByBundle);\n      });\n      if (handled) {\n        console.clear();\n\n        // Dispatch custom event so other runtimes (e.g React Refresh) are aware.\n        if (typeof window !== 'undefined' && typeof CustomEvent !== 'undefined') {\n          window.dispatchEvent(new CustomEvent('parcelhmraccept'));\n        }\n        await hmrApplyUpdates(assets);\n        hmrDisposeQueue();\n\n        // Run accept callbacks. This will also re-execute other disposed assets in topological order.\n        let processedAssets = {};\n        for (let i = 0; i < assetsToAccept.length; i++) {\n          let id = assetsToAccept[i][1];\n          if (!processedAssets[id]) {\n            hmrAccept(assetsToAccept[i][0], id);\n            processedAssets[id] = true;\n          }\n        }\n      } else fullReload();\n    }\n    if (data.type === 'error') {\n      // Log parcel errors to console\n      for (let ansiDiagnostic of data.diagnostics.ansi) {\n        let stack = ansiDiagnostic.codeframe ? ansiDiagnostic.codeframe : ansiDiagnostic.stack;\n        console.error(' [parcel]: ' + ansiDiagnostic.message + '\\n' + stack + '\\n\\n' + ansiDiagnostic.hints.join('\\n'));\n      }\n      if (typeof document !== 'undefined') {\n        // Render the fancy html overlay\n        removeErrorOverlay();\n        var overlay = createErrorOverlay(data.diagnostics.html);\n        // $FlowFixMe\n        document.body.appendChild(overlay);\n      }\n    }\n  };\n  if (ws instanceof WebSocket) {\n    ws.onerror = function (e) {\n      if (e.message) {\n        console.error(e.message);\n      }\n    };\n    ws.onclose = function () {\n      console.warn('[parcel]  Connection to the HMR server was lost');\n    };\n  }\n}\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n    console.log('[parcel]  Error resolved');\n  }\n}\nfunction createErrorOverlay(diagnostics) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n  let errorHTML = '<div style=\"background: black; opacity: 0.85; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; font-family: Menlo, Consolas, monospace; z-index: 9999;\">';\n  for (let diagnostic of diagnostics) {\n    let stack = diagnostic.frames.length ? diagnostic.frames.reduce((p, frame) => {\n      return `${p}\n<a href=\"/__parcel_launch_editor?file=${encodeURIComponent(frame.location)}\" style=\"text-decoration: underline; color: #888\" onclick=\"fetch(this.href); return false\">${frame.location}</a>\n${frame.code}`;\n    }, '') : diagnostic.stack;\n    errorHTML += `\n      <div>\n        <div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">\n           ${diagnostic.message}\n        </div>\n        <pre>${stack}</pre>\n        <div>\n          ${diagnostic.hints.map(hint => '<div> ' + hint + '</div>').join('')}\n        </div>\n        ${diagnostic.documentation ? `<div> <a style=\"color: violet\" href=\"${diagnostic.documentation}\" target=\"_blank\">Learn more</a></div>` : ''}\n      </div>\n    `;\n  }\n  errorHTML += '</div>';\n  overlay.innerHTML = errorHTML;\n  return overlay;\n}\nfunction fullReload() {\n  if ('reload' in location) {\n    location.reload();\n  } else if (extCtx && extCtx.runtime && extCtx.runtime.reload) {\n    extCtx.runtime.reload();\n  }\n}\nfunction getParents(bundle, id) /*: Array<[ParcelRequire, string]> */{\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n  var parents = [];\n  var k, d, dep;\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || Array.isArray(dep) && dep[dep.length - 1] === id) {\n        parents.push([bundle, k]);\n      }\n    }\n  }\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n  return parents;\n}\nfunction updateLink(link) {\n  var href = link.getAttribute('href');\n  if (!href) {\n    return;\n  }\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    if (link.parentNode !== null) {\n      // $FlowFixMe\n      link.parentNode.removeChild(link);\n    }\n  };\n  newLink.setAttribute('href',\n  // $FlowFixMe\n  href.split('?')[0] + '?' + Date.now());\n  // $FlowFixMe\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      // $FlowFixMe[incompatible-type]\n      var href /*: string */ = links[i].getAttribute('href');\n      var hostname = getHostname();\n      var servedFromHMRServer = hostname === 'localhost' ? new RegExp('^(https?:\\\\/\\\\/(0.0.0.0|127.0.0.1)|localhost):' + getPort()).test(href) : href.indexOf(hostname + ':' + getPort());\n      var absolute = /^https?:\\/\\//i.test(href) && href.indexOf(location.origin) !== 0 && !servedFromHMRServer;\n      if (!absolute) {\n        updateLink(links[i]);\n      }\n    }\n    cssTimeout = null;\n  }, 50);\n}\nfunction hmrDownload(asset) {\n  if (asset.type === 'js') {\n    if (typeof document !== 'undefined') {\n      let script = document.createElement('script');\n      script.src = asset.url + '?t=' + Date.now();\n      if (asset.outputFormat === 'esmodule') {\n        script.type = 'module';\n      }\n      return new Promise((resolve, reject) => {\n        var _document$head;\n        script.onload = () => resolve(script);\n        script.onerror = reject;\n        (_document$head = document.head) === null || _document$head === void 0 || _document$head.appendChild(script);\n      });\n    } else if (typeof importScripts === 'function') {\n      // Worker scripts\n      if (asset.outputFormat === 'esmodule') {\n        return __parcel__import__(asset.url + '?t=' + Date.now());\n      } else {\n        return new Promise((resolve, reject) => {\n          try {\n            __parcel__importScripts__(asset.url + '?t=' + Date.now());\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n      }\n    }\n  }\n}\nasync function hmrApplyUpdates(assets) {\n  global.parcelHotUpdate = Object.create(null);\n  let scriptsToRemove;\n  try {\n    // If sourceURL comments aren't supported in eval, we need to load\n    // the update from the dev server over HTTP so that stack traces\n    // are correct in errors/logs. This is much slower than eval, so\n    // we only do it if needed (currently just Safari).\n    // https://bugs.webkit.org/show_bug.cgi?id=137297\n    // This path is also taken if a CSP disallows eval.\n    if (!supportsSourceURL) {\n      let promises = assets.map(asset => {\n        var _hmrDownload;\n        return (_hmrDownload = hmrDownload(asset)) === null || _hmrDownload === void 0 ? void 0 : _hmrDownload.catch(err => {\n          // Web extension fix\n          if (extCtx && extCtx.runtime && extCtx.runtime.getManifest().manifest_version == 3 && typeof ServiceWorkerGlobalScope != 'undefined' && global instanceof ServiceWorkerGlobalScope) {\n            extCtx.runtime.reload();\n            return;\n          }\n          throw err;\n        });\n      });\n      scriptsToRemove = await Promise.all(promises);\n    }\n    assets.forEach(function (asset) {\n      hmrApply(module.bundle.root, asset);\n    });\n  } finally {\n    delete global.parcelHotUpdate;\n    if (scriptsToRemove) {\n      scriptsToRemove.forEach(script => {\n        if (script) {\n          var _document$head2;\n          (_document$head2 = document.head) === null || _document$head2 === void 0 || _document$head2.removeChild(script);\n        }\n      });\n    }\n  }\n}\nfunction hmrApply(bundle /*: ParcelRequire */, asset /*:  HMRAsset */) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (asset.type === 'css') {\n    reloadCSS();\n  } else if (asset.type === 'js') {\n    let deps = asset.depsByBundle[bundle.HMR_BUNDLE_ID];\n    if (deps) {\n      if (modules[asset.id]) {\n        // Remove dependencies that are removed and will become orphaned.\n        // This is necessary so that if the asset is added back again, the cache is gone, and we prevent a full page reload.\n        let oldDeps = modules[asset.id][1];\n        for (let dep in oldDeps) {\n          if (!deps[dep] || deps[dep] !== oldDeps[dep]) {\n            let id = oldDeps[dep];\n            let parents = getParents(module.bundle.root, id);\n            if (parents.length === 1) {\n              hmrDelete(module.bundle.root, id);\n            }\n          }\n        }\n      }\n      if (supportsSourceURL) {\n        // Global eval. We would use `new Function` here but browser\n        // support for source maps is better with eval.\n        (0, eval)(asset.output);\n      }\n\n      // $FlowFixMe\n      let fn = global.parcelHotUpdate[asset.id];\n      modules[asset.id] = [fn, deps];\n    }\n\n    // Always traverse to the parent bundle, even if we already replaced the asset in this bundle.\n    // This is required in case modules are duplicated. We need to ensure all instances have the updated code.\n    if (bundle.parent) {\n      hmrApply(bundle.parent, asset);\n    }\n  }\n}\nfunction hmrDelete(bundle, id) {\n  let modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (modules[id]) {\n    // Collect dependencies that will become orphaned when this module is deleted.\n    let deps = modules[id][1];\n    let orphans = [];\n    for (let dep in deps) {\n      let parents = getParents(module.bundle.root, deps[dep]);\n      if (parents.length === 1) {\n        orphans.push(deps[dep]);\n      }\n    }\n\n    // Delete the module. This must be done before deleting dependencies in case of circular dependencies.\n    delete modules[id];\n    delete bundle.cache[id];\n\n    // Now delete the orphans.\n    orphans.forEach(id => {\n      hmrDelete(module.bundle.root, id);\n    });\n  } else if (bundle.parent) {\n    hmrDelete(bundle.parent, id);\n  }\n}\nfunction hmrAcceptCheck(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  if (hmrAcceptCheckOne(bundle, id, depsByBundle)) {\n    return true;\n  }\n\n  // Traverse parents breadth first. All possible ancestries must accept the HMR update, or we'll reload.\n  let parents = getParents(module.bundle.root, id);\n  let accepted = false;\n  while (parents.length > 0) {\n    let v = parents.shift();\n    let a = hmrAcceptCheckOne(v[0], v[1], null);\n    if (a) {\n      // If this parent accepts, stop traversing upward, but still consider siblings.\n      accepted = true;\n    } else {\n      // Otherwise, queue the parents in the next level upward.\n      let p = getParents(module.bundle.root, v[1]);\n      if (p.length === 0) {\n        // If there are no parents, then we've reached an entry without accepting. Reload.\n        accepted = false;\n        break;\n      }\n      parents.push(...p);\n    }\n  }\n  return accepted;\n}\nfunction hmrAcceptCheckOne(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (depsByBundle && !depsByBundle[bundle.HMR_BUNDLE_ID]) {\n    // If we reached the root bundle without finding where the asset should go,\n    // there's nothing to do. Mark as \"accepted\" so we don't reload the page.\n    if (!bundle.parent) {\n      return true;\n    }\n    return hmrAcceptCheck(bundle.parent, id, depsByBundle);\n  }\n  if (checkedAssets[id]) {\n    return true;\n  }\n  checkedAssets[id] = true;\n  var cached = bundle.cache[id];\n  assetsToDispose.push([bundle, id]);\n  if (!cached || cached.hot && cached.hot._acceptCallbacks.length) {\n    assetsToAccept.push([bundle, id]);\n    return true;\n  }\n}\nfunction hmrDisposeQueue() {\n  // Dispose all old assets.\n  for (let i = 0; i < assetsToDispose.length; i++) {\n    let id = assetsToDispose[i][1];\n    if (!disposedAssets[id]) {\n      hmrDispose(assetsToDispose[i][0], id);\n      disposedAssets[id] = true;\n    }\n  }\n  assetsToDispose = [];\n}\nfunction hmrDispose(bundle /*: ParcelRequire */, id /*: string */) {\n  var cached = bundle.cache[id];\n  bundle.hotData[id] = {};\n  if (cached && cached.hot) {\n    cached.hot.data = bundle.hotData[id];\n  }\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData[id]);\n    });\n  }\n  delete bundle.cache[id];\n}\nfunction hmrAccept(bundle /*: ParcelRequire */, id /*: string */) {\n  // Execute the module.\n  bundle(id);\n\n  // Run the accept callbacks in the new version of the module.\n  var cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    let assetsToAlsoAccept = [];\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      let additionalAssets = cb(function () {\n        return getParents(module.bundle.root, id);\n      });\n      if (Array.isArray(additionalAssets) && additionalAssets.length) {\n        assetsToAlsoAccept.push(...additionalAssets);\n      }\n    });\n    if (assetsToAlsoAccept.length) {\n      let handled = assetsToAlsoAccept.every(function (a) {\n        return hmrAcceptCheck(a[0], a[1]);\n      });\n      if (!handled) {\n        return fullReload();\n      }\n      hmrDisposeQueue();\n    }\n  }\n}","// main.ts\r\nimport { Color, DisplayMode, Engine, Resolution, vec, Vector } from 'excalibur';\r\nimport { Wester } from './wester';\r\nimport { Slime } from './slime';\r\n\r\nconst game = new Engine({\r\n    backgroundColor: Color.fromHex(\"#cfc7a1\"),\r\n    pixelArt: true,\r\n    snapToPixel: true,\r\n    pixelRatio: 1,\r\n    displayMode: DisplayMode.FitScreen,\r\n    //maxFps: 10\r\n});\r\n\r\nconst wester = new Wester(game);\r\n\r\ngame.currentScene.add(wester);\r\n\r\nfor (let i = 0; i < 20; i++) {\r\n    \r\n    game.currentScene.add(new Slime(\r\n        Vector.fromAngle(Math.random()*Math.PI*2).scaleEqual(800+Math.random()*600).add(\r\n            vec(game.screen.width/2, game.screen.height/2)\r\n        )\r\n    ));\r\n} \r\n\r\ngame.start();",null,"(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, () => {\nreturn ","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* Buttons styles start */\r\n\r\nbutton#excalibur-play {\r\n  display: inline-block;\r\n  position: relative;\r\n  z-index: 999;\r\n  border-radius: 6px;\r\n  border: none;\r\n  /*border: 3px solid;\r\n    border-color: white;\r\n    box-shadow: 0 0 10px #ccc;*/\r\n  padding: 1rem 1.5rem 1rem 4rem;\r\n  margin: 0;\r\n  text-decoration: none;\r\n  background: #00b233;\r\n  color: #ffffff;\r\n  font-family: sans-serif;\r\n  font-size: 2rem;\r\n  white-space: nowrap;\r\n  line-height: 1;\r\n  cursor: pointer;\r\n  text-align: center;\r\n  transition:\r\n    background 250ms ease-in-out,\r\n    transform 150ms ease;\r\n  -webkit-appearance: none;\r\n  -moz-appearance: none;\r\n\r\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r\n  animation: excalibur-button-fadein 200ms;\r\n}\r\n\r\n/*\r\nbutton#excalibur-play {\r\n  display: none;\r\n}*/\r\n\r\nbutton#excalibur-play:after {\r\n  position: absolute;\r\n  content: '';\r\n  border: 8px solid;\r\n  border-color: transparent transparent transparent white;\r\n  left: 35px;\r\n  top: 24px;\r\n  width: 0;\r\n  height: 0;\r\n}\r\n\r\nbutton#excalibur-play:before {\r\n  position: absolute;\r\n  content: '';\r\n  border: 3px solid;\r\n  left: 19px;\r\n  top: 14px;\r\n  border-radius: 20px;\r\n  width: 30px;\r\n  height: 30px;\r\n}\r\n\r\nbutton#excalibur-play:hover,\r\nbutton#excalibur-play:focus {\r\n  background: #00982c;\r\n}\r\n\r\nbutton#excalibur-play:focus {\r\n  outline: 1px solid #fff;\r\n  outline-offset: -4px;\r\n}\r\n\r\nbutton#excalibur-play:active {\r\n  transform: scale(0.99);\r\n}\r\n\r\n@keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Firefox < 16 */\r\n@-moz-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Safari, Chrome and Opera > 12.1 */\r\n@-webkit-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Internet Explorer */\r\n@-ms-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Opera < 12.1 */\r\n@-o-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Director/Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition:\\r\\n    background 250ms ease-in-out,\\r\\n    transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `#ex-toast-container {\r\n  position: absolute;\r\n  height: 0;\r\n  min-width: 50%;\r\n  left: 50%;\r\n  top: 0;\r\n}\r\n\r\n.ex-toast-message {\r\n  left: -50%;\r\n  position: relative;\r\n  display: flex;\r\n  justify-content: space-between;\r\n\r\n  padding: 10px;\r\n  margin-top: 5px;\r\n  font-size: 18px;\r\n  font-family: sans-serif;\r\n  border-radius: 6px;\r\n  border: 3px solid #b7b779;\r\n  background-color: rgb(253, 253, 192);\r\n}\r\n\r\n.ex-toast-message button {\r\n  align-self: flex-start;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Util/Toaster.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB\",\"sourcesContent\":[\"#ex-toast-container {\\r\\n  position: absolute;\\r\\n  height: 0;\\r\\n  min-width: 50%;\\r\\n  left: 50%;\\r\\n  top: 0;\\r\\n}\\r\\n\\r\\n.ex-toast-message {\\r\\n  left: -50%;\\r\\n  position: relative;\\r\\n  display: flex;\\r\\n  justify-content: space-between;\\r\\n\\r\\n  padding: 10px;\\r\\n  margin-top: 5px;\\r\\n  font-size: 18px;\\r\\n  font-family: sans-serif;\\r\\n  border-radius: 6px;\\r\\n  border: 3px solid #b7b779;\\r\\n  background-color: rgb(253, 253, 192);\\r\\n}\\r\\n\\r\\n.ex-toast-message button {\\r\\n  align-self: flex-start;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Determines the scope of handling mouse/touch events.\n */\n\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 'shortest-path',\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 'longest-path',\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 'clockwise',\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 'counter-clockwise'\r\n}\r\n","/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(window as any).requestIdleCallback) {\r\n    // Adapted from https://developer.chrome.com/blog/using-requestidlecallback#checking_for_requestidlecallback\r\n    (window as any).requestIdleCallback =\r\n      window.requestIdleCallback ||\r\n      function (cb: (args: any) => any) {\r\n        const start = Date.now();\r\n        return setTimeout(function () {\r\n          cb({\r\n            didTimeout: false,\r\n            timeRemaining: function () {\r\n              return Math.max(0, 50 - (Date.now() - start));\r\n            }\r\n          });\r\n        }, 1);\r\n      };\r\n\r\n    (window as any).cancelIdleCallback =\r\n      window.cancelIdleCallback ||\r\n      function (id: any) {\r\n        clearTimeout(id);\r\n      };\r\n  }\r\n}\r\n","/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before {@apilink Engine} construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Force excalibur to load the Canvas 2D graphics context fallback\r\n   * @warning not all features of excalibur are supported in the Canvas 2D fallback\r\n   */\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable('use-canvas-context');\r\n  }\r\n\r\n  /**\r\n   * Force excalibur to use the less optimized image renderer\r\n   */\r\n  public static useLegacyImageRenderer() {\r\n    Flags.enable('use-legacy-image-renderer');\r\n  }\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T;\r\n  value: number;\r\n};\r\n\r\n/**\r\n * Create a branded ID type from a number\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n}\r\n","/**\r\n * Future is a wrapper around a native browser Promise to allow resolving/rejecting at any time\r\n */\r\nexport class Future<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _resolver: (value: T) => void;\r\n  private _rejecter: (error: Error) => void;\r\n  private _isCompleted: boolean = false;\r\n\r\n  constructor() {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this._resolver = resolve;\r\n      this._rejecter = reject;\r\n    });\r\n  }\r\n\r\n  public readonly promise: Promise<T>;\r\n\r\n  public get isCompleted(): boolean {\r\n    return this._isCompleted;\r\n  }\r\n\r\n  public resolve(value: T): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._resolver(value);\r\n  }\r\n\r\n  public reject(error: Error): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._rejecter(error);\r\n  }\r\n}\r\n","export type EventMap = Record<string, any>;\r\nexport type EventKey<T extends EventMap> = string & keyof T;\r\nexport type Handler<EventType> = (event: EventType) => void;\r\n\r\n/**\r\n * Interface that represents a handle to a subscription that can be closed\r\n */\r\nexport interface Subscription {\r\n  /**\r\n   * Removes the associated event handler, synonymous with events.off(...);\r\n   */\r\n  close(): void;\r\n}\r\n\r\n/**\r\n * Excalibur's typed event emitter, this allows events to be sent with any string to Type mapping\r\n */\r\nexport class EventEmitter<TEventMap extends EventMap = any> {\r\n  private _paused = false;\r\n  private _empty = true;\r\n  private _listeners: Record<string, Handler<any>[]> = {};\r\n  private _listenersOnce: Record<string, Handler<any>[]> = {};\r\n  private _pipes: EventEmitter<any>[] = [];\r\n\r\n  /**\r\n   * Removes all listeners and pipes\r\n   */\r\n  clear() {\r\n    this._listeners = {};\r\n    this._listenersOnce = {};\r\n    this._pipes.length = 0;\r\n    this._empty = true;\r\n  }\r\n\r\n  on<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription;\r\n  on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  on<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription {\r\n    this._empty = false;\r\n    this._listeners[eventName] = this._listeners[eventName] ?? [];\r\n    this._listeners[eventName].push(handler);\r\n    return {\r\n      close: () => this.off(eventName, handler)\r\n    };\r\n  }\r\n\r\n  once<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription;\r\n  once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  once<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription {\r\n    this._empty = false;\r\n    this._listenersOnce[eventName] = this._listenersOnce[eventName] ?? [];\r\n    this._listenersOnce[eventName].push(handler);\r\n    return {\r\n      close: () => this.off(eventName, handler)\r\n    };\r\n  }\r\n\r\n  off<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): void;\r\n  off(eventName: string, handler: Handler<unknown>): void;\r\n  off(eventName: string): void;\r\n  off<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler?: Handler<TEventMap[TEventName]>): void {\r\n    if (handler) {\r\n      const newListeners = this._listeners[eventName]?.filter((h) => h !== handler);\r\n      this._listeners[eventName] = newListeners;\r\n\r\n      const newOnceListeners = this._listenersOnce[eventName]?.filter((h) => h !== handler);\r\n      this._listenersOnce[eventName] = newOnceListeners;\r\n    } else {\r\n      delete this._listeners[eventName];\r\n    }\r\n  }\r\n\r\n  emit<TEventName extends EventKey<TEventMap>>(eventName: TEventName, event: TEventMap[TEventName]): void;\r\n  emit(eventName: string, event?: any): void;\r\n  emit<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, event?: TEventMap[TEventName]): void {\r\n    if (this._empty) {\r\n      return;\r\n    }\r\n    if (this._paused) {\r\n      return;\r\n    }\r\n    const listeners = this._listeners[eventName];\r\n    if (listeners) {\r\n      for (let i = 0; i < listeners.length; i++) {\r\n        listeners[i](event);\r\n      }\r\n    }\r\n    const onces = this._listenersOnce[eventName];\r\n    this._listenersOnce[eventName] = [];\r\n    if (onces) {\r\n      for (let i = 0; i < onces.length; i++) {\r\n        onces[i](event);\r\n      }\r\n    }\r\n    for (let i = 0; i < this._pipes.length; i++) {\r\n      this._pipes[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Replay events from this emitter to another\r\n   * @param emitter\r\n   */\r\n  pipe(emitter: EventEmitter<any>): Subscription {\r\n    if (this === emitter) {\r\n      throw Error('Cannot pipe to self');\r\n    }\r\n    this._empty = false;\r\n    this._pipes.push(emitter);\r\n    return {\r\n      close: () => {\r\n        const i = this._pipes.indexOf(emitter);\r\n        if (i > -1) {\r\n          this._pipes.splice(i, 1);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Remove any piped emitters\r\n   * @param emitter\r\n   */\r\n  unpipe(emitter: EventEmitter<any>): void {\r\n    const i = this._pipes.indexOf(emitter);\r\n    if (i > -1) {\r\n      this._pipes.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Paused event emitters do not emit events\r\n   */\r\n  pause(): void {\r\n    this._paused = true;\r\n  }\r\n\r\n  /**\r\n   * Unpaused event emitter do emit events\r\n   */\r\n  unpause(): void {\r\n    this._paused = false;\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Random } from './Random';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Returns the fractional part of a number\r\n * @param x\r\n */\r\nexport function frac(x: number): number {\r\n  if (x >= 0) {\r\n    return x - Math.floor(x);\r\n  } else {\r\n    return x - Math.ceil(x);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the sign of a number, if 0 returns 0\r\n */\r\nexport function sign(val: number): number {\r\n  if (val === 0) {\r\n    return 0;\r\n  }\r\n  return val < 0 ? -1 : 1;\r\n}\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n/**\r\n * Approximately equals\r\n */\r\nexport function approximatelyEqual(val1: number, val2: number, tolerance: number) {\r\n  // https://dev.to/alldanielscott/how-to-compare-numbers-correctly-in-javascript-1l4i\r\n  return Math.abs(val1 - val2) < tolerance;\r\n}\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI)\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle >= TwoPI) {\r\n    while (tmpAngle >= TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { RotationType } from './rotation-type';\r\nimport { canonicalizeAngle, clamp, TwoPI } from './util';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * Get or set the vector equals epsilon, by default 0.001 meaning vectors within that tolerance on x or y will be considered equal.\r\n   */\r\n  public static EQUALS_EPSILON = 0.001;\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  public static min(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\r\n  }\r\n\r\n  public static max(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = Vector.EQUALS_EPSILON): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the {@apilink magnitude}.\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return deltaX * deltaX + deltaY * deltaY;\r\n  }\r\n\r\n  /**\r\n   * Clamps the current vector's magnitude mutating it\r\n   * @param magnitude\r\n   */\r\n  public clampMagnitude(magnitude: number): Vector {\r\n    const size = this.magnitude;\r\n    const newSize = clamp(size, 0, magnitude);\r\n    this.magnitude = newSize;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   * @deprecated Will be removed in v1, use Vector.magnitude\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   * @deprecated Will be removed in v1, use Vector.magnitude\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (length) of the Vector\r\n   */\r\n  public get magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set magnitude(newMagnitude: number) {\r\n    this.normalize().scale(newMagnitude, this);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a non-zero vector to have a magnitude of 1. Zero vectors return a new zero vector.\r\n   */\r\n  public normalize(): Vector {\r\n    const distance = this.distance();\r\n    if (distance === 0) {\r\n      return Vector.Zero;\r\n    }\r\n\r\n    return new Vector(this.x / distance, this.y / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   * @param dest  Optionally provide a destination vector for the result\r\n   */\r\n  public scale(scale: Vector, dest?: Vector): Vector;\r\n  public scale(size: number, dest?: Vector): Vector;\r\n  public scale(sizeOrScale: number | Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    if (sizeOrScale instanceof Vector) {\r\n      result.x = this.x * sizeOrScale.x;\r\n      result.y = this.y * sizeOrScale.y;\r\n    } else {\r\n      result.x = this.x * sizeOrScale;\r\n      result.y = this.y * sizeOrScale;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   * @param dest Optionally copy the result into a provided vector\r\n   */\r\n  public add(v: Vector, dest?: Vector): Vector {\r\n    if (dest) {\r\n      dest.x = this.x + v.x;\r\n      dest.y = this.y + v.y;\r\n      return dest;\r\n    }\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    const x = this.x - v.x;\r\n    const y = this.y - v.y;\r\n    result.x = x;\r\n    result.y = y;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector, in range [0, 2*PI)\r\n   */\r\n  public toAngle(): number {\r\n    return canonicalizeAngle(Math.atan2(this.y, this.x));\r\n  }\r\n\r\n  /**\r\n   * Returns the difference in radians between the angle of this vector and given angle,\r\n   * using the given rotation type.\r\n   * @param angle in radians to which the vector has to be rotated, using {@apilink rotate}\r\n   * @param rotationType what {@apilink RotationType} to use for the rotation\r\n   * @returns the angle by which the vector needs to be rotated to match the given angle\r\n   */\r\n  public angleBetween(angle: number, rotationType: RotationType): number {\r\n    const startAngleRadians = this.toAngle();\r\n    const endAngleRadians = canonicalizeAngle(angle);\r\n    let rotationClockwise = 0;\r\n    let rotationAntiClockwise = 0;\r\n    if (endAngleRadians > startAngleRadians) {\r\n      rotationClockwise = endAngleRadians - startAngleRadians;\r\n    } else {\r\n      rotationClockwise = (TwoPI - startAngleRadians + endAngleRadians) % TwoPI;\r\n    }\r\n    rotationAntiClockwise = (rotationClockwise - TwoPI) % TwoPI;\r\n    switch (rotationType) {\r\n      case RotationType.ShortestPath:\r\n        if (Math.abs(rotationClockwise) < Math.abs(rotationAntiClockwise)) {\r\n          return rotationClockwise;\r\n        } else {\r\n          return rotationAntiClockwise;\r\n        }\r\n      case RotationType.LongestPath:\r\n        if (Math.abs(rotationClockwise) > Math.abs(rotationAntiClockwise)) {\r\n          return rotationClockwise;\r\n        } else {\r\n          return rotationAntiClockwise;\r\n        }\r\n      case RotationType.Clockwise:\r\n        return rotationClockwise;\r\n      case RotationType.CounterClockwise:\r\n        return rotationAntiClockwise;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain angle in radians.\r\n   * Positive angle means rotation clockwise.\r\n   */\r\n  public rotate(angle: number, anchor?: Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    result.x = x;\r\n    result.y = y;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(dest?: Vector): Vector {\r\n    const v = dest ?? new Vector(0, 0);\r\n    v.x = this.x;\r\n    v.y = this.y;\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","/**\r\n * Provides standard colors (e.g. {@apilink Color.Black})\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like {@apilink Color.lighten}, {@apilink Color.darken}, and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    // Handle negative and fractional numbers\r\n    const hex = Math.max(Math.round(c), 0).toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    let hexRepresentation = '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n    if (this.a !== 1) {\r\n      hexRepresentation += this._componentToHex(this.a * 255);\r\n    }\r\n    return hexRepresentation;\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(dest?: Color): Color {\r\n    const result = dest || new Color(this.r, this.g, this.b, this.a);\r\n    result.r = this.r;\r\n    result.g = this.g;\r\n    result.b = this.b;\r\n    result.a = this.a;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Pink (#FFC0CB)\r\n   */\r\n  public static get Pink(): Color {\r\n    return Color.fromHex('#FFC0CB');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Purple (#800080)\r\n   */\r\n  public static get Purple(): Color {\r\n    return Color.fromHex('#800080');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Teal (#008080)\r\n   */\r\n  public static get Teal(): Color {\r\n    return Color.fromHex('#008080');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n\r\n  /**\r\n   * Brown (#964B00)\r\n   */\r\n  public static get Brown(): Color {\r\n    return Color.fromHex('#964B00');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(\r\n    public h: number,\r\n    public s: number,\r\n    public l: number,\r\n    public a: number\r\n  ) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n\r\nimport { Engine } from '../Engine';\r\nimport { vec } from '../Math/vector';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a {@apilink ConsoleAppender} and {@apilink ScreenAppender}.\r\n * Derive from {@apilink Appender} to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: {@apilink LogLevel.Info}\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new {@apilink Appender} to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _logOnceSet = new Set<any>();\r\n  private _logOnce(level: LogLevel, args: any[]): void {\r\n    const serialized = level + args.join('+');\r\n    if (this._logOnceSet.has(serialized)) {\r\n      return;\r\n    } else {\r\n      this._logOnceSet.add(serialized);\r\n      this._log(level, args);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Debug} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it wont log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debugOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Info} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Info} level, if it sees the same args again it wont log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public infoOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Warn} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Warn} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warnOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Error} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Error} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public errorOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Fatal} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatalOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport interface ScreenAppenderOptions {\r\n  engine: Engine;\r\n  /**\r\n   * Optionally set the width of the overlay canvas\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of the overlay canvas\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Adjust the text offset from the left side of the screen\r\n   */\r\n  xPos?: number;\r\n  /**\r\n   * Provide a text color\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the CSS zindex of the overlay canvas\r\n   */\r\n  zIndex?: number;\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  private _messages: string[] = [];\r\n  public canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _pos = 10;\r\n  private _color = Color.Black;\r\n  private _options: ScreenAppenderOptions;\r\n  constructor(options: ScreenAppenderOptions) {\r\n    this._options = options;\r\n    this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._ctx = this.canvas.getContext('2d')!;\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.zIndex = options.zIndex?.toString() ?? '99';\r\n    document.body.appendChild(this.canvas);\r\n    this._positionScreenAppenderCanvas();\r\n    options.engine.screen.events.on('resize', () => {\r\n      this._positionScreenAppenderCanvas();\r\n    });\r\n  }\r\n\r\n  private _positionScreenAppenderCanvas() {\r\n    const options = this._options;\r\n    this.canvas.width = options.width ?? options.engine.screen.resolution.width;\r\n    this.canvas.height = options.height ?? options.engine.screen.resolution.height;\r\n    this.canvas.style.position = 'absolute';\r\n    const pagePos = options.engine.screen.screenToPageCoordinates(vec(0, 0));\r\n    this.canvas.style.left = pagePos.x + 'px';\r\n    this.canvas.style.top = pagePos.y + 'px';\r\n    this._pos = options.xPos ?? this._pos;\r\n    this._color = options.color ?? this._color;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n\r\n    this._messages = this._messages.slice(0, 1000);\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = this._color.toRGBA();\r\n      this._ctx.fillText(this._messages[i], this._pos, pos);\r\n      pos += 10;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    if (Math.abs(direction.x) >= Math.abs(direction.y)) {\r\n      if (direction.x <= 0) {\r\n        return Side.Left;\r\n      }\r\n\r\n      return Side.Right;\r\n    }\r\n\r\n    if (direction.y <= 0) {\r\n      return Side.Top;\r\n    }\r\n\r\n    return Side.Bottom;\r\n  }\r\n}\r\n","import { sign } from './util';\r\nimport { Vector, vec } from './vector';\r\nimport { canonicalizeAngle } from './util';\r\n\r\nexport enum MatrixLocations {\r\n  X = 12,\r\n  Y = 13\r\n}\r\n\r\n/**\r\n * Excalibur Matrix helper for 4x4 matrices\r\n *\r\n * Useful for webgl 4x4 matrices\r\n */\r\nexport class Matrix {\r\n  /**\r\n   *  4x4 matrix in column major order\r\n   *\r\n   * |         |         |          |          |\r\n   * | ------- | ------- | -------- | -------- |\r\n   * | data[0] | data[4] | data[8]  | data[12] |\r\n   * | data[1] | data[5] | data[9]  | data[13] |\r\n   * | data[2] | data[6] | data[10] | data[14] |\r\n   * | data[3] | data[7] | data[11] | data[15] |\r\n   *\r\n   */\r\n  public data: Float32Array = new Float32Array(16);\r\n\r\n  /**\r\n   * Creates an orthographic (flat non-perspective) projection\r\n   * https://en.wikipedia.org/wiki/Orthographic_projection\r\n   * @param left\r\n   * @param right\r\n   * @param bottom\r\n   * @param top\r\n   * @param near\r\n   * @param far\r\n   */\r\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 2 / (right - left);\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 2 / (top - bottom);\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = -2 / (far - near);\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = -(right + left) / (right - left);\r\n    mat.data[13] = -(top + bottom) / (top - bottom);\r\n    mat.data[14] = -(far + near) / (far - near);\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current 4x4\r\n   */\r\n  public clone(dest?: Matrix): Matrix {\r\n    const mat = dest || new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat.data[6] = this.data[6];\r\n    mat.data[7] = this.data[7];\r\n\r\n    mat.data[8] = this.data[8];\r\n    mat.data[9] = this.data[9];\r\n    mat.data[10] = this.data[10];\r\n    mat.data[11] = this.data[11];\r\n\r\n    mat.data[12] = this.data[12];\r\n    mat.data[13] = this.data[13];\r\n    mat.data[14] = this.data[14];\r\n    mat.data[15] = this.data[15];\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static fromFloat32Array(data: Float32Array) {\r\n    const matrix = new Matrix();\r\n    matrix.data = data;\r\n    return matrix;\r\n  }\r\n\r\n  /**\r\n   * Creates a new identity matrix (a matrix that when applied does nothing)\r\n   */\r\n  public static identity(): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {Matrix} Current matrix as identity\r\n   */\r\n  public reset(): Matrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[12] = x;\r\n    mat.data[13] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[5] = sy;\r\n    mat.data[10] = 1;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle in radians\r\n   * @param angle\r\n   */\r\n  public static rotation(angle: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = Math.cos(angle);\r\n    mat.data[4] = -Math.sin(angle);\r\n    mat.data[1] = Math.sin(angle);\r\n    mat.data[5] = Math.cos(angle);\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\r\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as Matrix) || new Matrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      const a31 = this.data[2];\r\n      const a41 = this.data[3];\r\n\r\n      const a12 = this.data[4];\r\n      const a22 = this.data[5];\r\n      const a32 = this.data[6];\r\n      const a42 = this.data[7];\r\n\r\n      const a13 = this.data[8];\r\n      const a23 = this.data[9];\r\n      const a33 = this.data[10];\r\n      const a43 = this.data[11];\r\n\r\n      const a14 = this.data[12];\r\n      const a24 = this.data[13];\r\n      const a34 = this.data[14];\r\n      const a44 = this.data[15];\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      const b31 = other.data[2];\r\n      const b41 = other.data[3];\r\n\r\n      const b12 = other.data[4];\r\n      const b22 = other.data[5];\r\n      const b32 = other.data[6];\r\n      const b42 = other.data[7];\r\n\r\n      const b13 = other.data[8];\r\n      const b23 = other.data[9];\r\n      const b33 = other.data[10];\r\n      const b43 = other.data[11];\r\n\r\n      const b14 = other.data[12];\r\n      const b24 = other.data[13];\r\n      const b34 = other.data[14];\r\n      const b44 = other.data[15];\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\r\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\r\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\r\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n      const s = this.getScale();\r\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\r\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const a13 = this.data[8];\r\n    const a23 = this.data[9];\r\n    const a33 = this.data[10];\r\n    const a43 = this.data[11];\r\n\r\n    const a14 = this.data[12];\r\n    const a24 = this.data[13];\r\n    const a34 = this.data[14];\r\n    const a44 = this.data[15];\r\n\r\n    // Doesn't change z\r\n    const z = 0;\r\n    const w = 1;\r\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\r\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\r\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\r\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[12] = x;\r\n    this.data[13] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[12], this.data[13]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n    this.data[2] = cosine * a31 + sine * a32;\r\n    this.data[3] = cosine * a41 + sine * a42;\r\n\r\n    this.data[4] = cosine * a12 - sine * a11;\r\n    this.data[5] = cosine * a22 - sine * a21;\r\n    this.data[6] = cosine * a32 - sine * a31;\r\n    this.data[7] = cosine * a42 - sine * a41;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n    this.data[2] = a31 * x;\r\n    this.data[3] = a41 * x;\r\n\r\n    this.data[4] = a12 * y;\r\n    this.data[5] = a22 * y;\r\n    this.data[6] = a32 * y;\r\n    this.data[7] = a42 * y;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[4] = -sine * currentScale.x;\r\n    this.data[5] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xscale = vec(this.data[0], this.data[4]).magnitude;\r\n    return this._scaleSignX * xscale;\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yscale = vec(this.data[1], this.data[5]).magnitude;\r\n    return this._scaleSignY * yscale;\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scaleX = 1;\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (this._scaleX === val) {\r\n      return;\r\n    }\r\n\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[4] = xscale.y * val;\r\n    this._scaleX = val;\r\n  }\r\n\r\n  private _scaleY = 1;\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (this._scaleY === val) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[5] = yscale.y * val;\r\n    this._scaleY = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  /**\r\n   * Determinant of the upper left 2x2 matrix\r\n   */\r\n  public getBasisDeterminant() {\r\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public getAffineInverse(target?: Matrix): Matrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.getBasisDeterminant();\r\n    const inverseDet = 1 / det; // todo zero check\r\n    const a = this.data[0];\r\n    const b = this.data[4];\r\n    const c = this.data[1];\r\n    const d = this.data[5];\r\n\r\n    const m = target || Matrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[4] = -b * inverseDet;\r\n    m.data[5] = a * inverseDet;\r\n\r\n    const tx = this.data[12];\r\n    const ty = this.data[13];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\r\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\r\n\r\n    return m;\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return (\r\n      this.data[0] === 1 &&\r\n      this.data[1] === 0 &&\r\n      this.data[2] === 0 &&\r\n      this.data[3] === 0 &&\r\n      this.data[4] === 0 &&\r\n      this.data[5] === 1 &&\r\n      this.data[6] === 0 &&\r\n      this.data[7] === 0 &&\r\n      this.data[8] === 0 &&\r\n      this.data[9] === 0 &&\r\n      this.data[10] === 1 &&\r\n      this.data[11] === 0 &&\r\n      this.data[12] === 0 &&\r\n      this.data[13] === 0 &&\r\n      this.data[14] === 0 &&\r\n      this.data[15] === 1\r\n    );\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\r\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\r\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\r\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\r\n`;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Ray } from '../Math/ray';\r\nimport { Color } from '../Color';\r\nimport { Side } from './Side';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface BoundingBoxOptions {\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  bottom: number;\r\n}\r\n\r\n/**\r\n * Axis Aligned collision primitive for Excalibur.\r\n */\r\nexport class BoundingBox {\r\n  public top: number;\r\n  public right: number;\r\n  public bottom: number;\r\n  public left: number;\r\n\r\n  /**\r\n   * Constructor allows passing of either an object with all coordinate components,\r\n   * or the coordinate components passed separately.\r\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\r\n   * containing the four coordinate components.\r\n   * @param top     y coordinate of the top edge\r\n   * @param right   x coordinate of the right edge\r\n   * @param bottom  y coordinate of the bottom edge\r\n   */\r\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n    if (typeof leftOrOptions === 'object') {\r\n      this.left = leftOrOptions.left;\r\n      this.top = leftOrOptions.top;\r\n      this.right = leftOrOptions.right;\r\n      this.bottom = leftOrOptions.bottom;\r\n    } else if (typeof leftOrOptions === 'number') {\r\n      this.left = leftOrOptions;\r\n      this.top = top;\r\n      this.right = right;\r\n      this.bottom = bottom;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of {@apilink BoundingBox} that is a copy of the current instance\r\n   */\r\n  public clone(dest?: BoundingBox): BoundingBox {\r\n    const result = dest || new BoundingBox(0, 0, 0, 0);\r\n    result.left = this.left;\r\n    result.right = this.right;\r\n    result.top = this.top;\r\n    result.bottom = this.bottom;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Resets the bounds to a zero width/height box\r\n   */\r\n  public reset(): void {\r\n    this.left = 0;\r\n    this.top = 0;\r\n    this.bottom = 0;\r\n    this.right = 0;\r\n  }\r\n\r\n  /**\r\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\r\n   * @param intersection Intersection vector between 2 bounding boxes\r\n   */\r\n  public static getSideFromIntersection(intersection: Vector): Side {\r\n    if (!intersection) {\r\n      return Side.None;\r\n    }\r\n    if (intersection) {\r\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\r\n        if (intersection.x < 0) {\r\n          return Side.Right;\r\n        }\r\n        return Side.Left;\r\n      } else {\r\n        if (intersection.y < 0) {\r\n          return Side.Bottom;\r\n        }\r\n        return Side.Top;\r\n      }\r\n    }\r\n    return Side.None;\r\n  }\r\n\r\n  public static fromPoints(points: Vector[]): BoundingBox {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (let i = 0; i < points.length; i++) {\r\n      if (points[i].x < minX) {\r\n        minX = points[i].x;\r\n      }\r\n      if (points[i].x > maxX) {\r\n        maxX = points[i].x;\r\n      }\r\n      if (points[i].y < minY) {\r\n        minY = points[i].y;\r\n      }\r\n      if (points[i].y > maxY) {\r\n        maxY = points[i].y;\r\n      }\r\n    }\r\n    return new BoundingBox(minX, minY, maxX, maxY);\r\n  }\r\n\r\n  /**\r\n   * Creates a bounding box from a width and height\r\n   * @param width\r\n   * @param height\r\n   * @param anchor Default Vector.Half\r\n   * @param pos Default Vector.Zero\r\n   */\r\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\r\n    return new BoundingBox(\r\n      -width * anchor.x + pos.x,\r\n      -height * anchor.y + pos.y,\r\n      width - width * anchor.x + pos.x,\r\n      height - height * anchor.y + pos.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated width of the bounding box\r\n   */\r\n  public get width() {\r\n    return this.right - this.left;\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated height of the bounding box\r\n   */\r\n  public get height() {\r\n    return this.bottom - this.top;\r\n  }\r\n\r\n  /**\r\n   * Return whether the bounding box has zero dimensions in height,width or both\r\n   */\r\n  public hasZeroDimensions() {\r\n    return this.width === 0 || this.height === 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the bounding box\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\r\n  }\r\n\r\n  public get topLeft(): Vector {\r\n    return new Vector(this.left, this.top);\r\n  }\r\n\r\n  public get bottomRight(): Vector {\r\n    return new Vector(this.right, this.bottom);\r\n  }\r\n\r\n  public get topRight(): Vector {\r\n    return new Vector(this.right, this.top);\r\n  }\r\n\r\n  public get bottomLeft(): Vector {\r\n    return new Vector(this.left, this.bottom);\r\n  }\r\n\r\n  public translate(pos: Vector): BoundingBox {\r\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\r\n  }\r\n\r\n  /**\r\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\r\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\r\n   */\r\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\r\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  /**\r\n   * Scale a bounding box by a scale factor, optionally provide a point\r\n   * @param scale\r\n   * @param point\r\n   */\r\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\r\n    const shifted = this.translate(point);\r\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\r\n  }\r\n\r\n  /**\r\n   * Transform the axis aligned bounding box by a {@apilink Matrix}, producing a new axis aligned bounding box\r\n   * @param matrix\r\n   */\r\n  public transform(matrix: AffineMatrix) {\r\n    // inlined these calculations to not use vectors would speed it up slightly\r\n    // const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\r\n    // const xa = matFirstColumn.scale(this.left);\r\n    const xa1 = matrix.data[0] * this.left;\r\n    const xa2 = matrix.data[1] * this.left;\r\n\r\n    // const xb = matFirstColumn.scale(this.right);\r\n    const xb1 = matrix.data[0] * this.right;\r\n    const xb2 = matrix.data[1] * this.right;\r\n\r\n    // const matSecondColumn = vec(matrix.data[2], matrix.data[3]);\r\n    // const ya = matSecondColumn.scale(this.top);\r\n    const ya1 = matrix.data[2] * this.top;\r\n    const ya2 = matrix.data[3] * this.top;\r\n\r\n    // const yb = matSecondColumn.scale(this.bottom);\r\n    const yb1 = matrix.data[2] * this.bottom;\r\n    const yb2 = matrix.data[3] * this.bottom;\r\n\r\n    const matrixPos = matrix.getPosition();\r\n    // const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\r\n    // const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\r\n    const left = Math.min(xa1, xb1) + Math.min(ya1, yb1) + matrixPos.x;\r\n    const top = Math.min(xa2, xb2) + Math.min(ya2, yb2) + matrixPos.y;\r\n    const right = Math.max(xa1, xb1) + Math.max(ya1, yb1) + matrixPos.x;\r\n    const bottom = Math.max(xa2, xb2) + Math.max(ya2, yb2) + matrixPos.y;\r\n\r\n    return new BoundingBox({\r\n      left, //: topLeft.x,\r\n      top, //: topLeft.y,\r\n      right, //: bottomRight.x,\r\n      bottom //: bottomRight.y\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the perimeter of the bounding box\r\n   */\r\n  public getPerimeter(): number {\r\n    const wx = this.width;\r\n    const wy = this.height;\r\n    return 2 * (wx + wy);\r\n  }\r\n\r\n  // Cache bounding box point returns\r\n  private _points: Vector[] = [];\r\n  private _left?: number;\r\n  private _right?: number;\r\n  private _top?: number;\r\n  private _bottom?: number;\r\n\r\n  /**\r\n   * Returns the world space points that make up the corners of the bounding box as a polygon\r\n   */\r\n  public getPoints(): Vector[] {\r\n    if (this._left !== this.left || this._right !== this.right || this._top !== this.top || this._bottom !== this.bottom) {\r\n      this._points.length = 0;\r\n      this._points.push(new Vector(this.left, this.top));\r\n      this._points.push(new Vector(this.right, this.top));\r\n      this._points.push(new Vector(this.right, this.bottom));\r\n      this._points.push(new Vector(this.left, this.bottom));\r\n      this._left = this.left;\r\n      this._right = this.right;\r\n      this._top = this.top;\r\n      this._bottom = this.bottom;\r\n    }\r\n    return this._points;\r\n  }\r\n\r\n  /**\r\n   * Determines whether a ray intersects with a bounding box\r\n   */\r\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tMin = -Infinity;\r\n    let tMax = +Infinity;\r\n\r\n    const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xInv;\r\n    const tx2 = (this.right - ray.pos.x) * xInv;\r\n    tMin = Math.min(tx1, tx2);\r\n    tMax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yInv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yInv;\r\n    tMin = Math.max(tMin, Math.min(ty1, ty2));\r\n    tMax = Math.min(tMax, Math.max(ty1, ty2));\r\n\r\n    return tMax >= Math.max(0, tMin) && tMin < farClipDistance;\r\n  }\r\n\r\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tMin = -Infinity;\r\n    let tMax = +Infinity;\r\n\r\n    const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xInv;\r\n    const tx2 = (this.right - ray.pos.x) * xInv;\r\n    tMin = Math.min(tx1, tx2);\r\n    tMax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yInv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yInv;\r\n    tMin = Math.max(tMin, Math.min(ty1, ty2));\r\n    tMax = Math.min(tMax, Math.max(ty1, ty2));\r\n\r\n    if (tMax >= Math.max(0, tMin) && tMin < farClipDistance) {\r\n      return tMin;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a point is contained within the bounding box\r\n   * @param p  The point to test\r\n   */\r\n  public contains(p: Vector): boolean;\r\n\r\n  /**\r\n   * Tests whether another bounding box is totally contained in this one\r\n   * @param bb  The bounding box to test\r\n   */\r\n  public contains(bb: BoundingBox): boolean;\r\n  public contains(val: any): boolean {\r\n    if (val instanceof Vector) {\r\n      return this.left <= val.x && this.top <= val.y && val.y <= this.bottom && val.x <= this.right;\r\n    } else if (val instanceof BoundingBox) {\r\n      return this.left <= val.left && this.top <= val.top && val.bottom <= this.bottom && val.right <= this.right;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Combines this bounding box and another together returning a new bounding box\r\n   * @param other  The bounding box to combine\r\n   */\r\n  public combine(other: BoundingBox, dest?: BoundingBox): BoundingBox {\r\n    const compositeBB = dest || new BoundingBox(0, 0, 0, 0);\r\n    const left = Math.min(this.left, other.left);\r\n    const top = Math.min(this.top, other.top);\r\n    const right = Math.max(this.right, other.right);\r\n    const bottom = Math.max(this.bottom, other.bottom);\r\n    compositeBB.left = left;\r\n    compositeBB.top = top;\r\n    compositeBB.right = right;\r\n    compositeBB.bottom = bottom;\r\n    return compositeBB;\r\n  }\r\n\r\n  public get dimensions(): Vector {\r\n    return new Vector(this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the bounding boxes overlap.\r\n   * @param other\r\n   * @param epsilon Optionally specify a small epsilon (default 0) as amount of overlap to ignore as overlap.\r\n   * This epsilon is useful in stable collision simulations.\r\n   */\r\n  public overlaps(other: BoundingBox, epsilon?: number): boolean {\r\n    const e = epsilon || 0;\r\n    if (other.hasZeroDimensions()) {\r\n      return this.contains(other);\r\n    }\r\n    if (this.hasZeroDimensions()) {\r\n      return other.contains(this);\r\n    }\r\n    const totalBoundingBox = this.combine(other);\r\n    return totalBoundingBox.width + e < other.width + this.width && totalBoundingBox.height + e < other.height + this.height;\r\n  }\r\n\r\n  /**\r\n   * Test wether this bounding box intersects with another returning\r\n   * the intersection vector that can be used to resolve the collision. If there\r\n   * is no intersection null is returned.\r\n   * @param other  Other {@apilink BoundingBox} to test intersection with\r\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\r\n   */\r\n  public intersect(other: BoundingBox): Vector {\r\n    const totalBoundingBox = this.combine(other);\r\n\r\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\r\n    if (\r\n      totalBoundingBox.width < other.width + this.width &&\r\n      totalBoundingBox.height < other.height + this.height &&\r\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\r\n      !totalBoundingBox.dimensions.equals(this.dimensions)\r\n    ) {\r\n      // collision\r\n      let overlapX = 0;\r\n      // right edge is between the other's left and right edge\r\n      /**\r\n       *     +-this-+\r\n       *     |      |\r\n       *     |    +-other-+\r\n       *     +----|-+     |\r\n       *          |       |\r\n       *          +-------+\r\n       *         <---\r\n       *          ^ overlap\r\n       */\r\n      if (this.right >= other.left && this.right <= other.right) {\r\n        overlapX = other.left - this.right;\r\n        // right edge is past the other's right edge\r\n        /**\r\n         *     +-other-+\r\n         *     |       |\r\n         *     |    +-this-+\r\n         *     +----|--+   |\r\n         *          |      |\r\n         *          +------+\r\n         *          --->\r\n         *          ^ overlap\r\n         */\r\n      } else {\r\n        overlapX = other.right - this.left;\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // top edge is between the other's top and bottom edge\r\n      /**\r\n       *     +-other-+\r\n       *     |       |\r\n       *     |    +-this-+   | <- overlap\r\n       *     +----|--+   |   |\r\n       *          |      |  \\ /\r\n       *          +------+   '\r\n       */\r\n      if (this.top <= other.bottom && this.top >= other.top) {\r\n        overlapY = other.bottom - this.top;\r\n        // top edge is above the other top edge\r\n        /**\r\n         *     +-this-+         .\r\n         *     |      |        / \\\r\n         *     |    +-other-+   | <- overlap\r\n         *     +----|-+     |   |\r\n         *          |       |\r\n         *          +-------+\r\n         */\r\n      } else {\r\n        overlapY = other.top - this.bottom;\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n      // Case of total containment of one bounding box by another\r\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\r\n      let overlapX = 0;\r\n      // this is wider than the other\r\n      if (this.width - other.width >= 0) {\r\n        // This right edge is closest to the others right edge\r\n        if (this.right - other.right <= other.left - this.left) {\r\n          overlapX = other.left - this.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = other.right - this.left;\r\n        }\r\n        // other is wider than this\r\n      } else {\r\n        // This right edge is closest to the others right edge\r\n        if (other.right - this.right <= this.left - other.left) {\r\n          overlapX = this.left - other.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = this.right - other.left;\r\n        }\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // this is taller than other\r\n      if (this.height - other.height >= 0) {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (this.bottom - other.bottom <= other.top - this.top) {\r\n          overlapY = other.top - this.bottom;\r\n        } else {\r\n          overlapY = other.bottom - this.top;\r\n        }\r\n        // other is taller than this\r\n      } else {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (other.bottom - this.bottom <= this.top - other.top) {\r\n          overlapY = this.top - other.bottom;\r\n        } else {\r\n          overlapY = this.bottom - other.top;\r\n        }\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\r\n   * @param bb The other actor to test\r\n   */\r\n  public intersectWithSide(bb: BoundingBox): Side {\r\n    const intersect = this.intersect(bb);\r\n    return BoundingBox.getSideFromIntersection(intersect);\r\n  }\r\n\r\n  /**\r\n   * Draw a debug bounding box\r\n   * @param ex\r\n   * @param color\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\r\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Clock } from './Clock';\r\nimport { Future } from './Future';\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  // do we need the scroll too? technically the offset method before did that\r\n  if (el && el.getBoundingClientRect) {\r\n    const rect = el.getBoundingClientRect();\r\n    return vec(rect.x + window.scrollX, rect.y + window.scrollY);\r\n  }\r\n  return Vector.Zero;\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n *\r\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\r\n * excalibur clock which would be unaffected by stop/pause.\r\n * @param milliseconds\r\n * @param clock\r\n */\r\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\r\n  const future = new Future<void>();\r\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\r\n  schedule(() => {\r\n    future.resolve();\r\n  }, milliseconds);\r\n  return future.promise;\r\n}\r\n\r\n/**\r\n * Remove keys from object literals\r\n * @param object\r\n * @param keys\r\n */\r\nexport function omit<TObject extends Object, Keys extends keyof TObject>(object: TObject, keys: Keys[]) {\r\n  const newObj: Omit<TObject, Keys> = {} as any;\r\n  for (const key in object) {\r\n    if (!keys.includes(key as any)) {\r\n      (newObj as any)[key] = object[key];\r\n    }\r\n  }\r\n  return newObj;\r\n}\r\n\r\n/**\r\n * Simple object check.\r\n * @param item\r\n */\r\nexport function isObject(item: any): item is object {\r\n  return item && typeof item === 'object' && !Array.isArray(item);\r\n}\r\n\r\n/**\r\n * Deep merge two objects.\r\n * @param target\r\n * @param sources\r\n */\r\nexport function mergeDeep<T extends object>(target: T, ...sources: T[]) {\r\n  if (!sources.length) {\r\n    return target;\r\n  }\r\n  const source = sources.shift();\r\n\r\n  if (isObject(target) && isObject(source)) {\r\n    for (const key in source) {\r\n      if (isObject(source[key])) {\r\n        if (!target[key]) {\r\n          Object.assign(target, { [key]: {} });\r\n        }\r\n        mergeDeep(target[key] as any, source[key]);\r\n      } else {\r\n        Object.assign(target, { [key]: source[key] });\r\n      }\r\n    }\r\n  }\r\n\r\n  return mergeDeep(target, ...sources);\r\n}\r\n","import { Matrix } from './matrix';\r\nimport { canonicalizeAngle, sign } from './util';\r\nimport { vec, Vector } from './vector';\r\n\r\nexport class AffineMatrix {\r\n  /**\r\n   * |         |         |          |\r\n   * | ------- | ------- | -------- |\r\n   * | data[0] | data[2] | data[4]  |\r\n   * | data[1] | data[3] | data[5]  |\r\n   * |   0     |    0    |    1     |\r\n   */\r\n  public data = new Float64Array(6);\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static identity(): AffineMatrix {\r\n    const mat = new AffineMatrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[4] = x;\r\n    mat.data[5] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[3] = sy;\r\n    mat._scale[0] = sx;\r\n    mat._scale[1] = sy;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle in radians\r\n   * @param angle\r\n   */\r\n  public static rotation(angle: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = Math.cos(angle);\r\n    mat.data[1] = Math.sin(angle);\r\n    mat.data[2] = -Math.sin(angle);\r\n    mat.data[3] = Math.cos(angle);\r\n    return mat;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[4] = x;\r\n    this.data[5] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[4], this.data[5]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n\r\n    this.data[2] = cosine * a12 - sine * a11;\r\n    this.data[3] = cosine * a22 - sine * a21;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    // const a31 = 0;\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n    // const a32 = 0;\r\n\r\n    const a13 = this.data[4];\r\n    const a23 = this.data[5];\r\n    // const a33 = 1;\r\n\r\n    // Doesn't change z\r\n    this.data[4] = a11 * x + a12 * y + a13;\r\n    this.data[5] = a21 * x + a22 * y + a23;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n\r\n    this.data[2] = a12 * y;\r\n    this.data[3] = a22 * y;\r\n\r\n    this._scale[0] = x;\r\n    this._scale[1] = y;\r\n    this._scaleSignX = sign(x);\r\n    this._scaleSignY = sign(y);\r\n    return this;\r\n  }\r\n\r\n  public determinant() {\r\n    return this.data[0] * this.data[3] - this.data[1] * this.data[2];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public inverse(target?: AffineMatrix): AffineMatrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.determinant();\r\n    let inverseDet = det; // default to a zero matrix if we have a singular matrix\r\n    if (det !== 0) {\r\n      inverseDet = 1 / det;\r\n    }\r\n    const a = this.data[0];\r\n    const b = this.data[2];\r\n    const c = this.data[1];\r\n    const d = this.data[3];\r\n\r\n    const m = target || AffineMatrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[2] = -b * inverseDet;\r\n    m.data[3] = a * inverseDet;\r\n\r\n    const tx = this.data[4];\r\n    const ty = this.data[5];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[4] = -(tx * m.data[0] + ty * m.data[2]);\r\n    m.data[5] = -(tx * m.data[1] + ty * m.data[3]);\r\n\r\n    return m;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: AffineMatrix, dest?: AffineMatrix): AffineMatrix;\r\n  multiply(vectorOrMatrix: Vector | AffineMatrix, dest?: Vector | AffineMatrix): Vector | AffineMatrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[2] + this.data[4];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[3] + this.data[5];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as AffineMatrix) || new AffineMatrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      //  const a31 = 0;\r\n\r\n      const a12 = this.data[2];\r\n      const a22 = this.data[3];\r\n      //  const a32 = 0;\r\n\r\n      const a13 = this.data[4];\r\n      const a23 = this.data[5];\r\n      //  const a33 = 1;\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      //  const b31 = 0;\r\n\r\n      const b12 = other.data[2];\r\n      const b22 = other.data[3];\r\n      //  const b32 = 0;\r\n\r\n      const b13 = other.data[4];\r\n      const b23 = other.data[5];\r\n      //  const b33 = 1;\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21; // + a13 * b31; // zero\r\n      result.data[1] = a21 * b11 + a22 * b21; // + a23 * b31; // zero\r\n\r\n      result.data[2] = a11 * b12 + a12 * b22; // + a13 * b32; // zero\r\n      result.data[3] = a21 * b12 + a22 * b22; // + a23 * b32; // zero\r\n\r\n      result.data[4] = a11 * b13 + a12 * b23 + a13; // * b33; // one\r\n      result.data[5] = a21 * b13 + a22 * b23 + a23; // * b33; // one\r\n\r\n      const signX = this._scaleSignX;\r\n      const signY = this._scaleSignY;\r\n      result._scaleSignX = signX * sign(result._scaleSignX);\r\n      result._scaleSignY = signY * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Packed array of length 8, that contains 4 vertices, with 2 components each\r\n   * So: [x0, y0, x1, y1, x2, y2, x3, y3]\r\n   * @param quad\r\n   */\r\n  multiplyQuadInPlace(quad: number[]) {\r\n    const resultTopLeftX = quad[0] * this.data[0] + quad[1] * this.data[2] + this.data[4];\r\n    const resultTopLeftY = quad[0] * this.data[1] + quad[1] * this.data[3] + this.data[5];\r\n    quad[0] = resultTopLeftX;\r\n    quad[1] = resultTopLeftY;\r\n\r\n    const resultTopRightX = quad[2] * this.data[0] + quad[3] * this.data[2] + this.data[4];\r\n    const resultTopRightY = quad[2] * this.data[1] + quad[3] * this.data[3] + this.data[5];\r\n    quad[2] = resultTopRightX;\r\n    quad[3] = resultTopRightY;\r\n\r\n    const resultBottomLeftX = quad[4] * this.data[0] + quad[5] * this.data[2] + this.data[4];\r\n    const resultBottomLeftY = quad[4] * this.data[1] + quad[5] * this.data[3] + this.data[5];\r\n    quad[4] = resultBottomLeftX;\r\n    quad[5] = resultBottomLeftY;\r\n\r\n    const resultBottomRightX = quad[6] * this.data[0] + quad[7] * this.data[2] + this.data[4];\r\n    const resultBottomRightY = quad[6] * this.data[1] + quad[7] * this.data[3] + this.data[5];\r\n    quad[6] = resultBottomRightX;\r\n    quad[7] = resultBottomRightY;\r\n  }\r\n\r\n  to4x4() {\r\n    const mat = new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = this.data[2];\r\n    mat.data[5] = this.data[3];\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = this.data[4];\r\n    mat.data[13] = this.data[5];\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[2] = -sine * currentScale.x;\r\n    this.data[3] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xScaleSq = this.data[0] * this.data[0] + this.data[2] * this.data[2];\r\n    if (xScaleSq === 1.0) {\r\n      // usually there isn't scale so we can avoid a sqrt\r\n      return this._scaleSignX;\r\n    }\r\n    return this._scaleSignX * Math.sqrt(xScaleSq);\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yScaleSq = this.data[1] * this.data[1] + this.data[3] * this.data[3];\r\n    if (yScaleSq === 1.0) {\r\n      // usually there isn't scale so we can avoid a sqrt\r\n      return this._scaleSignY;\r\n    }\r\n    return this._scaleSignY * Math.sqrt(yScaleSq);\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scale = new Float64Array([1, 1]);\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (val === this._scale[0]) {\r\n      return;\r\n    }\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[2] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[2] = xscale.y * val;\r\n    this._scale[0] = val;\r\n  }\r\n\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (val === this._scale[1]) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[3] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[3] = yscale.y * val;\r\n    this._scale[1] = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return this.data[0] === 1 && this.data[1] === 0 && this.data[2] === 0 && this.data[3] === 1 && this.data[4] === 0 && this.data[5] === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {AffineMatrix} Current matrix as identity\r\n   */\r\n  public reset(): AffineMatrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current {@apilink AffineMatrix}\r\n   */\r\n  public clone(dest?: AffineMatrix): AffineMatrix {\r\n    const mat = dest || new AffineMatrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat._scaleSignX = this._scaleSignX;\r\n    mat._scaleSignY = this._scaleSignY;\r\n    return mat;\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[2]} ${this.data[4]}]\r\n[${this.data[1]} ${this.data[3]} ${this.data[5]}]\r\n[0 0 1]\r\n`;\r\n  }\r\n}\r\n","export class RentalPool<T> {\r\n  private _pool: T[] = [];\r\n  private _size: number = 0;\r\n  constructor(\r\n    public builder: () => T,\r\n    public cleaner: (used: T) => T,\r\n    preAllocate: number = 1\r\n  ) {\r\n    this.grow(preAllocate);\r\n  }\r\n\r\n  /**\r\n   * Grow the pool size by an amount\r\n   * @param amount\r\n   */\r\n  grow(amount: number): void {\r\n    if (amount > 0) {\r\n      this._size += amount;\r\n      for (let i = 0; i < amount; i++) {\r\n        this._pool.push(this.builder());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rent an object from the pool, optionally clean it. If not cleaned previous state may be set.\r\n   *\r\n   * The pool will automatically double if depleted\r\n   * @param clean\r\n   */\r\n  rent(clean: boolean = false): T {\r\n    if (this._pool.length === 0) {\r\n      this.grow(this._size);\r\n    }\r\n\r\n    return clean ? this.cleaner(this._pool.pop()) : this._pool.pop();\r\n  }\r\n\r\n  /**\r\n   * Return an object to the pool\r\n   * @param object\r\n   */\r\n  return(object: T): void {\r\n    this._pool.push(object);\r\n  }\r\n}\r\n","import { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\n\r\nexport class TransformStack {\r\n  private _pool = new RentalPool(\r\n    () => AffineMatrix.identity(),\r\n    (mat) => mat.reset(),\r\n    100\r\n  );\r\n  private _transforms: AffineMatrix[] = [];\r\n\r\n  private _currentTransform: AffineMatrix = this._pool.rent(true);\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone(this._pool.rent());\r\n  }\r\n\r\n  public restore(): void {\r\n    this._pool.return(this._currentTransform);\r\n    this._currentTransform = this._transforms.pop()!;\r\n  }\r\n\r\n  public translate(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): AffineMatrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentTransform.reset();\r\n  }\r\n\r\n  public set current(matrix: AffineMatrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): AffineMatrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\nimport { Material } from './material';\r\n\r\nexport class ContextState implements ExcaliburGraphicsContextState {\r\n  opacity: number = 1;\r\n  z: number = 0;\r\n  tint: Color | null | undefined = Color.White;\r\n  material: Material | null | undefined = null;\r\n}\r\n\r\nexport class StateStack {\r\n  private _pool = new RentalPool<ContextState>(\r\n    () => new ContextState(),\r\n    (s) => {\r\n      s.opacity = 1;\r\n      s.z = 0;\r\n      s.tint = Color.White;\r\n      s.material = null;\r\n      return s;\r\n    },\r\n    100\r\n  );\r\n  public current: ExcaliburGraphicsContextState = this._pool.rent(true);\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n\r\n  private _cloneState(dest: ContextState) {\r\n    dest.opacity = this.current.opacity;\r\n    dest.z = this.current.z;\r\n    dest.tint = this.current.tint?.clone();\r\n    dest.material = this.current.material; // TODO is this going to cause problems when cloning\r\n    return dest;\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this.current);\r\n    this.current = this._cloneState(this._pool.rent());\r\n  }\r\n\r\n  public restore(): void {\r\n    this._pool.return(this.current);\r\n    this.current = this._states.pop()!;\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport type ResourceEvents = {\r\n  complete: any;\r\n  load: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  loadstart: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  progress: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  error: ProgressEvent<XMLHttpRequestEventTarget>;\r\n};\r\n\r\nexport const ResourceEvents = {\r\n  Complete: 'complete',\r\n  Load: 'load',\r\n  LoadStart: 'loadstart',\r\n  Progress: 'progress',\r\n  Error: 'error'\r\n};\r\n\r\n/**\r\n * The {@apilink Resource} type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use {@apilink Resource} for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events = new EventEmitter();\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = false\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        if (request.response instanceof Blob && request.response.type === 'text/html') {\r\n          const errorText = `Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!\r\n\r\nCheck your server configuration, for example Vite serves static files from the /public folder`;\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(errorText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\nconst createHandler = <T>(path: string[] = [], change: (type: T) => any, typeType: T) => ({\r\n  get: (target: T, key: string): any => {\r\n    if (key === '__isProxy') {\r\n      return true;\r\n    }\r\n    if (typeof (target as any)[key] === 'object' && (target as any)[key] != null) {\r\n      return new Proxy((target as any)[key], createHandler<any>([...path, key as string], change, typeType));\r\n    }\r\n    return (target as any)[key];\r\n  },\r\n  set: (target: T, key: string, value: any) => {\r\n    if (typeof key === 'string') {\r\n      if (key[0] !== '_') {\r\n        change(typeType);\r\n      }\r\n    }\r\n    (target as any)[key] = value;\r\n    return true;\r\n  }\r\n});\r\n\r\n/**\r\n *\r\n */\r\nexport function watchDeep<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, createHandler<T>([], change, type));\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { watch } from '../Util/Watch';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface GraphicOptions {\r\n  /**\r\n   * The width of the graphic\r\n   */\r\n  width?: number;\r\n  /**\r\n   * The height of the graphic\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Should the graphic be flipped horizontally\r\n   */\r\n  flipHorizontal?: boolean;\r\n  /**\r\n   * Should the graphic be flipped vertically\r\n   */\r\n  flipVertical?: boolean;\r\n  /**\r\n   * The rotation of the graphic\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * The scale of the graphic\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * The opacity of the graphic between (0 -1)\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * The tint of the graphic, this color will be multiplied by the original pixel colors\r\n   */\r\n  tint?: Color;\r\n  /**\r\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image in pixels\r\n   */\r\n  origin?: Vector;\r\n}\r\n\r\n/**\r\n * A Graphic is the base Excalibur primitive for something that can be drawn to the {@apilink ExcaliburGraphicsContext}.\r\n * {@apilink Sprite}, {@apilink Animation}, {@apilink GraphicsGroup}, {@apilink Canvas}, {@apilink Rectangle}, {@apilink Circle}, and {@apilink Polygon} all derive from the\r\n * {@apilink Graphic} abstract class.\r\n *\r\n * Implementors of a Graphic must override the abstract {@apilink Graphic._drawImage} method to render an image to the graphics context. Graphic\r\n * handles all the position, rotation, and scale transformations in {@apilink Graphic._preDraw} and {@apilink Graphic._postDraw}\r\n */\r\nexport abstract class Graphic {\r\n  private static _ID: number = 0;\r\n  readonly id = Graphic._ID++;\r\n\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public tint?: Color;\r\n\r\n  private _transformStale = true;\r\n  public isStale() {\r\n    return this._transformStale;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets wether to show debug information about the graphic\r\n   */\r\n  public showDebug: boolean = false;\r\n\r\n  private _flipHorizontal = false;\r\n  /**\r\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\r\n   */\r\n  public get flipHorizontal(): boolean {\r\n    return this._flipHorizontal;\r\n  }\r\n\r\n  public set flipHorizontal(value: boolean) {\r\n    this._flipHorizontal = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _flipVertical = false;\r\n  /**\r\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\r\n   */\r\n  public get flipVertical(): boolean {\r\n    return this._flipVertical;\r\n  }\r\n\r\n  public set flipVertical(value: boolean) {\r\n    this._flipVertical = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _rotation = 0;\r\n  /**\r\n   * Gets or sets the rotation of the graphic\r\n   */\r\n  public get rotation(): number {\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(value: number) {\r\n    this._rotation = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _scale = Vector.One;\r\n  /**\r\n   * Gets or sets the scale of the graphic, this affects the width and\r\n   */\r\n  public get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(value: Vector) {\r\n    this._scale = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _origin?: Vector;\r\n  /**\r\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\r\n   */\r\n  public get origin(): Vector | undefined {\r\n    return this._origin;\r\n  }\r\n\r\n  public set origin(value: Vector | undefined) {\r\n    if (value) {\r\n      this._origin = watch(value, () => {\r\n        this._transformStale = true;\r\n      });\r\n    }\r\n    this._transformStale = true;\r\n  }\r\n\r\n  constructor(options?: GraphicOptions) {\r\n    if (options) {\r\n      this.origin = options.origin ?? this.origin;\r\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\r\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\r\n      this.rotation = options.rotation ?? this.rotation;\r\n      this.opacity = options.opacity ?? this.opacity;\r\n      this.scale = options.scale ?? this.scale;\r\n      this.tint = options.tint ?? this.tint;\r\n      if (options.width) {\r\n        this._width = options.width;\r\n      }\r\n\r\n      if (options.height) {\r\n        this._height = options.height;\r\n      }\r\n    }\r\n  }\r\n\r\n  public cloneGraphicOptions(): GraphicOptions {\r\n    return {\r\n      width: this.width / this.scale.x,\r\n      height: this.height / this.scale.y,\r\n      origin: this.origin ? this.origin.clone() : undefined,\r\n      flipHorizontal: this.flipHorizontal,\r\n      flipVertical: this.flipVertical,\r\n      rotation: this.rotation,\r\n      opacity: this.opacity,\r\n      scale: this.scale ? this.scale.clone() : undefined,\r\n      tint: this.tint ? this.tint.clone() : undefined\r\n    };\r\n  }\r\n\r\n  private _width: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the width of the graphic (always positive)\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._width * this.scale.x);\r\n  }\r\n\r\n  private _height: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the height of the graphic (always positive)\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._height * this.scale.y);\r\n  }\r\n\r\n  public set width(value: number) {\r\n    this._width = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  public set height(value: number) {\r\n    this._height = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Draw the whole graphic to the context including transform\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  /**\r\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\r\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by {@apilink Graphic._preDraw}\r\n   * and {@apilink Graphic._postDraw}\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\r\n\r\n  /**\r\n   * Apply affine transformations to the graphics context to manipulate the graphic before {@apilink Graphic._drawImage}\r\n   * @param ex\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    ex.save();\r\n    ex.translate(x, y);\r\n    if (this._transformStale) {\r\n      this.transform.reset();\r\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n      this._rotate(this.transform);\r\n      this._flip(this.transform);\r\n      this._transformStale = false;\r\n    }\r\n    ex.multiply(this.transform);\r\n    // it is important to multiply alphas so graphics respect the current context\r\n    ex.opacity = ex.opacity * this.opacity;\r\n    if (this.tint) {\r\n      ex.tint = this.tint;\r\n    }\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ex.scale(scaleDirX, scaleDirY);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, this.height / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply any additional work after {@apilink Graphic._drawImage} and restore the context state.\r\n   * @param ex\r\n   */\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    if (this.showDebug) {\r\n      ex.debug.drawRect(0, 0, this.width, this.height);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of the graphic that has the same properties\r\n   */\r\n  abstract clone(): Graphic;\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the {@apilink ImageSource}\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the {@apilink ImageSource}\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  private _logger = Logger.getInstance();\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n  private _dirty = true;\r\n\r\n  public static from(image: ImageSource, options?: Omit<GraphicOptions & SpriteOptions, 'image'>): Sprite {\r\n    return new Sprite({\r\n      image,\r\n      ...options\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    // Fire when loaded\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    return Math.abs(this.destSize.width * this.scale.x);\r\n  }\r\n\r\n  public override get height(): number {\r\n    return Math.abs(this.destSize.height * this.scale.y);\r\n  }\r\n\r\n  public override set width(newWidth: number) {\r\n    newWidth /= Math.abs(this.scale.x);\r\n    this.destSize.width = newWidth;\r\n    super.width = Math.ceil(this.destSize.width);\r\n  }\r\n\r\n  public override set height(newHeight: number) {\r\n    newHeight /= Math.abs(this.scale.y);\r\n    this.destSize.height = newHeight;\r\n    super.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\r\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded() && this._dirty) {\r\n      this._dirty = false;\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    } else {\r\n      this._logger.warnOnce(\r\n        `ImageSource ${this.image.path}` +\r\n          ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\r\n          `Read https://excaliburjs.com/docs/imagesource for more information.`\r\n      );\r\n    }\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Describes the different image filtering modes\r\n */\r\nexport enum ImageFiltering {\r\n  /**\r\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\r\n   *\r\n   * Useful for Pixel art aesthetics.\r\n   */\r\n  Pixel = 'Pixel',\r\n\r\n  /**\r\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\r\n   */\r\n  Blended = 'Blended'\r\n}\r\n\r\n/**\r\n * Parse the image filtering attribute value, if it doesn't match returns null\r\n */\r\nexport function parseImageFiltering(val: string): ImageFiltering | undefined {\r\n  switch (val) {\r\n    case ImageFiltering.Pixel:\r\n      return ImageFiltering.Pixel;\r\n    case ImageFiltering.Blended:\r\n      return ImageFiltering.Blended;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n","/**\r\n * Describes the different image wrapping modes\r\n */\r\nexport enum ImageWrapping {\r\n  Clamp = 'Clamp',\r\n\r\n  Repeat = 'Repeat',\r\n\r\n  Mirror = 'Mirror'\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function parseImageWrapping(val: string): ImageWrapping {\r\n  switch (val) {\r\n    case ImageWrapping.Clamp:\r\n      return ImageWrapping.Clamp;\r\n    case ImageWrapping.Repeat:\r\n      return ImageWrapping.Repeat;\r\n    case ImageWrapping.Mirror:\r\n      return ImageWrapping.Mirror;\r\n    default:\r\n      return ImageWrapping.Clamp;\r\n  }\r\n}\r\n","import { GarbageCollector } from '../../GarbageCollector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { ImageFiltering } from '../Filtering';\r\nimport { ImageSourceOptions, ImageWrapConfiguration } from '../ImageSource';\r\nimport { ImageWrapping } from '../Wrapping';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _LOGGER = Logger.getInstance();\r\n\r\n  constructor(\r\n    gl: WebGL2RenderingContext,\r\n    private _garbageCollector?: {\r\n      garbageCollector: GarbageCollector;\r\n      collectionInterval: number;\r\n    }\r\n  ) {\r\n    this._gl = gl;\r\n    TextureLoader._MAX_TEXTURE_SIZE = gl.getParameter(gl.MAX_TEXTURE_SIZE);\r\n    if (this._garbageCollector) {\r\n      TextureLoader._LOGGER.debug('WebGL Texture collection interval:', this._garbageCollector.collectionInterval);\r\n      this._garbageCollector.garbageCollector?.registerCollector('texture', this._garbageCollector.collectionInterval, this._collect);\r\n    }\r\n  }\r\n\r\n  public dispose() {\r\n    for (const [image] of this._textureMap) {\r\n      this.delete(image);\r\n    }\r\n    this._textureMap.clear();\r\n    this._gl = null as any;\r\n  }\r\n\r\n  /**\r\n   * Sets the default filtering for the Excalibur texture loader, default {@apilink ImageFiltering.Blended}\r\n   */\r\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\r\n  public static wrapping: ImageWrapConfiguration = { x: ImageWrapping.Clamp, y: ImageWrapping.Clamp };\r\n\r\n  private _gl: WebGL2RenderingContext;\r\n\r\n  private _textureMap = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  private static _MAX_TEXTURE_SIZE: number = 4096;\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public get(image: HTMLImageSource): WebGLTexture {\r\n    return this._textureMap.get(image)!;\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public has(image: HTMLImageSource): boolean {\r\n    return this._textureMap.has(image)!;\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param options {ImageSourceOptions} Optionally configure the ImageFiltering and ImageWrapping mode to apply to the loaded texture\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public load(image: HTMLImageSource, options?: ImageSourceOptions, forceUpdate = false): WebGLTexture | null {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = this._gl;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    const { filtering, wrapping } = { ...options };\r\n\r\n    let tex: WebGLTexture | null = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (this.has(image)) {\r\n      tex = this.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n      }\r\n      this._garbageCollector?.garbageCollector.touch(image);\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n\r\n    // TODO implement texture gc with weakmap and timer\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n\r\n    let wrappingConfig: ImageWrapConfiguration | undefined;\r\n    if (wrapping) {\r\n      if (typeof wrapping === 'string') {\r\n        wrappingConfig = {\r\n          x: wrapping,\r\n          y: wrapping\r\n        };\r\n      } else {\r\n        wrappingConfig = {\r\n          x: wrapping.x,\r\n          y: wrapping.y\r\n        };\r\n      }\r\n    }\r\n    const { x: xWrap, y: yWrap } = wrappingConfig ?? TextureLoader.wrapping;\r\n    switch (xWrap) {\r\n      case ImageWrapping.Clamp:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        break;\r\n      case ImageWrapping.Repeat:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n        break;\r\n      case ImageWrapping.Mirror:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);\r\n        break;\r\n      default:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    }\r\n    switch (yWrap) {\r\n      case ImageWrapping.Clamp:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        break;\r\n      case ImageWrapping.Repeat:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n        break;\r\n      case ImageWrapping.Mirror:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT);\r\n        break;\r\n      default:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    }\r\n\r\n    // NEAREST for pixel art, LINEAR for hi-res\r\n    const filterMode = filtering ?? TextureLoader.filtering;\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\r\n    this._textureMap.set(image, tex!);\r\n    this._garbageCollector?.garbageCollector.addCollectableResource('texture', image);\r\n    return tex;\r\n  }\r\n\r\n  public delete(image: HTMLImageSource): void {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = this._gl;\r\n    if (!gl) {\r\n      return;\r\n    }\r\n\r\n    if (this.has(image)) {\r\n      const texture = this.get(image);\r\n      if (texture) {\r\n        this._textureMap.delete(image);\r\n        gl.deleteTexture(texture);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Takes an image and returns if it meets size criteria for hardware\r\n   * @param image\r\n   * @returns if the image will be supported at runtime\r\n   */\r\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\r\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\r\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\r\n      TextureLoader._LOGGER.error(\r\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of ` +\r\n          `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image ` +\r\n          `for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n` +\r\n          `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`\r\n      );\r\n      return false;\r\n    } else if (image.width > 4096 || image.height > 4096) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\r\n      TextureLoader._LOGGER.warn(\r\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, ` +\r\n          `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\r\n          `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\r\n          `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`\r\n      );\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Looks for textures that haven't been drawn in a while\r\n   */\r\n  private _collect = (image: HTMLImageSource) => {\r\n    if (this._gl) {\r\n      const name = image.dataset.originalSrc ?? image.constructor.name;\r\n      TextureLoader._LOGGER.debug(`WebGL Texture for ${name} collected`);\r\n      this.delete(image);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite, SpriteOptions } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { Future } from '../Util/Future';\r\nimport { TextureLoader } from '../Graphics/Context/texture-loader';\r\nimport { ImageWrapping } from './Wrapping';\r\nimport { GraphicOptions } from './Graphic';\r\n\r\nexport interface ImageSourceOptions {\r\n  filtering?: ImageFiltering;\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  bustCache?: boolean;\r\n}\r\n\r\nexport interface ImageWrapConfiguration {\r\n  x: ImageWrapping;\r\n  y: ImageWrapping;\r\n}\r\n\r\nexport const ImageSourceAttributeConstants = {\r\n  Filtering: 'filtering',\r\n  WrappingX: 'wrapping-x',\r\n  WrappingY: 'wrapping-y'\r\n} as const;\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n  public filtering?: ImageFiltering;\r\n  public wrapping?: ImageWrapConfiguration;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  private _src?: string;\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    if (!this._src) {\r\n      // this boosts speed of access\r\n      this._src = this.data.src;\r\n    }\r\n    return !!this._src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image element\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  private _readyFuture = new Future<HTMLImageElement>();\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement> = this._readyFuture.promise;\r\n\r\n  public readonly path: string;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param pathOrBase64 {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param options\r\n   */\r\n  constructor(pathOrBase64: string, options?: ImageSourceOptions);\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param pathOrBase64 {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\r\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by {@apilink EngineOptions.antialiasing}\r\n   */\r\n  constructor(pathOrBase64: string, bustCache: boolean, filtering?: ImageFiltering);\r\n  constructor(pathOrBase64: string, bustCacheOrOptions: boolean | ImageSourceOptions | undefined, filtering?: ImageFiltering) {\r\n    this.path = pathOrBase64;\r\n    let bustCache: boolean | undefined = false;\r\n    let wrapping: ImageWrapConfiguration | ImageWrapping | undefined;\r\n    if (typeof bustCacheOrOptions === 'boolean') {\r\n      bustCache = bustCacheOrOptions;\r\n    } else {\r\n      ({ filtering, wrapping, bustCache } = { ...bustCacheOrOptions });\r\n    }\r\n    this._resource = new Resource(pathOrBase64, 'blob', bustCache);\r\n    this.filtering = filtering ?? this.filtering;\r\n    if (typeof wrapping === 'string') {\r\n      this.wrapping = {\r\n        x: wrapping,\r\n        y: wrapping\r\n      };\r\n    } else {\r\n      this.wrapping = wrapping ?? this.wrapping;\r\n    }\r\n    if (pathOrBase64.endsWith('.gif')) {\r\n      this._logger.warn(\r\n        `Use the ex.Gif type to load gifs, you may have mixed results with ${pathOrBase64} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an ImageSource from and HTML <image> tag element\r\n   * @param image\r\n   */\r\n  static fromHtmlImageElement(image: HTMLImageElement, options?: ImageSourceOptions) {\r\n    const imageSource = new ImageSource('');\r\n    imageSource._src = 'image-element';\r\n    imageSource.data = image;\r\n    imageSource.data.setAttribute('data-original-src', 'image-element');\r\n\r\n    if (options?.filtering) {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options?.filtering);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\r\n    }\r\n\r\n    if (options?.wrapping) {\r\n      let wrapping: ImageWrapConfiguration;\r\n      if (typeof options.wrapping === 'string') {\r\n        wrapping = {\r\n          x: options.wrapping,\r\n          y: options.wrapping\r\n        };\r\n      } else {\r\n        wrapping = {\r\n          x: options.wrapping.x,\r\n          y: options.wrapping.y\r\n        };\r\n      }\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\r\n    }\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n    imageSource._readyFuture.resolve(image);\r\n    return imageSource;\r\n  }\r\n\r\n  static fromHtmlCanvasElement(image: HTMLCanvasElement, options?: ImageSourceOptions): ImageSource {\r\n    const imageSource = new ImageSource('');\r\n    imageSource._src = 'canvas-element-blob';\r\n    imageSource.data.setAttribute('data-original-src', 'canvas-element-blob');\r\n\r\n    if (options?.filtering) {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options?.filtering);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\r\n    }\r\n\r\n    if (options?.wrapping) {\r\n      let wrapping: ImageWrapConfiguration;\r\n      if (typeof options.wrapping === 'string') {\r\n        wrapping = {\r\n          x: options.wrapping,\r\n          y: options.wrapping\r\n        };\r\n      } else {\r\n        wrapping = {\r\n          x: options.wrapping.x,\r\n          y: options.wrapping.y\r\n        };\r\n      }\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\r\n    }\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    image.toBlob((blob) => {\r\n      // TODO throw? if blob null?\r\n      const url = URL.createObjectURL(blob!);\r\n      imageSource.image.onload = () => {\r\n        // no longer need to read the blob so it's revoked\r\n        URL.revokeObjectURL(url);\r\n        imageSource.data = imageSource.image;\r\n        imageSource._readyFuture.resolve(imageSource.image);\r\n      };\r\n      imageSource.image.src = url;\r\n    });\r\n\r\n    return imageSource;\r\n  }\r\n\r\n  static fromSvgString(svgSource: string, options?: ImageSourceOptions) {\r\n    const blob = new Blob([svgSource], { type: 'image/svg+xml' });\r\n    const url = URL.createObjectURL(blob);\r\n    return new ImageSource(url, options);\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      // Use Image.onload over Image.decode()\r\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1055828#c7\r\n      // Otherwise chrome will throw still Image.decode() failures for large textures\r\n      const loadedFuture = new Future<void>();\r\n      image.onload = () => loadedFuture.resolve();\r\n      image.src = url;\r\n      image.setAttribute('data-original-src', this.path);\r\n\r\n      await loadedFuture.promise;\r\n\r\n      // Set results\r\n      // We defer loading the texture into webgl until the first draw that way we avoid a singleton\r\n      // and for the multi-engine case the texture needs to be created in EACH webgl context to work\r\n      // See image-renderer.ts draw()\r\n      this.data = image;\r\n\r\n      // emit warning if potentially too big\r\n      TextureLoader.checkImageSizeSupportedAndLog(this.data);\r\n    } catch (error: any) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    // Do a bad thing to pass the filtering as an attribute\r\n    this.data.setAttribute(ImageSourceAttributeConstants.Filtering, this.filtering as any); // TODO fix type\r\n    this.data.setAttribute(ImageSourceAttributeConstants.WrappingX, this.wrapping?.x ?? ImageWrapping.Clamp);\r\n    this.data.setAttribute(ImageSourceAttributeConstants.WrappingY, this.wrapping?.y ?? ImageWrapping.Clamp);\r\n\r\n    // todo emit complete\r\n    this._readyFuture.resolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(options?: Omit<GraphicOptions & SpriteOptions, 'image'>): Sprite {\r\n    return Sprite.from(this, options);\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport interface SpriteFontOptions {\r\n  /**\r\n   * Alphabet string in spritesheet order (default is row column order)\r\n   * example: 'abcdefghijklmnopqrstuvwxyz'\r\n   */\r\n  alphabet: string;\r\n  /**\r\n   * {@apilink SpriteSheet} to source character sprites from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * Optionally ignore case in the supplied text;\r\n   */\r\n  caseInsensitive?: boolean;\r\n  /**\r\n   * Optionally override the text line height, useful for multiline text. If unset will use default.\r\n   */\r\n  lineHeight?: number | undefined;\r\n  /**\r\n   * Optionally adjust the spacing between character sprites\r\n   */\r\n  spacing?: number;\r\n  /**\r\n   * Optionally specify a \"shadow\"\r\n   */\r\n  shadow?: { offset: Vector };\r\n}\r\n\r\nexport class SpriteFont extends Graphic implements FontRenderer {\r\n  private _text: string = '';\r\n  public alphabet: string = '';\r\n  public spriteSheet: SpriteSheet;\r\n\r\n  public shadow?: { offset: Vector } = undefined;\r\n  public caseInsensitive = false;\r\n  public spacing: number = 0;\r\n  public lineHeight: number | undefined = undefined;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(options: SpriteFontOptions & GraphicOptions) {\r\n    super(options);\r\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow, lineHeight } = options;\r\n    this.alphabet = alphabet;\r\n    this.spriteSheet = spriteSheet;\r\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\r\n    this.spacing = spacing ?? this.spacing;\r\n    this.shadow = shadow ?? this.shadow;\r\n    this.lineHeight = lineHeight ?? this.lineHeight;\r\n  }\r\n\r\n  private _getCharacterSprites(text: string): Sprite[] {\r\n    const results: Sprite[] = [];\r\n    // handle case insensitive\r\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\r\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\r\n\r\n    // for each letter in text\r\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\r\n      // find the sprite index in alphabet , if there is an error pick the first\r\n      const letter = textToRender[letterIndex];\r\n      let spriteIndex = alphabet.indexOf(letter);\r\n      if (spriteIndex === -1) {\r\n        spriteIndex = 0;\r\n        this._logger.warnOnce(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\r\n        this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n      }\r\n\r\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\r\n      if (letterSprite) {\r\n        results.push(letterSprite);\r\n      } else {\r\n        this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\r\n        this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n      }\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public measureText(text: string, maxWidth?: number): BoundingBox {\r\n    const lines = this._getLinesFromText(text, maxWidth);\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n    const sprites = this._getCharacterSprites(maxWidthLine);\r\n    let width = 0;\r\n    let height = 0;\r\n    for (const sprite of sprites) {\r\n      width += sprite.width + this.spacing;\r\n      height = Math.max(height, sprite.height);\r\n    }\r\n    return BoundingBox.fromDimension(width * this.scale.x, height * lines.length * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number, maxWidth?: number): void {\r\n    let xCursor = 0;\r\n    let yCursor = 0;\r\n    let height = 0;\r\n    const lines = this._getLinesFromText(this._text, maxWidth);\r\n    for (const line of lines) {\r\n      for (const sprite of this._getCharacterSprites(line)) {\r\n        // draw it in the right spot and increase the cursor by sprite width\r\n        sprite.draw(ex, x + xCursor, y + yCursor);\r\n        xCursor += sprite.width + this.spacing;\r\n        height = Math.max(height, sprite.height);\r\n      }\r\n      xCursor = 0;\r\n      yCursor += this.lineHeight ?? height;\r\n    }\r\n  }\r\n\r\n  render(ex: ExcaliburGraphicsContext, text: string, _color: any, x: number, y: number, maxWidth?: number) {\r\n    // SpriteFont doesn't support _color, yet...\r\n    this._text = text;\r\n    const bounds = this.measureText(text, maxWidth);\r\n    this.width = bounds.width;\r\n    this.height = bounds.height;\r\n    if (this.shadow) {\r\n      ex.save();\r\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\r\n      this._preDraw(ex, x, y);\r\n      this._drawImage(ex, 0, 0, maxWidth);\r\n      this._postDraw(ex);\r\n      ex.restore();\r\n    }\r\n\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0, maxWidth);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  clone(): SpriteFont {\r\n    return new SpriteFont({\r\n      alphabet: this.alphabet,\r\n      spriteSheet: this.spriteSheet,\r\n      spacing: this.spacing\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Return array of lines split based on the \\n character, and the maxWidth? constraint\r\n   * @param text\r\n   * @param maxWidth\r\n   */\r\n  private _cachedText?: string;\r\n  private _cachedLines?: string[];\r\n  private _cachedRenderWidth?: number;\r\n  private _getLinesFromText(text: string, maxWidth?: number) {\r\n    if (this._cachedText === text && this._cachedRenderWidth === maxWidth && this._cachedLines?.length) {\r\n      return this._cachedLines;\r\n    }\r\n\r\n    const lines = text.split('\\n');\r\n\r\n    if (maxWidth == null) {\r\n      return lines;\r\n    }\r\n\r\n    // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\r\n    for (let i = 0; i < lines.length; i++) {\r\n      let line = lines[i];\r\n      let newLine = '';\r\n      // Note: we subtract the spacing to counter the initial padding on the left side.\r\n      if (this.measureText(line).width > maxWidth) {\r\n        while (this.measureText(line).width > maxWidth) {\r\n          newLine = line[line.length - 1] + newLine;\r\n          line = line.slice(0, -1); // Remove last character from line\r\n        }\r\n\r\n        // Update the array with our new values\r\n        lines[i] = line;\r\n        lines[i + 1] = newLine;\r\n      }\r\n    }\r\n\r\n    this._cachedText = text;\r\n    this._cachedLines = lines;\r\n    this._cachedRenderWidth = maxWidth;\r\n\r\n    return lines;\r\n  }\r\n}\r\n","import { Future } from '../Util/Future';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { ImageSource, ImageWrapConfiguration } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { ImageWrapping } from './Wrapping';\r\n\r\nexport interface TiledSpriteOptions {\r\n  image: ImageSource;\r\n  /**\r\n   * Source view into the {@link ImageSource image}\r\n   */\r\n  sourceView?: SourceView;\r\n  /**\r\n   * Optionally override {@link ImageFiltering filtering}\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Optionally override {@link ImageWrapping wrapping} , default wrapping is Repeat for TiledSprite\r\n   */\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  /**\r\n   * Total width in pixels for the tiling to take place over\r\n   */\r\n  width: number;\r\n  /**\r\n   * Total height in pixels for the tiling to take place over\r\n   */\r\n  height: number;\r\n}\r\n\r\nexport class TiledSprite extends Sprite {\r\n  private _ready = new Future<void>();\r\n  public ready = this._ready.promise;\r\n  private _options: TiledSpriteOptions & GraphicOptions;\r\n  constructor(options: TiledSpriteOptions & GraphicOptions) {\r\n    super({\r\n      image: options.image,\r\n      sourceView: options.sourceView,\r\n      destSize: { width: options.width, height: options.height },\r\n      flipHorizontal: options.flipHorizontal,\r\n      flipVertical: options.flipVertical,\r\n      rotation: options.rotation,\r\n      scale: options.scale,\r\n      opacity: options.opacity,\r\n      tint: options.tint,\r\n      origin: options.origin\r\n    });\r\n    this._options = options;\r\n\r\n    if (this.image.isLoaded()) {\r\n      this._applyTiling();\r\n    } else {\r\n      this.image.ready.then(() => this._applyTiling());\r\n    }\r\n  }\r\n\r\n  public static fromSprite(sprite: Sprite, options?: Partial<Omit<TiledSpriteOptions & GraphicOptions, 'image'>>): TiledSprite {\r\n    return new TiledSprite({\r\n      sourceView: { ...sprite.sourceView },\r\n      width: sprite.width,\r\n      height: sprite.height,\r\n      ...options,\r\n      image: sprite.image\r\n    });\r\n  }\r\n\r\n  private _applyTiling() {\r\n    const { width, height, filtering, wrapping } = { ...this._options };\r\n    const spriteCanvas = document.createElement('canvas')!;\r\n    spriteCanvas.width = this.sourceView.width;\r\n    spriteCanvas.height = this.sourceView.height;\r\n    const spriteCtx = spriteCanvas.getContext('2d')!;\r\n    // prettier-ignore\r\n    spriteCtx.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x, this.sourceView.y,\r\n        this.sourceView.width, this.sourceView.height,\r\n        0, 0,\r\n        this.sourceView.width, this.sourceView.height);\r\n\r\n    // prettier-ignore\r\n    const tiledImageSource = ImageSource.fromHtmlCanvasElement(spriteCanvas, {\r\n        wrapping: wrapping ?? ImageWrapping.Repeat,\r\n        filtering\r\n      });\r\n    if (width) {\r\n      this.destSize.width = width;\r\n      this.sourceView.width = width;\r\n    }\r\n    if (height) {\r\n      this.destSize.height = height;\r\n      this.sourceView.height = height;\r\n    }\r\n    this.sourceView.x = 0;\r\n    this.sourceView.y = 0;\r\n    this.image = tiledImageSource;\r\n    // this._ready.resolve();\r\n    this.image.ready.then(() => this._ready.resolve());\r\n  }\r\n}\r\n","import { ImageSource } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { TiledSprite, TiledSpriteOptions } from './TiledSprite';\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number; y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: { x?: number; y?: number };\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specify any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetSparseOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * List of source view rectangles to create a sprite sheet from\r\n   */\r\n  sourceViews: SourceView[];\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\nexport interface GetSpriteOptions extends GraphicOptions {}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use {@apilink SpriteSheet.fromImageSource} to create a SpriteSheet from an {@apilink ImageSource} organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y integer coordinates in the SpriteSheet, for example `getSprite(0, 0)` is the {@apilink Sprite} in the top-left\r\n   * and `getSprite(1, 0)` is the sprite one to the right.\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number, options?: GetSpriteOptions): Sprite {\r\n    if (x >= this.columns || x < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1} columns`);\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1} rows`);\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    const sprite = this.sprites[spriteIndex];\r\n    if (sprite) {\r\n      if (options) {\r\n        const spriteWithOptions = sprite.clone();\r\n        spriteWithOptions.flipHorizontal = options.flipHorizontal ?? spriteWithOptions.flipHorizontal;\r\n        spriteWithOptions.flipVertical = options.flipVertical ?? spriteWithOptions.flipVertical;\r\n        spriteWithOptions.width = options.width ?? spriteWithOptions.width;\r\n        spriteWithOptions.height = options.height ?? spriteWithOptions.height;\r\n        spriteWithOptions.rotation = options.rotation ?? spriteWithOptions.rotation;\r\n        spriteWithOptions.scale = options.scale ?? spriteWithOptions.scale;\r\n        spriteWithOptions.opacity = options.opacity ?? spriteWithOptions.opacity;\r\n        spriteWithOptions.tint = options.tint ?? spriteWithOptions.tint;\r\n        spriteWithOptions.origin = options.origin ?? spriteWithOptions.origin;\r\n        return spriteWithOptions;\r\n      }\r\n      return sprite;\r\n    }\r\n    throw Error(`Invalid sprite coordinates (${x}, ${y})`);\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y integer coordinates in the SpriteSheet and configures tiling to repeat by default,\r\n   * for example `getTiledSprite(0, 0)` is the {@apilink TiledSprite} in the top-left\r\n   * and `getTiledSprite(1, 0)` is the sprite one to the right.\r\n   *\r\n   * Example:\r\n   *\r\n   * ```typescript\r\n   * spriteSheet.getTiledSprite(1, 0, {\r\n   * width: game.screen.width,\r\n   * height: 200,\r\n   * wrapping: {\r\n   * x: ex.ImageWrapping.Repeat,\r\n   * y: ex.ImageWrapping.Clamp\r\n   * }\r\n   * });\r\n   * ```\r\n   * @param x\r\n   * @param y\r\n   * @param options\r\n   */\r\n  public getTiledSprite(x: number, y: number, options?: Partial<Omit<TiledSpriteOptions & GraphicOptions, 'image'>>): TiledSprite {\r\n    if (x >= this.columns || x < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1} columns`);\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1} rows`);\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    const sprite = this.sprites[spriteIndex];\r\n    if (sprite) {\r\n      return TiledSprite.fromSprite(sprite, options);\r\n    }\r\n    throw Error(`Invalid sprite coordinates (${x}, ${y})`);\r\n  }\r\n\r\n  /**\r\n   * Create a sprite sheet from a sparse set of {@apilink SourceView} rectangles\r\n   * @param options\r\n   */\r\n  public static fromImageSourceWithSourceViews(options: SpriteSheetSparseOptions): SpriteSheet {\r\n    const sprites: Sprite[] = options.sourceViews.map((sourceView) => {\r\n      return new Sprite({\r\n        image: options.image,\r\n        sourceView\r\n      });\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an {@apilink ImageSource} organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset };\r\n    const marginDefaults = { x: 0, y: 0, ...margin };\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n\r\n  public clone(): SpriteSheet {\r\n    return new SpriteSheet({\r\n      sprites: this.sprites.map((sprite) => sprite.clone()),\r\n      rows: this.rows,\r\n      columns: this.columns\r\n    });\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from '../Context/ExcaliburGraphicsContext';\r\nimport { ImageSource } from '../ImageSource';\r\nimport { SpriteFont } from '../SpriteFont';\r\nimport { SpriteSheet } from '../SpriteSheet';\r\nimport { Vector } from '../../Math/vector';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debug text helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    // We fire and forget, we don't care if it's loaded or not\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource!: ImageSource;\r\n  private _spriteSheet!: SpriteSheet;\r\n  private _spriteFont!: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 4,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+# ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","export class RenderSource {\r\n  constructor(\r\n    private _gl: WebGLRenderingContext,\r\n    private _texture: WebGLTexture\r\n  ) {}\r\n\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\r\n  }\r\n\r\n  public disable() {\r\n    const gl = this._gl;\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}\r\n","import { RenderSource } from './render-source';\r\n\r\ndeclare global {\r\n  interface WebGL2RenderingContext {\r\n    /**\r\n     * Experimental only in chrome\r\n     */\r\n    drawingBufferFormat?: number;\r\n  }\r\n}\r\n\r\nexport interface RenderTargetOptions {\r\n  gl: WebGL2RenderingContext;\r\n  width: number;\r\n  height: number;\r\n  transparency: boolean;\r\n  /**\r\n   * Optionally enable render buffer multisample anti-aliasing\r\n   *\r\n   * By default false\r\n   */\r\n  antialias?: boolean;\r\n  /**\r\n   * Optionally specify number of anti-aliasing samples to use\r\n   *\r\n   * By default the max for the platform is used if antialias is on.\r\n   */\r\n  samples?: number;\r\n}\r\n\r\nexport class RenderTarget {\r\n  width: number;\r\n  height: number;\r\n  transparency: boolean;\r\n  antialias: boolean = false;\r\n  samples: number = 1;\r\n  private _gl: WebGL2RenderingContext;\r\n  public readonly bufferFormat: number;\r\n  constructor(options: RenderTargetOptions) {\r\n    this._gl = options.gl;\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.transparency = options.transparency;\r\n    this.antialias = options.antialias ?? this.antialias;\r\n    this.samples = options.samples ?? this._gl.getParameter(this._gl.MAX_SAMPLES);\r\n\r\n    const gl = this._gl;\r\n    // Determine current context format for blitting later needs to match\r\n    if (gl.drawingBufferFormat) {\r\n      this.bufferFormat = gl.drawingBufferFormat;\r\n    } else {\r\n      // Documented in webgl spec\r\n      // https://registry.khronos.org/webgl/specs/latest/1.0/\r\n      if (this.transparency) {\r\n        this.bufferFormat = gl.RGBA8;\r\n      } else {\r\n        this.bufferFormat = gl.RGB8;\r\n      }\r\n    }\r\n\r\n    this._setupRenderBuffer();\r\n    this._setupFramebuffer();\r\n  }\r\n\r\n  setResolution(width: number, height: number) {\r\n    const gl = this._gl;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    // update backing texture size\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // update render buffer size\r\n    if (this._renderBuffer) {\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\r\n      gl.renderbufferStorageMultisample(\r\n        gl.RENDERBUFFER,\r\n        Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)),\r\n        this.bufferFormat,\r\n        this.width,\r\n        this.height\r\n      );\r\n    }\r\n  }\r\n\r\n  private _renderBuffer!: WebGLRenderbuffer;\r\n  public get renderBuffer() {\r\n    return this._renderBuffer;\r\n  }\r\n  private _renderFrameBuffer!: WebGLFramebuffer;\r\n  public get renderFrameBuffer() {\r\n    return this._renderFrameBuffer;\r\n  }\r\n\r\n  private _frameBuffer!: WebGLFramebuffer;\r\n  public get frameBuffer() {\r\n    return this._frameBuffer;\r\n  }\r\n  private _frameTexture!: WebGLTexture;\r\n  public get frameTexture() {\r\n    return this._frameTexture;\r\n  }\r\n\r\n  private _setupRenderBuffer() {\r\n    if (this.antialias) {\r\n      const gl = this._gl;\r\n      // Render buffers can be used as an input to a shader\r\n      this._renderBuffer = gl.createRenderbuffer()!;\r\n      this._renderFrameBuffer = gl.createFramebuffer()!;\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\r\n      gl.renderbufferStorageMultisample(\r\n        gl.RENDERBUFFER,\r\n        Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)),\r\n        this.bufferFormat,\r\n        this.width,\r\n        this.height\r\n      );\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\r\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, this._renderBuffer);\r\n    }\r\n  }\r\n\r\n  private _setupFramebuffer() {\r\n    // Allocates frame buffer\r\n    const gl = this._gl;\r\n    this._frameTexture = gl.createTexture()!;\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // set the filtering so we don't need mips\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // attach the texture as the first color attachment\r\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\r\n\r\n    // After this bind all draw calls will draw to this framebuffer texture\r\n    this._frameBuffer = gl.createFramebuffer()!;\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\r\n\r\n    // Reset after initialized\r\n    this.disable();\r\n  }\r\n\r\n  public toRenderSource() {\r\n    if (this.renderBuffer) {\r\n      this.blitRenderBufferToFrameBuffer();\r\n    }\r\n    const source = new RenderSource(this._gl, this._frameTexture);\r\n    return source;\r\n  }\r\n\r\n  public blitToScreen() {\r\n    const gl = this._gl;\r\n    // set to size of canvas's drawingBuffer\r\n    if (this._renderBuffer) {\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    } else {\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.frameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    }\r\n  }\r\n\r\n  public blitRenderBufferToFrameBuffer() {\r\n    if (this._renderBuffer) {\r\n      const gl = this._gl;\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, this.frameBuffer);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    }\r\n  }\r\n\r\n  public copyToTexture(texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    if (this._renderBuffer) {\r\n      this.blitRenderBufferToFrameBuffer();\r\n    }\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 0, 0, this.width, this.height, 0);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing gets redirected to this render target\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    if (this.antialias) {\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\r\n    } else {\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    }\r\n\r\n    // very important to set the viewport to the size of the framebuffer texture\r\n    gl.viewport(0, 0, this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing is sent back to the canvas\r\n   */\r\n  public disable() {\r\n    const gl = this._gl;\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}\r\n","/**\r\n * Return the size of the GlType in bytes\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.INT:\r\n    case gl.UNSIGNED_INT:\r\n    case gl.FLOAT:\r\n      return 4;\r\n    case gl.SHORT:\r\n      return 2;\r\n    case gl.UNSIGNED_SHORT:\r\n      return 2;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if an attribute is present in vertex source\r\n */\r\nexport function isAttributeInSource(source: string, variable: string) {\r\n  const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\r\n  const regex = new RegExp(attributeRegexTemplate, 'g');\r\n  const matches = regex.exec(source);\r\n  return matches?.length! > 0;\r\n}\r\n\r\n/**\r\n * Attempt to discern the glType of an attribute from vertex source\r\n * @param gl\r\n * @param source\r\n * @param variable\r\n */\r\nexport function getGLTypeFromSource(gl: WebGLRenderingContext, source: string, variable: string) {\r\n  const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\r\n  const regex = new RegExp(attributeRegexTemplate, 'g');\r\n  const matches = regex.exec(source);\r\n  const type = matches?.groups?.type;\r\n\r\n  switch (type) {\r\n    case 'float':\r\n    case 'vec2':\r\n    case 'vec3':\r\n    case 'vec4':\r\n      return gl.FLOAT;\r\n    case 'int':\r\n    case 'ivec2':\r\n    case 'ivec3':\r\n    case 'ivec4':\r\n      return gl.INT;\r\n    case 'uint':\r\n    case 'uvec2':\r\n    case 'uvec3':\r\n    case 'uvec4':\r\n      return gl.UNSIGNED_INT;\r\n    case 'bool':\r\n    case 'bvec2':\r\n    case 'bvec3':\r\n    case 'bvec4':\r\n      return gl.BOOL;\r\n    case 'short':\r\n      return gl.SHORT;\r\n    case 'ushort':\r\n      return gl.UNSIGNED_SHORT;\r\n    case 'ubyte':\r\n      return gl.UNSIGNED_BYTE;\r\n    case 'byte':\r\n      return gl.BYTE;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the type return the number of attribute components\r\n *\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n      return 1;\r\n    case gl.FLOAT_VEC2:\r\n      return 2;\r\n    case gl.FLOAT_VEC3:\r\n      return 3;\r\n    case gl.FLOAT_VEC4:\r\n      return 4;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_SHORT:\r\n    case gl.SHORT:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the attribute return the corresponding supported attrib pointer type\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n    case gl.FLOAT_VEC2:\r\n    case gl.FLOAT_VEC3:\r\n    case gl.FLOAT_VEC4:\r\n      return gl.FLOAT;\r\n    case gl.BYTE:\r\n      return gl.BYTE;\r\n    case gl.UNSIGNED_BYTE:\r\n      return gl.UNSIGNED_BYTE;\r\n    case gl.SHORT:\r\n      return gl.SHORT;\r\n    case gl.UNSIGNED_SHORT:\r\n      return gl.UNSIGNED_SHORT;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function getMaxShaderComplexity(gl: WebGL2RenderingContext, numIfs: number): number {\r\n  const assembleTestShader = (numIfs: number) => {\r\n    const testShader = `#version 300 es\r\n    precision mediump float;\r\n    out vec4 fragColor;\r\n    void main() {\r\n      float index = 1.01;\r\n      %%complexity%%\r\n    }`;\r\n    let testComplexity = '';\r\n    for (let i = 0; i < numIfs; i++) {\r\n      if (i === 0) {\r\n        testComplexity += `if (index <= ${i}.5) {\\n`;\r\n      } else {\r\n        testComplexity += `   else if (index <= ${i}.5) {\\n`;\r\n      }\r\n\r\n      testComplexity += `      fragColor = vec4(1.0);\\n`;\r\n      testComplexity += `   }\\n`;\r\n    }\r\n    return testShader.replace('%%complexity%%', testComplexity);\r\n  };\r\n\r\n  let canCompile = false;\r\n  do {\r\n    const test = assembleTestShader(numIfs);\r\n\r\n    const shader = gl.createShader(gl.FRAGMENT_SHADER)!;\r\n    gl.shaderSource(shader, test);\r\n    gl.compileShader(shader);\r\n\r\n    canCompile = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!canCompile) {\r\n      numIfs = (numIfs / 2) | 0;\r\n    }\r\n  } while (!canCompile);\r\n  return numIfs;\r\n}\r\n","import { AffineMatrix, Color, Logger, Vector } from '../..';\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\r\n\r\n/**\r\n * List of the possible glsl uniform types\r\n */\r\nexport type UniformTypeNames =\r\n  | 'uniform1f'\r\n  | 'uniform1i'\r\n  | 'uniform2f'\r\n  | 'uniform2i'\r\n  | 'uniform3f'\r\n  | 'uniform3i'\r\n  | 'uniform4f'\r\n  | 'uniform4i'\r\n  | 'uniform1fv'\r\n  | 'uniform1iv'\r\n  | 'uniform2fv'\r\n  | 'uniform2iv'\r\n  | 'uniform3fv'\r\n  | 'uniform3iv'\r\n  | 'uniform4fv'\r\n  | 'uniform4iv'\r\n  | 'uniformMatrix2fv'\r\n  | 'uniformMatrix3fv'\r\n  | 'uniformMatrix4fv';\r\n\r\ntype RemoveFirstFromTuple<T extends any[]> = T['length'] extends 0\r\n  ? []\r\n  : ((...b: T) => void) extends (a: any, ...b: infer I) => void\r\n    ? I\r\n    : [];\r\n\r\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>;\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  glType: number;\r\n  location: WebGLUniformLocation;\r\n}\r\n\r\nexport interface VertexAttributeDefinition {\r\n  /**\r\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\r\n   */\r\n  name: string;\r\n  /**\r\n   * Number of components for a given attribute\r\n   * Must be 1, 2, 3, or 4\r\n   *\r\n   * For example a vec4 attribute would be `4` floats, so 4\r\n   */\r\n  size: number;\r\n  /**\r\n   * Supported types in webgl 1\r\n   * * gl.BYTE\r\n   * * gl.SHORT\r\n   * * gl.UNSIGNED_BYTE\r\n   * * gl.UNSIGNED_SHORT\r\n   * * gl.FLOAT\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n   */\r\n  glType: number;\r\n  /**\r\n   * Is the attribute normalized between (0-1)\r\n   */\r\n  normalized: boolean;\r\n  /**\r\n   * Location index in the shader program\r\n   */\r\n  location: number;\r\n}\r\n\r\nexport interface ShaderOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across webgl contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Vertex shader source code in glsl #version 300 es\r\n   */\r\n  vertexSource: string;\r\n  /**\r\n   * Fragment shader source code in glsl #version 300 es\r\n   */\r\n  fragmentSource: string;\r\n\r\n  onPreLink?: (program: WebGLProgram) => void;\r\n  onPostCompile?: (shader: Shader) => void;\r\n}\r\n\r\nexport class Shader {\r\n  private static _ACTIVE_SHADER_INSTANCE: Shader | null = null;\r\n  private _logger = Logger.getInstance();\r\n  private _gl: WebGL2RenderingContext;\r\n  public program!: WebGLProgram;\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  private _compiled = false;\r\n  public readonly vertexSource: string;\r\n  public readonly fragmentSource: string;\r\n  private _onPreLink?: (program: WebGLProgram) => void;\r\n  private _onPostCompile?: (shader: Shader) => void;\r\n\r\n  public get compiled() {\r\n    return this._compiled;\r\n  }\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param options specify shader vertex and fragment source\r\n   */\r\n  constructor(options: ShaderOptions) {\r\n    const { gl, vertexSource, fragmentSource, onPreLink, onPostCompile } = options;\r\n    this._gl = gl;\r\n    this.vertexSource = vertexSource;\r\n    this.fragmentSource = fragmentSource;\r\n    this._onPreLink = onPreLink;\r\n    this._onPostCompile = onPostCompile;\r\n  }\r\n\r\n  dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteProgram(this.program);\r\n    this._gl = null as any;\r\n  }\r\n\r\n  /**\r\n   * Binds the shader program\r\n   */\r\n  use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    Shader._ACTIVE_SHADER_INSTANCE = this;\r\n  }\r\n\r\n  isCurrentlyBound() {\r\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   */\r\n  compile(): WebGLProgram {\r\n    const gl = this._gl;\r\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\r\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\r\n\r\n    const attributes = this.getAttributes();\r\n    for (const attribute of attributes) {\r\n      this.attributes[attribute.name] = attribute;\r\n    }\r\n    const uniforms = this.getUniforms();\r\n    for (const uniform of uniforms) {\r\n      this.uniforms[uniform.name] = uniform;\r\n    }\r\n\r\n    this._compiled = true;\r\n    if (this._onPostCompile) {\r\n      this._onPostCompile(this);\r\n    }\r\n    return this.program;\r\n  }\r\n\r\n  getUniforms(): UniformDefinition[] {\r\n    const gl = this._gl;\r\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\r\n    const uniforms: UniformDefinition[] = [];\r\n    for (let i = 0; i < uniformCount; i++) {\r\n      const uniform = gl.getActiveUniform(this.program, i)!;\r\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name)!;\r\n      uniforms.push({\r\n        name: uniform.name,\r\n        glType: uniform.type,\r\n        location: uniformLocation\r\n      });\r\n    }\r\n    return uniforms;\r\n  }\r\n\r\n  getAttributes(): VertexAttributeDefinition[] {\r\n    const gl = this._gl;\r\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\r\n    const attributes: VertexAttributeDefinition[] = [];\r\n    for (let i = 0; i < attributeCount; i++) {\r\n      const attribute = gl.getActiveAttrib(this.program, i)!;\r\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\r\n      attributes.push({\r\n        name: attribute.name,\r\n        glType: getAttributePointerType(gl, attribute.type),\r\n        size: getAttributeComponentSize(gl, attribute.type),\r\n        location: attributeLocation,\r\n        normalized: false\r\n      });\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  /**\r\n   * Set a texture in a gpu texture slot\r\n   * @param slotNumber\r\n   * @param texture\r\n   */\r\n  setTexture(slotNumber: number, texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformInt(name: string, value: number) {\r\n    this.setUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformInt(name: string, value: number): boolean {\r\n    return this.trySetUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformIntArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformIntArray(name: string, value: number[]): boolean {\r\n    return this.trySetUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformBoolean(name: string, value: boolean) {\r\n    this.setUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformBoolean(name: string, value: boolean): boolean {\r\n    return this.trySetUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloat(name: string, value: number) {\r\n    this.setUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloat(name: string, value: number): boolean {\r\n    return this.trySetUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1fv', name, value);\r\n  }\r\n  /**\r\n   * Set a float array uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatArray(name: string, value: number[]): boolean {\r\n    return this.trySetUniform('uniform1fv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Vector} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatVector(name: string, value: Vector) {\r\n    this.setUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Vector} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatVector(name: string, value: Vector): boolean {\r\n    return this.trySetUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Color} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatColor(name: string, value: Color) {\r\n    this.setUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Color} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatColor(name: string, value: Color): boolean {\r\n    return this.trySetUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\r\n  }\r\n\r\n  /**\r\n   * Set an {@apilink Matrix} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformMatrix(name: string, value: Matrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  setUniformAffineMatrix(name: string, value: AffineMatrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, [\r\n      value.data[0],\r\n      value.data[1],\r\n      0,\r\n      0,\r\n\r\n      value.data[2],\r\n      value.data[3],\r\n      0,\r\n      0,\r\n\r\n      0,\r\n      0,\r\n      1,\r\n      0,\r\n\r\n      value.data[4],\r\n      value.data[5],\r\n      0,\r\n      1\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Set an {@apilink Matrix} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformMatrix(name: string, value: Matrix): boolean {\r\n    return this.trySetUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   */\r\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\r\n    if (!this._compiled) {\r\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      throw Error(\r\n        'Currently accessed shader instance is not the current active shader in WebGL,' +\r\n          ' must call `shader.use()` before setting uniforms'\r\n      );\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      (this._gl as any)[uniformType].apply(this._gl, args);\r\n    } else {\r\n      throw Error(\r\n        `Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,` +\r\n          ' unused uniforms are optimized away by most browsers'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl. Will try to set the uniform, will return false if the uniform didn't exist,\r\n   * true if it was set.\r\n   *\r\n   * WILL NOT THROW on error\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   *\r\n   */\r\n  trySetUniform<TUniformType extends UniformTypeNames>(\r\n    uniformType: TUniformType,\r\n    name: string,\r\n    ...value: UniformParameters<TUniformType>\r\n  ): boolean {\r\n    if (!this._compiled) {\r\n      this._logger.warn(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n      return false;\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      this._logger.warn(\r\n        'Currently accessed shader instance is not the current active shader in WebGL,' +\r\n          ' must call `shader.use()` before setting uniforms'\r\n      );\r\n      return false;\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      (this._gl as any)[uniformType].apply(this._gl, args);\r\n    } else {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    if (this._onPreLink) {\r\n      this._onPreLink(program);\r\n    }\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      const errorInfo = gl.getShaderInfoLog(shader);\r\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo!)}`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  private _processSourceForError(source: string, errorInfo: string) {\r\n    if (!source) {\r\n      return errorInfo;\r\n    }\r\n    const lines = source.split('\\n');\r\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\r\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\r\n    const [_, error2] = errorInfo\r\n      .slice(errorLineStart, errorLineEnd)\r\n      .split(':')\r\n      .map((v) => Number(v));\r\n    for (let i = 0; i < lines.length; i++) {\r\n      lines[i] = `${i + 1}: ${lines[i]}${error2 === i + 1 ? ' <----- ERROR!' : ''}`;\r\n    }\r\n\r\n    return '\\n\\nSource:\\n' + lines.join('\\n');\r\n  }\r\n}\r\n","export interface VertexBufferOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\r\n   *\r\n   * Ignored if data is passed directly\r\n   */\r\n  size?: number;\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  type?: 'static' | 'dynamic';\r\n\r\n  /**\r\n   * Optionally pass pre-seeded data, size parameter is ignored\r\n   */\r\n  data?: Float32Array;\r\n}\r\n\r\n/**\r\n * Helper around vertex buffer to simplify creating and uploading geometry\r\n *\r\n * Under the hood uses Float32Array\r\n */\r\nexport class VertexBuffer {\r\n  private _gl: WebGL2RenderingContext;\r\n\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public readonly buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the vertex buffer\r\n   */\r\n  public readonly bufferData: Float32Array;\r\n\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  public type: 'static' | 'dynamic' = 'dynamic';\r\n\r\n  constructor(options: VertexBufferOptions) {\r\n    const { gl, size, type, data } = options;\r\n    this._gl = gl;\r\n    this.buffer = this._gl.createBuffer()!;\r\n    if (!data && !size) {\r\n      throw Error('Must either provide data or a size to the VertexBuffer');\r\n    }\r\n\r\n    if (!data) {\r\n      this.bufferData = new Float32Array(size!);\r\n    } else {\r\n      this.bufferData = data;\r\n    }\r\n    this.type = type ?? this.type;\r\n    // Allocate buffer\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this vertex buffer\r\n   */\r\n  bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n  }\r\n\r\n  unbind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n  }\r\n\r\n  /**\r\n   * Upload vertex buffer geometry to the GPU\r\n   */\r\n  upload(count?: number) {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    if (count) {\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.bufferData, 0, count);\r\n    } else {\r\n      // TODO always use bufferSubData? need to perf test it\r\n      gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteBuffer(this.buffer);\r\n    this._gl = null as any;\r\n  }\r\n}\r\n","import { Logger } from '../..';\r\nimport { Shader, VertexAttributeDefinition } from './shader';\r\nimport { VertexBuffer } from './vertex-buffer';\r\nimport { getGLTypeFromSource, getGlTypeSizeBytes, isAttributeInSource } from './webgl-util';\r\n\r\nexport interface VertexLayoutOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Shader that this layout will be for, if null you must set a shader before using it.\r\n   */\r\n  shader?: Shader;\r\n  /**\r\n   * Vertex buffer to use for vertex data\r\n   */\r\n  vertexBuffer: VertexBuffer;\r\n  /**\r\n   * Starting index for the attribute pointer\r\n   */\r\n  attributePointerStartIndex?: number;\r\n  /**\r\n   * Specify the attributes that will exist in the vertex buffer\r\n   *\r\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\r\n   */\r\n  attributes: [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][];\r\n  /**\r\n   * Optionally suppress any warnings out of vertex layouts\r\n   *\r\n   * **BEWARE** this may cause you to have issues go unnoticed\r\n   */\r\n  suppressWarnings?: boolean;\r\n}\r\n\r\n/**\r\n * Helper around creating vertex attributes in a given {@apilink VertexBuffer}, this is useful for describing\r\n * the memory layout for your vertices inside a particular buffer\r\n *\r\n * Note: This helper assumes interleaved attributes in one {@apilink VertexBuffer}, not many.\r\n *\r\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\r\n */\r\nexport class VertexLayout {\r\n  private _gl: WebGL2RenderingContext;\r\n  private _logger = Logger.getInstance();\r\n  private _suppressWarnings = false;\r\n  private _shader: Shader;\r\n  private _layout: VertexAttributeDefinition[] = [];\r\n  private _attributes: [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][] = [];\r\n  private _vertexBuffer: VertexBuffer;\r\n  private _vao!: WebGLVertexArrayObject;\r\n\r\n  public get vertexBuffer() {\r\n    return this._vertexBuffer;\r\n  }\r\n\r\n  public get attributes(): readonly [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][] {\r\n    return this._attributes;\r\n  }\r\n\r\n  constructor(options: VertexLayoutOptions) {\r\n    const { gl, shader, vertexBuffer, attributes, suppressWarnings } = options;\r\n    this._gl = gl;\r\n    this._vertexBuffer = vertexBuffer;\r\n    this._attributes = attributes;\r\n    this._shader = shader!;\r\n    this._suppressWarnings = suppressWarnings!;\r\n    if (shader) {\r\n      this.initialize();\r\n    }\r\n  }\r\n\r\n  private _vertexTotalSizeBytes = 0;\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    return this._vertexTotalSizeBytes;\r\n  }\r\n\r\n  public set shader(shader: Shader) {\r\n    if (shader && this._shader !== shader) {\r\n      this._shader = shader;\r\n      this.initialize();\r\n    }\r\n  }\r\n\r\n  public get shader() {\r\n    return this._shader;\r\n  }\r\n\r\n  private _initialized = false;\r\n\r\n  /**\r\n   * Layouts need shader locations and must be bound to a shader\r\n   */\r\n  initialize() {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n    if (!this._shader) {\r\n      return;\r\n    }\r\n\r\n    if (!this._shader.compiled) {\r\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\r\n    }\r\n    this._vertexTotalSizeBytes = 0;\r\n    this._layout.length = 0;\r\n    const shaderAttributes = this._shader.attributes;\r\n    for (const attribute of this._attributes) {\r\n      const attrib = shaderAttributes[attribute[0]];\r\n      if (!attrib) {\r\n        if (!isAttributeInSource(this._shader.vertexSource, attribute[0])) {\r\n          throw Error(\r\n            `The attribute named: ${attribute[0]} size ${attribute[1]}` +\r\n              ` not found in the shader source code:\\n ${this._shader.vertexSource}`\r\n          );\r\n        }\r\n\r\n        if (!this._suppressWarnings) {\r\n          this._logger.warn(\r\n            `The attribute named: ${attribute[0]} size ${attribute[1]}` +\r\n              ` not found in the compiled shader. This is possibly a bug:\\n` +\r\n              ` 1. Not a bug, but should remove unused code - attribute \"${attribute[0]}\" is unused in` +\r\n              ` vertex/fragment and has been automatically removed by glsl compiler.\\n` +\r\n              ` 2. Definitely a bug, attribute \"${attribute[0]}\" in layout has been mistyped or is missing` +\r\n              ` in shader, check vertex/fragment source.`\r\n          );\r\n        }\r\n\r\n        const glType = getGLTypeFromSource(this._gl, this._shader.vertexSource, attribute[0]);\r\n\r\n        // Unused attribute placeholder\r\n        this._layout.push({\r\n          name: attribute[0],\r\n          glType,\r\n          size: attribute[1],\r\n          location: -1,\r\n          normalized: false\r\n        });\r\n      }\r\n      if (attrib) {\r\n        if (attrib.size !== attribute[1]) {\r\n          throw Error(\r\n            `VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],` +\r\n              ` doesn\\'t match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`\r\n          );\r\n        }\r\n        this._layout.push(attrib);\r\n      }\r\n    }\r\n\r\n    // calc size\r\n    let componentsPerVertex = 0;\r\n    for (const vertAttribute of this._layout) {\r\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\r\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\r\n      componentsPerVertex += vertAttribute.size;\r\n    }\r\n\r\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\r\n      this._logger.warn(\r\n        `The vertex component size (${componentsPerVertex})  does NOT divide evenly into the specified vertex buffer` +\r\n          ` (${this._vertexBuffer.bufferData.length})`\r\n      );\r\n    }\r\n\r\n    // create VAO\r\n    const gl = this._gl;\r\n    this._vao = gl.createVertexArray()!;\r\n    gl.bindVertexArray(this._vao);\r\n    this._vertexBuffer.bind();\r\n\r\n    let offset = 0;\r\n    for (const vert of this._layout) {\r\n      // skip unused attributes\r\n      if (vert.location !== -1) {\r\n        if (vert.glType === gl.INT) {\r\n          gl.vertexAttribIPointer(vert.location, vert.size, vert.glType, this.totalVertexSizeBytes, offset);\r\n        } else {\r\n          gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n        }\r\n        gl.enableVertexAttribArray(vert.location);\r\n      }\r\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\r\n    }\r\n    gl.bindVertexArray(null);\r\n    this._vertexBuffer.unbind();\r\n\r\n    this._initialized = true;\r\n  }\r\n\r\n  /**\r\n   * Bind this layout with it's associated vertex buffer\r\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\r\n   */\r\n  use(uploadBuffer = false, count?: number) {\r\n    if (!this._shader) {\r\n      throw Error('No shader is associated with this vertex layout, a shader must be set');\r\n    }\r\n\r\n    const gl = this._gl;\r\n    if (!this._shader.isCurrentlyBound()) {\r\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\r\n    }\r\n    this._vertexBuffer.bind();\r\n    if (uploadBuffer) {\r\n      this._vertexBuffer.upload(count);\r\n    }\r\n    gl.bindVertexArray(this._vao);\r\n  }\r\n}\r\n","export class GraphicsDiagnostics {\n  public static DrawCallCount: number = 0;\n  public static DrawnImagesCount: number = 0;\n  public static clear(): void {\n    GraphicsDiagnostics.DrawCallCount = 0;\n    GraphicsDiagnostics.DrawnImagesCount = 0;\n  }\n}\n","import { vec, Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport lineVertexSource from './line-vertex.glsl';\r\nimport lineFragmentSource from './line-fragment.glsl';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport interface LineOptions {\r\n  color?: Color;\r\n  width?: number;\r\n}\r\n\r\nexport class LineRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.line';\r\n  public priority: number = 0;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _shader!: Shader;\r\n  private _maxLines: number = 10922;\r\n  private _vertexBuffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _vertexIndex = 0;\r\n  private _lineCount = 0;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: lineVertexSource,\r\n      fragmentSource: lineFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    this._vertexBuffer = new VertexBuffer({\r\n      gl,\r\n      size: 6 * 2 * this._maxLines,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      vertexBuffer: this._vertexBuffer,\r\n      shader: this._shader,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4]\r\n      ]\r\n    });\r\n  }\r\n\r\n  public dispose() {\r\n    this._vertexBuffer.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _startScratch = vec(0, 0);\r\n  private _endScratch = vec(0, 0);\r\n  draw(start: Vector, end: Vector, color: Color): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._lineCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const finalStart = transform.multiply(start, this._startScratch);\r\n    const finalEnd = transform.multiply(end, this._endScratch);\r\n\r\n    const vertexBuffer = this._vertexBuffer.bufferData;\r\n    // Start\r\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\r\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n\r\n    // End\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._lineCount >= this._maxLines) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._lineCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._lineCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // reset\r\n    this._vertexIndex = 0;\r\n    this._lineCount = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\n\\r\\nout lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Color\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  fragColor = v_color;\\r\\n}\";","import pointVertexSource from './point-vertex.glsl';\r\nimport pointFragmentSource from './point-fragment.glsl';\r\nimport { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class PointRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.point';\r\n  public priority: number = 0;\r\n  private _shader!: Shader;\r\n  private _maxPoints: number = 10922;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _pointCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: pointVertexSource,\r\n      fragmentSource: pointFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 7 * this._maxPoints,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4],\r\n        ['a_size', 1]\r\n      ]\r\n    });\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  draw(point: Vector, color: Color, size: number): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._pointCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const finalPoint = transform.multiply(point);\r\n\r\n    if (snapToPixel) {\r\n      finalPoint.x = ~~(finalPoint.x + pixelSnapEpsilon);\r\n      finalPoint.y = ~~(finalPoint.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    const vertexBuffer = this._buffer.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\r\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._pointCount >= this._maxPoints) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._pointCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._pointCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    this._pointCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\nin float a_size;\\r\\nout lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n  // \\\"premultiply\\\" the color by alpha\\r\\n  vec4 color = v_color;\\r\\n  color.a = color.a * alpha;\\r\\n  color.rgb = color.rgb * color.a;\\r\\n  fragColor = color;\\r\\n}\";","import screenVertex from './screen-vertex.glsl';\r\nimport screenFragment from './screen-fragment.glsl';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\r\n\r\n/**\r\n * This is responsible for painting the entire screen during the render passes\r\n */\r\nexport class ScreenPassPainter {\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGL2RenderingContext) {\r\n    this._gl = gl;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: screenVertex,\r\n      fragmentSource: screenFragment\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\r\n\r\n        1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\r\n    const gl = this._gl;\r\n    const shader = postprocessor.getShader();\r\n    shader.use();\r\n    postprocessor.getLayout().use();\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    shader.trySetUniformInt('u_image', 0);\r\n    if (postprocessor.onDraw) {\r\n      postprocessor.onDraw();\r\n    }\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n\r\n  renderToScreen(): void {\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n  // Pass the texcoord to the fragment shader.\\r\\n  v_texcoord = a_texcoord;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// The texture.\\r\\nuniform sampler2D u_texture;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n   fragColor = texture(u_texture, v_texcoord);\\r\\n}\";","import { Logger } from '../..';\r\n\r\n/**\r\n * Helper that defines and index buffer for quad geometry\r\n *\r\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\r\n * it is almost always worth it in terms of performance to use an index buffer.\r\n */\r\nexport class QuadIndexBuffer {\r\n  private _gl: WebGL2RenderingContext;\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the index buffer\r\n   */\r\n  public bufferData: Uint16Array | Uint32Array;\r\n  /**\r\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\r\n   */\r\n  public bufferGlType!: number;\r\n\r\n  /**\r\n   * @param gl WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   * @param numberOfQuads Specify the max number of quads you want to draw\r\n   * @param useUint16 Optionally force a uint16 buffer\r\n   */\r\n  constructor(gl: WebGL2RenderingContext, numberOfQuads: number, useUint16?: boolean) {\r\n    this._gl = gl;\r\n    this.buffer = gl.createBuffer()!;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n\r\n    const totalVertices = numberOfQuads * 6;\r\n\r\n    if (!useUint16) {\r\n      this.bufferData = new Uint32Array(totalVertices);\r\n    } else {\r\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\r\n      const maxUint16 = 65_535;\r\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\r\n\r\n      this.bufferGlType = gl.UNSIGNED_SHORT;\r\n      this.bufferData = new Uint16Array(totalVertices);\r\n      // TODO Should we error if this happens?? maybe not might crash mid game\r\n      if (numberOfQuads > maxUint16Index) {\r\n        this._logger.warn(\r\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`\r\n        );\r\n      }\r\n    }\r\n\r\n    let currentQuad = 0;\r\n    for (let i = 0; i < totalVertices; i += 6) {\r\n      // first triangle\r\n      this.bufferData[i + 0] = currentQuad + 0;\r\n      this.bufferData[i + 1] = currentQuad + 1;\r\n      this.bufferData[i + 2] = currentQuad + 2;\r\n      // second triangle\r\n      this.bufferData[i + 3] = currentQuad + 2;\r\n      this.bufferData[i + 4] = currentQuad + 1;\r\n      this.bufferData[i + 5] = currentQuad + 3;\r\n      currentQuad += 4;\r\n    }\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  public get size() {\r\n    return this.bufferData.length;\r\n  }\r\n\r\n  /**\r\n   * Upload data to the GPU\r\n   */\r\n  public upload() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this index buffer\r\n   */\r\n  public bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n  }\r\n\r\n  public dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteBuffer(this.buffer);\r\n    this._gl = null as any;\r\n  }\r\n}\r\n","import { Color } from '../../../Color';\r\nimport { sign } from '../../../Math/util';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { getMaxShaderComplexity } from '../webgl-util';\r\nimport frag from './image-renderer.frag.glsl';\r\nimport vert from './image-renderer.vert.glsl';\r\n\r\nexport interface ImageRendererOptions {\r\n  pixelArtSampler: boolean;\r\n  uvPadding: number;\r\n}\r\n\r\nexport class ImageRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.image';\r\n  public priority: number = 0;\r\n\r\n  public readonly pixelArtSampler: boolean;\r\n  public readonly uvPadding: number;\r\n\r\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _shader!: Shader;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _textureIndex = 0;\r\n  private _textureToIndex = new Map<WebGLTexture, number>();\r\n  private _images = new Set<HTMLImageSource>();\r\n  private _vertexIndex: number = 0;\r\n\r\n  constructor(options: ImageRendererOptions) {\r\n    this.pixelArtSampler = options.pixelArtSampler;\r\n    this.uvPadding = options.uvPadding;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\r\n    const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\r\n    this._maxTextures = Math.min(maxTexture, maxComplexity);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 12 * 4 * this._maxImages, // 12 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_opacity', 1],\r\n        ['a_res', 2],\r\n        ['a_texcoord', 2],\r\n        ['a_textureIndex', 1],\r\n        ['a_tint', 4]\r\n      ]\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(gl, this._maxImages, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;\\n`;\r\n      texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    if (this._images.has(image)) {\r\n      return;\r\n    }\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n      this._textureToIndex.set(texture, this._textureIndex++);\r\n      this._images.add(image);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this._maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      const maybeTexture = this._context.textureLoader.get(image);\r\n      return this._textureToIndex.get(maybeTexture) ?? -1; //this._textures.indexOf(maybeTexture);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  private _view = [0, 0, 0, 0];\r\n  private _dest = [0, 0];\r\n  private _quad = [0, 0, 0, 0, 0, 0, 0, 0];\r\n  private _defaultTint = Color.White;\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    // This creates and uploads the texture if not already done\r\n    this._addImageAsTexture(image);\r\n    const maybeImageWidth = this._getImageWidth(image);\r\n    const maybeImageHeight = this._getImageHeight(image);\r\n\r\n    let width = maybeImageWidth || swidth || 0;\r\n    let height = maybeImageHeight || sheight || 0;\r\n    this._view[0] = 0;\r\n    this._view[1] = 0;\r\n    this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n    this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n    this._dest[0] = sx ?? 1;\r\n    this._dest[1] = sy ?? 1;\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this._view[0] = sx ?? 1;\r\n      this._view[1] = sy ?? 1;\r\n      this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n      this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n      this._dest[0] = dx;\r\n      this._dest[1] = dy;\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = this._view[0];\r\n    sy = this._view[1];\r\n    const sw = this._view[2];\r\n    const sh = this._view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    // top left\r\n    this._quad[0] = this._dest[0];\r\n    this._quad[1] = this._dest[1];\r\n\r\n    // top right\r\n    this._quad[2] = this._dest[0] + width;\r\n    this._quad[3] = this._dest[1];\r\n\r\n    // bottom left\r\n    this._quad[4] = this._dest[0];\r\n    this._quad[5] = this._dest[1] + height;\r\n\r\n    // bottom right\r\n    this._quad[6] = this._dest[0] + width;\r\n    this._quad[7] = this._dest[1] + height;\r\n\r\n    transform.multiplyQuadInPlace(this._quad);\r\n\r\n    if (snapToPixel) {\r\n      this._quad[0] = ~~(this._quad[0] + sign(this._quad[0]) * pixelSnapEpsilon);\r\n      this._quad[1] = ~~(this._quad[1] + sign(this._quad[1]) * pixelSnapEpsilon);\r\n\r\n      this._quad[2] = ~~(this._quad[2] + sign(this._quad[2]) * pixelSnapEpsilon);\r\n      this._quad[3] = ~~(this._quad[3] + sign(this._quad[3]) * pixelSnapEpsilon);\r\n\r\n      this._quad[4] = ~~(this._quad[4] + sign(this._quad[4]) * pixelSnapEpsilon);\r\n      this._quad[5] = ~~(this._quad[5] + sign(this._quad[5]) * pixelSnapEpsilon);\r\n\r\n      this._quad[6] = ~~(this._quad[6] + sign(this._quad[6]) * pixelSnapEpsilon);\r\n      this._quad[7] = ~~(this._quad[7] + sign(this._quad[7]) * pixelSnapEpsilon);\r\n    }\r\n\r\n    const tint = this._context.tint || this._defaultTint;\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const imageWidth = maybeImageWidth || width;\r\n    const imageHeight = maybeImageHeight || height;\r\n\r\n    const uvx0 = (sx + this.uvPadding) / imageWidth;\r\n    const uvy0 = (sy + this.uvPadding) / imageHeight;\r\n    const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\r\n    const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\r\n\r\n    const txWidth = maybeImageWidth;\r\n    const txHeight = maybeImageHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = this._quad[0];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = this._quad[4];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[5];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = this._quad[2];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[3];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = this._quad[6];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[7];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true, 4 * 12 * this._imageCount); // 4 verts * 12 components\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Turn on pixel art aa sampler\r\n    this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n    this._textureIndex = 0;\r\n    this._textureToIndex.clear();\r\n    this._images.clear();\r\n    this._imageToWidth.clear();\r\n    this._imageToHeight.clear();\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nin lowp float v_textureIndex;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nuniform bool u_pixelart;\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nin vec4 v_tint;\\r\\n\\r\\nin vec2 v_res;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\r\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\r\\n  vec2 pixel = uv * texture_size;\\r\\n  \\r\\n  vec2 seam=floor(pixel+.5);\\r\\n  vec2 dudv=fwidth(pixel);\\r\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\r\\n  \\r\\n  return pixel/texture_size;\\r\\n}\\r\\n\\r\\nvoid main(){\\r\\n  // In order to support the most efficient sprite batching, we have multiple\\r\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n  // that do not apply to a particular sprite.\\r\\n  \\r\\n  vec4 color=vec4(1.,0,0,1.);\\r\\n  \\r\\n  // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n  %%texture_picker%%\\r\\n  \\r\\n  color.rgb=color.rgb*v_opacity;\\r\\n  color.a=color.a*v_opacity;\\r\\n  fragColor=color*v_tint;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// Opacity\\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\n// Texture res\\r\\nin vec2 a_res;\\r\\nout vec2 v_res;\\r\\n\\r\\n// Texture number\\r\\nin lowp float a_textureIndex;\\r\\nout lowp float v_textureIndex;\\r\\n\\r\\nin vec4 a_tint;\\r\\nout vec4 v_tint;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main(){\\r\\n  // Set the vertex position using the ortho transform matrix\\r\\n  gl_Position=u_matrix*vec4(a_position,0.,1.);\\r\\n  \\r\\n  // Pass through the Opacity to the fragment shader\\r\\n  v_opacity=a_opacity;\\r\\n  // Pass through the UV coord to the fragment shader\\r\\n  v_texcoord=a_texcoord;\\r\\n\\r\\n  v_res = a_res;\\r\\n\\r\\n  // Pass through the texture number to the fragment shader\\r\\n  v_textureIndex=a_textureIndex;\\r\\n  // Pass through the tint\\r\\n  v_tint=a_tint;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './rectangle-renderer.frag.glsl';\r\nimport vert from './rectangle-renderer.vert.glsl';\r\n\r\nexport class RectangleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.rectangle';\r\n  public priority: number = 0;\r\n\r\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader!: Shader;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n  private _rectangleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 16 * 4 * this._maxRectangles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_size', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n    this._quads = new QuadIndexBuffer(gl, this._maxRectangles, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._rectangleCount >= this._maxRectangles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(...args: any[]): void {\r\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\r\n      this.drawLine.apply(this, args as any);\r\n    } else {\r\n      this.drawRectangle.apply(this, args as any);\r\n    }\r\n  }\r\n\r\n  private _transparent = Color.Transparent;\r\n  private _scratch1 = vec(0, 0);\r\n  private _scratch2 = vec(0, 0);\r\n  private _scratch3 = vec(0, 0);\r\n  private _scratch4 = vec(0, 0);\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const dir = end.sub(start);\r\n    const length = dir.magnitude;\r\n    const normal = dir.normalize().perpendicular();\r\n    const halfThick = thickness / 2;\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startX, startY)------------------>(endX, endY)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n    const startTop = transform.multiply(normal.scale(halfThick, this._scratch1).add(start, this._scratch1), this._scratch1);\r\n    const startBottom = transform.multiply(normal.scale(-halfThick, this._scratch2).add(start, this._scratch2), this._scratch2);\r\n    const endTop = transform.multiply(normal.scale(halfThick, this._scratch3).add(end, this._scratch3), this._scratch3);\r\n    const endBottom = transform.multiply(normal.scale(-halfThick, this._scratch4).add(end, this._scratch4), this._scratch4);\r\n\r\n    if (snapToPixel) {\r\n      startTop.x = ~~(startTop.x + pixelSnapEpsilon);\r\n      startTop.y = ~~(startTop.y + pixelSnapEpsilon);\r\n\r\n      endTop.x = ~~(endTop.x + pixelSnapEpsilon);\r\n      endTop.y = ~~(endTop.y + pixelSnapEpsilon);\r\n\r\n      startBottom.x = ~~(startBottom.x + pixelSnapEpsilon);\r\n      startBottom.y = ~~(startBottom.y + pixelSnapEpsilon);\r\n\r\n      endBottom.x = ~~(endBottom.x + pixelSnapEpsilon);\r\n      endBottom.y = ~~(endBottom.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    const stroke = this._transparent;\r\n    const strokeThickness = 0;\r\n    const width = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = startTop.x;\r\n    vertexBuffer[this._vertexIndex++] = startTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = endTop.x;\r\n    vertexBuffer[this._vertexIndex++] = endTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n  }\r\n\r\n  drawRectangle(\r\n    pos: Vector,\r\n    width: number,\r\n    height: number,\r\n    color: Color,\r\n    stroke: Color = Color.Transparent,\r\n    strokeThickness: number = 0\r\n  ): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\r\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\r\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._rectangleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._rectangleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._rectangleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\nin vec2 v_size; // in pixels\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness; // in pixels\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\r\\n    vec2 uv = v_uv;\\r\\n    vec2 fragCoord = uv * v_size;\\r\\n    float maxX = v_size.x - v_strokeThickness;\\r\\n    float minX = v_strokeThickness;\\r\\n    float maxY = v_size.y - v_strokeThickness;\\r\\n    float minY = v_strokeThickness;\\r\\n\\r\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\r\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\r\\n      fragColor = v_color;\\r\\n    } else {\\r\\n      fragColor = v_strokeColor;\\r\\n    }\\r\\n    fragColor.a *= v_opacity;\\r\\n    fragColor.rgb *= fragColor.a;\\r\\n\\r\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\r\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\r\\n\\r\\n    // float fHalfBorderDist      = 0.0;\\r\\n    // float fHalfBorderThickness = 0.0;\\r\\n\\r\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\r\\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\r\\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else\\r\\n    // {\\r\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\r\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\r\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\r\\n        \\r\\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\r\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\r\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\r\\n            \\r\\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\r\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\r\\n    // }\\r\\n\\r\\n    // vec4 v4FromColor = v_strokeColor;\\r\\n    // v4FromColor.rgb *= v4FromColor.a;\\r\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\r\\n    // if (fHalfBorderDist < 0.0) {\\r\\n    //     v4ToColor = v_color;\\r\\n    //     v4ToColor.rgb *= v4ToColor.a;\\r\\n    // }\\r\\n\\r\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\r\\n\\r\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\r\\n    // gl_FragColor = finalColor;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\nin vec2 a_size;\\r\\nout vec2 v_size;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through size\\r\\n   v_size = a_size;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './circle-renderer.frag.glsl';\r\nimport vert from './circle-renderer.vert.glsl';\r\n\r\nexport class CircleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.circle';\r\n  public priority: number = 0;\r\n\r\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader!: Shader;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n\r\n  private _circleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 14 * 4 * this._maxCircles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n\r\n    this._quads = new QuadIndexBuffer(gl, this._maxCircles, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._circleCount >= this._maxCircles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._circleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\r\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\r\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO UV could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._circleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._circleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._circleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision highp float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness;\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  // make (0, 0) the center the uv \\r\\n  vec2 uv = v_uv * 2.0 - 1.0;\\r\\n\\r\\n  vec4 color = v_color;\\r\\n  vec4 strokeColor = v_strokeColor;\\r\\n\\r\\n  // circle border is at radius 1.0 \\r\\n  // dist is > 0 when inside the circle \\r\\n  float d = length(uv);\\r\\n  float dist = 1.0 - length(uv);\\r\\n\\r\\n  // Fade based on fwidth\\r\\n  float fade = fwidth(dot(uv, uv));\\r\\n\\r\\n  // if dist is greater than 0 step to 1;\\r\\n  // when we cross this 0 threshold add a smooth fade\\r\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\r\\n\\r\\n  // if dist is greater than the stroke thickness step to 1\\r\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\r\\n\\r\\n  strokeColor.a *= fill * stroke;\\r\\n  strokeColor.rgb *= strokeColor.a;\\r\\n\\r\\n  color.a *= fill * (1.0 - stroke);\\r\\n  color.rgb *= color.a;\\r\\n\\r\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\r\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\r\\n  finalColor.a = finalColor.a * v_opacity;\\r\\n  fragColor = finalColor;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";","import { Logger } from '../Util/Log';\r\nexport class Pool<Type> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  public disableWarnings = false;\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: () => Type,\r\n    public recycler?: (instance: Type) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  dispose() {\r\n    this.objects.length = 0;\r\n  }\r\n\r\n  preallocate() {\r\n    for (let i = 0; i < this.maxObjects; i++) {\r\n      this.objects[i] = this.builder();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   */\r\n  get(): Type {\r\n    if (this.index === this.maxObjects) {\r\n      if (!this.disableWarnings) {\r\n        this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      }\r\n      this.maxObjects = this.maxObjects * 2;\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      if (this.recycler) {\r\n        return this.recycler(this.objects[this.index++]);\r\n      }\r\n      return this.objects[this.index++];\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder());\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder();\r\n      this.totalAllocations++;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","import { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class DrawCall {\r\n  public z: number = 0;\r\n  public priority: number = 0;\r\n  public renderer: string = '';\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public state: ExcaliburGraphicsContextState = {\r\n    z: 0,\r\n    opacity: 1,\r\n    tint: Color.White,\r\n    material: null\r\n  };\r\n  public args: any[] = new Array(10);\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from './ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL } from './ExcaliburGraphicsContextWebGL';\r\nimport { Shader } from './shader';\r\nimport { Logger } from '../../Util/Log';\r\nimport { ImageSource, ImageSourceAttributeConstants } from '../ImageSource';\r\nimport { ImageFiltering, parseImageFiltering } from '../Filtering';\r\nimport { parseImageWrapping } from '../Wrapping';\r\n\r\nexport interface MaterialOptions {\r\n  /**\r\n   * Name the material for debugging\r\n   */\r\n  name?: string;\r\n\r\n  /**\r\n   * Excalibur graphics context to create the material (only WebGL is supported at the moment)\r\n   */\r\n  graphicsContext?: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Optionally specify a vertex shader\r\n   *\r\n   * If none supplied the default will be used\r\n   *\r\n   * ```\r\n   *  #version 300 es\r\n   *  // vertex position in local space\r\n   *  in vec2 a_position;\r\n   *  in vec2 a_uv;\r\n   *  out vec2 v_uv;\r\n   *  // orthographic projection matrix\r\n   *  uniform mat4 u_matrix;\r\n   *  // world space transform matrix\r\n   *  uniform mat4 u_transform;\r\n   *  void main() {\r\n   *    // Set the vertex position using the ortho & transform matrix\r\n   *    gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);\r\n   *    // Pass through the UV coord to the fragment shader\r\n   *    v_uv = a_uv;\r\n   *  }\r\n   * ```\r\n   */\r\n  vertexSource?: string;\r\n\r\n  /**\r\n   * Add custom fragment shader\r\n   *\r\n   * *Note: Excalibur image alpha's are pre-multiplied\r\n   *\r\n   * Pre-built varyings:\r\n   *\r\n   * * `in vec2 v_uv` - UV coordinate\r\n   * * `in vec2 v_screenuv` - UV coordinate\r\n   *\r\n   * Pre-built uniforms:\r\n   *\r\n   * * `uniform sampler2D u_graphic` - The current graphic displayed by the GraphicsComponent\r\n   * * `uniform vec2 u_resolution` - The current resolution of the screen\r\n   * * `uniform vec2 u_size;` - The current size of the graphic\r\n   * * `uniform vec4 u_color` - The current color of the material\r\n   * * `uniform float u_opacity` - The current opacity of the graphics context\r\n   *\r\n   */\r\n  fragmentSource: string;\r\n\r\n  /**\r\n   * Add custom color, by default ex.Color.Transparent\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Add additional images to the material, you are limited by the GPU's maximum texture slots\r\n   *\r\n   * Specify a dictionary of uniform sampler names to ImageSource\r\n   */\r\n  images?: Record<string, ImageSource>;\r\n}\r\n\r\nconst defaultVertexSource = `#version 300 es\r\nin vec2 a_position;\r\n\r\nin vec2 a_uv;\r\nout vec2 v_uv;\r\n\r\nin vec2 a_screenuv;\r\nout vec2 v_screenuv;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_transform;\r\n\r\nvoid main() {\r\n  // Set the vertex position using the ortho & transform matrix\r\n  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);\r\n\r\n  // Pass through the UV coord to the fragment shader\r\n  v_uv = a_uv;\r\n  v_screenuv = a_screenuv;\r\n}\r\n`;\r\n\r\nexport interface MaterialImageOptions {\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\nexport class Material {\r\n  private _logger = Logger.getInstance();\r\n  private _name: string;\r\n  private _shader!: Shader;\r\n  private _color: Color = Color.Transparent;\r\n  private _initialized = false;\r\n  private _fragmentSource: string;\r\n  private _vertexSource: string;\r\n\r\n  private _images = new Map<string, ImageSource>();\r\n  private _textures = new Map<ImageSource, WebGLTexture>();\r\n  private _maxTextureSlots!: number;\r\n  private _graphicsContext!: ExcaliburGraphicsContextWebGL;\r\n\r\n  constructor(options: MaterialOptions) {\r\n    const { color, name, vertexSource, fragmentSource, graphicsContext, images } = options;\r\n    this._name = name ?? 'anonymous material';\r\n    this._vertexSource = vertexSource ?? defaultVertexSource;\r\n    this._fragmentSource = fragmentSource;\r\n    this._color = color ?? this._color;\r\n    if (!graphicsContext) {\r\n      throw Error(`Material ${name} must be provided an excalibur webgl graphics context`);\r\n    }\r\n    if (graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this._graphicsContext = graphicsContext;\r\n      this._initialize(graphicsContext);\r\n    } else {\r\n      this._logger.warn(`Material ${name} was created in 2D Canvas mode, currently only WebGL is supported`);\r\n    }\r\n\r\n    if (images) {\r\n      for (const key in images) {\r\n        this.addImageSource(key, images[key]);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _initialize(graphicsContextWebGL: ExcaliburGraphicsContextWebGL) {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n    const gl = graphicsContextWebGL.__gl;\r\n    // max texture slots - 2 for the graphic texture and screen texture\r\n    this._maxTextureSlots = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS) - 2;\r\n    this._shader = graphicsContextWebGL.createShader({\r\n      vertexSource: this._vertexSource,\r\n      fragmentSource: this._fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._initialized = true;\r\n  }\r\n\r\n  get color(): Color {\r\n    return this._color;\r\n  }\r\n\r\n  set color(c: Color) {\r\n    this._color = c;\r\n  }\r\n\r\n  get name() {\r\n    return this._name ?? 'anonymous material';\r\n  }\r\n\r\n  get isUsingScreenTexture() {\r\n    return this._fragmentSource.includes('u_screen_texture');\r\n  }\r\n\r\n  update(callback: (shader: Shader) => any) {\r\n    if (this._shader) {\r\n      this._shader.use();\r\n      callback(this._shader);\r\n    }\r\n  }\r\n\r\n  getShader(): Shader | null {\r\n    return this._shader;\r\n  }\r\n\r\n  addImageSource(textureUniformName: string, image: ImageSource) {\r\n    if (this._images.size < this._maxTextureSlots) {\r\n      this._images.set(textureUniformName, image);\r\n    } else {\r\n      this._logger.warn(\r\n        `Max number texture slots ${this._maxTextureSlots} have been reached for material \"${this.name}\", ` +\r\n          `no more textures will be uploaded due to hardware constraints.`\r\n      );\r\n    }\r\n  }\r\n\r\n  removeImageSource(textureName: string) {\r\n    const image = this._images.get(textureName);\r\n    this._graphicsContext.textureLoader.delete(image!.image);\r\n    this._images.delete(textureName);\r\n  }\r\n\r\n  private _loadImageSource(image: ImageSource) {\r\n    const imageElement = image.image;\r\n    const maybeFiltering = imageElement.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = imageElement.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._graphicsContext.textureLoader.load(\r\n      imageElement,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    );\r\n    // remove force attribute after upload\r\n    imageElement.removeAttribute('forceUpload');\r\n    if (!this._textures.has(image)) {\r\n      this._textures.set(image, texture!);\r\n    }\r\n\r\n    return texture;\r\n  }\r\n\r\n  uploadAndBind(gl: WebGL2RenderingContext, startingTextureSlot: number = 2) {\r\n    let textureSlot = startingTextureSlot;\r\n    for (const [textureName, image] of this._images.entries()) {\r\n      if (!image.isLoaded()) {\r\n        this._logger.warnOnce(\r\n          `Image named ${textureName} in material ${this.name} not loaded, nothing will be uploaded to the shader.` +\r\n            ` Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`\r\n        );\r\n        continue;\r\n      } // skip unloaded images, maybe warn\r\n      const texture = this._loadImageSource(image);\r\n\r\n      gl.activeTexture(gl.TEXTURE0 + textureSlot);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      this._shader.trySetUniformInt(textureName, textureSlot);\r\n\r\n      textureSlot++;\r\n    }\r\n  }\r\n\r\n  use() {\r\n    if (this._initialized) {\r\n      // bind the shader\r\n      this._shader.use();\r\n      // Apply standard uniforms\r\n      this._shader.trySetUniformFloatColor('u_color', this._color);\r\n    } else {\r\n      throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`);\r\n    }\r\n  }\r\n}\r\n","import { vec } from '../../../Math/vector';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nexport class MaterialRenderer implements RendererPlugin {\r\n  public readonly type: string = 'ex.material';\r\n  public priority: number = 0;\r\n  // private _maxTextures = 8;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _quads: any;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 6 * 4, // 6 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n\r\n    // Setup a vertex layout/buffer to the material\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_screenuv', 2]\r\n      ],\r\n      suppressWarnings: true\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(gl, 1, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    const gl = this._gl;\r\n\r\n    // Extract context info\r\n    const material = this._context.material;\r\n    if (!material) {\r\n      return;\r\n    }\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    // material shader\r\n    const shader = material.getShader()!;\r\n\r\n    // construct geometry, or hold on to it in the material?\r\n    // geometry primitive for drawing rectangles?\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n    let vertexIndex = 0;\r\n\r\n    let width = image?.width || swidth || 0;\r\n    let height = image?.height || sheight || 0;\r\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n    let dest = [sx ?? 1, sy ?? 1];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n      dest = [dx, dy];\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = view[0];\r\n    sy = view[1];\r\n    const sw = view[2];\r\n    const sh = view[3];\r\n\r\n    const topLeft = vec(dest[0], dest[1]);\r\n    const topRight = vec(dest[0] + width, dest[1]);\r\n    const bottomLeft = vec(dest[0], dest[1] + height);\r\n    const bottomRight = vec(dest[0] + width, dest[1] + height);\r\n\r\n    const imageWidth = image.width || width;\r\n    const imageHeight = image.height || height;\r\n\r\n    const uvx0 = sx / imageWidth;\r\n    const uvy0 = sy / imageHeight;\r\n    const uvx1 = (sx + sw - 0.01) / imageWidth;\r\n    const uvy1 = (sy + sh - 0.01) / imageHeight;\r\n\r\n    const topLeftScreen = transform.getPosition();\r\n    const bottomRightScreen = topLeftScreen.add(bottomRight);\r\n    const screenUVX0 = topLeftScreen.x / this._context.width;\r\n    const screenUVY0 = topLeftScreen.y / this._context.height;\r\n    const screenUVX1 = bottomRightScreen.x / this._context.width;\r\n    const screenUVY1 = bottomRightScreen.y / this._context.height;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[vertexIndex++] = topLeft.x;\r\n    vertexBuffer[vertexIndex++] = topLeft.y;\r\n    vertexBuffer[vertexIndex++] = uvx0;\r\n    vertexBuffer[vertexIndex++] = uvy0;\r\n    vertexBuffer[vertexIndex++] = screenUVX0;\r\n    vertexBuffer[vertexIndex++] = screenUVY0;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[vertexIndex++] = uvx0;\r\n    vertexBuffer[vertexIndex++] = uvy1;\r\n    vertexBuffer[vertexIndex++] = screenUVX0;\r\n    vertexBuffer[vertexIndex++] = screenUVY1;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[vertexIndex++] = topRight.x;\r\n    vertexBuffer[vertexIndex++] = topRight.y;\r\n    vertexBuffer[vertexIndex++] = uvx1;\r\n    vertexBuffer[vertexIndex++] = uvy0;\r\n    vertexBuffer[vertexIndex++] = screenUVX1;\r\n    vertexBuffer[vertexIndex++] = screenUVY0;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[vertexIndex++] = uvx1;\r\n    vertexBuffer[vertexIndex++] = uvy1;\r\n    vertexBuffer[vertexIndex++] = screenUVX1;\r\n    vertexBuffer[vertexIndex++] = screenUVY1;\r\n\r\n    // This creates and uploads the texture if not already done\r\n    const texture = this._addImageAsTexture(image);\r\n\r\n    // apply material\r\n    material.use();\r\n\r\n    this._layout.shader = shader!;\r\n    // apply layout and geometry\r\n    this._layout.use(true);\r\n\r\n    // apply time in ms since the page (performance.now())\r\n    shader.trySetUniformFloat('u_time_ms', performance.now());\r\n\r\n    // apply opacity\r\n    shader.trySetUniformFloat('u_opacity', opacity);\r\n\r\n    // apply resolution\r\n    shader.trySetUniformFloatVector('u_resolution', vec(this._context.width, this._context.height));\r\n\r\n    // apply graphic resolution\r\n    shader.trySetUniformFloatVector('u_graphic_resolution', vec(imageWidth, imageHeight));\r\n\r\n    // apply size\r\n    shader.trySetUniformFloatVector('u_size', vec(sw, sh));\r\n\r\n    // apply orthographic projection\r\n    shader.trySetUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // apply geometry transform\r\n    shader.trySetUniformMatrix('u_transform', transform.to4x4());\r\n\r\n    // bind graphic image texture 'uniform sampler2D u_graphic;'\r\n    gl.activeTexture(gl.TEXTURE0 + 0);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    shader.trySetUniformInt('u_graphic', 0);\r\n\r\n    // bind the screen texture\r\n    gl.activeTexture(gl.TEXTURE0 + 1);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._context.materialScreenTexture);\r\n    shader.trySetUniformInt('u_screen_texture', 1);\r\n\r\n    // bind any additional textures in the material\r\n    material.uploadAndBind(gl);\r\n\r\n    // bind quad index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw a single quad\r\n    gl.drawElements(gl.TRIANGLES, 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount++;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n    }\r\n\r\n    return texture;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return false;\r\n  }\r\n  flush(): void {\r\n    // flush does not do anything, material renderer renders immediately per draw\r\n  }\r\n}\r\n","/**\r\n * Enum representing the coordinate plane for the position 2D vector in the {@apilink TransformComponent}\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { GetSpriteOptions, SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Math/util';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsed The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsed: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is playing backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\nexport interface FrameEvent extends Frame {\r\n  frameIndex: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally set a positive speed multiplier on the animation.\r\n   *\r\n   * By default 1, meaning 1x speed. If set to 2, it will play the animation twice as fast.\r\n   */\r\n  speed?: number;\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 100)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the {@apilink AnimationStrategy} for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\nexport type AnimationEvents = {\r\n  frame: FrameEvent;\r\n  loop: Animation;\r\n  end: Animation;\r\n};\r\n\r\nexport const AnimationEvents = {\r\n  Frame: 'frame',\r\n  Loop: 'loop',\r\n  End: 'end'\r\n};\r\n\r\nexport interface FromSpriteSheetOptions {\r\n  /**\r\n   * {@apilink SpriteSheet} to source the animation frames from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * The list of (x, y) positions of sprites in the {@apilink SpriteSheet} of each frame, for example (0, 0)\r\n   * is the the top left sprite, (0, 1) is the sprite directly below that, and so on.\r\n   *\r\n   * You may optionally specify a duration for the frame in milliseconds as well, this will override\r\n   * the default duration.\r\n   */\r\n  frameCoordinates: { x: number; y: number; duration?: number; options?: GetSpriteOptions }[];\r\n  /**\r\n   * Optionally specify a default duration for frames in milliseconds\r\n   * @deprecated use `durationPerFrame`\r\n   */\r\n  durationPerFrameMs?: number;\r\n  /**\r\n   * Optionally specify a default duration for frames in milliseconds\r\n   */\r\n  durationPerFrame?: number;\r\n  /**\r\n   * Optionally set a positive speed multiplier on the animation.\r\n   *\r\n   * By default 1, meaning 1x speed. If set to 2, it will play the animation twice as fast.\r\n   */\r\n  speed?: number;\r\n  /**\r\n   * Optionally specify the animation strategy for this animation, by default animations loop {@apilink AnimationStrategy.Loop}\r\n   */\r\n  strategy?: AnimationStrategy;\r\n  /**\r\n   * Optionally specify the animation should be reversed\r\n   */\r\n  reverse?: boolean;\r\n}\r\n\r\n/**\r\n * Create an Animation given a list of {@apilink Frame | `frames`} in {@apilink AnimationOptions}\r\n *\r\n * To create an Animation from a {@apilink SpriteSheet}, use {@apilink Animation.fromSpriteSheet}\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventEmitter<AnimationEvents>();\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _pingPongDirection = 1;\r\n  private _done = false;\r\n  private _playing = true;\r\n  private _speed = 1;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.speed = options.speed ?? this.speed;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      speed: this.speed,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame && maybeFrame.graphic) {\r\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public override get height(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame && maybeFrame.graphic) {\r\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Create an Animation from a {@apilink SpriteSheet}, a list of indices into the sprite sheet, a duration per frame\r\n   * and optional {@apilink AnimationStrategy}\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   * @param spriteSheet ex.SpriteSheet\r\n   * @param spriteSheetIndex 0 based index from left to right, top down (row major order) of the ex.SpriteSheet\r\n   * @param durationPerFrame duration per frame in milliseconds\r\n   * @param strategy Optional strategy, default AnimationStrategy.Loop\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    spriteSheetIndex: number[],\r\n    durationPerFrame: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = spriteSheetIndex.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => spriteSheetIndex.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrame\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create an {@apilink Animation} from a {@apilink SpriteSheet} given a list of coordinates\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheetCoordinates({\r\n   *  spriteSheet,\r\n   *  frameCoordinates: [\r\n   *    {x: 0, y: 5, duration: 100, options { flipHorizontal: true }},\r\n   *    {x: 1, y: 5, duration: 200},\r\n   *    {x: 2, y: 5},\r\n   *    {x: 3, y: 5}\r\n   *  ],\r\n   *  strategy: AnimationStrategy.PingPong\r\n   * });\r\n   * ```\r\n   * @param options\r\n   * @returns Animation\r\n   */\r\n  public static fromSpriteSheetCoordinates(options: FromSpriteSheetOptions): Animation {\r\n    const { spriteSheet, frameCoordinates, durationPerFrame, durationPerFrameMs, speed, strategy, reverse } = options;\r\n    const defaultDuration = durationPerFrame ?? durationPerFrameMs ?? 100;\r\n    const frames: Frame[] = [];\r\n    for (const coord of frameCoordinates) {\r\n      const { x, y, duration, options } = coord;\r\n      const sprite = spriteSheet.getSprite(x, y, options);\r\n      if (sprite) {\r\n        frames.push({\r\n          graphic: sprite,\r\n          duration: duration ?? defaultDuration\r\n        });\r\n      } else {\r\n        Animation._LOGGER.warn(\r\n          `Skipping frame! SpriteSheet does not have coordinate (${x}, ${y}), please check your SpriteSheet to confirm that sprite exists`\r\n        );\r\n      }\r\n    }\r\n\r\n    return new Animation({\r\n      frames,\r\n      strategy,\r\n      speed,\r\n      reverse\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Current animation speed\r\n   *\r\n   * 1 meaning normal 1x speed.\r\n   * 2 meaning 2x speed and so on.\r\n   */\r\n  public get speed(): number {\r\n    return this._speed;\r\n  }\r\n\r\n  /**\r\n   * Current animation speed\r\n   *\r\n   * 1 meaning normal 1x speed.\r\n   * 2 meaning 2x speed and so on.\r\n   */\r\n  public set speed(val: number) {\r\n    this._speed = clamp(Math.abs(val), 0, Infinity);\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   *\r\n   * Use {@apilink Animation.currentFrameIndex} to get the frame number and\r\n   * {@apilink Animation.goToFrame} to set the current frame index\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   *\r\n   * Use {@apilink Animation.currentFrame} to grab the current {@apilink Frame} object\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns the amount of time in milliseconds left in the current frame\r\n   */\r\n  public get currentFrameTimeLeft(): number {\r\n    return this._timeLeftInFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n\r\n  public get isReversed() {\r\n    return this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = this._reversed && this._pingPongDirection === 1 ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   *\r\n   * Optionally specify an override for the duration of the frame, useful for\r\n   * keeping multiple animations in sync with one another.\r\n   * @param frameNumber\r\n   * @param duration\r\n   */\r\n  public goToFrame(frameNumber: number, duration?: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = duration ?? this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = duration ?? (maybeFrame?.duration || this.frameDuration);\r\n      this.events.emit('frame', { ...maybeFrame, frameIndex: this.currentFrameIndex });\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._pingPongDirection >= this.frames.length) {\r\n          this._pingPongDirection = -1;\r\n          this.events.emit('loop', this);\r\n        }\r\n\r\n        if (currentFrame + this._pingPongDirection < 0) {\r\n          this._pingPongDirection = 1;\r\n          this.events.emit('loop', this);\r\n        }\r\n\r\n        next = currentFrame + (this._pingPongDirection % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsed Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsed: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', { ...this.currentFrame, frameIndex: this.currentFrameIndex });\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsed * this._speed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame && this.currentFrame.graphic) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from './vector';\n\nexport interface VectorViewOptions {\n  getX: () => number;\n  getY: () => number;\n  setX: (x: number) => void;\n  setY: (y: number) => void;\n}\nexport class VectorView extends Vector {\n  private _getX: () => number;\n  private _getY: () => number;\n  private _setX: (x: number) => void;\n  private _setY: (y: number) => void;\n  constructor(options: VectorViewOptions) {\n    super(0, 0);\n    this._getX = options.getX;\n    this._getY = options.getY;\n    this._setX = options.setX;\n    this._setY = options.setY;\n  }\n  public get x() {\n    return (this._x = this._getX());\n  }\n\n  public set x(val) {\n    this._setX(val);\n    this._x = val;\n  }\n\n  public get y() {\n    return (this._y = this._getY());\n  }\n  public set y(val) {\n    this._setY(val);\n    this._y = val;\n  }\n}\n","import { Vector } from './vector';\r\n\r\n/**\r\n * Wraps a vector and watches for changes in the x/y, modifies the original vector.\r\n */\r\nexport class WatchVector extends Vector {\r\n  constructor(\r\n    public original: Vector,\r\n    public change: (x: number, y: number) => any\r\n  ) {\r\n    super(original.x, original.y);\r\n  }\r\n  public get x() {\r\n    return (this._x = this.original.x);\r\n  }\r\n\r\n  public set x(newX: number) {\r\n    if (newX !== this._x) {\r\n      this.change(newX, this._y);\r\n      this._x = this.original.x = newX;\r\n    }\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this.original.y);\r\n  }\r\n\r\n  public set y(newY: number) {\r\n    if (newY !== this._y) {\r\n      this.change(this._x, newY);\r\n      this._y = this.original.y = newY;\r\n    }\r\n  }\r\n\r\n  override setTo(x: number, y: number): void {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n}\r\n","import { AffineMatrix } from './affine-matrix';\r\nimport { canonicalizeAngle, sign } from './util';\r\nimport { vec, Vector } from './vector';\r\nimport { VectorView } from './vector-view';\r\nimport { WatchVector } from './watch-vector';\r\n\r\nexport class Transform {\r\n  private _parent: Transform | null = null;\r\n  get parent() {\r\n    return this._parent;\r\n  }\r\n  set parent(transform: Transform | null) {\r\n    if (this._parent) {\r\n      const index = this._parent._children.indexOf(this);\r\n      if (index > -1) {\r\n        this._parent._children.splice(index, 1);\r\n      }\r\n    }\r\n    this._parent = transform;\r\n    if (this._parent) {\r\n      this._parent._children.push(this);\r\n    }\r\n    this.flagDirty();\r\n  }\r\n  get children(): readonly Transform[] {\r\n    return this._children;\r\n  }\r\n  private _children: Transform[] = [];\r\n\r\n  private _pos: Vector = new WatchVector(vec(0, 0), () => {\r\n    this.flagDirty();\r\n  });\r\n  set pos(v: Vector) {\r\n    this._pos.x = v.x;\r\n    this._pos.y = v.y;\r\n  }\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set globalPos(v: Vector) {\r\n    let localPos = v.clone();\r\n    if (this.parent) {\r\n      localPos = this.parent.inverse.multiply(v);\r\n    }\r\n    if (!localPos.equals(this._pos)) {\r\n      this._pos = localPos;\r\n      this.flagDirty();\r\n    }\r\n  }\r\n  private _globalPos = new VectorView({\r\n    getX: () => this.matrix.data[4],\r\n    getY: () => this.matrix.data[5],\r\n    setX: (x) => {\r\n      if (this.parent) {\r\n        const { x: newX } = this.parent.inverse.multiply(vec(x, this.pos.y));\r\n        this.pos.x = newX;\r\n      } else {\r\n        this.pos.x = x;\r\n      }\r\n      if (x !== this.matrix.data[4]) {\r\n        this.flagDirty();\r\n      }\r\n    },\r\n    setY: (y) => {\r\n      if (this.parent) {\r\n        const { y: newY } = this.parent.inverse.multiply(vec(this.pos.x, y));\r\n        this.pos.y = newY;\r\n      } else {\r\n        this.pos.y = y;\r\n      }\r\n      if (y !== this.matrix.data[5]) {\r\n        this.flagDirty();\r\n      }\r\n    }\r\n  });\r\n  get globalPos() {\r\n    return this._globalPos;\r\n  }\r\n\r\n  private _rotation: number = 0;\r\n  set rotation(rotation: number) {\r\n    const canonRotation = canonicalizeAngle(rotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n  get rotation() {\r\n    return this._rotation;\r\n  }\r\n\r\n  set globalRotation(rotation: number) {\r\n    let inverseRotation = 0;\r\n    if (this.parent) {\r\n      inverseRotation = this.parent.globalRotation;\r\n    }\r\n    const canonRotation = canonicalizeAngle(rotation + inverseRotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    if (this.parent) {\r\n      return this.matrix.getRotation();\r\n    }\r\n    return this.rotation;\r\n  }\r\n\r\n  private _scale: Vector = new WatchVector(vec(1, 1), () => {\r\n    this.flagDirty();\r\n  });\r\n  set scale(v: Vector) {\r\n    this._scale.x = v.x;\r\n    this._scale.y = v.y;\r\n  }\r\n  get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  set globalScale(v: Vector) {\r\n    let inverseScale = vec(1, 1);\r\n    if (this.parent) {\r\n      inverseScale = this.parent.globalScale;\r\n    }\r\n    this.scale = v.scale(vec(1 / inverseScale.x, 1 / inverseScale.y));\r\n  }\r\n\r\n  private _globalScale = new VectorView({\r\n    getX: () => (this.parent ? this.matrix.getScaleX() : this.scale.x),\r\n    getY: () => (this.parent ? this.matrix.getScaleY() : this.scale.y),\r\n    setX: (x) => {\r\n      if (this.parent) {\r\n        const globalScaleX = this.parent.globalScale.x;\r\n        this.scale.x = x / globalScaleX;\r\n      } else {\r\n        this.scale.x = x;\r\n      }\r\n    },\r\n    setY: (y) => {\r\n      if (this.parent) {\r\n        const globalScaleY = this.parent.globalScale.y;\r\n        this.scale.y = y / globalScaleY;\r\n      } else {\r\n        this.scale.y = y;\r\n      }\r\n    }\r\n  });\r\n  get globalScale() {\r\n    return this._globalScale;\r\n  }\r\n\r\n  private _z: number = 0;\r\n\r\n  set z(z: number) {\r\n    this._z = z;\r\n    this.flagDirty();\r\n  }\r\n\r\n  get z() {\r\n    return this._z;\r\n  }\r\n\r\n  set globalZ(z: number) {\r\n    if (this.parent) {\r\n      this.z = z - this.parent.globalZ;\r\n    } else {\r\n      this.z = z;\r\n    }\r\n  }\r\n\r\n  get globalZ() {\r\n    if (this.parent) {\r\n      return this.z + this.parent.globalZ;\r\n    }\r\n    return this.z;\r\n  }\r\n\r\n  private _isDirty = false;\r\n  private _isInverseDirty = false;\r\n  private _matrix = AffineMatrix.identity();\r\n  private _inverse = AffineMatrix.identity();\r\n\r\n  /**\r\n   * Calculates and returns the matrix representation of this transform\r\n   *\r\n   * Avoid mutating the matrix to update the transform, it is not the source of truth.\r\n   * Update the transform pos, rotation, scale.\r\n   */\r\n  public get matrix(): AffineMatrix {\r\n    if (this._isDirty) {\r\n      if (this.parent === null) {\r\n        this._calculateMatrix().clone(this._matrix);\r\n      } else {\r\n        this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix);\r\n      }\r\n      this._isDirty = false;\r\n    }\r\n    return this._matrix;\r\n  }\r\n\r\n  /**\r\n   * Calculates and returns the inverse matrix representation of this transform\r\n   */\r\n  public get inverse(): AffineMatrix {\r\n    if (this._isInverseDirty) {\r\n      this.matrix.inverse(this._inverse);\r\n      this._isInverseDirty = false;\r\n    }\r\n    return this._inverse;\r\n  }\r\n\r\n  private _scratch = AffineMatrix.identity();\r\n  private _calculateMatrix(): AffineMatrix {\r\n    this._scratch.data[0] = Math.cos(this._rotation);\r\n    this._scratch.data[1] = Math.sin(this._rotation);\r\n    this._scratch.data[2] = -Math.sin(this._rotation);\r\n    this._scratch.data[3] = Math.cos(this.rotation);\r\n    this._scratch.data[4] = this._pos.x;\r\n    this._scratch.data[5] = this._pos.y;\r\n    this._scratch.scale(this._scale.x, this._scale.y);\r\n    return this._scratch;\r\n  }\r\n\r\n  public flagDirty() {\r\n    this._isDirty = true;\r\n    this._isInverseDirty = true;\r\n    for (let i = 0; i < this._children.length; i++) {\r\n      this._children[i].flagDirty();\r\n    }\r\n  }\r\n\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multiply(point);\r\n  }\r\n\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.inverse.multiply(point);\r\n  }\r\n\r\n  public setTransform(pos: Vector, rotation: number, scale: Vector) {\r\n    this._pos.x = pos.x;\r\n    this._pos.y = pos.y;\r\n    this._rotation = canonicalizeAngle(rotation);\r\n    this._scale.x = scale.x;\r\n    this._scale.y = scale.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Returns true if the transform has a negative x scale or y scale, but not both\r\n   */\r\n  public isMirrored(): boolean {\r\n    const signBitX = sign(this.scale.x) >>> 31;\r\n    const signBitY = sign(this.scale.y) >>> 31;\r\n    const mirrored = signBitX ^ signBitY;\r\n    return !!mirrored;\r\n  }\r\n\r\n  /**\r\n   * Clones the current transform\r\n   * **Warning does not clone the parent**\r\n   * @param dest\r\n   */\r\n  public clone(dest?: Transform): Transform {\r\n    const target = dest ?? new Transform();\r\n    this._pos.clone(target._pos);\r\n    target._z = this._z;\r\n    target._rotation = this._rotation;\r\n    this._scale.clone(target._scale);\r\n    target.flagDirty();\r\n    return target;\r\n  }\r\n\r\n  /**\r\n   * Clones but keeps the same parent reference\r\n   */\r\n  public cloneWithParent(dest?: Transform): Transform {\r\n    const target = dest ?? new Transform();\r\n    this._pos.clone(target._pos);\r\n    target._z = this._z;\r\n    target._rotation = this._rotation;\r\n    this._scale.clone(target._scale);\r\n    target.parent = this.parent;\r\n    target.flagDirty();\r\n    return target;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this.matrix.toString();\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Constructor Types\r\n */\r\nexport declare type ComponentCtor<TComponent extends Component = Component> = new (...args: any[]) => TComponent;\r\n\r\n/**\r\n *\r\n */\r\nexport function isComponentCtor(value: any): value is ComponentCtor<Component> {\r\n  return !!value && !!value.prototype && !!value.prototype.constructor;\r\n}\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependencies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component {\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component {\r\n  // TODO maybe generate a unique id?\r\n\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  /**\r\n   * Current owning {@apilink Entity}, if any, of this component. Null if not added to any {@apilink Entity}\r\n   */\r\n  owner?: Entity = undefined;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): Component {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Optional callback called when a component is removed from an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n","/**\n * Defines a generic message that can contain any data\n * @template T is the typescript Type of the data\n */\nexport interface Message<T> {\n  type: string;\n  data: T;\n}\n\n/**\n * Defines an interface for an observer to receive a message via a notify() method\n */\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\n/**\n * Defines an interface for something that might be an observer if a notify() is present\n */\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n  public subscriptions: ((val: T) => any)[] = [];\n\n  /**\n   * Register an observer to listen to this observable\n   * @param observer\n   */\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Register a callback to listen to this observable\n   * @param func\n   */\n  subscribe(func: (val: T) => any) {\n    this.subscriptions.push(func);\n  }\n\n  /**\n   * Remove an observer from the observable\n   * @param observer\n   */\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  /**\n   * Remove a callback that is listening to this observable\n   * @param func\n   */\n  unsubscribe(func: (val: T) => any) {\n    const i = this.subscriptions.indexOf(func);\n    if (i !== -1) {\n      this.subscriptions.splice(i, 1);\n    }\n  }\n\n  /**\n   * Broadcasts a message to all observers and callbacks\n   * @param message\n   */\n  notifyAll(message: T) {\n    const observersLength = this.observers.length;\n    for (let i = 0; i < observersLength; i++) {\n      this.observers[i].notify(message);\n    }\n    const subscriptionsLength = this.subscriptions.length;\n    for (let i = 0; i < subscriptionsLength; i++) {\n      this.subscriptions[i](message);\n    }\n  }\n\n  /**\n   * Removes all observers and callbacks\n   */\n  clear() {\n    this.observers.length = 0;\n    this.subscriptions.length = 0;\n  }\n}\n","import { Vector } from '../../Math/vector';\r\nimport { CoordPlane } from '../../Math/coord-plane';\r\nimport { Transform } from '../../Math/transform';\r\nimport { Component } from '../Component';\r\nimport { Entity } from '../Entity';\r\nimport { Observable } from '../../Util/Observable';\r\nimport { Logger } from '../../Util/Log';\r\n\r\nexport class TransformComponent extends Component {\r\n  private _logger = Logger.getInstance();\r\n  private _parentComponent: TransformComponent | null = null;\r\n  private _transform = new Transform();\r\n  public get() {\r\n    return this._transform;\r\n  }\r\n\r\n  private _addChildTransform = (child: Entity) => {\r\n    const childTxComponent = child.get(TransformComponent);\r\n    if (childTxComponent) {\r\n      childTxComponent._transform.parent = this._transform;\r\n      childTxComponent._parentComponent = this;\r\n    }\r\n  };\r\n  onAdd(owner: Entity): void {\r\n    for (const child of owner.children) {\r\n      this._addChildTransform(child);\r\n    }\r\n    owner.childrenAdded$.subscribe((child) => this._addChildTransform(child));\r\n    owner.childrenRemoved$.subscribe((child) => {\r\n      const childTxComponent = child.get(TransformComponent);\r\n      if (childTxComponent) {\r\n        childTxComponent._transform.parent = null;\r\n        childTxComponent._parentComponent = null;\r\n      }\r\n    });\r\n  }\r\n  onRemove(_previousOwner: Entity): void {\r\n    this._transform.parent = null;\r\n    this._parentComponent = null;\r\n  }\r\n\r\n  /**\r\n   * Observable that emits when the z index changes on this component\r\n   */\r\n  public zIndexChanged$ = new Observable<number>();\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public get z(): number {\r\n    return this._transform.z;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    const oldz = this._transform.z;\r\n    this._transform.z = val;\r\n    if (oldz !== val) {\r\n      this.zIndexChanged$.notifyAll(val);\r\n    }\r\n  }\r\n\r\n  public get globalZ() {\r\n    return this._transform.globalZ;\r\n  }\r\n\r\n  public set globalZ(z: number) {\r\n    this._transform.globalZ = z;\r\n  }\r\n\r\n  private _coordPlane = CoordPlane.World;\r\n  /**\r\n   * The {@apilink CoordPlane | `coordinate plane`} for this transform for the entity.\r\n   */\r\n  public get coordPlane() {\r\n    if (this._parentComponent) {\r\n      return this._parentComponent.coordPlane;\r\n    }\r\n    return this._coordPlane;\r\n  }\r\n\r\n  public set coordPlane(value: CoordPlane) {\r\n    if (!this._parentComponent) {\r\n      this._coordPlane = value;\r\n    } else {\r\n      this._logger.warn(\r\n        `Cannot set coordinate plane on child entity ${this.owner?.name}, children inherit their coordinate plane from their parents.`\r\n      );\r\n    }\r\n  }\r\n\r\n  get pos() {\r\n    return this._transform.pos;\r\n  }\r\n  set pos(v: Vector) {\r\n    this._transform.pos = v;\r\n  }\r\n\r\n  get globalPos() {\r\n    return this._transform.globalPos;\r\n  }\r\n  set globalPos(v: Vector) {\r\n    this._transform.globalPos = v;\r\n  }\r\n\r\n  get rotation() {\r\n    return this._transform.rotation;\r\n  }\r\n  set rotation(rotation) {\r\n    this._transform.rotation = rotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    return this._transform.globalRotation;\r\n  }\r\n  set globalRotation(rotation) {\r\n    this._transform.globalRotation = rotation;\r\n  }\r\n\r\n  get scale() {\r\n    return this._transform.scale;\r\n  }\r\n  set scale(v: Vector) {\r\n    this._transform.scale = v;\r\n  }\r\n\r\n  get globalScale() {\r\n    return this._transform.globalScale;\r\n  }\r\n  set globalScale(v: Vector) {\r\n    this._transform.globalScale = v;\r\n  }\r\n\r\n  applyInverse(v: Vector) {\r\n    return this._transform.applyInverse(v);\r\n  }\r\n\r\n  apply(v: Vector) {\r\n    return this._transform.apply(v);\r\n  }\r\n\r\n  clone(): TransformComponent {\r\n    const component = new TransformComponent();\r\n    component._transform = this._transform.clone();\r\n    return component;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Animation, HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport interface GraphicsGroupingOptions {\r\n  members: (GraphicsGrouping | Graphic)[];\r\n  /**\r\n   * Default true, GraphicsGroup will use the anchor to position all the graphics based on their combined bounds\r\n   *\r\n   * Setting to false will ignore anchoring from parent components and position the top left of all graphics at the actor's position,\r\n   * positioning graphics in the group is done with the `offset` property.\r\n   */\r\n  useAnchor?: boolean;\r\n}\r\n\r\nexport interface GraphicsGrouping {\r\n  offset: Vector;\r\n  graphic: Graphic;\r\n  /**\r\n   * Optionally disable this graphics bounds as part of group calculation, default true\r\n   * if unspecified\r\n   *\r\n   * You may want disable this if you're using text because their bounds will affect\r\n   * the centering of the whole group.\r\n   *\r\n   * **WARNING** having inaccurate bounds can cause offscreen culling issues.\r\n   */\r\n  useBounds?: boolean;\r\n}\r\n\r\nexport class GraphicsGroup extends Graphic implements HasTick {\r\n  private _logger = Logger.getInstance();\r\n  public useAnchor: boolean = true;\r\n  public members: (GraphicsGrouping | Graphic)[] = [];\r\n\r\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\r\n    super(options);\r\n    this.members = options.members;\r\n    this.useAnchor = options.useAnchor ?? this.useAnchor;\r\n    this._updateDimensions();\r\n  }\r\n\r\n  public clone(): GraphicsGroup {\r\n    return new GraphicsGroup({\r\n      members: [...this.members],\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  private _updateDimensions(): BoundingBox {\r\n    const bb = this.localBounds;\r\n    this.width = bb.width;\r\n    this.height = bb.height;\r\n    return bb;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    const bb = new BoundingBox();\r\n    for (const member of this.members) {\r\n      if (member instanceof Graphic) {\r\n        member.localBounds.combine(bb, bb);\r\n      } else {\r\n        const { graphic, offset: pos, useBounds } = member;\r\n        const shouldUseBounds = useBounds === undefined ? true : useBounds;\r\n        if (graphic) {\r\n          if (shouldUseBounds) {\r\n            graphic.localBounds.translate(pos).combine(bb, bb);\r\n          }\r\n        } else {\r\n          this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(member)}.`);\r\n        }\r\n      }\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\r\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\r\n  }\r\n\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n      }\r\n      if (this._isAnimationOrGroup(graphic)) {\r\n        graphic.tick(elapsed, idempotencyToken);\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset() {\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n      }\r\n      if (this._isAnimationOrGroup(graphic)) {\r\n        graphic.reset();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    this._updateDimensions();\r\n    super._preDraw(ex, this.useAnchor ? x : 0, this.useAnchor ? y : 0);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    const pos = Vector.Zero;\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n        member.offset.clone(pos);\r\n      }\r\n      if (!graphic) {\r\n        continue;\r\n      }\r\n      ex.save();\r\n      ex.translate(x, y);\r\n      graphic.draw(ex, pos.x, pos.y);\r\n      if (this.showDebug) {\r\n        /* istanbul ignore next */\r\n        ex.debug.drawRect(0, 0, this.width, this.height);\r\n      }\r\n      ex.restore();\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { watch } from '../Util/Watch';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { omit } from '../Util/Util';\r\n\r\nexport interface RasterOptions extends GraphicOptions {\r\n  /**\r\n   * Optionally specify a quality number, which is how much to scale the internal Raster. Default is 1.\r\n   *\r\n   * For example if the quality is set to 2, it doubles the internal raster bitmap in memory.\r\n   *\r\n   * Adjusting this value can be useful if you are working with small rasters.\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\r\n   */\r\n  smoothing?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the color of the raster's bitmap context, by default {@apilink Color.Black}\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\r\n   */\r\n  strokeColor?: Color;\r\n\r\n  /**\r\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\r\n   */\r\n  lineWidth?: number;\r\n\r\n  /**\r\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\r\n   */\r\n  lineDash?: number[];\r\n\r\n  /**\r\n   * Optionally specify the line end style, default is \"butt\".\r\n   */\r\n  lineCap?: 'butt' | 'round' | 'square';\r\n\r\n  /**\r\n   * Optionally specify the padding to apply to the bitmap\r\n   */\r\n  padding?: number;\r\n\r\n  /**\r\n   * Optionally specify what image filtering mode should be used, {@apilink ImageFiltering.Pixel} for pixel art,\r\n   * {@apilink ImageFiltering.Blended} for hi-res art\r\n   *\r\n   * By default unset, rasters defer to the engine antialiasing setting\r\n   */\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\n/**\r\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\r\n * {@apilink ExcaliburGraphicsContext}. This is useful for generating custom images using the 2D canvas api.\r\n *\r\n * Implementors must implement the {@apilink Raster.execute} method to rasterize their drawing.\r\n */\r\nexport abstract class Raster extends Graphic {\r\n  public filtering?: ImageFiltering;\r\n  public lineCap: 'butt' | 'round' | 'square' = 'butt';\r\n  public quality: number = 1;\r\n\r\n  public _bitmap: HTMLCanvasElement;\r\n  protected _ctx: CanvasRenderingContext2D;\r\n  private _dirty: boolean = true;\r\n\r\n  constructor(options?: RasterOptions) {\r\n    super(omit({ ...options }, ['width', 'height'])); // rasters do some special sauce with width/height\r\n    if (options) {\r\n      this.quality = options.quality ?? this.quality;\r\n      this.color = options.color ?? Color.Black;\r\n      this.strokeColor = options?.strokeColor;\r\n      this.smoothing = options.smoothing ?? this.smoothing;\r\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\r\n      this.lineDash = options.lineDash ?? this.lineDash;\r\n      this.lineCap = options.lineCap ?? this.lineCap;\r\n      this.padding = options.padding ?? this.padding;\r\n      this.filtering = options.filtering ?? this.filtering;\r\n    }\r\n    this._bitmap = document.createElement('canvas');\r\n    // get the default canvas width/height as a fallback\r\n    const bitmapWidth = options?.width ?? this._bitmap.width;\r\n    const bitmapHeight = options?.height ?? this._bitmap.height;\r\n    this.width = bitmapWidth;\r\n    this.height = bitmapHeight;\r\n    const maybeCtx = this._bitmap.getContext('2d');\r\n    if (!maybeCtx) {\r\n      /* istanbul ignore next */\r\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\r\n    } else {\r\n      this._ctx = maybeCtx;\r\n    }\r\n  }\r\n\r\n  public cloneRasterOptions(): RasterOptions {\r\n    return {\r\n      color: this.color ? this.color.clone() : undefined,\r\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : undefined,\r\n      smoothing: this.smoothing,\r\n      lineWidth: this.lineWidth,\r\n      lineDash: this.lineDash,\r\n      lineCap: this.lineCap,\r\n      quality: this.quality,\r\n      padding: this.padding\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\r\n   */\r\n  public get dirty() {\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\r\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\r\n   */\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n\r\n  private _originalWidth?: number;\r\n  /**\r\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding`s or `quality` set will be factored into the width\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._getTotalWidth() * this.scale.x);\r\n  }\r\n  public set width(value: number) {\r\n    value /= Math.abs(this.scale.x);\r\n    this._bitmap.width = value;\r\n    this._originalWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _originalHeight?: number;\r\n  /**\r\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding` or `quality` set will be factored into the height\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._getTotalHeight() * this.scale.y);\r\n  }\r\n\r\n  public set height(value: number) {\r\n    value /= Math.abs(this.scale.y);\r\n    this._bitmap.height = value;\r\n    this._originalHeight = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _getTotalWidth() {\r\n    return ((this._originalWidth ?? this._bitmap.width) + this.padding * 2) * 1;\r\n  }\r\n\r\n  private _getTotalHeight() {\r\n    return ((this._originalHeight ?? this._bitmap.height) + this.padding * 2) * 1;\r\n  }\r\n\r\n  /**\r\n   * Returns the local bounds of the Raster including the padding\r\n   */\r\n  public get localBounds() {\r\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  private _smoothing: boolean = false;\r\n  /**\r\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get smoothing() {\r\n    return this._smoothing;\r\n  }\r\n  public set smoothing(value: boolean) {\r\n    this._smoothing = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\r\n  /**\r\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get color() {\r\n    return this._color;\r\n  }\r\n  public set color(value) {\r\n    this.flagDirty();\r\n    this._color = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _strokeColor: Color | undefined;\r\n  /**\r\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get strokeColor() {\r\n    return this._strokeColor;\r\n  }\r\n  public set strokeColor(value: Color | undefined) {\r\n    this.flagDirty();\r\n    if (value) {\r\n      this._strokeColor = watch(value, () => this.flagDirty());\r\n    }\r\n  }\r\n\r\n  private _lineWidth: number = 1;\r\n  /**\r\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get lineWidth() {\r\n    return this._lineWidth;\r\n  }\r\n  public set lineWidth(value) {\r\n    this._lineWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _lineDash: number[] = [];\r\n  public get lineDash() {\r\n    return this._lineDash;\r\n  }\r\n\r\n  public set lineDash(value) {\r\n    this._lineDash = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _padding: number = 0;\r\n  public get padding() {\r\n    return this._padding;\r\n  }\r\n\r\n  public set padding(value: number) {\r\n    this._padding = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\r\n   * the graphic is {@apilink Raster.dirty} on the next {@apilink Graphic.draw} call\r\n   */\r\n  public rasterize(): void {\r\n    this._dirty = false;\r\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\r\n    this._ctx.save();\r\n    this._applyRasterProperties(this._ctx);\r\n    this.execute(this._ctx);\r\n    this._ctx.restore();\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    this._bitmap.width = this._getTotalWidth() * this.quality;\r\n    this._bitmap.height = this._getTotalHeight() * this.quality;\r\n    // Do a bad thing to pass the filtering as an attribute\r\n    this._bitmap.setAttribute('filtering', this.filtering as any);\r\n    this._bitmap.setAttribute('forceUpload', 'true');\r\n    ctx.scale(this.quality, this.quality);\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.lineCap = this.lineCap;\r\n    ctx.strokeStyle = this.strokeColor?.toString() ?? '';\r\n    ctx.fillStyle = this.color?.toString();\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this._dirty) {\r\n      this.rasterize();\r\n    }\r\n    ex.scale(1 / this.quality, 1 / this.quality);\r\n    ex.drawImage(this._bitmap, x, y);\r\n  }\r\n\r\n  /**\r\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\r\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the {@apilink ExcaliburGraphicsContext} via `draw(...)`\r\n   * @param ctx Canvas to draw the graphic to\r\n   */\r\n  abstract execute(ctx: CanvasRenderingContext2D): void;\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Enum representing the different font size units\r\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\r\n */\r\nexport enum FontUnit {\r\n  /**\r\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\r\n   */\r\n  Em = 'em',\r\n  /**\r\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\r\n   */\r\n  Rem = 'rem',\r\n  /**\r\n   * Pixel is a unit of length in screen pixels\r\n   */\r\n  Px = 'px',\r\n  /**\r\n   * Point is a physical unit length (1/72 of an inch)\r\n   */\r\n  Pt = 'pt',\r\n  /**\r\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\r\n   */\r\n  Percent = '%'\r\n}\r\n\r\n/**\r\n * Enum representing the different horizontal text alignments\r\n */\r\nexport enum TextAlign {\r\n  /**\r\n   * The text is left-aligned.\r\n   */\r\n  Left = 'left',\r\n  /**\r\n   * The text is right-aligned.\r\n   */\r\n  Right = 'right',\r\n  /**\r\n   * The text is centered.\r\n   */\r\n  Center = 'center',\r\n  /**\r\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\r\n   * right-aligned for right-to-left locales).\r\n   */\r\n  Start = 'start',\r\n  /**\r\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\r\n   * left-aligned for right-to-left locales).\r\n   */\r\n  End = 'end'\r\n}\r\n\r\n/**\r\n * Enum representing the different baseline text alignments\r\n */\r\nexport enum BaseAlign {\r\n  /**\r\n   * The text baseline is the top of the em square.\r\n   */\r\n  Top = 'top',\r\n  /**\r\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\r\n   * alphabetic.\r\n   */\r\n  Hanging = 'hanging',\r\n  /**\r\n   * The text baseline is the middle of the em square.\r\n   */\r\n  Middle = 'middle',\r\n  /**\r\n   * The text baseline is the normal alphabetic baseline.\r\n   */\r\n  Alphabetic = 'alphabetic',\r\n  /**\r\n   * The text baseline is the ideographic baseline; this is the bottom of\r\n   * the body of the characters, if the main body of characters protrudes\r\n   * beneath the alphabetic baseline.  Currently unsupported; this will\r\n   * act like alphabetic.\r\n   */\r\n  Ideographic = 'ideographic',\r\n  /**\r\n   * The text baseline is the bottom of the bounding box.  This differs\r\n   * from the ideographic baseline in that the ideographic baseline\r\n   * doesn't consider descenders.\r\n   */\r\n  Bottom = 'bottom'\r\n}\r\n\r\n/**\r\n * Enum representing the different possible font styles\r\n */\r\nexport enum FontStyle {\r\n  Normal = 'normal',\r\n  Italic = 'italic',\r\n  Oblique = 'oblique'\r\n}\r\n\r\n/**\r\n * Enum representing the text direction, useful for other languages, or writing text in reverse\r\n */\r\nexport enum Direction {\r\n  LeftToRight = 'ltr',\r\n  RightToLeft = 'rtl'\r\n}\r\n\r\n/**\r\n * Font rendering option\r\n */\r\nexport interface FontOptions {\r\n  /**\r\n   * Optionally the size of the font in the specified {@apilink FontUnit} by default 10.\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally specify unit to measure fonts in, by default Pixels\r\n   */\r\n  unit?: FontUnit;\r\n  /**\r\n   * Optionally specify the font family, by default 'sans-serif'\r\n   */\r\n  family?: string;\r\n  /**\r\n   * Optionally specify the font style, by default Normal\r\n   */\r\n  style?: FontStyle;\r\n  /**\r\n   * Optionally set whether the font is bold, by default false\r\n   */\r\n  bold?: boolean;\r\n  /**\r\n   * Optionally specify the text align, by default Left\r\n   */\r\n  textAlign?: TextAlign;\r\n  /**\r\n   * Optionally specify the text base align, by default Alphabetic\r\n   */\r\n  baseAlign?: BaseAlign;\r\n  /**\r\n   * Optionally specify the text direction, by default LeftToRight\r\n   */\r\n  direction?: Direction;\r\n  /**\r\n   * Optionally override the text line height in pixels, useful for multiline text. If unset will use default.\r\n   */\r\n  lineHeight?: number | undefined;\r\n  /**\r\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\r\n   * Higher quality text has a higher memory impact\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify a text shadow, by default none is specified\r\n   */\r\n  shadow?: {\r\n    blur?: number;\r\n    offset?: Vector;\r\n    color?: Color;\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface FontRenderer {\r\n  measureText(text: string): BoundingBox;\r\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\r\n}\r\n","import { Scene } from './Scene';\r\nimport { Vector } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { Trigger } from './Trigger';\r\nimport { FrameStats } from './Debug';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Side } from './Collision/Side';\r\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\r\nimport { Collider } from './Collision/Colliders/Collider';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate, SceneActivationContext, OnAdd, OnRemove } from './Interfaces/LifecycleEvents';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\nimport { Axes, Buttons, Gamepad } from './Input/Gamepad';\r\nimport { Action } from './Actions/Action';\r\n\r\nexport enum EventTypes {\r\n  Kill = 'kill',\r\n  PreKill = 'prekill',\r\n  PostKill = 'postkill',\r\n\r\n  PreDraw = 'predraw',\r\n  PostDraw = 'postdraw',\r\n\r\n  PreDebugDraw = 'predebugdraw',\r\n  PostDebugDraw = 'postdebugdraw',\r\n\r\n  PreUpdate = 'preupdate',\r\n  PostUpdate = 'postupdate',\r\n\r\n  PreFrame = 'preframe',\r\n  PostFrame = 'postframe',\r\n\r\n  PreCollision = 'precollision',\r\n  CollisionStart = 'collisionstart',\r\n  CollisionEnd = 'collisionend',\r\n  PostCollision = 'postcollision',\r\n\r\n  Initialize = 'initialize',\r\n  Activate = 'activate',\r\n  Deactivate = 'deactivate',\r\n\r\n  ExitViewport = 'exitviewport',\r\n  EnterViewport = 'enterviewport',\r\n\r\n  ExitTrigger = 'exit',\r\n  EnterTrigger = 'enter',\r\n\r\n  Connect = 'connect',\r\n  Disconnect = 'disconnect',\r\n  Button = 'button',\r\n  Axis = 'axis',\r\n\r\n  Visible = 'visible',\r\n  Hidden = 'hidden',\r\n  Start = 'start',\r\n  Stop = 'stop',\r\n\r\n  PointerUp = 'pointerup',\r\n  PointerDown = 'pointerdown',\r\n  PointerMove = 'pointermove',\r\n  PointerEnter = 'pointerenter',\r\n  PointerLeave = 'pointerleave',\r\n  PointerCancel = 'pointercancel',\r\n  PointerWheel = 'pointerwheel',\r\n\r\n  Up = 'up',\r\n  Down = 'down',\r\n  Move = 'move',\r\n  Enter = 'enter',\r\n  Leave = 'leave',\r\n  Cancel = 'cancel',\r\n  Wheel = 'wheel',\r\n\r\n  Press = 'press',\r\n  Release = 'release',\r\n  Hold = 'hold',\r\n\r\n  PointerDragStart = 'pointerdragstart',\r\n  PointerDragEnd = 'pointerdragend',\r\n  PointerDragEnter = 'pointerdragenter',\r\n  PointerDragLeave = 'pointerdragleave',\r\n  PointerDragMove = 'pointerdragmove',\r\n\r\n  ActionStart = 'actionstart',\r\n  ActionComplete = 'actioncomplete',\r\n\r\n  Add = 'add',\r\n  Remove = 'remove'\r\n}\r\n\r\n/* istanbul ignore next */\r\n/* compiler only: these are internal to lib */\r\nexport type kill = 'kill';\r\nexport type prekill = 'prekill';\r\nexport type postkill = 'postkill';\r\n\r\nexport type predraw = 'predraw';\r\nexport type postdraw = 'postdraw';\r\n\r\nexport type predebugdraw = 'predebugdraw';\r\nexport type postdebugdraw = 'postdebugdraw';\r\n\r\nexport type preupdate = 'preupdate';\r\nexport type postupdate = 'postupdate';\r\n\r\nexport type preframe = 'preframe';\r\nexport type postframe = 'postframe';\r\n\r\nexport type precollision = 'precollision';\r\nexport type collisionstart = 'collisionstart';\r\nexport type collisionend = 'collisionend';\r\nexport type postcollision = 'postcollision';\r\n\r\nexport type initialize = 'initialize';\r\nexport type activate = 'activate';\r\nexport type deactivate = 'deactivate';\r\n\r\nexport type exitviewport = 'exitviewport';\r\nexport type enterviewport = 'enterviewport';\r\n\r\nexport type exittrigger = 'exit';\r\nexport type entertrigger = 'enter';\r\n\r\nexport type connect = 'connect';\r\nexport type disconnect = 'disconnect';\r\nexport type button = 'button';\r\nexport type axis = 'axis';\r\n\r\nexport type subscribe = 'subscribe';\r\nexport type unsubscribe = 'unsubscribe';\r\n\r\nexport type visible = 'visible';\r\nexport type hidden = 'hidden';\r\nexport type start = 'start';\r\nexport type stop = 'stop';\r\n\r\nexport type pointerup = 'pointerup';\r\nexport type pointerdown = 'pointerdown';\r\nexport type pointermove = 'pointermove';\r\nexport type pointerenter = 'pointerenter';\r\nexport type pointerleave = 'pointerleave';\r\nexport type pointercancel = 'pointercancel';\r\nexport type pointerwheel = 'pointerwheel';\r\n\r\nexport type up = 'up';\r\nexport type down = 'down';\r\nexport type move = 'move';\r\nexport type enter = 'enter';\r\nexport type leave = 'leave';\r\nexport type cancel = 'cancel';\r\nexport type wheel = 'wheel';\r\n\r\nexport type press = 'press';\r\nexport type release = 'release';\r\nexport type hold = 'hold';\r\n\r\nexport type pointerdragstart = 'pointerdragstart';\r\nexport type pointerdragend = 'pointerdragend';\r\nexport type pointerdragenter = 'pointerdragenter';\r\nexport type pointerdragleave = 'pointerdragleave';\r\nexport type pointerdragmove = 'pointerdragmove';\r\n\r\nexport type add = 'add';\r\nexport type remove = 'remove';\r\n\r\n/**\r\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\r\n * some events are unique to a type, others are not.\r\n *\r\n */\r\nexport class GameEvent<T, U = T> {\r\n  /**\r\n   * Target object for this event.\r\n   */\r\n  public target: T;\r\n\r\n  /**\r\n   * Other target object for this event\r\n   */\r\n  public other: U | null = null;\r\n\r\n  /**\r\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\r\n   * to all actors that apply.\r\n   */\r\n  public get bubbles(): boolean {\r\n    return this._bubbles;\r\n  }\r\n\r\n  public set bubbles(value: boolean) {\r\n    this._bubbles = value;\r\n  }\r\n\r\n  private _bubbles: boolean = true;\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation() {\r\n    this.bubbles = false;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\r\n */\r\nexport class KillEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'prekill' event is emitted directly before an actor is killed.\r\n */\r\nexport class PreKillEvent extends GameEvent<Actor> {\r\n  constructor(public self: Actor) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postkill' event is emitted directly after the actor is killed.\r\n */\r\nexport class PostKillEvent extends GameEvent<Actor> {\r\n  constructor(public self: Actor) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'start' event is emitted on engine when has started and is ready for interaction.\r\n */\r\nexport class GameStartEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\r\n */\r\nexport class GameStopEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity | Scene | Engine | TileMap\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity | Scene | Engine | TileMap\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'pretransformdraw' event is emitted on actors/entities before any graphics transforms have taken place.\r\n * Useful if you need to completely customize the draw or modify the transform before drawing in the draw step (for example needing\r\n * latest camera positions)\r\n *\r\n */\r\nexport class PreTransformDrawEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'posttransformdraw' event is emitted on actors/entities after all graphics have been draw and transforms reset.\r\n * Useful if you need to completely custom the draw after everything is done.\r\n *\r\n */\r\nexport class PostTransformDrawEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\r\n */\r\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public self: Entity | Actor | Scene | Engine\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\r\n */\r\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public self: Entity | Actor | Scene | Engine\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\r\n */\r\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public elapsed: number,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\r\n */\r\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public elapsed: number,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preframe' event is emitted on the engine, before the frame begins.\r\n */\r\nexport class PreFrameEvent extends GameEvent<Engine> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public prevStats: FrameStats\r\n  ) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postframe' event is emitted on the engine, after a frame ends.\r\n */\r\nexport class PostFrameEvent extends GameEvent<Engine> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public stats: FrameStats\r\n  ) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is connected to Excalibur. {@apilink Gamepads} receives this event.\r\n */\r\nexport class GamepadConnectEvent extends GameEvent<Gamepad> {\r\n  constructor(\r\n    public index: number,\r\n    public gamepad: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is disconnected from Excalibur. {@apilink Gamepads} receives this event.\r\n */\r\nexport class GamepadDisconnectEvent extends GameEvent<Gamepad> {\r\n  constructor(\r\n    public index: number,\r\n    public gamepad: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad button event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\r\n */\r\nexport class GamepadButtonEvent extends GameEvent<Gamepad> {\r\n  /**\r\n   * @param button  The Gamepad {@apilink Buttons} if not known by excalibur {@apilink Buttons.Unknown} is returned, use index to disambiguate.\r\n   * @param index   The canonical index of the gamepad button from the system\r\n   * @param value   A numeric value between 0 and 1\r\n   * @param self    Reference to the gamepad\r\n   */\r\n  constructor(\r\n    /**\r\n     * The Gamepad {@apilink Buttons} if not known by excalibur {@apilink Buttons.Unknown} is returned, use index to disambiguate.\r\n     */\r\n    public button: Buttons,\r\n    /**\r\n     * The canonical index of the gamepad button from the system\r\n     */\r\n    public index: number,\r\n    /**\r\n     * A numeric value between 0 and 1\r\n     */\r\n    public value: number,\r\n    /**\r\n     * Reference to the gamepad\r\n     */\r\n    public self: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad axis event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\r\n */\r\nexport class GamepadAxisEvent extends GameEvent<Gamepad> {\r\n  /**\r\n   * @param axis  The Gamepad axis\r\n   * @param value A numeric value between -1 and 1\r\n   * @param self Reference to the gamepad\r\n   */\r\n  constructor(\r\n    /**\r\n     * The Gamepad {@apilink Axis}\r\n     */\r\n    public axis: Axes,\r\n    /**\r\n     * A numeric value between -1 and 1, 0 is the neutral axis position.\r\n     */\r\n    public value: number,\r\n    /**\r\n     * Reference to the gamepad\r\n     */\r\n    public self: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the {@apilink Engine} when the browser window is visible on a screen.\r\n */\r\nexport class VisibleEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the {@apilink Engine} when the browser window is hidden from all screens.\r\n */\r\nexport class HiddenEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor | `actor`} when a collision will occur this frame if it resolves\r\n */\r\nexport class PreCollisionEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   * @param self          The actor the event was thrown on\r\n   * @param other         The actor that will collided with the current actor\r\n   * @param side          The side that will be collided with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor | `actor`} when a collision has been resolved (body reacted) this frame\r\n */\r\nexport class PostCollisionEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   * @param self          The actor the event was thrown on\r\n   * @param other         The actor that did collide with the current actor\r\n   * @param side          The side that did collide with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class ContactStartEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class ContactEndEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public lastContact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class CollisionPreSolveEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class CollisionPostSolveEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\n/**\r\n * Event thrown the first time an {@apilink Actor | `actor`} collides with another, after an actor is in contact normal collision events are fired.\r\n */\r\nexport class CollisionStartEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown when the {@apilink Actor | `actor`} is no longer colliding with another\r\n */\r\nexport class CollisionEndEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public lastContact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor}, {@apilink Scene}, and {@apilink Engine} only once before the first update call\r\n */\r\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\r\n  /**\r\n   * @param engine  The reference to the current engine\r\n   */\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a {@apilink Scene} on activation\r\n */\r\nexport class ActivateEvent<TData = undefined> extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene activation\r\n   */\r\n  constructor(\r\n    public context: SceneActivationContext<TData>,\r\n    public self: Scene\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a {@apilink Scene} on deactivation\r\n */\r\nexport class DeactivateEvent extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene deactivation\r\n   */\r\n  constructor(\r\n    public context: SceneActivationContext<never>,\r\n    public self: Scene\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when the graphics bounds completely leaves the screen.\r\n */\r\nexport class ExitViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when any part of the graphics bounds are on screen.\r\n */\r\nexport class EnterViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class EnterTriggerEvent extends GameEvent<Trigger> {\r\n  constructor(\r\n    public self: Trigger,\r\n    public entity: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class ExitTriggerEvent extends GameEvent<Trigger> {\r\n  constructor(\r\n    public self: Trigger,\r\n    public entity: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when an action starts.\r\n */\r\nexport class ActionStartEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public action: Action,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when an action completes.\r\n */\r\nexport class ActionCompleteEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public action: Action,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when an Actor added to scene.\r\n */\r\nexport class AddEvent<T extends OnAdd> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when an Actor removed from scene.\r\n */\r\nexport class RemoveEvent<T extends OnRemove> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\r\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\r\n */\r\nexport type LineCapStyle = 'butt' | 'round' | 'square';\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw a line on canvas context\r\n * @param ctx The canvas context\r\n * @param color The color of the line\r\n * @param x1 The start x coordinate\r\n * @param y1 The start y coordinate\r\n * @param x2 The ending x coordinate\r\n * @param y2 The ending y coordinate\r\n * @param thickness The line thickness\r\n * @param cap The {@apilink LineCapStyle} (butt, round, or square)\r\n */\r\nexport function line(\r\n  ctx: CanvasRenderingContext2D,\r\n  color: Color = Color.Red,\r\n  x1: number,\r\n  y1: number,\r\n  x2: number,\r\n  y2: number,\r\n  thickness: number = 1,\r\n  cap: LineCapStyle = 'butt'\r\n) {\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.lineWidth = thickness;\r\n  ctx.lineCap = cap;\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.moveTo(x1, y1);\r\n  ctx.lineTo(x2, y2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw the vector as a point onto the canvas.\r\n */\r\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw the vector as a line onto the canvas starting a origin point.\r\n */\r\n/* istanbul ignore next */\r\n/**\r\n *\r\n */\r\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\r\n  const c = color ? color.toString() : 'blue';\r\n  const v = vector.scale(scale);\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = c;\r\n  ctx.moveTo(origin.x, origin.y);\r\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Represents border radius values\r\n */\r\nexport interface BorderRadius {\r\n  /**\r\n   * Top-left\r\n   */\r\n  tl: number;\r\n  /**\r\n   * Top-right\r\n   */\r\n  tr: number;\r\n  /**\r\n   * Bottom-right\r\n   */\r\n  br: number;\r\n  /**\r\n   * Bottom-left\r\n   */\r\n  bl: number;\r\n}\r\n\r\n/**\r\n * Draw a round rectangle on a canvas context\r\n * @param ctx The canvas context\r\n * @param x The top-left x coordinate\r\n * @param y The top-left y coordinate\r\n * @param width The width of the rectangle\r\n * @param height The height of the rectangle\r\n * @param radius The border radius of the rectangle\r\n * @param stroke The {@apilink Color} to stroke rectangle with\r\n * @param fill The {@apilink Color} to fill rectangle with\r\n */\r\nexport function roundRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  radius: number | BorderRadius = 5,\r\n  stroke: Color | null = Color.White,\r\n  fill: Color | null = null\r\n) {\r\n  let br: BorderRadius;\r\n\r\n  if (typeof radius === 'number') {\r\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\r\n  } else {\r\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n\r\n    for (const prop in defaultRadius) {\r\n      if (defaultRadius.hasOwnProperty(prop)) {\r\n        const side = <keyof BorderRadius>prop;\r\n        br[side] = radius[side] || defaultRadius[side];\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + br.tl, y);\r\n  ctx.lineTo(x + width - br.tr, y);\r\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\r\n  ctx.lineTo(x + width, y + height - br.br);\r\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\r\n  ctx.lineTo(x + br.bl, y + height);\r\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\r\n  ctx.lineTo(x, y + br.tl);\r\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function circle(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { line } from '../Util/DrawUtil';\r\nimport { ExcaliburGraphicsContextWebGL } from './Context/ExcaliburGraphicsContextWebGL';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Font } from './Font';\r\n\r\nexport class FontTextInstance {\r\n  public canvas: HTMLCanvasElement;\r\n  public ctx: CanvasRenderingContext2D;\r\n  private _textFragments: { x: number; y: number; canvas: HTMLCanvasElement }[] = [];\r\n  public dimensions: BoundingBox;\r\n  public disposed: boolean = false;\r\n  private _lastHashCode: string;\r\n\r\n  constructor(\r\n    public readonly font: Font,\r\n    public readonly text: string,\r\n    public readonly color: Color,\r\n    public readonly maxWidth?: number\r\n  ) {\r\n    this.canvas = document.createElement('canvas');\r\n    const ctx = this.canvas.getContext('2d');\r\n    if (!ctx) {\r\n      throw new Error('Unable to create FontTextInstance, internal canvas failed to create');\r\n    }\r\n    this.ctx = ctx;\r\n    this.dimensions = this.measureText(text);\r\n    this._setDimension(this.dimensions, this.ctx);\r\n    this._lastHashCode = this.getHashCode();\r\n  }\r\n\r\n  measureText(text: string, maxWidth?: number): BoundingBox {\r\n    if (this.disposed) {\r\n      throw Error('Accessing disposed text instance! ' + this.text);\r\n    }\r\n    let lines = null;\r\n    if (maxWidth != null) {\r\n      lines = this._getLinesFromText(text, maxWidth);\r\n    } else {\r\n      lines = text.split('\\n');\r\n    }\r\n\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n\r\n    this._applyFont(this.ctx); // font must be applied to the context to measure it\r\n    const metrics = this.ctx.measureText(maxWidthLine);\r\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\r\n\r\n    // TODO line height makes the text bounds wonky\r\n    const lineAdjustedHeight = textHeight * lines.length;\r\n    textHeight = lineAdjustedHeight;\r\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\r\n    const x = 0;\r\n    const y = 0;\r\n    const measurement = new BoundingBox({\r\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.font.padding,\r\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.font.padding,\r\n      bottom: y + bottomBounds + this.font.padding,\r\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.font.padding\r\n    });\r\n\r\n    return measurement;\r\n  }\r\n\r\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\r\n    let lineHeightRatio = 1;\r\n    if (this.font.lineHeight) {\r\n      lineHeightRatio = this.font.lineHeight / this.font.size;\r\n    }\r\n    // Changing the width and height clears the context properties\r\n    // We double the bitmap width to account for all possible alignment\r\n    // We scale by \"quality\" so we render text without jaggies\r\n    bitmap.canvas.width = (textBounds.width + this.font.padding * 2) * 2 * this.font.quality;\r\n    bitmap.canvas.height = (textBounds.height + this.font.padding * 2) * 2 * this.font.quality * lineHeightRatio;\r\n  }\r\n\r\n  public static getHashCode(font: Font, text: string, color?: Color) {\r\n    const hash =\r\n      text +\r\n      '__hashcode__' +\r\n      font.fontString +\r\n      font.showDebug +\r\n      font.textAlign +\r\n      font.baseAlign +\r\n      font.direction +\r\n      font.lineHeight +\r\n      JSON.stringify(font.shadow) +\r\n      (font.padding.toString() +\r\n        font.smoothing.toString() +\r\n        font.lineWidth.toString() +\r\n        font.lineDash.toString() +\r\n        font.strokeColor?.toString() +\r\n        (color ? color.toString() : font.color.toString()));\r\n    return hash;\r\n  }\r\n\r\n  getHashCode(includeColor: boolean = true) {\r\n    return FontTextInstance.getHashCode(this.font, this.text, includeColor ? this.color : undefined);\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    ctx.translate(this.font.padding, this.font.padding);\r\n    ctx.imageSmoothingEnabled = this.font.smoothing;\r\n    ctx.lineWidth = this.font.lineWidth;\r\n    ctx.setLineDash(this.font.lineDash ?? ctx.getLineDash());\r\n    ctx.strokeStyle = this.font.strokeColor?.toString() ?? '';\r\n    ctx.fillStyle = this.color.toString();\r\n  }\r\n\r\n  private _applyFont(ctx: CanvasRenderingContext2D) {\r\n    ctx.resetTransform();\r\n    ctx.translate(this.font.padding + ctx.canvas.width / 2, this.font.padding + ctx.canvas.height / 2);\r\n    ctx.scale(this.font.quality, this.font.quality);\r\n    ctx.textAlign = this.font.textAlign;\r\n    ctx.textBaseline = this.font.baseAlign;\r\n    ctx.font = this.font.fontString;\r\n    ctx.direction = this.font.direction;\r\n\r\n    if (this.font.shadow) {\r\n      if (this.font.shadow.color) {\r\n        ctx.shadowColor = this.font.shadow.color.toString();\r\n      }\r\n      if (this.font.shadow.blur) {\r\n        ctx.shadowBlur = this.font.shadow.blur;\r\n      }\r\n      if (this.font.shadow.offset) {\r\n        ctx.shadowOffsetX = this.font.shadow.offset.x;\r\n        ctx.shadowOffsetY = this.font.shadow.offset.y;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _drawText(ctx: CanvasRenderingContext2D, lines: string[], lineHeight: number): void {\r\n    this._applyRasterProperties(ctx);\r\n    this._applyFont(ctx);\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (this.color) {\r\n        ctx.fillText(line, 0, i * lineHeight);\r\n      }\r\n\r\n      if (this.font.strokeColor) {\r\n        ctx.strokeText(line, 0, i * lineHeight);\r\n      }\r\n    }\r\n\r\n    if (this.font.showDebug) {\r\n      // Horizontal line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Green, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\r\n      // Vertical line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\r\n    }\r\n  }\r\n\r\n  private _splitTextBitmap(bitmap: CanvasRenderingContext2D) {\r\n    const textImages: { x: number; y: number; canvas: HTMLCanvasElement }[] = [];\r\n    let currentX = 0;\r\n    let currentY = 0;\r\n    // 4k is the max for mobile devices\r\n    const width = Math.min(4096, bitmap.canvas.width);\r\n    const height = Math.min(4096, bitmap.canvas.height);\r\n\r\n    // Splits the original bitmap into 4k max chunks\r\n    while (currentX < bitmap.canvas.width) {\r\n      while (currentY < bitmap.canvas.height) {\r\n        // create new bitmap\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n          throw new Error('Unable to split internal FontTextInstance bitmap, failed to create internal canvas');\r\n        }\r\n\r\n        // draw current slice to new bitmap in < 4k chunks\r\n        ctx.drawImage(bitmap.canvas, currentX, currentY, width, height, 0, 0, width, height);\r\n\r\n        textImages.push({ x: currentX, y: currentY, canvas });\r\n        currentY += height;\r\n      }\r\n      currentX += width;\r\n      currentY = 0;\r\n    }\r\n    return textImages;\r\n  }\r\n\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n  private _dirty = true;\r\n  private _ex?: ExcaliburGraphicsContext;\r\n  public render(ex: ExcaliburGraphicsContext, x: number, y: number, maxWidth?: number) {\r\n    if (this.disposed) {\r\n      throw Error('Accessing disposed text instance! ' + this.text);\r\n    }\r\n    this._ex = ex;\r\n    const hashCode = this.getHashCode();\r\n    if (this._lastHashCode !== hashCode) {\r\n      this._dirty = true;\r\n    }\r\n\r\n    // Calculate image chunks\r\n    if (this._dirty) {\r\n      this.dimensions = this.measureText(this.text, maxWidth);\r\n      this._setDimension(this.dimensions, this.ctx);\r\n      const lines = this._getLinesFromText(this.text, maxWidth);\r\n      const lineHeight = this.font.lineHeight ?? this.dimensions.height / lines.length;\r\n\r\n      // draws the text to the main bitmap\r\n      this._drawText(this.ctx, lines, lineHeight);\r\n\r\n      // clear any out old fragments\r\n      if (ex instanceof ExcaliburGraphicsContextWebGL) {\r\n        for (const frag of this._textFragments) {\r\n          ex.textureLoader.delete(frag.canvas);\r\n        }\r\n      }\r\n\r\n      // splits to < 4k fragments for large text\r\n      this._textFragments = this._splitTextBitmap(this.ctx);\r\n\r\n      if (ex instanceof ExcaliburGraphicsContextWebGL) {\r\n        for (const frag of this._textFragments) {\r\n          ex.textureLoader.load(frag.canvas, { filtering: this.font.filtering }, true);\r\n        }\r\n      }\r\n      this._lastHashCode = hashCode;\r\n      this._dirty = false;\r\n    }\r\n\r\n    // draws the bitmap fragments to excalibur graphics context\r\n    for (const frag of this._textFragments) {\r\n      ex.drawImage(\r\n        frag.canvas,\r\n        0,\r\n        0,\r\n        frag.canvas.width,\r\n        frag.canvas.height,\r\n        frag.x / this.font.quality + x - this.ctx.canvas.width / this.font.quality / 2,\r\n        frag.y / this.font.quality + y - this.ctx.canvas.height / this.font.quality / 2,\r\n        frag.canvas.width / this.font.quality,\r\n        frag.canvas.height / this.font.quality\r\n      );\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    this.disposed = true;\r\n    this.dimensions = undefined as any;\r\n    this.canvas = undefined as any;\r\n    this.ctx = undefined as any;\r\n    if (this._ex instanceof ExcaliburGraphicsContextWebGL) {\r\n      for (const frag of this._textFragments) {\r\n        this._ex.textureLoader.delete(frag.canvas);\r\n      }\r\n    }\r\n    this._textFragments.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Return array of lines split based on the \\n character, and the maxWidth? constraint\r\n   * @param text\r\n   * @param maxWidth\r\n   */\r\n  private _cachedText?: string;\r\n  private _cachedLines?: string[];\r\n  private _cachedRenderWidth?: number;\r\n  private _getLinesFromText(text: string, maxWidth?: number): string[] {\r\n    if (this._cachedText === text && this._cachedRenderWidth === maxWidth && this._cachedLines?.length) {\r\n      return this._cachedLines;\r\n    }\r\n\r\n    const lines = text.split('\\n');\r\n\r\n    if (maxWidth == null) {\r\n      return lines;\r\n    }\r\n\r\n    // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\r\n    for (let i = 0; i < lines.length; i++) {\r\n      let line = lines[i];\r\n      let newLine = '';\r\n      if (this.measureText(line).width > maxWidth) {\r\n        while (this.measureText(line).width > maxWidth) {\r\n          newLine = line[line.length - 1] + newLine;\r\n          line = line.slice(0, -1); // Remove last character from line\r\n        }\r\n\r\n        // Update the array with our new values\r\n        lines[i] = line;\r\n        lines[i + 1] = newLine;\r\n      }\r\n    }\r\n\r\n    this._cachedText = text;\r\n    this._cachedLines = lines;\r\n    this._cachedRenderWidth = maxWidth;\r\n\r\n    return lines;\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Logger } from '../Util/Log';\r\nimport { Font } from './Font';\r\nimport { FontTextInstance } from './FontTextInstance';\r\n\r\nexport class FontCache {\r\n  public static FONT_TIMEOUT = 500;\r\n  private static _LOGGER = Logger.getInstance();\r\n  private static _TEXT_USAGE = new Map<FontTextInstance, number>();\r\n  private static _TEXT_CACHE = new Map<string, FontTextInstance>();\r\n  private static _MEASURE_CACHE = new Map<string, BoundingBox>();\r\n\r\n  static measureText(text: string, font: Font, maxWidth?: number): BoundingBox {\r\n    const hash = FontTextInstance.getHashCode(font, text);\r\n    if (FontCache._MEASURE_CACHE.has(hash)) {\r\n      return FontCache._MEASURE_CACHE.get(hash)!;\r\n    }\r\n    FontCache._LOGGER.debug('Font text measurement cache miss');\r\n    const measurement = font.measureTextWithoutCache(text, maxWidth);\r\n    FontCache._MEASURE_CACHE.set(hash, measurement);\r\n    return measurement;\r\n  }\r\n\r\n  static getTextInstance(text: string, font: Font, color: Color): FontTextInstance {\r\n    const hash = FontTextInstance.getHashCode(font, text, color);\r\n    let textInstance = FontCache._TEXT_CACHE.get(hash);\r\n    if (!textInstance) {\r\n      textInstance = new FontTextInstance(font, text, color);\r\n      FontCache._TEXT_CACHE.set(hash, textInstance);\r\n      FontCache._LOGGER.debug('Font text instance cache miss');\r\n    }\r\n\r\n    // Cache the bitmap for certain amount of time\r\n    FontCache._TEXT_USAGE.set(textInstance, performance.now());\r\n\r\n    return textInstance;\r\n  }\r\n\r\n  static checkAndClearCache() {\r\n    const deferred: FontTextInstance[] = [];\r\n    const currentHashCodes = new Set<string>();\r\n    for (const [textInstance, time] of FontCache._TEXT_USAGE.entries()) {\r\n      // if bitmap hasn't been used in 100 ms clear it\r\n      if (time + FontCache.FONT_TIMEOUT < performance.now()) {\r\n        FontCache._LOGGER.debug(`Text cache entry timed out ${textInstance.text}`);\r\n        deferred.push(textInstance);\r\n        textInstance.dispose();\r\n      } else {\r\n        const hash = textInstance.getHashCode(false);\r\n        currentHashCodes.add(hash);\r\n      }\r\n    }\r\n    // Deferred removal of text instances\r\n    deferred.forEach((t) => {\r\n      FontCache._TEXT_USAGE.delete(t);\r\n    });\r\n\r\n    // Regenerate text instance cache\r\n    this._TEXT_CACHE.clear();\r\n    for (const [textInstance] of this._TEXT_USAGE.entries()) {\r\n      this._TEXT_CACHE.set(textInstance.getHashCode(), textInstance);\r\n    }\r\n\r\n    // Regenerated measurement cache\r\n    const newTextMeasurementCache = new Map<string, BoundingBox>();\r\n    for (const current of currentHashCodes) {\r\n      if (FontCache._MEASURE_CACHE.has(current)) {\r\n        newTextMeasurementCache.set(current, FontCache._MEASURE_CACHE.get(current)!);\r\n      }\r\n    }\r\n    this._MEASURE_CACHE.clear();\r\n    this._MEASURE_CACHE = newTextMeasurementCache;\r\n  }\r\n\r\n  public static get cacheSize() {\r\n    return FontCache._TEXT_USAGE.size;\r\n  }\r\n\r\n  /**\r\n   * Force clear all cached text bitmaps\r\n   */\r\n  public static clearCache() {\r\n    for (const [textInstance] of FontCache._TEXT_USAGE.entries()) {\r\n      textInstance.dispose();\r\n    }\r\n    FontCache._TEXT_USAGE.clear();\r\n    FontCache._TEXT_CACHE.clear();\r\n    FontCache._MEASURE_CACHE.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Color } from '../Color';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { RasterOptions } from './Raster';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { FontTextInstance } from './FontTextInstance';\r\nimport { FontCache } from './FontCache';\r\n/**\r\n * Represents a system or web font in Excalibur\r\n *\r\n * If no options specified, the system sans-serif 10 pixel is used\r\n *\r\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\r\n */\r\nexport class Font extends Graphic implements FontRenderer {\r\n  /**\r\n   * Set the font filtering mode, by default set to {@apilink ImageFiltering.Blended} regardless of the engine default smoothing\r\n   *\r\n   * If you have a pixel style font that may be a reason to switch this to {@apilink ImageFiltering.Pixel}\r\n   */\r\n  public filtering: ImageFiltering = ImageFiltering.Blended;\r\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\r\n    super(options); // <- Graphics properties\r\n\r\n    // Raster properties\r\n    this.smoothing = options?.smoothing ?? this.smoothing;\r\n    this.padding = options?.padding ?? this.padding;\r\n    this.color = options?.color ?? this.color;\r\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\r\n    this.lineDash = options?.lineDash ?? this.lineDash;\r\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\r\n    this.filtering = options?.filtering ?? this.filtering;\r\n\r\n    // Font specific properties\r\n    this.family = options?.family ?? this.family;\r\n    this.style = options?.style ?? this.style;\r\n    this.bold = options?.bold ?? this.bold;\r\n    this.size = options?.size ?? this.size;\r\n    this.unit = options?.unit ?? this.unit;\r\n    this.textAlign = options?.textAlign ?? this.textAlign;\r\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\r\n    this.direction = options?.direction ?? this.direction;\r\n    this.lineHeight = options?.lineHeight ?? this.lineHeight;\r\n    this.quality = options?.quality ?? this.quality;\r\n    if (options?.shadow) {\r\n      this.shadow = {};\r\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\r\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\r\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\r\n    }\r\n  }\r\n\r\n  public clone() {\r\n    return new Font({\r\n      ...this.cloneGraphicOptions(),\r\n      size: this.size,\r\n      unit: this.unit,\r\n      family: this.family,\r\n      style: this.style,\r\n      bold: this.bold,\r\n      textAlign: this.textAlign,\r\n      baseAlign: this.baseAlign,\r\n      direction: this.direction,\r\n      shadow: this.shadow\r\n        ? {\r\n            blur: this.shadow.blur,\r\n            offset: this.shadow.offset,\r\n            color: this.shadow.color\r\n          }\r\n        : undefined\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\r\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\r\n   *\r\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\r\n   *\r\n   * (Default 2)\r\n   */\r\n  public quality = 2;\r\n\r\n  // Raster properties for fonts\r\n  public padding = 2;\r\n  public smoothing = false;\r\n  public lineWidth = 1;\r\n  public lineDash: number[] = [];\r\n  public color: Color = Color.Black;\r\n  public strokeColor?: Color;\r\n\r\n  public family: string = 'sans-serif';\r\n  public style: FontStyle = FontStyle.Normal;\r\n  public bold: boolean = false;\r\n  public unit: FontUnit = FontUnit.Px;\r\n  public textAlign: TextAlign = TextAlign.Left;\r\n  public baseAlign: BaseAlign = BaseAlign.Top;\r\n  public direction: Direction = Direction.LeftToRight;\r\n  /**\r\n   * Font line height in pixels, default line height if unset\r\n   */\r\n  public lineHeight: number | undefined = undefined;\r\n  public size: number = 10;\r\n  public shadow?: { blur?: number; offset?: Vector; color?: Color };\r\n\r\n  public get fontString() {\r\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\r\n  }\r\n\r\n  private _textBounds: BoundingBox = new BoundingBox();\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this._textBounds;\r\n  }\r\n\r\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\r\n    // TODO weird vestigial drawimage\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext) {\r\n    // TODO this needs to change depending on the bounding box...\r\n    const origin = this.origin ?? this._textBounds.center;\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this._textBounds.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  private _textMeasurement = new FontTextInstance(this, '', Color.Black);\r\n\r\n  public measureTextWithoutCache(text: string, maxWidth?: number) {\r\n    return this._textMeasurement.measureText(text, maxWidth);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox that is the total size of the text including multiple lines\r\n   *\r\n   * Does not include any padding or adjustment\r\n   * @param text\r\n   * @returns BoundingBox\r\n   */\r\n  public measureText(text: string, maxWidth?: number): BoundingBox {\r\n    return FontCache.measureText(text, this, maxWidth);\r\n  }\r\n\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    ex.restore();\r\n  }\r\n\r\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number, maxWidth?: number) {\r\n    const textInstance = FontCache.getTextInstance(text, this, colorOverride);\r\n\r\n    // Apply affine transformations\r\n    this._textBounds = textInstance.dimensions;\r\n    this._preDraw(ex, x, y);\r\n\r\n    textInstance.render(ex, x, y, maxWidth);\r\n\r\n    this._postDraw(ex);\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\n\r\nexport interface TextOptions {\r\n  /**\r\n   * Text to draw\r\n   */\r\n  text: string;\r\n\r\n  /**\r\n   * Optionally override the font color, currently unsupported by SpriteFont\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\r\n   */\r\n  font?: Font | SpriteFont;\r\n\r\n  /**\r\n   * Optionally specify a maximum width in pixels for our text, and wrap to the next line if needed.\r\n   */\r\n  maxWidth?: number;\r\n}\r\n\r\n/**\r\n * Represent Text graphics in excalibur\r\n *\r\n * Useful for in game labels, ui, or overlays\r\n */\r\nexport class Text extends Graphic {\r\n  public color?: Color;\r\n  public maxWidth?: number;\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n    this.maxWidth = options.maxWidth;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color?.clone() ?? Color.Black,\r\n      font: this.font.clone(),\r\n      maxWidth: this.maxWidth\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    this._calculateDimension();\r\n  }\r\n\r\n  private _font!: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    this._font = font;\r\n  }\r\n\r\n  private _textWidth: number = 0;\r\n\r\n  public get width() {\r\n    if (this._textWidth === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textWidth * this.scale.x;\r\n  }\r\n\r\n  private _textHeight: number = 0;\r\n  public get height() {\r\n    if (this._textHeight === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textHeight * this.scale.y;\r\n  }\r\n\r\n  private _calculateDimension() {\r\n    const { width, height } = this.font.measureText(this._text, this.maxWidth);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.measureText(this._text, this.maxWidth).scale(this.scale);\r\n  }\r\n\r\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.isStale() || this.font.isStale()) {\r\n      this.font.flipHorizontal = this.flipHorizontal;\r\n      this.font.flipVertical = this.flipVertical;\r\n      this.font.rotation = this.rotation;\r\n      this.font.origin = this.origin;\r\n      this.font.opacity = this.opacity;\r\n    }\r\n    this.font.tint = this.tint;\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    let color = Color.Black;\r\n    if (this.font instanceof Font) {\r\n      color = this.color ?? this.font.color;\r\n    }\r\n\r\n    const { width, height } = this.font.measureText(this._text, this.maxWidth);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n\r\n    this.font.render(ex, this._text, color, x, y, this.maxWidth);\r\n\r\n    if (this.font.showDebug) {\r\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\r\n      if (this.maxWidth != null) {\r\n        ex.debug.drawRect(x, y, this.maxWidth, this.height, {\r\n          color: Color.Yellow\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Material } from './Context/material';\r\nimport { Logger } from '../Util/Log';\r\nimport { WatchVector } from '../Math/watch-vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { GraphicsGroup } from '../Graphics/GraphicsGroup';\r\nimport { Color } from '../Color';\r\nimport { Raster } from './Raster';\r\nimport { Text } from './Text';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreTransformDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPostTransformDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally set the color of the graphics component\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally set a material to use on the graphic\r\n   */\r\n  material?: Material;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics and optionally the options per graphic\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic | { graphic: Graphic; options?: GraphicsShowOptions | undefined } };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component {\r\n  private _logger = Logger.getInstance();\r\n\r\n  private _current: string = 'default';\r\n  private _graphics: Record<string, Graphic> = {};\r\n  private _options: Record<string, GraphicsShowOptions | undefined> = {};\r\n\r\n  public material: Material | null = null;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws before the entity transform has been applied before any any graphics component drawing\r\n   */\r\n  public onPreTransformDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after all graphics component drawing\r\n   */\r\n  public onPostTransformDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  private _color?: Color;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   * @deprecated use isVisible\r\n   */\r\n  public get visible(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   * @deprecated use isVisible\r\n   */\r\n  public set visible(val: boolean) {\r\n    this.isVisible = val;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public isVisible: boolean = true;\r\n\r\n  /**\r\n   * Optionally force the graphic onscreen, default false. Not recommend to use for perf reasons, only if you known what you're doing.\r\n   */\r\n  public forceOnScreen: boolean = false;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _offset: Vector = new WatchVector(Vector.Zero, () => this.recalculateBounds());\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public get offset(): Vector {\r\n    return this._offset;\r\n  }\r\n  public set offset(value: Vector) {\r\n    this._offset = new WatchVector(value, () => this.recalculateBounds());\r\n    this.recalculateBounds();\r\n  }\r\n\r\n  private _anchor: Vector = new WatchVector(Vector.Half, () => this.recalculateBounds());\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n  public set anchor(value: Vector) {\r\n    this._anchor = new WatchVector(value, () => this.recalculateBounds());\r\n    this.recalculateBounds();\r\n  }\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color | undefined {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color | undefined) {\r\n    if (v) {\r\n      this._color = v.clone();\r\n      const currentGraphic = this.graphics.current;\r\n      if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\r\n        currentGraphic.color = this._color;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Flip all graphics horizontally along the y-axis\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  /**\r\n   * Flip all graphics vertically along the x-axis\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can effect performance, but is useful if you don't want\r\n   * changes to a graphic to effect all the places it is used.\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.isVisible,\r\n      graphics: {},\r\n      ...options\r\n    };\r\n\r\n    const {\r\n      current,\r\n      anchor,\r\n      color,\r\n      opacity,\r\n      visible,\r\n      graphics,\r\n      offset,\r\n      copyGraphics,\r\n      onPreDraw,\r\n      onPostDraw,\r\n      onPreTransformDraw,\r\n      onPostTransformDraw\r\n    } = options;\r\n\r\n    for (const [key, graphicOrOptions] of Object.entries(graphics as GraphicsComponentOptions)) {\r\n      if (graphicOrOptions instanceof Graphic) {\r\n        this._graphics[key] = graphicOrOptions;\r\n      } else {\r\n        this._graphics[key] = graphicOrOptions.graphic;\r\n        this._options[key] = graphicOrOptions.options;\r\n      }\r\n    }\r\n\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.color = color ?? this.color;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.onPreDraw = onPreTransformDraw ?? this.onPreTransformDraw;\r\n    this.onPostTransformDraw = onPostTransformDraw ?? this.onPostTransformDraw;\r\n    this.isVisible = !!visible;\r\n    this._current = current ?? this._current;\r\n    if (current && this._graphics[current]) {\r\n      this.use(current);\r\n    }\r\n  }\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n  public getOptions(name: string): GraphicsShowOptions | undefined {\r\n    return this._options[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphic\r\n   */\r\n  public get current(): Graphic | undefined {\r\n    return this._graphics[this._current];\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphic offsets\r\n   */\r\n  public get currentOptions(): GraphicsShowOptions | undefined {\r\n    return this._options[this._current];\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics options associated with this component\r\n   */\r\n  public get options(): { [graphicName: string]: GraphicsShowOptions | undefined } {\r\n    return this._options;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic, options?: GraphicsShowOptions): Graphic;\r\n  public add(name: string, graphic: Graphic, options?: GraphicsShowOptions): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphicOrOptions?: Graphic | GraphicsShowOptions, options?: GraphicsShowOptions): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic | null = null;\r\n    let optionsToSet: GraphicsShowOptions | undefined = undefined;\r\n    if (typeof nameOrGraphic === 'string' && graphicOrOptions instanceof Graphic) {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphicOrOptions;\r\n      optionsToSet = options;\r\n    }\r\n    if (nameOrGraphic instanceof Graphic && !(graphicOrOptions instanceof Graphic)) {\r\n      graphicToSet = nameOrGraphic;\r\n      optionsToSet = graphicOrOptions;\r\n    }\r\n\r\n    if (!graphicToSet) {\r\n      throw new Error('Need to provide a graphic or valid graphic string');\r\n    }\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    this._options[name] = this.copyGraphics ? { ...optionsToSet } : optionsToSet;\r\n    if (name === 'default') {\r\n      this.use('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Removes a registered graphic, if the removed graphic is the current it will switch to the default\r\n   * @param name\r\n   */\r\n  public remove(name: string) {\r\n    delete this._graphics[name];\r\n    delete this._options[name];\r\n    if (this._current === name) {\r\n      this._current = 'default';\r\n      this.recalculateBounds();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, will set the default graphic. Returns the new {@apilink Graphic}\r\n   *\r\n   * Optionally override the stored options\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      let graphic = nameOrGraphic as Graphic;\r\n      if (this.copyGraphics) {\r\n        graphic = nameOrGraphic.clone();\r\n      }\r\n      this._current = 'default';\r\n      this._graphics[this._current] = graphic;\r\n      this._options[this._current] = options;\r\n    } else {\r\n      this._current = nameOrGraphic;\r\n      this._options[this._current] = options;\r\n      if (!(this._current in this._graphics)) {\r\n        this._logger.warn(\r\n          `Graphic ${this._current} is not registered with the graphics component owned by ${this.owner?.name}. Nothing will be drawn.`\r\n        );\r\n      }\r\n    }\r\n    this.recalculateBounds();\r\n    return this.current as T;\r\n  }\r\n\r\n  /**\r\n   * Hide currently shown graphic\r\n   */\r\n  public hide(): void {\r\n    this._current = 'ex.none';\r\n  }\r\n\r\n  private _localBounds?: BoundingBox;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._localBounds = bounds;\r\n  }\r\n\r\n  public recalculateBounds() {\r\n    let bb = new BoundingBox();\r\n    const graphic = this._graphics[this._current];\r\n    const options = this._options[this._current];\r\n\r\n    if (!graphic) {\r\n      this._localBounds = bb;\r\n      return;\r\n    }\r\n\r\n    let anchor = this.anchor;\r\n    let offset = this.offset;\r\n    if (options?.anchor) {\r\n      anchor = options.anchor;\r\n    }\r\n    if (options?.offset) {\r\n      offset = options.offset;\r\n    }\r\n    const bounds = graphic.localBounds;\r\n    const offsetX = -bounds.width * anchor.x + offset.x;\r\n    const offsetY = -bounds.height * anchor.y + offset.y;\r\n    if (graphic instanceof GraphicsGroup && !graphic.useAnchor) {\r\n      bb = graphic?.localBounds.combine(bb);\r\n    } else {\r\n      bb = graphic?.localBounds.translate(vec(offsetX, offsetY)).combine(bb);\r\n    }\r\n    this._localBounds = bb;\r\n  }\r\n\r\n  /**\r\n   * Get local bounds of graphics component\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (!this._localBounds || this._localBounds.hasZeroDimensions()) {\r\n      this.recalculateBounds();\r\n    }\r\n    return this._localBounds as BoundingBox; // recalc guarantees type\r\n  }\r\n\r\n  /**\r\n   * Get world bounds of graphics component\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    let bounds = this.localBounds;\r\n    if (this.owner) {\r\n      const tx = this.owner.get(TransformComponent);\r\n      if (tx) {\r\n        bounds = bounds.transform(tx.get().matrix);\r\n      }\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necessary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    const graphic = this.current;\r\n    if (graphic && hasGraphicsTick(graphic)) {\r\n      graphic.tick(elapsed, idempotencyToken);\r\n    }\r\n  }\r\n\r\n  public clone(): GraphicsComponent {\r\n    const graphics = new GraphicsComponent();\r\n    graphics._graphics = { ...this._graphics };\r\n    graphics._options = { ...this._options };\r\n    graphics.offset = this.offset.clone();\r\n    if (this.color) {\r\n      graphics.color = this.color.clone();\r\n    }\r\n    graphics.opacity = this.opacity;\r\n    graphics.anchor = this.anchor.clone();\r\n    graphics.copyGraphics = this.copyGraphics;\r\n    graphics.onPreDraw = this.onPreDraw;\r\n    graphics.onPostDraw = this.onPostDraw;\r\n    graphics.isVisible = this.isVisible;\r\n\r\n    return graphics;\r\n  }\r\n}\r\n","import { Component, ComponentCtor, isComponentCtor } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate, OnAdd, OnRemove } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent, AddEvent, RemoveEvent } from '../Events';\r\nimport { KillEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { Scene } from '../Scene';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { MaybeKnownComponent } from './Types';\r\nimport { Logger } from '../Util/Log';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * Built in events supported by all entities\r\n */\r\nexport type EntityEvents = {\r\n  initialize: InitializeEvent;\r\n  //@ts-ignore\r\n  add: AddEvent;\r\n  //@ts-ignore\r\n  remove: RemoveEvent;\r\n  preupdate: PreUpdateEvent;\r\n  postupdate: PostUpdateEvent;\r\n  kill: KillEvent;\r\n};\r\n\r\nexport const EntityEvents = {\r\n  Add: 'add',\r\n  Remove: 'remove',\r\n  Initialize: 'initialize',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  Kill: 'kill'\r\n} as const;\r\n\r\nexport interface EntityOptions<TComponents extends Component> {\r\n  name?: string;\r\n  components?: TComponents[];\r\n  silenceWarnings?: boolean;\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity<TKnownComponents extends Component = any> implements OnInitialize, OnPreUpdate, OnPostUpdate, OnAdd, OnRemove {\r\n  private static _ID = 0;\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  public name = `Entity#${this.id}`;\r\n\r\n  /**\r\n   * Listen to or emit events for an entity\r\n   */\r\n  public events = new EventEmitter<EntityEvents>();\r\n  private _tags = new Set<string>();\r\n  public componentAdded$ = new Observable<Component>();\r\n  public componentRemoved$ = new Observable<Component>();\r\n  public tagAdded$ = new Observable<string>();\r\n  public tagRemoved$ = new Observable<string>();\r\n  /**\r\n   * Current components on the entity\r\n   *\r\n   * **Do not modify**\r\n   *\r\n   * Use addComponent/removeComponent otherwise the ECS will not be notified of changes.\r\n   */\r\n  public readonly components = new Map<Function, Component>();\r\n  public componentValues: Component[] = [];\r\n  private _componentsToRemove: ComponentCtor[] = [];\r\n\r\n  constructor(options: EntityOptions<TKnownComponents>);\r\n  constructor(components?: TKnownComponents[], name?: string);\r\n  constructor(componentsOrOptions?: TKnownComponents[] | EntityOptions<TKnownComponents>, name?: string) {\r\n    let componentsToAdd!: TKnownComponents[];\r\n    let nameToAdd: string | undefined;\r\n    let silence = false;\r\n    if (Array.isArray(componentsOrOptions)) {\r\n      componentsToAdd = componentsOrOptions;\r\n      nameToAdd = name;\r\n    } else if (componentsOrOptions && typeof componentsOrOptions === 'object') {\r\n      const { components, name, silenceWarnings } = componentsOrOptions;\r\n      componentsToAdd = components ?? [];\r\n      nameToAdd = name;\r\n      silence = !!silenceWarnings;\r\n    }\r\n    if (nameToAdd) {\r\n      this.name = nameToAdd;\r\n    }\r\n    if (componentsToAdd) {\r\n      for (const component of componentsToAdd) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (!silence) {\r\n        setTimeout(() => {\r\n          if (!this.scene && !this.isInitialized) {\r\n            Logger.getInstance().warn(`Entity \"${this.name || this.id}\" was not added to a scene.`);\r\n          }\r\n        }, 5000);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The current scene that the entity is in, if any\r\n   */\r\n  public scene: Scene | null = null;\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   * @deprecated use isActive\r\n   */\r\n  public get active(): boolean {\r\n    return this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   * @deprecated use isActive\r\n   */\r\n  public set active(val: boolean) {\r\n    this.isActive = val;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public isActive: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   * If parented it will be removed from the parent when killed.\r\n   */\r\n  public kill() {\r\n    if (this.isActive) {\r\n      this.isActive = false;\r\n      this.unparent();\r\n    }\r\n    this.emit('kill', new KillEvent(this));\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from {@apilink TagsComponent}\r\n   */\r\n  public get tags(): Set<string> {\r\n    return this._tags;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this._tags.has(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   */\r\n  public addTag(tag: string): Entity<TKnownComponents> {\r\n    this._tags.add(tag);\r\n    this.tagAdded$.notifyAll(tag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   */\r\n  public removeTag(tag: string): Entity<TKnownComponents> {\r\n    this._tags.delete(tag);\r\n    this.tagRemoved$.notifyAll(tag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): ComponentCtor[] {\r\n    return Array.from(this.components.keys()) as ComponentCtor[];\r\n  }\r\n\r\n  /**\r\n   * Returns all component instances on entity\r\n   */\r\n  public getComponents(): Component[] {\r\n    return Array.from(this.components.values());\r\n  }\r\n\r\n  /**\r\n   * Verifies that an entity has all the required types\r\n   * @param requiredTypes\r\n   */\r\n  hasAll<TComponent extends Component>(requiredTypes: ComponentCtor<TComponent>[]): boolean {\r\n    for (let i = 0; i < requiredTypes.length; i++) {\r\n      if (!this.components.has(requiredTypes[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Verifies that an entity has all the required tags\r\n   * @param requiredTags\r\n   */\r\n  hasAllTags(requiredTags: string[]): boolean {\r\n    for (let i = 0; i < requiredTags.length; i++) {\r\n      if (!this.tags.has(requiredTags[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get<TComponent extends Component>(type: ComponentCtor<TComponent>): MaybeKnownComponent<TComponent, TKnownComponents> {\r\n    return this.components.get(type) as MaybeKnownComponent<TComponent, TKnownComponents>;\r\n  }\r\n\r\n  private _parent: Entity | null = null;\r\n  public get parent(): Entity | null {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    // Avoid modifying the array issue by walking backwards\r\n    for (let i = this.children.length - 1; i >= 0; i--) {\r\n      this.removeChild(this.children[i]);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      if (curr) {\r\n        queue = queue.concat(curr.children);\r\n        result = result.concat(curr.children);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      const componentInstance = this.get(c);\r\n      if (componentInstance) {\r\n        newEntity.addComponent(componentInstance.clone());\r\n      }\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it already exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  private _getClassHierarchyRoot(componentType: ComponentCtor): ComponentCtor {\r\n    let current = componentType;\r\n    let parent = Object.getPrototypeOf(current.prototype)?.constructor;\r\n\r\n    while (parent && parent !== Object && parent !== Component) {\r\n      current = parent;\r\n      parent = Object.getPrototypeOf(current.prototype)?.constructor;\r\n    }\r\n    return current;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<TComponent extends Component>(component: TComponent, force: boolean = false): Entity<TKnownComponents | TComponent> {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.constructor as ComponentCtor)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component.constructor as ComponentCtor, true);\r\n      } else {\r\n        // early exit component exits\r\n        return this as Entity<TKnownComponents | TComponent>;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const rootComponent = this._getClassHierarchyRoot(component.constructor as ComponentCtor);\r\n    this.components.set(rootComponent, component);\r\n    this.components.set(component.constructor, component);\r\n    this.componentValues.push(component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n\r\n    this.componentAdded$.notifyAll(component);\r\n    return this as Entity<TKnownComponents | TComponent>;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param typeOrInstance\r\n   * @param force\r\n   */\r\n  public removeComponent<TComponent extends Component>(\r\n    typeOrInstance: ComponentCtor<TComponent> | TComponent,\r\n    force = false\r\n  ): Entity<Exclude<TKnownComponents, TComponent>> {\r\n    let type: ComponentCtor<TComponent>;\r\n    if (isComponentCtor(typeOrInstance)) {\r\n      type = typeOrInstance;\r\n    } else {\r\n      type = typeOrInstance.constructor as ComponentCtor<TComponent>;\r\n    }\r\n\r\n    if (force) {\r\n      const componentToRemove = this.components.get(type);\r\n      if (componentToRemove) {\r\n        this.componentRemoved$.notifyAll(componentToRemove);\r\n        componentToRemove.owner = undefined;\r\n        if (componentToRemove.onRemove) {\r\n          componentToRemove.onRemove(this);\r\n        }\r\n        const componentIndex = this.componentValues.indexOf(componentToRemove);\r\n        if (componentIndex > -1) {\r\n          this.componentValues.splice(componentIndex, 1);\r\n        }\r\n      }\r\n\r\n      const rootComponent = this._getClassHierarchyRoot(type);\r\n      this.components.delete(rootComponent);\r\n      this.components.delete(type); // remove after the notify to preserve typing\r\n    } else {\r\n      this._componentsToRemove.push(type);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  public clearComponents() {\r\n    const components = this.types;\r\n    for (const c of components) {\r\n      this.removeComponent(c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const type of this._componentsToRemove) {\r\n      this.removeComponent(type, true);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<TComponent extends Component>(type: ComponentCtor<TComponent>): boolean {\r\n    return this.components.has(type);\r\n  }\r\n\r\n  private _isInitialized = false;\r\n  private _isAdded = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public get isAdded(): boolean {\r\n    return this._isAdded;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds this Actor, meant to be called by the Scene when Actor is added.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _add(engine: Engine) {\r\n    if (!this.isAdded && this.isActive) {\r\n      this.onAdd(engine);\r\n      this.events.emit('add', new AddEvent(engine, this));\r\n      this._isAdded = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes Actor, meant to be called by the Scene when Actor is added.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _remove(engine: Engine) {\r\n    if (this.isAdded && !this.isActive) {\r\n      this.onRemove(engine);\r\n      this.events.emit('remove', new RemoveEvent(engine, this));\r\n      this._isAdded = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * `onAdd` is called when Actor is added to scene. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('add', (evt) => {...})`\r\n   */\r\n  public onAdd(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * `onRemove` is called when Actor is added to scene. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('remove', (evt) => {...})`\r\n   */\r\n  public onRemove(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   * @internal\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  public update(engine: Engine, elapsed: number): void {\r\n    this._initialize(engine);\r\n    this._add(engine);\r\n    this._preupdate(engine, elapsed);\r\n    for (const child of this.children) {\r\n      child.update(engine, elapsed);\r\n    }\r\n    this._postupdate(engine, elapsed);\r\n    this._remove(engine);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, event: EntityEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    if (handler) {\r\n      this.events.off(eventName, handler);\r\n    } else {\r\n      this.events.off(eventName);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Motion {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  vel: Vector;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  acc: Vector;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  scaleFactor: Vector;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  angularVelocity: number;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  torque: number;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  inertia: number;\r\n}\r\n\r\nexport class MotionComponent extends Component {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  public scaleFactor: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  public angularVelocity = 0;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  public torque: number = 0;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  public inertia: number = 1;\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  // Scratch vectors to avoid allocation\n  private static _POS = new Vector(0, 0);\n  private static _SCALE = new Vector(1, 1);\n\n  private static _ACC = new Vector(0, 0);\n  private static _VEL = new Vector(0, 0);\n  private static _VEL_ACC = new Vector(0, 0);\n  private static _SCALE_FACTOR = new Vector(0, 0);\n\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsed: number): void {\n    const seconds = elapsed / 1000;\n    // This code looks a little wild, but it's to avoid creating any new Vector instances\n    // integration is done in a tight loop so this is key to avoid GC'ing\n    motion.vel.addEqual(totalAcc.scale(seconds, EulerIntegrator._ACC));\n    transform.pos\n      .add(motion.vel.scale(seconds, EulerIntegrator._VEL), EulerIntegrator._POS)\n      .addEqual(totalAcc.scale(0.5 * seconds * seconds, EulerIntegrator._VEL_ACC));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    const rotation = transform.rotation + motion.angularVelocity * seconds;\n\n    transform.scale.add(motion.scaleFactor.scale(seconds, this._SCALE_FACTOR), EulerIntegrator._SCALE);\n    const tx = transform.get();\n    tx.setTransform(EulerIntegrator._POS, rotation, EulerIntegrator._SCALE);\n  }\n}\n","import { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { clamp } from '../Math/util';\r\nimport { Graphic } from '../Graphics';\r\nimport { EmitterType } from './EmitterType';\r\nimport { MotionComponent } from '../EntityComponentSystem';\r\nimport { EulerIntegrator } from '../Collision/Integrator';\r\nimport type { ParticleEmitter } from './ParticleEmitter';\r\n\r\n/**\r\n/**\r\n * CPU Particle is used in a {@apilink ParticleEmitter}\r\n */\r\nexport class Particle extends Entity {\r\n  public static DefaultConfig: ParticleConfig = {\r\n    beginColor: Color.White,\r\n    endColor: Color.White,\r\n    life: 300,\r\n    fade: false,\r\n    size: 5,\r\n    graphic: undefined,\r\n    startSize: undefined,\r\n    endSize: undefined\r\n  };\r\n\r\n  public focus?: Vector;\r\n  public focusAccel?: number;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fade: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public size: number = 5;\r\n  public graphic?: Graphic;\r\n\r\n  public startSize?: number;\r\n  public endSize?: number;\r\n  public sizeRate: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public motion: MotionComponent;\r\n  public graphics: GraphicsComponent;\r\n  public particleTransform = ParticleTransform.Global;\r\n\r\n  public name = `Particle#${this.id}`;\r\n\r\n  constructor(options: ParticleConfig) {\r\n    super({ silenceWarnings: true });\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent((this.motion = new MotionComponent()));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n    this.configure(options);\r\n  }\r\n\r\n  private _emitter?: ParticleEmitter;\r\n  registerEmitter(emitter: ParticleEmitter) {\r\n    this._emitter = emitter;\r\n    if (this.particleTransform === ParticleTransform.Global) {\r\n      const globalPos = this._emitter.transform.globalPos;\r\n      this.transform.pos = this.transform.pos.add(globalPos);\r\n      this.motion.vel = this.motion.vel.rotate(this._emitter.transform.globalRotation);\r\n    }\r\n  }\r\n\r\n  configure(options: ParticleConfig) {\r\n    this.particleTransform = options.transform ?? this.particleTransform;\r\n    this.life = options.life ?? this.life;\r\n    this.fade = options.fade ?? this.fade;\r\n    this.size = options.size ?? this.size;\r\n    this.endColor = options.endColor ?? this.endColor.clone();\r\n    this.beginColor = options.beginColor ?? this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n\r\n    this.graphic = options.graphic;\r\n    this.graphics.opacity = options.opacity ?? this.graphics.opacity;\r\n    this.transform.pos = options.pos ?? this.transform.pos;\r\n    this.transform.rotation = options.rotation ?? 0;\r\n    this.transform.scale = vec(1, 1);\r\n\r\n    this.motion.vel = options.vel ?? this.motion.vel;\r\n    this.motion.angularVelocity = options.angularVelocity ?? 0;\r\n    this.motion.acc = options.acc ?? this.motion.acc;\r\n\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.graphics.opacity / this.life;\r\n\r\n    this.startSize = options.startSize ?? 0;\r\n    this.endSize = options.endSize ?? 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.size = this.startSize;\r\n    }\r\n    if (this.graphic) {\r\n      this.graphics.use(this.graphic);\r\n      this.graphics.onPostDraw = undefined;\r\n    } else {\r\n      this.graphics.localBounds = BoundingBox.fromDimension(this.size, this.size, Vector.Half);\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        ctx.debug.drawPoint(vec(0, 0), { color: this._currentColor, size: this.size });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public override kill() {\r\n    if (this._emitter?.isActive) {\r\n      this._emitter.removeParticle(this);\r\n    } else {\r\n      super.kill();\r\n    }\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this.life = this.life - elapsed;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fade) {\r\n      this.graphics.opacity = clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize && this.endSize && this.startSize > 0 && this.endSize > 0) {\r\n      this.size = clamp(\r\n        this.sizeRate * elapsed + this.size,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * elapsed, 0, 255);\r\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * elapsed, 0, 255);\r\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * elapsed, 0, 255);\r\n    this._currentColor.a = this.graphics.opacity;\r\n\r\n    let accel = this.motion.acc;\r\n    if (this.focus) {\r\n      accel = this.focus\r\n        .sub(this.transform.pos)\r\n        .normalize()\r\n        .scale(this.focusAccel || 0)\r\n        .scale(elapsed / 1000);\r\n    }\r\n    // Update transform and motion based on Euler linear algebra\r\n    EulerIntegrator.integrate(this.transform, this.motion, accel, elapsed);\r\n  }\r\n}\r\n\r\nexport interface ParticleConfig {\r\n  /**\r\n   * Optionally set the emitted particle transform style, {@apilink ParticleTransform.Global} is the default and emits particles as if\r\n   * they were world space objects, useful for most effects.\r\n   *\r\n   * If set to {@apilink ParticleTransform.Local} particles are children of the emitter and move relative to the emitter\r\n   * as they would in a parent/child actor relationship.\r\n   */\r\n  transform?: ParticleTransform;\r\n  /**\r\n   * Starting position of the particle\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Starting velocity of the particle\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Starting acceleration of the particle\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Starting angular velocity of the particle\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Starting rotation of the particle\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Size of the particle in pixels\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally set a graphic\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Totally life of the particle in milliseconds\r\n   */\r\n  life?: number;\r\n  /**\r\n   * Starting opacity of the particle\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * Should the particle fade out to fully transparent over their life\r\n   */\r\n  fade?: boolean;\r\n\r\n  /**\r\n   * Ending color of the particle over its life\r\n   */\r\n  endColor?: Color;\r\n  /**\r\n   * Beginning color of the particle over its life\r\n   */\r\n  beginColor?: Color;\r\n\r\n  /**\r\n   * Set the start size when you want to change particle size over their life\r\n   */\r\n  startSize?: number;\r\n  /**\r\n   * Set the end size when you want to change particle size over their life\r\n   */\r\n  endSize?: number;\r\n\r\n  /**\r\n   * Smallest possible starting size of the particle\r\n   */\r\n  minSize?: number;\r\n  /**\r\n   * Largest possible starting size of the particle\r\n   */\r\n  maxSize?: number;\r\n  /**\r\n   * Minimum magnitude of the particle starting speed\r\n   */\r\n  minSpeed?: number;\r\n  /**\r\n   * Maximum magnitude of the particle starting speed\r\n   */\r\n  maxSpeed?: number;\r\n  /**\r\n   * Minimum angle to use for the particles starting rotation\r\n   */\r\n  minAngle?: number;\r\n  /**\r\n   * Maximum angle to use for the particles starting rotation\r\n   */\r\n  maxAngle?: number;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   *\r\n   * If the particle transform is global the focus is in world space, otherwise it is relative to the emitter\r\n   */\r\n  focus?: Vector;\r\n  /**\r\n   * Gets or sets the optional acceleration for focusing particles if a focus has been specified\r\n   */\r\n  focusAccel?: number;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  randomRotation?: boolean;\r\n}\r\n\r\nexport enum ParticleTransform {\r\n  /**\r\n   * {@apilink ParticleTransform.Global} is the default and emits particles as if\r\n   * they were world space objects, useful for most effects.\r\n   */\r\n  Global = 'global',\r\n  /**\r\n   * {@apilink ParticleTransform.Local} particles are children of the emitter and move relative to the emitter\r\n   * as they would in a parent/child actor relationship.\r\n   */\r\n  Local = 'local'\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  particle?: ParticleConfig;\r\n  x?: number;\r\n  y?: number;\r\n  z?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  /**\r\n   * Is emitting currently\r\n   */\r\n  isEmitting?: boolean;\r\n  /**\r\n   * Particles per second\r\n   */\r\n  emitRate?: number;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  /**\r\n   * Emitter shape\r\n   */\r\n  emitterType?: EmitterType;\r\n  /**\r\n   * Radius of the emitter if the emitter type is EmitterType.Circle\r\n   */\r\n  radius?: number;\r\n  random?: Random;\r\n}\r\n","import { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport particleVertexSource from './particle-vertex.glsl';\r\nimport particleFragmentSource from './particle-fragment.glsl';\r\nimport { GpuParticleRenderer } from '../../../Particles/GpuParticleRenderer';\r\nimport { vec } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { ParticleTransform } from '../../../Particles/Particles';\r\n\r\nexport class ParticleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.particle' as const;\r\n  public priority: number = 0;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _shader!: Shader;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: particleVertexSource,\r\n      fragmentSource: particleFragmentSource,\r\n      onPreLink: (program) => {\r\n        gl.transformFeedbackVaryings(\r\n          program,\r\n          ['finalPosition', 'finalVelocity', 'finalRotation', 'finalAngularVelocity', 'finalLifeMs'],\r\n          gl.INTERLEAVED_ATTRIBS\r\n        );\r\n      }\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n  }\r\n\r\n  private _getTexture(image: HTMLImageSource) {\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    return texture;\r\n  }\r\n\r\n  draw(renderer: GpuParticleRenderer, elapsed: number): void {\r\n    const gl = this._gl;\r\n\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    const transform =\r\n      renderer.particle.transform === ParticleTransform.Local\r\n        ? this._context.getTransform()\r\n        : this._context.getTransform().multiply(renderer.emitter.transform.get().inverse);\r\n    this._shader.setUniformAffineMatrix('u_transform', transform);\r\n    this._shader.setUniformBoolean('fade', renderer.particle.fade ? true : false);\r\n    this._shader.setUniformBoolean('useTexture', renderer.particle.graphic ? true : false);\r\n    this._shader.setUniformFloat('maxLifeMs', renderer.particle.life ?? 2000);\r\n    this._shader.setUniformFloat('deltaMs', elapsed);\r\n    this._shader.setUniformFloatVector('gravity', renderer.particle.acc ?? vec(0, 0));\r\n    this._shader.setUniformFloatColor('beginColor', renderer.particle.beginColor ?? Color.Transparent);\r\n    this._shader.setUniformFloatColor('endColor', renderer.particle.endColor ?? Color.Transparent);\r\n\r\n    let startSize = renderer.particle.startSize ?? 0;\r\n    let endSize = renderer.particle.endSize ?? 0;\r\n    const size = renderer.particle.size ?? 0;\r\n    if (size > 0) {\r\n      startSize = size;\r\n      endSize = size;\r\n    }\r\n\r\n    this._shader.setUniformFloat('startSize', startSize ?? 10);\r\n    this._shader.setUniformFloat('endSize', endSize ?? 10);\r\n    this._shader.setUniformFloat('startOpacity', renderer.particle.opacity ?? 1);\r\n\r\n    if (renderer.particle.focus) {\r\n      this._shader.setUniformFloatVector('focus', renderer.particle.focus);\r\n      this._shader.setUniformFloat('focusAccel', renderer.particle.focusAccel ?? 0);\r\n    }\r\n\r\n    // Particle Graphic (only Sprites right now)\r\n    if (renderer.particle.graphic) {\r\n      const graphic = renderer.particle.graphic;\r\n\r\n      const texture = this._getTexture(graphic.image.image);\r\n\r\n      gl.activeTexture(gl.TEXTURE0);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      this._shader.setUniformInt('graphic', 0);\r\n    }\r\n\r\n    // Collision Mask\r\n    // gl.activeTexture(gl.TEXTURE0 + 1);\r\n    // gl.bindTexture(gl.TEXTURE_2D, obstacleTex);\r\n    // gl.uniform1i(u_obstacle, 1);\r\n\r\n    renderer.draw(gl);\r\n  }\r\n  hasPendingDraws(): boolean {\r\n    return false;\r\n  }\r\n  flush(): void {\r\n    // pass\r\n  }\r\n  dispose(): void {\r\n    // pass\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\nuniform float deltaMs;\\r\\nuniform float maxLifeMs;\\r\\nuniform vec2 gravity;\\r\\nuniform vec2 focus;\\r\\nuniform float focusAccel;\\r\\nuniform mat4 u_matrix;\\r\\nuniform mat4 u_transform;\\r\\nuniform float startSize;\\r\\nuniform float endSize;\\r\\n// uniform sampler2D obstacle;\\r\\n\\r\\nlayout(location=0)in vec2 position;\\r\\nlayout(location=1)in vec2 velocity;\\r\\nlayout(location=2)in float rotation;\\r\\nlayout(location=3)in float angularVelocity;\\r\\nlayout(location=4)in float lifeMs;\\r\\n\\r\\n// TODO z index to handle buffer wrapping?\\r\\n\\r\\n// DO NOT RE-ORDER\\r\\nout vec2 finalPosition;\\r\\nout vec2 finalVelocity;\\r\\nout float finalRotation;\\r\\nout float finalAngularVelocity;\\r\\nout float finalLifeMs;\\r\\nvoid main(){\\r\\n  // Evolve particle\\r\\n  float seconds = deltaMs / 1000.;\\r\\n  // euler integration\\r\\n  // Weird artifact of re-using the same buffer layout for update/draw\\r\\n  // we need differently named variables\\r\\n  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\\r\\n  finalVelocity = velocity + finalGravity * seconds;\\r\\n  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\\r\\n  finalRotation = rotation + angularVelocity * seconds;\\r\\n  finalAngularVelocity = angularVelocity;\\r\\n  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\\r\\n\\r\\n  // Collision mask sampling\\r\\n  // vec2 samplePoint = finalPosition / vec2(width, height);\\r\\n  // vec4 collides = texture(obstacle, samplePoint);\\r\\n  // if (distance(collides,vec4(0.)) > .01) {\\r\\n  //   // non opaque means we collide! recalc final pos/vel\\r\\n  //   vec2 newVelocity = velocity * -.1;// lose energy\\r\\n  //   finalVelocity = newVelocity + gravity * seconds;\\r\\n  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\\r\\n  // }\\r\\n\\r\\n  float lifePercent = finalLifeMs / maxLifeMs;\\r\\n  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\\r\\n  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);\\r\\n  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\\r\\n  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\nuniform sampler2D graphic;\\r\\nuniform bool useTexture;\\r\\nuniform float maxLifeMs;\\r\\n\\r\\nuniform vec4 beginColor;\\r\\nuniform vec4 endColor;\\r\\nuniform bool fade;\\r\\nuniform float startOpacity;\\r\\n\\r\\nin float finalRotation;\\r\\nin float finalLifeMs;\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main(){\\r\\n\\r\\n  float lifePct = finalLifeMs / maxLifeMs;\\r\\n\\r\\n  if (useTexture) {\\r\\n    /** Draw texture */\\r\\n    if (lifePct <= 0.) discard;\\r\\n    float mid = .5;\\r\\n    float cosine = cos(finalRotation);\\r\\n    float sine = sin(finalRotation);\\r\\n    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\\r\\n                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\\r\\n    vec4 color = texture(graphic, rotated);\\r\\n    fragColor = color * (fade ? lifePct : 1.0);\\r\\n  } else {\\r\\n    /** Draw circle */\\r\\n    if (lifePct <= 0.) discard;\\r\\n    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\\r\\n    float dist = 1.0 - length(uv);\\r\\n    float edge = fwidth(dot(uv, uv));\\r\\n    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\\r\\n    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);\\r\\n    fragColor.rgb = color;\\r\\n    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);\\r\\n    fragColor.rgb *= fragColor.a;\\r\\n  }\\r\\n}\";","// import { Color } from '../../../Color';\r\n// import { parseImageFiltering } from '../../Filtering';\r\nimport { Color } from '../../../Color';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\n// import { ImageSourceAttributeConstants } from '../../ImageSource';\r\n// import { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { getMaxShaderComplexity } from '../webgl-util';\r\nimport frag from './image-renderer-v2.frag.glsl';\r\nimport vert from './image-renderer-v2.vert.glsl';\r\n\r\nexport interface ImageRendererOptions {\r\n  pixelArtSampler: boolean;\r\n  uvPadding: number;\r\n}\r\n\r\nexport class ImageRendererV2 implements RendererPlugin {\r\n  public readonly type = 'ex.image-v2';\r\n  public priority: number = 0;\r\n\r\n  public readonly pixelArtSampler: boolean;\r\n  public readonly uvPadding: number;\r\n\r\n  // TODO this could be bigger probably\r\n  private _maxImages: number = 20_000; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n  private _components = 2 + 2 + 2 + 2 + 1 + 2 + 2 + 1 + 2 + 2 + 4;\r\n\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _shader!: Shader;\r\n  private _transformData!: VertexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _textureIndex = 0;\r\n  private _textureToIndex = new Map<WebGLTexture, number>();\r\n  private _images = new Set<HTMLImageSource>();\r\n  private _vertexIndex: number = 0;\r\n  private _quadMesh!: Float32Array;\r\n  private _meshBuffer!: WebGLBuffer;\r\n  private _vao!: WebGLVertexArrayObject;\r\n\r\n  constructor(options: ImageRendererOptions) {\r\n    this.pixelArtSampler = options.pixelArtSampler;\r\n    this.uvPadding = options.uvPadding;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\r\n    this._maxTextures = Math.min(maxTexture, maxComplexity);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    this._vao = gl.createVertexArray()!;\r\n    gl.bindVertexArray(this._vao);\r\n    this._quadMesh = new Float32Array([\r\n      // pos       uv\r\n      0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0,\r\n\r\n      1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1\r\n    ]);\r\n    this._meshBuffer = gl.createBuffer()!;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._meshBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this._quadMesh, gl.STATIC_DRAW);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 16, 0);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 16, 8);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    // Setup memory layout\r\n    const components = this._components;\r\n    this._transformData = new VertexBuffer({\r\n      gl,\r\n      size: components * this._maxImages, // components * images\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._transformData.bind();\r\n\r\n    // attributes\r\n    let offset = 0;\r\n    let start = 2;\r\n    const bytesPerFloat = 4;\r\n    const totalSize = components * 4;\r\n\r\n    // a_offset vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(2);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column1 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(3);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column2 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(4);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column3 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(5);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_opacity float - 1\r\n    gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(6);\r\n    offset += 1 * bytesPerFloat;\r\n\r\n    // a_res vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(7);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_size vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(8);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_texture_index - 1\r\n    gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(9);\r\n    offset += 1 * bytesPerFloat;\r\n\r\n    // a_uv_min - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(10);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_uv_max - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(11);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_tint - 4\r\n    gl.vertexAttribPointer(start++, 4, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(12);\r\n    offset += 4 * bytesPerFloat;\r\n\r\n    gl.vertexAttribDivisor(2, 1);\r\n    gl.vertexAttribDivisor(3, 1);\r\n    gl.vertexAttribDivisor(4, 1);\r\n    gl.vertexAttribDivisor(5, 1);\r\n    gl.vertexAttribDivisor(6, 1);\r\n    gl.vertexAttribDivisor(7, 1);\r\n    gl.vertexAttribDivisor(8, 1);\r\n    gl.vertexAttribDivisor(9, 1);\r\n    gl.vertexAttribDivisor(10, 1);\r\n    gl.vertexAttribDivisor(11, 1);\r\n    gl.vertexAttribDivisor(12, 1);\r\n\r\n    gl.bindVertexArray(null);\r\n  }\r\n\r\n  private _bindData(gl: WebGL2RenderingContext) {\r\n    // Setup memory layout\r\n    const components = this._components;\r\n    this._transformData.bind();\r\n    this._transformData.upload(components * this._imageCount);\r\n\r\n    gl.bindVertexArray(this._vao);\r\n  }\r\n\r\n  public dispose() {\r\n    this._transformData.dispose();\r\n    this._shader.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_texture_index <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_texture_index <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    if (this._images.has(image)) {\r\n      return;\r\n    }\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n      this._textureToIndex.set(texture, this._textureIndex++);\r\n      this._images.add(image);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    const max = Math.min(this._textureIndex, this._maxTextures);\r\n    for (let i = 0; i < max; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      const maybeTexture = this._context.textureLoader.get(image);\r\n      return this._textureToIndex.get(maybeTexture) ?? -1; //this._textures.indexOf(maybeTexture);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  private _view = [0, 0, 0, 0];\r\n  private _dest = [0, 0];\r\n  private _defaultTint = Color.White;\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    // This creates and uploads the texture if not already done\r\n    this._addImageAsTexture(image);\r\n    const maybeImageWidth = this._getImageWidth(image);\r\n    const maybeImageHeight = this._getImageHeight(image);\r\n\r\n    let width = maybeImageWidth || swidth || 0;\r\n    let height = maybeImageHeight || sheight || 0;\r\n    this._view[0] = 0;\r\n    this._view[1] = 0;\r\n    this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n    this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n    this._dest[0] = sx ?? 1;\r\n    this._dest[1] = sy ?? 1;\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this._view[0] = sx ?? 1;\r\n      this._view[1] = sy ?? 1;\r\n      this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n      this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n      this._dest[0] = dx;\r\n      this._dest[1] = dy;\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = this._view[0];\r\n    sy = this._view[1];\r\n    const sw = this._view[2];\r\n    const sh = this._view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n    if (snapToPixel) {\r\n      this._dest[0] = ~~(this._dest[0] + pixelSnapEpsilon);\r\n      this._dest[1] = ~~(this._dest[1] + pixelSnapEpsilon);\r\n    }\r\n\r\n    const tint = this._context.tint || this._defaultTint;\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const imageWidth = maybeImageWidth || width;\r\n    const imageHeight = maybeImageHeight || height;\r\n\r\n    const uvx0 = (sx + this.uvPadding) / imageWidth;\r\n    const uvy0 = (sy + this.uvPadding) / imageHeight;\r\n    const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\r\n    const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\r\n\r\n    const txWidth = maybeImageWidth;\r\n    const txHeight = maybeImageHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._transformData.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = this._dest[0];\r\n    vertexBuffer[this._vertexIndex++] = this._dest[1];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[0];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[1];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[2];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[3];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[4];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[5];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._bindData(gl);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Turn on pixel art aa sampler\r\n    this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Draw all the quads\r\n    gl.drawArraysInstanced(gl.TRIANGLES, 0, 6, this._imageCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    gl.bindVertexArray(null);\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n    this._textureIndex = 0;\r\n    this._textureToIndex.clear();\r\n    this._images.clear();\r\n    this._imageToWidth.clear();\r\n    this._imageToHeight.clear();\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nuniform bool u_pixelart;\\r\\n\\r\\nin float v_texture_index;\\r\\n\\r\\nin float v_opacity;\\r\\n\\r\\nin vec4 v_tint;\\r\\n\\r\\n// texture resolution\\r\\nin vec2 v_res;\\r\\n\\r\\nin vec2 v_size;\\r\\n\\r\\nin vec2 v_uv_min;\\r\\nin vec2 v_uv_max;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\r\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\r\\n  vec2 pixel = uv * texture_size;\\r\\n\\r\\n  vec2 seam=floor(pixel+.5);\\r\\n  vec2 dudv=fwidth(pixel);\\r\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\r\\n\\r\\n  return pixel/texture_size;\\r\\n}\\r\\n\\r\\nfloat lerp(float from, float to, float rel){\\r\\n  return ((1. - rel) * from) + (rel * to);\\r\\n}\\r\\n\\r\\nfloat invLerp(float from, float to, float value){\\r\\n  return (value - from) / (to - from);\\r\\n}\\r\\n\\r\\nfloat remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\\r\\n  float rel = invLerp(origFrom, origTo, value);\\r\\n  return lerp(targetFrom, targetTo, rel);\\r\\n}\\r\\n\\r\\nvoid main(){\\r\\n  // In order to support the most efficient sprite batching, we have multiple\\r\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n  // that do not apply to a particular sprite.\\r\\n\\r\\n  vec4 color=vec4(1.,0,0,1.);\\r\\n  vec2 remapped_uv = v_texcoord;\\r\\n  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);\\r\\n  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);\\r\\n  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;\\r\\n\\r\\n  // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n  %%texture_picker%%\\r\\n\\r\\n  color.rgb = color.rgb * v_opacity;\\r\\n  color.a = color.a * v_opacity;\\r\\n  fragColor = color * v_tint;\\r\\n}\";","export default \"#version 300 es\\r\\nlayout(location=0) in vec2 pos;\\r\\nlayout(location=1) in vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\nlayout(location=2) in vec2 a_offset;\\r\\nlayout(location=3) in vec2 a_mat_column1;\\r\\nlayout(location=4) in vec2 a_mat_column2;\\r\\nlayout(location=5) in vec2 a_mat_column3;\\r\\n\\r\\nlayout(location=6) in float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\n// Texture resolution (could be bigger than a_size)\\r\\nlayout(location=7) in vec2 a_res;\\r\\nout vec2 v_res;\\r\\n\\r\\n// Final size of graphic\\r\\nlayout(location=8) in vec2 a_size;\\r\\nout vec2 v_size;\\r\\n\\r\\nlayout(location=9) in lowp float a_texture_index;\\r\\nout lowp float v_texture_index;\\r\\n\\r\\nlayout(location=10) in vec2 a_uv_min;\\r\\nout vec2 v_uv_min;\\r\\n\\r\\nlayout(location=11) in vec2 a_uv_max;\\r\\nout vec2 v_uv_max;\\r\\n\\r\\nlayout(location=12) in vec4 a_tint;\\r\\nout vec4 v_tint;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main(){\\r\\n  mat4 world_mat = mat4(\\r\\n    a_mat_column1.x, a_mat_column1.y, 0., 0.,\\r\\n    a_mat_column2.x, a_mat_column2.y, 0., 0.,\\r\\n    0.             , 0.             , 1., 0.,\\r\\n    a_mat_column3.x, a_mat_column3.y, 0., 1.\\r\\n  );\\r\\n\\r\\n  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\\r\\n  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\\r\\n\\r\\n  v_opacity = a_opacity;\\r\\n  v_texcoord = a_texcoord;\\r\\n  v_uv_min = a_uv_min;\\r\\n  v_uv_max = a_uv_max;\\r\\n  v_res = a_res;\\r\\n  v_size = a_size;\\r\\n  v_texture_index = a_texture_index;\\r\\n  v_tint = a_tint;\\r\\n}\";","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { DebugText } from './debug-text';\r\nimport { Resolution } from '../../Screen';\r\nimport { RenderTarget } from './render-target';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { RendererPlugin } from './renderer';\r\n\r\n// renderers\r\nimport { LineRenderer } from './line-renderer/line-renderer';\r\nimport { PointRenderer } from './point-renderer/point-renderer';\r\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\r\nimport { ImageRenderer } from './image-renderer/image-renderer';\r\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\r\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\r\nimport { Pool } from '../../Util/Pool';\r\nimport { DrawCall } from './draw-call';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\nimport { MaterialRenderer } from './material-renderer/material-renderer';\r\nimport { Shader, ShaderOptions } from './shader';\r\nimport { GarbageCollector } from '../../GarbageCollector';\r\nimport { ParticleRenderer } from './particle-renderer/particle-renderer';\r\nimport { ImageRendererV2 } from './image-renderer-v2/image-renderer-v2';\r\nimport { Flags } from '../../Flags';\r\n\r\nexport const pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions?: LineGraphicsOptions): void {\r\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions?.color ?? Color.Black);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  ortho: Matrix;\r\n  context: ExcaliburGraphicsContextWebGL;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContextWebGLOptions extends ExcaliburGraphicsContextOptions {\r\n  context?: WebGL2RenderingContext;\r\n  garbageCollector?: { garbageCollector: GarbageCollector; collectionInterval: number };\r\n  handleContextLost?: (e: Event) => void;\r\n  handleContextRestored?: (e: Event) => void;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  private _logger = Logger.getInstance();\r\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\r\n  private _lazyRenderersFactory: Map<string, () => RendererPlugin> = new Map<string, () => RendererPlugin>();\r\n  public imageRenderer: 'ex.image' | 'ex.image-v2' = Flags.isEnabled('use-legacy-image-renderer') ? 'ex.image' : 'ex.image-v2';\r\n  private _isDrawLifecycle = false;\r\n  public useDrawSorting = true;\r\n\r\n  private _drawCallPool = new Pool<DrawCall>(() => new DrawCall(), undefined, 4000);\r\n\r\n  private _drawCallIndex = 0;\r\n  private _drawCalls: DrawCall[] = new Array(4000).fill(null);\r\n\r\n  // Main render target\r\n  private _renderTarget!: RenderTarget;\r\n\r\n  // Quad boundary MSAA\r\n  private _msaaTarget!: RenderTarget;\r\n\r\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\r\n  private _postProcessTargets: RenderTarget[] = [];\r\n\r\n  private _screenRenderer!: ScreenPassPainter;\r\n\r\n  private _postprocessors: PostProcessor[] = [];\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGL2RenderingContext;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Snaps the drawing x/y coordinate to the nearest whole pixel\r\n   */\r\n  public snapToPixel: boolean = false;\r\n\r\n  /**\r\n   * Native context smoothing\r\n   */\r\n  public readonly smoothing: boolean = false;\r\n\r\n  /**\r\n   * Whether the pixel art sampler is enabled for smooth sub pixel anti-aliasing\r\n   */\r\n  public readonly pixelArtSampler: boolean = false;\r\n\r\n  /**\r\n   * UV padding in pixels to use in internal image rendering to prevent texture bleed\r\n   *\r\n   */\r\n  public uvPadding = 0.01;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public textureLoader: TextureLoader;\r\n\r\n  public materialScreenTexture!: WebGLTexture | null;\r\n\r\n  public get z(): number {\r\n    return this._state.current.z;\r\n  }\r\n\r\n  public set z(value: number) {\r\n    this._state.current.z = value;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color | undefined | null {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color | undefined | null) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  public get ortho(): Matrix {\r\n    return this._ortho;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: Resolution): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    let supported = true;\r\n    if (dim.width > 4096 || dim.height > 4096) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  public readonly multiSampleAntialiasing: boolean = true;\r\n  public readonly samples?: number;\r\n  public readonly transparency: boolean = true;\r\n  private _isContextLost = false;\r\n\r\n  constructor(options: ExcaliburGraphicsContextWebGLOptions) {\r\n    const {\r\n      canvasElement,\r\n      context,\r\n      enableTransparency,\r\n      antialiasing,\r\n      uvPadding,\r\n      multiSampleAntialiasing,\r\n      pixelArtSampler,\r\n      powerPreference,\r\n      snapToPixel,\r\n      backgroundColor,\r\n      useDrawSorting,\r\n      garbageCollector,\r\n      handleContextLost,\r\n      handleContextRestored\r\n    } = options;\r\n    this.__gl =\r\n      context ??\r\n      (canvasElement.getContext('webgl2', {\r\n        antialias: antialiasing ?? this.smoothing,\r\n        premultipliedAlpha: false,\r\n        alpha: enableTransparency ?? this.transparency,\r\n        depth: false,\r\n        powerPreference: powerPreference ?? 'high-performance'\r\n      }) as WebGL2RenderingContext);\r\n    if (!this.__gl) {\r\n      throw Error('Failed to retrieve webgl context from browser');\r\n    }\r\n\r\n    if (handleContextLost) {\r\n      this.__gl.canvas.addEventListener('webglcontextlost', handleContextLost, false);\r\n    }\r\n\r\n    if (handleContextRestored) {\r\n      this.__gl.canvas.addEventListener('webglcontextrestored', handleContextRestored, false);\r\n    }\r\n\r\n    this.__gl.canvas.addEventListener('webglcontextlost', () => {\r\n      this._isContextLost = true;\r\n    });\r\n\r\n    this.__gl.canvas.addEventListener('webglcontextrestored', () => {\r\n      this._isContextLost = false;\r\n    });\r\n\r\n    this.textureLoader = new TextureLoader(this.__gl, garbageCollector);\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = antialiasing ?? this.smoothing;\r\n    this.transparency = enableTransparency ?? this.transparency;\r\n    this.pixelArtSampler = pixelArtSampler ?? this.pixelArtSampler;\r\n    this.uvPadding = uvPadding ?? this.uvPadding;\r\n    this.multiSampleAntialiasing = typeof multiSampleAntialiasing === 'boolean' ? multiSampleAntialiasing : this.multiSampleAntialiasing;\r\n    this.samples = typeof multiSampleAntialiasing === 'object' ? multiSampleAntialiasing.samples : undefined;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.useDrawSorting = useDrawSorting ?? this.useDrawSorting;\r\n    this._drawCallPool.disableWarnings = true;\r\n    this._drawCallPool.preallocate();\r\n    this._init();\r\n  }\r\n\r\n  private _disposed = false;\r\n  public dispose() {\r\n    if (!this._disposed) {\r\n      this._disposed = true;\r\n      this.textureLoader.dispose();\r\n      for (const renderer of this._renderers.values()) {\r\n        renderer.dispose();\r\n      }\r\n      this._renderers.clear();\r\n      this._drawCallPool.dispose();\r\n      this._drawCalls.length = 0;\r\n      this.__gl = null as any;\r\n    }\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\r\n    gl.enable(gl.BLEND);\r\n    gl.blendEquation(gl.FUNC_ADD);\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.depthMask(false);\r\n    // Setup builtin renderers\r\n    this.register(\r\n      new ImageRenderer({\r\n        uvPadding: this.uvPadding,\r\n        pixelArtSampler: this.pixelArtSampler\r\n      })\r\n    );\r\n    this.register(new MaterialRenderer());\r\n    this.register(new RectangleRenderer());\r\n    this.register(new CircleRenderer());\r\n    this.register(new PointRenderer());\r\n    this.register(new LineRenderer());\r\n    this.lazyRegister<ParticleRenderer>('ex.particle', () => new ParticleRenderer());\r\n    this.register(\r\n      new ImageRendererV2({\r\n        uvPadding: this.uvPadding,\r\n        pixelArtSampler: this.pixelArtSampler\r\n      })\r\n    );\r\n\r\n    this.materialScreenTexture = gl.createTexture();\r\n    if (!this.materialScreenTexture) {\r\n      throw new Error('Could not create screen texture!');\r\n    }\r\n    gl.bindTexture(gl.TEXTURE_2D, this.materialScreenTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n    this._screenRenderer = new ScreenPassPainter(gl);\r\n\r\n    this._renderTarget = new RenderTarget({\r\n      gl,\r\n      transparency: this.transparency,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n\r\n    this._postProcessTargets = [\r\n      new RenderTarget({\r\n        gl,\r\n        transparency: this.transparency,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      }),\r\n      new RenderTarget({\r\n        gl,\r\n        transparency: this.transparency,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      })\r\n    ];\r\n\r\n    this._msaaTarget = new RenderTarget({\r\n      gl,\r\n      transparency: this.transparency,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height,\r\n      antialias: this.multiSampleAntialiasing,\r\n      samples: this.samples\r\n    });\r\n  }\r\n\r\n  public register<T extends RendererPlugin>(renderer: T) {\r\n    this._renderers.set(renderer.type, renderer);\r\n    renderer.initialize(this.__gl, this);\r\n  }\r\n\r\n  public lazyRegister<TRenderer extends RendererPlugin>(type: TRenderer['type'], renderer: () => TRenderer) {\r\n    this._lazyRenderersFactory.set(type, renderer);\r\n  }\r\n\r\n  public get(rendererName: string): RendererPlugin | undefined {\r\n    let maybeRenderer = this._renderers.get(rendererName);\r\n    if (!maybeRenderer) {\r\n      const lazyFactory = this._lazyRenderersFactory.get(rendererName);\r\n      if (lazyFactory) {\r\n        this._logger.debug('lazy init renderer:', rendererName);\r\n        maybeRenderer = lazyFactory();\r\n        this.register(maybeRenderer);\r\n      }\r\n    }\r\n    return maybeRenderer;\r\n  }\r\n\r\n  private _currentRenderer: RendererPlugin | undefined;\r\n\r\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\r\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    this._isDrawLifecycle = true;\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    this._isDrawLifecycle = false;\r\n  }\r\n\r\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (args.length > 9) {\r\n        throw new Error('Only 10 or less renderer arguments are supported!;');\r\n      }\r\n    }\r\n    if (!this._isDrawLifecycle) {\r\n      this._logger.warnOnce(\r\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\r\n          `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`\r\n      );\r\n    }\r\n    if (this._isContextLost) {\r\n      this._logger.errorOnce(`Unable to draw ${rendererName}, the webgl context is lost`);\r\n      return;\r\n    }\r\n\r\n    const renderer = this.get(rendererName);\r\n    if (renderer) {\r\n      if (this.useDrawSorting) {\r\n        const drawCall = this._drawCallPool.get();\r\n        drawCall.z = this._state.current.z;\r\n        drawCall.priority = renderer.priority;\r\n        drawCall.renderer = rendererName;\r\n        this.getTransform().clone(drawCall.transform);\r\n        drawCall.state.z = this._state.current.z;\r\n        drawCall.state.opacity = this._state.current.opacity;\r\n        drawCall.state.tint = this._state.current.tint;\r\n        drawCall.state.material = this._state.current.material;\r\n        drawCall.args[0] = args[0];\r\n        drawCall.args[1] = args[1];\r\n        drawCall.args[2] = args[2];\r\n        drawCall.args[3] = args[3];\r\n        drawCall.args[4] = args[4];\r\n        drawCall.args[5] = args[5];\r\n        drawCall.args[6] = args[6];\r\n        drawCall.args[7] = args[7];\r\n        drawCall.args[8] = args[8];\r\n        drawCall.args[9] = args[9];\r\n        this._drawCalls[this._drawCallIndex++] = drawCall;\r\n      } else {\r\n        // Set the current renderer if not defined\r\n        if (!this._currentRenderer) {\r\n          this._currentRenderer = renderer;\r\n        }\r\n\r\n        if (!this._isCurrentRenderer(renderer)) {\r\n          // switching graphics means we must flush the previous\r\n          this._currentRenderer.flush();\r\n        }\r\n\r\n        // If we are still using the same renderer we can add to the current batch\r\n        renderer.draw(args[0], args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8], args[9]);\r\n\r\n        this._currentRenderer = renderer;\r\n      }\r\n    } else {\r\n      throw Error(`No renderer with name ${rendererName} has been registered`);\r\n    }\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.reset();\r\n  }\r\n\r\n  public updateViewport(resolution: Resolution): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\r\n\r\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._msaaTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (this._getImageWidth(image) === 0 || this._getImageHeight(image) === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this._state.current.material) {\r\n      this.draw<MaterialRenderer>('ex.material', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n    } else {\r\n      if (this.imageRenderer === 'ex.image') {\r\n        this.draw<ImageRenderer>(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n      } else {\r\n        this.draw<ImageRendererV2>(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n      }\r\n    }\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: AffineMatrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    return this._transform.current;\r\n  }\r\n\r\n  public multiply(m: AffineMatrix) {\r\n    this._transform.current.multiply(m, this._transform.current);\r\n  }\r\n\r\n  public addPostProcessor(postprocessor: PostProcessor) {\r\n    this._postprocessors.push(postprocessor);\r\n    postprocessor.initialize(this.__gl);\r\n  }\r\n\r\n  public removePostProcessor(postprocessor: PostProcessor) {\r\n    const index = this._postprocessors.indexOf(postprocessor);\r\n    if (index !== -1) {\r\n      this._postprocessors.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    this._postprocessors.length = 0;\r\n  }\r\n\r\n  private _totalPostProcessorTime = 0;\r\n  public updatePostProcessors(elapsed: number) {\r\n    for (const postprocessor of this._postprocessors) {\r\n      const shader = postprocessor.getShader();\r\n      shader.use();\r\n      const uniforms = shader.getUniforms();\r\n      this._totalPostProcessorTime += elapsed;\r\n\r\n      if (uniforms.find((u) => u.name === 'u_time_ms')) {\r\n        shader.setUniformFloat('u_time_ms', this._totalPostProcessorTime);\r\n      }\r\n      if (uniforms.find((u) => u.name === 'u_elapsed_ms')) {\r\n        shader.setUniformFloat('u_elapsed_ms', elapsed);\r\n      }\r\n      if (uniforms.find((u) => u.name === 'u_resolution')) {\r\n        shader.setUniformFloatVector('u_resolution', vec(this.width, this.height));\r\n      }\r\n\r\n      if (postprocessor.onUpdate) {\r\n        postprocessor.onUpdate(elapsed);\r\n      }\r\n    }\r\n  }\r\n\r\n  public set material(material: Material | null | undefined) {\r\n    this._state.current.material = material;\r\n  }\r\n\r\n  public get material(): Material | null | undefined {\r\n    return this._state.current.material;\r\n  }\r\n\r\n  /**\r\n   * Creates and initializes the material which compiles the internal shader\r\n   * @param options\r\n   * @returns Material\r\n   */\r\n  public createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material {\r\n    const material = new Material({ ...options, graphicsContext: this });\r\n    return material;\r\n  }\r\n\r\n  public createShader(options: Omit<ShaderOptions, 'gl'>): Shader {\r\n    const gl = this.__gl;\r\n    const { vertexSource, fragmentSource } = options;\r\n    const shader = new Shader({\r\n      gl,\r\n      vertexSource,\r\n      fragmentSource\r\n    });\r\n    shader.compile();\r\n    return shader;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    const currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\r\n    currentTarget.use();\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    if (this._isContextLost) {\r\n      this._logger.errorOnce(`Unable to flush the webgl context is lost`);\r\n      return;\r\n    }\r\n\r\n    // render target captures all draws and redirects to the render target\r\n    let currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\r\n    currentTarget.use();\r\n\r\n    if (this.useDrawSorting) {\r\n      // null out unused draw calls\r\n      for (let i = this._drawCallIndex; i < this._drawCalls.length; i++) {\r\n        this._drawCalls[i] = null as any;\r\n      }\r\n      // sort draw calls\r\n      // Find the original order of the first instance of the draw call\r\n      const originalSort = new Map<string, number>();\r\n      for (const [name] of this._renderers) {\r\n        let firstIndex = 0;\r\n        for (firstIndex = 0; firstIndex < this._drawCallIndex; firstIndex++) {\r\n          if (this._drawCalls[firstIndex].renderer === name) {\r\n            break;\r\n          }\r\n        }\r\n        originalSort.set(name, firstIndex);\r\n      }\r\n\r\n      this._drawCalls.sort((a, b) => {\r\n        if (a === null || b === null) {\r\n          return 0;\r\n        }\r\n        const zIndex = a.z - b.z;\r\n        const originalSortOrder = originalSort.get(a.renderer)! - originalSort.get(b.renderer)!;\r\n        const priority = a.priority - b.priority;\r\n        if (zIndex === 0) {\r\n          // sort by z first\r\n          if (priority === 0) {\r\n            // sort by priority\r\n            return originalSortOrder; // use the original order to inform draw call packing to maximally preserve painter order\r\n          }\r\n          return priority;\r\n        }\r\n        return zIndex;\r\n      });\r\n\r\n      const oldTransform = this._transform.current;\r\n      const oldState = this._state.current;\r\n\r\n      if (this._drawCalls.length && this._drawCallIndex) {\r\n        let currentRendererName = this._drawCalls[0].renderer;\r\n        let currentRenderer = this.get(currentRendererName);\r\n        for (let i = 0; i < this._drawCallIndex; i++) {\r\n          // hydrate the state for renderers\r\n          this._transform.current = this._drawCalls[i].transform;\r\n          this._state.current = this._drawCalls[i].state;\r\n\r\n          if (this._drawCalls[i].renderer !== currentRendererName) {\r\n            // switching graphics renderer means we must flush the previous\r\n            currentRenderer!.flush();\r\n            currentRendererName = this._drawCalls[i].renderer;\r\n            currentRenderer = this.get(currentRendererName);\r\n          }\r\n\r\n          // ! hack to grab screen texture before materials run because they might want it\r\n          if (currentRenderer instanceof MaterialRenderer && this.material?.isUsingScreenTexture) {\r\n            currentTarget.copyToTexture(this.materialScreenTexture!);\r\n            currentTarget.use();\r\n          }\r\n          // If we are still using the same renderer we can add to the current batch\r\n          currentRenderer!.draw(...this._drawCalls[i].args);\r\n        }\r\n        if (currentRenderer!.hasPendingDraws()) {\r\n          currentRenderer!.flush();\r\n        }\r\n      }\r\n\r\n      // reset state\r\n      this._transform.current = oldTransform;\r\n      this._state.current = oldState;\r\n\r\n      // reclaim draw calls\r\n      this._drawCallPool.done();\r\n      this._drawCallIndex = 0;\r\n      this._imageToHeight.clear();\r\n      this._imageToWidth.clear();\r\n    } else {\r\n      // This is the final flush at the moment to draw any leftover pending draw\r\n      for (const renderer of this._renderers.values()) {\r\n        if (renderer.hasPendingDraws()) {\r\n          renderer.flush();\r\n        }\r\n      }\r\n    }\r\n\r\n    currentTarget.disable();\r\n\r\n    // post process step\r\n    if (this._postprocessors.length > 0) {\r\n      currentTarget.toRenderSource().use();\r\n    }\r\n\r\n    // flip flop render targets for post processing\r\n    for (let i = 0; i < this._postprocessors.length; i++) {\r\n      currentTarget = this._postProcessTargets[i % 2];\r\n      this._postProcessTargets[i % 2].use();\r\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\r\n      this._postProcessTargets[i % 2].toRenderSource().use();\r\n    }\r\n\r\n    // Final blit to the screen\r\n    currentTarget.blitToScreen();\r\n  }\r\n}\r\n","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { Resolution } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\n\r\nconst pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~(x + pixelSnapEpsilon) : x,\r\n      this._ex.snapToPixel ? ~~(y + pixelSnapEpsilon) : y,\r\n      this._ex.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this._ex.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color?.toString() ?? '';\r\n    this._ex.__ctx.moveTo(\r\n      this._ex.snapToPixel ? ~~(start.x + pixelSnapEpsilon) : start.x,\r\n      this._ex.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this._ex.__ctx.lineTo(\r\n      this._ex.snapToPixel ? ~~(end.x + pixelSnapEpsilon) : end.x,\r\n      this._ex.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y\r\n    );\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~(point.x + pixelSnapEpsilon) : point.x,\r\n      this._ex.snapToPixel ? ~~(point.y + pixelSnapEpsilon) : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport interface ExcaliburGraphicsContext2DOptions extends ExcaliburGraphicsContextOptions {\r\n  context?: CanvasRenderingContext2D;\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx!: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public readonly useDrawSorting: boolean = false;\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public z: number = 0;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color | null | undefined {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color | null | undefined) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public snapToPixel: boolean = false;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContext2DOptions) {\r\n    const { canvasElement, context, enableTransparency, snapToPixel, antialiasing: smoothing, backgroundColor } = options;\r\n    this.__ctx =\r\n      context ??\r\n      (canvasElement.getContext('2d', {\r\n        alpha: enableTransparency ?? true\r\n      }) as CanvasRenderingContext2D);\r\n    if (!this.__ctx) {\r\n      throw new Error('Cannot build new ExcaliburGraphicsContext2D for some reason!');\r\n    }\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(_resolution: Resolution): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args as any);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(\r\n      this.snapToPixel ? ~~(start.x + pixelSnapEpsilon) : start.x,\r\n      this.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~(end.x + pixelSnapEpsilon) : end.x, this.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y,\r\n      this.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    if (stroke) {\r\n      this.__ctx.strokeStyle = stroke.toString();\r\n    }\r\n    if (thickness) {\r\n      this.__ctx.lineWidth = thickness;\r\n    }\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y,\r\n      radius,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this.__ctx.fill();\r\n    if (stroke) {\r\n      this.__ctx.stroke();\r\n    }\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n    this._state.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    throw new Error('Not implemented');\r\n  }\r\n\r\n  public multiply(_m: AffineMatrix): void {\r\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\r\n  }\r\n\r\n  public addPostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public removePostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    // pass\r\n  }\r\n\r\n  public updatePostProcessors(elapsed: number) {\r\n    // pass\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public set material(material: Material | undefined | null) {\r\n    this._state.current.material = material;\r\n  }\r\n\r\n  public get material(): Material | undefined | null {\r\n    return this._state.current.material;\r\n  }\r\n\r\n  public createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material {\r\n    // pass\r\n    return null as any;\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n\r\n  dispose(): void {\r\n    this.__ctx = undefined as any;\r\n  }\r\n}\r\n","import { vec, Vector } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { ExcaliburGraphicsContext2DCanvas } from './Graphics/Context/ExcaliburGraphicsContext2DCanvas';\r\nimport { EventEmitter } from './EventEmitter';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution within the container at all times will fill any gaps with canvas.\r\n   * The displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitContainerAndFill = 'FitContainerAndFill',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution the screen at all times will fill the screen.\r\n   * This displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitScreenAndFill = 'FitScreenAndFill',\r\n\r\n  /**\r\n   * Fit the viewport to the parent element maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in {@apilink FitContainer}.\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use {@apilink Screen.contentArea} to know the safe to draw area.\r\n   */\r\n  FitContainerAndZoom = 'FitContainerAndZoom',\r\n\r\n  /**\r\n   * Fit the viewport to the device screen maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in {@apilink FitScreen}.\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use {@apilink Screen.contentArea} to know the safe to draw area.\r\n   */\r\n  FitScreenAndZoom = 'FitScreenAndZoom',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as {@apilink Screen.enterFullscreen} but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as {@apilink Screen.enterFullscreen}\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): Resolution {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): Resolution {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): Resolution {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): Resolution {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): Resolution {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): Resolution {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): Resolution {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): Resolution {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\nexport type ViewportUnit = 'pixel' | 'percent';\r\n\r\nexport interface Resolution {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ViewportDimension {\r\n  widthUnit?: ViewportUnit;\r\n  heightUnit?: ViewportUnit;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally set the image rendering CSS hint on the canvas element, default is auto\r\n   */\r\n  canvasImageRendering?: 'auto' | 'pixelated';\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by {@apilink DisplayMode.FillContainer} and\r\n   * {@apilink DisplayMode.FillScreen}.\r\n   */\r\n  resolution?: Resolution;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ViewportDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n}\r\n\r\n/**\r\n * Fires when the screen resizes, useful if you have logic that needs to be aware of resolution/viewport constraints\r\n */\r\nexport interface ScreenResizeEvent {\r\n  /**\r\n   * Current viewport in css pixels of the screen\r\n   */\r\n  viewport: ViewportDimension;\r\n  /**\r\n   * Current resolution in world pixels of the screen\r\n   */\r\n  resolution: Resolution;\r\n}\r\n\r\n/**\r\n * Fires when the pixel ratio changes, useful to know if you've moved to a hidpi screen or back\r\n */\r\nexport interface PixelRatioChangeEvent {\r\n  /**\r\n   * Current pixel ratio of the screen\r\n   */\r\n  pixelRatio: number;\r\n}\r\n\r\n/**\r\n * Fires when the browser fullscreen api is successfully engaged or disengaged\r\n */\r\nexport interface FullScreenChangeEvent {\r\n  /**\r\n   * Current fullscreen state\r\n   */\r\n  fullscreen: boolean;\r\n}\r\n\r\n/**\r\n * Built in events supported by all entities\r\n */\r\nexport type ScreenEvents = {\r\n  /**\r\n   * Fires when the screen resizes, useful if you have logic that needs to be aware of resolution/viewport constraints\r\n   */\r\n  resize: ScreenResizeEvent;\r\n  /**\r\n   * Fires when the pixel ratio changes, useful to know if you've moved to a hidpi screen or back\r\n   */\r\n  pixelratio: PixelRatioChangeEvent;\r\n  /**\r\n   * Fires when the browser fullscreen api is successfully engaged or disengaged\r\n   */\r\n  fullscreen: FullScreenChangeEvent;\r\n};\r\n\r\nexport const ScreenEvents = {\r\n  ScreenResize: 'resize',\r\n  PixelRatioChange: 'pixelratio',\r\n  FullScreenChange: 'fullscreen'\r\n} as const;\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n  /**\r\n   * Listen to screen events {@apilink ScreenEvents}\r\n   */\r\n  public events = new EventEmitter<ScreenEvents>();\r\n  private _canvas: HTMLCanvasElement;\r\n  private _antialiasing: boolean = true;\r\n  private _canvasImageRendering: 'auto' | 'pixelated' = 'auto';\r\n  private _contentResolution: Resolution;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: Resolution;\r\n  private _resolutionStack: Resolution[] = [];\r\n  private _viewport: ViewportDimension;\r\n  private _viewportStack: ViewportDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullscreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._contentResolution = this.resolution;\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this.graphicsContext = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._canvasImageRendering = options.canvasImageRendering ?? this._canvasImageRendering;\r\n    this._browser = options.browser;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n\r\n    this._applyDisplayMode();\r\n\r\n    this._listenForPixelRatio();\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  private _listenForPixelRatio() {\r\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\r\n      // Safari <=13.1 workaround, remove any existing handlers\r\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n    }\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n\r\n    // Safari <=13.1 workaround\r\n    if (this._mediaQueryList.addEventListener) {\r\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\r\n    } else {\r\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\r\n    }\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this.events.clear();\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      this._browser.window.clear();\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      // Safari <=13.1 workaround\r\n      if (this._mediaQueryList.removeEventListener) {\r\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      } else {\r\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n      }\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n      this._canvas = null;\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    this._isFullscreen = !this._isFullscreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullscreen);\r\n    this.events.emit('fullscreen', {\r\n      fullscreen: this.isFullscreen\r\n    } satisfies FullScreenChangeEvent);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._listenForPixelRatio();\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n\r\n    this.events.emit('pixelratio', {\r\n      pixelRatio: this.pixelRatio\r\n    } satisfies PixelRatioChangeEvent);\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n\r\n    // Emit resize event\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  /**\r\n   * Returns the computed pixel ratio, first using any override, then the device pixel ratio\r\n   */\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  /**\r\n   * This calculates the ratio between excalibur pixels and the HTML pixels.\r\n   *\r\n   * This is useful for scaling HTML UI so that it matches your game.\r\n   */\r\n  public get worldToPagePixelRatio(): number {\r\n    if (this._canvas) {\r\n      const pageOrigin = this.worldToPageCoordinates(Vector.Zero);\r\n      const pageDistance = this.worldToPageCoordinates(vec(1, 0)).sub(pageOrigin);\r\n      const pixelConversion = pageDistance.x;\r\n      return pixelConversion;\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel ratio override\r\n   *\r\n   * You will need to call applyResolutionAndViewport() affect change on the screen\r\n   */\r\n  public get pixelRatioOverride(): number | undefined {\r\n    return this._pixelRatioOverride;\r\n  }\r\n\r\n  public set pixelRatioOverride(value: number | undefined) {\r\n    this._pixelRatioOverride = value;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    switch (this.displayMode) {\r\n      case DisplayMode.FillContainer:\r\n      case DisplayMode.FitContainer:\r\n      case DisplayMode.FitContainerAndFill:\r\n      case DisplayMode.FitContainerAndZoom:\r\n        return this.canvas.parentElement || document.body;\r\n      default:\r\n        return window;\r\n    }\r\n  }\r\n\r\n  public get resolution(): Resolution {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: Resolution) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  /**\r\n   * Returns screen dimensions in pixels or percentage\r\n   */\r\n  public get viewport(): ViewportDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ViewportDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ViewportDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): Resolution {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    if (this._resolutionStack.length && this._viewportStack.length) {\r\n      this.resolution = this._resolutionStack.pop();\r\n      this.viewport = this._viewportStack.pop();\r\n    }\r\n  }\r\n\r\n  public applyResolutionAndViewport() {\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      const scaledResolutionSupported = this.graphicsContext.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!scaledResolutionSupported) {\r\n        this._logger.warnOnce(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio})` +\r\n            ' are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n            ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n            ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).'\r\n        );\r\n\r\n        // Attempt to recover if the user hasn't configured a specific ratio for up scaling\r\n        if (!this.pixelRatioOverride) {\r\n          let currentPixelRatio = Math.max(1, this.pixelRatio - 0.5);\r\n          let newResolutionSupported = false;\r\n          while (currentPixelRatio > 1 && !newResolutionSupported) {\r\n            currentPixelRatio = Math.max(1, currentPixelRatio - 0.5);\r\n            const width = this._resolution.width * currentPixelRatio;\r\n            const height = this._resolution.height * currentPixelRatio;\r\n            newResolutionSupported = this.graphicsContext.checkIfResolutionSupported({ width, height });\r\n          }\r\n          this.pixelRatioOverride = currentPixelRatio;\r\n          this._logger.warnOnce(\r\n            'Scaled resolution too big attempted recovery!' +\r\n              ` Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit.` +\r\n              ' Setting `ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.` ' +\r\n              ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).'\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this._canvasImageRendering === 'auto') {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n\r\n    const widthUnit = this.viewport.widthUnit === 'percent' ? '%' : 'px';\r\n    const heightUnit = this.viewport.heightUnit === 'percent' ? '%' : 'px';\r\n\r\n    this._canvas.style.width = this.viewport.width + widthUnit;\r\n    this._canvas.style.height = this.viewport.height + heightUnit;\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this.graphicsContext.updateViewport(this.resolution);\r\n    this.graphicsContext.resetTransform();\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContext2DCanvas) {\r\n      this.graphicsContext.scale(this.pixelRatio, this.pixelRatio);\r\n    }\r\n    // Add the excalibur world pixel to page pixel\r\n    document.documentElement.style.setProperty('--ex-pixel-ratio', this.worldToPagePixelRatio.toString());\r\n  }\r\n\r\n  /**\r\n   * Get or set screen antialiasing,\r\n   *\r\n   * If true smoothing is applied\r\n   */\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Get or set screen antialiasing\r\n   */\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   * @deprecated use isFullscreen()\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullscreen;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   */\r\n  public get isFullscreen() {\r\n    return this._isFullscreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   *\r\n   * Optionally specify a target element id to go fullscreen, by default the game canvas is used\r\n   * @param elementId\r\n   * @deprecated use enterFullscreen(...)\r\n   */\r\n  public goFullScreen(elementId?: string): Promise<void> {\r\n    return this.enterFullscreen(elementId);\r\n  }\r\n\r\n  /**\r\n   * Requests to enter fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   *\r\n   * Optionally specify a target element id to go fullscreen, by default the game canvas is used\r\n   * @param elementId\r\n   */\r\n  public enterFullscreen(elementId?: string): Promise<void> {\r\n    if (elementId) {\r\n      const maybeElement = document.getElementById(elementId);\r\n      // workaround for safari partial support\r\n      if (maybeElement?.requestFullscreen || (maybeElement as any)?.webkitRequestFullscreen) {\r\n        if (!maybeElement.getAttribute('ex-fullscreen-listener')) {\r\n          maybeElement.setAttribute('ex-fullscreen-listener', 'true');\r\n          maybeElement.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n        }\r\n        if (maybeElement.requestFullscreen) {\r\n          return maybeElement.requestFullscreen() ?? Promise.resolve();\r\n        } else if ((maybeElement as any).webkitRequestFullscreen) {\r\n          return (maybeElement as any).webkitRequestFullscreen() ?? Promise.resolve();\r\n        }\r\n      }\r\n    }\r\n    if (this._canvas?.requestFullscreen) {\r\n      return this._canvas?.requestFullscreen() ?? Promise.resolve();\r\n    } else if ((this._canvas as any).webkitRequestFullscreen) {\r\n      return (this._canvas as any).webkitRequestFullscreen() ?? Promise.resolve();\r\n    }\r\n    this._logger.warnOnce('Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones');\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   * @deprecated use exitFullscreen()\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return this.exitFullscreen();\r\n  }\r\n\r\n  public exitFullscreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  private _viewportToPixels(viewport: ViewportDimension) {\r\n    return {\r\n      width: viewport.widthUnit === 'percent' ? this.canvas.offsetWidth : viewport.width,\r\n      height: viewport.heightUnit === 'percent' ? this.canvas.offsetHeight : viewport.height\r\n    } satisfies ViewportDimension;\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY). When using *AndFill suffixed display modes screen space\r\n   * (0, 0) is the top left of the safe content area bounding box not the viewport.\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullscreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    const viewport = this._viewportToPixels(this.viewport);\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullscreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * viewport.height;\r\n        newX = (newX / window.innerWidth) * viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * viewport.width;\r\n        newY = (newY / window.innerHeight) * viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / viewport.width) * this.resolution.width;\r\n    newY = (newY / viewport.height) * this.resolution.height;\r\n\r\n    // offset by content area\r\n    newX = newX - this.contentArea.left;\r\n    newY = newY - this.contentArea.top;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    // no need to offset by content area, drawing is already offset by this\r\n\r\n    const viewport = this._viewportToPixels(this.viewport);\r\n\r\n    newX = (newX / this.resolution.width) * viewport.width;\r\n    newY = (newY / this.resolution.height) * viewport.height;\r\n\r\n    if (this._isFullscreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullscreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where {@apilink Entity | `entities`} in Excalibur live by default {@apilink CoordPlane.World}\r\n   * and extends infinitely out relative from the {@apilink Camera}.\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    // offset by content area\r\n    point = point.add(vec(this.contentArea.left, this.contentArea.top));\r\n\r\n    // the only difference between screen & world is the camera transform\r\n    if (this._camera) {\r\n      return this._camera.inverse.multiply(point);\r\n    }\r\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where {@apilink ScreenElement | `screen elements`} and {@apilink Entity | `entities`} with {@apilink CoordPlane.Screen} live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    if (this._camera) {\r\n      return this._camera.transform.multiply(point);\r\n    }\r\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen that are in world space\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Half)\r\n      .scale(vec(1 / this._camera.zoom, 1 / this._camera.zoom))\r\n      .rotate(this._camera.rotation)\r\n      .translate(this._camera.drawPos);\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen and the bottom right corner of the screen.\r\n   *\r\n   * Screen bounds are in screen coordinates, useful for culling objects offscreen that are in screen space\r\n   */\r\n  public getScreenBounds(): BoundingBox {\r\n    const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero, Vector.Zero);\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get width(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  public get height(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  /**\r\n   * Returns the content area in screen space where it is safe to place content\r\n   */\r\n  public get contentArea(): BoundingBox {\r\n    return this._contentArea;\r\n  }\r\n\r\n  /**\r\n   * Returns the unsafe area in screen space, this is the full screen and some space may not be onscreen.\r\n   */\r\n  public get unsafeArea(): BoundingBox {\r\n    return this._unsafeArea;\r\n  }\r\n\r\n  private _contentArea: BoundingBox = new BoundingBox();\r\n  private _unsafeArea: BoundingBox = new BoundingBox();\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this._unsafeArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitScreenAndFill() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n    this._computeFitAndFill(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitContainerAndFill() {\r\n    this.canvas.style.width = '100%';\r\n    this.canvas.style.height = '100%';\r\n\r\n    this._computeFitAndFill(this.canvas.offsetWidth, this.canvas.offsetHeight, {\r\n      width: 100,\r\n      widthUnit: 'percent',\r\n      height: 100,\r\n      heightUnit: 'percent'\r\n    });\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitAndFill(vw: number, vh: number, viewport?: ViewportDimension) {\r\n    this.viewport = viewport ?? {\r\n      width: vw,\r\n      height: vh\r\n    };\r\n    // if the current screen aspectRatio is less than the original aspectRatio\r\n    if (vw / vh <= this._contentResolution.width / this._contentResolution.height) {\r\n      // compute new resolution to match the original aspect ratio\r\n      this.resolution = {\r\n        width: (vw * this._contentResolution.width) / vw,\r\n        height: (((vw * this._contentResolution.width) / vw) * vh) / vw\r\n      };\r\n      const clip = (this.resolution.height - this._contentResolution.height) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: clip,\r\n        left: 0,\r\n        right: this._contentResolution.width,\r\n        bottom: this.resolution.height - clip\r\n      });\r\n      this._unsafeArea = new BoundingBox({\r\n        top: -clip,\r\n        left: 0,\r\n        right: this._contentResolution.width,\r\n        bottom: this.resolution.height + clip\r\n      });\r\n    } else {\r\n      this.resolution = {\r\n        width: (((vh * this._contentResolution.height) / vh) * vw) / vh,\r\n        height: (vh * this._contentResolution.height) / vh\r\n      };\r\n      const clip = (this.resolution.width - this._contentResolution.width) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: 0,\r\n        left: clip,\r\n        right: this.resolution.width - clip,\r\n        bottom: this._contentResolution.height\r\n      });\r\n      this._unsafeArea = new BoundingBox({\r\n        top: 0,\r\n        left: -clip,\r\n        right: this.resolution.width + clip,\r\n        bottom: this._contentResolution.height\r\n      });\r\n    }\r\n  }\r\n\r\n  private _computeFitScreenAndZoom() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    this.canvas.style.position = 'absolute';\r\n\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitContainerAndZoom() {\r\n    this.canvas.style.width = '100%';\r\n    this.canvas.style.height = '100%';\r\n    this.canvas.style.position = 'relative';\r\n    const parent = this.canvas.parentElement;\r\n    parent.style.overflow = 'hidden';\r\n    const { offsetWidth: vw, offsetHeight: vh } = this.canvas;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitAndZoom(vw: number, vh: number) {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (vw / aspect < vh) {\r\n      adjustedWidth = vw;\r\n      adjustedHeight = vw / aspect;\r\n    } else {\r\n      adjustedWidth = vh * aspect;\r\n      adjustedHeight = vh;\r\n    }\r\n\r\n    const scaleX = vw / adjustedWidth;\r\n    const scaleY = vh / adjustedHeight;\r\n\r\n    const maxScaleFactor = Math.max(scaleX, scaleY);\r\n\r\n    const zoomedWidth = adjustedWidth * maxScaleFactor;\r\n    const zoomedHeight = adjustedHeight * maxScaleFactor;\r\n\r\n    // Center zoomed dimension if bigger than the screen\r\n    if (zoomedWidth > vw) {\r\n      this.canvas.style.left = -(zoomedWidth - vw) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.left = '';\r\n    }\r\n\r\n    if (zoomedHeight > vh) {\r\n      this.canvas.style.top = -(zoomedHeight - vh) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.top = '';\r\n    }\r\n\r\n    this.viewport = {\r\n      width: zoomedWidth,\r\n      height: zoomedHeight\r\n    };\r\n\r\n    const bounds = BoundingBox.fromDimension(this.viewport.width, this.viewport.height, Vector.Zero);\r\n    // return safe area\r\n    if (this.viewport.width > vw) {\r\n      const clip = ((this.viewport.width - vw) / this.viewport.width) * this.resolution.width;\r\n      bounds.top = 0;\r\n      bounds.left = clip / 2;\r\n      bounds.right = this.resolution.width - clip / 2;\r\n      bounds.bottom = this.resolution.height;\r\n    }\r\n\r\n    if (this.viewport.height > vh) {\r\n      const clip = ((this.viewport.height - vh) / this.viewport.height) * this.resolution.height;\r\n      bounds.top = clip / 2;\r\n      bounds.left = 0;\r\n      bounds.bottom = this.resolution.height - clip / 2;\r\n      bounds.right = this.resolution.width;\r\n    }\r\n    this._contentArea = bounds;\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    let widthUnit: ViewportUnit = 'pixel';\r\n    let heightUnit: ViewportUnit = 'pixel';\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      this.canvas.style.width = '100%';\r\n      adjustedWidth = 100;\r\n      widthUnit = 'percent';\r\n      adjustedHeight = this.canvas.offsetWidth / aspect;\r\n    } else {\r\n      this.canvas.style.height = '100%';\r\n      adjustedHeight = 100;\r\n      heightUnit = 'percent';\r\n      adjustedWidth = this.canvas.offsetHeight * aspect;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      widthUnit,\r\n      height: adjustedHeight,\r\n      heightUnit\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n    // watch resizing\r\n    if (this.parent instanceof Window) {\r\n      this._browser.window.on('resize', this._resizeHandler);\r\n    } else {\r\n      this._resizeObserver = new ResizeObserver(() => {\r\n        this._resizeHandler();\r\n      });\r\n      this._resizeObserver.observe(this.parent);\r\n    }\r\n    this.parent.addEventListener('resize', this._resizeHandler);\r\n  }\r\n\r\n  /**\r\n   * Sets the resolution and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.canvas.style.width = '100%';\r\n      this.canvas.style.height = '100%';\r\n      this.viewport = {\r\n        width: 100,\r\n        widthUnit: 'percent',\r\n        height: 100,\r\n        heightUnit: 'percent'\r\n      };\r\n      this.resolution = {\r\n        width: this.canvas.offsetWidth,\r\n        height: this.canvas.offsetHeight\r\n      };\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndFill) {\r\n      this._computeFitScreenAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndFill) {\r\n      this._computeFitContainerAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndZoom) {\r\n      this._computeFitScreenAndZoom();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndZoom) {\r\n      this._computeFitContainerAndZoom();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE?: AudioContext;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE!;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve(false);\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve(true);\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas {@apilink Graphic} to provide an adapter between the 2D Canvas API and the {@apilink ExcaliburGraphicsContext}.\r\n *\r\n * The {@apilink Canvas} works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the {@apilink ExcaliburGraphicsContext} implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions = {}) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like {@apilink WebAudioInstance}\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","export interface State<TData> {\r\n  name?: string;\r\n  transitions: string[];\r\n  onEnter?: (context: { from: string; eventData?: any; data: TData }) => boolean | void;\r\n  onState?: () => any;\r\n  onExit?: (context: { to: string; data: TData }) => boolean | void;\r\n  onUpdate?: (data: TData, elapsed: number) => any;\r\n}\r\n\r\nexport interface StateMachineDescription<TData = any> {\r\n  start: string;\r\n  states: { [name: string]: State<TData> };\r\n}\r\n\r\nexport type PossibleStates<TMachine> = TMachine extends StateMachineDescription ? Extract<keyof TMachine['states'], string> : never;\r\n\r\nexport interface StateMachineState<TData> {\r\n  data: TData;\r\n  currentState: string;\r\n}\r\n\r\nexport class StateMachine<TPossibleStates extends string, TData> {\r\n  public startState: State<TData>;\r\n  private _currentState: State<TData>;\r\n  public get currentState(): State<TData> {\r\n    return this._currentState;\r\n  }\r\n  public set currentState(state: State<TData>) {\r\n    this._currentState = state;\r\n  }\r\n  public states = new Map<string, State<TData>>();\r\n  public data: TData;\r\n\r\n  static create<TMachine extends StateMachineDescription<TData>, TData>(\r\n    machineDescription: TMachine,\r\n    data?: TData\r\n  ): StateMachine<PossibleStates<TMachine>, TData> {\r\n    const machine = new StateMachine<PossibleStates<TMachine>, TData>();\r\n    machine.data = data;\r\n    for (const stateName in machineDescription.states) {\r\n      machine.states.set(stateName as PossibleStates<TMachine>, {\r\n        name: stateName,\r\n        ...machineDescription.states[stateName]\r\n      });\r\n    }\r\n\r\n    // validate transitions are states\r\n    for (const state of machine.states.values()) {\r\n      for (const transitionState of state.transitions) {\r\n        if (transitionState === '*') {\r\n          continue;\r\n        }\r\n        if (!machine.states.has(transitionState)) {\r\n          throw Error(\r\n            `Invalid state machine, state [${state.name}] has a transition to another state that doesn't exist [${transitionState}]`\r\n          );\r\n        }\r\n      }\r\n    }\r\n    machine.currentState = machine.startState = machine.states.get(machineDescription.start);\r\n    return machine;\r\n  }\r\n\r\n  in(state: TPossibleStates): boolean {\r\n    return this.currentState.name === state;\r\n  }\r\n\r\n  go(stateName: TPossibleStates, eventData?: any): boolean {\r\n    if (this.currentState.transitions.includes(stateName) || this.currentState.transitions.includes('*')) {\r\n      const potentialNewState = this.states.get(stateName);\r\n      if (this.currentState.onExit) {\r\n        const canExit = this.currentState?.onExit({ to: potentialNewState.name, data: this.data });\r\n        if (canExit === false) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if (potentialNewState?.onEnter) {\r\n        const canEnter = potentialNewState?.onEnter({ from: this.currentState.name, eventData, data: this.data });\r\n        if (canEnter === false) {\r\n          return false;\r\n        }\r\n      }\r\n      this.currentState = potentialNewState;\r\n      if (this.currentState?.onState) {\r\n        this.currentState.onState();\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  update(elapsed: number) {\r\n    if (this.currentState.onUpdate) {\r\n      this.currentState.onUpdate(this.data, elapsed);\r\n    }\r\n  }\r\n\r\n  save(saveKey: string) {\r\n    localStorage.setItem(\r\n      saveKey,\r\n      JSON.stringify({\r\n        currentState: this.currentState.name,\r\n        data: this.data\r\n      })\r\n    );\r\n  }\r\n\r\n  restore(saveKey: string) {\r\n    const state: StateMachineState<TData> = JSON.parse(localStorage.getItem(saveKey));\r\n    this.currentState = this.states.get(state.currentState);\r\n    this.data = state.data;\r\n  }\r\n}\r\n","import { StateMachine } from '../../Util/StateMachine';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { clamp } from '../../Math/util';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { Future } from '../../Util/Future';\r\n\r\ninterface SoundState {\r\n  startedAt: number;\r\n  pausedAt: number;\r\n}\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _instance!: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n\r\n  private _playingFuture = new Future<boolean>();\r\n  private _stateMachine = StateMachine.create(\r\n    {\r\n      start: 'STOPPED',\r\n      states: {\r\n        PLAYING: {\r\n          onEnter: ({ data }) => {\r\n            // Buffer nodes are single use\r\n            this._createNewBufferSource();\r\n            this._handleEnd();\r\n            if (this.loop) {\r\n              // when looping don't set a duration\r\n              this._instance.start(0, data.pausedAt * this._playbackRate);\r\n            } else {\r\n              this._instance.start(0, data.pausedAt * this._playbackRate, this.duration);\r\n            }\r\n            data.startedAt = this._audioContext.currentTime - data.pausedAt;\r\n            data.pausedAt = 0;\r\n          },\r\n          onState: () => this._playStarted(),\r\n          onExit: ({ to }) => {\r\n            // If you've exited early only resolve if explicitly STOPPED\r\n            if (to === 'STOPPED') {\r\n              this._playingFuture.resolve(true);\r\n            }\r\n            // Whenever you're not playing... you stop!\r\n            this._instance.onended = null; // disconnect the wired on-end handler\r\n            this._instance.disconnect();\r\n            this._instance.stop(0);\r\n            this._instance = null as any;\r\n          },\r\n          transitions: ['STOPPED', 'PAUSED', 'SEEK']\r\n        },\r\n        SEEK: {\r\n          onEnter: ({ eventData: position, data }: { eventData?: number; data: SoundState }) => {\r\n            data.pausedAt = (position ?? 0) / this._playbackRate;\r\n            data.startedAt = 0;\r\n          },\r\n          transitions: ['*']\r\n        },\r\n        STOPPED: {\r\n          onEnter: ({ data }) => {\r\n            data.pausedAt = 0;\r\n            data.startedAt = 0;\r\n            this._playingFuture.resolve(true);\r\n          },\r\n          transitions: ['PLAYING', 'PAUSED', 'SEEK']\r\n        },\r\n        PAUSED: {\r\n          onEnter: ({ data }) => {\r\n            // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n            // default is 1.0\r\n            // we need to invert it to get the time scale\r\n            data.pausedAt = this._audioContext.currentTime - data.startedAt;\r\n          },\r\n          transitions: ['PLAYING', 'STOPPED', 'SEEK']\r\n        }\r\n      }\r\n    },\r\n    {\r\n      startedAt: 0,\r\n      pausedAt: 0\r\n    } satisfies SoundState\r\n  );\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.value = this._playbackRate;\r\n    this._instance.connect(this._volumeNode);\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n  }\r\n\r\n  private _handleEnd() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => {\r\n        this._playingFuture.resolve(true);\r\n      };\r\n    }\r\n  }\r\n\r\n  private _volume = 1;\r\n  private _loop = false;\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  private _playStarted: () => any = () => {};\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      if (!this.loop) {\r\n        this._instance.onended = () => {\r\n          this._playingFuture.resolve(true);\r\n        };\r\n      }\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._stateMachine.in('PLAYING') && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Returns the set duration to play, otherwise returns the total duration if unset\r\n   */\r\n  public get duration() {\r\n    return this._duration ?? this.getTotalPlaybackDuration();\r\n  }\r\n\r\n  /**\r\n   * Set the duration that this audio should play.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number) {\r\n    this._duration = duration;\r\n  }\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._stateMachine.in('PLAYING');\r\n  }\r\n\r\n  public isPaused() {\r\n    return this._stateMachine.in('PAUSED') || this._stateMachine.in('SEEK');\r\n  }\r\n\r\n  public isStopped() {\r\n    return this._stateMachine.in('STOPPED');\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    this._playStarted = playStarted;\r\n    this._stateMachine.go('PLAYING');\r\n    return this._playingFuture.promise;\r\n  }\r\n\r\n  public pause() {\r\n    this._stateMachine.go('PAUSED');\r\n  }\r\n\r\n  public stop() {\r\n    this._stateMachine.go('STOPPED');\r\n  }\r\n\r\n  public seek(position: number) {\r\n    this._stateMachine.go('PAUSED');\r\n    this._stateMachine.go('SEEK', position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    return this._src.duration;\r\n  }\r\n\r\n  public getPlaybackPosition() {\r\n    const { pausedAt, startedAt } = this._stateMachine.data;\r\n    if (pausedAt) {\r\n      return pausedAt * this._playbackRate;\r\n    }\r\n    if (startedAt) {\r\n      return (this._audioContext.currentTime - startedAt) * this._playbackRate;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _playbackRate = 1.0;\r\n  public set playbackRate(playbackRate: number) {\r\n    this._instance.playbackRate.value = this._playbackRate = playbackRate;\r\n  }\r\n\r\n  public get playbackRate() {\r\n    return this._instance.playbackRate.value;\r\n  }\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(\r\n    public target: Sound,\r\n    protected _name: string = 'MediaEvent'\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(\r\n    target: Sound,\r\n    public track?: WebAudioInstance\r\n  ) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(\r\n    target: Sound,\r\n    private _processedData: string | AudioBuffer\r\n  ) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)(?:(?:\\?|\\#).*)*$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../../EventEmitter';\r\n\r\nexport type SoundEvents = {\r\n  volumechange: NativeSoundEvent;\r\n  processed: NativeSoundProcessedEvent;\r\n  pause: NativeSoundEvent;\r\n  stop: NativeSoundEvent;\r\n  playbackend: NativeSoundEvent;\r\n  resume: NativeSoundEvent;\r\n  playbackstart: NativeSoundEvent;\r\n};\r\n\r\nexport const SoundEvents = {\r\n  VolumeChange: 'volumechange',\r\n  Processed: 'processed',\r\n  Pause: 'pause',\r\n  Stop: 'stop',\r\n  PlaybackEnd: 'playbackend',\r\n  Resume: 'resume',\r\n  PlaybackStart: 'playbackstart'\r\n};\r\n\r\n/**\r\n * The {@apilink Sound} object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. {@apilink Sound} is an {@apilink Loadable}\r\n * which means it can be passed to a {@apilink Loader} to pre-load before a game or level.\r\n */\r\nexport class Sound implements Audio, Loadable<AudioBuffer> {\r\n  public events = new EventEmitter<SoundEvents>();\r\n  public logger: Logger = Logger.getInstance();\r\n  public data!: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.events.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Get the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   */\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n  /**\r\n   * Set the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number | undefined) {\r\n    this._duration = duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _isStopped = false;\r\n  // private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine?: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _playbackRate = 1.0;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = this._duration ?? audiobuffer?.duration ?? undefined;\r\n    this.events.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return (this.data = audiobuffer);\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  public isPaused(): boolean {\r\n    return this._tracks.some((t) => t.isPaused());\r\n  }\r\n\r\n  public isStopped(): boolean {\r\n    return this._tracks.some((t) => t.isStopped());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this.isPaused()) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this.events.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.events.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n  public get playbackRate(): number {\r\n    return this._playbackRate;\r\n  }\r\n\r\n  public set playbackRate(playbackRate: number) {\r\n    this._playbackRate = playbackRate;\r\n    this._tracks.forEach((t) => {\r\n      t.playbackRate = this._playbackRate;\r\n    });\r\n  }\r\n\r\n  public seek(position: number, trackId = 0) {\r\n    if (this._tracks.length === 0) {\r\n      this._getTrackInstance(this.data);\r\n    }\r\n\r\n    this._tracks[trackId].seek(position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warnOnce(\r\n        `Sound from ${this.path} is not loaded, cannot return total playback duration.` +\r\n          `Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`\r\n      );\r\n      return 0;\r\n    }\r\n    return this.data.duration;\r\n  }\r\n\r\n  /**\r\n   * Return the current playback time of the playing track in seconds from the start.\r\n   *\r\n   * Optionally specify the track to query if multiple are playing at once.\r\n   * @param trackId\r\n   */\r\n  public getPlaybackPosition(trackId = 0) {\r\n    if (this._tracks.length) {\r\n      return this._tracks[trackId].getPlaybackPosition();\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track {@apilink Audio} which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this.isPaused()) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(\r\n          track.play().then(() => {\r\n            this._tracks.splice(this.getTrackId(track), 1);\r\n            return true;\r\n          })\r\n        );\r\n      }\r\n\r\n      this.events.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.events.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    this.events.emit('playbackend', new NativeSoundEvent(this, track));\r\n\r\n    // cleanup any done tracks\r\n    const trackId = this.getTrackId(track);\r\n    if (trackId !== -1) {\r\n      this._tracks.splice(trackId, 1);\r\n    }\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration ?? 0;\r\n    newTrack.playbackRate = this._playbackRate;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, event: SoundEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler as any);\r\n  }\r\n}\r\n","import { WebAudio } from '../Util/WebAudio';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport { Canvas } from '../Graphics/Canvas';\r\nimport { ImageFiltering } from '../Graphics/Filtering';\r\nimport { clamp } from '../Math/util';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Future } from '../Util/Future';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { Color } from '../Color';\r\nimport { delay } from '../Util/Util';\r\n\r\nexport interface DefaultLoaderOptions {\r\n  /**\r\n   * List of loadables\r\n   */\r\n  loadables?: Loadable<any>[];\r\n}\r\n\r\nexport type LoaderEvents = {\r\n  // Add event types here\r\n  beforeload: void;\r\n  afterload: void;\r\n  useraction: void;\r\n  loadresourcestart: Loadable<any>;\r\n  loadresourceend: Loadable<any>;\r\n};\r\n\r\nexport const LoaderEvents = {\r\n  // Add event types here\r\n  BeforeLoad: 'beforeload',\r\n  AfterLoad: 'afterload',\r\n  UserAction: 'useraction',\r\n  LoadResourceStart: 'loadresourcestart',\r\n  LoadResourceEnd: 'loadresourceend'\r\n};\r\n\r\nexport type LoaderConstructor = new (...args: any[]) => DefaultLoader;\r\n/**\r\n * Returns true if the constructor is for an Excalibur Loader\r\n */\r\nexport function isLoaderConstructor(x: any): x is LoaderConstructor {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\nexport class DefaultLoader implements Loadable<Loadable<any>[]> {\r\n  public data!: Loadable<any>[];\r\n  public events = new EventEmitter<LoaderEvents>();\r\n  public canvas: Canvas = new Canvas({\r\n    filtering: ImageFiltering.Blended,\r\n    smoothing: true,\r\n    cache: false,\r\n    draw: this.onDraw.bind(this)\r\n  });\r\n  private _resources: Loadable<any>[] = [];\r\n  public get resources(): readonly Loadable<any>[] {\r\n    return this._resources;\r\n  }\r\n  private _numLoaded: number = 0;\r\n  public engine!: Engine;\r\n\r\n  /**\r\n   * @param options Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(options?: DefaultLoaderOptions) {\r\n    if (options && options.loadables?.length) {\r\n      this.addResources(options.loadables);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called by the engine before loading\r\n   * @param engine\r\n   */\r\n  public onInitialize(engine: Engine) {\r\n    this.engine = engine;\r\n    this.canvas.width = this.engine.screen.resolution.width;\r\n    this.canvas.height = this.engine.screen.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Return a promise that resolves when the user interacts with the loading screen in some way, usually a click.\r\n   *\r\n   * It's important to implement this in order to unlock the audio context in the browser. Browsers automatically prevent\r\n   * audio from playing until the user performs an action.\r\n   *\r\n   */\r\n  public async onUserAction(): Promise<void> {\r\n    return await Promise.resolve();\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called directly before loading starts\r\n   */\r\n  public async onBeforeLoad() {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called after loading has completed\r\n   */\r\n  public async onAfterLoad() {\r\n    // override me\r\n    await delay(500, this.engine.clock); // avoid a flicker\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    this._resources.push(loadable);\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    const total = this._resources.length;\r\n    return total > 0 ? clamp(this._numLoaded, 0, total) / total : 1;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resources.length;\r\n  }\r\n\r\n  private _totalTimeMs = 0;\r\n\r\n  /**\r\n   * Optionally override the onUpdate\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  onUpdate(engine: Engine, elapsed: number): void {\r\n    this._totalTimeMs += elapsed;\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Optionally override the onDraw\r\n   */\r\n  onDraw(ctx: CanvasRenderingContext2D) {\r\n    const seconds = this._totalTimeMs / 1000;\r\n\r\n    ctx.fillStyle = Color.Black.toRGBA();\r\n    ctx.fillRect(0, 0, this.engine.screen.resolution.width, this.engine.screen.resolution.height);\r\n\r\n    ctx.save();\r\n    ctx.translate(this.engine.screen.resolution.width / 2, this.engine.screen.resolution.height / 2);\r\n    const speed = seconds * 10;\r\n    ctx.strokeStyle = 'white';\r\n    ctx.lineWidth = 10;\r\n    ctx.lineCap = 'round';\r\n    ctx.arc(0, 0, 40, speed, speed + (Math.PI * 3) / 2);\r\n    ctx.stroke();\r\n\r\n    ctx.fillStyle = 'white';\r\n    ctx.font = '16px sans-serif';\r\n    const text = (this.progress * 100).toFixed(0) + '%';\r\n    const textbox = ctx.measureText(text);\r\n    const width = Math.abs(textbox.actualBoundingBoxLeft) + Math.abs(textbox.actualBoundingBoxRight);\r\n    const height = Math.abs(textbox.actualBoundingBoxAscent) + Math.abs(textbox.actualBoundingBoxDescent);\r\n    ctx.fillText(text, -width / 2, height / 2); // center\r\n    ctx.restore();\r\n  }\r\n\r\n  private _loadingFuture = new Future<void>();\r\n  public areResourcesLoaded() {\r\n    if (this._resources.length === 0) {\r\n      // special case no resources mean loaded;\r\n      return Promise.resolve();\r\n    }\r\n    return this._loadingFuture.promise;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be overridden\r\n   *\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete AND the user has interacted with the loading screen\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await this.onBeforeLoad();\r\n    this.events.emit('beforeload');\r\n    this.canvas.flagDirty();\r\n\r\n    await Promise.all(\r\n      this._resources.map(async (r) => {\r\n        this.events.emit('loadresourcestart', r);\r\n        await r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n          this.canvas.flagDirty();\r\n          this.events.emit('loadresourceend', r);\r\n        });\r\n      })\r\n    );\r\n\r\n    // Wire all sound to the engine\r\n    for (const resource of this._resources) {\r\n      if (resource instanceof Sound) {\r\n        resource.wireEngine(this.engine);\r\n      }\r\n    }\r\n\r\n    this._loadingFuture.resolve();\r\n    this.canvas.flagDirty();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await this.onUserAction();\r\n    this.events.emit('useraction');\r\n    await WebAudio.unlock();\r\n\r\n    await this.onAfterLoad();\r\n    this.events.emit('afterload');\r\n    return (this.data = this._resources);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, event: LoaderEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    (this.events as any).off(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport * as DrawUtil from '../Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Vector } from '../Math/vector';\r\nimport { delay } from '../Util/Util';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { DefaultLoader, DefaultLoaderOptions } from './DefaultLoader';\r\nimport { Engine } from '../Engine';\r\nimport { Screen } from '../Screen';\r\nimport { Logger } from '../Util/Log';\r\nimport { Future } from '../Util/Future';\r\n\r\nexport interface LoaderOptions extends DefaultLoaderOptions {\r\n  /**\r\n   * Go fullscreen after loading and clicking play\r\n   */\r\n  fullscreenAfterLoad?: boolean;\r\n  /**\r\n   * Fullscreen container element or id\r\n   */\r\n  fullscreenContainer?: HTMLElement | string;\r\n}\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The {@apilink Loader} itself implements {@apilink Loadable} so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends DefaultLoader {\r\n  private _logger = Logger.getInstance();\r\n  private static _DEFAULT_LOADER_OPTIONS: LoaderOptions = {\r\n    loadables: [],\r\n    fullscreenAfterLoad: false,\r\n    fullscreenContainer: undefined\r\n  };\r\n  private _originalOptions: LoaderOptions = { loadables: [] };\r\n  public events = new EventEmitter();\r\n  public screen!: Screen;\r\n  private _playButtonShown: boolean = false;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition!: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition!: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition!: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is {@apilink Color.White}\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement!: HTMLImageElement;\r\n  protected _imageLoaded: Future<void> = new Future();\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.onload = () => this._imageLoaded.resolve();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement!: HTMLElement;\r\n  protected _playButtonElement!: HTMLButtonElement;\r\n  protected _styleBlock!: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param options Optionally provide options to loader\r\n   */\r\n  constructor(options?: LoaderOptions);\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]);\r\n  constructor(loadablesOrOptions?: Loadable<any>[] | LoaderOptions) {\r\n    const options = Array.isArray(loadablesOrOptions)\r\n      ? {\r\n          loadables: loadablesOrOptions\r\n        }\r\n      : loadablesOrOptions;\r\n    super(options);\r\n    this._originalOptions = { ...Loader._DEFAULT_LOADER_OPTIONS, ...options };\r\n  }\r\n\r\n  public override onInitialize(engine: Engine): void {\r\n    this.engine = engine;\r\n    this.screen = engine.screen;\r\n    this.canvas.width = this.engine.canvas.width;\r\n    this.canvas.height = this.engine.canvas.height;\r\n    this.screen.events.on('resize', () => {\r\n      this.canvas.width = this.engine.canvas.width;\r\n      this.canvas.height = this.engine.canvas.height;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public async showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      // Delay is to give the logo a chance to show, otherwise don't delay\r\n      await delay(500, this.engine?.clock);\r\n    } else {\r\n      const resizeHandler = () => {\r\n        try {\r\n          this._positionPlayButton();\r\n        } catch {\r\n          // swallow if can't position\r\n        }\r\n      };\r\n      if (this.engine?.browser) {\r\n        this.engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      this._positionPlayButton();\r\n      const playButtonClicked = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this.engine?.browser) {\r\n            this.engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n\r\n          if (this._originalOptions.fullscreenAfterLoad) {\r\n            try {\r\n              this._logger.info('requesting fullscreen');\r\n              if (this._originalOptions.fullscreenContainer instanceof HTMLElement) {\r\n                this._originalOptions.fullscreenContainer.requestFullscreen();\r\n              } else {\r\n                this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer);\r\n              }\r\n            } catch (error) {\r\n              this._logger.error('could not go fullscreen', error);\r\n            }\r\n          }\r\n\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n        if (this.engine) {\r\n          this.engine.input.gamepads.once('button', () => startButtonHandler(new Event('button')));\r\n        }\r\n      });\r\n\r\n      return await playButtonClicked;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null as any;\r\n      this._playButtonElement = null as any;\r\n      this._styleBlock = null as any;\r\n    }\r\n  }\r\n\r\n  data!: Loadable<any>[];\r\n\r\n  public override async onUserAction(): Promise<void> {\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200, this.engine?.clock);\r\n    this.canvas.flagDirty();\r\n    // show play button\r\n    await this.showPlayButton();\r\n  }\r\n\r\n  public override async onBeforeLoad(): Promise<void> {\r\n    this.screen.pushResolutionAndViewport();\r\n    this.screen.resolution = { width: this.canvas.width, height: this.canvas.height };\r\n    this.screen.applyResolutionAndViewport();\r\n    const image = this._image;\r\n    await this._imageLoaded.promise;\r\n    await image?.decode(); // decode logo if it exists\r\n  }\r\n\r\n  // eslint-disable-next-line require-await\r\n  public override async onAfterLoad(): Promise<void> {\r\n    this.screen.popResolutionAndViewport();\r\n    this.screen.applyResolutionAndViewport();\r\n    this.dispose();\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    if (this.engine) {\r\n      const { x: left, y: top, width: screenWidth, height: screenHeight } = this.engine.canvas.getBoundingClientRect();\r\n      if (this._playButtonRootElement) {\r\n        const buttonWidth = this._playButton.clientWidth;\r\n        const buttonHeight = this._playButton.clientHeight;\r\n        if (this.playButtonPosition) {\r\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n        } else {\r\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public override onDraw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this.engine.canvasHeight / this.engine.pixelRatio;\r\n    const canvasWidth = this.engine.canvasWidth / this.engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this.engine.screen.antialiasing;\r\n    this.engine.screen.antialiasing = true;\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this.engine.screen.antialiasing = oldAntialias;\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this.engine.screen.antialiasing = oldAntialias;\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // ()\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // ()\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function () {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function () {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function () {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function () {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function () {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function () {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function () {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/**\n * An enum that describes the types of collisions bodies can participate in\n */\nexport enum CollisionType {\n  /**\n   * Bodies with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Bodies with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other bodies and do not influence or move other bodies.\n   * This is useful for use in trigger type behavior.\n   */\n  Passive = 'Passive',\n  /**\n   * Bodies with the `Active` setting raise collision events and participate\n   * in collisions with other bodies and will be push or moved by bodies sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Bodies with the `Fixed` setting raise collision events and participate in\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum SolverStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n","/**\r\n * Tells the Arcade collision solver to prefer certain contacts over others\r\n */\r\nexport enum ContactSolveBias {\r\n  None = 'none',\r\n  VerticalFirst = 'vertical-first',\r\n  HorizontalFirst = 'horizontal-first'\r\n}\r\n\r\n/**\r\n * Contact bias values\r\n */\r\nexport interface ContactBias {\r\n  vertical: number;\r\n  horizontal: number;\r\n}\r\n\r\n/**\r\n * Vertical First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\r\n */\r\nexport const VerticalFirst: ContactBias = {\r\n  vertical: 1,\r\n  horizontal: 2\r\n} as const;\r\n\r\n/**\r\n * Horizontal First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\r\n */\r\nexport const HorizontalFirst: ContactBias = {\r\n  horizontal: 1,\r\n  vertical: 2\r\n} as const;\r\n\r\n/**\r\n * None value, {@apilink ArcadeSolver} sorts contacts using distance by default\r\n */\r\nexport const None: ContactBias = {\r\n  horizontal: 0,\r\n  vertical: 0\r\n} as const;\r\n","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      const existingGroup = this._GROUPS.get(name);\n      if (existingGroup.mask === mask) {\n        return existingGroup;\n      }\n      throw new Error(`Collision group ${name} already exists with a different mask!`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { CollisionGroupManager } from './CollisionGroupManager';\r\n\r\n/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use {@apilink CollisionGroupManager} to create {@apilink CollisionGroup}s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` {@apilink CollisionGroup} is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that {@apilink CollisionGroupManager.create} is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   *\r\n   * This means the mask has the same bit set the other category and vice versa\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    const overlap1 = this.category & other.mask;\r\n    const overlap2 = this.mask & other.category;\r\n    return overlap1 !== 0 && overlap2 !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    const group = CollisionGroupManager.create('~(' + this.name + ')', ~this.mask | 0);\r\n    group._category = ~this.category;\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   * @param collisionGroups\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return CollisionGroupManager.create(combinedName, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = `collidesWith(${collisionGroups.map((c) => c.name).join('+')})`;\r\n    const combinedMask = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    return CollisionGroupManager.create(combinedName, combinedMask);\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\ncategory: ${this.category.toString(2).padStart(32, '0')}\r\nmask:     ${(this.mask >>> 0).toString(2).padStart(32, '0')}\r\n    `;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(\r\n    public colliderA: Collider,\r\n    public colliderB: Collider\r\n  ) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\r\n   * @param colliderA\r\n   * @param colliderB\r\n   */\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    // Prevent self collision\r\n    if (colliderA.id === colliderB.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.isActive || !bodyB.isActive) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * A 1 dimensional projection on an axis, used to test overlaps\r\n */\r\n\r\nexport class Projection {\r\n  constructor(\r\n    public min: number,\r\n    public max: number\r\n  ) {}\r\n  public overlaps(projection: Projection): boolean {\r\n    return this.max > projection.min && projection.max > this.min;\r\n  }\r\n\r\n  public getOverlap(projection: Projection): number {\r\n    if (this.overlaps(projection)) {\r\n      if (this.max > projection.max) {\r\n        return projection.max - this.min;\r\n      } else {\r\n        return this.max - projection.min;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\nimport { DynamicTreeConfig } from '../PhysicsConfig';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<TProxy extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<TProxy>;\r\n  public nodes: { [key: number]: TreeNode<TProxy> };\r\n  constructor(\r\n    private _config: Required<DynamicTreeConfig>,\r\n    public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)\r\n  ) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<TProxy>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<TProxy>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<TProxy>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: TProxy) {\r\n    const node = new TreeNode<TProxy>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: TProxy) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= this._config.boundsPadding;\r\n    b.top -= this._config.boundsPadding;\r\n    b.right += this._config.boundsPadding;\r\n    b.bottom += this._config.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * this._config.velocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * this._config.velocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: TProxy) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<TProxy>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: TProxy, callback: (other: TProxy) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<TProxy>): boolean => {\r\n      if (currentNode && currentNode.bounds.overlaps(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: TProxy) => boolean): void {\r\n    const helper = (currentNode: TreeNode<TProxy>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<TProxy>[] {\r\n    const helper = (currentNode: TreeNode<TProxy>): TreeNode<TProxy>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<TProxy>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { LineSegment } from './line-segment';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: LineSegment): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: LineSegment): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { CollisionGroup } from '../Group/CollisionGroup';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { RayCastHit } from './RayCastHit';\r\nimport { DeepRequired } from '../../Util/Required';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\nimport { RayCastOptions } from './RayCastOptions';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { createId } from '../../Id';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential collisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree: DynamicTree<Collider>;\r\n  private _pairs = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(private _config: DeepRequired<PhysicsConfig>) {\r\n    this._dynamicCollisionTree = new DynamicTree<Collider>(_config.dynamicTree);\r\n  }\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  public query(point: Vector): Collider[];\r\n  public query(bounds: BoundingBox): Collider[];\r\n  public query(pointOrBounds: Vector | BoundingBox): Collider[] {\r\n    const results: Collider[] = [];\r\n    if (pointOrBounds instanceof BoundingBox) {\r\n      this._dynamicCollisionTree.query(\r\n        {\r\n          id: createId('collider', -1),\r\n          owner: null,\r\n          bounds: pointOrBounds\r\n        } as Collider,\r\n        (other) => {\r\n          results.push(other);\r\n          return false;\r\n        }\r\n      );\r\n    } else {\r\n      this._dynamicCollisionTree.query(\r\n        {\r\n          id: createId('collider', -1),\r\n          owner: null,\r\n          bounds: new BoundingBox(pointOrBounds.x, pointOrBounds.y, pointOrBounds.x, pointOrBounds.y)\r\n        } as Collider,\r\n        (other) => {\r\n          results.push(other);\r\n          return false;\r\n        }\r\n      );\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    const results: RayCastHit[] = [];\r\n    const maxDistance = options?.maxDistance ?? Infinity;\r\n    const collisionGroup = options?.collisionGroup;\r\n    const collisionMask = !collisionGroup ? options?.collisionMask ?? CollisionGroup.All.category : collisionGroup.category;\r\n    const searchAllColliders = options?.searchAllColliders ?? false;\r\n    this._dynamicCollisionTree.rayCastQuery(ray, maxDistance, (collider) => {\r\n      const owner = collider.owner;\r\n      const maybeBody = owner.get(BodyComponent);\r\n\r\n      if (options?.ignoreCollisionGroupAll && maybeBody.group === CollisionGroup.All) {\r\n        return false;\r\n      }\r\n\r\n      const canCollide = (collisionMask & maybeBody.group.category) !== 0;\r\n\r\n      // Early exit if not the right group\r\n      if (maybeBody?.group && !canCollide) {\r\n        return false;\r\n      }\r\n\r\n      const hit = collider.rayCast(ray, maxDistance);\r\n\r\n      if (hit) {\r\n        if (options?.filter) {\r\n          if (options.filter(hit)) {\r\n            results.push(hit);\r\n            if (!searchAllColliders) {\r\n              // returning true exits the search\r\n              return true;\r\n            }\r\n          }\r\n        } else {\r\n          results.push(hit);\r\n          if (!searchAllColliders) {\r\n            // returning true exits the search\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    });\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    return this._pairs.has(hash);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], elapsed: number, stats?: FrameStats): Pair[] {\r\n    const seconds = elapsed / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.isActive && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._pairs.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._pairs.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (this._config.continuous.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.magnitude * seconds + // velocity term\r\n          body.acc.magnitude * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (this._config.continuous.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.globalPos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * this._config.continuous.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + this._config.continuous.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n              const hit = other.rayCast(ray, updateDistance + this._config.continuous.surfaceEpsilon * 10);\r\n              if (hit) {\r\n                const translate = hit.point.sub(origin);\r\n                if (translate.magnitude < minTranslate.magnitude) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._pairs.has(pair.id)) {\r\n              this._pairs.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.globalPos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * this._config.continuous.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform.get());\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { EventEmitter } from '../../EventEmitter';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { CompositeCollider } from './CompositeCollider';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  /**\r\n   * Composite collider if any this collider is attached to\r\n   *\r\n   * **WARNING** do not tamper with this property\r\n   */\r\n  public composite: CompositeCollider | null = null;\r\n  public events = new EventEmitter();\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other {@apilink Collider}\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): LineSegment;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): RayCastHit | null;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum SpatialPartitionStrategy {\r\n  DynamicTree = 'dynamic-tree',\r\n  SparseHashGrid = 'sparse-hash-grid'\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { SolverStrategy } from './SolverStrategy';\r\nimport { ContactSolveBias } from './Solver/ContactBias';\r\nimport { SpatialPartitionStrategy } from './Detection/SpatialPartitionStrategy';\r\n\r\nexport interface DynamicTreeConfig {\r\n  /**\r\n   * Pad collider BoundingBox by a constant amount for purposes of potential pairs\r\n   *\r\n   * Default 5 pixels\r\n   */\r\n  boundsPadding?: number;\r\n\r\n  /**\r\n   * Factor to add to the collider BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   *\r\n   * Default 2\r\n   */\r\n  velocityMultiplier?: number;\r\n}\r\n\r\nexport interface SparseHashGridConfig {\r\n  /**\r\n   * Size of the grid cells, default is 100x100 pixels.\r\n   *\r\n   * A good size means that your average collider in your game would fit inside the cell size by size dimension.\r\n   */\r\n  size: number;\r\n}\r\n\r\nexport interface PhysicsConfig {\r\n  /**\r\n   * Excalibur physics simulation is enabled\r\n   */\r\n  enabled?: boolean;\r\n  /**\r\n   * Configure gravity that applies to all {@apilink CollisionType.Active} bodies.\r\n   *\r\n   * This is acceleration in pixels/sec^2\r\n   *\r\n   * Default vec(0, 0)\r\n   *\r\n   * {@apilink BodyComponent.useGravity} to opt out\r\n   */\r\n  gravity?: Vector;\r\n  /**\r\n   * Configure the type of physics simulation you would like\r\n   *\r\n   * * {@apilink SolverStrategy.Arcade} is suitable for games where you might be doing platforming or top down movement.\r\n   * * {@apilink SolverStrategy.Realistic} is where you need objects to bounce off each other and respond like real world objects.\r\n   *\r\n   * Default is Arcade\r\n   */\r\n  solver?: SolverStrategy;\r\n\r\n  /**\r\n   * Configure physics sub-stepping, this can increase simulation fidelity by doing smaller physics steps\r\n   *\r\n   * Default is 1 step\r\n   */\r\n  substep?: number;\r\n\r\n  /**\r\n   * Configure colliders\r\n   */\r\n  colliders?: {\r\n    /**\r\n     * Treat composite collider's member colliders as either separate colliders for the purposes of onCollisionStart/onCollision\r\n     * or as a single collider together.\r\n     *\r\n     * This property can be overridden on individual {@apilink CompositeColliders}.\r\n     *\r\n     * For composites without gaps or small groups of colliders, you probably want 'together'\r\n     *\r\n     * For composites with deliberate gaps, like a platforming level layout, you probably want 'separate'\r\n     *\r\n     * Default is 'together' if unset\r\n     */\r\n    compositeStrategy?: 'separate' | 'together';\r\n  };\r\n\r\n  /**\r\n   * Configure excalibur continuous collision (WIP)\r\n   */\r\n  continuous?: {\r\n    /**\r\n     * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n     * bodies from tunneling through one another.\r\n     *\r\n     * Default true\r\n     */\r\n    checkForFastBodies?: boolean;\r\n\r\n    /**\r\n     * Disable minimum fast moving body raycast, by default if checkForFastBodies = true Excalibur will only check if the\r\n     * body is moving at least half of its minimum dimension in an update. If disableMinimumSpeedForFastBody is set to true,\r\n     * Excalibur will always perform the fast body raycast regardless of speed.\r\n     *\r\n     * Default false\r\n     */\r\n    disableMinimumSpeedForFastBody?: boolean;\r\n\r\n    /**\r\n     * Surface epsilon is used to help deal with predicting collisions by applying a slop\r\n     *\r\n     * Default 0.1\r\n     */\r\n    surfaceEpsilon?: number;\r\n  };\r\n\r\n  /**\r\n   * Configure body defaults\r\n   */\r\n  bodies?: {\r\n    /**\r\n     * Configure default mass that bodies have\r\n     *\r\n     * Default 10 mass units\r\n     */\r\n    defaultMass?: number;\r\n\r\n    /**\r\n     * Sleep epsilon\r\n     *\r\n     * Default 0.07\r\n     */\r\n    sleepEpsilon?: number;\r\n\r\n    /**\r\n     * Wake Threshold, the amount of \"motion\" need to wake a body from sleep\r\n     *\r\n     * Default 0.07 * 3;\r\n     */\r\n    wakeThreshold?: number;\r\n\r\n    /**\r\n     * Sleep bias\r\n     *\r\n     * Default 0.9\r\n     */\r\n    sleepBias?: number;\r\n\r\n    /**\r\n     * By default bodies do not sleep, this can be turned on to improve perf if you have a lot of bodies.\r\n     *\r\n     * Default false\r\n     */\r\n    canSleepByDefault?: boolean;\r\n  };\r\n\r\n  /**\r\n   * Configure the spatial data structure for locating pairs and raycasts\r\n   */\r\n  spatialPartition?: SpatialPartitionStrategy;\r\n  sparseHashGrid?: SparseHashGridConfig;\r\n  dynamicTree?: DynamicTreeConfig;\r\n\r\n  /**\r\n   * Configure the {@apilink ArcadeSolver}\r\n   */\r\n  arcade?: {\r\n    /**\r\n     * Hints the {@apilink ArcadeSolver} to preferentially solve certain contact directions first.\r\n     *\r\n     * Options:\r\n     * * Solve {@apilink ContactSolveBias.VerticalFirst} which will do vertical contact resolution first (useful for platformers\r\n     * with up/down gravity)\r\n     * * Solve {@apilink ContactSolveBias.HorizontalFirst} which will do horizontal contact resolution first (useful for games with\r\n     * left/right forces)\r\n     * * By default {@apilink ContactSolveBias.None} which sorts by distance\r\n     */\r\n    contactSolveBias?: ContactSolveBias;\r\n  };\r\n\r\n  /**\r\n   * Configure the {@apilink RealisticSolver}\r\n   */\r\n  realistic?: {\r\n    contactSolveBias?: ContactSolveBias;\r\n    /**\r\n     * Number of position iterations (overlap) to run in the solver\r\n     *\r\n     * Default 3 iterations\r\n     */\r\n    positionIterations?: number;\r\n\r\n    /**\r\n     * Number of velocity iteration (response) to run in the solver\r\n     *\r\n     * Default 8 iterations\r\n     */\r\n    velocityIterations?: number;\r\n\r\n    /**\r\n     * Amount of overlap to tolerate in pixels\r\n     *\r\n     * Default 1 pixel\r\n     */\r\n    slop?: number;\r\n\r\n    /**\r\n     * Amount of positional overlap correction to apply each position iteration of the solver\r\n     * 0 - meaning no correction, 1 - meaning correct all overlap. Generally values 0 < .5 look nice.\r\n     *\r\n     * Default 0.2\r\n     */\r\n    steeringFactor?: number;\r\n\r\n    /**\r\n     * Warm start set to true re-uses impulses from previous frames back in the solver. Re-using impulses helps\r\n     * the solver converge quicker\r\n     *\r\n     * Default true\r\n     */\r\n    warmStart?: boolean;\r\n  };\r\n}\r\n\r\nexport const getDefaultPhysicsConfig: () => DeepRequired<PhysicsConfig> = () => ({\r\n  enabled: true,\r\n  gravity: vec(0, 0).clone(),\r\n  solver: SolverStrategy.Arcade,\r\n  substep: 1,\r\n  colliders: {\r\n    compositeStrategy: 'together'\r\n  },\r\n  continuous: {\r\n    checkForFastBodies: true,\r\n    disableMinimumSpeedForFastBody: false,\r\n    surfaceEpsilon: 0.1\r\n  },\r\n  bodies: {\r\n    canSleepByDefault: false,\r\n    sleepEpsilon: 0.07,\r\n    wakeThreshold: 0.07 * 3,\r\n    sleepBias: 0.9,\r\n    defaultMass: 10\r\n  },\r\n  spatialPartition: SpatialPartitionStrategy.SparseHashGrid,\r\n  sparseHashGrid: {\r\n    size: 100\r\n  },\r\n  dynamicTree: {\r\n    boundsPadding: 5,\r\n    velocityMultiplier: 2\r\n  },\r\n  arcade: {\r\n    contactSolveBias: ContactSolveBias.None\r\n  },\r\n  realistic: {\r\n    contactSolveBias: ContactSolveBias.None,\r\n    positionIterations: 3,\r\n    velocityIterations: 8,\r\n    slop: 1,\r\n    steeringFactor: 0.2,\r\n    warmStart: true\r\n  }\r\n});\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { Collider } from './Collider';\r\nimport { Transform } from '../../Math/transform';\r\nimport { getDefaultPhysicsConfig } from '../PhysicsConfig';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor({\r\n    ...getDefaultPhysicsConfig()\r\n  });\r\n  private _dynamicAABBTree = new DynamicTree({\r\n    boundsPadding: 5,\r\n    velocityMultiplier: 2\r\n  });\r\n  private _colliders: Collider[] = [];\r\n\r\n  private _compositeStrategy?: 'separate' | 'together';\r\n  /**\r\n   * Treat composite collider's member colliders as either separate colliders for the purposes of onCollisionStart/onCollision\r\n   * or as a single collider together.\r\n   *\r\n   * This property can be overridden on individual {@apilink CompositeColliders}.\r\n   *\r\n   * For composites without gaps or small groups of colliders, you probably want 'together'\r\n   *\r\n   * For composites with deliberate gaps, like a platforming level layout, you probably want 'separate'\r\n   *\r\n   * Default is 'together' if unset\r\n   */\r\n  public set compositeStrategy(value: 'separate' | 'together') {\r\n    this._compositeStrategy = value;\r\n  }\r\n  public get compositeStrategy() {\r\n    return this._compositeStrategy;\r\n  }\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    let colliders: Collider[];\r\n    if (collider instanceof CompositeCollider) {\r\n      colliders = collider.getColliders();\r\n      colliders.forEach((c) => c.offset.addEqual(collider.offset));\r\n    } else {\r\n      colliders = [collider];\r\n    }\r\n    // Flatten composites\r\n    for (const c of colliders) {\r\n      c.events.pipe(this.events);\r\n      c.composite = this;\r\n      this._colliders.push(c);\r\n      this._collisionProcessor.track(c);\r\n      this._dynamicAABBTree.trackCollider(c);\r\n    }\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    collider.events.pipe(this.events);\r\n    collider.composite = null;\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return (this._transform?.pos ?? Vector.Zero).add(this.offset);\r\n  }\r\n\r\n  get center(): Vector {\r\n    return (this._transform?.pos ?? Vector.Zero).add(this.offset);\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results.translate(this.offset);\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): LineSegment {\r\n    const colliders = this.getColliders();\r\n    const lines: LineSegment[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): RayCastHit | null {\r\n    const colliders = this.getColliders();\r\n    const hits: RayCastHit[] = [];\r\n    for (const collider of colliders) {\r\n      const hit = collider.rayCast(ray, max);\r\n      if (hit) {\r\n        hits.push(hit);\r\n      }\r\n    }\r\n    if (hits.length) {\r\n      let minHit = hits[0];\r\n      let minDistance = minHit.point.dot(ray.dir);\r\n      for (const hit of hits) {\r\n        const distance = ray.dir.dot(hit.point);\r\n        if (distance < minDistance) {\r\n          minHit = hit;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minHit;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projections: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projections.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projections.length) {\r\n      const newProjection = new Projection(projections[0].min, projections[0].max);\r\n      for (const proj of projections) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }) {\r\n    const colliders = this.getColliders();\r\n    ex.save();\r\n    ex.translate(this.offset.x, this.offset.y);\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color, options);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  clone(): Collider {\r\n    const result = new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n    result.offset = this.offset.clone();\r\n    return result;\r\n  }\r\n}\r\n","import { AffineMatrix } from './affine-matrix';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * A 2D line segment\r\n */\r\n\r\nexport class LineSegment {\r\n  /**\r\n   * @param begin  The starting point of the line segment\r\n   * @param end  The ending point of the line segment\r\n   */\r\n  constructor(\r\n    public begin: Vector,\r\n    public end: Vector\r\n  ) {}\r\n\r\n  clone(dest?: LineSegment): LineSegment {\r\n    const result = dest || new LineSegment(this.begin.clone(), this.end.clone());\r\n    result.begin = this.begin.clone(result.begin);\r\n    result.end = this.end.clone(result.end);\r\n    return result;\r\n  }\r\n\r\n  transform(matrix: AffineMatrix, dest?: LineSegment): LineSegment {\r\n    const result = dest || new LineSegment(Vector.Zero, Vector.Zero);\r\n    result.begin = matrix.multiply(this.begin, result.begin);\r\n    result.end = matrix.multiply(this.end, result.end);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\r\n   */\r\n  public get slope() {\r\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\r\n  }\r\n\r\n  /**\r\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\r\n   */\r\n  public get intercept() {\r\n    return this.begin.y - this.slope * this.begin.x;\r\n  }\r\n\r\n  private _normal: Vector;\r\n  /**\r\n   * Gets the normal of the line\r\n   */\r\n  public normal(): Vector {\r\n    if (this._normal) {\r\n      return this._normal;\r\n    }\r\n    return (this._normal = this.end.sub(this.begin).normal());\r\n  }\r\n\r\n  private _dir: Vector;\r\n  public dir(): Vector {\r\n    if (this._dir) {\r\n      return this._dir;\r\n    }\r\n    return (this._dir = this.end.sub(this.begin));\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    return [this.begin, this.end];\r\n  }\r\n\r\n  private _slope: Vector;\r\n  /**\r\n   * Returns the slope of the line in the form of a vector of length 1\r\n   */\r\n  public getSlope(): Vector {\r\n    if (this._slope) {\r\n      return this._slope;\r\n    }\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return (this._slope = end.sub(begin).scale(1 / distance));\r\n  }\r\n\r\n  /**\r\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\r\n   */\r\n  public getEdge(): Vector {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    return end.sub(begin);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Returns the midpoint of the edge\r\n   */\r\n  public get midpoint(): Vector {\r\n    return this.begin.add(this.end).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Flips the direction of the line segment\r\n   */\r\n  public flip(): LineSegment {\r\n    return new LineSegment(this.end, this.begin);\r\n  }\r\n\r\n  /**\r\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\r\n   * @param point\r\n   */\r\n  public below(point: Vector): boolean {\r\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\r\n    return above2 >= 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the clip point\r\n   * @param sideVector Vector that traces the line\r\n   * @param length Length to clip along side\r\n   */\r\n  public clip(sideVector: Vector, length: number, normalize = true): LineSegment {\r\n    let dir = sideVector;\r\n    if (normalize) {\r\n      dir = dir.normalize();\r\n    }\r\n\r\n    const near = dir.dot(this.begin) - length;\r\n    const far = dir.dot(this.end) - length;\r\n\r\n    const results = [];\r\n    if (near <= 0) {\r\n      results.push(this.begin);\r\n    }\r\n    if (far <= 0) {\r\n      results.push(this.end);\r\n    }\r\n\r\n    if (near * far < 0) {\r\n      const clipTime = near / (near - far);\r\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\r\n    }\r\n    if (results.length !== 2) {\r\n      return null;\r\n    }\r\n\r\n    return new LineSegment(results[0], results[1]);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular distance from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * @param point\r\n   */\r\n  public distanceToPoint(point: Vector, signed: boolean = false) {\r\n    const x0 = point.x;\r\n    const y0 = point.y;\r\n\r\n    const l = this.getLength();\r\n\r\n    const dy = this.end.y - this.begin.y;\r\n    const dx = this.end.x - this.begin.x;\r\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\r\n    return signed ? distance : Math.abs(distance);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular line from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * (a - p) - ((a - p) * n)n\r\n   * a is a point on the line\r\n   * p is the arbitrary point above the line\r\n   * n is a unit vector in direction of the line\r\n   * @param point\r\n   */\r\n  public findVectorToPoint(point: Vector): Vector {\r\n    const aMinusP = this.begin.sub(point);\r\n    const n = this.getSlope();\r\n\r\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\r\n  }\r\n\r\n  /**\r\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\r\n   * a new point with the calculated Y value and vice-versa.\r\n   * @param x The known X value of the target point\r\n   * @param y The known Y value of the target point\r\n   * @returns A new point with the other calculated axis value\r\n   */\r\n  public findPoint(x: number = null, y: number = null): Vector {\r\n    const m = this.slope;\r\n    const b = this.intercept;\r\n\r\n    if (x !== null) {\r\n      return new Vector(x, m * x + b);\r\n    } else if (y !== null) {\r\n      return new Vector((y - b) / m, y);\r\n    } else {\r\n      throw new Error('You must provide an X or a Y value');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(v: Vector, threshold?: number): boolean;\r\n\r\n  /**\r\n   * @see http://stackoverflow.com/a/11908158/109458\r\n   */\r\n  public hasPoint(): boolean {\r\n    let currPoint: Vector;\r\n    let threshold = 0;\r\n\r\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\r\n      currPoint = new Vector(arguments[0], arguments[1]);\r\n      threshold = arguments[2] || 0;\r\n    } else if (arguments[0] instanceof Vector) {\r\n      currPoint = arguments[0];\r\n      threshold = arguments[1] || 0;\r\n    } else {\r\n      throw 'Could not determine the arguments for Vector.hasPoint';\r\n    }\r\n\r\n    const dxc = currPoint.x - this.begin.x;\r\n    const dyc = currPoint.y - this.begin.y;\r\n\r\n    const dx1 = this.end.x - this.begin.x;\r\n    const dy1 = this.end.y - this.begin.y;\r\n\r\n    const cross = dxc * dy1 - dyc * dx1;\r\n\r\n    // check whether point lines on the line\r\n    if (Math.abs(cross) > threshold) {\r\n      return false;\r\n    }\r\n\r\n    // check whether point lies in-between start and end\r\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\r\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\r\n    } else {\r\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\r\n    }\r\n  }\r\n}\r\n","import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { clamp } from '../../Math/util';\r\n\r\n/**\r\n * Finds the closest line segment between two given line segments.\r\n */\r\nfunction ClosestLine(line1: LineSegment, line2: LineSegment) {\r\n  // https://math.stackexchange.com/questions/1993953/closest-points-between-2-lines-in-2d\r\n  const EPSILON = 1e-9;\r\n\r\n  const line1Dir = line1.dir();\r\n  const line2Dir = line2.dir();\r\n\r\n  const d1Squared = line1Dir.dot(line1Dir);\r\n  const d2Squared = line2Dir.dot(line2Dir);\r\n\r\n  if (d1Squared < EPSILON && d2Squared < EPSILON) {\r\n    return new LineSegment(line1.begin, line2.begin);\r\n  }\r\n\r\n  if (d1Squared < EPSILON) {\r\n    const t = clamp(line2Dir.dot(line1.begin.sub(line2.begin)) / d2Squared, 0, 1);\r\n    const closestPoint = line2.begin.add(line2Dir.scale(t));\r\n    return new LineSegment(line1.begin, closestPoint);\r\n  }\r\n\r\n  if (d2Squared < EPSILON) {\r\n    const t = clamp(line1Dir.dot(line2.begin.sub(line1.begin)) / d1Squared, 0, 1);\r\n    const closestPoint = line1.begin.add(line1Dir.scale(t));\r\n    return new LineSegment(closestPoint, line2.begin);\r\n  }\r\n\r\n  const r = line1.begin.sub(line2.begin);\r\n  const a = d1Squared;\r\n  const e = d2Squared;\r\n  const f = line2Dir.dot(r);\r\n\r\n  const denom = a * e - Math.pow(line1Dir.dot(line2Dir), 2);\r\n\r\n  let s = 0;\r\n  let t = 0;\r\n\r\n  if (Math.abs(denom) > EPSILON) {\r\n    s = clamp((line1Dir.dot(line2Dir) * f - e * line1Dir.dot(r)) / denom, 0, 1);\r\n  } else {\r\n    // lines are parallel\r\n    s = clamp(line1Dir.dot(r) / a, 0, 1);\r\n  }\r\n\r\n  if (Math.abs(e) > EPSILON) {\r\n    t = clamp((line1Dir.dot(line2Dir) * s + f) / e, 0, 1);\r\n  } else {\r\n    // line2 is a degenerate point\r\n    t = 0;\r\n  }\r\n\r\n  const closestPointOnLine1 = line1.begin.add(line1Dir.scale(s));\r\n  const closestPointOnLine2 = line2.begin.add(line2Dir.scale(t));\r\n\r\n  return new LineSegment(closestPointOnLine1, closestPointOnLine2);\r\n}\r\n\r\nexport const ClosestLineJumpTable = {\r\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\r\n    const aSides = polygonA.getSides();\r\n    const bSides = polygonB.getSides();\r\n\r\n    let minDistance = Number.MAX_VALUE;\r\n    let closestLine: LineSegment | null = null;\r\n\r\n    for (let i = 0; i < aSides.length; i++) {\r\n      for (let j = 0; j < bSides.length; j++) {\r\n        const line = ClosestLine(aSides[i], bSides[j]);\r\n        const distance = line.getLength();\r\n\r\n        if (distance < minDistance) {\r\n          minDistance = distance;\r\n          closestLine = line;\r\n        }\r\n      }\r\n    }\r\n\r\n    return closestLine;\r\n  },\r\n\r\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = edge.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n\r\n    return ClosestLine(thisFace.face, edgeLine);\r\n  },\r\n\r\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circle.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\r\n  },\r\n\r\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circleB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\r\n\r\n    const thisWorldPos = circleA.worldPos;\r\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\r\n\r\n    const thisPoint = circleA.rayCast(rayTowardsOther);\r\n    const otherPoint = circleB.rayCast(rayTowardsThis);\r\n\r\n    return new LineSegment(thisPoint.point, otherPoint.point);\r\n  },\r\n\r\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    const circleWorldPos = circle.worldPos;\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const p0 = edgeStart;\r\n    const u = edgeVector;\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (circleWorldPos.x - p0.x) + u.y * (circleWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp to edge\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorldPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - circleWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - circleWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(circleWorldPos.x + circlex, circleWorldPos.y + circley));\r\n  },\r\n\r\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLineA = edgeA.asLine();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLineB = edgeB.asLine();\r\n\r\n    return ClosestLine(edgeLineA, edgeLineB);\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { BodyComponent } from '../Index';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { approximatelyEqual } from '../../Math/util';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  public get worldPos(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  private _naturalRadius: number;\r\n\r\n  private _radius: number | undefined;\r\n  /**\r\n   * Get the radius of the circle\r\n   */\r\n  public get radius(): number {\r\n    if (this._radius) {\r\n      return this._radius;\r\n    }\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    return (this._radius = this._naturalRadius * Math.min(scale.x, scale.y));\r\n  }\r\n\r\n  /**\r\n   * Set the radius of the circle\r\n   */\r\n  public set radius(val: number) {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\r\n    this._localBoundsDirty = true;\r\n    this._radius = val;\r\n  }\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    // https://en.wikipedia.org/wiki/Intersection_(geometry)#A_line_and_a_circle\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const u = c.sub(orig);\r\n\r\n    const u1 = dir.scale(u.dot(dir));\r\n    const u2 = u.sub(u1);\r\n\r\n    const d = u2.magnitude;\r\n\r\n    if (d > this.radius) {\r\n      return null;\r\n    } else {\r\n      // tangent case\r\n      let toi = 0;\r\n      if (approximatelyEqual(d, this.radius, 0.0001)) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          const point = ray.getPoint(toi);\r\n          return {\r\n            point,\r\n            normal: point.sub(c).normalize(),\r\n            collider: this,\r\n            body: this.owner?.get(BodyComponent),\r\n            distance: toi\r\n          } satisfies RayCastHit;\r\n        }\r\n        return null;\r\n      } else {\r\n        // two point\r\n        const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const minToi = Math.min(...positiveToi);\r\n        if (minToi <= max) {\r\n          const point = ray.getPoint(minToi);\r\n          return {\r\n            point,\r\n            normal: point.sub(c).normalize(),\r\n            collider: this,\r\n            body: this.owner?.get(BodyComponent),\r\n            distance: minToi\r\n          } satisfies RayCastHit;\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    return this.localBounds.transform(this._globalMatrix);\r\n  }\r\n\r\n  private _localBoundsDirty = true;\r\n  private _localBounds: BoundingBox;\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (this._localBoundsDirty) {\r\n      this._localBounds = new BoundingBox(-this._naturalRadius, -this._naturalRadius, +this._naturalRadius, +this._naturalRadius);\r\n      this._localBoundsDirty = false;\r\n    }\r\n    return this._localBounds;\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n    this._radius = undefined;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number }) {\r\n    const { lineWidth } = { ...{ lineWidth: 1 }, ...options };\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = tx?.globalPos ?? Vector.Zero;\r\n    ex.save();\r\n    ex.translate(pos.x, pos.y);\r\n    ex.rotate(rotation);\r\n    ex.scale(scale.x, scale.y);\r\n    ex.drawCircle(this.offset ?? Vector.Zero, this._naturalRadius, Color.Transparent, color, lineWidth);\r\n    ex.restore();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Pair } from './Pair';\r\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\r\n * Pair prevents collisions from being evaluated more than one time\r\n */\r\nexport class CollisionContact {\r\n  private _canceled = false;\r\n\r\n  /**\r\n   * Currently the ids between colliders\r\n   */\r\n  readonly id: string;\r\n\r\n  /**\r\n   * The first collider in the collision\r\n   */\r\n  colliderA: Collider;\r\n\r\n  /**\r\n   * The second collider in the collision\r\n   */\r\n  colliderB: Collider;\r\n\r\n  /**\r\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\r\n   */\r\n  mtv: Vector;\r\n\r\n  /**\r\n   * World space contact points between colliderA and colliderB\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Local space contact points between colliderA and colliderB\r\n   */\r\n  localPoints: Vector[];\r\n\r\n  /**\r\n   * The collision normal, pointing away from colliderA\r\n   */\r\n  normal: Vector;\r\n\r\n  /**\r\n   * The collision tangent\r\n   */\r\n  tangent: Vector;\r\n\r\n  /**\r\n   * Information about the specifics of the collision contact separation\r\n   */\r\n  info: SeparationInfo;\r\n\r\n  bodyA: BodyComponent | null = null;\r\n  bodyB: BodyComponent | null = null;\r\n\r\n  constructor(\r\n    colliderA: Collider,\r\n    colliderB: Collider,\r\n    mtv: Vector,\r\n    normal: Vector,\r\n    tangent: Vector,\r\n    points: Vector[],\r\n    localPoints: Vector[],\r\n    info: SeparationInfo\r\n  ) {\r\n    this.colliderA = colliderA;\r\n    this.colliderB = colliderB;\r\n    this.mtv = mtv;\r\n    this.normal = normal;\r\n    this.tangent = tangent;\r\n    this.points = points;\r\n    this.localPoints = localPoints;\r\n    this.info = info;\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (colliderA.composite || colliderB.composite) {\r\n      // Add on the parent composite pair for start/end contact if 'together\r\n      const colliderAId = colliderA.composite?.compositeStrategy === 'separate' ? colliderA.id : colliderA.composite?.id ?? colliderA.id;\r\n      const colliderBId = colliderB.composite?.compositeStrategy === 'separate' ? colliderB.id : colliderB.composite?.id ?? colliderB.id;\r\n      this.id += '|' + Pair.calculatePairHash(colliderAId, colliderBId);\r\n    }\r\n    if (this.colliderA.owner) {\r\n      this.bodyA = this.colliderA.owner.get(BodyComponent);\r\n    }\r\n    if (this.colliderB.owner) {\r\n      this.bodyB = this.colliderB.owner.get(BodyComponent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Match contact awake state, except if body's are Fixed\r\n   */\r\n  public matchAwake(): void {\r\n    const bodyA = this.bodyA;\r\n    const bodyB = this.bodyB;\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.isSleeping !== bodyB.isSleeping) {\r\n        if (bodyA.isSleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= bodyA.wakeThreshold) {\r\n          bodyA.isSleeping = false;\r\n        }\r\n        if (bodyB.isSleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= bodyB.wakeThreshold) {\r\n          bodyB.isSleeping = false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public cancel(): void {\r\n    this._canceled = true;\r\n  }\r\n\r\n  /**\r\n   * Biases the contact so that the given collider is colliderA\r\n   */\r\n  public bias(collider: Collider) {\r\n    if (collider !== this.colliderA && collider !== this.colliderB) {\r\n      throw new Error('Collider must be either colliderA or colliderB from this contact');\r\n    }\r\n\r\n    if (collider === this.colliderA) {\r\n      return this;\r\n    }\r\n\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n\r\n    this.colliderB = colliderA;\r\n    this.colliderA = colliderB;\r\n    this.mtv = this.mtv.negate();\r\n    this.normal = this.normal.negate();\r\n    this.tangent = this.tangent.negate();\r\n\r\n    return this;\r\n  }\r\n}\r\n","import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Collider } from './Collider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Pool } from '../../Util/Pool';\r\n\r\n/**\r\n * Specific information about a contact and it's separation\r\n */\r\nexport class SeparationInfo {\r\n  /**\r\n   * Collider A\r\n   */\r\n  collider: Collider;\r\n\r\n  /**\r\n   * Signed value (negative means overlap, positive no overlap)\r\n   */\r\n  separation: number;\r\n\r\n  /**\r\n   * Axis of separation from the collider's perspective\r\n   */\r\n  axis: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Local axis of separation from the collider's perspective\r\n   */\r\n  localAxis?: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Side of separation (reference) from the collider's perspective\r\n   */\r\n\r\n  side?: LineSegment = new LineSegment(vec(0, 0), vec(0, 0));\r\n\r\n  /**\r\n   * Local side of separation (reference) from the collider's perspective\r\n   */\r\n  localSide?: LineSegment = new LineSegment(vec(0, 0), vec(0, 0));\r\n\r\n  /**\r\n   * Index of the separation side (reference) from the collider's perspective\r\n   */\r\n  sideId?: number;\r\n\r\n  /**\r\n   * Point on collider B (incident point)\r\n   */\r\n  point: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Local point on collider B (incident point)\r\n   */\r\n  localPoint?: Vector = vec(0, 0);\r\n}\r\n\r\nexport class SeparatingAxis {\r\n  static SeparationPool = new Pool(\r\n    () => new SeparationInfo(),\r\n    (i) => i, // no recycle\r\n    500\r\n  );\r\n  private static _ZERO = vec(0, 0);\r\n  private static _SCRATCH_POINT = vec(0, 0);\r\n  private static _SCRATCH_SUB_POINT = vec(0, 0);\r\n  private static _SCRATCH_NORMAL = vec(0, 0);\r\n  private static _SCRATCH_MATRIX = AffineMatrix.identity();\r\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    // if polyB has 0 scale we need to hop back to degenerate separation\r\n    if (polyB.transform.matrix.determinant() === 0) {\r\n      return SeparatingAxis.findPolygonPolygonSeparationDegenerate(polyA, polyB);\r\n    }\r\n\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSideIndex: number = -1;\r\n    let localPoint: Vector;\r\n    // Work inside polyB reference frame\r\n    // inv polyB converts to local space from polyA world space\r\n    const toPolyBSpace = polyB.transform.inverse.multiply(polyA.transform.matrix, SeparatingAxis._SCRATCH_MATRIX);\r\n    const toPolyBSpaceRotation = toPolyBSpace.getRotation();\r\n\r\n    const normalsA = polyA.normals;\r\n    const pointsA = polyA.points;\r\n    const pointsB = polyB.points;\r\n    for (let pointsAIndex = 0; pointsAIndex < pointsA.length; pointsAIndex++) {\r\n      const normal = normalsA[pointsAIndex].rotate(toPolyBSpaceRotation, SeparatingAxis._ZERO, SeparatingAxis._SCRATCH_NORMAL);\r\n      const point = toPolyBSpace.multiply(pointsA[pointsAIndex], SeparatingAxis._SCRATCH_POINT);\r\n\r\n      // For every point in polyB\r\n      // We want to see how much overlap there is on the axis provided by the normal\r\n      // We want to find the minimum overlap among all points\r\n      let smallestPointDistance = Number.MAX_VALUE;\r\n      let smallestLocalPoint: Vector;\r\n      for (let pointsBIndex = 0; pointsBIndex < pointsB.length; pointsBIndex++) {\r\n        const distance = normal.dot(pointsB[pointsBIndex].sub(point, SeparatingAxis._SCRATCH_SUB_POINT));\r\n        if (distance < smallestPointDistance) {\r\n          smallestPointDistance = distance;\r\n          smallestLocalPoint = pointsB[pointsBIndex];\r\n        }\r\n      }\r\n\r\n      // We take the maximum overlap as the separation between the\r\n      // A negative separation means there were no gaps between the two shapes\r\n      if (smallestPointDistance > bestSeparation) {\r\n        bestSeparation = smallestPointDistance;\r\n        bestSideIndex = pointsAIndex;\r\n        localPoint = smallestLocalPoint;\r\n      }\r\n    }\r\n\r\n    // TODO can we avoid applying world space transforms?\r\n    const bestSide2 = (bestSideIndex + 1) % pointsA.length;\r\n    const separationInfo = SeparatingAxis.SeparationPool.get();\r\n    separationInfo.collider = polyA;\r\n    separationInfo.separation = bestSeparation;\r\n    if (bestSeparation > 0) {\r\n      // early out because if separation is > 0 then no local point\r\n      return separationInfo;\r\n    }\r\n    normalsA[bestSideIndex].clone(separationInfo.localAxis);\r\n    normalsA[bestSideIndex].rotate(polyA.transform.rotation, SeparatingAxis._ZERO, separationInfo.axis);\r\n    polyA.transform.matrix.multiply(pointsA[bestSideIndex], separationInfo.side.begin);\r\n    polyA.transform.matrix.multiply(pointsA[bestSide2], separationInfo.side.end);\r\n    polyB.transform.matrix.multiply(localPoint, separationInfo.point);\r\n    separationInfo.sideId = bestSideIndex;\r\n    localPoint.clone(separationInfo.localPoint);\r\n    pointsA[bestSideIndex].clone(separationInfo.localSide.begin);\r\n    pointsA[bestSide2].clone(separationInfo.localSide.end);\r\n    return separationInfo;\r\n  }\r\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\r\n    const axes = polygon.axes;\r\n    const pc = polygon.center;\r\n    // Special SAT with circles\r\n    const polyDir = pc.sub(circle.worldPos);\r\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\r\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\r\n\r\n    let minOverlap = Number.MAX_VALUE;\r\n    let minAxis = null;\r\n    let minIndex = -1;\r\n    for (let i = 0; i < axes.length; i++) {\r\n      const proj1 = polygon.project(axes[i]);\r\n      const proj2 = circle.project(axes[i]);\r\n      const overlap = proj1.getOverlap(proj2);\r\n      if (overlap <= 0) {\r\n        return null;\r\n      } else {\r\n        if (overlap < minOverlap) {\r\n          minOverlap = overlap;\r\n          minAxis = axes[i];\r\n          minIndex = i;\r\n        }\r\n      }\r\n    }\r\n    if (minIndex < 0) {\r\n      return null;\r\n    }\r\n    return minAxis.normalize().scale(minOverlap);\r\n  }\r\n\r\n  static findPolygonPolygonSeparationDegenerate(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSide: LineSegment | null = null;\r\n    let bestAxis: Vector | null = null;\r\n    let bestSideIndex: number = -1;\r\n    let bestOtherPoint: Vector | null = null;\r\n    const sides = polyA.getSides();\r\n    const localSides = polyA.getLocalSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const side = sides[i];\r\n      const axis = side.normal();\r\n      const vertB = polyB.getFurthestPoint(axis.negate());\r\n      // Separation on side i's axis\r\n      // We are looking for the largest separation between poly A's sides\r\n      const vertSeparation = side.distanceToPoint(vertB, true);\r\n      if (vertSeparation > bestSeparation) {\r\n        bestSeparation = vertSeparation;\r\n        bestSide = side;\r\n        bestAxis = axis;\r\n        bestSideIndex = i;\r\n        bestOtherPoint = vertB;\r\n      }\r\n    }\r\n\r\n    return {\r\n      collider: polyA,\r\n      separation: bestAxis ? bestSeparation : 99,\r\n      axis: bestAxis as Vector,\r\n      side: bestSide,\r\n      localSide: localSides[bestSideIndex],\r\n      sideId: bestSideIndex,\r\n      point: bestOtherPoint as Vector,\r\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\r\n    };\r\n  }\r\n}\r\n\r\nSeparatingAxis.SeparationPool.disableWarnings = true;\r\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nconst ScratchZero = Vector.Zero; // TODO constant vector\r\nconst ScratchNormal = Vector.Zero; // TODO constant vector\r\nconst ScratchMatrix = AffineMatrix.identity();\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const sameDir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.magnitude,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent).get());\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const main = separation.collider === polyA ? polyA : polyB;\r\n\r\n    const toIncidentFrame = other.transform.inverse.multiply(main.transform.matrix, ScratchMatrix);\r\n    const toIncidentFrameRotation = toIncidentFrame.getRotation();\r\n    const referenceEdgeNormal = main.normals[separation.sideId].rotate(toIncidentFrameRotation, ScratchZero, ScratchNormal);\r\n    let minEdge = Number.MAX_VALUE;\r\n    let incidentEdgeIndex = 0;\r\n    for (let i = 0; i < other.normals.length; i++) {\r\n      const value = referenceEdgeNormal.dot(other.normals[i]);\r\n      if (value < minEdge) {\r\n        minEdge = value;\r\n        incidentEdgeIndex = i;\r\n      }\r\n    }\r\n\r\n    // FIXME temporary to prevent a crash, invalid separation\r\n    if (!separation.localSide || !separation.localAxis || !separation.axis) {\r\n      return [];\r\n    }\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const referenceSide = separation.localSide.transform(toIncidentFrame);\r\n    const referenceDirection = separation.localAxis.perpendicular().negate().rotate(toIncidentFrameRotation);\r\n\r\n    const incidentSide = new LineSegment(other.points[incidentEdgeIndex], other.points[(incidentEdgeIndex + 1) % other.points.length]);\r\n    const clipRight = incidentSide.clip(referenceDirection.negate(), -referenceDirection.dot(referenceSide.begin), false);\r\n    let clipLeft: LineSegment | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(referenceDirection, referenceDirection.dot(referenceSide.end), false);\r\n    }\r\n\r\n    if (clipLeft) {\r\n      const localPoints: Vector[] = [];\r\n      const points: Vector[] = [];\r\n      const clipPoints = clipLeft.getPoints();\r\n\r\n      for (let i = 0; i < clipPoints.length; i++) {\r\n        const p = clipPoints[i];\r\n        if (referenceSide.below(p)) {\r\n          localPoints.push(p);\r\n          points.push(other.transform.apply(p));\r\n        }\r\n      }\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector): number {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.bodyA?.transform ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.bodyB?.transform ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: LineSegment;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new LineSegment(\r\n            txA.apply(contact.info.localSide.begin).add(shapeA.offset),\r\n            txA.apply(contact.info.localSide.end).add(shapeA.offset)\r\n          );\r\n          worldPoint = txB.apply(localPoint).add(shapeB.offset);\r\n        } else {\r\n          side = new LineSegment(\r\n            txB.apply(contact.info.localSide.begin).add(shapeB.offset),\r\n            txB.apply(contact.info.localSide.end).add(shapeB.offset)\r\n          );\r\n          worldPoint = txA.apply(localPoint).add(shapeA.offset);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { BodyComponent } from '../Index';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionally specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const pos = begin.average(end);\r\n    return pos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    return this._globalMatrix.multiply(this.begin);\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    return this._globalMatrix.multiply(this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return {\r\n          distance: t,\r\n          normal: this.asLine().normal(),\r\n          collider: this,\r\n          body: this.owner?.get(BodyComponent),\r\n          point: ray.getPoint(t)\r\n        } satisfies RayCastHit;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): LineSegment {\r\n    return new LineSegment(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): LineSegment {\r\n    return new LineSegment(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext, LineGraphicsOptions, PointGraphicsOptions } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { Ray } from '../Math/ray';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport class Debug {\r\n  static _drawCalls: ((ctx: ExcaliburGraphicsContext) => void)[] = [];\r\n  static _ctx: ExcaliburGraphicsContext;\r\n  static z: number = Infinity;\r\n  static registerGraphicsContext(ctx: ExcaliburGraphicsContext) {\r\n    Debug._ctx = ctx;\r\n  }\r\n  static draw(debugDrawCall: (ctx: ExcaliburGraphicsContext) => void) {\r\n    this._drawCalls.push(debugDrawCall);\r\n  }\r\n\r\n  static drawPoint(point: Vector, options?: PointGraphicsOptions) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawPoint(point, options);\r\n    });\r\n  }\r\n\r\n  static drawLine(start: Vector, end: Vector, options?: LineGraphicsOptions) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawLine(start, end, options);\r\n    });\r\n  }\r\n\r\n  static drawLines(points: Vector[], options?: LineGraphicsOptions) {\r\n    if (points.length > 1) {\r\n      Debug.draw((ctx) => {\r\n        for (let i = 0; i < points.length - 1; i++) {\r\n          ctx.debug.drawLine(points[i], points[i + 1], options);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  static drawText(text: string, pos: Vector) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawText(text, pos);\r\n    });\r\n  }\r\n\r\n  static drawPolygon(points: Vector[], options?: { color?: Color }) {\r\n    if (points.length > 1) {\r\n      Debug.draw((ctx) => {\r\n        const firstPoint = points[0];\r\n        const polygon = [...points, firstPoint];\r\n        for (let i = 0; i < polygon.length - 1; i++) {\r\n          ctx.debug.drawLine(polygon[i], polygon[i + 1], options);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  static drawCircle(\r\n    center: Vector,\r\n    radius: number,\r\n    options?: {\r\n      color?: Color;\r\n      strokeColor?: Color;\r\n      width?: number;\r\n    }\r\n  ) {\r\n    const { color, strokeColor, width } = {\r\n      color: Color.Black,\r\n      strokeColor: undefined,\r\n      width: undefined,\r\n      ...options\r\n    };\r\n    Debug.draw((ctx) => {\r\n      ctx.drawCircle(center, radius, color, strokeColor, width);\r\n    });\r\n  }\r\n\r\n  static drawBounds(boundingBox: BoundingBox, options?: { color?: Color }): void {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawRect(boundingBox.left, boundingBox.top, boundingBox.width, boundingBox.height, options);\r\n    });\r\n  }\r\n\r\n  static drawRay(ray: Ray, options?: { distance?: number; color?: Color }) {\r\n    const { distance, color } = {\r\n      color: Color.Blue,\r\n      distance: 10,\r\n      ...options\r\n    };\r\n    Debug.draw((ctx) => {\r\n      const start = ray.pos;\r\n      const end = ray.pos.add(ray.dir.scale(distance));\r\n\r\n      ctx.debug.drawLine(start, end, { color });\r\n    });\r\n  }\r\n\r\n  static flush(ctx: ExcaliburGraphicsContext) {\r\n    ctx.save();\r\n    ctx.z = Debug.z;\r\n    for (const drawCall of Debug._drawCalls) {\r\n      drawCall(ctx);\r\n    }\r\n    ctx.restore();\r\n    Debug.clear();\r\n  }\r\n\r\n  static clear() {\r\n    Debug._drawCalls.length = 0;\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Collider } from './Collider';\r\nimport { BodyComponent, Debug, ExcaliburGraphicsContext, Logger, sign } from '../..';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Shape } from './Shape';\r\nimport { Transform } from '../../Math/transform';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * **Must be at least 3 points**\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Suppresses convexity warning\r\n   */\r\n  suppressConvexWarning?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  private _logger = Logger.getInstance();\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  public flagDirty() {\r\n    this._localBoundsDirty = true;\r\n    this._localSidesDirty = true;\r\n    this._transformedPointsDirty = true;\r\n    this._sidesDirty = true;\r\n  }\r\n\r\n  private _points: Vector[];\r\n  private _normals: Vector[];\r\n\r\n  public get normals(): readonly Vector[] {\r\n    return this._normals;\r\n  }\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public set points(points: Vector[]) {\r\n    if (points.length < 3) {\r\n      throw new Error('PolygonCollider cannot be created with less that 3 points');\r\n    }\r\n    this._points = points;\r\n    this._checkAndUpdateWinding(this._points);\r\n    this._calculateNormals();\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _calculateNormals() {\r\n    const normals: Vector[] = [];\r\n    for (let i = 0; i < this._points.length; i++) {\r\n      normals.push(this._points[(i + 1) % this._points.length].sub(this._points[i]).normal());\r\n    }\r\n    this._normals = normals;\r\n  }\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n\r\n  private _transform: Transform = new Transform();\r\n  public get transform() {\r\n    return this._transform;\r\n  }\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _sides: LineSegment[] = [];\r\n  private _localSides: LineSegment[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    this._transform.pos.x += this.offset.x;\r\n    this._transform.pos.y += this.offset.y;\r\n    this.points = options.points;\r\n\r\n    if (!this.isConvex()) {\r\n      if (!options.suppressConvexWarning) {\r\n        this._logger.warn(\r\n          'Excalibur only supports convex polygon colliders and will not behave properly.' +\r\n            'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles'\r\n        );\r\n      }\r\n    }\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  private _checkAndUpdateWinding(points: Vector[]) {\r\n    const counterClockwise = this._isCounterClockwiseWinding(points);\r\n    if (!counterClockwise) {\r\n      points.reverse();\r\n    }\r\n  }\r\n  public _isCounterClockwiseWinding(points: Vector[]): boolean {\r\n    // https://stackoverflow.com/a/1165943\r\n    let sum = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\r\n    }\r\n    return sum < 0;\r\n  }\r\n\r\n  /**\r\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\r\n   * Call {@apilink Polygon.triangulate} to generate a {@apilink CompositeCollider} from this non-convex shape\r\n   */\r\n  public isConvex(): boolean {\r\n    // From SO: https://stackoverflow.com/a/45372025\r\n    if (this.points.length < 3) {\r\n      return false;\r\n    }\r\n    let oldPoint = this.points[this.points.length - 2];\r\n    let newPoint = this.points[this.points.length - 1];\r\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n    let oldDirection = 0;\r\n    let orientation = 0;\r\n    let angleSum = 0;\r\n    for (const [i, point] of this.points.entries()) {\r\n      oldPoint = newPoint;\r\n      oldDirection = direction;\r\n      newPoint = point;\r\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n      if (oldPoint.equals(newPoint)) {\r\n        return false; // repeat point\r\n      }\r\n      let angle = direction - oldDirection;\r\n      if (angle <= -Math.PI) {\r\n        angle += Math.PI * 2;\r\n      } else if (angle > Math.PI) {\r\n        angle -= Math.PI * 2;\r\n      }\r\n      if (i === 0) {\r\n        if (angle === 0.0) {\r\n          return false;\r\n        }\r\n        orientation = angle > 0 ? 1 : -1;\r\n      } else {\r\n        if (orientation * angle <= 0) {\r\n          return false;\r\n        }\r\n      }\r\n      angleSum += angle;\r\n    }\r\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\r\n  }\r\n\r\n  /**\r\n   * Tessellates the polygon into a triangle fan as a {@apilink CompositeCollider} of triangle polygons\r\n   */\r\n  public tessellate(): CompositeCollider {\r\n    const polygons: Vector[][] = [];\r\n    for (let i = 1; i < this.points.length - 2; i++) {\r\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\r\n    }\r\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\r\n\r\n    return new CompositeCollider(polygons.map((points) => Shape.Polygon(points)));\r\n  }\r\n\r\n  /**\r\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\r\n   * Returns a new {@apilink CompositeCollider} made up of smaller triangles.\r\n   */\r\n  public triangulate(): CompositeCollider {\r\n    // https://www.youtube.com/watch?v=hTJFcHutls8\r\n    if (this.points.length < 3) {\r\n      throw Error('Invalid polygon');\r\n    }\r\n\r\n    const triangles: [Vector, Vector, Vector][] = [];\r\n    // algorithm likes clockwise\r\n    const vertices = [...this.points].reverse();\r\n    let vertexCount = vertices.length;\r\n\r\n    /**\r\n     * Returns the previous index based on the current vertex\r\n     */\r\n    function getPrevIndex(index: number) {\r\n      return index === 0 ? vertexCount - 1 : index - 1;\r\n    }\r\n\r\n    /**\r\n     * Retrieves the next index based on the current vertex\r\n     */\r\n    function getNextIndex(index: number) {\r\n      return index === vertexCount - 1 ? 0 : index + 1;\r\n    }\r\n\r\n    /**\r\n     * Whether or not the angle at this vertex index is convex\r\n     */\r\n    function isConvex(index: number) {\r\n      const prev = getPrevIndex(index);\r\n      const next = getNextIndex(index);\r\n\r\n      const va = vertices[prev];\r\n      const vb = vertices[index];\r\n      const vc = vertices[next];\r\n\r\n      // Check convexity\r\n      const leftArm = va.sub(vb);\r\n      const rightArm = vc.sub(vb);\r\n      // Positive cross product is convex\r\n      if (leftArm.cross(rightArm) < 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const convexVertices = vertices.map((_, i) => isConvex(i));\r\n\r\n    /**\r\n     * Quick test for point in triangle\r\n     */\r\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\r\n      const ab = b.sub(a);\r\n      const bc = c.sub(b);\r\n      const ca = a.sub(c);\r\n\r\n      const ap = point.sub(a);\r\n      const bp = point.sub(b);\r\n      const cp = point.sub(c);\r\n\r\n      const cross1 = ab.cross(ap);\r\n      const cross2 = bc.cross(bp);\r\n      const cross3 = ca.cross(cp);\r\n\r\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Calculate the area of the triangle\r\n     */\r\n    // function triangleArea(a: Vector, b: Vector, c: Vector) {\r\n    //   return Math.abs(a.x * (b.y - c.y) + b.x * (c.y - a.y) + c.x * (a.y - c.y))/2;\r\n    // }\r\n\r\n    /**\r\n     * Find the next suitable ear tip\r\n     */\r\n    function findEarTip() {\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        if (convexVertices[i]) {\r\n          const prev = getPrevIndex(i);\r\n          const next = getNextIndex(i);\r\n\r\n          const va = vertices[prev];\r\n          const vb = vertices[i];\r\n          const vc = vertices[next];\r\n\r\n          let isEar = true;\r\n          // Check that if any vertices are in the triangle a, b, c\r\n          for (let j = 0; j < vertexCount; j++) {\r\n            // We can skip these verts because they are the triangle we are testing\r\n            if (j === i || j === prev || j === next) {\r\n              continue;\r\n            }\r\n            const point = vertices[j];\r\n            if (isPointInTriangle(point, va, vb, vc)) {\r\n              isEar = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          // Add ear to polygon list and remove from list\r\n          if (isEar) {\r\n            return i;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fall back to any convex vertex\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        if (convexVertices[i]) {\r\n          return i;\r\n        }\r\n      }\r\n\r\n      // bail and return the first one?\r\n      return 0;\r\n    }\r\n\r\n    /**\r\n     * Cut the ear and produce a triangle, update internal state\r\n     */\r\n    function cutEarTip(index: number) {\r\n      const prev = getPrevIndex(index);\r\n      const next = getNextIndex(index);\r\n\r\n      const va = vertices[prev];\r\n      const vb = vertices[index];\r\n      const vc = vertices[next];\r\n\r\n      // Clockwise winding\r\n      // if (triangleArea(va, vb, vc) > 0) {\r\n      triangles.push([va, vb, vc]);\r\n      // }\r\n      vertices.splice(index, 1);\r\n      convexVertices.splice(index, 1);\r\n      vertexCount--;\r\n    }\r\n\r\n    // Loop over all the vertices finding ears\r\n    while (vertexCount > 3) {\r\n      const earIndex = findEarTip();\r\n      cutEarTip(earIndex);\r\n\r\n      // reclassify vertices\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        convexVertices[i] = isConvex(i);\r\n      }\r\n    }\r\n\r\n    // Last triangle after the loop\r\n    triangles.push([vertices[0], vertices[1], vertices[2]]);\r\n\r\n    // FIXME: there is a colinear triangle that sneaks in here sometimes\r\n    return new CompositeCollider(triangles.map((points) => Shape.Polygon(points, Vector.Zero, true)));\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  private _transformedPointsDirty = true;\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const points = this.points;\r\n    const len = points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this._transform.apply(points[i].clone());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    if (this._transformedPointsDirty) {\r\n      this._calculateTransformation();\r\n      this._transformedPointsDirty = false;\r\n    }\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  private _sidesDirty = true;\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): LineSegment[] {\r\n    if (this._sidesDirty) {\r\n      const lines = [];\r\n      const points = this.getTransformedPoints();\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._sides = lines;\r\n      this._sidesDirty = false;\r\n    }\r\n    return this._sides;\r\n  }\r\n\r\n  private _localSidesDirty = true;\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): LineSegment[] {\r\n    if (this._localSidesDirty) {\r\n      const lines = [];\r\n      const points = this.points;\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._localSides = lines;\r\n      this._localSidesDirty = false;\r\n    }\r\n\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): LineSegment {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): LineSegment {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    const axes: Vector[] = [];\r\n    const sides = this.getSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      axes.push(sides[i].normal());\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Updates the transform for the collision geometry\r\n   *\r\n   * Collision geometry (points/bounds) will not change until this is called.\r\n   * @param transform\r\n   */\r\n  public update(transform: Transform): void {\r\n    if (transform) {\r\n      // This change means an update must be performed in order for geometry to update\r\n      transform.cloneWithParent(this._transform);\r\n      this._transformedPointsDirty = true;\r\n      this._sidesDirty = true;\r\n      if (this.offset.x !== 0 || this.offset.y !== 0) {\r\n        this._transform.pos.x += this.offset.x;\r\n        this._transform.pos.y += this.offset.y;\r\n      }\r\n\r\n      if (this._transform.isMirrored()) {\r\n        // negative transforms really mess with things in collision local space\r\n        // flatten out the negatives by applying to geometry\r\n        this.points = this.points.map((p) => vec(p.x * sign(this._transform.scale.x), p.y * sign(this._transform.scale.y)));\r\n        this._transform.scale.x = Math.abs(this._transform.scale.x);\r\n        this._transform.scale.y = Math.abs(this._transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const localPoint = this._transform.applyInverse(point);\r\n    const testRay = new Ray(localPoint, new Vector(1, 0));\r\n\r\n    let intersectCount = 0;\r\n    const sides = this.getLocalSides();\r\n    for (let sideIndex = 0; sideIndex < sides.length; sideIndex++) {\r\n      const side = sides[sideIndex];\r\n      if (testRay.intersect(side) >= 0) {\r\n        intersectCount++;\r\n      }\r\n    }\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): LineSegment {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: LineSegment } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    return this.localBounds.transform(this._transform.matrix);\r\n  }\r\n\r\n  private _localBoundsDirty = true;\r\n  private _localBounds: BoundingBox;\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (this._localBoundsDirty) {\r\n      this._localBounds = BoundingBox.fromPoints(this.points);\r\n      this._localBoundsDirty = false;\r\n    }\r\n\r\n    return this._localBounds;\r\n  }\r\n\r\n  private _cachedMass: number;\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    if (this._cachedMass === mass && this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    const points = this.points;\r\n    for (let i = 0; i < points.length; i++) {\r\n      const iplusone = (i + 1) % points.length;\r\n      const crossTerm = points[iplusone].cross(points[i]);\r\n      numerator += crossTerm * (points[i].dot(points[i]) + points[i].dot(points[iplusone]) + points[iplusone].dot(points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    this._cachedMass = mass;\r\n    return (this._cachedInertia = (mass / 6) * (numerator / denominator));\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactSide: LineSegment;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactSide = sides[i];\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return {\r\n        collider: this,\r\n        distance: minContactTime,\r\n        body: this.owner?.get(BodyComponent),\r\n        point: ray.getPoint(minContactTime),\r\n        normal: contactSide.normal()\r\n      } satisfies RayCastHit;\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }) {\r\n    const points = this.getTransformedPoints();\r\n    Debug.drawPolygon(points, { color });\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a {@apilink PolygonCollider} collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink PolygonCollider | `arbitrary polygon`} collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero, suppressConvexWarning = false): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      suppressConvexWarning\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink CircleCollider | `circle`} collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink EdgeCollider | `edge`} collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped {@apilink CompositeCollider} using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { Actor } from '../Actor';\r\n\r\nexport class ColliderComponent extends Component {\r\n  public events = new EventEmitter();\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   */\r\n  public get(): Collider | undefined {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      collider.events.pipe(this.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  private _collidersToRemove: Collider[] = [];\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this._collidersToRemove.push(this._collider);\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  public processColliderRemoval() {\r\n    for (const collider of this._collidersToRemove) {\r\n      collider.events.unpipe(this.events);\r\n      this.$colliderRemoved.notifyAll(collider);\r\n      collider.owner = null;\r\n    }\r\n  }\r\n\r\n  public clone(): ColliderComponent {\r\n    const clone = new ColliderComponent(this._collider.clone());\r\n\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx.get());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite left hand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.self, precollision.other, precollision.side, precollision.intersection, precollision.contact)\r\n      );\r\n      if (entity instanceof Actor) {\r\n        entity.onPreCollisionResolve(precollision.self, precollision.other, precollision.side, precollision.contact);\r\n      }\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(\r\n          postcollision.self,\r\n          postcollision.other,\r\n          postcollision.side,\r\n          postcollision.intersection,\r\n          postcollision.contact\r\n        )\r\n      );\r\n      if (entity instanceof Actor) {\r\n        entity.onPostCollisionResolve(postcollision.self, postcollision.other, postcollision.side, postcollision.contact);\r\n      }\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.self, start.other, start.side, start.contact));\r\n      if (entity instanceof Actor) {\r\n        entity.onCollisionStart(start.self, start.other, start.side, start.contact);\r\n      }\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.self, end.other, end.side, end.lastContact));\r\n      if (entity instanceof Actor) {\r\n        entity.onCollisionEnd(end.self, end.other, end.side, end.lastContact);\r\n      }\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a {@apilink PolygonCollider | `polygon`} collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, center);\r\n    return this.set(poly);\r\n  }\r\n\r\n  /**\r\n   * Sets up a {@apilink Circle | `circle collision geometry`} as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up an {@apilink Edge | `edge collision geometry`} with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Setups up a {@apilink CompositeCollider} which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return this.set(new CompositeCollider(colliders));\r\n  }\r\n}\r\n","import { vec, Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Math/util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { Transform } from '../Math/transform';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { getDefaultPhysicsConfig, PhysicsConfig } from './PhysicsConfig';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { Entity } from '../EntityComponentSystem';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n  config?: Pick<PhysicsConfig, 'bodies'>['bodies'];\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component implements Clonable<BodyComponent> {\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventEmitter();\r\n\r\n  public oldTransform = new Transform();\r\n\r\n  /**\r\n   * Indicates whether the old transform has been captured at least once for interpolation\r\n   * @internal\r\n   */\r\n  public __oldTransformCaptured: boolean = false;\r\n\r\n  /**\r\n   * Enable or disabled the fixed update interpolation, by default interpolation is on.\r\n   */\r\n  public enableFixedUpdateInterpolate = true;\r\n\r\n  private _bodyConfig: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>;\r\n  private static _DEFAULT_CONFIG: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']> = {\r\n    ...getDefaultPhysicsConfig().bodies\r\n  };\r\n  public wakeThreshold: number;\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n      this._bodyConfig = {\r\n        ...getDefaultPhysicsConfig().bodies,\r\n        ...options.config\r\n      };\r\n    } else {\r\n      this._bodyConfig = {\r\n        ...getDefaultPhysicsConfig().bodies\r\n      };\r\n    }\r\n    this.updatePhysicsConfig(this._bodyConfig);\r\n    this._mass = BodyComponent._DEFAULT_CONFIG.defaultMass;\r\n  }\r\n\r\n  public get matrix() {\r\n    return this.transform.get().matrix;\r\n  }\r\n\r\n  /**\r\n   * Called by excalibur to update physics config defaults if they change\r\n   * @param config\r\n   */\r\n  public updatePhysicsConfig(config: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>) {\r\n    this._bodyConfig = {\r\n      ...getDefaultPhysicsConfig().bodies,\r\n      ...config\r\n    };\r\n    this.canSleep = this._bodyConfig.canSleepByDefault;\r\n    this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\r\n    this.wakeThreshold = this._bodyConfig.wakeThreshold;\r\n  }\r\n  /**\r\n   * Called by excalibur to update defaults\r\n   * @param config\r\n   */\r\n  public static updateDefaultPhysicsConfig(config: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>) {\r\n    BodyComponent._DEFAULT_CONFIG = config;\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default {@apilink CollisionType.PreventCollision}\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  private _mass: number;\r\n  public get mass(): number {\r\n    return this._mass;\r\n  }\r\n\r\n  public set mass(newMass: number) {\r\n    this._mass = newMass;\r\n    this._cachedInertia = undefined;\r\n    this._cachedInverseInertia = undefined;\r\n  }\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below {@apilink Physics.sleepEpsilon} it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   * @deprecated use isSleeping\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this.isSleeping;\r\n  }\r\n\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get isSleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   * @deprecated use isSleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this.isSleeping = sleeping;\r\n  }\r\n\r\n  public set isSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's {@apilink BodyComponent.sleepMotion} for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.isSleeping = true;\r\n    }\r\n    const currentMotion = this.vel.magnitude * this.vel.magnitude + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = this._bodyConfig.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * this._bodyConfig.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < this._bodyConfig.sleepEpsilon) {\r\n      this.isSleeping = true;\r\n    }\r\n  }\r\n\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia from the {@apilink ColliderComponent}\r\n   */\r\n  public get inertia() {\r\n    if (this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider) {\r\n      collider.$colliderAdded.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      collider.$colliderRemoved.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      const maybeCollider = collider.get();\r\n      if (maybeCollider) {\r\n        return (this._cachedInertia = maybeCollider.getInertia(this.mass));\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _cachedInverseInertia: number;\r\n  /**\r\n   * Get the inverse moment of inertial from the {@apilink ColliderComponent}. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    if (this._cachedInverseInertia) {\r\n      return this._cachedInverseInertia;\r\n    }\r\n    return (this._cachedInverseInertia = this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia);\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor.\r\n   *\r\n   * The {@apilink SolverStrategy.Arcade} does not support this property.\r\n   *\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity {@apilink Physics.gravity} in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   *\r\n   * Note: this only limits responses in the realistic solver, if velocity/angularVelocity is set the actor will still respond\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   * @deprecated use isActive\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.isActive;\r\n  }\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get isActive() {\r\n    return !!this.owner?.isActive;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use globalPos\r\n   */\r\n  public get center() {\r\n    return this.globalPos;\r\n  }\r\n\r\n  public transform: TransformComponent;\r\n  public motion: MotionComponent;\r\n\r\n  override onAdd(owner: Entity<any>): void {\r\n    this.transform = this.owner?.get(TransformComponent);\r\n    this.motion = this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.pos = val;\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * {@apilink Actor.anchor} is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get globalPos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  private _oldGlobalPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.oldTransform.pos;\r\n  }\r\n\r\n  /**\r\n   * The global position of the actor last frame (x, y) in pixels\r\n   */\r\n  public get oldGlobalPos(): Vector {\r\n    return this._oldGlobalPos;\r\n  }\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public get oldRotation(): number {\r\n    return this.oldTransform.rotation;\r\n  }\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   */\r\n  public get oldScale(): Vector {\r\n    return this.oldTransform.scale;\r\n  }\r\n\r\n  /**\r\n   * The scale rate of change of the actor in scale/second\r\n   */\r\n  public get scaleFactor(): Vector {\r\n    return this.motion.scaleFactor;\r\n  }\r\n\r\n  public set scaleFactor(scaleFactor: Vector) {\r\n    this.motion.scaleFactor = scaleFactor;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  private _impulseScratch = vec(0, 0);\r\n  private _distanceFromCenterScratch = vec(0, 0);\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass, this._impulseScratch);\r\n    if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.X) > -1) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.Y) > -1) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos, this._distanceFromCenterScratch);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.__oldTransformCaptured = true;\r\n    const tx = this.transform.get();\r\n    tx.clone(this.oldTransform);\r\n    this.oldTransform.parent = tx.parent; // also grab parent\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldGlobalPos.setTo(this.globalPos.x, this.globalPos.y);\r\n  }\r\n\r\n  public clone(): BodyComponent {\r\n    const component = super.clone() as BodyComponent;\r\n    return component;\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle {@apilink Graphic} for drawing rectangles to the {@apilink ExcaliburGraphicsContext}\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle {@apilink Graphic} for drawing circles to the {@apilink ExcaliburGraphicsContext}\r\n *\r\n * Circles default to {@apilink ImageFiltering.Blended}\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    const lineWidth = options.lineWidth ?? (options.strokeColor ? 1 : 0); // default lineWidth in canvas is 1px\r\n    this.padding = options.padding ?? 2 + lineWidth / 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport interface PointerComponentOptions {\r\n  useColliderShape?: boolean;\r\n  useGraphicsBounds?: boolean;\r\n  localBounds?: BoundingBox;\r\n}\r\n\r\n/**\r\n * Add this component to optionally configure how the pointer\r\n * system detects pointer events.\r\n *\r\n * By default the collider shape is used and graphics bounds is not.\r\n *\r\n * If both collider shape and graphics bounds are enabled it will fire events if either or\r\n * are intersecting the pointer.\r\n */\r\nexport class PointerComponent extends Component {\r\n  /**\r\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\r\n   * user pointer events only to trigger on the same collision geometry used in the collider component\r\n   * for collision resolution. Default is `true`.\r\n   */\r\n  public useColliderShape = true;\r\n  /**\r\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\r\n   * bounds around the graphic to trigger pointer events. Default is `true`.\r\n   */\r\n  public useGraphicsBounds = true;\r\n\r\n  /**\r\n   * Optionally use other bounds for pointer testing\r\n   */\r\n  public localBounds?: BoundingBox;\r\n\r\n  constructor(options?: PointerComponentOptions) {\r\n    super();\r\n    this.useColliderShape = options?.useColliderShape ?? this.useColliderShape;\r\n    this.useGraphicsBounds = options?.useGraphicsBounds ?? this.useGraphicsBounds;\r\n    this.localBounds = options?.localBounds;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A definition of an EasingFunction. See {@apilink EasingFunctions}.\r\n */\r\n// tslint:disable-next-line\r\nexport interface EasingFunction<TValueToEase = number> {\r\n  (currentTime: number, startValue: TValueToEase, endValue: TValueToEase, duration: number): TValueToEase;\r\n}\r\n\r\n/**\r\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\r\n * Given a time, the function will return a value from positive startValue to positive endValue.\r\n *\r\n * ```js\r\n * function Linear (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInQuad (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutQuad (t) {\r\n *    return t * (2 - t);\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutQuad (t) {\r\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInCubic (t) {\r\n *    return t * t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutCubic (t) {\r\n *    return (--t) * t * t + 1;\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutCubic (t) {\r\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n * }\r\n * ```\r\n */\r\nexport class EasingFunctions {\r\n  public static CreateReversibleEasingFunction(easing: EasingFunction): EasingFunction {\r\n    return (time: number, start: number, end: number, duration: number) => {\r\n      if (end < start) {\r\n        return start - (easing(time, end, start, duration) - end);\r\n      } else {\r\n        return easing(time, start, end, duration);\r\n      }\r\n    };\r\n  }\r\n\r\n  public static CreateVectorEasingFunction(easing: EasingFunction<number>): EasingFunction<Vector> {\r\n    return (time: number, start: Vector, end: Vector, duration: number) => {\r\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\r\n    };\r\n  }\r\n\r\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      return (endValue * currentTime) / duration + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n\r\n      return endValue * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return -endValue * currentTime * (currentTime - 2) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime--;\r\n\r\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return endValue * currentTime * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      currentTime--;\r\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime -= 2;\r\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\r\n    }\r\n  );\r\n}\r\n","import { ActionCompleteEvent, ActionStartEvent } from '../Events';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the {@apilink ActionContext | `Action API`} and\r\n * store the list of actions to be executed for an {@apilink Actor}.\r\n *\r\n * Actors implement {@apilink Actor.actions} which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action | null = null;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  public getIncompleteActions(): Action[] {\r\n    return this._actions;\r\n  }\r\n\r\n  public getCurrentAction(): Action | null {\r\n    return this._currentAction;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsed\r\n   */\r\n  public update(elapsed: number) {\r\n    if (this._actions.length > 0) {\r\n      if (this._currentAction !== this._actions[0]) {\r\n        this._currentAction = this._actions[0];\r\n        this._entity.emit('actionstart', new ActionStartEvent(this._currentAction, this._entity));\r\n      }\r\n\r\n      this._currentAction.update(elapsed);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._entity.emit('actioncomplete', new ActionCompleteEvent(this._currentAction, this._entity));\r\n        const complete = this._actions.shift();\r\n        if (complete) {\r\n          this._completedActions.push(complete);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem/Entity';\r\n\r\n/**\r\n * Used for implementing actions for the {@apilink ActionContext | `Action API`}.\r\n */\r\nexport interface Action {\r\n  id: number;\r\n  update(elapsed: number): void;\r\n  isComplete(entity: Entity): boolean;\r\n  reset(): void;\r\n  stop(): void;\r\n}\r\n\r\nlet _ACTION_ID = 0;\r\n/**\r\n *\r\n */\r\nexport function nextActionId(): number {\r\n  return _ACTION_ID++;\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { RotationType } from './rotation-type';\r\nimport { TwoPI } from './util';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\r\n * @param a\r\n * @param b\r\n * @param time\r\n */\r\nexport function lerp(a: number, b: number, time: number): number {\r\n  return (1 - time) * a + b * time;\r\n}\r\n\r\n/**\r\n * Linear interpolation between angles in radians\r\n * @param startAngle\r\n * @param endAngle\r\n * @param rotationType\r\n * @param time\r\n */\r\nexport function lerpAngle(startAngle: number, endAngle: number, rotationType: RotationType, time: number): number {\r\n  const shortestPathIsPositive = (startAngle - endAngle + TwoPI) % TwoPI >= Math.PI;\r\n  const distance1 = Math.abs(endAngle - startAngle);\r\n  const distance2 = TwoPI - distance1;\r\n  let shortDistance = 0;\r\n  let longDistance = 0;\r\n  if (distance1 > distance2) {\r\n    shortDistance = distance2;\r\n    longDistance = distance1;\r\n  } else {\r\n    shortDistance = distance1;\r\n    longDistance = distance2;\r\n  }\r\n  let distance = 0;\r\n  let direction = 1;\r\n\r\n  switch (rotationType) {\r\n    case RotationType.ShortestPath:\r\n      distance = shortDistance;\r\n      direction = shortestPathIsPositive ? 1 : -1;\r\n      break;\r\n    case RotationType.LongestPath:\r\n      distance = longDistance;\r\n      direction = shortestPathIsPositive ? -1 : 1;\r\n      break;\r\n    case RotationType.Clockwise:\r\n      direction = 1;\r\n      distance = shortestPathIsPositive ? shortDistance : longDistance;\r\n      break;\r\n    case RotationType.CounterClockwise:\r\n      direction = -1;\r\n      distance = shortestPathIsPositive ? longDistance : shortDistance;\r\n      break;\r\n  }\r\n\r\n  return startAngle + direction * (distance * time);\r\n}\r\n\r\n/**\r\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\r\n * @param a\r\n * @param b\r\n * @param time\r\n */\r\nexport function lerpVector(a: Vector, b: Vector, time: number): Vector {\r\n  return a.scale(1 - time).add(b.scale(time));\r\n}\r\n\r\n/**\r\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\r\n *\r\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\r\n * @param a\r\n * @param b\r\n * @param value\r\n */\r\nexport function inverseLerp(a: number, b: number, value: number): number {\r\n  return (value - a) / (b - a);\r\n}\r\n\r\n/**\r\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\r\n *\r\n * **Warning** assumes that the `value` vector is co-linear with vector `a` and `b`\r\n *\r\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\r\n * @param a\r\n * @param b\r\n * @param value\r\n */\r\nexport function inverseLerpVector(a: Vector, b: Vector, value: Vector): number {\r\n  const numerator = value.sub(a);\r\n  const denominator = b.sub(a);\r\n  const x = numerator.x / denominator.x;\r\n  const y = numerator.y / denominator.y;\r\n  return Math.min(x, y);\r\n}\r\n\r\n/**\r\n * Remaps a value from a source domain to a destination\r\n * @param minSource\r\n * @param maxSource\r\n * @param minDestination\r\n * @param maxDestination\r\n * @param value\r\n */\r\nexport function remap(minSource: number, maxSource: number, minDestination: number, maxDestination: number, value: number): number {\r\n  const time = inverseLerp(minSource, maxSource, value);\r\n  return lerp(minDestination, maxDestination, time);\r\n}\r\n\r\n/**\r\n * Remaps a value from a source domain to a destination\r\n *\r\n * **Warning** assumes that the `value` vector is co-linear with vector `minSource` and `maxSource`\r\n * @param minSource\r\n * @param maxSource\r\n * @param minDestination\r\n * @param maxDestination\r\n * @param value\r\n */\r\nexport function remapVector(minSource: Vector, maxSource: Vector, minDestination: Vector, maxDestination: Vector, value: Vector): Vector {\r\n  const time = inverseLerpVector(minSource, maxSource, value);\r\n  return lerpVector(minDestination, maxDestination, time);\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, remap } from '../../Math';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { EasingFunction, EasingFunctions } from '../../Util/EasingFunctions';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface MoveByOptions {\r\n  offset: Vector;\r\n  duration: number;\r\n  easing?: EasingFunction;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isMoveByOptions(x: any): x is MoveByOptions {\r\n  return x.offset instanceof Vector && typeof x.duration === 'number';\r\n}\r\n\r\nexport class MoveByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _start!: Vector;\r\n  private _end!: Vector;\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _offset: Vector;\r\n  private _easing: EasingFunction = EasingFunctions.Linear;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: MoveByOptions\r\n  ) {\r\n    this._offset = options.offset;\r\n    this._easing = options.easing ?? this._easing;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._start = this._tx.pos.clone();\r\n      this._end = this._start.add(this._offset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const currentPos = this._tx.pos;\r\n    const newPosX = this._easing(t, this._start.x, this._end.x, 1);\r\n    const newPosY = this._easing(t, this._start.y, this._end.y, 1);\r\n    const velX = (newPosX - currentPos.x) / (elapsed / 1000);\r\n    const velY = (newPosY - currentPos.y) / (elapsed / 1000);\r\n    this._motion.vel.x = velX;\r\n    this._motion.vel.y = velY;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class MoveBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _distance!: number;\r\n  private _speed: number;\r\n\r\n  private _start!: Vector;\r\n  private _offset!: Vector;\r\n  private _end!: Vector;\r\n  private _dir!: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.magnitude;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, remap } from '../../Math';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { EasingFunction, EasingFunctions } from '../../Util/EasingFunctions';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface MoveToOptions {\r\n  pos: Vector;\r\n  duration: number;\r\n  easing?: EasingFunction;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isMoveToOptions(x: any): x is MoveToOptions {\r\n  return x.pos instanceof Vector && typeof x.duration === 'number';\r\n}\r\n\r\nexport class MoveToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _end: Vector;\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _start!: Vector;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _easing: EasingFunction = EasingFunctions.Linear;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: MoveToOptions\r\n  ) {\r\n    this._end = options.pos;\r\n    this._easing = options.easing ?? this._easing;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._start = this._tx.pos.clone();\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const currentPos = this._tx.pos;\r\n    const newPosX = this._easing(t, this._start.x, this._end.x, 1);\r\n    const newPosY = this._easing(t, this._start.y, this._end.y, 1);\r\n    const velX = (newPosX - currentPos.x) / (elapsed / 1000);\r\n    const velY = (newPosY - currentPos.y) / (elapsed / 1000);\r\n    this._motion.vel.x = velX;\r\n    this._motion.vel.y = velY;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class MoveTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: Vector;\r\n  private _end: Vector;\r\n  private _dir!: Vector;\r\n  private _speed: number;\r\n  private _distance!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(\r\n    public entity: Entity,\r\n    destX: number,\r\n    destY: number,\r\n    speed: number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destX, destY);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\nimport { RotationType } from '../../Math';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, TwoPI } from '../../Math/util';\r\nimport { lerpAngle, remap } from '../../Math';\r\n\r\nexport interface RotateToOptions {\r\n  /**\r\n   * Absolute angle to rotate to in radians\r\n   */\r\n  angle: number;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Optionally provide type of rotation, default is RotationType.ShortestPath\r\n   */\r\n  rotationType?: RotationType;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isRotateToOptions(x: any): x is RotateToOptions {\r\n  return typeof x.angle === 'number' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class RotateToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endAngle: number = 0;\r\n  private _startAngle: number = 0;\r\n  private _rotationType: RotationType;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: RotateToOptions\r\n  ) {\r\n    this._endAngle = options.angle;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._rotationType = options.rotationType ?? RotationType.ShortestPath;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startAngle = this._tx.rotation;\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\r\n    const currentAngle = this._tx.rotation;\r\n\r\n    const rx = (newAngle - currentAngle) / (elapsed / 1000);\r\n    this._motion.angularVelocity = rx;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.rotation = this._endAngle;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class RotateTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction!: number;\r\n  private _distance!: number;\r\n  private _shortDistance!: number;\r\n  private _longDistance!: number;\r\n  private _shortestPathIsPositive!: boolean;\r\n  private _currentNonCannonAngle!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angle: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angle;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (elapsed / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { canonicalizeAngle, clamp, TwoPI } from '../../Math/util';\r\nimport { lerpAngle, remap, RotationType } from '../../Math';\r\n\r\nexport interface RotateByOptions {\r\n  /**\r\n   * Angle in radians to offset from the current and rotate\r\n   */\r\n  angleRadiansOffset: number;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Optionally provide type of rotation, default is RotationType.ShortestPath\r\n   */\r\n  rotationType?: RotationType;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isRotateByOptions(x: any): x is RotateByOptions {\r\n  return typeof x.angleRadiansOffset === 'number' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class RotateByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _offset: number = 0;\r\n  private _startAngle: number = 0;\r\n  private _rotationType: RotationType;\r\n  private _endAngle: number = 0;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: RotateByOptions\r\n  ) {\r\n    this._offset = options.angleRadiansOffset;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._rotationType = options.rotationType ?? RotationType.ShortestPath;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startAngle = this._tx.rotation;\r\n      this._endAngle = canonicalizeAngle(this._startAngle + this._offset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\r\n    const currentAngle = this._tx.rotation;\r\n\r\n    const rx = (newAngle - currentAngle) / (elapsed / 1000);\r\n    this._motion.angularVelocity = rx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._endAngle;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class RotateBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: number;\r\n  private _end!: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction!: number;\r\n  private _distance!: number;\r\n  private _shortDistance!: number;\r\n  private _longDistance!: number;\r\n  private _shortestPathIsPositive!: boolean;\r\n  private _currentNonCannonAngle!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (elapsed / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._start = undefined as any;\r\n    this._currentNonCannonAngle = undefined as any;\r\n    this._distance = undefined as any;\r\n  }\r\n}\r\n","import { vec, Vector } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, lerpVector, remap } from '../../Math';\r\n\r\nexport interface ScaleToOptions {\r\n  /**\r\n   * Absolute scale to change to\r\n   */\r\n  scale: Vector;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isScaleToOptions(x: any): x is ScaleToOptions {\r\n  return typeof x.scale === 'object' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class ScaleToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endScale: Vector = vec(1, 1);\r\n  private _startScale: Vector = vec(1, 1);\r\n  constructor(\r\n    public entity: Entity,\r\n    options: ScaleToOptions\r\n  ) {\r\n    this._endScale = options.scale;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startScale = this._tx.scale;\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newScale = lerpVector(this._startScale, this._endScale, t);\r\n    const currentScale = this._tx.scale;\r\n\r\n    const sx = newScale.sub(currentScale).scale(1 / (elapsed / 1000));\r\n    this._motion.scaleFactor = sx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor = Vector.Zero;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class ScaleTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _startX!: number;\r\n  private _startY!: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX!: number;\r\n  private _distanceY!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startX) >= this._distanceX - 0.01 &&\r\n        Math.abs(this._tx.scale.y - this._startY) >= this._distanceY - 0.01)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { vec, Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { clamp, lerpVector, remap } from '../../Math';\r\n\r\nexport interface ScaleByOptions {\r\n  /**\r\n   * Absolute scale to change to\r\n   */\r\n  scaleOffset: Vector;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isScaleByOptions(x: any): x is ScaleByOptions {\r\n  return typeof x.scaleOffset === 'object' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class ScaleByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endScale: Vector = vec(1, 1);\r\n  private _scaleOffset: Vector = vec(0, 0);\r\n  private _startScale: Vector = vec(1, 1);\r\n  constructor(\r\n    public entity: Entity,\r\n    options: ScaleByOptions\r\n  ) {\r\n    this._scaleOffset = options.scaleOffset;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startScale = this._tx.scale;\r\n      this._endScale = this._startScale.add(this._scaleOffset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newScale = lerpVector(this._startScale, this._endScale, t);\r\n    const currentScale = this._tx.scale;\r\n    const sx = newScale.sub(currentScale).scale(1 / (elapsed / 1000));\r\n    this._motion.scaleFactor = sx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor = Vector.Zero;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class ScaleBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _startScale!: Vector;\r\n  private _endScale!: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX!: number;\r\n  private _distanceY!: number;\r\n  private _directionX!: number;\r\n  private _directionY!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX - 0.01 &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY - 0.01)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  id = nextActionId();\r\n  private _method: () => any;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * @deprecated use moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n */\r\nexport class EaseTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += elapsed;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (elapsed / 1000), (newY - this._tx.pos.y) / (elapsed / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * @deprecated use moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n */\r\nexport class EaseBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _offset: Vector;\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._lerpEnd = this._lerpStart.add(this._offset);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += elapsed;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (elapsed / 1000), (newY - this._tx.pos.y) / (elapsed / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._elapsedTime = 0;\r\n      this._totalTime = 0;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += elapsed;\r\n    this._totalTime += elapsed;\r\n    if (this._graphics.isVisible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.isVisible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.isVisible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.isVisible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n\r\n  private _endOpacity: number;\r\n  private _remainingTime: number;\r\n  private _originalTime: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, duration: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._remainingTime = this._originalTime = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._remainingTime = this._originalTime;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._remainingTime > 0) {\r\n      this._graphics.opacity += (this._multiplier * (Math.abs(this._graphics.opacity - this._endOpacity) * elapsed)) / this._remainingTime;\r\n    }\r\n\r\n    this._remainingTime -= elapsed;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._remainingTime <= 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._remainingTime = this._originalTime;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  id = nextActionId();\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(duration: number) {\r\n    this._delay = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += elapsed;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  id = nextActionId();\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir!: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._distanceBetween = Infinity;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { Actor } from '../../Actor';\r\nimport { Material } from '../../Graphics/Context/material';\r\nimport { Color } from '../../Color';\r\nimport { Shader } from '../../Graphics/Context/shader';\r\n\r\nexport class Flash implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  private _entity: Entity;\r\n  private _material: Material | undefined;\r\n  private _total: number = 0;\r\n  private _currentDuration: number = 0;\r\n\r\n  constructor(entity: Entity, color: Color, duration: number = 1000) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._duration = duration;\r\n    this._entity = entity;\r\n    this._material = entity.scene?.engine.graphicsContext.createMaterial({\r\n      name: 'flash-material',\r\n      color,\r\n      fragmentSource: `#version 300 es\r\n    \r\n        precision mediump float;\r\n        uniform float u_blend;\r\n        uniform sampler2D u_graphic;\r\n        uniform vec4 u_color;\r\n    \r\n        in vec2 v_uv; \r\n        out vec4 color;\r\n    \r\n        void main() { \r\n            vec4 textureColor = texture(u_graphic, v_uv); \r\n            color = mix(textureColor, u_color, u_blend * textureColor.a);\r\n            color.rgb = color.rgb * color.a;\r\n        }`\r\n    }) as Material;\r\n    this._total = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._total = this._duration;\r\n      this._currentDuration = this._duration;\r\n      (this._entity as Actor).graphics.material = this._material as Material;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._currentDuration -= elapsed;\r\n\r\n    if (this._graphics) {\r\n      this._material?.update((shader: Shader) => {\r\n        shader.trySetUniformFloat('u_blend', this._currentDuration / this._total);\r\n      });\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      (this._entity as Actor).graphics.material = null;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentDuration <= 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { lerpVector, remap } from './lerp';\r\nimport { Vector } from './vector';\r\n\r\nexport interface BezierCurveOptions {\r\n  /**\r\n   * [start, control1, control2, end]\r\n   */\r\n  controlPoints: [start: Vector, control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\n/**\r\n * BezierCurve that supports cubic Bezier curves.\r\n */\r\nexport class BezierCurve {\r\n  // Thanks Freya! https://www.youtube.com/watch?v=aVwxzDHniEw\r\n  private _distLookup: number[] = [];\r\n  private _controlPoints: [Vector, Vector, Vector, Vector];\r\n  private _arcLength: number;\r\n  readonly quality: number = 4;\r\n  constructor(options: BezierCurveOptions) {\r\n    if (options.controlPoints.length !== 4) {\r\n      throw new Error('Only cubic bezier curves are supported');\r\n    }\r\n    this._controlPoints = [...options.controlPoints];\r\n    this.quality = options.quality ?? this.quality;\r\n\r\n    this._calculateLookup();\r\n  }\r\n\r\n  public get arcLength(): number {\r\n    return this._arcLength;\r\n  }\r\n\r\n  public get controlPoints(): readonly [start: Vector, control1: Vector, control2: Vector, end: Vector] {\r\n    return this._controlPoints;\r\n  }\r\n\r\n  public set controlPoints(points: [start: Vector, control1: Vector, control2: Vector, end: Vector]) {\r\n    this._controlPoints = [...points];\r\n    this._calculateLookup();\r\n  }\r\n\r\n  setControlPoint(index: 0 | 1 | 2 | 3, point: Vector) {\r\n    this._controlPoints[index] = point;\r\n    this._calculateLookup();\r\n  }\r\n\r\n  private _calculateLookup() {\r\n    let totalLength = 0;\r\n    this._distLookup.length = 0;\r\n    let prev = this.controlPoints[0];\r\n    const n = this.controlPoints.length * this.quality;\r\n    for (let i = 0; i < n; i++) {\r\n      const t = i / (n - 1);\r\n      const pt = this.getPoint(t);\r\n      const diff = prev.distance(pt);\r\n      totalLength += diff;\r\n      this._distLookup.push(totalLength);\r\n      prev = pt;\r\n    }\r\n    this._arcLength = totalLength;\r\n  }\r\n\r\n  private _getTimeGivenDistance(distance: number): number {\r\n    const n = this._distLookup.length;\r\n    const arcLength = this.arcLength;\r\n\r\n    if (distance >= 0 && distance < arcLength) {\r\n      for (let i = 0; i < n - 1; i++) {\r\n        if (this._distLookup[i] <= distance && distance < this._distLookup[i + 1]) {\r\n          return remap(this._distLookup[i], this._distLookup[i + 1], i / (n - 1), (i + 1) / (n - 1), distance);\r\n        }\r\n      }\r\n    }\r\n    return distance / arcLength;\r\n  }\r\n\r\n  /**\r\n   * Get the point on the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getPoint(time: number): Vector {\r\n    const points = [...this.controlPoints];\r\n\r\n    for (let r = 1; r < points.length; r++) {\r\n      for (let i = 0; i < points.length - r; i++) {\r\n        points[i] = lerpVector(points[i], points[i + 1], time);\r\n      }\r\n    }\r\n\r\n    return points[0];\r\n  }\r\n\r\n  /**\r\n   * Get the tangent of the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getTangent(time: number): Vector {\r\n    const timeSquared = time * time;\r\n    const p0 = this.controlPoints[0];\r\n    const p1 = this.controlPoints[1];\r\n    const p2 = this.controlPoints[2];\r\n    const p3 = this.controlPoints[3];\r\n\r\n    // Derivative of Bernstein polynomial\r\n    const pPrime = p0\r\n      .scale(-3 * timeSquared + 6 * time - 3)\r\n      .add(p1.scale(9 * timeSquared - 12 * time + 3).add(p2.scale(-9 * timeSquared + 6 * time).add(p3.scale(3 * timeSquared))));\r\n\r\n    return pPrime.normalize();\r\n  }\r\n\r\n  /**\r\n   * Get the tangent of the Bezier curve where the distance is uniformly distributed over time\r\n   * @param time\r\n   */\r\n  getUniformTangent(time: number): Vector {\r\n    const desiredDistance = time * this.arcLength;\r\n    const uniformTime = this._getTimeGivenDistance(desiredDistance);\r\n    return this.getTangent(uniformTime);\r\n  }\r\n\r\n  /**\r\n   * Get the normal of the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getNormal(time: number): Vector {\r\n    return this.getTangent(time).normal();\r\n  }\r\n\r\n  /**\r\n   * Get the normal of the Bezier curve where the distance is uniformly distributed over time\r\n   * @param time\r\n   */\r\n  getUniformNormal(time: number): Vector {\r\n    return this.getUniformTangent(time).normal();\r\n  }\r\n\r\n  /**\r\n   * Points are spaced uniformly across the length of the curve over time\r\n   * @param time\r\n   */\r\n  getUniformPoint(time: number): Vector {\r\n    const desiredDistance = time * this.arcLength;\r\n    const uniformTime = this._getTimeGivenDistance(desiredDistance);\r\n    return this.getPoint(uniformTime);\r\n  }\r\n\r\n  clone(): BezierCurve {\r\n    return new BezierCurve({\r\n      controlPoints: [...this.controlPoints],\r\n      quality: this.quality\r\n    });\r\n  }\r\n}\r\n","import { Entity, TransformComponent } from '../../EntityComponentSystem';\r\nimport { BezierCurve, clamp, remap, vec, Vector } from '../../Math';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface CurveToOptions {\r\n  /**\r\n   * Bezier Curve in world coordinates to animate towards\r\n   *\r\n   * The start control point is assumed to be the actor's current position\r\n   */\r\n  controlPoints: [control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Total duration for the action to run\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Dynamic mode will speed up/slow down depending on the curve\r\n   *\r\n   * Uniform mode will animate at a consistent velocity across the curve\r\n   *\r\n   * Default: 'dynamic'\r\n   */\r\n  mode?: 'dynamic' | 'uniform';\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\nexport class CurveTo implements Action {\r\n  id: number = nextActionId();\r\n\r\n  private _curve: BezierCurve;\r\n  private _durationMs: number;\r\n  private _entity: Entity<any>;\r\n  private _tx: TransformComponent;\r\n  private _currentMs: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _mode: 'dynamic' | 'uniform' = 'dynamic';\r\n  constructor(entity: Entity, options: CurveToOptions) {\r\n    this._entity = entity;\r\n    this._tx = this._entity.get(TransformComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._curve = new BezierCurve({\r\n      controlPoints: [vec(0, 0), ...options.controlPoints],\r\n      quality: options.quality\r\n    });\r\n    this._durationMs = options.duration;\r\n    this._mode = options.mode ?? this._mode;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._curve.setControlPoint(0, this._tx.globalPos.clone());\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    if (this._mode === 'dynamic') {\r\n      this._tx.pos = this._curve.getPoint(t);\r\n    } else {\r\n      this._tx.pos = this._curve.getUniformPoint(t);\r\n    }\r\n    if (this.isComplete(this._entity)) {\r\n      if (this._mode === 'dynamic') {\r\n        this._tx.pos = this._curve.getPoint(1);\r\n      } else {\r\n        this._tx.pos = this._curve.getUniformPoint(1);\r\n      }\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n  reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n  stop(): void {\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n}\r\n","import { Entity, TransformComponent } from '../../EntityComponentSystem';\r\nimport { BezierCurve, clamp, remap, vec, Vector } from '../../Math';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface CurveByOptions {\r\n  /**\r\n   * Bezier Curve relative to the current actor position to move\r\n   */\r\n  controlPoints: [control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Total duration for the action to run\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Dynamic mode will speed up/slow down depending on the curve\r\n   *\r\n   * Uniform mode will animate at a consistent velocity across the curve\r\n   *\r\n   * Default: 'dynamic'\r\n   */\r\n  mode?: 'dynamic' | 'uniform';\r\n\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality to make the motion appear smooth\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\nexport class CurveBy implements Action {\r\n  id: number = nextActionId();\r\n\r\n  private _curve: BezierCurve;\r\n  private _durationMs: number;\r\n  private _entity: Entity<any>;\r\n  private _tx: TransformComponent;\r\n  private _currentMs: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _mode: 'dynamic' | 'uniform' = 'dynamic';\r\n  constructor(entity: Entity, options: CurveByOptions) {\r\n    this._entity = entity;\r\n    this._tx = this._entity.get(TransformComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._curve = this._curve = new BezierCurve({\r\n      controlPoints: [vec(0, 0), ...options.controlPoints],\r\n      quality: options.quality\r\n    });\r\n    this._durationMs = options.duration;\r\n    this._mode = options.mode ?? this._mode;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._curve.setControlPoint(0, this._tx.globalPos);\r\n      this._curve.setControlPoint(1, this._curve.controlPoints[1].add(this._tx.globalPos));\r\n      this._curve.setControlPoint(2, this._curve.controlPoints[2].add(this._tx.globalPos));\r\n      this._curve.setControlPoint(3, this._curve.controlPoints[3].add(this._tx.globalPos));\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    if (this._mode === 'dynamic') {\r\n      this._tx.pos = this._curve.getPoint(t);\r\n    } else {\r\n      this._tx.pos = this._curve.getUniformPoint(t);\r\n    }\r\n    if (this.isComplete(this._entity)) {\r\n      if (this._mode === 'dynamic') {\r\n        this._tx.pos = this._curve.getPoint(1);\r\n      } else {\r\n        this._tx.pos = this._curve.getUniformPoint(1);\r\n      }\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n  reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n  stop(): void {\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { isMoveByOptions, MoveBy, MoveByOptions, MoveByWithOptions } from './Action/MoveBy';\r\nimport { isMoveToOptions, MoveTo, MoveToOptions, MoveToWithOptions } from './Action/MoveTo';\r\nimport { RotateTo, RotateToOptions, RotateToWithOptions } from './Action/RotateTo';\r\nimport { RotateBy, RotateByOptions, RotateByWithOptions } from './Action/RotateBy';\r\nimport { isScaleToOptions, ScaleTo, ScaleToOptions, ScaleToWithOptions } from './Action/ScaleTo';\r\nimport { isScaleByOptions, ScaleBy, ScaleByOptions, ScaleByWithOptions } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { EaseBy } from './Action/EaseBy';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector, RotationType } from '../Math';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\nimport { Color } from '../Color';\r\nimport { Flash } from './Action/Flash';\r\nimport { CurveTo, CurveToOptions } from './Action/CurveTo';\r\nimport { CurveBy, CurveByOptions } from './Action/CurveBy';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * {@apilink Actor | `actors`} such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the {@apilink Action} interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    this._queue.update(elapsed);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  public runAction(action: Action) {\r\n    action.reset();\r\n    this._queue.add(action);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveBy(options: CurveByOptions): ActionContext {\r\n    this._queue.add(new CurveBy(this._entity, options));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveTo(options: CurveToOptions): ActionContext {\r\n    this._queue.add(new CurveTo(this._entity, options));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by a specified vector offset relative to the current position given\r\n   * a duration and a {@apilink EasingFunction}. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor by a specified x and y offset relative to the current position given\r\n   * a duration and a {@apilink EasingFunction}. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      offsetX = args[0].x;\r\n      offsetY = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      offsetX = args[0];\r\n      offsetY = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseBy(this._entity, offsetX, offsetY, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Moves an actor to a specified {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveTo(options: MoveToOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPosOrOptions: number | Vector | MoveToOptions, yOrSpeed?: number, speedOrUndefined?: number): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPosOrOptions instanceof Vector) {\r\n      x = xOrPosOrOptions.x;\r\n      y = xOrPosOrOptions.y;\r\n      speed = +(yOrSpeed ?? 0);\r\n      this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    } else if (typeof xOrPosOrOptions === 'number' && typeof yOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\r\n      x = xOrPosOrOptions;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n      this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    } else if (isMoveToOptions(xOrPosOrOptions)) {\r\n      this._queue.add(new MoveToWithOptions(this._entity, xOrPosOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Moves an actor by a specified offset {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveBy(options: MoveByOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(\r\n    xOffsetOrVectorOrOptions: number | Vector | MoveByOptions,\r\n    yOffsetOrSpeed?: number,\r\n    speedOrUndefined?: number\r\n  ): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVectorOrOptions instanceof Vector && typeof yOffsetOrSpeed === 'number') {\r\n      xOffset = xOffsetOrVectorOrOptions.x;\r\n      yOffset = xOffsetOrVectorOrOptions.y;\r\n      speed = yOffsetOrSpeed;\r\n      this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    } else if (typeof xOffsetOrVectorOrOptions === 'number' && typeof yOffsetOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\r\n      xOffset = xOffsetOrVectorOrOptions;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n      this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    } else if (isMoveByOptions(xOffsetOrVectorOrOptions)) {\r\n      this._queue.add(new MoveByWithOptions(this._entity, xOffsetOrVectorOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor to a specified angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateTo(options: RotateToOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angle  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation\r\n   */\r\n  public rotateTo(angle: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateTo(angleRadiansOrOptions: number | RotateToOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    if (typeof angleRadiansOrOptions === 'number' && typeof speed === 'number') {\r\n      this._queue.add(new RotateTo(this._entity, angleRadiansOrOptions, speed, rotationType));\r\n    } else if (typeof angleRadiansOrOptions === 'object') {\r\n      this._queue.add(new RotateToWithOptions(this._entity, angleRadiansOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor by a specified offset angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateBy(options: RotateByOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateBy(angleRadiansOffsetOrOptions: number | RotateByOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    if (typeof angleRadiansOffsetOrOptions === 'object') {\r\n      this._queue.add(new RotateByWithOptions(this._entity, angleRadiansOffsetOrOptions));\r\n    } else {\r\n      this._queue.add(new RotateBy(this._entity, angleRadiansOffsetOrOptions, speed as number, rotationType));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales an actor to a specified scale {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleTo(options: ScaleToOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVectorOrOptions: number | Vector | ScaleToOptions,\r\n    sizeYOrSpeed?: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined\r\n  ): ActionContext {\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (isScaleToOptions(sizeXOrVectorOrOptions)) {\r\n      this._queue.add(new ScaleToWithOptions(this._entity, sizeXOrVectorOrOptions));\r\n      return this;\r\n    }\r\n\r\n    if (sizeXOrVectorOrOptions instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVectorOrOptions.x;\r\n      sizeY = sizeXOrVectorOrOptions.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVectorOrOptions === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVectorOrOptions;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined as any;\r\n      speedY = speedYOrUndefined as any;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales an actor by a specified scale offset {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleBy(options: ScaleByOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(\r\n    sizeOffsetXOrVectorOrOptions: number | Vector | ScaleByOptions,\r\n    sizeOffsetYOrSpeed?: number,\r\n    speed?: number | undefined\r\n  ): ActionContext {\r\n    if (isScaleByOptions(sizeOffsetXOrVectorOrOptions)) {\r\n      this._queue.add(new ScaleByWithOptions(this._entity, sizeOffsetXOrVectorOrOptions));\r\n      return this;\r\n    }\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVectorOrOptions instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVectorOrOptions.x;\r\n      sizeOffsetY = sizeOffsetXOrVectorOrOptions.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVectorOrOptions === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVectorOrOptions;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed as any));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param duration     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, duration: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This will cause an actor to flash a specific color for a period of time\r\n   * @param color\r\n   * @param duration The duration in milliseconds\r\n   */\r\n  public flash(color: Color, duration: number = 1000) {\r\n    this._queue.add(new Flash(this._entity, color, duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param duration  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(duration: number): ActionContext {\r\n    this._queue.add(new Delay(duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector, RotationType } from '../Math';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Action } from './Action';\r\nimport { Color } from '../Color';\r\nimport { CurveToOptions } from './Action/CurveTo';\r\nimport { CurveByOptions } from './Action/CurveBy';\r\nimport { MoveToOptions } from './Action/MoveTo';\r\nimport { MoveByOptions, RotateByOptions, RotateToOptions, ScaleByOptions, ScaleToOptions } from './index';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> {}\r\n\r\nexport class ActionsComponent extends Component implements ActionContextMethods {\r\n  dependencies = [TransformComponent, MotionComponent];\r\n  private _ctx: ActionContext | null = null;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  private _getCtx() {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, no context available');\r\n    }\r\n    return this._ctx;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queue\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, no queue available');\r\n    }\r\n    return this._ctx.getQueue();\r\n  }\r\n\r\n  /**\r\n   * Runs a specific action in the action queue\r\n   * @param action\r\n   */\r\n  public runAction(action: Action): ActionContext {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, cannot run action');\r\n    }\r\n    return this._ctx.runAction(action);\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsed\r\n   */\r\n  public update(elapsed: number): void {\r\n    return this._ctx?.update(elapsed);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveBy(options: CurveByOptions): ActionContext {\r\n    return this._getCtx().curveBy.apply(this._ctx, [options]);\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveTo(options: CurveToOptions): ActionContext {\r\n    return this._getCtx().curveTo.apply(this._ctx, [options]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunctions} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunctions} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._getCtx().easeTo.apply(this._ctx, args as any);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param offset\r\n   * @param duration\r\n   * @param easingFcn\r\n   * @deprecated use new moveBy({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   *\r\n   * @param offsetX\r\n   * @param offsetY\r\n   * @param duration\r\n   * @param easingFcn\r\n   * @deprecated use new moveBy({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    return this._getCtx().easeBy.apply(this._ctx, args as any);\r\n  }\r\n\r\n  /**\r\n   * Moves an actor to a specified {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveTo(options: MoveToOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPosOrOptions: number | Vector | MoveToOptions, yOrSpeed?: number, speedOrUndefined?: number): ActionContext {\r\n    return this._getCtx().moveTo.apply(this._ctx, [xOrPosOrOptions, yOrSpeed, speedOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Moves an actor by a specified offset {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveBy(options: MoveByOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(\r\n    xOffsetOrVectorOptions: number | Vector | MoveByOptions,\r\n    yOffsetOrSpeed?: number,\r\n    speedOrUndefined?: number\r\n  ): ActionContext {\r\n    return this._getCtx().moveBy.apply(this._ctx, [xOffsetOrVectorOptions, yOffsetOrSpeed, speedOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor to a specified angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateTo(options: RotateToOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angle  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation\r\n   */\r\n  public rotateTo(angle: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateTo(angle: number | RotateToOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    return this._getCtx().rotateTo.apply(this._ctx, [angle, speed, rotationType] as any);\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor by a specified offset angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateBy(options: RotateByOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateBy(angleRadiansOffsetOrOptions: number | RotateByOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    return this._getCtx().rotateBy.apply(this._ctx, [angleRadiansOffsetOrOptions, speed, rotationType] as any);\r\n  }\r\n\r\n  /**\r\n   * Scales an actor to a specified scale {@link Vector} over a duration\r\n   * @param options\r\n   */\r\n  public scaleTo(options: ScaleToOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVectorOrOptions: number | Vector | ScaleToOptions,\r\n    sizeYOrSpeed?: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number\r\n  ): ActionContext {\r\n    return this._getCtx().scaleTo.apply(this._ctx, [sizeXOrVectorOrOptions, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Scales an actor by a specified scale offset {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleBy(options: ScaleByOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(\r\n    sizeOffsetXOrVectorOrOptions: number | Vector | ScaleByOptions,\r\n    sizeOffsetYOrSpeed?: number,\r\n    speed?: number\r\n  ): ActionContext {\r\n    return this._getCtx().scaleBy.apply(this._ctx, [sizeOffsetXOrVectorOrOptions, sizeOffsetYOrSpeed, speed] as any);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._getCtx().blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param duration     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, duration: number): ActionContext {\r\n    return this._getCtx().fade(opacity, duration);\r\n  }\r\n\r\n  /**\r\n   * This will cause an actor to flash a specific color for a period of time\r\n   * @param color\r\n   * @param duration The duration in milliseconds\r\n   */\r\n  public flash(color: Color, duration: number = 1000) {\r\n    return this._getCtx().flash(color, duration);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param duration  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(duration: number): ActionContext {\r\n    return this._getCtx().delay(duration);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._getCtx().die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._getCtx().callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._getCtx().repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._getCtx().repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._getCtx().follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._getCtx().meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._getCtx().toPromise();\r\n  }\r\n}\r\n","import {\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  ActionStartEvent,\r\n  ActionCompleteEvent\r\n} from './Events';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { CanInitialize, CanUpdate, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity, EntityEvents } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionContact, CollisionGroup, Side } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { PointerEvent } from './Input/PointerEvent';\r\nimport { WheelEvent } from './Input/WheelEvent';\r\nimport { PointerComponent } from './Input/PointerComponent';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\nimport { CoordPlane } from './Math/coord-plane';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { Component } from './EntityComponentSystem';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor constructor options\r\n */\r\nexport type ActorArgs = ColliderArgs & {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the coordinate plane of the actor, default is {@apilink CoordPlane.World} meaning actor is subject to camera positioning\r\n   */\r\n  coordPlane?: CoordPlane;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n\r\n  /**\r\n   * Optionally supply a {@apilink CollisionGroup}\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n\r\n  /**\r\n   * Optionally silence excalibur warning warnings\r\n   */\r\n  silenceWarnings?: boolean;\r\n};\r\n\r\ntype ColliderArgs =\r\n  | // custom collider\r\n  {\r\n      /**\r\n       * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n       */\r\n      collider?: Collider;\r\n\r\n      width?: undefined;\r\n      height?: undefined;\r\n      radius?: undefined;\r\n    }\r\n  // box collider\r\n  | {\r\n      /**\r\n       * Optionally set the width of a box collider for the actor\r\n       */\r\n      width?: number;\r\n      /**\r\n       * Optionally set the height of a box collider for the actor\r\n       */\r\n      height?: number;\r\n\r\n      collider?: undefined;\r\n      radius?: undefined;\r\n    }\r\n  // circle collider\r\n  | {\r\n      /**\r\n       * Optionally set the radius of the circle collider for the actor\r\n       */\r\n      radius?: number;\r\n\r\n      collider?: undefined;\r\n      width?: undefined;\r\n      height?: undefined;\r\n    };\r\n\r\nexport type ActorEvents = EntityEvents & {\r\n  collisionstart: CollisionStartEvent;\r\n  collisionend: CollisionEndEvent;\r\n  precollision: PreCollisionEvent;\r\n  postcollision: PostCollisionEvent;\r\n  kill: KillEvent;\r\n  prekill: PreKillEvent;\r\n  postkill: PostKillEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n  pretransformdraw: PreDrawEvent;\r\n  posttransformdraw: PostDrawEvent;\r\n  predebugdraw: PreDebugDrawEvent;\r\n  postdebugdraw: PostDebugDrawEvent;\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerwheel: WheelEvent;\r\n  pointerdragstart: PointerEvent;\r\n  pointerdragend: PointerEvent;\r\n  pointerdragenter: PointerEvent;\r\n  pointerdragleave: PointerEvent;\r\n  pointerdragmove: PointerEvent;\r\n  enterviewport: EnterViewPortEvent;\r\n  exitviewport: ExitViewPortEvent;\r\n  actionstart: ActionStartEvent;\r\n  actioncomplete: ActionCompleteEvent;\r\n};\r\n\r\nexport const ActorEvents = {\r\n  CollisionStart: 'collisionstart',\r\n  CollisionEnd: 'collisionend',\r\n  PreCollision: 'precollision',\r\n  PostCollision: 'postcollision',\r\n  Kill: 'kill',\r\n  PreKill: 'prekill',\r\n  PostKill: 'postkill',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PreTransformDraw: 'pretransformdraw',\r\n  PostTransformDraw: 'posttransformdraw',\r\n  PreDebugDraw: 'predebugdraw',\r\n  PostDebugDraw: 'postdebugdraw',\r\n  PointerUp: 'pointerup',\r\n  PointerDown: 'pointerdown',\r\n  PointerEnter: 'pointerenter',\r\n  PointerLeave: 'pointerleave',\r\n  PointerMove: 'pointermove',\r\n  PointerCancel: 'pointercancel',\r\n  Wheel: 'pointerwheel',\r\n  PointerDrag: 'pointerdragstart',\r\n  PointerDragEnd: 'pointerdragend',\r\n  PointerDragEnter: 'pointerdragenter',\r\n  PointerDragLeave: 'pointerdragleave',\r\n  PointerDragMove: 'pointerdragmove',\r\n  EnterViewPort: 'enterviewport',\r\n  ExitViewPort: 'exitviewport',\r\n  ActionStart: 'actionstart',\r\n  ActionComplete: 'actioncomplete'\r\n};\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a {@apilink Scene} for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanBeKilled {\r\n  public events = new EventEmitter<ActorEvents>();\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public body: BodyComponent;\r\n\r\n  /**\r\n   * Access the Actor's built in {@apilink TransformComponent}\r\n   */\r\n  public transform: TransformComponent;\r\n\r\n  /**\r\n   * Access the Actor's built in {@apilink MotionComponent}\r\n   */\r\n  public motion: MotionComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink GraphicsComponent}\r\n   */\r\n  public graphics: GraphicsComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink ColliderComponent}\r\n   */\r\n  public collider: ColliderComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink PointerComponent} config\r\n   */\r\n  public pointer: PointerComponent;\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in {@apilink ActionsComponent} which forwards to the\r\n   * {@apilink ActionContext | `Action context`} of the actor.\r\n   */\r\n  public actions: ActionsComponent;\r\n  private _silenceWarnings: boolean;\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global position vector of the actor from the last frame\r\n   */\r\n  public get oldGlobalPos(): Vector {\r\n    return this.body.oldGlobalPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  private _offset: Vector = watch(Vector.Zero, (v) => this._handleOffsetChange(v));\r\n  /**\r\n   * The offset in pixels to apply to all actor graphics\r\n   *\r\n   * Default offset of (0, 0)\r\n   */\r\n  public get offset(): Vector {\r\n    return this._offset;\r\n  }\r\n\r\n  public set offset(vec: Vector) {\r\n    this._offset = watch(vec, (v) => this._handleOffsetChange(v));\r\n    this._handleOffsetChange(vec);\r\n  }\r\n\r\n  private _handleOffsetChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.offset = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('ex.offscreen');\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.events.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.events.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.events.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.events.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.events.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.events.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.events.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.events.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color {\r\n    return this.graphics.color;\r\n  }\r\n  public set color(v: Color) {\r\n    this.graphics.color = v;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      coordPlane,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      opacity,\r\n      anchor,\r\n      offset,\r\n      collisionType,\r\n      collisionGroup,\r\n      silenceWarnings\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this.name = name ?? this.name;\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n    this.offset = offset ?? Vector.Zero;\r\n    this.transform = new TransformComponent();\r\n    this.addComponent(this.transform);\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n    this.transform.coordPlane = coordPlane ?? CoordPlane.World;\r\n    this._silenceWarnings = silenceWarnings ?? false;\r\n\r\n    this.pointer = new PointerComponent();\r\n    this.addComponent(this.pointer);\r\n\r\n    this.graphics = new GraphicsComponent({\r\n      anchor: this.anchor,\r\n      offset: this.offset,\r\n      opacity: opacity\r\n    });\r\n    this.addComponent(this.graphics);\r\n\r\n    this.motion = new MotionComponent();\r\n    this.addComponent(this.motion);\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.actions = new ActionsComponent();\r\n    this.addComponent(this.actions);\r\n\r\n    this.body = new BodyComponent();\r\n    this.addComponent(this.body);\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (color) {\r\n      this.color = color;\r\n    }\r\n\r\n    if (collider) {\r\n      this.collider = new ColliderComponent(collider);\r\n      this.addComponent(this.collider);\r\n    } else if (radius) {\r\n      this.collider = new ColliderComponent(Shape.Circle(radius));\r\n      this.addComponent(this.collider);\r\n\r\n      if (color) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.collider = new ColliderComponent(Shape.Box(width, height, this.anchor));\r\n        this.addComponent(this.collider);\r\n\r\n        if (color && width && height) {\r\n          this.graphics.add(\r\n            new Rectangle({\r\n              color: color,\r\n              width,\r\n              height\r\n            })\r\n          );\r\n        }\r\n      } else {\r\n        this.collider = new ColliderComponent();\r\n        this.addComponent(this.collider); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.isVisible = visible ?? true;\r\n  }\r\n\r\n  public clone(): Actor {\r\n    const clone = new Actor({\r\n      silenceWarnings: this._silenceWarnings,\r\n      color: this.color.clone(),\r\n      anchor: this.anchor.clone(),\r\n      offset: this.offset.clone()\r\n    });\r\n    clone.clearComponents();\r\n    clone.processComponentRemoval();\r\n\r\n    // Clone builtins, order is important, same as ctor\r\n    clone.addComponent((clone.transform = this.transform.clone() as TransformComponent), true);\r\n    clone.addComponent((clone.pointer = this.pointer.clone() as PointerComponent), true);\r\n    clone.addComponent((clone.graphics = this.graphics.clone() as GraphicsComponent), true);\r\n    clone.addComponent((clone.motion = this.motion.clone() as MotionComponent), true);\r\n    clone.addComponent((clone.actions = this.actions.clone() as ActionsComponent), true);\r\n    clone.addComponent((clone.body = this.body.clone() as BodyComponent), true);\r\n    clone.addComponent((clone.collider = this.collider.clone() as ColliderComponent), true);\r\n\r\n    const builtInComponents: Component[] = [\r\n      this.transform,\r\n      this.pointer,\r\n      this.graphics,\r\n      this.motion,\r\n      this.actions,\r\n      this.body,\r\n      this.collider\r\n    ];\r\n\r\n    // Clone non-builtin the current actors components\r\n    const components = this.getComponents();\r\n    for (const c of components) {\r\n      if (!builtInComponents.includes(c)) {\r\n        clone.addComponent(c.clone(), true);\r\n      }\r\n    }\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n  public emit<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, event: ActorEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for {@apilink onPreKill} lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(scene: Scene) {\r\n    this.events.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current {@apilink Scene}.\r\n   */\r\n  public onPreKill(scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for {@apilink onPostKill} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(scene: Scene) {\r\n    this.events.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current {@apilink Scene}.\r\n   */\r\n  public onPostKill(scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.events.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn(`Cannot kill actor named \"${this.name}\", it was never added to the Scene`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.isActive = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor (global position)\r\n   */\r\n  public get center(): Vector {\r\n    const globalPos = this.getGlobalPos();\r\n    return new Vector(\r\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\r\n      globalPos.y + this.height / 2 - this.anchor.y * this.height\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the local center point of an actor\r\n   */\r\n  public get localCenter(): Vector {\r\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   * @returns Rotation angle in radians\r\n   * @deprecated Use {@apilink globalRotation} instead\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * The actor's rotation (in radians) taking into account any parent relationships\r\n   */\r\n  public get globalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   * @returns Position in world coordinates\r\n   * @deprecated Use {@apilink globalPos} instead\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * The actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   */\r\n  public get globalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   * @deprecated Use {@apilink globalScale} instead\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  /**\r\n   * The global scale of the Actor\r\n   */\r\n  public get globalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  /**\r\n   * The global z-index of the actor\r\n   */\r\n  public get globalZ(): number {\r\n    return this.get(TransformComponent).globalZ;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this._add(engine);\r\n    this._preupdate(engine, elapsed);\r\n    this._postupdate(engine, elapsed);\r\n    this._remove(engine);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires before every collision resolution for a confirmed contact\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onPreCollisionResolve(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires after every resolution for a confirmed contact.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onPostCollisionResolve(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires once when 2 entities with a ColliderComponent first start colliding or touching, if the Colliders stay in contact this\r\n   * does not continue firing until they separate and re-collide.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onCollisionStart(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires once when 2 entities with a ColliderComponent separate after having been in contact.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param lastContact\r\n   */\r\n  public onCollisionEnd(self: Collider, other: Collider, side: Side, lastContact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  // endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { CoordPlane } from './Math/coord-plane';\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n\r\n/**\r\n * Helper {@apilink Actor} primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.anchor = config?.anchor ?? vec(0, 0);\r\n    this.body.collisionType = config?.collisionType ?? CollisionType.PreventCollision;\r\n    this.pointer.useGraphicsBounds = true;\r\n    this.pointer.useColliderShape = false;\r\n    if (!config?.collider && config?.width > 0 && config?.height > 0) {\r\n      this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n    }\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport * as ex from './index';\r\nimport { Random } from './Math/Random';\r\n\r\nexport interface TimerOptions {\r\n  /**\r\n   * If true the timer repeats every interval infinitely\r\n   */\r\n  repeats?: boolean;\r\n  /**\r\n   * If a number is specified then it will only repeat a number of times\r\n   */\r\n  numberOfRepeats?: number;\r\n  /**\r\n   * @deprecated use action: () => void, will be removed in v1.0\r\n   */\r\n  fcn?: () => void;\r\n  /**\r\n   * Action to perform every time the timer fires\r\n   */\r\n  action?: () => void;\r\n  /**\r\n   * Interval in milliseconds for the timer to fire\r\n   */\r\n  interval: number;\r\n  /**\r\n   * Optionally specify a random range of milliseconds for the timer to fire\r\n   */\r\n  randomRange?: [number, number];\r\n  /**\r\n   * Optionally provide a random instance to use for random behavior, otherwise a new random will be created seeded from the current time.\r\n   */\r\n  random?: ex.Random;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n  public randomRange: [number, number] = [0, 0];\r\n  public random: ex.Random;\r\n  private _baseInterval = 10;\r\n  private _generateRandomInterval = () => {\r\n    return this._baseInterval + this.random.integer(this.randomRange[0], this.randomRange[1]);\r\n  };\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n\r\n  public scene: Scene = null;\r\n\r\n  constructor(options: TimerOptions) {\r\n    const fcn = options.action ?? options.fcn;\r\n    const interval = options.interval;\r\n    const repeats = options.repeats;\r\n    const numberOfRepeats = options.numberOfRepeats;\r\n    const randomRange = options.randomRange;\r\n    const random = options.random;\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this._callbacks = [];\r\n    this._baseInterval = this.interval = interval;\r\n    if (!!randomRange) {\r\n      if (randomRange[0] > randomRange[1]) {\r\n        throw new Error('min value must be lower than max value for range');\r\n      }\r\n      //We use the instance of ex.Random to generate the range\r\n      this.random = random ?? new Random();\r\n      this.randomRange = randomRange;\r\n\r\n      this.interval = this._generateRandomInterval();\r\n      this.on(() => {\r\n        this.interval = this._generateRandomInterval();\r\n      });\r\n    }\r\n    this.repeats = repeats || this.repeats;\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param action The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(action: () => void) {\r\n    this._callbacks.push(action);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param action The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(action: () => void) {\r\n    const index = this._callbacks.indexOf(action);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param elapsed  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(elapsed: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += elapsed;\r\n      this._elapsedTime += elapsed;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this._baseInterval = this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { vec, Vector } from '../Math/vector';\r\n\r\nexport class ParallaxComponent extends Component {\r\n  parallaxFactor = vec(1.0, 1.0);\r\n\r\n  constructor(parallaxFactor?: Vector) {\r\n    super();\r\n    this.parallaxFactor = parallaxFactor ?? this.parallaxFactor;\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { DebugConfig } from '../Debug';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Provide arbitrary drawing for the purposes of debugging your game\r\n *\r\n * Will only show when the Engine is set to debug mode {@apilink Engine.showDebug} or {@apilink Engine.toggleDebug}\r\n *\r\n */\r\nexport class DebugGraphicsComponent extends Component {\r\n  constructor(\r\n    public draw: (ctx: ExcaliburGraphicsContext, debugFlags: DebugConfig) => void,\r\n    public useTransform = true\r\n  ) {\r\n    super();\r\n  }\r\n}\r\n","import { EventEmitter } from '../EventEmitter';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { GlobalCoordinates } from '../Math';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { RentalPool } from '../Util/RentalPool';\r\n\r\n/**\r\n * Signals that an object has nested pointer events on nested objects that are not an Entity with\r\n * a PointerComponent. For example TileMap Tiles\r\n */\r\nexport interface HasNestedPointerEvents {\r\n  _dispatchPointerEvents(receiver: PointerEventReceiver): void;\r\n  _processPointerToObject(receiver: PointerEventReceiver): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nfunction hasNestedEvents(object: any): object is HasNestedPointerEvents {\r\n  return object && object._dispatchPointerEvents && object._processPointerToObject;\r\n}\r\n\r\nexport class PointerTargetObjectProxy<TObject extends { events: EventEmitter }> {\r\n  public object!: TObject;\r\n  public contains!: (point: GlobalCoordinates) => boolean;\r\n  public active!: () => boolean;\r\n  public get events(): EventEmitter {\r\n    return this.object.events;\r\n  }\r\n  public init(object: TObject, contains: (point: GlobalCoordinates) => boolean, active: () => boolean): void {\r\n    this.object = object;\r\n    this.contains = contains;\r\n    this.active = active;\r\n  }\r\n}\r\n\r\nexport class PointerEventsToObjectDispatcher<TObject extends { events: EventEmitter }> {\r\n  private _proxyPool = new RentalPool(\r\n    () => new PointerTargetObjectProxy<TObject>(),\r\n    (p) => p,\r\n    100\r\n  );\r\n  private _objectToProxy = new Map<TObject, PointerTargetObjectProxy<TObject>>();\r\n  private _proxies: PointerTargetObjectProxy<TObject>[] = [];\r\n\r\n  /**\r\n   * Tracks an object to associate with pointers and their events\r\n   * @param object\r\n   * @param contains\r\n   * @param active\r\n   */\r\n  public addObject(object: TObject, contains: (point: GlobalCoordinates) => boolean, active: () => boolean): void {\r\n    const proxy = this._proxyPool.rent(false);\r\n    proxy.init(object, contains, active);\r\n    this._proxies.push(proxy);\r\n    this._objectToProxy.set(object, proxy);\r\n  }\r\n\r\n  private _getProxy(object: TObject): PointerTargetObjectProxy<TObject> {\r\n    const proxy = this._objectToProxy.get(object);\r\n    if (proxy) {\r\n      return proxy;\r\n    }\r\n    throw new Error('No PointerTargetProxy for object');\r\n  }\r\n\r\n  /**\r\n   * Untracks an object associated with pointers and their events\r\n   * @param object\r\n   */\r\n  public removeObject(object: TObject): void {\r\n    const proxy = this._objectToProxy.get(object);\r\n    if (proxy) {\r\n      const index = this._proxies.indexOf(proxy);\r\n      if (index > -1) {\r\n        this._proxies.splice(index, 1);\r\n      }\r\n      this._proxyPool.return(proxy);\r\n    }\r\n  }\r\n  private _lastFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>();\r\n  private _currentFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>();\r\n  private _objectCurrentlyUnderPointer(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !!(this._currentFrameObjectToPointers.has(object) && this._currentFrameObjectToPointers.get(object)!.includes(pointerId));\r\n  }\r\n\r\n  private _objectWasUnderPointer(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !!(this._lastFrameObjectToPointers.has(object) && this._lastFrameObjectToPointers.get(object)!.includes(pointerId));\r\n  }\r\n\r\n  private _entered(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return this._objectCurrentlyUnderPointer(object, pointerId) && !this._lastFrameObjectToPointers.has(object);\r\n  }\r\n\r\n  private _left(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !this._currentFrameObjectToPointers.has(object) && this._objectWasUnderPointer(object, pointerId);\r\n  }\r\n\r\n  /**\r\n   * Manually associate a pointer id with an object.\r\n   *\r\n   * This assumes you've checked that the pointer is indeed over the object.\r\n   */\r\n  public addPointerToObject(object: TObject, pointerId: number): void {\r\n    const maybeProxy = this._objectToProxy.get(object);\r\n    if (maybeProxy) {\r\n      this._addPointerToProxy(maybeProxy, pointerId);\r\n    }\r\n  }\r\n\r\n  private _addPointerToProxy(object: PointerTargetObjectProxy<any>, pointerId: number): void {\r\n    if (!this._currentFrameObjectToPointers.has(object)) {\r\n      this._currentFrameObjectToPointers.set(object, [pointerId]);\r\n      return;\r\n    }\r\n    const pointers = this._currentFrameObjectToPointers.get(object)!;\r\n    this._currentFrameObjectToPointers.set(object, pointers.concat(pointerId));\r\n  }\r\n\r\n  /**\r\n   * Dispatches the appropriate pointer events in sortedObject order on tracked objects\r\n   * @param receiver\r\n   * @param sortedObjects\r\n   */\r\n  public dispatchEvents(receiver: PointerEventReceiver, sortedObjects: TObject[]) {\r\n    const lastFrameEntities = new Set(this._lastFrameObjectToPointers.keys());\r\n    const currentFrameEntities = new Set(this._currentFrameObjectToPointers.keys());\r\n    // Filter preserves z order\r\n    let lastMovePerPointer: Map<number, PointerEvent>;\r\n    let lastUpPerPointer: Map<number, PointerEvent>;\r\n    let lastDownPerPointer: Map<number, PointerEvent>;\r\n    // Dispatch events in proxy z order\r\n    for (let i = 0; i < sortedObjects.length; i++) {\r\n      const object = sortedObjects[i];\r\n      const proxy = this._getProxy(object);\r\n      if (hasNestedEvents(object)) {\r\n        object._dispatchPointerEvents(receiver);\r\n      }\r\n      if (lastFrameEntities.has(proxy) || currentFrameEntities.has(proxy)) {\r\n        lastDownPerPointer = this._processDownAndEmit(receiver, proxy);\r\n\r\n        lastUpPerPointer = this._processUpAndEmit(receiver, proxy);\r\n\r\n        lastMovePerPointer = this._processMoveAndEmit(receiver, proxy);\r\n\r\n        const lastUpDownMoveEvents = [...lastMovePerPointer.values(), ...lastDownPerPointer.values(), ...lastUpPerPointer.values()];\r\n        this._processEnterLeaveAndEmit(receiver, proxy, lastUpDownMoveEvents);\r\n\r\n        this._processCancelAndEmit(receiver, proxy);\r\n\r\n        this._processWheelAndEmit(receiver, proxy);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Given the tracked objects, update pointer containment given the provided contains()\r\n   * @param receiver\r\n   * @param objects\r\n   */\r\n  public processPointerToObject(receiver: PointerEventReceiver, objects: TObject[]) {\r\n    // Pre-process find entities under pointers\r\n    for (let objectIndex = 0; objectIndex < objects.length; objectIndex++) {\r\n      const object = objects[objectIndex];\r\n      const proxy = this._getProxy(object);\r\n      if (hasNestedEvents(object)) {\r\n        object._processPointerToObject(receiver);\r\n      }\r\n      for (const [pointerId, pos] of receiver.currentFramePointerCoords.entries()) {\r\n        if (proxy.contains(pos)) {\r\n          this._addPointerToProxy(proxy, pointerId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear current frames pointer-object associations and track last frame pointer-object associations\r\n   */\r\n  public clear() {\r\n    this._lastFrameObjectToPointers.clear();\r\n    this._lastFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>(this._currentFrameObjectToPointers);\r\n    this._currentFrameObjectToPointers.clear();\r\n  }\r\n\r\n  private _processDownAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastDownPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through down and dispatch to entities\r\n    for (const event of receiver.currentFrameDown) {\r\n      if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointerdown', event as any);\r\n        if (receiver.isDragStart(event.pointerId)) {\r\n          object.events.emit('pointerdragstart', event as any);\r\n        }\r\n      }\r\n      lastDownPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastDownPerPointer;\r\n  }\r\n\r\n  private _processUpAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastUpPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through up and dispatch to entities\r\n    for (const event of receiver.currentFrameUp) {\r\n      if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointerup', event as any);\r\n        if (receiver.isDragEnd(event.pointerId)) {\r\n          object.events.emit('pointerdragend', event as any);\r\n        }\r\n      }\r\n      lastUpPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastUpPerPointer;\r\n  }\r\n\r\n  private _processMoveAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastMovePerPointer = new Map<number, PointerEvent>();\r\n    // Loop through move and dispatch to entities\r\n    for (const event of receiver.currentFrameMove) {\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        // move\r\n        object.events.emit('pointermove', event as any);\r\n\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragmove', event as any);\r\n        }\r\n      }\r\n      lastMovePerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastMovePerPointer;\r\n  }\r\n\r\n  private _processEnterLeaveAndEmit(\r\n    receiver: PointerEventReceiver,\r\n    object: PointerTargetObjectProxy<any>,\r\n    lastUpDownMoveEvents: PointerEvent[]\r\n  ) {\r\n    // up, down, and move are considered for enter and leave\r\n    for (const event of lastUpDownMoveEvents) {\r\n      // enter\r\n      if (event.active && object.active() && this._entered(object, event.pointerId)) {\r\n        object.events.emit('pointerenter', event as any);\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragenter', event as any);\r\n        }\r\n        break;\r\n      }\r\n      if (\r\n        event.active &&\r\n        object.active() &&\r\n        // leave can happen on move\r\n        (this._left(object, event.pointerId) ||\r\n          // or leave can happen on pointer up\r\n          (this._objectCurrentlyUnderPointer(object, event.pointerId) && event.type === 'up'))\r\n      ) {\r\n        object.events.emit('pointerleave', event as any);\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragleave', event as any);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processCancelAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>) {\r\n    // cancel\r\n    for (const event of receiver.currentFrameCancel) {\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointercancel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processWheelAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>) {\r\n    // wheel\r\n    for (const event of receiver.currentFrameWheel) {\r\n      // Currently the wheel only fires under the primary pointer '0'\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, 0)) {\r\n        object.events.emit('pointerwheel', event as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Engine } from '../Engine';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { Entity, EntityEvents } from '../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { Shape } from '../Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, Graphic, GraphicsComponent, hasGraphicsTick, ParallaxComponent } from '../Graphics';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { Collider } from '../Collision/Colliders/Collider';\r\nimport { PostDrawEvent, PostUpdateEvent, PreDrawEvent, PreUpdateEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { DebugConfig } from '../Debug';\r\nimport { clamp } from '../Math/util';\r\nimport { PointerComponent } from '../Input/PointerComponent';\r\nimport { PointerEvent } from '../Input/PointerEvent';\r\nimport { PointerEventReceiver } from '../Input/PointerEventReceiver';\r\nimport { HasNestedPointerEvents, PointerEventsToObjectDispatcher } from '../Input/PointerEventsToObjectDispatcher';\r\nimport { GlobalCoordinates } from '../Math';\r\n\r\nexport interface TileMapOptions {\r\n  /**\r\n   * Optionally name the tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the meshing lookbehind for Tilemap, Tilemaps combine solid tiles into optimal\r\n   * geometry and the lookbehind configures how far back the Tilemap to look for geometry when combining. Meshing\r\n   * is an expensive operation, so when the Tilemap geometry is invalidated it must be recalculated.\r\n   *\r\n   * Default is 10 slots, but if your Tilemap does not change positions or solid tiles often you can increase this to\r\n   * Infinity.\r\n   */\r\n  meshingLookBehind?: number;\r\n}\r\n\r\nexport type TilePointerEvents = {\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n};\r\n\r\nexport type TileMapEvents = EntityEvents &\r\n  TilePointerEvents & {\r\n    preupdate: PreUpdateEvent<TileMap>;\r\n    postupdate: PostUpdateEvent<TileMap>;\r\n    predraw: PreDrawEvent;\r\n    postdraw: PostDrawEvent;\r\n  };\r\n\r\nexport const TileMapEvents = {\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PointerUp: 'pointerup',\r\n  PointerDown: 'pointerdown',\r\n  PointerMove: 'pointermove',\r\n  PointerCancel: 'pointercancel'\r\n};\r\n\r\n/**\r\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\r\n *\r\n * TileMaps are useful for top down or side scrolling grid oriented games.\r\n */\r\nexport class TileMap extends Entity implements HasNestedPointerEvents {\r\n  public events = new EventEmitter<TileMapEvents>();\r\n  private _token = 0;\r\n  private _engine!: Engine;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly tiles: Tile[] = [];\r\n  private _rows: Tile[][] = [];\r\n  private _cols: Tile[][] = [];\r\n\r\n  public readonly tileWidth: number;\r\n  public readonly tileHeight: number;\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  public renderFromTopOfGraphic = false;\r\n  public meshingLookBehind = 10;\r\n\r\n  private _collidersDirty = true;\r\n  private _pointerEventDispatcher: PointerEventsToObjectDispatcher<Tile>;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n  }\r\n\r\n  public flagTilesDirty() {\r\n    for (let i = 0; i < this.tiles.length; i++) {\r\n      if (this.tiles[i]) {\r\n        this.tiles[i].flagDirty();\r\n      }\r\n    }\r\n  }\r\n\r\n  public pointer: PointerComponent;\r\n  public transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _graphics: GraphicsComponent;\r\n  public collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this.transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this.transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this.transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this.transform?.pos) {\r\n      this.transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this.transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this.transform) {\r\n      this.transform.z = val;\r\n    }\r\n  }\r\n\r\n  private _oldRotation: number = 0;\r\n  public get rotation(): number {\r\n    return this.transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this.transform) {\r\n      this.transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  private _oldScale: Vector;\r\n  public get scale(): Vector {\r\n    return this.transform?.scale ?? Vector.One;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    if (this.transform?.scale) {\r\n      this.transform.scale = val;\r\n    }\r\n  }\r\n\r\n  private _oldPos: Vector;\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * Width of the whole tile map in pixels\r\n   */\r\n  public get width(): number {\r\n    return this.tileWidth * this.columns * this.scale.x;\r\n  }\r\n\r\n  /**\r\n   * Height of the whole tilemap in pixels\r\n   */\r\n  public get height(): number {\r\n    return this.tileHeight * this.rows * this.scale.y;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, event: TileMapEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler as any);\r\n  }\r\n\r\n  /**\r\n   * @param options\r\n   */\r\n  constructor(options: TileMapOptions) {\r\n    super([], options.name);\r\n    this.meshingLookBehind = options.meshingLookBehind ?? this.meshingLookBehind;\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, elapsed) => this.draw(ctx, elapsed)\r\n      })\r\n    );\r\n    this.addComponent(new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false));\r\n    this.addComponent(new ColliderComponent());\r\n    this.addComponent(new PointerComponent());\r\n    this.pointer = this.get(PointerComponent);\r\n    this._graphics = this.get(GraphicsComponent);\r\n    this.transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this.collider = this.get(ColliderComponent);\r\n    this._composite = this.collider.useCompositeCollider([]);\r\n\r\n    this.transform.pos = options.pos ?? Vector.Zero;\r\n    this._oldPos = this.transform.pos.clone();\r\n    this._oldScale = this.transform.scale.clone();\r\n    this.renderFromTopOfGraphic = options.renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.tileWidth = options.tileWidth;\r\n    this.tileHeight = options.tileHeight;\r\n    this.rows = options.rows;\r\n    this.columns = options.columns;\r\n\r\n    this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n    this.tiles = new Array<Tile>(this.rows * this.columns);\r\n    this._rows = new Array(this.rows);\r\n    this._cols = new Array(this.columns);\r\n    let currentCol: Tile[] = [];\r\n    for (let i = 0; i < this.columns; i++) {\r\n      for (let j = 0; j < this.rows; j++) {\r\n        const tile = new Tile({\r\n          x: i,\r\n          y: j,\r\n          map: this\r\n        });\r\n        tile.map = this;\r\n        this.tiles[i + j * this.columns] = tile;\r\n        this._pointerEventDispatcher.addObject(\r\n          tile,\r\n          (vec: GlobalCoordinates) => {\r\n            // TODO handle geometry/graphics\r\n            return tile.bounds.contains(vec.worldPos);\r\n          },\r\n          () => true\r\n        );\r\n        currentCol.push(tile);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(tile);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this._graphics.localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.columns * this.tileWidth * this.scale.x,\r\n      bottom: this.rows * this.tileHeight * this.scale.y\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._engine = engine;\r\n  }\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider) ?? Vector.Zero;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this.collider.$colliderRemoved.notifyAll(this._composite);\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    this._composite = this.collider.useCompositeCollider([]);\r\n    let current: BoundingBox | null = null;\r\n\r\n    /**\r\n     * Returns wether or not the 2 boxes share an edge and are the same height\r\n     * @param prev\r\n     * @param next\r\n     * @returns true if they share and edge, false if not\r\n     */\r\n    const shareEdges = (prev: BoundingBox, next: BoundingBox) => {\r\n      if (prev && next) {\r\n        // same top/bottom\r\n        return (\r\n          prev.top === next.top &&\r\n          prev.bottom === next.bottom &&\r\n          // Shared right/left edge\r\n          prev.right === next.left\r\n        );\r\n      }\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * Potentially merges the current collider into a list of previous ones, mutating the list\r\n     * If checkAndCombine returns true, the collider was successfully merged and should be thrown away\r\n     * @param current current collider to test\r\n     * @param colliders List of colliders to consider merging with\r\n     * @param maxLookBack The amount of colliders to look back for combination\r\n     * @returns false when no combination found, true when successfully combined\r\n     */\r\n    const checkAndCombine = (current: BoundingBox, colliders: BoundingBox[], maxLookBack = this.meshingLookBehind) => {\r\n      if (!current) {\r\n        return false;\r\n      }\r\n      // walk backwards through the list of colliders and combine with the first that shares an edge\r\n      for (let i = colliders.length - 1; i >= 0; i--) {\r\n        if (maxLookBack-- < 0) {\r\n          // blunt the O(n^2) algorithm a bit\r\n          return false;\r\n        }\r\n        const prev = colliders[i];\r\n        if (shareEdges(prev, current)) {\r\n          colliders[i] = prev.combine(current);\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // ? configurable bias perhaps, horizontal strips vs. vertical ones\r\n    // Bad tile collider packing algorithm\r\n    for (let i = 0; i < this.columns; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        const tile = this.tiles[i + j * this.columns];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          // Use custom collider otherwise bounding box\r\n          if (tile.getColliders().length > 0) {\r\n            // tile with custom collider interrupting the current run\r\n            for (const collider of tile.getColliders()) {\r\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n              collider.offset = vec(tile.x * this.tileWidth * this.scale.x, tile.y * this.tileHeight * this.scale.y).add(originalOffset);\r\n              collider.owner = this;\r\n              this._composite.addCollider(collider);\r\n            }\r\n            //we push any current collider before nulling the current run\r\n            if (current && !checkAndCombine(current, colliders)) {\r\n              colliders.push(current);\r\n            }\r\n            current = null;\r\n            // Use the bounding box\r\n          } else {\r\n            if (!current) {\r\n              // no current run, start one\r\n              current = tile.defaultGeometry;\r\n            } else {\r\n              // combine with current run\r\n              current = current.combine(tile.defaultGeometry);\r\n            }\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          // End of run check and combine\r\n          if (current && !checkAndCombine(current, colliders)) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      // Eno of run check and combine\r\n      if (current && !checkAndCombine(current, colliders)) {\r\n        // else new collider if no combination\r\n        colliders.push(current);\r\n      }\r\n      current = null;\r\n    }\r\n\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this.collider.update();\r\n    // Notify that colliders have been updated\r\n    this.collider.$colliderAdded.notifyAll(this._composite);\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink Tile} by index (row major order)\r\n   *\r\n   * Returns null if out of bounds\r\n   */\r\n  public getTileByIndex(index: number): Tile | null {\r\n    return this.tiles[index] ?? null;\r\n  }\r\n  /**\r\n   * Returns the {@apilink Tile} by its x and y integer coordinates\r\n   *\r\n   * Returns null if out of bounds\r\n   *\r\n   * For example, if I want the tile in fifth column (x), and second row (y):\r\n   * `getTile(4, 1)` 0 based, so 0 is the first in row/column\r\n   */\r\n  public getTile(x: number, y: number): Tile | null {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n  /**\r\n   * Returns the {@apilink Tile} by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): Tile | null {\r\n    const { x, y } = this._getTileCoordinates(point);\r\n    const tile = this.getTile(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.columns && y < this.rows && tile) {\r\n      return tile;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private _getTileCoordinates(point: Vector): { x: number; y: number } {\r\n    // Convert to Tile Space point\r\n    point = this.transform.applyInverse(point);\r\n\r\n    const x = Math.floor(point.x / this.tileWidth);\r\n    const y = Math.floor(point.y / this.tileHeight);\r\n    return { x, y };\r\n  }\r\n\r\n  public getRows(): readonly Tile[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Tile[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  /**\r\n   * Returns the on screen tiles for a tilemap, this will overshoot by a small amount because of the internal quad tree data structure.\r\n   *\r\n   * Useful if you need to perform specific logic on onscreen tiles\r\n   */\r\n  public getOnScreenTiles(): readonly Tile[] {\r\n    let worldBounds = this._engine.screen.getWorldBounds();\r\n    const maybeParallax = this.get(ParallaxComponent);\r\n    if (maybeParallax && this.isInitialized) {\r\n      let pos = this.pos;\r\n      const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n      const parallaxOffset = this._engine.currentScene.camera.pos.scale(oneMinusFactor);\r\n      pos = pos.sub(parallaxOffset);\r\n      // adjust world bounds by parallax factor\r\n      worldBounds = worldBounds.translate(pos);\r\n    }\r\n\r\n    const bounds = this.transform.coordPlane === CoordPlane.Screen ? this._engine.screen.getScreenBounds() : worldBounds;\r\n    const topLeft = this._getTileCoordinates(bounds.topLeft);\r\n    const topRight = this._getTileCoordinates(bounds.topRight);\r\n    const bottomRight = this._getTileCoordinates(bounds.bottomRight);\r\n    const bottomLeft = this._getTileCoordinates(bounds.bottomLeft);\r\n\r\n    const tileStartX = Math.min(clamp(topLeft.x, 0, this.columns - 1), clamp(topRight.x, 0, this.columns - 1));\r\n    const tileStartY = Math.min(clamp(topLeft.y, 0, this.rows - 1), clamp(topRight.y, 0, this.rows - 1));\r\n    const tileEndX = Math.max(clamp(bottomRight.x, 0, this.columns - 1), clamp(bottomLeft.x, 0, this.columns - 1));\r\n    const tileEndY = Math.max(clamp(bottomRight.y, 0, this.rows - 1), clamp(bottomLeft.y, 0, this.rows - 1));\r\n\r\n    const tiles: Tile[] = [];\r\n    for (let x = tileStartX; x <= tileEndX; x++) {\r\n      for (let y = tileStartY; y <= tileEndY; y++) {\r\n        tiles.push(this.getTile(x, y)!);\r\n      }\r\n    }\r\n    return tiles;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _processPointerToObject(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _dispatchPointerEvents(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this.onPreUpdate(engine, elapsed);\r\n    this.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n\r\n    // Update colliders\r\n    if (!this._oldPos.equals(this.pos) || this._oldRotation !== this.rotation || !this._oldScale.equals(this.scale)) {\r\n      this.flagCollidersDirty();\r\n      this.flagTilesDirty();\r\n    }\r\n    if (this._collidersDirty) {\r\n      this._collidersDirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    // Clear last frame's events\r\n    this._pointerEventDispatcher.clear();\r\n\r\n    this._token++;\r\n\r\n    this.pos.clone(this._oldPos);\r\n    this._oldRotation = this.rotation;\r\n    this.scale.clone(this._oldScale);\r\n    this.transform.pos = this.pos;\r\n    this.onPostUpdate(engine, elapsed);\r\n    this.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the {@apilink Scene}.\r\n   * @param ctx ExcaliburGraphicsContext\r\n   * @param elapsed  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n    this.emit('predraw', new PreDrawEvent(ctx as any, elapsed, this)); // TODO fix event\r\n\r\n    let graphics: readonly Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    const tiles = this.getOnScreenTiles();\r\n    for (let i = 0; i < tiles.length; i++) {\r\n      const tile = tiles[i];\r\n      // get non-negative tile sprites\r\n      const offsets = tile.getGraphicsOffsets();\r\n      graphics = tile.getGraphics();\r\n\r\n      for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n        // draw sprite, warning if sprite doesn't exist\r\n        const graphic = graphics[graphicsIndex];\r\n        const offset = offsets[graphicsIndex];\r\n        if (graphic) {\r\n          if (hasGraphicsTick(graphic)) {\r\n            graphic?.tick(elapsed, this._token);\r\n          }\r\n          const offsetY = this.renderFromTopOfGraphic ? 0 : graphic.height - this.tileHeight;\r\n          graphic.draw(ctx, tile.x * this.tileWidth + offset.x, tile.y * this.tileHeight - offsetY + offset.y);\r\n        }\r\n      }\r\n    }\r\n    this.emit('postdraw', new PostDrawEvent(ctx as any, elapsed, this));\r\n  }\r\n\r\n  public debug(gfx: ExcaliburGraphicsContext, debugFlags: DebugConfig) {\r\n    const {\r\n      showAll,\r\n      showGrid,\r\n      gridColor,\r\n      gridWidth,\r\n      showSolidBounds: showColliderBounds,\r\n      solidBoundsColor: colliderBoundsColor,\r\n      showColliderGeometry\r\n    } = debugFlags.tilemap;\r\n    const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\r\n    const width = this.tileWidth * this.columns * this.scale.x;\r\n    const height = this.tileHeight * this.rows * this.scale.y;\r\n    const pos = this.pos;\r\n    if (showGrid || showAll) {\r\n      for (let r = 0; r < this.rows + 1; r++) {\r\n        const yOffset = vec(0, r * this.tileHeight * this.scale.y);\r\n        gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), gridColor, gridWidth);\r\n      }\r\n\r\n      for (let c = 0; c < this.columns + 1; c++) {\r\n        const xOffset = vec(c * this.tileWidth * this.scale.x, 0);\r\n        gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), gridColor, gridWidth);\r\n      }\r\n    }\r\n\r\n    if (showAll || showColliderBounds || showColliderGeometry) {\r\n      const colliders = this._composite.getColliders();\r\n      gfx.save();\r\n      gfx.translate(this.pos.x, this.pos.y);\r\n      gfx.scale(this.scale.x, this.scale.y);\r\n      for (const collider of colliders) {\r\n        const bounds = collider.localBounds;\r\n        const pos = collider.worldPos.sub(this.pos);\r\n        if (showColliderBounds) {\r\n          gfx.drawRectangle(pos, bounds.width, bounds.height, colliderBoundsColor);\r\n        }\r\n      }\r\n      gfx.restore();\r\n      if (showColliderGeometry) {\r\n        for (const collider of colliders) {\r\n          collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\r\n        }\r\n      }\r\n    }\r\n\r\n    if (showAll || showColliderBounds) {\r\n      gfx.save();\r\n      gfx.z = 999;\r\n      if (showColliderBounds) {\r\n        for (let i = 0; i < this.tiles.length; i++) {\r\n          this.tiles[i].bounds.draw(gfx);\r\n        }\r\n      }\r\n      gfx.restore();\r\n    }\r\n  }\r\n}\r\n\r\nexport interface TileOptions {\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  y: number;\r\n  map: TileMap;\r\n  solid?: boolean;\r\n  graphics?: Graphic[];\r\n}\r\n\r\n/**\r\n * TileMap Tile\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a {@apilink TileMap}.\r\n *\r\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Tile {\r\n  private _bounds!: BoundingBox;\r\n  private _geometry!: BoundingBox;\r\n  private _pos!: Vector;\r\n  private _posDirty = false;\r\n\r\n  public events = new EventEmitter<TilePointerEvents>();\r\n\r\n  /**\r\n   * Return the world position of the top left corner of the tile\r\n   */\r\n  public get pos() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n      this._posDirty = false;\r\n    }\r\n    return this._pos;\r\n  }\r\n\r\n  /**\r\n   * Integer x coordinate of the tile\r\n   */\r\n  public readonly x: number;\r\n\r\n  /**\r\n   * Integer y coordinate of the tile\r\n   */\r\n  public readonly y: number;\r\n\r\n  private _width: number;\r\n  /**\r\n   * Width of the tile in pixels\r\n   */\r\n  public get width(): number {\r\n    return this._width;\r\n  }\r\n\r\n  private _height: number;\r\n  /**\r\n   * Height of the tile in pixels\r\n   */\r\n  public get height(): number {\r\n    return this._height;\r\n  }\r\n\r\n  /**\r\n   * Reference to the TileMap this tile is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagCollidersDirty();\r\n    this._solid = val;\r\n  }\r\n\r\n  private _graphics: Graphic[] = [];\r\n  private _offsets: Vector[] = [];\r\n\r\n  /**\r\n   * Current list of graphics for this tile\r\n   */\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Current list of offsets for this tile's graphics\r\n   */\r\n  public getGraphicsOffsets(): readonly Vector[] {\r\n    return this._offsets;\r\n  }\r\n\r\n  /**\r\n   * Add another {@apilink Graphic} to this TileMap tile\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphic, options?: { offset?: Vector }) {\r\n    this._graphics.push(graphic);\r\n    if (options?.offset) {\r\n      this._offsets.push(options.offset);\r\n    } else {\r\n      this._offsets.push(Vector.Zero);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a {@apilink Graphic} from this tile\r\n   */\r\n  public removeGraphic(graphic: Graphic) {\r\n    const index = this._graphics.indexOf(graphic);\r\n    if (index > -1) {\r\n      this._graphics.splice(index, 1);\r\n      this._offsets.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all graphics from this tile\r\n   */\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n    this._offsets.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Current list of colliders for this tile\r\n   */\r\n  private _colliders: Collider[] = [];\r\n\r\n  /**\r\n   * Returns the list of colliders\r\n   */\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a custom collider to the {@apilink Tile} to use instead of it's bounds\r\n   *\r\n   * If no collider is set but {@apilink Tile.solid} is set, the tile bounds are used as a collider.\r\n   *\r\n   * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the {@apilink Tile}\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the {@apilink Tile}\r\n   */\r\n  public clearColliders() {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Arbitrary data storage per tile, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  constructor(options: TileOptions) {\r\n    this.x = options.x;\r\n    this.y = options.y;\r\n    this.map = options.map;\r\n    this._width = options.map.tileWidth * this.map.scale.x;\r\n    this._height = options.map.tileHeight * this.map.scale.y;\r\n    this.solid = options.solid ?? this.solid;\r\n    this._graphics = options.graphics ?? [];\r\n    this._recalculate();\r\n  }\r\n\r\n  public flagDirty() {\r\n    return (this._posDirty = true);\r\n  }\r\n\r\n  private _recalculate() {\r\n    const geometryPos = this.map.pos.add(vec(this.x * this.map.tileWidth, this.y * this.map.tileHeight));\r\n    this._geometry = new BoundingBox(geometryPos.x, geometryPos.y, geometryPos.x + this.map.tileWidth, geometryPos.y + this.map.tileHeight);\r\n\r\n    this._width = this.map.tileWidth * this.map.scale.x;\r\n    this._height = this.map.tileHeight * this.map.scale.y;\r\n\r\n    this._pos = this.map.pos.add(vec(this.x * this._width, this.y * this._height));\r\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this._width, this._pos.y + this._height);\r\n\r\n    if (this.map.rotation) {\r\n      this._bounds = this._bounds.rotate(this.map.rotation, this.map.pos);\r\n    }\r\n    this._posDirty = false;\r\n  }\r\n\r\n  /**\r\n   * Tile bounds in world space\r\n   */\r\n  public get bounds() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._bounds;\r\n  }\r\n\r\n  public get defaultGeometry() {\r\n    return this._geometry;\r\n  }\r\n\r\n  /**\r\n   * Tile position in world space\r\n   */\r\n  public get center(): Vector {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return new Vector(this._pos.x + this._width / 2, this._pos.y + this._height / 2);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<TilePointerEvents>>(eventName: TEventName, event: TilePointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<TilePointerEvents>>(\r\n    eventName: TEventName,\r\n    handler: Handler<TilePointerEvents[TEventName]>\r\n  ): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<TilePointerEvents>>(\r\n    eventName: TEventName,\r\n    handler: Handler<TilePointerEvents[TEventName]>\r\n  ): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<TilePointerEvents>>(eventName: TEventName, handler: Handler<TilePointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    if (handler) {\r\n      this.events.off(eventName, handler);\r\n    } else {\r\n      this.events.off(eventName);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Screen } from './Screen';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, InitializeEvent } from './Events';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { AffineMatrix } from './Math/affine-matrix';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { pixelSnapEpsilon } from './Graphics';\r\nimport { sign } from './Math/util';\r\nimport { WatchVector } from './Math/watch-vector';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param elapsed The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, elapsed: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LockCameraToActorStrategy} on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LockCameraToActorAxisStrategy} on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink ElasticToActorStrategy} on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink RadiusAroundActorStrategy} on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LimitCameraBoundsStrategy} on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, camera: Camera, engine: Engine, elapsed: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(\r\n    public target: Actor,\r\n    public axis: Axis\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(\r\n    public target: Actor,\r\n    public cameraElasticity: number,\r\n    public cameraFriction: number\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(\r\n    public target: Actor,\r\n    public radius: number\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.magnitude;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a {@apilink TileMap}'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\nexport type CameraEvents = {\r\n  preupdate: PreUpdateEvent<Camera>;\r\n  postupdate: PostUpdateEvent<Camera>;\r\n  initialize: InitializeEvent<Camera>;\r\n};\r\n\r\nexport const CameraEvents = {\r\n  Initialize: 'initialize',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate'\r\n};\r\n\r\n/**\r\n * Cameras\r\n *\r\n * {@apilink Camera} is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera implements CanUpdate, CanInitialize {\r\n  public events = new EventEmitter<CameraEvents>();\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public inverse: AffineMatrix = AffineMatrix.identity();\r\n\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  private _angularVelocity: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this._angularVelocity;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this._angularVelocity = value;\r\n  }\r\n\r\n  private _posChanged = false;\r\n  private _pos: Vector = new WatchVector(Vector.Zero, () => {\r\n    this._posChanged = true;\r\n  });\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._posChanged = true;\r\n    this._pos = new WatchVector(vec, () => {\r\n      this._posChanged = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Has the position changed since the last update\r\n   */\r\n  public hasChanged(): boolean {\r\n    return this._posChanged;\r\n  }\r\n  /**\r\n   * Interpolated camera position if more draws are running than updates\r\n   *\r\n   * Enabled when `Engine.fixedUpdateFps` is enabled, in all other cases this will be the same as pos\r\n   */\r\n  public drawPos: Vector = this.pos.clone();\r\n\r\n  private _oldPos = this.pos.clone();\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Get or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an {@apilink Actor} or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an {@apilink Actor} or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ({@apilink EasingFunctions.EaseInOutCubic} by default)\r\n   * @returns A {@apilink Promise} that resolves when movement is finished, including if it's interrupted.\r\n   *          The {@apilink Promise} value is the {@apilink Vector} of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an {@apilink CameraStrategy}\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an {@apilink CameraStrategy}\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _screen: Screen;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = engine;\r\n      this._screen = engine.screen;\r\n\r\n      const currentRes = this._screen.contentArea;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.y;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n      this.pos.clone(this.drawPos);\r\n      // First frame bootstrap\r\n\r\n      // Ensure camera tx is correct\r\n      // Run update twice to ensure properties are init'd\r\n      this.updateTransform(this.pos);\r\n\r\n      // Run strategies for first frame\r\n      this.runStrategies(engine, engine.clock.elapsed());\r\n\r\n      // Setup the first frame viewport\r\n      this.updateViewport();\r\n\r\n      // It's important to update the camera after strategies\r\n      // This prevents jitter\r\n      this.updateTransform(this.pos);\r\n      this.pos.clone(this._oldPos);\r\n\r\n      this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, event: CameraEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  public runStrategies(engine: Engine, elapsed: number) {\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, engine, elapsed);\r\n    }\r\n  }\r\n\r\n  public updateViewport() {\r\n    // recalculate viewport\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, elapsed);\r\n    this.pos.clone(this._oldPos);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(elapsed / 1000));\r\n    this.zoom += (this.dz * elapsed) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(elapsed / 1000));\r\n    this.dz += (this.az * elapsed) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * elapsed) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += elapsed;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += elapsed;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += elapsed;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    this.runStrategies(engine, elapsed);\r\n\r\n    this.updateViewport();\r\n\r\n    // It's important to update the camera after strategies\r\n    // This prevents jitter\r\n    this.updateTransform(this.pos);\r\n    this._postupdate(engine, elapsed);\r\n    this._posChanged = false;\r\n  }\r\n\r\n  private _snapPos = vec(0, 0);\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext): void {\r\n    // default to the current position\r\n    this.pos.clone(this.drawPos);\r\n\r\n    // interpolation if fixed update is on\r\n    // must happen on the draw, because more draws are potentially happening than updates\r\n    if (this._engine.fixedUpdateTimestep) {\r\n      const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\r\n      const interpolatedPos = this.pos.scale(blend).add(this._oldPos.scale(1.0 - blend));\r\n      interpolatedPos.clone(this.drawPos);\r\n      this.updateTransform(interpolatedPos);\r\n    }\r\n    // Snap camera to pixel\r\n    if (ctx.snapToPixel) {\r\n      const snapPos = this.drawPos.clone(this._snapPos);\r\n      snapPos.x = ~~(snapPos.x + pixelSnapEpsilon * sign(snapPos.x));\r\n      snapPos.y = ~~(snapPos.y + pixelSnapEpsilon * sign(snapPos.y));\r\n      snapPos.clone(this.drawPos);\r\n      this.updateTransform(snapPos);\r\n    }\r\n    ctx.multiply(this.transform);\r\n  }\r\n\r\n  public updateTransform(pos: Vector) {\r\n    // center the camera\r\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\r\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\r\n    const cameraPos = vec(-pos.x + newCanvasWidth / 2 + this._xShake, -pos.y + newCanvasHeight / 2 + this._yShake);\r\n\r\n    // Calculate camera transform\r\n    this.transform.reset();\r\n\r\n    this.transform.scale(this.zoom, this.zoom);\r\n\r\n    // rotate about the focus\r\n    this.transform.translate(newCanvasWidth / 2, newCanvasHeight / 2);\r\n    this.transform.rotate(this.rotation);\r\n    this.transform.translate(-newCanvasWidth / 2, -newCanvasHeight / 2);\r\n\r\n    this.transform.translate(cameraPos.x, cameraPos.y);\r\n    this.transform.inverse(this.inverse);\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { Vector } from './Math/vector';\r\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Entity } from './EntityComponentSystem';\r\nimport { Actor, ActorArgs, ActorEvents } from './Actor';\r\nimport { EventEmitter } from './EventEmitter';\r\n\r\nexport type TriggerEvents = ActorEvents & {\r\n  exit: ExitTriggerEvent;\r\n  enter: EnterTriggerEvent;\r\n};\r\n\r\nexport const TriggerEvents = {\r\n  ExitTrigger: 'exit',\r\n  EnterTrigger: 'enter'\r\n};\r\n\r\n/**\r\n * TriggerOptions\r\n */\r\nexport interface TriggerOptions {\r\n  // position of the trigger\r\n  pos: Vector;\r\n  // width of the trigger\r\n  width: number;\r\n  // height of the trigger\r\n  height: number;\r\n  // whether the trigger is visible or not\r\n  visible: boolean;\r\n  // action to take when triggered\r\n  action: (entity: Entity) => void;\r\n  // if specified the trigger will only fire on a specific entity and overrides any filter\r\n  target: Entity;\r\n  // Returns true if the triggers should fire on the collided entity\r\n  filter: (entity: Entity) => boolean;\r\n  // -1 if it should repeat forever\r\n  repeat: number;\r\n}\r\n\r\n/**\r\n * Triggers are a method of firing arbitrary code on collision. These are useful\r\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\r\n * are invisible, and can only be seen when {@apilink Trigger.visible} is set to `true`.\r\n */\r\nexport class Trigger extends Actor {\r\n  public events = new EventEmitter<TriggerEvents & ActorEvents>();\r\n  public target?: Entity;\r\n  /**\r\n   * Action to fire when triggered by collision\r\n   */\r\n  public action: (entity: Entity) => void;\r\n  /**\r\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\r\n   * filter return true for the collided entity.\r\n   */\r\n  public filter: (entity: Entity) => boolean;\r\n  /**\r\n   * Number of times to repeat before killing the trigger,\r\n   */\r\n  public repeat: number;\r\n\r\n  /**\r\n   * @param options Trigger options\r\n   */\r\n  constructor(options: Partial<TriggerOptions> & ActorArgs) {\r\n    super({ ...options });\r\n\r\n    this.filter = options.filter ?? (() => true);\r\n    this.repeat = options.repeat ?? -1;\r\n    this.action = options.action ?? (() => undefined);\r\n    this.target = options.target;\r\n\r\n    this.graphics.isVisible = options.visible ?? false;\r\n    this.body.collisionType = CollisionType.Passive;\r\n\r\n    this.events.on('collisionstart', ({ other: collider }: CollisionStartEvent) => {\r\n      if (!this._matchesTarget(collider.owner)) {\r\n        return;\r\n      }\r\n\r\n      this.events.emit('enter', new EnterTriggerEvent(this, collider.owner));\r\n      this._dispatchAction(collider.owner);\r\n      // remove trigger if its done, -1 repeat forever\r\n      if (this.repeat === 0) {\r\n        this.kill();\r\n      }\r\n    });\r\n\r\n    this.events.on('collisionend', ({ other: collider }: CollisionEndEvent) => {\r\n      if (this._matchesTarget(collider.owner)) {\r\n        this.events.emit('exit', new ExitTriggerEvent(this, collider.owner));\r\n      }\r\n    });\r\n  }\r\n\r\n  private _matchesTarget(entity: Entity): boolean {\r\n    return this.filter(entity) && (this.target === undefined || this.target === entity);\r\n  }\r\n\r\n  private _dispatchAction(target: Entity) {\r\n    if (this.repeat !== 0) {\r\n      this.action.call(this, target);\r\n      this.repeat--;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Higher priorities run earlier than others in the system update\r\n */\r\nexport const SystemPriority = {\r\n  Highest: -Infinity,\r\n  Higher: -5,\r\n  Average: 0,\r\n  Lower: 5,\r\n  Lowest: Infinity\r\n} as const;\r\n","import { Scene } from '../Scene';\r\nimport { SystemPriority } from './Priority';\r\nimport { World } from './World';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\n/**\r\n * An Excalibur {@apilink System} that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n *\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System {\r\n *   static priority = SystemPriority.Lowest;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public query: Query<typeof TransformComponent>;\r\n *   constructor(public world: World) {\r\n *   super();\r\n *      this.query = this.world.query([TransformComponent]);\r\n *   }\r\n *   public update(elapsed: number) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System {\r\n  /**\r\n   * Determine whether the system is called in the {@apilink SystemType.Update} or the {@apilink SystemType.Draw} phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public static priority: number = SystemPriority.Average;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(world: World, scene: Scene): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param elapsed Time in milliseconds\r\n   */\r\n  abstract update(elapsed: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param scene\r\n   * @param elapsed Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(scene: Scene, elapsed: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param scene\r\n   * @param elapsed Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(scene: Scene, elapsed: number): void;\r\n}\r\n","import { Entity } from './Entity';\r\nimport { World } from './World';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { Scene } from '../Scene';\r\n\r\n// Add/Remove entities and components\r\n\r\nexport class EntityManager {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n  private _childAddedHandlerMap = new Map<Entity, (entity: Entity) => void>();\r\n  private _childRemovedHandlerMap = new Map<Entity, (entity: Entity) => void>();\r\n\r\n  constructor(private _world: World) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param scene\r\n   * @param elapsed\r\n   */\r\n  public updateEntities(scene: Scene, elapsed: number) {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      entity.update(scene.engine, elapsed);\r\n      if (!entity.isActive) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      if (!entity.isActive) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _createChildAddedHandler = () => (e: Entity) => {\r\n    this.addEntity(e);\r\n  };\r\n\r\n  private _createChildRemovedHandler = () => (e: Entity) => {\r\n    this.removeEntity(e, false);\r\n  };\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.isActive = true;\r\n    entity.scene = this._world.scene;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => {\r\n        c.scene = entity.scene;\r\n        this.addEntity(c);\r\n      });\r\n      const childAdded = this._createChildAddedHandler();\r\n      this._childAddedHandlerMap.set(entity, childAdded);\r\n      const childRemoved = this._createChildRemovedHandler();\r\n      this._childRemovedHandlerMap.set(entity, childRemoved);\r\n      entity.childrenAdded$.subscribe(childAdded);\r\n      entity.childrenRemoved$.subscribe(childRemoved);\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.isActive) {\r\n      entity.isActive = false;\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      entity.scene = null;\r\n      removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => {\r\n        c.scene = null;\r\n        this.removeEntity(c, deferred);\r\n      });\r\n      const childAddedHandler = this._childAddedHandlerMap.get(entity);\r\n      if (childAddedHandler) {\r\n        entity.childrenAdded$.unsubscribe(childAddedHandler);\r\n      }\r\n      const childRemovedHandler = this._childRemovedHandlerMap.get(entity);\r\n      if (childRemovedHandler) {\r\n        entity.childrenRemoved$.unsubscribe(childRemovedHandler);\r\n      }\r\n\r\n      // stats\r\n      if (this._world?.scene?.engine) {\r\n        this._world.scene.engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (let entityIndex = 0; entityIndex < this._entitiesToRemove.length; entityIndex++) {\r\n      const entity = this._entitiesToRemove[entityIndex];\r\n      if (entity.isActive) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n    this._entitiesToRemove.length = 0;\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity | undefined {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[] {\r\n    return this.entities.filter((e) => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (let i = this.entities.length - 1; i >= 0; i--) {\r\n      this.removeEntity(this.entities[i]);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Component, ComponentCtor } from '../EntityComponentSystem/Component';\r\n\r\nexport type ComponentInstance<T> = T extends ComponentCtor<infer R> ? R : never;\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<TKnownComponentCtors extends ComponentCtor<Component> = never> {\r\n  public readonly id: string;\r\n  public components = new Set<TKnownComponentCtors>();\r\n  public entities: Entity<ComponentInstance<TKnownComponentCtors>>[] = [];\r\n  /**\r\n   * This fires right after the component is added\r\n   */\r\n  public entityAdded$ = new Observable<Entity<ComponentInstance<TKnownComponentCtors>>>();\r\n  /**\r\n   * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\r\n   */\r\n  public entityRemoved$ = new Observable<Entity<ComponentInstance<TKnownComponentCtors>>>();\r\n\r\n  constructor(public readonly requiredComponents: TKnownComponentCtors[]) {\r\n    if (requiredComponents.length === 0) {\r\n      throw new Error('Cannot create query without components');\r\n    }\r\n    for (const type of requiredComponents) {\r\n      this.components.add(type);\r\n    }\r\n\r\n    this.id = Query.createId(requiredComponents);\r\n  }\r\n\r\n  static createId(requiredComponents: Function[]) {\r\n    // TODO what happens if a user defines the same type name as a built in type\r\n    // ! TODO this could be dangerous depending on the bundler's settings for names\r\n    // Maybe some kind of hash function is better here?\r\n    return requiredComponents\r\n      .slice()\r\n      .map((c) => c.name)\r\n      .sort()\r\n      .join('-');\r\n  }\r\n\r\n  /**\r\n   * Potentially adds an entity to a query index, returns true if added, false if not\r\n   * @param entity\r\n   */\r\n  checkAndAdd(entity: Entity) {\r\n    if (!this.entities.includes(entity) && entity.hasAll(Array.from(this.components))) {\r\n      this.entities.push(entity);\r\n      this.entityAdded$.notifyAll(entity);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity);\r\n    if (index > -1) {\r\n      this.entities.splice(index, 1);\r\n      this.entityRemoved$.notifyAll(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity<ComponentInstance<TKnownComponentCtors>>[] {\r\n    if (sort) {\r\n      this.entities.sort(sort);\r\n    }\r\n    return this.entities;\r\n  }\r\n}\r\n","import { Observable } from '../Util/Observable';\r\nimport { Entity } from './Entity';\r\n\r\nexport class TagQuery<TKnownTags extends string = never> {\r\n  public readonly id: string;\r\n  public tags = new Set<TKnownTags>();\r\n  public entities: Entity<any>[] = [];\r\n  /**\r\n   * This fires right after the component is added\r\n   */\r\n  public entityAdded$ = new Observable<Entity<any>>();\r\n  /**\r\n   * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\r\n   */\r\n  public entityRemoved$ = new Observable<Entity<any>>();\r\n\r\n  constructor(public readonly requiredTags: TKnownTags[]) {\r\n    if (requiredTags.length === 0) {\r\n      throw new Error('Cannot create tag query without tags');\r\n    }\r\n    for (const tag of requiredTags) {\r\n      this.tags.add(tag);\r\n    }\r\n\r\n    this.id = TagQuery.createId(requiredTags);\r\n  }\r\n\r\n  static createId(requiredComponents: string[]) {\r\n    return requiredComponents.slice().sort().join('-');\r\n  }\r\n\r\n  checkAndAdd(entity: Entity) {\r\n    if (!this.entities.includes(entity) && entity.hasAllTags(Array.from(this.tags))) {\r\n      this.entities.push(entity);\r\n      this.entityAdded$.notifyAll(entity);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity);\r\n    if (index > -1) {\r\n      this.entities.splice(index, 1);\r\n      this.entityRemoved$.notifyAll(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity<any>[] {\r\n    if (sort) {\r\n      this.entities.sort(sort);\r\n    }\r\n    return this.entities;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { Query } from './Query';\r\nimport { Component, ComponentCtor } from './Component';\r\nimport { World } from './World';\r\nimport { TagQuery } from './TagQuery';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries = new Map<string, Query<any>>();\r\n  private _addComponentHandlers = new Map<Entity, (c: Component) => any>();\r\n  private _removeComponentHandlers = new Map<Entity, (c: Component) => any>();\r\n  private _componentToQueriesIndex = new Map<ComponentCtor<any>, Query<any>[]>();\r\n\r\n  private _tagQueries = new Map<string, TagQuery<any>>();\r\n  private _addTagHandlers = new Map<Entity, (tag: string) => any>();\r\n  private _removeTagHandlers = new Map<Entity, (tag: string) => any>();\r\n  private _tagToQueriesIndex = new Map<string, TagQuery<any>[]>();\r\n\r\n  constructor(private _world: World) {}\r\n\r\n  public createQuery<TKnownComponentCtors extends ComponentCtor<Component>>(\r\n    requiredComponents: TKnownComponentCtors[]\r\n  ): Query<TKnownComponentCtors> {\r\n    const id = Query.createId(requiredComponents);\r\n    if (this._queries.has(id)) {\r\n      // short circuit if query is already created\r\n      return this._queries.get(id) as Query<TKnownComponentCtors>;\r\n    }\r\n\r\n    const query = new Query(requiredComponents);\r\n\r\n    this._queries.set(query.id, query);\r\n\r\n    // index maintenance\r\n    for (const component of requiredComponents) {\r\n      const queries = this._componentToQueriesIndex.get(component);\r\n      if (!queries) {\r\n        this._componentToQueriesIndex.set(component, [query]);\r\n      } else {\r\n        queries.push(query);\r\n      }\r\n    }\r\n\r\n    for (const entity of this._world.entities) {\r\n      this.addEntity(entity);\r\n    }\r\n\r\n    return query;\r\n  }\r\n\r\n  public createTagQuery<TKnownTags extends string>(requiredTags: TKnownTags[]): TagQuery<TKnownTags> {\r\n    const id = TagQuery.createId(requiredTags);\r\n    if (this._tagQueries.has(id)) {\r\n      // short circuit if query is already created\r\n      return this._tagQueries.get(id) as TagQuery<TKnownTags>;\r\n    }\r\n\r\n    const query = new TagQuery(requiredTags);\r\n\r\n    this._tagQueries.set(query.id, query);\r\n\r\n    // index maintenance\r\n    for (const tag of requiredTags) {\r\n      const queries = this._tagToQueriesIndex.get(tag);\r\n      if (!queries) {\r\n        this._tagToQueriesIndex.set(tag, [query]);\r\n      } else {\r\n        queries.push(query);\r\n      }\r\n    }\r\n\r\n    for (const entity of this._world.entities) {\r\n      this.addEntity(entity);\r\n    }\r\n\r\n    return query;\r\n  }\r\n\r\n  private _createAddComponentHandler = (entity: Entity) => (c: Component) => {\r\n    this.addComponent(entity, c);\r\n  };\r\n\r\n  private _createRemoveComponentHandler = (entity: Entity) => (c: Component) => {\r\n    this.removeComponent(entity, c);\r\n  };\r\n\r\n  private _createAddTagHandler = (entity: Entity) => (tag: string) => {\r\n    this.addTag(entity, tag);\r\n  };\r\n\r\n  private _createRemoveTagHandler = (entity: Entity) => (tag: string) => {\r\n    this.removeTag(entity, tag);\r\n  };\r\n\r\n  /**\r\n   * Scans queries and locates any that need this entity added\r\n   * @param entity\r\n   */\r\n  addEntity(entity: Entity) {\r\n    const maybeAddComponent = this._addComponentHandlers.get(entity);\r\n    const maybeRemoveComponent = this._removeComponentHandlers.get(entity);\r\n    const addComponent = maybeAddComponent ?? this._createAddComponentHandler(entity);\r\n    const removeComponent = maybeRemoveComponent ?? this._createRemoveComponentHandler(entity);\r\n    this._addComponentHandlers.set(entity, addComponent);\r\n    this._removeComponentHandlers.set(entity, removeComponent);\r\n\r\n    const maybeAddTag = this._addTagHandlers.get(entity);\r\n    const maybeRemoveTag = this._removeTagHandlers.get(entity);\r\n    const addTag = maybeAddTag ?? this._createAddTagHandler(entity);\r\n    const removeTag = maybeRemoveTag ?? this._createRemoveTagHandler(entity);\r\n    this._addTagHandlers.set(entity, addTag);\r\n    this._removeTagHandlers.set(entity, removeTag);\r\n\r\n    for (const query of this._queries.values()) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n    for (const tagQuery of this._tagQueries.values()) {\r\n      tagQuery.checkAndAdd(entity);\r\n    }\r\n    entity.componentAdded$.subscribe(addComponent);\r\n    entity.componentRemoved$.subscribe(removeComponent);\r\n    entity.tagAdded$.subscribe(addTag);\r\n    entity.tagRemoved$.subscribe(removeTag);\r\n  }\r\n\r\n  /**\r\n   * Scans queries and locates any that need this entity removed\r\n   * @param entity\r\n   */\r\n  removeEntity(entity: Entity) {\r\n    // Handle components\r\n    const addComponent = this._addComponentHandlers.get(entity);\r\n    const removeComponent = this._removeComponentHandlers.get(entity);\r\n    for (const query of this._queries.values()) {\r\n      query.removeEntity(entity);\r\n    }\r\n    if (addComponent) {\r\n      entity.componentAdded$.unsubscribe(addComponent);\r\n    }\r\n    if (removeComponent) {\r\n      entity.componentRemoved$.unsubscribe(removeComponent);\r\n    }\r\n\r\n    // Handle tags\r\n    const addTag = this._addTagHandlers.get(entity);\r\n    const removeTag = this._removeTagHandlers.get(entity);\r\n    for (const tagQuery of this._tagQueries.values()) {\r\n      tagQuery.removeEntity(entity);\r\n    }\r\n\r\n    if (addTag) {\r\n      entity.tagAdded$.unsubscribe(addTag);\r\n    }\r\n    if (removeTag) {\r\n      entity.tagRemoved$.unsubscribe(removeTag);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is added to an entity\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  addComponent(entity: Entity, component: Component) {\r\n    const queries = this._componentToQueriesIndex.get(component.constructor as ComponentCtor<any>) ?? [];\r\n    for (const query of queries) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is removed from an entity\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  removeComponent(entity: Entity, component: Component) {\r\n    const queries = this._componentToQueriesIndex.get(component.constructor as ComponentCtor<any>) ?? [];\r\n    for (const query of queries) {\r\n      query.removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a tag is added to an entity\r\n   * @param entity\r\n   * @param tag\r\n   */\r\n  addTag(entity: Entity, tag: string) {\r\n    const queries = this._tagToQueriesIndex.get(tag) ?? [];\r\n    for (const query of queries) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is removed from an entity\r\n   * @param entity\r\n   * @param tag\r\n   */\r\n  removeTag(entity: Entity, tag: string) {\r\n    const queries = this._tagToQueriesIndex.get(tag) ?? [];\r\n    for (const query of queries) {\r\n      query.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","import { System, SystemType } from './System';\r\nimport { Scene } from '../Scene';\r\nimport { World } from './World';\r\nimport { removeItemFromArray } from '../Util/Util';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (...args: any[]): T;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isSystemConstructor(x: any): x is SystemCtor<System> {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager {\r\n  /**\r\n   * List of systems, to add a new system call {@apilink SystemManager.addSystem}\r\n   */\r\n  public systems: System[] = [];\r\n  public initialized = false;\r\n  constructor(private _world: World) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param systemOrCtor\r\n   */\r\n  public addSystem(systemOrCtor: SystemCtor<System> | System): void {\r\n    let system: System;\r\n    if (systemOrCtor instanceof System) {\r\n      system = systemOrCtor;\r\n    } else {\r\n      system = new systemOrCtor(this._world);\r\n    }\r\n\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => (a.constructor as typeof System).priority - (b.constructor as typeof System).priority);\r\n    // If systems are added and the manager has already been init'd\r\n    // then immediately init the system\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world, this._world.scene);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System) {\r\n    removeItemFromArray(system, this.systems);\r\n  }\r\n\r\n  /**\r\n   * Initialize all systems in the manager\r\n   *\r\n   * Systems added after initialize() will be initialized on add\r\n   */\r\n  public initialize() {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world, this._world.scene);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param scene context reference\r\n   * @param elapsed time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, scene: Scene, elapsed: number) {\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(scene, elapsed);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      s.update(elapsed);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(scene, elapsed);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (let i = this.systems.length - 1; i >= 0; i--) {\r\n      this.removeSystem(this.systems[i]);\r\n    }\r\n  }\r\n}\r\n","import { Scene } from '../Scene';\r\nimport { Logger } from '../Util/Log';\r\nimport { Component, ComponentCtor } from './Component';\r\nimport { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { Query } from './Query';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemCtor, SystemManager, isSystemConstructor } from './SystemManager';\r\nimport { TagQuery } from './TagQuery';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World {\r\n  private _logger = Logger.getInstance();\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager = new EntityManager(this);\r\n  public systemManager: SystemManager = new SystemManager(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param scene\r\n   */\r\n  constructor(public scene: Scene) {}\r\n\r\n  /**\r\n   * Query the ECS world for entities that match your components\r\n   * @param requiredTypes\r\n   */\r\n  query<TKnownComponentCtors extends ComponentCtor<Component>>(requiredTypes: TKnownComponentCtors[]): Query<TKnownComponentCtors> {\r\n    return this.queryManager.createQuery(requiredTypes);\r\n  }\r\n\r\n  queryTags<TKnownTags extends string>(requiredTags: TKnownTags[]): TagQuery<TKnownTags> {\r\n    return this.queryManager.createTagQuery(requiredTags);\r\n  }\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, elapsed: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.scene, elapsed);\r\n    }\r\n    this.systemManager.updateSystems(type, this.scene, elapsed);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System): void;\r\n  add(system: SystemCtor<System>): void;\r\n  add(entityOrSystem: Entity | System | SystemCtor<System>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    if (entityOrSystem instanceof System || isSystemConstructor(entityOrSystem)) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    this._logger.warn(\r\n      `Could not add entity/system ${(entityOrSystem as any).constructor.name} to Excalibur!\\n\\n` +\r\n        `If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.\\n\\n` +\r\n        `Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a system out of the ECS world\r\n   */\r\n  get(system: SystemCtor<System>) {\r\n    return this.systemManager.get(system);\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System): void;\r\n  remove(entityOrSystem: Entity | System, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n      return;\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    this._logger.warn(\r\n      `Could not remove entity/system ${(entityOrSystem as any).constructor.name} to Excalibur!\\n\\n` +\r\n        `If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.\\n\\n` +\r\n        `Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`\r\n    );\r\n  }\r\n\r\n  get entities() {\r\n    return this.entityManager.entities;\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Entity, Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\nimport { PhysicsWorld } from './PhysicsWorld';\r\n\r\nexport class MotionSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Update;\r\n  private _physicsConfigDirty = false;\r\n  query: Query<typeof TransformComponent | typeof MotionComponent>;\r\n  constructor(\r\n    public world: World,\r\n    public physics: PhysicsWorld\r\n  ) {\r\n    super();\r\n    physics.$configUpdate.subscribe(() => (this._physicsConfigDirty = true));\r\n    this.query = this.world.query([TransformComponent, MotionComponent]);\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    const entities = this.query.entities;\r\n    const substep = this.physics.config.substep;\r\n\r\n    for (let i = 0; i < entities.length; i++) {\r\n      transform = entities[i].get(TransformComponent);\r\n      motion = entities[i].get(MotionComponent);\r\n\r\n      const optionalBody = entities[i].get(BodyComponent);\r\n      if (this._physicsConfigDirty && optionalBody) {\r\n        optionalBody.updatePhysicsConfig(this.physics.config.bodies);\r\n      }\r\n\r\n      if (optionalBody?.isSleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(this.physics.config.gravity);\r\n      }\r\n\r\n      // capture old transform of this entity and all of its children so that\r\n      // any transform properties that derived from their parents are properly captured\r\n      if (!entities[i].parent) {\r\n        this.captureOldTransformWithChildren(entities[i]);\r\n      }\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsed / substep);\r\n    }\r\n    this._physicsConfigDirty = false;\r\n  }\r\n\r\n  captureOldTransformWithChildren(entity: Entity) {\r\n    entity.get(BodyComponent)?.captureOldTransform();\r\n\r\n    for (let i = 0; i < entity.children.length; i++) {\r\n      this.captureOldTransformWithChildren(entity.children[i]);\r\n    }\r\n  }\r\n}\r\n","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { ContactBias, ContactSolveBias, HorizontalFirst, None, VerticalFirst } from './ContactBias';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\nimport { DeepRequired } from '../../Util/Required';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver implements CollisionSolver {\r\n  directionMap = new Map<string, 'horizontal' | 'vertical'>();\r\n  distanceMap = new Map<string, number>();\r\n\r\n  constructor(public config: DeepRequired<Pick<PhysicsConfig, 'arcade'>['arcade']>) {}\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter((c) => !c.isCanceled());\r\n\r\n    // Locate collision bias order\r\n    let bias: ContactBias;\r\n    switch (this.config.contactSolveBias) {\r\n      case ContactSolveBias.HorizontalFirst: {\r\n        bias = HorizontalFirst;\r\n        break;\r\n      }\r\n      case ContactSolveBias.VerticalFirst: {\r\n        bias = VerticalFirst;\r\n        break;\r\n      }\r\n      default: {\r\n        bias = None;\r\n      }\r\n    }\r\n\r\n    // Sort by bias (None, VerticalFirst, HorizontalFirst) to avoid artifacts with seams\r\n    // Sort contacts by distance to avoid artifacts with seams\r\n    // It's important to solve in a specific order\r\n    contacts.sort((a, b) => {\r\n      const aDir = this.directionMap.get(a.id);\r\n      const bDir = this.directionMap.get(b.id);\r\n      const aDist = this.distanceMap.get(a.id);\r\n      const bDist = this.distanceMap.get(b.id);\r\n      return bias[aDir] - bias[bDir] || aDist - bDist;\r\n    });\r\n\r\n    for (const contact of contacts) {\r\n      // Solve position first in arcade\r\n      this.solvePosition(contact);\r\n\r\n      // Solve velocity second in arcade\r\n      this.solveVelocity(contact);\r\n    }\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    const epsilon = 0.0001;\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n        // Cancel near 0 mtv collisions\r\n        contact.cancel();\r\n        continue;\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n\r\n      const distance = Math.abs(contact.info.separation);\r\n      this.distanceMap.set(contact.id, distance);\r\n\r\n      this.directionMap.set(contact.id, side === Side.Left || side === Side.Right ? 'horizontal' : 'vertical');\r\n\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact)\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (contact.isCanceled()) {\r\n        continue;\r\n      }\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact)\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contact: CollisionContact) {\r\n    const epsilon = 0.0001;\r\n    // if bounds no longer intersect skip to the next\r\n    // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\r\n    if (!contact.colliderA.bounds.overlaps(contact.colliderB.bounds, epsilon)) {\r\n      // Cancel the contact to prevent and solving\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n      // Cancel near 0 mtv collisions\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    let mtv = contact.mtv;\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n        // split overlaps if both are Active\r\n        mtv = mtv.scale(0.5);\r\n      }\r\n\r\n      // Resolve overlaps\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        bodyA.globalPos.x -= mtv.x;\r\n        bodyA.globalPos.y -= mtv.y;\r\n        colliderA.update(bodyA.transform.get());\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        bodyB.globalPos.x += mtv.x;\r\n        bodyB.globalPos.y += mtv.y;\r\n        colliderB.update(bodyB.transform.get());\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contact: CollisionContact) {\r\n    if (contact.isCanceled()) {\r\n      return;\r\n    }\r\n\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      const normal = contact.normal;\r\n      const opposite = normal.negate();\r\n\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform when sliding off\r\n        if (bodyA.vel.normalize().dot(opposite) < 0) {\r\n          // Cancel out velocity opposite direction of collision normal\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform\r\n        if (bodyB.vel.normalize().dot(normal) < 0) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * Holds information about contact points, meant to be reused over multiple frames of contact\r\n */\r\nexport class ContactConstraintPoint {\r\n  constructor(\r\n    public point: Vector,\r\n    public local: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Updates the contact information\r\n   */\r\n  update() {\r\n    const bodyA = this.contact.bodyA;\r\n    const colliderA = this.contact.colliderA;\r\n    const bodyB = this.contact.bodyB;\r\n    const colliderB = this.contact.colliderB;\r\n\r\n    if (bodyA && bodyB) {\r\n      const normal = this.contact.normal;\r\n      const tangent = this.contact.tangent;\r\n\r\n      this.aToContact = this.point.sub(colliderA.center);\r\n      this.bToContact = this.point.sub(colliderB.center);\r\n\r\n      const aToContactNormal = this.aToContact.cross(normal);\r\n      const bToContactNormal = this.bToContact.cross(normal);\r\n\r\n      this.normalMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n      const aToContactTangent = this.aToContact.cross(tangent);\r\n      const bToContactTangent = this.bToContact.cross(tangent);\r\n\r\n      this.tangentMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns the relative velocity between bodyA and bodyB\r\n   */\r\n  public getRelativeVelocity() {\r\n    const bodyA = this.contact.bodyA;\r\n    const bodyB = this.contact.bodyB;\r\n    if (bodyA && bodyB) {\r\n      // Relative velocity in linear terms\r\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\r\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\r\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\r\n      return velB.sub(velA);\r\n    }\r\n    return Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Impulse accumulated over time in normal direction\r\n   */\r\n  public normalImpulse: number = 0;\r\n\r\n  /**\r\n   * Impulse accumulated over time in the tangent direction\r\n   */\r\n  public tangentImpulse: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the normal direction\r\n   */\r\n  public normalMass: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the tangent direction\r\n   */\r\n  public tangentMass: number = 0;\r\n\r\n  /**\r\n   * Direction from center of mass of bodyA to contact point\r\n   */\r\n  public aToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Direction from center of mass of bodyB to contact point\r\n   */\r\n  public bToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Original contact velocity combined with bounciness\r\n   */\r\n  public originalVelocityAndRestitution: number = 0;\r\n}\r\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Math/util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { DegreeOfFreedom } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\nimport { DeepRequired } from '../../Util/Required';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\nimport { ContactBias, ContactSolveBias, HorizontalFirst, None, VerticalFirst } from './ContactBias';\r\n\r\nexport class RealisticSolver implements CollisionSolver {\r\n  directionMap = new Map<string, 'horizontal' | 'vertical'>();\r\n  distanceMap = new Map<string, number>();\r\n\r\n  constructor(public config: DeepRequired<Pick<PhysicsConfig, 'realistic'>['realistic']>) {}\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter((c) => !c.isCanceled());\r\n    // Locate collision bias order\r\n    let bias: ContactBias;\r\n    switch (this.config.contactSolveBias) {\r\n      case ContactSolveBias.HorizontalFirst: {\r\n        bias = HorizontalFirst;\r\n        break;\r\n      }\r\n      case ContactSolveBias.VerticalFirst: {\r\n        bias = VerticalFirst;\r\n        break;\r\n      }\r\n      default: {\r\n        bias = None;\r\n      }\r\n    }\r\n\r\n    // Sort by bias (None, VerticalFirst, HorizontalFirst) to avoid artifacts with seams\r\n    // Sort contacts by distance to avoid artifacts with seams\r\n    // It's important to solve in a specific order\r\n    contacts.sort((a, b) => {\r\n      const aDir = this.directionMap.get(a.id);\r\n      const bDir = this.directionMap.get(b.id);\r\n      const aDist = this.distanceMap.get(a.id);\r\n      const bDist = this.distanceMap.get(b.id);\r\n      return bias[aDir] - bias[bDir] || aDist - bDist;\r\n    });\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    const epsilon = 0.0001;\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n        // Cancel near 0 mtv collisions\r\n        contact.cancel();\r\n        continue;\r\n      }\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const distance = Math.abs(contact?.info?.separation || 0);\r\n\r\n      this.distanceMap.set(contact.id, distance);\r\n      this.directionMap.set(contact.id, side === Side.Left || side === Side.Right ? 'horizontal' : 'vertical');\r\n\r\n      contact.colliderA.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact)\r\n      );\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact)\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.bodyA;\r\n      const colliderA = contact.colliderA;\r\n      const bodyB = contact.bodyB;\r\n      const colliderB = contact.colliderB;\r\n      if (bodyA && bodyB) {\r\n        for (let j = 0; j < contact.points.length; j++) {\r\n          const point = contact.points[j];\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(colliderA.center);\r\n          const bToContact = point.sub(colliderB.center);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = 1.0 / normalMass;\r\n          contactPoints[pointIndex].tangentMass = 1.0 / tangentMass;\r\n\r\n          // Calculate relative velocity before solving to accurately do restitution\r\n          const restitution = bodyA.bounciness > bodyB.bounciness ? bodyA.bounciness : bodyB.bounciness;\r\n          const relativeVelocity = contact.normal.dot(contactPoints[pointIndex].getRelativeVelocity());\r\n          contactPoints[pointIndex].originalVelocityAndRestitution = 0;\r\n          if (relativeVelocity < -0.1) {\r\n            // TODO what's a good threshold here?\r\n            contactPoints[pointIndex].originalVelocityAndRestitution = -restitution * relativeVelocity;\r\n          }\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (this.config.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      const bodyA = contact.bodyA;\r\n      const bodyB = contact.bodyB;\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact)\r\n      );\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact)\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const c = contacts[i];\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      const bodyA = contact.bodyA;\r\n      const bodyB = contact.bodyB;\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (this.config.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < this.config.positionIterations; i++) {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const bodyA = contact.bodyA;\r\n        const bodyB = contact.bodyB;\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = this.config.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = this.config.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce * point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              // TODO make applyPseudoImpulse function?\r\n              const impulseForce = impulse.negate().scale(bodyA.inverseMass);\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyA.globalPos = bodyA.globalPos.add(impulseForce);\r\n              if (!bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n              }\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              const impulseForce = impulse.scale(bodyB.inverseMass);\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyB.globalPos = bodyB.globalPos.add(impulseForce);\r\n              if (!bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < this.config.velocityIterations; i++) {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const bodyA = contact.bodyA;\r\n        const bodyB = contact.bodyB;\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          // Friction constraint\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity * point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          // Bounce constraint\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n\r\n            // Per Erin it is a mistake to apply the restitution inside the iteration\r\n            // From Erin Catto's Box2D we keep original contact velocity and adjust by small impulses\r\n            let impulseDelta = -point.normalMass * (normalVelocity - point.originalVelocityAndRestitution);\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ComponentCtor, Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { SolverStrategy } from './SolverStrategy';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine } from '../Engine';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { Side } from '../Collision/Side';\r\nimport { PhysicsWorld } from './PhysicsWorld';\r\nimport { CollisionProcessor } from './Detection/CollisionProcessor';\r\nimport { SeparatingAxis } from './Colliders/SeparatingAxis';\r\nimport { MotionSystem } from './MotionSystem';\r\nimport { Pair } from './Detection/Pair';\r\nexport class CollisionSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Update;\r\n  public query: Query<ComponentCtor<TransformComponent> | ComponentCtor<MotionComponent> | ComponentCtor<ColliderComponent>>;\r\n\r\n  private _engine: Engine;\r\n  private _configDirty = false;\r\n  private _realisticSolver: RealisticSolver;\r\n  private _arcadeSolver: ArcadeSolver;\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n  private _motionSystem: MotionSystem;\r\n  private get _processor(): CollisionProcessor {\r\n    return this._physics.collisionProcessor;\r\n  }\r\n\r\n  private _trackCollider: (c: Collider) => void;\r\n  private _untrackCollider: (c: Collider) => void;\r\n\r\n  constructor(\r\n    world: World,\r\n    private _physics: PhysicsWorld\r\n  ) {\r\n    super();\r\n    this._arcadeSolver = new ArcadeSolver(_physics.config.arcade);\r\n    this._realisticSolver = new RealisticSolver(_physics.config.realistic);\r\n    this._physics.$configUpdate.subscribe(() => (this._configDirty = true));\r\n    this._trackCollider = (c: Collider) => this._processor.track(c);\r\n    this._untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n    this.query = world.query([TransformComponent, MotionComponent, ColliderComponent]);\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const colliderComponent = e.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    });\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const colliderComponent = e.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    });\r\n    this._motionSystem = world.get(MotionSystem) as MotionSystem;\r\n  }\r\n\r\n  initialize(world: World, scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._physics.config.enabled) {\r\n      return;\r\n    }\r\n\r\n    // TODO do we need to do this every frame?\r\n    // Collect up all the colliders and update them\r\n    let colliders: Collider[] = [];\r\n    for (let entityIndex = 0; entityIndex < this.query.entities.length; entityIndex++) {\r\n      const entity = this.query.entities[entityIndex];\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.isActive && collider) {\r\n        colliderComp.update();\r\n\r\n        // Flatten composite colliders\r\n        if (collider instanceof CompositeCollider) {\r\n          const compositeColliders = collider.getColliders();\r\n          if (!collider.compositeStrategy) {\r\n            collider.compositeStrategy = this._physics.config.colliders.compositeStrategy;\r\n          }\r\n          colliders = colliders.concat(compositeColliders);\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders, elapsed);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    let pairs = this._processor.broadphase(colliders, elapsed);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts: CollisionContact[] = []; // = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities aren't overlapping\r\n    const substep = this._physics.config.substep;\r\n    for (let step = 0; step < substep; step++) {\r\n      if (step > 0) {\r\n        // first step is run by the MotionSystem when configured, so skip\r\n        this._motionSystem.update(elapsed);\r\n      }\r\n      // Re-use pairs from previous collision\r\n      if (contacts.length) {\r\n        pairs = contacts.map((c) => new Pair(c.colliderA, c.colliderB));\r\n      }\r\n\r\n      if (pairs.length) {\r\n        contacts = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\r\n        contacts = solver.solve(contacts);\r\n\r\n        // Record contacts for start/end\r\n        for (const contact of contacts) {\r\n          if (contact.isCanceled()) {\r\n            continue;\r\n          }\r\n          // Process composite ids, things with the same composite id are treated as the same collider for start/end\r\n          const index = contact.id.indexOf('|');\r\n          if (index > 0) {\r\n            const compositeId = contact.id.substring(index + 1);\r\n            this._currentFrameContacts.set(compositeId, contact);\r\n          } else {\r\n            this._currentFrameContacts.set(contact.id, contact);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n\r\n    // Process deferred collider removals\r\n    for (const entity of this.query.entities) {\r\n      const collider = entity.get(ColliderComponent);\r\n      if (collider) {\r\n        collider.processColliderRemoval();\r\n      }\r\n    }\r\n  }\r\n\r\n  postupdate(): void {\r\n    SeparatingAxis.SeparationPool.done();\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    if (this._configDirty) {\r\n      this._configDirty = false;\r\n      this._arcadeSolver = new ArcadeSolver(this._physics.config.arcade);\r\n      this._realisticSolver = new RealisticSolver(this._physics.config.realistic);\r\n    }\r\n    return this._physics.config.solver === SolverStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex, 0);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    // If composite colliders are 'together' collisions may have a duplicate id because we want to treat those as a singular start/end\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        const side = Side.fromDirection(c.mtv);\r\n        const opposite = Side.getOpposite(side);\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, side, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, side, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, opposite, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, opposite, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts that have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        const side = Side.fromDirection(c.mtv);\r\n        const opposite = Side.getOpposite(side);\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB, side, c));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB, side, c) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA, opposite, c));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA, opposite, c) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Transform } from '../Math/transform';\r\n\r\n/**\r\n * Blend 2 transforms for interpolation, will interpolate from the context of newTx's parent if it exists\r\n */\r\nexport function blendTransform(oldTx: Transform, newTx: Transform, blend: number, target?: Transform): Transform {\r\n  if (oldTx.parent !== newTx.parent) {\r\n    // Caller expects a local transform\r\n    // Adjust old tx to be local to the new parent whatever that is\r\n    const oldTxWithNewParent = oldTx.clone();\r\n    const oldGlobalPos = oldTx.globalPos.clone();\r\n    const oldGlobalScale = oldTx.globalScale.clone();\r\n    const oldGlobalRotation = oldTx.globalRotation;\r\n    oldTxWithNewParent.parent = newTx.parent;\r\n    oldTxWithNewParent.globalPos = oldGlobalPos;\r\n    oldTxWithNewParent.globalScale = oldGlobalScale;\r\n    oldTxWithNewParent.globalRotation = oldGlobalRotation;\r\n    oldTx = oldTxWithNewParent;\r\n  }\r\n  let interpolatedPos = newTx.pos;\r\n  let interpolatedScale = newTx.scale;\r\n  let interpolatedRotation = newTx.rotation;\r\n\r\n  interpolatedPos = newTx.pos.scale(blend).add(oldTx.pos.scale(1.0 - blend));\r\n  interpolatedScale = newTx.scale.scale(blend).add(oldTx.scale.scale(1.0 - blend));\r\n  // Rotational lerp https://stackoverflow.com/a/30129248\r\n  const cosine = (1.0 - blend) * Math.cos(oldTx.rotation) + blend * Math.cos(newTx.rotation);\r\n  const sine = (1.0 - blend) * Math.sin(oldTx.rotation) + blend * Math.sin(newTx.rotation);\r\n  interpolatedRotation = Math.atan2(sine, cosine);\r\n\r\n  const tx = target ?? new Transform();\r\n  tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\r\n  return tx;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function blendGlobalTransform(oldTx: Transform, newTx: Transform, blend: number, target?: Transform): Transform {\r\n  let interpolatedPos = newTx.globalPos;\r\n  let interpolatedScale = newTx.globalScale;\r\n  let interpolatedRotation = newTx.globalRotation;\r\n\r\n  interpolatedPos = newTx.globalPos.scale(blend).add(oldTx.globalPos.scale(1.0 - blend));\r\n  interpolatedScale = newTx.globalScale.scale(blend).add(oldTx.globalScale.scale(1.0 - blend));\r\n  // Rotational lerp https://stackoverflow.com/a/30129248\r\n  const cosine = (1.0 - blend) * Math.cos(oldTx.globalRotation) + blend * Math.cos(newTx.globalRotation);\r\n  const sine = (1.0 - blend) * Math.sin(oldTx.globalRotation) + blend * Math.sin(newTx.globalRotation);\r\n  interpolatedRotation = Math.atan2(sine, cosine);\r\n\r\n  const tx = target ?? new Transform();\r\n  tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\r\n  return tx;\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { Query, System, SystemPriority, SystemType, World } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsGroup } from './GraphicsGroup';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { FontCache } from './FontCache';\r\nimport { PostDrawEvent, PostTransformDrawEvent, PreDrawEvent, PreTransformDrawEvent } from '../Events';\r\nimport { Transform } from '../Math/transform';\r\nimport { blendTransform } from './TransformInterpolation';\r\nimport { Graphic } from './Graphic';\r\n\r\nexport class GraphicsSystem extends System {\r\n  static priority = SystemPriority.Average;\r\n\r\n  public readonly systemType = SystemType.Draw;\r\n  private _token = 0;\r\n  // Set in the initialize\r\n  private _graphicsContext!: ExcaliburGraphicsContext;\r\n  private _camera!: Camera;\r\n  private _engine!: Engine;\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  query: Query<typeof TransformComponent | typeof GraphicsComponent>;\r\n  public get sortedTransforms() {\r\n    return this._sortedTransforms;\r\n  }\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, GraphicsComponent]);\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      this._sortedTransforms.push(tx);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    });\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    // Graphics context could be switched to fallback in a new frame\r\n    this._graphicsContext = this._engine.graphicsContext;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return a.globalZ - b.globalZ;\r\n      });\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._token++;\r\n    let graphics: GraphicsComponent;\r\n    FontCache.checkAndClearCache();\r\n\r\n    // This is a performance enhancement, most things are in world space\r\n    // so if we can only do this once saves a ton of transform updates\r\n    this._graphicsContext.save();\r\n    if (this._camera) {\r\n      this._camera.draw(this._graphicsContext);\r\n    }\r\n    for (let transformIndex = 0; transformIndex < this._sortedTransforms.length; transformIndex++) {\r\n      const transform = this._sortedTransforms[transformIndex];\r\n      const entity = transform.owner as Entity;\r\n\r\n      // If the entity is offscreen skip\r\n      if (entity.hasTag('ex.offscreen')) {\r\n        continue;\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      // Exit if graphics set to not visible\r\n      if (!graphics.isVisible) {\r\n        continue;\r\n      }\r\n\r\n      // Optionally run the onPreTransformDraw graphics lifecycle draw\r\n      if (graphics.onPreTransformDraw) {\r\n        graphics.onPreTransformDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('pretransformdraw', new PreTransformDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.restore();\r\n      }\r\n\r\n      this._graphicsContext.save();\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(elapsed, this._token);\r\n\r\n      // Apply parallax\r\n      const parallax = entity.get(ParallaxComponent);\r\n      if (parallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(parallax.parallaxFactor);\r\n        const parallaxOffset = this._camera.drawPos.scale(oneMinusFactor);\r\n        this._graphicsContext.translate(parallaxOffset.x, parallaxOffset.y);\r\n      }\r\n\r\n      // Position the entity + estimate lag\r\n      this._applyTransform(entity);\r\n\r\n      // If there is a material enable it on the context\r\n      if (graphics.material) {\r\n        this._graphicsContext.material = graphics.material;\r\n      }\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('predraw', new PreDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      // this._graphicsContext.opacity *= graphics.opacity;\r\n      this._applyOpacity(entity);\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics, transform);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('postdraw', new PostDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original world space\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.save();\r\n        if (this._camera) {\r\n          this._camera.draw(this._graphicsContext);\r\n        }\r\n      }\r\n\r\n      // Optionally run the onPreTransformDraw graphics lifecycle draw\r\n      if (graphics.onPostTransformDraw) {\r\n        graphics.onPostTransformDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('posttransformdraw', new PostTransformDrawEvent(this._graphicsContext, elapsed, entity));\r\n    }\r\n    this._graphicsContext.restore();\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent, transformComponent: TransformComponent) {\r\n    if (graphicsComponent.isVisible) {\r\n      const flipHorizontal = graphicsComponent.flipHorizontal;\r\n      const flipVertical = graphicsComponent.flipVertical;\r\n\r\n      const graphic = graphicsComponent.current;\r\n      const options = graphicsComponent.currentOptions ?? {};\r\n\r\n      if (graphic) {\r\n        let anchor = graphicsComponent.anchor;\r\n        let offset = graphicsComponent.offset;\r\n        let scaleX = 1;\r\n        let scaleY = 1;\r\n        // handle specific overrides\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const globalScale = transformComponent.globalScale;\r\n        scaleX *= graphic.scale.x * globalScale.x;\r\n        scaleY *= graphic.scale.y * globalScale.y;\r\n\r\n        // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n        const offsetX = -graphic.width * anchor.x + offset.x * scaleX;\r\n        const offsetY = -graphic.height * anchor.y + offset.y * scaleY;\r\n\r\n        const oldFlipHorizontal = graphic.flipHorizontal;\r\n        const oldFlipVertical = graphic.flipVertical;\r\n        if (flipHorizontal || flipVertical) {\r\n          // flip any currently flipped graphics\r\n          graphic.flipHorizontal = flipHorizontal ? !oldFlipHorizontal : oldFlipHorizontal;\r\n          graphic.flipVertical = flipVertical ? !oldFlipVertical : oldFlipVertical;\r\n        }\r\n\r\n        graphic?.draw(this._graphicsContext, offsetX, offsetY);\r\n\r\n        if (flipHorizontal || flipVertical) {\r\n          graphic.flipHorizontal = oldFlipHorizontal;\r\n          graphic.flipVertical = oldFlipVertical;\r\n        }\r\n\r\n        // TODO move debug code out?\r\n        if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n          const offset = vec(offsetX, offsetY);\r\n          if (graphic instanceof GraphicsGroup) {\r\n            for (const member of graphic.members) {\r\n              let g: Graphic;\r\n              let pos: Vector = Vector.Zero;\r\n              if (member instanceof Graphic) {\r\n                g = member;\r\n              } else {\r\n                g = member.graphic;\r\n                pos = member.offset;\r\n              }\r\n\r\n              if (graphic.useAnchor) {\r\n                g?.localBounds.translate(offset.add(pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              } else {\r\n                g?.localBounds.translate(pos).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            }\r\n          } else {\r\n            /* istanbul ignore next */\r\n            graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _targetInterpolationTransform = new Transform();\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (let i = 0; i < ancestors.length; i++) {\r\n      const ancestor = ancestors[i];\r\n      const transform = ancestor?.get(TransformComponent);\r\n      const optionalBody = ancestor?.get(BodyComponent);\r\n      if (transform) {\r\n        let tx = transform.get();\r\n        if (optionalBody) {\r\n          if (this._engine.fixedUpdateTimestep && optionalBody.__oldTransformCaptured && optionalBody.enableFixedUpdateInterpolate) {\r\n            // Interpolate graphics if needed\r\n            const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\r\n            tx = blendTransform(optionalBody.oldTransform, transform.get(), blend, this._targetInterpolationTransform);\r\n          }\r\n        }\r\n        this._graphicsContext.z = transform.globalZ;\r\n        this._graphicsContext.translate(tx.pos.x, tx.pos.y);\r\n        this._graphicsContext.scale(tx.scale.x, tx.scale.y);\r\n        this._graphicsContext.rotate(tx.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _applyOpacity(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (let i = 0; i < ancestors.length; i++) {\r\n      const ancestor = ancestors[i];\r\n      const maybeGraphics = ancestor?.get(GraphicsComponent);\r\n      this._graphicsContext.opacity *= maybeGraphics?.opacity ?? 1;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Entity, Query, SystemPriority, TransformComponent, World } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { toDegrees } from '../Math/util';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { CollisionSystem } from '../Collision/CollisionSystem';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Particle } from '../Particles/Particles';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { Debug } from '../Graphics/Debug';\r\n\r\nexport class DebugSystem extends System {\r\n  static priority = SystemPriority.Lowest;\r\n\r\n  public readonly systemType = SystemType.Draw;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n  query: Query<typeof TransformComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent]);\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let debugDraw: DebugGraphicsComponent;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n      if (tx.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n      this._graphicsContext.z = txSettings.debugZIndex;\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\r\n        }\r\n        if (txSettings.showAll || txSettings.showPositionLabel) {\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n        if (txSettings.showAll || txSettings.showZIndex) {\r\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${entity.parent ? 'child of id(' + entity.parent?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      debugDraw = entity.get(DebugGraphicsComponent);\r\n      if (debugDraw) {\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.restore();\r\n        }\r\n        debugDraw.draw(this._graphicsContext, this._engine.debug);\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.save();\r\n          this._applyTransform(entity);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.isSleeping : 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // World space\r\n      this._graphicsContext.save();\r\n      if (tx.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n      this._graphicsContext.z = txSettings.debugZIndex;\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor, {\r\n            lineWidth: colliderSettings.geometryLineWidth,\r\n            pointSize: colliderSettings.geometryPointSize\r\n          });\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, {\r\n              size: physicsSettings.contactSize,\r\n              color: physicsSettings.collisionContactColor\r\n            });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  postupdate(engine: Scene<unknown>, elapsed: number): void {\r\n    if (this._engine.isDebug) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n      Debug.flush(this._graphicsContext);\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nexport class HashGridProxy<T extends { bounds: BoundingBox }> {\r\n  id: number = -1;\r\n  /**\r\n   * left bounds x hash coordinate\r\n   */\r\n  leftX: number;\r\n  /**\r\n   * right bounds x hash coordinate\r\n   */\r\n  rightX: number;\r\n  /**\r\n   * bottom bounds y hash coordinate\r\n   */\r\n  bottomY: number;\r\n  /**\r\n   * top bounds y hash coordinate\r\n   */\r\n  topY: number;\r\n\r\n  bounds: BoundingBox;\r\n\r\n  cells: HashGridCell<T>[] = [];\r\n  hasZeroBounds = false;\r\n  /**\r\n   * Grid size in pixels\r\n   */\r\n  readonly gridSize: number;\r\n  constructor(\r\n    public object: T,\r\n    gridSize: number\r\n  ) {\r\n    this.gridSize = gridSize;\r\n    this.bounds = object.bounds;\r\n    this.hasZeroBounds = this.bounds.hasZeroDimensions();\r\n    this.leftX = Math.floor(this.bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(this.bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(this.bounds.top / this.gridSize);\r\n  }\r\n\r\n  /**\r\n   * Has the hashed bounds changed\r\n   */\r\n  hasChanged(): boolean {\r\n    const bounds = this.object.bounds;\r\n    const leftX = Math.floor(bounds.left / this.gridSize);\r\n    const rightX = Math.floor(bounds.right / this.gridSize);\r\n    const bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n    const topY = Math.floor(bounds.top / this.gridSize);\r\n    if (this.leftX !== leftX || this.rightX !== rightX || this.bottomY !== bottomY || this.topY !== topY) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Clears all collider references\r\n   */\r\n  clear(): void {\r\n    for (const cell of this.cells) {\r\n      const index = cell.proxies.indexOf(this);\r\n      if (index > -1) {\r\n        cell.proxies.splice(index, 1);\r\n      }\r\n      // TODO reclaim cell in pool if empty?\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update bounds of the proxy\r\n   */\r\n  updateBounds(): void {\r\n    this.bounds = this.object.bounds;\r\n  }\r\n\r\n  /**\r\n   * Updates the hashed bounds coordinates\r\n   */\r\n  update(): void {\r\n    this.bounds = this.object.bounds;\r\n\r\n    this.leftX = Math.floor(this.bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(this.bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(this.bounds.top / this.gridSize);\r\n    this.hasZeroBounds = this.object.bounds.hasZeroDimensions();\r\n  }\r\n}\r\n\r\nexport class HashGridCell<TObject extends { bounds: BoundingBox }, TProxy extends HashGridProxy<TObject> = HashGridProxy<TObject>> {\r\n  proxies: TProxy[] = [];\r\n  key: string;\r\n  x: number;\r\n  y: number;\r\n\r\n  configure(x: number, y: number) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.key = HashGridCell.calculateHashKey(x, y);\r\n  }\r\n\r\n  static calculateHashKey(x: number, y: number) {\r\n    return `${x}+${y}`;\r\n  }\r\n}\r\n\r\nexport class SparseHashGrid<TObject extends { bounds: BoundingBox }, TProxy extends HashGridProxy<TObject> = HashGridProxy<TObject>> {\r\n  readonly gridSize: number;\r\n  readonly sparseHashGrid: Map<string, HashGridCell<TObject, TProxy>>;\r\n  readonly objectToProxy: Map<TObject, TProxy>;\r\n\r\n  public bounds = new BoundingBox();\r\n\r\n  private _hashGridCellPool = new RentalPool<HashGridCell<TObject, TProxy>>(\r\n    () => new HashGridCell(),\r\n    (instance) => {\r\n      instance.configure(0, 0);\r\n      instance.proxies.length = 0;\r\n      return instance;\r\n    },\r\n    1000\r\n  );\r\n\r\n  private _buildProxy: (object: TObject) => TProxy;\r\n\r\n  constructor(options: { size: number; proxyFactory?: (object: TObject, gridSize: number) => TProxy }) {\r\n    this.gridSize = options.size;\r\n    this.sparseHashGrid = new Map<string, HashGridCell<TObject, TProxy>>();\r\n    this.objectToProxy = new Map<TObject, TProxy>();\r\n    if (options.proxyFactory) {\r\n      this._buildProxy = (object: TObject) => options.proxyFactory(object, this.gridSize);\r\n    } else {\r\n      this._buildProxy = (object: TObject) => new HashGridProxy(object, this.gridSize) as TProxy;\r\n    }\r\n\r\n    // TODO dynamic grid size potentially larger than the largest collider\r\n    // TODO Re-hash the objects if the median proves to be different\r\n  }\r\n\r\n  query(point: Vector): TObject[];\r\n  query(bounds: BoundingBox): TObject[];\r\n  query(boundsOrPoint: BoundingBox | Vector): TObject[] {\r\n    const results = new Set<TObject>();\r\n    if (boundsOrPoint instanceof BoundingBox) {\r\n      const bounds = boundsOrPoint;\r\n      const leftX = Math.floor(bounds.left / this.gridSize);\r\n      const rightX = Math.floor(bounds.right / this.gridSize);\r\n      const bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n      const topY = Math.floor(bounds.top / this.gridSize);\r\n      for (let x = leftX; x <= rightX; x++) {\r\n        for (let y = topY; y <= bottomY; y++) {\r\n          const key = HashGridCell.calculateHashKey(x, y);\r\n          // Hash bounds into appropriate cell\r\n          const cell = this.sparseHashGrid.get(key);\r\n          if (cell) {\r\n            for (let i = 0; i < cell.proxies.length; i++) {\r\n              cell.proxies[i].updateBounds();\r\n              if (cell.proxies[i].bounds.intersect(bounds)) {\r\n                results.add(cell.proxies[i].object);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      const point = boundsOrPoint;\r\n      const key = HashGridCell.calculateHashKey(Math.floor(point.x / this.gridSize), Math.floor(point.y / this.gridSize));\r\n      // Hash points into appropriate cell\r\n      const cell = this.sparseHashGrid.get(key);\r\n      if (cell) {\r\n        for (let i = 0; i < cell.proxies.length; i++) {\r\n          cell.proxies[i].updateBounds();\r\n          if (cell.proxies[i].bounds.contains(point)) {\r\n            results.add(cell.proxies[i].object);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return Array.from(results);\r\n  }\r\n\r\n  get(xCoord: number, yCoord: number): HashGridCell<TObject> {\r\n    const key = HashGridCell.calculateHashKey(xCoord, yCoord);\r\n    const cell = this.sparseHashGrid.get(key);\r\n    return cell;\r\n  }\r\n\r\n  private _insert(x: number, y: number, proxy: TProxy): void {\r\n    const key = HashGridCell.calculateHashKey(x, y);\r\n    // Hash collider into appropriate cell\r\n    let cell = this.sparseHashGrid.get(key);\r\n    if (!cell) {\r\n      cell = this._hashGridCellPool.rent();\r\n      cell.configure(x, y);\r\n      this.sparseHashGrid.set(cell.key, cell);\r\n    }\r\n    cell.proxies.push(proxy);\r\n    proxy.cells.push(cell); // TODO dupes, doesn't seem to be a problem\r\n    this.bounds.combine(proxy.bounds, this.bounds);\r\n  }\r\n\r\n  private _remove(x: number, y: number, proxy: TProxy): void {\r\n    const key = HashGridCell.calculateHashKey(x, y);\r\n    // Hash collider into appropriate cell\r\n    const cell = this.sparseHashGrid.get(key);\r\n    if (cell) {\r\n      const proxyIndex = cell.proxies.indexOf(proxy);\r\n      if (proxyIndex > -1) {\r\n        cell.proxies.splice(proxyIndex, 1);\r\n      }\r\n      const cellIndex = proxy.cells.indexOf(cell);\r\n      if (cellIndex > -1) {\r\n        proxy.cells.splice(cellIndex, 1);\r\n      }\r\n      if (cell.proxies.length === 0) {\r\n        this._hashGridCellPool.return(cell);\r\n        this.sparseHashGrid.delete(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  track(target: TObject): void {\r\n    const proxy = this._buildProxy(target);\r\n    this.objectToProxy.set(target, proxy);\r\n    for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n      for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n        this._insert(x, y, proxy);\r\n      }\r\n    }\r\n  }\r\n\r\n  untrack(target: TObject): void {\r\n    const proxy = this.objectToProxy.get(target);\r\n    if (proxy) {\r\n      proxy.clear();\r\n      this.objectToProxy.delete(target);\r\n    }\r\n  }\r\n\r\n  update(targets: TObject[]): number {\r\n    let updated = 0;\r\n    // FIXME resetting bounds is wrong, if nothing has updated then\r\n    // the bounds stay 0\r\n    // this.bounds.reset();\r\n    for (const target of targets) {\r\n      const proxy = this.objectToProxy.get(target);\r\n      if (!proxy) {\r\n        continue;\r\n      }\r\n      if (proxy.hasChanged()) {\r\n        // TODO slightly wasteful only remove from changed\r\n        for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n          for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n            this._remove(x, y, proxy);\r\n          }\r\n        }\r\n        proxy.update();\r\n        // TODO slightly wasteful only add new\r\n        for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n          for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n            this._insert(x, y, proxy);\r\n          }\r\n        }\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext, elapsed: number): void {\r\n    const transparent = Color.Transparent;\r\n    const color = Color.White;\r\n    for (const cell of this.sparseHashGrid.values()) {\r\n      ex.drawRectangle(vec(cell.x * this.gridSize, cell.y * this.gridSize), this.gridSize, this.gridSize, transparent, color, 2);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { System, TransformComponent, SystemType, Entity, World, Query, SystemPriority } from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Scene } from '../Scene';\r\nimport { PointerComponent } from './PointerComponent';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { SparseHashGrid } from '../Collision/Detection/SparseHashGrid';\r\nimport { PointerEventsToObjectDispatcher } from './PointerEventsToObjectDispatcher';\r\n\r\n/**\r\n * The PointerSystem is responsible for dispatching pointer events to entities\r\n * that need them.\r\n *\r\n * The PointerSystem can be optionally configured by the {@apilink PointerComponent}, by default Entities use\r\n * the {@apilink Collider}'s shape for pointer events.\r\n */\r\nexport class PointerSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public readonly systemType = SystemType.Update;\r\n\r\n  private _engine: Engine;\r\n  private _receivers: PointerEventReceiver[];\r\n  private _engineReceiver: PointerEventReceiver;\r\n  private _graphicsHashGrid = new SparseHashGrid<GraphicsComponent>({ size: 100 });\r\n  private _graphics: GraphicsComponent[] = [];\r\n  private _entityToPointer = new Map<Entity, PointerComponent>();\r\n  private _pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n  query: Query<typeof TransformComponent | typeof PointerComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, PointerComponent]);\r\n\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      const pointer = e.get(PointerComponent);\r\n      this._pointerEventDispatcher.addObject(\r\n        e,\r\n        (pos) => {\r\n          // If pointer bounds defined\r\n          if (pointer && pointer.localBounds) {\r\n            const pointerBounds = pointer.localBounds.transform(tx.get().matrix);\r\n            return pointerBounds.contains(tx.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos);\r\n          }\r\n          return false;\r\n        },\r\n        () => e.isActive\r\n      );\r\n      this._entityToPointer.set(e, pointer);\r\n      const maybeGfx = e.get(GraphicsComponent);\r\n      if (maybeGfx) {\r\n        this._graphics.push(maybeGfx);\r\n        this._graphicsHashGrid.track(maybeGfx);\r\n      }\r\n      this._sortedTransforms.push(tx);\r\n      this._sortedEntities.push(tx.owner);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    });\r\n\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      this._pointerEventDispatcher.removeObject(e);\r\n      const tx = e.get(TransformComponent);\r\n      this._entityToPointer.delete(e);\r\n      const maybeGfx = e.get(GraphicsComponent);\r\n      if (maybeGfx) {\r\n        const index = this._graphics.indexOf(maybeGfx);\r\n        if (index > -1) {\r\n          this._graphics.splice(index, 1);\r\n        }\r\n        this._graphicsHashGrid.untrack(maybeGfx);\r\n      }\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n        this._sortedEntities.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseColliderShape = false;\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseGraphicsBounds = false;\r\n\r\n  private _scene: Scene<unknown>;\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._engine = scene.engine;\r\n    this._scene = scene;\r\n  }\r\n\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  private _sortedEntities: Entity[] = [];\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    if (this._scene.camera.hasChanged()) {\r\n      // if the camera has changed we want to force a transform update so pointers can be correctly calc'd\r\n      this._scene.camera.updateTransform(this._scene.camera.pos);\r\n    }\r\n\r\n    // event receiver might change per frame\r\n    this._receivers = [this._engine.input.pointers, this._scene.input.pointers];\r\n    this._engineReceiver = this._engine.input.pointers;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return b.z - a.z;\r\n      });\r\n      this._sortedEntities = this._sortedTransforms.map((t) => t.owner);\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public update(): void {\r\n    // Update graphics\r\n    this._graphicsHashGrid.update(this._graphics);\r\n\r\n    // Locate all the pointer/entity mappings\r\n    for (const [pointerId, pos] of this._engineReceiver.currentFramePointerCoords.entries()) {\r\n      const colliders = this._scene.physics.query(pos.worldPos);\r\n      for (let i = 0; i < colliders.length; i++) {\r\n        const collider = colliders[i];\r\n        const maybePointer = this._entityToPointer.get(collider.owner);\r\n        if (maybePointer && (maybePointer.useColliderShape || this.overrideUseColliderShape)) {\r\n          this._pointerEventDispatcher.addPointerToObject(collider.owner, pointerId);\r\n        }\r\n      }\r\n\r\n      const graphics = this._graphicsHashGrid.query(pos.worldPos);\r\n      for (let i = 0; i < graphics.length; i++) {\r\n        const graphic = graphics[i];\r\n        const maybePointer = this._entityToPointer.get(graphic.owner);\r\n        if (maybePointer && (maybePointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\r\n          this._pointerEventDispatcher.addPointerToObject(graphic.owner, pointerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._pointerEventDispatcher.processPointerToObject(this._engineReceiver, this._sortedEntities);\r\n\r\n    // Dispatch pointer events on entities\r\n    this._pointerEventDispatcher.dispatchEvents(this._engineReceiver, this._sortedEntities);\r\n\r\n    // Dispatch pointer events on top level pointers\r\n    this._receivers.forEach((r) => r.update());\r\n\r\n    // Clear last frame's events\r\n    this._pointerEventDispatcher.clear();\r\n\r\n    this._receivers.forEach((r) => r.clear());\r\n  }\r\n}\r\n","import { Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\nexport class ActionsSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  systemType = SystemType.Update;\r\n  private _actions: ActionsComponent[] = [];\r\n  query: Query<typeof ActionsComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([ActionsComponent]);\r\n\r\n    this.query.entityAdded$.subscribe((e) => this._actions.push(e.get(ActionsComponent)));\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const action = e.get(ActionsComponent);\r\n      const index = this._actions.indexOf(action);\r\n      if (index > -1) {\r\n        this._actions.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n  update(elapsed: number): void {\r\n    for (let i = 0; i < this._actions.length; i++) {\r\n      const action = this._actions[i];\r\n      action.update(elapsed);\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { IsometricMap } from './IsometricMap';\r\n\r\nexport interface IsometricEntityComponentOptions {\r\n  columns: number;\r\n  rows: number;\r\n  tileWidth: number;\r\n  tileHeight: number;\r\n}\r\n\r\nexport class IsometricEntityComponent extends Component {\r\n  /**\r\n   * Vertical \"height\" in the isometric world\r\n   */\r\n  public elevation: number = 0;\r\n\r\n  public readonly columns: number;\r\n  public readonly rows: number;\r\n  public readonly tileWidth: number;\r\n  public readonly tileHeight: number;\r\n\r\n  /**\r\n   * Specify the isometric map to use to position this entity's z-index\r\n   * @param mapOrOptions\r\n   */\r\n  constructor(mapOrOptions: IsometricMap | IsometricEntityComponentOptions) {\r\n    super();\r\n    this.columns = mapOrOptions.columns;\r\n    this.rows = mapOrOptions.rows;\r\n    this.tileWidth = mapOrOptions.tileWidth;\r\n    this.tileHeight = mapOrOptions.tileHeight;\r\n  }\r\n}\r\n","import { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\nimport { Query, SystemPriority, World } from '../EntityComponentSystem';\r\n\r\nexport class IsometricEntitySystem extends System {\r\n  static priority: number = SystemPriority.Lower;\r\n\r\n  public readonly systemType = SystemType.Update;\r\n  query: Query<typeof TransformComponent | typeof IsometricEntityComponent>;\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, IsometricEntityComponent]);\r\n  }\r\n\r\n  update(): void {\r\n    let transform: TransformComponent;\r\n    let iso: IsometricEntityComponent;\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      transform = entity.get(TransformComponent);\r\n      iso = entity.get(IsometricEntityComponent);\r\n\r\n      const maxZindexPerElevation = Math.max(iso.columns * iso.tileWidth, iso.rows * iso.tileHeight);\r\n\r\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\r\n      transform.z = newZ;\r\n    }\r\n  }\r\n}\r\n","import { GraphicsComponent } from './GraphicsComponent';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { Scene } from '../Scene';\r\nimport { Screen } from '../Screen';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Query, SystemPriority, World } from '../EntityComponentSystem';\r\n\r\nexport class OffscreenSystem extends System {\r\n  static priority: number = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Draw;\r\n  private _camera!: Camera;\r\n  private _screen!: Screen;\r\n  private _worldBounds!: BoundingBox;\r\n  query: Query<typeof TransformComponent | typeof GraphicsComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, GraphicsComponent]);\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._camera = scene.camera;\r\n    this._screen = scene.engine.screen;\r\n  }\r\n\r\n  update(): void {\r\n    this._worldBounds = this._screen.getWorldBounds();\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n    let maybeParallax: ParallaxComponent | undefined;\r\n\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      graphics = entity.get(GraphicsComponent);\r\n      transform = entity.get(TransformComponent);\r\n      maybeParallax = entity.get(ParallaxComponent);\r\n\r\n      let parallaxOffset: Vector | undefined;\r\n      if (maybeParallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n        parallaxOffset = this._camera.pos.scale(oneMinusFactor);\r\n      }\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics, parallaxOffset);\r\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\r\n        entity.events.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addTag('ex.offscreen');\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\r\n        entity.events.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeTag('ex.offscreen');\r\n      }\r\n    }\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent, parallaxOffset: Vector | undefined) {\r\n    if (graphics.forceOnScreen) {\r\n      return false;\r\n    }\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      let bounds = graphics.localBounds;\r\n      if (parallaxOffset) {\r\n        bounds = bounds.translate(parallaxOffset);\r\n      }\r\n      const transformedBounds = bounds.transform(transform.get().matrix);\r\n      const graphicsOffscreen = !this._worldBounds.overlaps(transformedBounds);\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO screen coordinates\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { FrameStats } from '../../Debug/DebugConfig';\r\nimport { Entity } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { createId } from '../../Id';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Pool } from '../../Util/Pool';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { CollisionGroup } from '../Group/CollisionGroup';\r\nimport { CollisionContact } from './CollisionContact';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { Pair } from './Pair';\r\nimport { RayCastHit } from './RayCastHit';\r\nimport { RayCastOptions } from './RayCastOptions';\r\nimport { HashGridCell, HashGridProxy, SparseHashGrid } from './SparseHashGrid';\r\n\r\n/**\r\n * Proxy type to stash collision info\r\n */\r\nexport class HashColliderProxy extends HashGridProxy<Collider> {\r\n  id: number = -1;\r\n  owner: Entity;\r\n  body: BodyComponent;\r\n  collisionType: CollisionType;\r\n  hasZeroBounds = false;\r\n  /**\r\n   * left bounds x hash coordinate\r\n   */\r\n  leftX: number;\r\n  /**\r\n   * right bounds x hash coordinate\r\n   */\r\n  rightX: number;\r\n  /**\r\n   * bottom bounds y hash coordinate\r\n   */\r\n  bottomY: number;\r\n  /**\r\n   * top bounds y hash coordinate\r\n   */\r\n  topY: number;\r\n  /**\r\n   * References to the hash cell the collider is a current member of\r\n   */\r\n  cells: HashGridCell<Collider, HashColliderProxy>[] = [];\r\n  /**\r\n   * Grid size in pixels\r\n   */\r\n  readonly gridSize: number;\r\n  constructor(\r\n    public collider: Collider,\r\n    gridSize: number\r\n  ) {\r\n    super(collider, gridSize);\r\n    this.gridSize = gridSize;\r\n    const bounds = collider.bounds;\r\n    this.hasZeroBounds = bounds.hasZeroDimensions();\r\n    this.leftX = Math.floor(bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(bounds.top / this.gridSize);\r\n    this.owner = collider.owner;\r\n    this.body = this.owner?.get(BodyComponent);\r\n    this.collisionType = this.body.collisionType ?? CollisionType.PreventCollision;\r\n  }\r\n\r\n  /**\r\n   * Updates the hashed bounds coordinates\r\n   */\r\n  update(): void {\r\n    super.update();\r\n    this.body = this.owner?.get(BodyComponent);\r\n    this.collisionType = this.body.collisionType ?? CollisionType.PreventCollision;\r\n    this.hasZeroBounds = this.collider.localBounds.hasZeroDimensions();\r\n  }\r\n}\r\n\r\n/**\r\n * This collision processor uses a sparsely populated grid of uniform cells to bucket potential\r\n * colliders together for the purpose of detecting collision pairs and collisions.\r\n */\r\nexport class SparseHashGridCollisionProcessor implements CollisionProcessor {\r\n  readonly gridSize: number;\r\n  readonly hashGrid: SparseHashGrid<Collider, HashColliderProxy>;\r\n\r\n  private _pairs = new Set<string>();\r\n  private _nonPairs = new Set<string>();\r\n\r\n  public _pairPool = new Pool<Pair>(\r\n    () => new Pair({ id: createId('collider', 0) } as Collider, { id: createId('collider', 0) } as Collider),\r\n    (instance) => {\r\n      instance.colliderA = null;\r\n      instance.colliderB = null;\r\n      return instance;\r\n    },\r\n    200\r\n  );\r\n\r\n  constructor(options: { size: number }) {\r\n    this.gridSize = options.size;\r\n    this.hashGrid = new SparseHashGrid<Collider, HashColliderProxy>({\r\n      size: this.gridSize,\r\n      proxyFactory: (collider, size) => new HashColliderProxy(collider, size)\r\n    });\r\n    this._pairPool.disableWarnings = true;\r\n\r\n    // TODO dynamic grid size potentially larger than the largest collider\r\n    // TODO Re-hash the objects if the median proves to be different\r\n  }\r\n\r\n  getColliders(): readonly Collider[] {\r\n    return Array.from(this.hashGrid.objectToProxy.keys());\r\n  }\r\n\r\n  query(point: Vector): Collider[];\r\n  query(bound: BoundingBox): Collider[];\r\n  query(boundsOrPoint: Vector | BoundingBox): Collider[] {\r\n    // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\r\n    return this.hashGrid.query(boundsOrPoint as any);\r\n  }\r\n\r\n  rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    // DDA raycast algo\r\n    const results: RayCastHit[] = [];\r\n    const maxDistance = options?.maxDistance ?? Infinity;\r\n    const collisionGroup = options?.collisionGroup;\r\n    const collisionMask = !collisionGroup ? options?.collisionMask ?? CollisionGroup.All.category : collisionGroup.category;\r\n    const searchAllColliders = options?.searchAllColliders ?? false;\r\n\r\n    const unitRay = ray.dir.normalize();\r\n\r\n    const dydx = unitRay.y / unitRay.x;\r\n    const dxdy = unitRay.x / unitRay.y;\r\n\r\n    const unitStepX = Math.sqrt(1 + dydx * dydx) * this.gridSize;\r\n    const unitStepY = Math.sqrt(1 + dxdy * dxdy) * this.gridSize;\r\n\r\n    const startXCoord = ray.pos.x / this.gridSize;\r\n    const startYCoord = ray.pos.y / this.gridSize;\r\n\r\n    const stepDir = vec(1, 1);\r\n\r\n    let currentXCoord = ~~startXCoord;\r\n    let currentYCoord = ~~startYCoord;\r\n    let currentRayLengthX = 0;\r\n    let currentRayLengthY = 0;\r\n\r\n    if (unitRay.x < 0) {\r\n      stepDir.x = -1;\r\n      currentRayLengthX = (startXCoord - currentXCoord) * unitStepX;\r\n    } else {\r\n      stepDir.x = 1;\r\n      currentRayLengthX = (currentXCoord + 1 - startXCoord) * unitStepX;\r\n    }\r\n\r\n    if (unitRay.y < 0) {\r\n      stepDir.y = -1;\r\n      currentRayLengthY = (startYCoord - currentYCoord) * unitStepY;\r\n    } else {\r\n      stepDir.y = 1;\r\n      currentRayLengthY = (currentYCoord + 1 - startYCoord) * unitStepY;\r\n    }\r\n\r\n    const collidersVisited = new Set<number>();\r\n\r\n    let done = false;\r\n    let maxIterations = 9999;\r\n    while (!done && maxIterations > 0) {\r\n      maxIterations--; // safety exit\r\n      // exit if exhausted max hash grid coordinate, bounds of the sparse grid\r\n      if (!this.hashGrid.bounds.contains(vec(currentXCoord * this.gridSize, currentYCoord * this.gridSize))) {\r\n        break;\r\n      }\r\n      // Test colliders at cell\r\n      const key = HashGridCell.calculateHashKey(currentXCoord, currentYCoord);\r\n      const cell = this.hashGrid.sparseHashGrid.get(key);\r\n      if (cell) {\r\n        const cellHits: RayCastHit[] = [];\r\n        for (let colliderIndex = 0; colliderIndex < cell.proxies.length; colliderIndex++) {\r\n          const collider = cell.proxies[colliderIndex];\r\n          if (!collidersVisited.has(collider.collider.id.value)) {\r\n            collidersVisited.add(collider.collider.id.value);\r\n\r\n            if (options?.ignoreCollisionGroupAll && collider.body.group === CollisionGroup.All) {\r\n              continue;\r\n            }\r\n\r\n            const canCollide = (collisionMask & collider.body.group.category) !== 0;\r\n\r\n            // Early exit if not the right group\r\n            if (collider.body.group && !canCollide) {\r\n              continue;\r\n            }\r\n\r\n            const hit = collider.collider.rayCast(ray, maxDistance);\r\n\r\n            // Collect up all the colliders that hit inside a cell\r\n            // they can be in any order so we need to sort them next\r\n            if (hit) {\r\n              cellHits.push(hit);\r\n            }\r\n          }\r\n        }\r\n        cellHits.sort((hit1, hit2) => hit1.distance - hit2.distance);\r\n        for (let i = 0; i < cellHits.length; i++) {\r\n          const hit = cellHits[i];\r\n          if (options?.filter) {\r\n            if (options.filter(hit)) {\r\n              results.push(hit);\r\n              if (!searchAllColliders) {\r\n                done = true;\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            results.push(hit);\r\n            if (!searchAllColliders) {\r\n              done = true;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (currentRayLengthX < currentRayLengthY) {\r\n        currentXCoord += stepDir.x;\r\n        currentRayLengthX += unitStepX;\r\n      } else {\r\n        currentYCoord += stepDir.y;\r\n        currentRayLengthY += unitStepY;\r\n      }\r\n    }\r\n\r\n    // Sort by distance\r\n    results.sort((hit1, hit2) => hit1.distance - hit2.distance);\r\n    if (!searchAllColliders && results.length) {\r\n      return [results[0]];\r\n    }\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Adds the collider to the internal data structure for collision tracking\r\n   * @param target\r\n   */\r\n  track(target: Collider): void {\r\n    let colliders = [target];\r\n    if (target instanceof CompositeCollider) {\r\n      const compColliders = target.getColliders();\r\n      for (const c of compColliders) {\r\n        c.owner = target.owner;\r\n      }\r\n      colliders = compColliders;\r\n    }\r\n\r\n    for (const target of colliders) {\r\n      this.hashGrid.track(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the internal data structure for tracking collisions\r\n   * @param target\r\n   */\r\n  untrack(target: Collider): void {\r\n    let colliders = [target];\r\n    if (target instanceof CompositeCollider) {\r\n      colliders = target.getColliders();\r\n    }\r\n\r\n    for (const target of colliders) {\r\n      this.hashGrid.untrack(target);\r\n    }\r\n  }\r\n\r\n  private _canCollide(colliderA: HashColliderProxy, colliderB: HashColliderProxy) {\r\n    // Prevent self collision\r\n    if (colliderA.collider.id === colliderB.collider.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.hasZeroBounds || colliderB.hasZeroBounds) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!colliderA.body.group.canCollide(colliderB.body.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (colliderA.collisionType === CollisionType.Fixed && colliderB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (colliderA.collisionType === CollisionType.PreventCollision || colliderB.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!colliderA.owner.isActive || !colliderB.owner.isActive) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Runs the broadphase sweep over tracked colliders and returns possible collision pairs\r\n   * @param targets\r\n   * @param elapsed\r\n   */\r\n  broadphase(targets: Collider[], elapsed: number): Pair[] {\r\n    const pairs: Pair[] = [];\r\n    this._pairs.clear();\r\n    this._nonPairs.clear();\r\n\r\n    let proxyId = 0;\r\n    for (const proxy of this.hashGrid.objectToProxy.values()) {\r\n      proxy.id = proxyId++; // track proxies we've already processed\r\n      if (!proxy.owner.isActive || proxy.collisionType === CollisionType.PreventCollision) {\r\n        continue;\r\n      }\r\n      // for every cell proxy collider is member of\r\n      for (let cellIndex = 0; cellIndex < proxy.cells.length; cellIndex++) {\r\n        const cell = proxy.cells[cellIndex];\r\n        // TODO Can we skip any cells or make this iteration faster?\r\n        // maybe a linked list here\r\n        for (let otherIndex = 0; otherIndex < cell.proxies.length; otherIndex++) {\r\n          const other = cell.proxies[otherIndex];\r\n          if (other.id === proxy.id) {\r\n            // skip duplicates\r\n            continue;\r\n          }\r\n          const id = Pair.calculatePairHash(proxy.collider.id, other.collider.id);\r\n          if (this._nonPairs.has(id)) {\r\n            continue; // Is there a way we can re-use the non-pair cache\r\n          }\r\n          if (!this._pairs.has(id) && this._canCollide(proxy, other) && proxy.object.bounds.overlaps(other.object.bounds)) {\r\n            const pair = this._pairPool.get();\r\n            pair.colliderA = proxy.collider;\r\n            pair.colliderB = other.collider;\r\n            pair.id = id;\r\n            this._pairs.add(id);\r\n            pairs.push(pair);\r\n          } else {\r\n            this._nonPairs.add(id);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pairs;\r\n  }\r\n\r\n  /**\r\n   * Runs a fine grain pass on collision pairs and does geometry intersection tests producing any contacts\r\n   * @param pairs\r\n   * @param stats\r\n   */\r\n  narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    const contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      for (let j = 0; j < newContacts.length; j++) {\r\n        const c = newContacts[j];\r\n        contacts.push(c);\r\n        if (stats) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    this._pairPool.done();\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts; // TODO maybe we can re-use contacts as likely pairs next frame\r\n  }\r\n\r\n  /**\r\n   * Perform data structure maintenance, returns number of colliders updated\r\n   */\r\n  update(targets: Collider[], elapsed: number): number {\r\n    return this.hashGrid.update(targets);\r\n  }\r\n\r\n  /**\r\n   * Draws the internal data structure\r\n   * @param ex\r\n   * @param elapsed\r\n   */\r\n  debug(ex: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.hashGrid.debug(ex, elapsed);\r\n  }\r\n}\r\n","import { Ray } from '../Math/ray';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { Observable } from '../Util/Observable';\r\nimport {\r\n  BoundingBox,\r\n  Collider,\r\n  CollisionProcessor,\r\n  DynamicTreeCollisionProcessor,\r\n  RayCastHit,\r\n  RayCastOptions,\r\n  SparseHashGridCollisionProcessor\r\n} from './Index';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { PhysicsConfig } from './PhysicsConfig';\r\nimport { watchDeep } from '../Util/Watch';\r\nimport { Vector } from '../Math/vector';\r\nimport { SpatialPartitionStrategy } from './Detection/SpatialPartitionStrategy';\r\n\r\nexport class PhysicsWorld {\r\n  $configUpdate = new Observable<DeepRequired<PhysicsConfig>>();\r\n\r\n  private _configDirty = false;\r\n  private _config: DeepRequired<PhysicsConfig>;\r\n  get config(): DeepRequired<PhysicsConfig> {\r\n    return watchDeep(this._config, (change) => {\r\n      this.$configUpdate.notifyAll(change);\r\n    });\r\n  }\r\n  set config(newConfig: DeepRequired<PhysicsConfig>) {\r\n    this._config = newConfig;\r\n    this.$configUpdate.notifyAll(newConfig);\r\n  }\r\n\r\n  private _collisionProcessor: CollisionProcessor;\r\n  /**\r\n   * Spatial data structure for locating potential collision pairs and ray casts\r\n   */\r\n  public get collisionProcessor(): CollisionProcessor {\r\n    if (this._configDirty) {\r\n      this._configDirty = false;\r\n      // preserve tracked colliders if config updates\r\n      const colliders = this._collisionProcessor.getColliders();\r\n      if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\r\n        this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\r\n      } else {\r\n        this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\r\n      }\r\n      for (const collider of colliders) {\r\n        this._collisionProcessor.track(collider);\r\n      }\r\n    }\r\n    return this._collisionProcessor;\r\n  }\r\n  constructor(config: DeepRequired<PhysicsConfig>) {\r\n    this.config = config;\r\n    this.$configUpdate.subscribe((config) => {\r\n      this._configDirty = true;\r\n      BodyComponent.updateDefaultPhysicsConfig(config.bodies);\r\n    });\r\n    if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\r\n      this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\r\n    } else {\r\n      this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Raycast into the scene's physics world\r\n   * @param ray\r\n   * @param options\r\n   */\r\n  public rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    return this.collisionProcessor.rayCast(ray, options);\r\n  }\r\n\r\n  /**\r\n   * Query for colliders in the scene's physics world\r\n   * @param point\r\n   */\r\n  public query(point: Vector): Collider[];\r\n  public query(bounds: BoundingBox): Collider[];\r\n  public query(pointOrBounds: Vector | BoundingBox): Collider[] {\r\n    // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\r\n    return this._collisionProcessor.query(pointOrBounds as any);\r\n  }\r\n}\r\n","import { GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\nexport type GamepadEvents = {\r\n  connect: GamepadConnectEvent;\r\n  disconnect: GamepadDisconnectEvent;\r\n  button: GamepadButtonEvent;\r\n  axis: GamepadAxisEvent;\r\n};\r\n\r\nexport const GamepadEvents = {\r\n  GamepadConnect: 'connect',\r\n  GamepadDisconnect: 'disconnect',\r\n  GamepadButton: 'button',\r\n  GamepadAxis: 'axis'\r\n};\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads {\r\n  public events = new EventEmitter<GamepadEvents>();\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n  private _enabled = true;\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  public toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, event: GamepadEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.events.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n          gamepad.events.unpipe(this.events);\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        const gamepad = this.at(i);\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          gamepad.events.pipe(this.events);\r\n          this.events.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      this.at(i).update();\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n\r\n      const gamepad = gamepads[i];\r\n      // gamepads are a list that might be null\r\n      if (gamepad) {\r\n        for (let buttonIndex = 0; buttonIndex < gamepad.buttons.length; buttonIndex++) {\r\n          const button = gamepad.buttons[buttonIndex];\r\n          const value = button?.value;\r\n          if (value !== this._oldPads[i]?.getButton(buttonIndex)) {\r\n            if (button?.pressed) {\r\n              this.at(i).updateButton(buttonIndex, value);\r\n              // Fallback to unknown if not mapped\r\n              // prettier-ignore\r\n              this.at(i).events.emit('button', new GamepadButtonEvent(\r\n                buttonIndex in Buttons ? buttonIndex as Buttons : Buttons.Unknown,\r\n                buttonIndex,\r\n                value,\r\n                this.at(i))\r\n              );\r\n            } else {\r\n              this.at(i).updateButton(buttonIndex, 0);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let axesIndex = 0; axesIndex < gamepad.axes.length; axesIndex++) {\r\n          const axis = gamepad.axes[axesIndex];\r\n          if (axis !== this._oldPads[i]?.getAxes(axesIndex)) {\r\n            this.at(i).updateAxes(axesIndex, axis);\r\n            this.at(i).events.emit('axis', new GamepadAxisEvent(axesIndex, axis, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See {@apilink Gamepads}\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad {\r\n  public events = new EventEmitter<GamepadEvents>();\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _axes: number[] = new Array(4);\r\n  private _buttons: number[] = new Array(16);\r\n  private _buttonsUp: number[] = new Array(16);\r\n  private _buttonsDown: number[] = new Array(16);\r\n\r\n  constructor() {\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  public update() {\r\n    // Reset buttonsDown and buttonsUp after update is complete\r\n    this._buttonsDown = new Array(16);\r\n    this._buttonsUp = new Array(16);\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @deprecated will be removed in v0.28.0. Use isButtonHeld instead\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons | number, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button is held down. This is persisted between frames.\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonHeld(button: Buttons | number, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param button Test whether a button was just pressed\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public wasButtonPressed(button: Buttons | number, threshold: number = 1) {\r\n    return this._buttonsDown[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button was just released this frame. This is cleared at the end of the update frame.\r\n   * @param button  Test whether a button was just released\r\n   */\r\n  public wasButtonReleased(button: Buttons | number) {\r\n    return Boolean(this._buttonsUp[button]);\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons | number) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * {@apilink MinAxisMoveThreshold} are considered 0.\r\n   */\r\n  public getAxes(axes: Axes | number) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    // button was just released\r\n    if (value === 0 && this._buttons[buttonIndex]) {\r\n      this._buttonsUp[buttonIndex] = 1;\r\n\r\n      // button was just pressed\r\n    } else {\r\n      this._buttonsDown[buttonIndex] = value;\r\n    }\r\n\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, event: GamepadEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Any button that isn't explicity known by excalibur\r\n   */\r\n  Unknown = -1,\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15,\r\n  /**\r\n   * Center button (e.g. the Nintendo Home Button)\r\n   */\r\n  CenterButton = 16,\r\n  /**\r\n   * Misc button 1 (e.g. Xbox Series X share button, PS5 microphone button, Nintendo Switch Pro capture button, Amazon Luna microphone button)\r\n   * defacto standard not listed on the w3c spec for a standard gamepad https://w3c.github.io/gamepad/#dfn-standard-gamepad\r\n   */\r\n  MiscButton1 = 17\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): (NavigatorGamepad | undefined)[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport * as Events from '../Events';\r\nimport { isCrossOriginIframe } from '../Util/IFrame';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n *\r\n * Spec: https://w3c.github.io/uievents-code/#key-alphanumeric-section\r\n */\r\nexport enum Keys {\r\n  // Writing System Keys https://w3c.github.io/uievents-code/#key-alphanumeric-writing-system\r\n  Backquote = 'Backquote',\r\n  Backslash = 'Backslash',\r\n  BracketLeft = 'BracketLeft',\r\n  BracketRight = 'BracketRight',\r\n  Comma = 'Comma',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  Equal = 'Equal',\r\n\r\n  IntlBackslash = 'IntlBackslash',\r\n  IntlRo = 'IntlRo',\r\n  IntlYen = 'IntlYen',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Quote = 'Quote',\r\n  Semicolon = 'Semicolon',\r\n  Slash = 'Slash',\r\n\r\n  // Functional keys https://w3c.github.io/uievents-code/#key-alphanumeric-functional\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n  Alt = 'Alt',\r\n  AltGraph = 'AltGraph',\r\n  Backspace = 'Backspace',\r\n  CapsLock = 'CapsLock',\r\n  ContextMenu = 'ContextMenu',\r\n  ControlLeft = 'ControlLeft',\r\n  ControlRight = 'ControlRight',\r\n  Enter = 'Enter',\r\n  MetaLeft = 'MetaLeft',\r\n  MetaRight = 'MetaRight',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  Space = 'Space',\r\n  Tab = 'Tab',\r\n\r\n  Convert = 'Convert',\r\n  KanaMode = 'KanaMode',\r\n  NonConvert = 'NonConvert',\r\n\r\n  // Control Pad https://w3c.github.io/uievents-code/#key-controlpad-section\r\n  Delete = 'Delete',\r\n  End = 'End',\r\n  Help = 'Help',\r\n  Home = 'Home',\r\n  Insert = 'Insert',\r\n  PageDown = 'PageDown',\r\n  PageUp = 'PageUp',\r\n\r\n  // Arrow Pad https://w3c.github.io/uievents-code/#key-arrowpad-section\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // Numpad Section https://w3c.github.io/uievents-code/#key-numpad-section\r\n  NumLock = 'NumLock',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n\r\n  NumAdd = 'NumpadAdd',\r\n  NumpadAdd = 'NumpadAdd',\r\n\r\n  NumDecimal = 'NumpadDecimal',\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  NumDivide = 'NumpadDivide',\r\n  NumpadDivide = 'NumpadDivide',\r\n\r\n  NumEnter = 'NumpadEnter',\r\n  NumpadEnter = 'NumpadEnter',\r\n\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n\r\n  // Function section https://w3c.github.io/uievents-code/#key-function-section\r\n  Esc = 'Escape',\r\n  Escape = 'Escape',\r\n  F1 = 'F1',\r\n  F2 = 'F2',\r\n  F3 = 'F3',\r\n  F4 = 'F4',\r\n  F5 = 'F5',\r\n  F6 = 'F6',\r\n  F7 = 'F7',\r\n  F8 = 'F8',\r\n  F9 = 'F9',\r\n  F10 = 'F10',\r\n  F11 = 'F11',\r\n  F12 = 'F12',\r\n  F13 = 'F13',\r\n  F14 = 'F14',\r\n  F15 = 'F15',\r\n  F16 = 'F16',\r\n  F17 = 'F17',\r\n  F18 = 'F18',\r\n  F19 = 'F19',\r\n  F20 = 'F20',\r\n  PrintScreen = 'PrintScreen',\r\n  ScrollLock = 'ScrollLock',\r\n  Pause = 'Pause',\r\n\r\n  Unidentified = 'Unidentified'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(\r\n    public key: Keys,\r\n    public value?: string,\r\n    public originalEvent?: KeyboardEvent\r\n  ) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport interface KeyboardInitOptions {\r\n  global?: GlobalEventHandlers;\r\n  grabWindowFocus?: boolean;\r\n}\r\n\r\nexport type KeyEvents = {\r\n  press: KeyEvent;\r\n  hold: KeyEvent;\r\n  release: KeyEvent;\r\n};\r\n\r\nexport const KeyEvents = {\r\n  Press: 'press',\r\n  Hold: 'hold',\r\n  Release: 'release'\r\n};\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard {\r\n  public events = new EventEmitter<KeyEvents>();\r\n  private _enabled = true;\r\n  /**\r\n   * Keys that are currently held down\r\n   */\r\n  private _keys: Keys[] = [];\r\n  /**\r\n   * Keys up in the current frame\r\n   */\r\n  private _keysUp: Keys[] = [];\r\n  /**\r\n   * Keys down in the current frame\r\n   */\r\n  private _keysDown: Keys[] = [];\r\n\r\n  public emit<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, event: KeyEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(keyboardOptions?: KeyboardInitOptions): void {\r\n    let { global } = keyboardOptions;\r\n    const { grabWindowFocus } = keyboardOptions;\r\n    if (!global) {\r\n      if (isCrossOriginIframe()) {\r\n        global = window;\r\n        // Workaround for iframes like for itch.io or codesandbox\r\n        // https://www.reddit.com/r/gamemaker/comments/kfs5cs/keyboard_inputs_no_longer_working_in_html5_game/\r\n        // https://forum.gamemaker.io/index.php?threads/solved-keyboard-issue-on-itch-io.87336/\r\n        if (grabWindowFocus) {\r\n          window.focus();\r\n        }\r\n\r\n        Logger.getInstance().warn('Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus');\r\n      } else {\r\n        global = window.top;\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', this._handleKeyUp);\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', this._handleKeyDown);\r\n  }\r\n\r\n  toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  private _releaseAllKeys = (ev: KeyboardEvent) => {\r\n    for (const code of this._keys) {\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n      this.events.emit('up', keyEvent);\r\n      this.events.emit('release', keyEvent);\r\n    }\r\n    this._keysUp = Array.from(new Set(this._keys.concat(this._keysUp)));\r\n    this._keys.length = 0;\r\n  };\r\n\r\n  public clear() {\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n    this._keys.length = 0;\r\n  }\r\n\r\n  private _handleKeyDown = (ev: KeyboardEvent) => {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n\r\n    // handle macos meta key issue\r\n    // https://github.com/excaliburjs/Excalibur/issues/2608\r\n    if (!ev.metaKey && (this._keys.includes(Keys.MetaLeft) || this._keys.includes(Keys.MetaRight))) {\r\n      this._releaseAllKeys(ev);\r\n    }\r\n\r\n    const code = ev.code as Keys;\r\n    if (this._keys.indexOf(code) === -1) {\r\n      this._keys.push(code);\r\n      this._keysDown.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n      this.events.emit('down', keyEvent);\r\n      this.events.emit('press', keyEvent);\r\n    }\r\n  };\r\n\r\n  private _handleKeyUp = (ev: KeyboardEvent) => {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    const code = ev.code as Keys;\r\n    const key = this._keys.indexOf(code);\r\n    this._keys.splice(key, 1);\r\n    this._keysUp.push(code);\r\n    const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n    // alias the old api, we may want to deprecate this in the future\r\n    this.events.emit('up', keyEvent);\r\n    this.events.emit('release', keyEvent);\r\n\r\n    // handle macos meta key issue\r\n    // https://github.com/excaliburjs/Excalibur/issues/2608\r\n    if (ev.key === 'Meta') {\r\n      this._releaseAllKeys(ev);\r\n    }\r\n  };\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.events.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Trigger a manual key event\r\n   * @param type\r\n   * @param key\r\n   * @param character\r\n   */\r\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\r\n    if (type === 'down') {\r\n      this._handleKeyDown(\r\n        new KeyboardEvent('keydown', {\r\n          code: key,\r\n          key: character ?? null\r\n        })\r\n      );\r\n    }\r\n    if (type === 'up') {\r\n      this._handleKeyUp(\r\n        new KeyboardEvent('keyup', {\r\n          code: key,\r\n          key: character ?? null\r\n        })\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { Gamepads } from './Gamepad';\r\nimport { Keyboard } from './Keyboard';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\n\r\nexport interface InputsOptions {\r\n  keyboard: Keyboard;\r\n  gamepads: Gamepads;\r\n  pointers: PointerEventReceiver;\r\n}\r\n\r\n/**\r\n * This allows you to map multiple inputs to specific commands! This is especially useful when\r\n * you need to allow multiple input sources to control a specific action.\r\n */\r\nexport class InputMapper {\r\n  private _handlers = new Map<any, any>();\r\n  constructor(public inputs: InputsOptions) {}\r\n\r\n  /**\r\n   * Executes the input map, called internally by Excalibur\r\n   */\r\n  execute() {\r\n    for (const [input, command] of this._handlers.entries()) {\r\n      const results = input(this.inputs);\r\n      if (results) {\r\n        command(results);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This allows you to map multiple inputs to specific commands! This is useful\r\n   *\r\n   * The inputHandler should return a truthy value if you wish the commandHandler to fire.\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const moveRight = (amount: number) => { actor.vel.x = 100 * amount }\r\n   * const moveLeft = (amount: number) => { actor.vel.x = -100 * amount }\r\n   * const moveUp = (amount: number) => { actor.vel.y = -100 * amount }\r\n   * const moveDown = (amount: number) => { actor.vel.y = 100 * amount }\r\n   *\r\n   * engine.inputMapper.on(({keyboard}) => keyboard.isHeld(ex.Keys.ArrowRight) ? 1 : 0, moveRight);\r\n   * engine.inputMapper.on(({gamepads}) => gamepads.at(0).isButtonPressed(ex.Buttons.DpadRight) ? 1 : 0, moveRight);\r\n   * engine.inputMapper.on(({gamepads}) => gamepads.at(0).getAxes(ex.Axes.LeftStickX) > 0 ?\r\n   *  gamepads.at(0).getAxes(ex.Axes.LeftStickX) : 0, moveRight);\r\n   * ```\r\n   * @param inputHandler\r\n   * @param commandHandler\r\n   */\r\n  on<TInputHandlerData>(\r\n    inputHandler: (inputs: InputsOptions) => TInputHandlerData | false,\r\n    commandHandler: (data: TInputHandlerData) => any\r\n  ) {\r\n    this._handlers.set(inputHandler, commandHandler);\r\n  }\r\n}\r\n","/**\r\n * Checks if excalibur is in a x-origin iframe\r\n */\r\nexport function isCrossOriginIframe() {\r\n  try {\r\n    // Try and listen to events on top window frame if within an iframe.\r\n    //\r\n    // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n    //\r\n    // Attempt to add an event listener, which triggers a DOMException on\r\n    // cross-origin iframes\r\n    const noop = () => {\r\n      return;\r\n    };\r\n    window.top.addEventListener('blur', noop);\r\n    window.top.removeEventListener('blur', noop);\r\n  } catch {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Vector } from './vector';\r\n\r\nexport class GlobalCoordinates {\r\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\r\n    let pageX: number;\r\n    let pageY: number;\r\n    let pagePos: Vector;\r\n    let engine: Engine;\r\n\r\n    if (arguments.length === 3) {\r\n      pageX = <number>xOrPos;\r\n      pageY = <number>yOrEngine;\r\n      pagePos = new Vector(pageX, pageY);\r\n      engine = engineOrUndefined;\r\n    } else {\r\n      pagePos = <Vector>xOrPos;\r\n      pageX = pagePos.x;\r\n      pageY = pagePos.y;\r\n      engine = <Engine>yOrEngine;\r\n    }\r\n\r\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\r\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\r\n\r\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\r\n  }\r\n\r\n  constructor(\r\n    public worldPos: Vector,\r\n    public pagePos: Vector,\r\n    public screenPos: Vector\r\n  ) {}\r\n}\r\n","import { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { PointerButton } from './PointerButton';\r\nimport { PointerType } from './PointerType';\r\n\r\nexport class PointerEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n\r\n  get pagePos(): Vector {\r\n    return this.coordinates.pagePos;\r\n  }\r\n\r\n  get screenPos(): Vector {\r\n    return this.coordinates.screenPos;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return this.coordinates.worldPos;\r\n  }\r\n\r\n  constructor(\r\n    public type: 'down' | 'up' | 'move' | 'cancel',\r\n    public pointerId: number,\r\n    public button: PointerButton,\r\n    public pointerType: PointerType,\r\n    public coordinates: GlobalCoordinates,\r\n    public nativeEvent: Event\r\n  ) {}\r\n}\r\n","import { WheelDeltaMode } from './WheelDeltaMode';\r\n\r\nexport class WheelEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: Event\r\n  ) {}\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { PointerEvents } from './PointerEventReceiver';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Engine } from '../Engine';\r\n\r\nexport class PointerAbstraction {\r\n  public events = new EventEmitter<PointerEvents>();\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = Vector.Zero;\r\n\r\n  constructor() {\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, event: PointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur to keep pointers up to date\r\n   * @internal\r\n   * @param engine\r\n   */\r\n  public _updateWorldPosition(engine: Engine) {\r\n    const coord = GlobalCoordinates.fromPagePosition(this.lastPagePos, engine);\r\n    this.lastScreenPos = coord.screenPos;\r\n    this.lastWorldPos = coord.worldPos;\r\n  }\r\n\r\n  private _onPointerMove = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n\r\n  private _onPointerDown = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n}\r\n","export enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n","/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n","/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n","/**\r\n * The type of pointer for a {@apilink PointerEvent}.\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n","import { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerAbstraction } from './PointerAbstraction';\r\n\r\nimport { WheelDeltaMode } from './WheelDeltaMode';\r\nimport { PointerSystem } from './PointerSystem';\r\nimport { NativePointerButton } from './NativePointerButton';\r\nimport { PointerButton } from './PointerButton';\r\nimport { fail } from '../Util/Util';\r\nimport { PointerType } from './PointerType';\r\nimport { isCrossOriginIframe } from '../Util/IFrame';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\nexport type NativePointerEvent = globalThis.PointerEvent;\r\nexport type NativeMouseEvent = globalThis.MouseEvent;\r\nexport type NativeTouchEvent = globalThis.TouchEvent;\r\nexport type NativeWheelEvent = globalThis.WheelEvent;\r\n\r\nexport type PointerEvents = {\r\n  move: PointerEvent;\r\n  down: PointerEvent;\r\n  up: PointerEvent;\r\n  wheel: WheelEvent;\r\n};\r\n\r\nexport const PointerEvents = {\r\n  Move: 'move',\r\n  Down: 'down',\r\n  Up: 'up',\r\n  Wheel: 'wheel'\r\n};\r\n\r\n/**\r\n * Is this event a native touch event?\r\n */\r\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\r\n}\r\n\r\n/**\r\n * Is this event a native pointer event\r\n */\r\nfunction isPointerEvent(value: any): value is NativePointerEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\r\n}\r\n\r\nexport interface PointerInitOptions {\r\n  grabWindowFocus?: boolean;\r\n}\r\n\r\n/**\r\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\r\n */\r\nexport class PointerEventReceiver {\r\n  public events = new EventEmitter<PointerEvents>();\r\n  public primary: PointerAbstraction = new PointerAbstraction();\r\n\r\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\r\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n\r\n  public currentFramePointerDown = new Map<number, boolean>();\r\n  public lastFramePointerDown = new Map<number, boolean>();\r\n\r\n  public currentFrameDown: PointerEvent[] = [];\r\n  public currentFrameUp: PointerEvent[] = [];\r\n  public currentFrameMove: PointerEvent[] = [];\r\n  public currentFrameCancel: PointerEvent[] = [];\r\n  public currentFrameWheel: WheelEvent[] = [];\r\n\r\n  private _enabled = true;\r\n\r\n  constructor(\r\n    public readonly target: GlobalEventHandlers & EventTarget,\r\n    public engine: Engine\r\n  ) {}\r\n\r\n  public toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Creates a new PointerEventReceiver with a new target and engine while preserving existing pointer event\r\n   * handlers.\r\n   * @param target\r\n   * @param engine\r\n   */\r\n  public recreate(target: GlobalEventHandlers & EventTarget, engine: Engine) {\r\n    const eventReceiver = new PointerEventReceiver(target, engine);\r\n    eventReceiver.primary = this.primary;\r\n    eventReceiver._pointers = this._pointers;\r\n    return eventReceiver;\r\n  }\r\n\r\n  private _pointers: PointerAbstraction[] = [this.primary];\r\n  /**\r\n   * Locates a specific pointer by id, creates it if it doesn't exist\r\n   * @param index\r\n   */\r\n  public at(index: number): PointerAbstraction {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new PointerAbstraction());\r\n      }\r\n    }\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * The number of pointers currently being tracked by excalibur\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  /**\r\n   * Is the specified pointer id down this frame\r\n   * @param pointerId\r\n   */\r\n  public isDown(pointerId: number) {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.currentFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Was the specified pointer id down last frame\r\n   * @param pointerId\r\n   */\r\n  public wasDown(pointerId: number) {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.lastFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public isDragging(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.isDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public isDragStart(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public isDragEnd(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, event: PointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur\r\n   *\r\n   * Updates the current frame pointer info and emits raw pointer events\r\n   *\r\n   * This does not emit events to entities, see PointerSystem\r\n   * @internal\r\n   */\r\n  public update() {\r\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\r\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\r\n\r\n    for (const event of this.currentFrameDown) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('down', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('down', event);\r\n      this.primary.emit('pointerdown', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameUp) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('up', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('up', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameMove) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('move', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('move', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameCancel) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('cancel', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('cancel', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameWheel) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('pointerwheel', event);\r\n      this.emit('wheel', event);\r\n      this.primary.emit('pointerwheel', event);\r\n      this.primary.emit('wheel', event);\r\n    }\r\n\r\n    if (this.engine.currentScene.camera.hasChanged()) {\r\n      for (const pointer of this._pointers) {\r\n        pointer._updateWorldPosition(this.engine);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current frame event and pointer data\r\n   */\r\n  public clear() {\r\n    for (const event of this.currentFrameUp) {\r\n      this.currentFramePointerCoords.delete(event.pointerId);\r\n      const ids = this._activeNativePointerIdsToNormalized.entries();\r\n      for (const [native, normalized] of ids) {\r\n        if (normalized === event.pointerId) {\r\n          this._activeNativePointerIdsToNormalized.delete(native);\r\n        }\r\n      }\r\n    }\r\n    this.currentFrameDown.length = 0;\r\n    this.currentFrameUp.length = 0;\r\n    this.currentFrameMove.length = 0;\r\n    this.currentFrameCancel.length = 0;\r\n    this.currentFrameWheel.length = 0;\r\n  }\r\n\r\n  private _boundHandle = this._handle.bind(this);\r\n  private _boundWheel = this._handleWheel.bind(this);\r\n  /**\r\n   * Initializes the pointer event receiver so that it can start listening to native\r\n   * browser events.\r\n   */\r\n  public init(options?: PointerInitOptions) {\r\n    if (this.engine.isDisposed()) {\r\n      return;\r\n    }\r\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\r\n    // It is important on mobile to have touch action 'none'\r\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\r\n    if (this.target === this.engine.canvas) {\r\n      this.engine.canvas.style.touchAction = 'none';\r\n    } else {\r\n      document.body.style.touchAction = 'none';\r\n    }\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.addEventListener('pointerdown', this._boundHandle);\r\n      this.target.addEventListener('pointerup', this._boundHandle);\r\n      this.target.addEventListener('pointermove', this._boundHandle);\r\n      this.target.addEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.addEventListener('touchstart', this._boundHandle);\r\n      this.target.addEventListener('touchend', this._boundHandle);\r\n      this.target.addEventListener('touchmove', this._boundHandle);\r\n      this.target.addEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.addEventListener('mousedown', this._boundHandle);\r\n      this.target.addEventListener('mouseup', this._boundHandle);\r\n      this.target.addEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\r\n    }\r\n\r\n    const grabWindowFocus = options?.grabWindowFocus ?? true;\r\n    // Handle cross origin iframe\r\n    if (grabWindowFocus && isCrossOriginIframe()) {\r\n      const grabFocus = () => {\r\n        window.focus();\r\n      };\r\n      // Preferred pointer events\r\n      if (window.PointerEvent) {\r\n        this.target.addEventListener('pointerdown', grabFocus);\r\n      } else {\r\n        // Touch Events\r\n        this.target.addEventListener('touchstart', grabFocus);\r\n\r\n        // Mouse Events\r\n        this.target.addEventListener('mousedown', grabFocus);\r\n      }\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.removeEventListener('pointerdown', this._boundHandle);\r\n      this.target.removeEventListener('pointerup', this._boundHandle);\r\n      this.target.removeEventListener('pointermove', this._boundHandle);\r\n      this.target.removeEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.removeEventListener('touchstart', this._boundHandle);\r\n      this.target.removeEventListener('touchend', this._boundHandle);\r\n      this.target.removeEventListener('touchmove', this._boundHandle);\r\n      this.target.removeEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.removeEventListener('mousedown', this._boundHandle);\r\n      this.target.removeEventListener('mouseup', this._boundHandle);\r\n      this.target.removeEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.removeEventListener('wheel', this._boundWheel);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Take native pointer id and map it to index in active pointers\r\n   * @param nativePointerId\r\n   */\r\n  private _normalizePointerId(nativePointerId: number) {\r\n    // Add to the the native pointer set id\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\r\n\r\n    // Native pointer ids in ascending order\r\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\r\n\r\n    // The index into sorted ids will be the new id, will always have an id\r\n    const id = currentPointerIds.findIndex((p) => p === nativePointerId);\r\n\r\n    // Save the mapping so we can reverse it later\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\r\n\r\n    // ignore pointer because game isn't watching\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Responsible for handling and parsing pointer events\r\n   */\r\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    ev.preventDefault();\r\n    const eventCoords = new Map<number, GlobalCoordinates>();\r\n    let button: PointerButton;\r\n    let pointerType: PointerType;\r\n    if (isTouchEvent(ev)) {\r\n      button = PointerButton.Unknown;\r\n      pointerType = PointerType.Touch;\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n      for (let i = 0; i < ev.changedTouches.length; i++) {\r\n        const touch = ev.changedTouches[i];\r\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\r\n        const nativePointerId = i + 1;\r\n        const pointerId = this._normalizePointerId(nativePointerId);\r\n        this.currentFramePointerCoords.set(pointerId, coordinates);\r\n        eventCoords.set(pointerId, coordinates);\r\n      }\r\n    } else {\r\n      button = this._nativeButtonToPointerButton(ev.button);\r\n      pointerType = PointerType.Mouse;\r\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\r\n      let nativePointerId = 1;\r\n      if (isPointerEvent(ev)) {\r\n        nativePointerId = ev.pointerId;\r\n        pointerType = this._stringToPointerType(ev.pointerType);\r\n      }\r\n      const pointerId = this._normalizePointerId(nativePointerId);\r\n      this.currentFramePointerCoords.set(pointerId, coordinates);\r\n      eventCoords.set(pointerId, coordinates);\r\n    }\r\n\r\n    for (const [pointerId, coord] of eventCoords.entries()) {\r\n      switch (ev.type) {\r\n        case 'mousedown':\r\n        case 'pointerdown':\r\n        case 'touchstart':\r\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, true);\r\n          break;\r\n        case 'mouseup':\r\n        case 'pointerup':\r\n        case 'touchend':\r\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, false);\r\n          break;\r\n        case 'mousemove':\r\n        case 'pointermove':\r\n        case 'touchmove':\r\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n        case 'touchcancel':\r\n        case 'pointercancel':\r\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWheel(ev: NativeWheelEvent) {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    // Should we prevent page scroll because of this event\r\n    if (\r\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\r\n    ) {\r\n      ev.preventDefault();\r\n    }\r\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\r\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\r\n\r\n    /**\r\n     * A constant used to normalize wheel events across different browsers\r\n     *\r\n     * This normalization factor is pulled from\r\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n     */\r\n    const ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n    const deltaY =\r\n      ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\r\n    const deltaZ = ev.deltaZ || 0;\r\n    let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n    if (ev.deltaMode) {\r\n      if (ev.deltaMode === 1) {\r\n        deltaMode = WheelDeltaMode.Line;\r\n      } else if (ev.deltaMode === 2) {\r\n        deltaMode = WheelDeltaMode.Page;\r\n      }\r\n    }\r\n\r\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\r\n    this.currentFrameWheel.push(we);\r\n  }\r\n\r\n  /**\r\n   * Triggers an excalibur pointer event in a world space pos\r\n   *\r\n   * Useful for testing pointers in excalibur\r\n   * @param type\r\n   * @param pos\r\n   */\r\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\r\n    const page = this.engine.screen.worldToPageCoordinates(pos);\r\n    // Send an event to the event receiver\r\n    if (window.PointerEvent) {\r\n      this._handle(\r\n        new window.PointerEvent('pointer' + type, {\r\n          pointerId: 0,\r\n          clientX: page.x,\r\n          clientY: page.y\r\n        })\r\n      );\r\n    } else {\r\n      // Safari hack\r\n      this._handle(\r\n        new window.MouseEvent('mouse' + type, {\r\n          clientX: page.x,\r\n          clientY: page.y\r\n        })\r\n      );\r\n    }\r\n\r\n    // Force update pointer system\r\n    const pointerSystem = this.engine.currentScene.world.get(PointerSystem);\r\n    pointerSystem.preupdate(this.engine.currentScene, 1);\r\n    pointerSystem.update(1);\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Gamepads } from './Gamepad';\r\nimport { InputMapper } from './InputMapper';\r\nimport { Keyboard } from './Keyboard';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\n\r\nexport interface InputHostOptions {\r\n  pointerTarget: Document | HTMLCanvasElement;\r\n  grabWindowFocus: boolean;\r\n  engine: Engine;\r\n}\r\n\r\nexport class InputHost {\r\n  private _enabled = true;\r\n\r\n  keyboard: Keyboard;\r\n  pointers: PointerEventReceiver;\r\n  gamepads: Gamepads;\r\n  inputMapper: InputMapper;\r\n\r\n  constructor(options: InputHostOptions) {\r\n    const { pointerTarget, grabWindowFocus, engine } = options;\r\n    this.keyboard = new Keyboard();\r\n    this.pointers = new PointerEventReceiver(pointerTarget, engine);\r\n    this.gamepads = new Gamepads();\r\n\r\n    this.keyboard.init({ grabWindowFocus });\r\n    this.pointers.init({ grabWindowFocus });\r\n    this.gamepads.init();\r\n    this.inputMapper = new InputMapper({\r\n      keyboard: this.keyboard,\r\n      pointers: this.pointers,\r\n      gamepads: this.gamepads\r\n    });\r\n  }\r\n\r\n  get enabled() {\r\n    return this._enabled;\r\n  }\r\n\r\n  toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n    this.keyboard.toggleEnabled(this._enabled);\r\n    this.pointers.toggleEnabled(this._enabled);\r\n    this.gamepads.toggleEnabled(this._enabled);\r\n  }\r\n\r\n  update() {\r\n    if (this._enabled) {\r\n      this.inputMapper.execute();\r\n      this.keyboard.update();\r\n      this.gamepads.update();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.keyboard.clear();\r\n    this.pointers.clear();\r\n    // this.gamepads.clear();\r\n  }\r\n}\r\n","import { isScreenElement, ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw, SceneActivationContext } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { PointerSystem } from './Input/PointerSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\r\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\nimport { PhysicsWorld } from './Collision/PhysicsWorld';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { Color } from './Color';\r\nimport { DefaultLoader } from './Director/DefaultLoader';\r\nimport { Transition } from './Director';\r\nimport { InputHost } from './Input/InputHost';\r\nimport { PointerScope } from './Input/PointerScope';\r\nimport { getDefaultPhysicsConfig } from './Collision/PhysicsConfig';\r\n\r\nexport class PreLoadEvent {\r\n  loader: DefaultLoader;\r\n}\r\n\r\nexport type SceneEvents = {\r\n  initialize: InitializeEvent<Scene>;\r\n  activate: ActivateEvent;\r\n  deactivate: DeactivateEvent;\r\n  preupdate: PreUpdateEvent;\r\n  postupdate: PostUpdateEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n  predebugdraw: PreDebugDrawEvent;\r\n  postdebugdraw: PostDebugDrawEvent;\r\n  preload: PreLoadEvent;\r\n};\r\n\r\nexport const SceneEvents = {\r\n  Initialize: 'initialize',\r\n  Activate: 'activate',\r\n  Deactivate: 'deactivate',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PreDebugDraw: 'predebugdraw',\r\n  PostDebugDraw: 'postdebugdraw',\r\n  PreLoad: 'preload'\r\n};\r\n\r\nexport type SceneConstructor = new (...args: any[]) => Scene;\r\n/**\r\n *\r\n */\r\nexport function isSceneConstructor(x: any): x is SceneConstructor {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\n/**\r\n * {@apilink Actor | `Actors`} are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene<TActivationData = unknown> implements CanInitialize, CanActivate<TActivationData>, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  public events = new EventEmitter<SceneEvents>();\r\n\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * Scene specific background color\r\n   */\r\n  public backgroundColor?: Color;\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world: World = new World(this);\r\n\r\n  /**\r\n   * The Excalibur physics world for the scene. Used to interact\r\n   * with colliders included in the scene.\r\n   *\r\n   * Can be used to perform scene ray casts, track colliders, broadphase, and narrowphase.\r\n   */\r\n  public physics = new PhysicsWorld(getDefaultPhysicsConfig());\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): readonly Actor[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): readonly Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): readonly Trigger[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The {@apilink TileMap}s in the scene, if any\r\n   */\r\n  public get tileMaps(): readonly TileMap[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * Access scene specific input, handlers on this only fire when this scene is active.\r\n   */\r\n  public input: InputHost;\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  public get timers(): readonly Timer[] {\r\n    return this._timers;\r\n  }\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    // Initialize systems\r\n\r\n    // Update\r\n    this.world.add(ActionsSystem);\r\n    this.world.add(new MotionSystem(this.world, this.physics));\r\n    this.world.add(new CollisionSystem(this.world, this.physics));\r\n    this.world.add(PointerSystem);\r\n    this.world.add(IsometricEntitySystem);\r\n    // Draw\r\n    this.world.add(OffscreenSystem);\r\n    this.world.add(GraphicsSystem);\r\n    this.world.add(DebugSystem);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, event: SceneEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Event hook to provide Scenes a way of loading scene specific resources.\r\n   *\r\n   * This is called before the Scene.onInitialize during scene transition. It will only ever fire once for a scene.\r\n   * @param loader\r\n   */\r\n  public onPreLoad(loader: DefaultLoader) {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Event hook fired directly before transition, either \"in\" or \"out\" of the scene\r\n   *\r\n   * This overrides the Engine scene definition. However transitions specified in goToScene take highest precedence\r\n   *\r\n   * ```typescript\r\n   * // Overrides all\r\n   * Engine.goToScene('scene', { destinationIn: ..., sourceOut: ... });\r\n   * ```\r\n   *\r\n   * This can be used to configure custom transitions for a scene dynamically\r\n   */\r\n  public onTransition(direction: 'in' | 'out'): Transition | undefined {\r\n    // will be overridden\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the {@apilink Scene}. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(context: SceneActivationContext<TActivationData>): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(context: SceneActivationContext): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   * @param engine reference to the engine\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   * @param engine reference to the engine\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   *\r\n   */\r\n  public onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   *\r\n   */\r\n  public onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren() {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the {@apilink Scene} has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public async _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      try {\r\n        this.engine = engine;\r\n        // PhysicsWorld config is watched so things will automagically update\r\n        this.physics.config = this.engine.physics;\r\n        this.input = new InputHost({\r\n          pointerTarget: engine.pointerScope === PointerScope.Canvas ? engine.canvas : document,\r\n          grabWindowFocus: engine.grabWindowFocus,\r\n          engine\r\n        });\r\n        // Initialize camera first\r\n        this.camera._initialize(engine);\r\n\r\n        this.world.systemManager.initialize();\r\n\r\n        // This order is important! we want to be sure any custom init that add actors\r\n        // fire before the actor init\r\n        await this.onInitialize(engine);\r\n        this._initializeChildren();\r\n\r\n        this._logger.debug('Scene.onInitialize', this, engine);\r\n        this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      } catch (e) {\r\n        this._logger.error(`Error during scene initialization for scene ${engine.director?.getSceneName(this)}!`);\r\n        throw e;\r\n      }\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public async _activate(context: SceneActivationContext<TActivationData>) {\r\n    try {\r\n      this._logger.debug('Scene.onActivate', this);\r\n      this.input.toggleEnabled(true);\r\n      await this.onActivate(context);\r\n    } catch (e) {\r\n      this._logger.error(`Error during scene activation for scene ${this.engine?.director?.getSceneName(this)}!`);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public async _deactivate(context: SceneActivationContext<never>) {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.input.toggleEnabled(false);\r\n    await this.onDeactivate(context);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for {@apilink onPreDraw} lifecycle event\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, elapsed, this));\r\n    this.onPreDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for {@apilink onPostDraw} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(ctx, elapsed, this));\r\n    this.onPostDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the {@apilink Engine}.\r\n   * @param engine  Reference to the current Engine\r\n   * @param elapsed   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, elapsed: number) {\r\n    if (!this.isInitialized) {\r\n      this._logger.warnOnce(`Scene update called before initialize for scene ${engine.director?.getSceneName(this)}!`);\r\n      return;\r\n    }\r\n    this._preupdate(engine, elapsed);\r\n\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(elapsed);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, elapsed);\r\n\r\n    // Camera last keeps renders smooth that are based on entity/actor\r\n    if (this.camera) {\r\n      this.camera.update(engine, elapsed);\r\n    }\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    this._postupdate(engine, elapsed);\r\n\r\n    this.input.update();\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the {@apilink Engine}.\r\n   * @param ctx    The current rendering context\r\n   * @param elapsed  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    if (!this.isInitialized) {\r\n      this._logger.warnOnce(`Scene draw called before initialize!`);\r\n      return;\r\n    }\r\n    this._predraw(ctx, elapsed);\r\n\r\n    this.world.update(SystemType.Draw, elapsed);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the {@apilink Engine}.\r\n   * @param ctx  The current rendering context\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: ExcaliburGraphicsContext) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the current {@apilink Scene}.\r\n   * @param timer  The timer to add to the current {@apilink Scene}.\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a {@apilink TileMap} to the {@apilink Scene}, once this is done the {@apilink TileMap} will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a {@apilink Trigger} to the {@apilink Scene}, once this is done the {@apilink Trigger} will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the {@apilink Actor} will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds an {@apilink Entity} to the scene, once this is done the {@apilink Actor} will be drawn and updated.\r\n   * @param entity The entity to add to the current scene\r\n   */\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a {@apilink ScreenElement} to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param timer The Timer to transfer to the current scene\r\n   */\r\n  public transfer(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a {@apilink TileMap} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param tileMap The TileMap to transfer to the current scene\r\n   */\r\n  public transfer(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes a {@apilink Trigger} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param trigger The Trigger to transfer to the current scene\r\n   */\r\n  public transfer(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Actor} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param actor The Actor to transfer to the current scene\r\n   */\r\n  public transfer(actor: Actor): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Entity} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param entity The Entity to transfer to the current scene\r\n   */\r\n  public transfer(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a {@apilink ScreenElement} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param screenElement The ScreenElement to transfer to the current scene\r\n   */\r\n  public transfer(screenElement: ScreenElement): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Entity} (Actor, TileMap, Trigger, etc) or {@apilink Timer} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param entity\r\n   */\r\n  public transfer(entity: any): void {\r\n    let scene: Scene;\r\n    if (entity instanceof Entity && entity.scene && entity.scene !== this) {\r\n      scene = entity.scene;\r\n      entity.scene.world.remove(entity, false);\r\n    }\r\n    if (entity instanceof Timer && entity.scene) {\r\n      scene = entity.scene;\r\n      entity.scene.removeTimer(entity);\r\n    }\r\n\r\n    scene?.emit('entityremoved', { target: entity } as any);\r\n    this.add(entity);\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a {@apilink TileMap} from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a {@apilink ScreenElement} to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    this.emit('entityremoved', { target: entity } as any);\r\n    if (entity instanceof Entity) {\r\n      if (entity.isActive) {\r\n        entity.kill();\r\n      }\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and timers from the scene, optionally indicate whether deferred should or shouldn't be used.\r\n   *\r\n   * By default entities use deferred removal\r\n   * @param deferred\r\n   */\r\n  public clear(deferred: boolean = true): void {\r\n    for (let i = this.entities.length - 1; i >= 0; i--) {\r\n      this.world.remove(this.entities[i], deferred);\r\n    }\r\n    for (let i = this.timers.length - 1; i >= 0; i--) {\r\n      this.removeTimer(this.timers[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the scene.\r\n   * @warning Can be dangerous, use {@apilink cancelTimer} instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a {@apilink Timer}, removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a {@apilink Timer} is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const actors = this.actors;\r\n    for (let i = 0; i < actors.length; i++) {\r\n      const actor = actors[i];\r\n      if (actor instanceof ScreenElement) {\r\n        engine.stats.currFrame.actors.ui++;\r\n      }\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (let j = 0; j < actor.children.length; j++) {\r\n        const child = actor.children[j];\r\n        if (isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export enum ColorBlindnessMode {\r\n  Protanope = 'Protanope',\r\n  Deuteranope = 'Deuteranope',\r\n  Tritanope = 'Tritanope'\r\n}\r\n","import { Logger } from '../../Util/Log';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexBuffer } from '../Context/vertex-buffer';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\n\r\n/**\r\n * Helper that defines a whole screen renderer, just provide a fragment source!\r\n *\r\n * Currently supports 1 varying\r\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\r\n */\r\nexport class ScreenShader {\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGL2RenderingContext, fragmentSource: string) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (fragmentSource.includes('v_texcoord')) {\r\n        Logger.getInstance().warn(\r\n          `ScreenShader: \"v_texcoord\" is deprecated in postprocessing fragment shaders will be removed in v1.0,` +\r\n            ` use \"v_uv\" instead. Source [${fragmentSource}]`\r\n        );\r\n      }\r\n    }\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: `#version 300 es\r\n      in vec2 a_position;\r\n      in vec2 a_uv;\r\n      out vec2 v_texcoord;\r\n      out vec2 v_uv;\r\n\r\n      void main() {\r\n        gl_Position = vec4(a_position, 0.0, 1.0);\r\n        // Pass the texcoord to the fragment shader.\r\n        v_texcoord = a_uv;\r\n        v_uv = a_uv;\r\n      }`,\r\n      fragmentSource: fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\r\n\r\n        1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  public getShader() {\r\n    return this._shader;\r\n  }\r\n  public getLayout() {\r\n    return this._layout;\r\n  }\r\n}\r\n","import colorBlindCorrectSource from './color-blind-fragment.glsl';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\nimport { ScreenShader } from './ScreenShader';\r\n\r\nexport class ColorBlindnessPostProcessor implements PostProcessor {\r\n  private _shader!: ScreenShader;\r\n  private _simulate = false;\r\n  constructor(\r\n    private _colorBlindnessMode: ColorBlindnessMode,\r\n    simulate = false\r\n  ) {\r\n    this._simulate = simulate;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext): void {\r\n    this._shader = new ScreenShader(gl, colorBlindCorrectSource);\r\n    this.simulate = this._simulate;\r\n    this.colorBlindnessMode = this._colorBlindnessMode;\r\n  }\r\n\r\n  getShader(): Shader {\r\n    return this._shader.getShader();\r\n  }\r\n\r\n  getLayout(): VertexLayout {\r\n    return this._shader.getLayout();\r\n  }\r\n\r\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\r\n    this._colorBlindnessMode = colorBlindMode;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\r\n        shader.setUniformInt('u_type', 0);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\r\n        shader.setUniformInt('u_type', 1);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\r\n        shader.setUniformInt('u_type', 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  get colorBlindnessMode(): ColorBlindnessMode {\r\n    return this._colorBlindnessMode;\r\n  }\r\n\r\n  set simulate(value: boolean) {\r\n    this._simulate = value;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      shader.setUniformBoolean('u_simulate', value);\r\n    }\r\n  }\r\n\r\n  get simulate(): boolean {\r\n    return this._simulate;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n// our texture\\r\\nuniform sampler2D u_image;\\r\\n// the texCoords passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// color blind type\\r\\nuniform int u_type;\\r\\n\\r\\n// simulation?\\r\\nuniform bool u_simulate;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  vec4 o =  texture(u_image, v_texcoord);\\r\\n  // RGB to LMS matrix conversion\\r\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\r\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\r\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\r\\n  // Simulate color blindness\\r\\n  float l;\\r\\n  float m;\\r\\n  float s;\\r\\n  //MODE CODE//\\r\\n  if (u_type == 0) {\\r\\n    // Protanope\\r\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\r\\n  } else if (u_type == 1) {\\r\\n    // Deuteranope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\r\\n  } else if (u_type == 2) {\\r\\n    // Tritanope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\r\\n  }\\r\\n\\r\\n  // LMS to RGB matrix conversion\\r\\n  vec4 error; // simulate the colors\\r\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\r\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\r\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\r\\n  error.a = 1.0;\\r\\n  vec4 diff = o - error;\\r\\n  vec4 correction; // correct the colors\\r\\n  correction.r = 0.0;\\r\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\r\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\r\\n  correction = o + correction;\\r\\n  correction.a = o.a;\\r\\n  //SIMULATE//\\r\\n\\r\\n  // sim \\r\\n  if (u_simulate) {\\r\\n    fragColor = error.rgba;\\r\\n  } else {\\r\\n    fragColor = correction.rgba;\\r\\n  }\\r\\n}\";","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\nimport { Engine } from '../Engine';\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n  }\n\n  /**\n   * Correct colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public correct(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = false;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Simulate colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public simulate(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = true;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Remove color blindness post processor\n   */\n  public clear() {\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n  }\n}\n","import { ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\nimport { StandardClock, TestClock } from '../Util/Clock';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by {@apilink Engine.timescale}) (in ms)\r\n   *\r\n   * Excalibur extension depends on this\r\n   */\r\n  elapsedMs: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for {@apilink Engine}, after all values have been\r\n * updated during a frame.\r\n */\r\nexport class DebugConfig {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the {@apilink TestClock} and return\r\n   * it in the same running state.\r\n   *\r\n   * This is useful when you need to debug frame by frame.\r\n   */\r\n  public useTestClock(): TestClock {\r\n    const clock = this._engine.clock;\r\n    const wasRunning = clock.isRunning();\r\n    clock.stop();\r\n\r\n    const testClock = clock.toTestClock();\r\n    if (wasRunning) {\r\n      testClock.start();\r\n    }\r\n    this._engine.clock = testClock;\r\n    return testClock;\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the {@apilink StandardClock} and\r\n   * return it in the same running state.\r\n   *\r\n   * This is useful when you need to switch back to normal mode after\r\n   * debugging.\r\n   */\r\n  public useStandardClock(): StandardClock {\r\n    const currentClock = this._engine.clock;\r\n    const wasRunning = currentClock.isRunning();\r\n    currentClock.stop();\r\n\r\n    const standardClock = currentClock.toStandardClock();\r\n    if (wasRunning) {\r\n      standardClock.start();\r\n    }\r\n    this._engine.clock = standardClock;\r\n    return standardClock;\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\r\n     * Best accessed on {@apilink postframe} event. See {@apilink FrameStats}\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\r\n     * Best accessed on {@apilink preframe} event. Best inspected on engine event `preframe`. See {@apilink FrameStats}\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using {@apilink ColorBlindnessPostProcessor}.\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: false,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    debugZIndex: 10_000_000,\r\n    showPosition: false,\r\n    showPositionLabel: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showZIndex: false,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: false,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: false,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green,\r\n    geometryLineWidth: 1,\r\n    geometryPointSize: 0.5\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    contactSize: 2,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n\r\n  public tilemap = {\r\n    showAll: false,\r\n\r\n    showGrid: false,\r\n    gridColor: Color.Red,\r\n    gridWidth: 0.5,\r\n    showSolidBounds: false,\r\n    solidBoundsColor: Color.fromHex('#8080807F'), // grayish\r\n    showColliderGeometry: true\r\n  };\r\n\r\n  public isometric = {\r\n    showAll: false,\r\n    showPosition: false,\r\n    positionColor: Color.Yellow,\r\n    positionSize: 1,\r\n    showGrid: false,\r\n    gridColor: Color.Red,\r\n    gridWidth: 1,\r\n    showColliderGeometry: true\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via {@apilink FrameStats.reset}, avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _elapsedMs: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.elapsedMs = otherStats.elapsedMs;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.elapsedMs = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get elapsedMs() {\r\n    return this._elapsedMs;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set elapsedMs(value: number) {\r\n    this._elapsedMs = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(\r\n    private _windowGlobal: Window,\r\n    private _documentGlobal: Document\r\n  ) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { Resolution } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\nimport { ImageFiltering } from '../Filtering';\r\n\r\nexport type HTMLImageSource = HTMLImageElement | HTMLCanvasElement;\r\n\r\nexport interface AntialiasOptions {\r\n  /**\r\n   * Turns on the special pixel art sampler in excalibur's image shader for sub pixel\r\n   * anti-aliasing\r\n   *\r\n   * Default false\r\n   */\r\n  pixelArtSampler?: boolean;\r\n  /**\r\n   * Configures the webgl's getContext('webgl2', {antialias: true | false}) or configures\r\n   * Canvas2D imageSmoothing = true;\r\n   *\r\n   * **Note** this option is incompatible with `multiSampleAntialiasing`\r\n   *\r\n   * Default false\r\n   */\r\n  nativeContextAntialiasing?: boolean;\r\n  /**\r\n   * Configures the internal render buffer multi-sampling settings\r\n   *\r\n   * Default true, with max samples that the platform supports\r\n   */\r\n  multiSampleAntialiasing?:\r\n    | boolean\r\n    | {\r\n        /**\r\n         * Optionally specify number of samples (will be clamped to the max the platform supports)\r\n         *\r\n         * Default most platforms are 16 samples\r\n         */\r\n        samples: number;\r\n      };\r\n  /**\r\n   * Sets the default image filtering for excalibur\r\n   *\r\n   * Default {@apilink ImageFiltering.Blended}\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Sets the canvas image rendering CSS style\r\n   *\r\n   * Default 'auto'\r\n   */\r\n  canvasImageRendering?: 'pixelated' | 'auto';\r\n}\r\n\r\nexport const DefaultAntialiasOptions: Required<AntialiasOptions> = {\r\n  pixelArtSampler: false,\r\n  nativeContextAntialiasing: false,\r\n  multiSampleAntialiasing: true,\r\n  filtering: ImageFiltering.Blended,\r\n  canvasImageRendering: 'auto'\r\n};\r\n\r\nexport const DefaultPixelArtOptions: Required<AntialiasOptions> = {\r\n  pixelArtSampler: true,\r\n  nativeContextAntialiasing: false,\r\n  multiSampleAntialiasing: true,\r\n  filtering: ImageFiltering.Blended,\r\n  canvasImageRendering: 'auto'\r\n};\r\n\r\nexport interface ExcaliburGraphicsContextOptions {\r\n  /**\r\n   * Target existing html canvas element\r\n   */\r\n  canvasElement: HTMLCanvasElement;\r\n  /**\r\n   * Enables antialiasing on the canvas context (smooths pixels with default canvas sampling)\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Enable the sub pixel antialiasing pixel art sampler for nice looking pixel art\r\n   */\r\n  pixelArtSampler?: boolean;\r\n  /**\r\n   * Enable canvas transparency\r\n   */\r\n  enableTransparency?: boolean;\r\n  /**\r\n   * Enable or disable multi-sample antialiasing in the internal render buffer.\r\n   *\r\n   * If true the max number of samples will be used\r\n   *\r\n   * By default enabled\r\n   */\r\n  multiSampleAntialiasing?:\r\n    | boolean\r\n    | {\r\n        /**\r\n         * Specify number of samples to use during the multi sample anti-alias, if not specified the max will be used.\r\n         * Limited by the hardware (usually 16)\r\n         */\r\n        samples: number;\r\n      };\r\n  /**\r\n   * UV padding in pixels to use in the internal image rendering\r\n   *\r\n   * Recommended .25 - .5 of a pixel\r\n   */\r\n  uvPadding?: number;\r\n  /**\r\n   * Hint the power preference to the graphics context\r\n   */\r\n  powerPreference?: 'default' | 'high-performance' | 'low-power';\r\n  /**\r\n   * Snaps the pixel to an integer value (floor)\r\n   */\r\n  snapToPixel?: boolean;\r\n  /**\r\n   * Current clearing color of the context\r\n   */\r\n  backgroundColor?: Color;\r\n  /**\r\n   * Feature flag that enables draw sorting will removed in v0.29\r\n   */\r\n  useDrawSorting?: boolean;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContextState {\r\n  opacity: number;\r\n  z: number;\r\n  tint: Color | null | undefined;\r\n  material: Material | null | undefined;\r\n}\r\nexport interface LineGraphicsOptions {\r\n  color?: Color;\r\n}\r\n\r\nexport interface RectGraphicsOptions {\r\n  color?: Color;\r\n}\r\n\r\nexport interface PointGraphicsOptions {\r\n  color: Color;\r\n  size: number;\r\n}\r\n\r\nexport interface DebugDraw {\r\n  /**\r\n   * Draw a debugging rectangle to the screen\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   * @param rectOptions\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions?: RectGraphicsOptions): void;\r\n  /**\r\n   * Draw a debugging line to the screen\r\n   * @param start '\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions?: LineGraphicsOptions): void;\r\n  /**\r\n   * Draw a debugging point to the screen\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions?: PointGraphicsOptions): void;\r\n\r\n  /**\r\n   * Draw debug text\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  drawText(text: string, pos: Vector): void;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContext {\r\n  width: number;\r\n  height: number;\r\n\r\n  /**\r\n   * Excalibur will automatically sort draw calls by z and priority for maximal draw performance,\r\n   * this can disrupt a specific desired painter order.\r\n   *\r\n   * To force a specific draw call order, use {@apilink ExcaliburGraphicsContext.z}\r\n   *\r\n   * By default `useDrawSorting` is `true`, to opt out set this to `false`\r\n   */\r\n  useDrawSorting: boolean;\r\n\r\n  /**\r\n   * Set the current z context for the graphics context. Draw calls issued to the context will use this z\r\n   * to inform their sort order.\r\n   *\r\n   * Note it is important to all {@apilink ExcaliburGraphicsContext.save} and {@apilink ExcaliburGraphicsContext.restore} when modifying state.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * Snaps all drawings to the nearest pixel truncated down, by default false\r\n   */\r\n  snapToPixel: boolean;\r\n\r\n  /**\r\n   * Enable smoothed drawing (also known as anti-aliasing), by default true\r\n   */\r\n  smoothing: boolean;\r\n\r\n  /**\r\n   * Set the background color of the graphics context, default is {@apilink Color.ExcaliburBlue}\r\n   */\r\n  backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the opacity of the current {@apilink Graphic} being drawn, default is 1\r\n   */\r\n  opacity: number;\r\n\r\n  /**\r\n   * Sets the tint color to be multiplied by any images drawn, default is black 0xFFFFFFFF\r\n   */\r\n  tint: Color | null | undefined;\r\n\r\n  /**\r\n   * Resets the current transform to the identity matrix\r\n   */\r\n  resetTransform(): void;\r\n\r\n  /**\r\n   * Gets the current transform\r\n   */\r\n  getTransform(): AffineMatrix;\r\n\r\n  /**\r\n   * Multiplies the current transform by a matrix\r\n   * @param m\r\n   */\r\n  multiply(m: AffineMatrix): void;\r\n\r\n  /**\r\n   * Update the context with the current viewport dimensions (used in resizing)\r\n   */\r\n  updateViewport(resolution: Resolution): void;\r\n\r\n  /**\r\n   * Access the debug drawing api\r\n   */\r\n  debug: DebugDraw;\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  /**\r\n   * Draw a solid line to the Excalibur Graphics context\r\n   * @param start\r\n   * @param end\r\n   * @param color\r\n   * @param thickness\r\n   */\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number): void;\r\n\r\n  /**\r\n   * Draw a solid rectangle to the Excalibur Graphics context\r\n   * @param pos\r\n   * @param width\r\n   * @param height\r\n   * @param color\r\n   */\r\n  drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number): void;\r\n\r\n  /**\r\n   * Draw a circle to the Excalibur Graphics context\r\n   * @param pos\r\n   * @param radius\r\n   * @param color\r\n   * @param stroke Optionally specify the stroke color\r\n   * @param thickness\r\n   */\r\n  drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number): void;\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void;\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void;\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void;\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void;\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void;\r\n\r\n  /**\r\n   * Add a post processor to the graphics context\r\n   *\r\n   * Post processors are run in the order they were added.\r\n   * @param postprocessor\r\n   */\r\n  addPostProcessor(postprocessor: PostProcessor): void;\r\n\r\n  /**\r\n   * Remove a specific post processor from the graphics context\r\n   * @param postprocessor\r\n   */\r\n  removePostProcessor(postprocessor: PostProcessor): void;\r\n\r\n  /**\r\n   * Remove all post processors from the graphics context\r\n   */\r\n  clearPostProcessors(): void;\r\n\r\n  /**\r\n   * Updates all post processors in the graphics context\r\n   *\r\n   * Called internally by Excalibur\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  updatePostProcessors(elapsed: number): void;\r\n\r\n  /**\r\n   * Gets or sets the material to be used in the current context's drawings\r\n   *\r\n   * This allows customs shaders to be used but draw calls are no longer batched by default.\r\n   * @param material\r\n   */\r\n  material: Material | null | undefined;\r\n\r\n  /**\r\n   * Creates and initializes the material which compiles the internal shader\r\n   * @param options\r\n   * @returns\r\n   */\r\n  createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material;\r\n\r\n  /**\r\n   * Clears the screen with the current background color\r\n   */\r\n  clear(): void;\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void;\r\n\r\n  beginDrawLifecycle(): void;\r\n\r\n  endDrawLifecycle(): void;\r\n\r\n  dispose(): void;\r\n}\r\n","export interface FpsSamplerOptions {\r\n  /**\r\n   * Specify the sampling period in milliseconds (default 100)\r\n   */\r\n  samplePeriod?: number;\r\n  /**\r\n   * Specify the initial FPS\r\n   */\r\n  initialFps: number;\r\n\r\n  /**\r\n   * Specify the function used to return the current time (in milliseconds)\r\n   */\r\n  nowFn: () => number;\r\n}\r\n\r\nexport class FpsSampler {\r\n  private _fps: number;\r\n  private _samplePeriod: number = 100;\r\n  private _currentFrameTime: number = 0;\r\n  private _frames: number = 0;\r\n  private _previousSampleTime: number = 0;\r\n  private _beginFrameTime: number = 0;\r\n  private _nowFn: () => number;\r\n\r\n  constructor(options: FpsSamplerOptions) {\r\n    this._fps = options.initialFps;\r\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\r\n    this._currentFrameTime = 1000 / options.initialFps;\r\n    this._nowFn = options.nowFn;\r\n    this._previousSampleTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * Start of code block to sample FPS for\r\n   */\r\n  start() {\r\n    this._beginFrameTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * End of code block to sample FPS for\r\n   */\r\n  end() {\r\n    this._frames++;\r\n    const time = this._nowFn();\r\n\r\n    this._currentFrameTime = time - this._beginFrameTime;\r\n\r\n    if (time >= this._previousSampleTime + this._samplePeriod) {\r\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\r\n      this._previousSampleTime = time;\r\n      this._frames = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the currently sampled fps over the last sample period, by default every 100ms\r\n   */\r\n  get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\r\n   */\r\n  get instant() {\r\n    return 1000 / this._currentFrameTime;\r\n  }\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { FpsSampler } from './Fps';\r\n\r\nexport type ScheduledCallbackTiming = 'preframe' | 'postframe' | 'preupdate' | 'postupdate' | 'predraw' | 'postdraw';\r\n\r\nexport interface ClockOptions {\r\n  /**\r\n   * Define the function you'd like the clock to tick when it is started\r\n   */\r\n  tick: (elapsed: number) => any;\r\n  /**\r\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\r\n   */\r\n  onFatalException?: (e: unknown) => any;\r\n  /**\r\n   * Optionally limit the maximum FPS of the clock\r\n   */\r\n  maxFps?: number;\r\n}\r\n\r\n/**\r\n * Abstract Clock is the base type of all Clocks\r\n *\r\n * It has a few opinions\r\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\r\n * 2. The default timing api is implemented in now()\r\n *\r\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\r\n * method is unique to your clock implementation.\r\n */\r\nexport abstract class Clock {\r\n  protected tick: (elapsed: number) => any;\r\n  private _onFatalException: (e: unknown) => any = () => {\r\n    /* default nothing */\r\n  };\r\n  private _maxFps: number = Infinity;\r\n  private _lastTime: number = 0;\r\n  public fpsSampler: FpsSampler;\r\n  private _options: ClockOptions;\r\n  private _elapsed: number = 1;\r\n  private _scheduledCbs: [cb: (elapsed: number) => any, scheduledTime: number, timing: ScheduledCallbackTiming][] = [];\r\n  private _totalElapsed: number = 0;\r\n  constructor(options: ClockOptions) {\r\n    this._options = options;\r\n    this.tick = options.tick;\r\n    this._lastTime = this.now() ?? 0;\r\n    this._maxFps = options.maxFps ?? this._maxFps;\r\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\r\n    this.fpsSampler = new FpsSampler({\r\n      initialFps: 60,\r\n      nowFn: () => this.now()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the elapsed time for the last completed frame\r\n   */\r\n  public elapsed(): number {\r\n    return this._elapsed;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public now(): number {\r\n    return performance.now();\r\n  }\r\n\r\n  public toTestClock() {\r\n    const testClock = new TestClock({\r\n      ...this._options,\r\n      defaultUpdateMs: 16.6\r\n    });\r\n    return testClock;\r\n  }\r\n\r\n  public toStandardClock() {\r\n    const clock = new StandardClock({\r\n      ...this._options\r\n    });\r\n    return clock;\r\n  }\r\n\r\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\r\n    this._onFatalException = handler;\r\n  }\r\n\r\n  /**\r\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur {@apilink Clock}\r\n   *\r\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\r\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\r\n   * stopped or paused.\r\n   * @param cb callback to fire\r\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   * @param timing Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   */\r\n  public schedule(cb: (elapsed: number) => any, timeoutMs: number = 0, timing: ScheduledCallbackTiming = 'preframe') {\r\n    // Scheduled based on internal elapsed time\r\n    const scheduledTime = this._totalElapsed + timeoutMs;\r\n    this._scheduledCbs.push([cb, scheduledTime, timing]);\r\n  }\r\n\r\n  /**\r\n   * Called internally to trigger scheduled callbacks in the clock\r\n   * @param timing\r\n   * @internal\r\n   */\r\n  public __runScheduledCbs(timing: ScheduledCallbackTiming = 'preframe') {\r\n    // walk backwards to delete items as we loop\r\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\r\n      if (timing === this._scheduledCbs[i][2] && this._scheduledCbs[i][1] <= this._totalElapsed) {\r\n        this._scheduledCbs[i][0](this._elapsed);\r\n        this._scheduledCbs.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected update(overrideUpdateMs?: number): void {\r\n    try {\r\n      this.fpsSampler.start();\r\n      // Get the time to calculate time-elapsed\r\n      const now = this.now();\r\n      let elapsed = now - this._lastTime || 1; // first frame\r\n\r\n      // Constrain fps\r\n      const fpsInterval = 1000 / this._maxFps;\r\n\r\n      // only run frame if enough time has elapsed\r\n      if (elapsed >= fpsInterval) {\r\n        let leftover = 0;\r\n        if (fpsInterval !== 0) {\r\n          leftover = elapsed % fpsInterval;\r\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\r\n        }\r\n\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n\r\n        // tick the mainloop and run scheduled callbacks\r\n        this._elapsed = overrideUpdateMs || elapsed;\r\n        this._totalElapsed += this._elapsed;\r\n        this.__runScheduledCbs('preframe');\r\n        this.tick(overrideUpdateMs || elapsed);\r\n        this.__runScheduledCbs('postframe');\r\n\r\n        if (fpsInterval !== 0) {\r\n          this._lastTime = now - leftover;\r\n        } else {\r\n          this._lastTime = now;\r\n        }\r\n        this.fpsSampler.end();\r\n      }\r\n    } catch (e) {\r\n      this._onFatalException(e);\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns if the clock is currently running\r\n   */\r\n  public abstract isRunning(): boolean;\r\n\r\n  /**\r\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\r\n   */\r\n  public abstract start(): void;\r\n\r\n  /**\r\n   * Stop the clock, tick() is no longer called\r\n   */\r\n  public abstract stop(): void;\r\n}\r\n\r\n/**\r\n * The {@apilink StandardClock} implements the requestAnimationFrame browser api to run the tick()\r\n */\r\nexport class StandardClock extends Clock {\r\n  private _running = false;\r\n  private _requestId: number;\r\n  constructor(options: ClockOptions) {\r\n    super(options);\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n\r\n  public start(): void {\r\n    if (this._running) {\r\n      return;\r\n    }\r\n    this._running = true;\r\n    const mainloop = () => {\r\n      // stop the loop\r\n      if (!this._running) {\r\n        return;\r\n      }\r\n      try {\r\n        // request next loop\r\n        this._requestId = window.requestAnimationFrame(mainloop);\r\n        this.update();\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(this._requestId);\r\n        throw e;\r\n      }\r\n    };\r\n\r\n    // begin the first frame\r\n    mainloop();\r\n  }\r\n\r\n  public stop(): void {\r\n    window.cancelAnimationFrame(this._requestId);\r\n    this._running = false;\r\n  }\r\n}\r\n\r\nexport interface TestClockOptions {\r\n  /**\r\n   * Specify the update milliseconds to use for each manual step()\r\n   */\r\n  defaultUpdateMs: number;\r\n}\r\n\r\n/**\r\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\r\n */\r\nexport class TestClock extends Clock {\r\n  private _logger = Logger.getInstance();\r\n  private _updateMs: number;\r\n  private _running: boolean = false;\r\n  private _currentTime = 0;\r\n  constructor(options: ClockOptions & TestClockOptions) {\r\n    super({\r\n      ...options\r\n    });\r\n    this._updateMs = options.defaultUpdateMs;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public override now() {\r\n    return this._currentTime ?? 0;\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n  public start(): void {\r\n    this._running = true;\r\n  }\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n\r\n  /**\r\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\r\n   * @param overrideUpdateMs\r\n   */\r\n  step(overrideUpdateMs?: number): void {\r\n    const time = overrideUpdateMs ?? this._updateMs;\r\n\r\n    if (this._running) {\r\n      // to be comparable to RAF this needs to be a full blown Task\r\n      // For example, images cannot decode synchronously in a single step\r\n      this.update(time);\r\n      this._currentTime += time;\r\n    } else {\r\n      this._logger.warn('The clock is not running, no step will be performed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\r\n   * @param numberOfSteps\r\n   * @param overrideUpdateMs\r\n   */\r\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\r\n    for (let i = 0; i < numberOfSteps; i++) {\r\n      this.step(overrideUpdateMs ?? this._updateMs);\r\n    }\r\n  }\r\n}\r\n","import toasterCss from './Toaster.css';\r\n\r\n/**\r\n * The Toaster is only meant to be called from inside Excalibur to display messages to players\r\n */\r\nexport class Toaster {\r\n  private _styleBlock: HTMLStyleElement;\r\n  private _container: HTMLDivElement;\r\n  private _toasterCss: string = toasterCss.toString();\r\n\r\n  private _isInitialized = false;\r\n  private _initialize() {\r\n    if (!this._isInitialized) {\r\n      this._container = document.createElement('div');\r\n      this._container.id = 'ex-toast-container';\r\n      document.body.appendChild(this._container);\r\n      this._isInitialized = true;\r\n\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._toasterCss;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n  }\r\n\r\n  public dispose() {\r\n    this._container.parentElement.removeChild(this._container);\r\n\r\n    this._styleBlock.parentElement.removeChild(this._styleBlock);\r\n\r\n    this._isInitialized = false;\r\n  }\r\n\r\n  private _createFragment(message: string) {\r\n    const toastMessage = document.createElement('span');\r\n    toastMessage.innerText = message;\r\n    return toastMessage;\r\n  }\r\n\r\n  /**\r\n   * Display a toast message to a player\r\n   * @param message Text of the message, messages may have a single \"[LINK]\" to influence placement\r\n   * @param linkTarget Optionally specify a link location\r\n   * @param linkName Optionally specify a name for that link location\r\n   */\r\n  public toast(message: string, linkTarget?: string, linkName?: string) {\r\n    this._initialize();\r\n    const toast = document.createElement('div');\r\n    toast.className = 'ex-toast-message';\r\n\r\n    const messageFragments: HTMLElement[] = message.split('[LINK]').map((message) => this._createFragment(message));\r\n\r\n    if (linkTarget) {\r\n      const link = document.createElement('a');\r\n      link.href = linkTarget;\r\n      if (linkName) {\r\n        link.innerText = linkName;\r\n      } else {\r\n        link.innerText = linkTarget;\r\n      }\r\n      messageFragments.splice(1, 0, link);\r\n    }\r\n\r\n    // Assembly message\r\n    const finalMessage = document.createElement('div');\r\n    messageFragments.forEach((message) => {\r\n      finalMessage.appendChild(message);\r\n    });\r\n    toast.appendChild(finalMessage);\r\n\r\n    // Dismiss button\r\n    const dismissBtn = document.createElement('button');\r\n    dismissBtn.innerText = 'x';\r\n    dismissBtn.addEventListener('click', () => {\r\n      this._container.removeChild(toast);\r\n    });\r\n    toast.appendChild(dismissBtn);\r\n\r\n    // Escape to dismiss\r\n    const keydownHandler = (evt: KeyboardEvent) => {\r\n      if (evt.key === 'Escape') {\r\n        try {\r\n          this._container.removeChild(toast);\r\n        } catch {\r\n          // pass\r\n        }\r\n      }\r\n      document.removeEventListener('keydown', keydownHandler);\r\n    };\r\n    document.addEventListener('keydown', keydownHandler);\r\n\r\n    // Insert into container\r\n    const first = this._container.firstChild;\r\n    this._container.insertBefore(toast, first);\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { DefaultLoader, LoaderConstructor, isLoaderConstructor } from './DefaultLoader';\r\nimport { Scene, SceneConstructor, isSceneConstructor } from '../Scene';\r\nimport { Transition } from './Transition';\r\nimport { Loader } from './Loader';\r\nimport { Logger } from '../Util/Log';\r\nimport { ActivateEvent, DeactivateEvent } from '../Events';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport interface DirectorNavigationEvent {\r\n  sourceName: string;\r\n  sourceScene: Scene;\r\n  destinationName: string;\r\n  destinationScene: Scene;\r\n}\r\n\r\nexport type DirectorEvents = {\r\n  navigationstart: DirectorNavigationEvent;\r\n  navigation: DirectorNavigationEvent;\r\n  navigationend: DirectorNavigationEvent;\r\n};\r\n\r\nexport const DirectorEvents = {\r\n  NavigationStart: 'navigationstart',\r\n  Navigation: 'navigation',\r\n  NavigationEnd: 'navigationend'\r\n};\r\n\r\nexport interface SceneWithOptions {\r\n  /**\r\n   * Scene associated with this route\r\n   *\r\n   * If a constructor is provided it will not be constructed until navigation is requested\r\n   */\r\n  scene: Scene | SceneConstructor;\r\n  /**\r\n   * Specify scene transitions\r\n   */\r\n  transitions?: {\r\n    /**\r\n     * Optionally specify a transition when going \"in\" to this scene\r\n     */\r\n    in?: Transition;\r\n    /**\r\n     * Optionally specify a transition when going \"out\" of this scene\r\n     */\r\n    out?: Transition;\r\n  };\r\n  /**\r\n   * Optionally specify a loader for the scene\r\n   */\r\n  loader?: DefaultLoader | LoaderConstructor;\r\n}\r\n\r\nexport type WithRoot<TScenes> = TScenes | 'root';\r\n\r\nexport type SceneMap<TKnownScenes extends string = any> = Record<TKnownScenes, Scene | SceneConstructor | SceneWithOptions>;\r\n\r\nexport interface StartOptions {\r\n  /**\r\n   * Optionally provide first transition from the game start screen\r\n   */\r\n  inTransition?: Transition;\r\n  /**\r\n   * Optionally provide a main loader to run before the game starts\r\n   */\r\n  loader?: DefaultLoader | LoaderConstructor;\r\n}\r\n\r\n/**\r\n * Provide scene activation data and override any existing configured route transitions or loaders\r\n */\r\nexport interface GoToOptions<TActivationData = any> {\r\n  /**\r\n   * Optionally supply scene activation data passed to Scene.onActivate\r\n   */\r\n  sceneActivationData?: TActivationData;\r\n  /**\r\n   * Optionally supply destination scene \"in\" transition, this will override any previously defined transition\r\n   */\r\n  destinationIn?: Transition;\r\n  /**\r\n   * Optionally supply source scene \"out\" transition, this will override any previously defined transition\r\n   */\r\n  sourceOut?: Transition;\r\n  /**\r\n   * Optionally supply a different loader for the destination scene, this will override any previously defined loader\r\n   */\r\n  loader?: DefaultLoader;\r\n}\r\n\r\n/**\r\n * The Director is responsible for managing scenes and changing scenes in Excalibur.\r\n *\r\n * It deals with transitions, scene loaders, switching scenes\r\n *\r\n * This is used internally by Excalibur, generally not mean to\r\n * be instantiated end users directly.\r\n */\r\nexport class Director<TKnownScenes extends string = any> {\r\n  public events = new EventEmitter<DirectorEvents>();\r\n  private _logger = Logger.getInstance();\r\n  private _deferredGoto?: string;\r\n  private _deferredTransition?: Transition;\r\n  private _initialized = false;\r\n\r\n  /**\r\n   * Current scene's name\r\n   */\r\n  currentSceneName: string;\r\n  /**\r\n   * Current scene playing in excalibur\r\n   */\r\n  currentScene: Scene;\r\n  /**\r\n   * Current transition if any\r\n   */\r\n  currentTransition?: Transition;\r\n\r\n  /**\r\n   * All registered scenes in Excalibur\r\n   */\r\n  public readonly scenes: SceneMap<WithRoot<TKnownScenes>> = {} as SceneMap<WithRoot<TKnownScenes>>;\r\n\r\n  /**\r\n   * Holds all instantiated scenes\r\n   */\r\n  private _sceneToInstance = new Map<string, Scene>();\r\n\r\n  startScene?: string;\r\n  mainLoader?: DefaultLoader;\r\n\r\n  /**\r\n   * The default {@apilink Scene} of the game, use {@apilink Engine.goToScene} to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  private _sceneToLoader = new Map<string, DefaultLoader>();\r\n  private _sceneToTransition = new Map<string, { in?: Transition; out?: Transition }>();\r\n  /**\r\n   * Used to keep track of scenes that have already been loaded so we don't load multiple times\r\n   */\r\n  private _loadedScenes = new Set<Scene>();\r\n\r\n  private _isTransitioning = false;\r\n\r\n  /**\r\n   * Gets whether the director currently transitioning between scenes\r\n   *\r\n   * Useful if you need to block behavior during transition\r\n   */\r\n  public get isTransitioning() {\r\n    return this._isTransitioning;\r\n  }\r\n\r\n  constructor(\r\n    private _engine: Engine,\r\n    scenes: SceneMap<TKnownScenes>\r\n  ) {\r\n    this.rootScene = this.currentScene = new Scene();\r\n    this.add('root', this.rootScene);\r\n    this.currentScene = this.rootScene;\r\n    this.currentSceneName = 'root';\r\n    for (const sceneKey in scenes) {\r\n      const sceneOrOptions = scenes[sceneKey];\r\n      this.add(sceneKey, sceneOrOptions);\r\n      if (sceneKey === 'root') {\r\n        this.rootScene = this.getSceneInstance('root')!; // always a root scene\r\n        this.currentScene = this.rootScene;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the director's internal state\r\n   */\r\n  async onInitialize() {\r\n    if (!this._initialized) {\r\n      this._initialized = true;\r\n      if (this._deferredGoto) {\r\n        const deferredScene = this._deferredGoto;\r\n        this._deferredGoto = undefined;\r\n        const deferredTransition = this._deferredTransition;\r\n        this._deferredTransition = undefined;\r\n        const deferredSceneInstance = this.getSceneInstance(deferredScene);\r\n        if (deferredSceneInstance && deferredTransition) {\r\n          deferredTransition._addToTargetScene(this._engine, deferredSceneInstance);\r\n        }\r\n        await this.swapScene(deferredScene);\r\n        if (deferredSceneInstance && deferredTransition) {\r\n          await this.playTransition(deferredTransition, deferredSceneInstance);\r\n        }\r\n      } else {\r\n        await this.swapScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  get isInitialized() {\r\n    return this._initialized;\r\n  }\r\n\r\n  /**\r\n   * Configures the start scene, and optionally the transition & loader for the director\r\n   *\r\n   * Typically this is called at the beginning of the game to the start scene and transition and never again.\r\n   * @param startScene\r\n   * @param options\r\n   */\r\n  configureStart(startScene: WithRoot<TKnownScenes>, options?: StartOptions) {\r\n    const maybeLoaderOrCtor = options?.loader;\r\n    if (maybeLoaderOrCtor instanceof DefaultLoader) {\r\n      this.mainLoader = maybeLoaderOrCtor;\r\n    } else if (isLoaderConstructor(maybeLoaderOrCtor)) {\r\n      this.mainLoader = new maybeLoaderOrCtor();\r\n    } else {\r\n      this.mainLoader = new Loader();\r\n    }\r\n\r\n    let maybeStartTransition: Transition | undefined;\r\n\r\n    if (options?.inTransition) {\r\n      const { inTransition } = options;\r\n      maybeStartTransition = inTransition;\r\n    }\r\n\r\n    this.startScene = startScene;\r\n\r\n    // Fire and forget promise for the initial scene\r\n    if (maybeStartTransition) {\r\n      const startSceneInstance = this.getSceneInstance(this.startScene);\r\n      if (startSceneInstance) {\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        maybeStartTransition._addToTargetScene(this._engine, startSceneInstance);\r\n        this.swapScene(this.startScene).then(() => {\r\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n          return this.playTransition(maybeStartTransition, startSceneInstance);\r\n        });\r\n      }\r\n    } else {\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.swapScene(this.startScene);\r\n    }\r\n\r\n    this.currentSceneName = this.startScene;\r\n  }\r\n\r\n  private _getLoader(sceneName: string) {\r\n    return this._sceneToLoader.get(sceneName);\r\n  }\r\n\r\n  private _getInTransition(sceneName: string): Transition | undefined {\r\n    const sceneOrRoute = this.scenes[sceneName as TKnownScenes];\r\n    if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\r\n      return undefined;\r\n    }\r\n    return sceneOrRoute?.transitions?.in;\r\n  }\r\n\r\n  private _getOutTransition(sceneName: string): Transition | undefined {\r\n    const sceneOrRoute = this.scenes[sceneName as TKnownScenes];\r\n    if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\r\n      return undefined;\r\n    }\r\n    return sceneOrRoute?.transitions?.out;\r\n  }\r\n\r\n  getDeferredScene() {\r\n    const maybeDeferred = this.getSceneDefinition(this._deferredGoto);\r\n    if (this._deferredGoto && maybeDeferred) {\r\n      return maybeDeferred;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns a scene by name if it exists, might be the constructor and not the instance of a scene\r\n   * @param name\r\n   */\r\n  getSceneDefinition(name?: string): Scene | SceneConstructor | undefined {\r\n    const maybeScene = this.scenes[name as TKnownScenes];\r\n    if (maybeScene instanceof Scene || isSceneConstructor(maybeScene)) {\r\n      return maybeScene;\r\n    } else if (maybeScene) {\r\n      return maybeScene.scene;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Returns the name of the registered scene, null if none can be found\r\n   * @param scene\r\n   */\r\n  getSceneName(scene: Scene): string | null {\r\n    for (const [name, maybeScene] of Object.entries(this.scenes)) {\r\n      if (maybeScene instanceof Scene) {\r\n        if (scene === maybeScene) {\r\n          return name;\r\n        }\r\n      } else if (!isSceneConstructor(maybeScene)) {\r\n        if (scene === maybeScene.scene) {\r\n          return name;\r\n        }\r\n      }\r\n    }\r\n\r\n    for (const [name, maybeScene] of Object.entries(this.scenes)) {\r\n      if (isSceneConstructor(maybeScene)) {\r\n        if (scene.constructor === maybeScene) {\r\n          return name;\r\n        }\r\n      } else if (!(maybeScene instanceof Scene)) {\r\n        if (scene.constructor === maybeScene.scene) {\r\n          return name;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the same Director, but asserts a scene DOES exist to the type system\r\n   * @param name\r\n   */\r\n  assertAdded<TScene extends string>(name: TScene): Director<TKnownScenes | TScene> {\r\n    return this as Director<TKnownScenes | TScene>;\r\n  }\r\n\r\n  /**\r\n   * Returns the same Director, but asserts a scene DOES NOT exist to the type system\r\n   * @param name\r\n   */\r\n  assertRemoved<TScene extends string>(name: TScene): Director<Exclude<TKnownScenes, TScene>> {\r\n    return this as Director<Exclude<TKnownScenes, TScene>>;\r\n  }\r\n\r\n  /**\r\n   * Adds additional Scenes to the game!\r\n   * @param name\r\n   * @param sceneOrRoute\r\n   */\r\n  add<TScene extends string>(name: TScene, sceneOrRoute: Scene | SceneConstructor | SceneWithOptions): Director<TKnownScenes | TScene> {\r\n    if (!(sceneOrRoute instanceof Scene) && !isSceneConstructor(sceneOrRoute)) {\r\n      const { loader, transitions } = sceneOrRoute;\r\n      const { in: inTransition, out: outTransition } = transitions ?? {};\r\n      this._sceneToTransition.set(name, { in: inTransition, out: outTransition });\r\n\r\n      if (isLoaderConstructor(loader)) {\r\n        this._sceneToLoader.set(name, new loader());\r\n      } else if (loader) {\r\n        this._sceneToLoader.set(name, loader);\r\n      }\r\n    }\r\n\r\n    if (this.scenes[name as unknown as TKnownScenes]) {\r\n      this._logger.warn('Scene', name, 'already exists overwriting');\r\n    }\r\n    this.scenes[name as unknown as TKnownScenes] = sceneOrRoute;\r\n    return this.assertAdded(name);\r\n  }\r\n\r\n  remove(scene: Scene): void;\r\n  remove(sceneCtor: SceneConstructor): void;\r\n  remove(name: WithRoot<TKnownScenes>): void;\r\n  remove(nameOrScene: TKnownScenes | Scene | SceneConstructor | string) {\r\n    if (nameOrScene instanceof Scene || isSceneConstructor(nameOrScene)) {\r\n      const sceneOrCtor = nameOrScene;\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          const potentialSceneOrOptions = this.scenes[key as TKnownScenes];\r\n          let scene: Scene | SceneConstructor;\r\n          if (potentialSceneOrOptions instanceof Scene || isSceneConstructor(potentialSceneOrOptions)) {\r\n            scene = potentialSceneOrOptions;\r\n          } else {\r\n            scene = potentialSceneOrOptions.scene;\r\n          }\r\n\r\n          if (scene === sceneOrCtor) {\r\n            if (key === this.currentSceneName) {\r\n              throw new Error(`Cannot remove a currently active scene: ${key}`);\r\n            }\r\n\r\n            this._sceneToInstance.delete(key);\r\n            this._sceneToTransition.delete(key);\r\n            this._sceneToLoader.delete(key);\r\n            delete this.scenes[key as TKnownScenes];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (typeof nameOrScene === 'string') {\r\n      if (nameOrScene === this.currentSceneName) {\r\n        throw new Error(`Cannot remove a currently active scene: ${nameOrScene}`);\r\n      }\r\n\r\n      // remove scene\r\n      this._sceneToInstance.delete(nameOrScene);\r\n      this._sceneToTransition.delete(nameOrScene);\r\n      this._sceneToLoader.delete(nameOrScene);\r\n      delete this.scenes[nameOrScene as TKnownScenes];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Go to a specific scene, and optionally override loaders and transitions\r\n   * @param destinationScene\r\n   * @param options\r\n   */\r\n  async goToScene(destinationScene: TKnownScenes | string, options?: GoToOptions) {\r\n    const maybeDest = this.getSceneInstance(destinationScene);\r\n    if (!maybeDest) {\r\n      this._logger.warn(`Scene ${destinationScene} does not exist! Check the name, are you sure you added it?`);\r\n      return;\r\n    }\r\n    const sourceSceneInstance = this.currentScene;\r\n    const sourceScene = this.currentSceneName;\r\n    const engineInputEnabled = this._engine.input?.enabled ?? true;\r\n    this._isTransitioning = true;\r\n\r\n    const maybeSourceOut = this.getSceneInstance(sourceScene)?.onTransition('out');\r\n    const maybeDestinationIn = maybeDest?.onTransition('in');\r\n\r\n    options = {\r\n      // Engine configuration then dynamic scene transitions\r\n      ...{ sourceOut: this._getOutTransition(this.currentSceneName) ?? maybeSourceOut },\r\n      ...{ destinationIn: this._getInTransition(destinationScene) ?? maybeDestinationIn },\r\n      // Goto options\r\n      ...options\r\n    };\r\n\r\n    const { sourceOut, destinationIn, sceneActivationData } = options;\r\n\r\n    const outTransition = sourceOut ?? this._getOutTransition(this.currentSceneName);\r\n    const inTransition = destinationIn ?? this._getInTransition(destinationScene);\r\n\r\n    const hideLoader = outTransition?.hideLoader || inTransition?.hideLoader;\r\n    if (hideLoader) {\r\n      // Start hidden loader early and take advantage of the transition\r\n      // Don't await and block on a hidden loader\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.maybeLoadScene(destinationScene, hideLoader);\r\n    }\r\n\r\n    this._emitEvent('navigationstart', sourceScene, destinationScene);\r\n\r\n    // Run the out transition on the current scene if present\r\n    if (outTransition) {\r\n      await this.playTransition(outTransition, sourceSceneInstance);\r\n    }\r\n\r\n    // Run the loader if present\r\n    await this.maybeLoadScene(destinationScene, hideLoader);\r\n\r\n    // Give incoming transition a chance to grab info from previous\r\n    if (inTransition) {\r\n      await inTransition.onPreviousSceneDeactivate(this.currentScene);\r\n    }\r\n\r\n    // Setup the in transition on the destination scene if present\r\n    // this is important to it can be initialized with the\r\n    if (inTransition) {\r\n      inTransition._addToTargetScene(this._engine, maybeDest);\r\n    }\r\n\r\n    // Swap to the new scene\r\n    // Runs scene lifecycle init and activate\r\n    await this.swapScene(destinationScene, sceneActivationData);\r\n    this._emitEvent('navigation', sourceScene, destinationScene);\r\n\r\n    // Run the in transition on the new scene if present\r\n    if (inTransition) {\r\n      await this.playTransition(inTransition, maybeDest);\r\n    }\r\n    this._emitEvent('navigationend', sourceScene, destinationScene);\r\n\r\n    this._engine.input?.toggleEnabled(engineInputEnabled);\r\n    this._isTransitioning = false;\r\n  }\r\n\r\n  /**\r\n   * Retrieves a scene instance by key if it's registered.\r\n   *\r\n   * This will call any constructors that were given as a definition\r\n   * @param scene\r\n   */\r\n  getSceneInstance(scene: string): Scene | undefined {\r\n    const sceneDefinition = this.getSceneDefinition(scene);\r\n    if (!sceneDefinition) {\r\n      return undefined;\r\n    }\r\n    if (this._sceneToInstance.has(scene)) {\r\n      return this._sceneToInstance.get(scene) as Scene;\r\n    }\r\n    if (sceneDefinition instanceof Scene) {\r\n      this._sceneToInstance.set(scene, sceneDefinition);\r\n      return sceneDefinition;\r\n    }\r\n    const newScene = new sceneDefinition();\r\n    this._sceneToInstance.set(scene, newScene);\r\n    return newScene;\r\n  }\r\n\r\n  /**\r\n   * Triggers scene loading if has not already been loaded\r\n   * @param scene\r\n   * @param hideLoader\r\n   */\r\n  async maybeLoadScene(scene: string, hideLoader = false) {\r\n    const loader = this._getLoader(scene) ?? new DefaultLoader();\r\n    const sceneToLoad = this.getSceneDefinition(scene);\r\n    const sceneToLoadInstance = this.getSceneInstance(scene);\r\n    if (sceneToLoad && sceneToLoadInstance && !this._loadedScenes.has(sceneToLoadInstance)) {\r\n      sceneToLoadInstance.onPreLoad(loader);\r\n      sceneToLoadInstance.events.emit('preload', { loader });\r\n      if (hideLoader) {\r\n        // Don't await a hidden loader\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._engine.load(loader, hideLoader);\r\n      } else {\r\n        await this._engine.load(loader);\r\n      }\r\n      this._loadedScenes.add(sceneToLoadInstance);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays a transition in the current scene and does book keeping for input.\r\n   * @param transition\r\n   */\r\n  async playTransition(transition: Transition, targetScene: Scene) {\r\n    if (!this.isInitialized) {\r\n      this._deferredTransition = transition;\r\n      return;\r\n    }\r\n\r\n    if (transition) {\r\n      this.currentTransition = transition;\r\n      const sceneInputEnabled = targetScene.input?.enabled ?? true;\r\n\r\n      targetScene.input?.toggleEnabled(!transition.blockInput);\r\n      this._engine.input?.toggleEnabled(!transition.blockInput);\r\n\r\n      this.currentTransition._addToTargetScene(this._engine, targetScene);\r\n      await this.currentTransition._play();\r\n\r\n      targetScene.input?.toggleEnabled(sceneInputEnabled);\r\n    }\r\n    this.currentTransition?.kill();\r\n    this.currentTransition?.reset();\r\n    this.currentTransition = undefined;\r\n  }\r\n\r\n  /**\r\n   * Swaps the current and destination scene after performing required lifecycle events\r\n   * @param destinationScene\r\n   * @param data\r\n   */\r\n  async swapScene<TData = undefined>(destinationScene: string, data?: TData): Promise<void> {\r\n    const engine = this._engine;\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoto = destinationScene;\r\n      return;\r\n    }\r\n\r\n    const maybeDest = this.getSceneInstance(destinationScene);\r\n\r\n    if (maybeDest) {\r\n      const previousScene = this.currentScene;\r\n      const nextScene = maybeDest;\r\n\r\n      this._logger.debug('Going to scene:', destinationScene);\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        const context = { engine, previousScene, nextScene };\r\n        await this.currentScene._deactivate(context);\r\n        this.currentScene.events.emit('deactivate', new DeactivateEvent(context, this.currentScene));\r\n        this.currentScene.input.clear();\r\n      }\r\n\r\n      // wait for the scene to be loaded if needed\r\n      const destLoader = this._sceneToLoader.get(destinationScene);\r\n      await destLoader?.areResourcesLoaded();\r\n\r\n      // set current scene to new one\r\n      this.currentScene = nextScene;\r\n      this.currentSceneName = destinationScene;\r\n      engine.screen.setCurrentCamera(nextScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      await this.currentScene._initialize(engine);\r\n\r\n      const context = { engine, previousScene, nextScene, data };\r\n      await this.currentScene._activate(context);\r\n      this.currentScene.events.emit('activate', new ActivateEvent(context, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', destinationScene, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  private _emitEvent(eventName: keyof DirectorEvents, sourceScene: string, destinationScene: string) {\r\n    const source = this.getSceneDefinition(sourceScene)!;\r\n    const dest = this.getSceneDefinition(destinationScene)!;\r\n    this.events.emit(eventName, {\r\n      sourceScene: source,\r\n      sourceName: sourceScene,\r\n      destinationScene: dest,\r\n      destinationName: destinationScene\r\n    } as DirectorNavigationEvent);\r\n  }\r\n}\r\n","export interface Context<TValue> {\r\n  /**\r\n   * Run the callback before popping the context value\r\n   * @param value\r\n   * @param cb\r\n   */\r\n  scope: <TReturn>(value: TValue, cb: () => TReturn) => TReturn;\r\n  value: TValue;\r\n}\r\n\r\n/**\r\n * Creates a injectable context that can be retrieved later with `useContext(context)`\r\n *\r\n * Example\r\n * ```typescript\r\n *\r\n * const AppContext = createContext({some: 'value'});\r\n * context.scope(val, () => {\r\n *    const value = useContext(AppContext);\r\n * })\r\n *\r\n * ```\r\n */\r\nexport function createContext<TValue>() {\r\n  const ctx: Context<TValue> = {\r\n    scope: (value, cb) => {\r\n      const old = ctx.value;\r\n      ctx.value = value;\r\n      try {\r\n        return cb();\r\n      } catch (e) {\r\n        throw e;\r\n      } finally {\r\n        ctx.value = old;\r\n      }\r\n    },\r\n    value: undefined\r\n  };\r\n  return ctx;\r\n}\r\n\r\n/**\r\n * Retrieves the value from the current context\r\n */\r\nexport function useContext<TValue>(context: Context<TValue>): TValue {\r\n  return context.value;\r\n}\r\n","export interface GarbageCollectionOptions {\r\n  /**\r\n   * Textures that aren't drawn after a certain number of milliseconds are unloaded from the GPU\r\n   * Default 60_000 ms\r\n   */\r\n  textureCollectInterval?: number; // default 60_000 ms\r\n  // TODO future work to integrate the font and text configuration, refactor existing collection mechanism\r\n  // /**\r\n  //  * Font pre-renders that aren't drawn after a certain number of milliseconds are unloaded from the GPU\r\n  //  * Default 60_000 ms\r\n  //  */\r\n  // fontCollectInterval: number; // default 60_000 ms\r\n  // /**\r\n  //  * Text measurements that aren't used after a certain number of milliseconds are unloaded from the GPU\r\n  //  * Default 60_000 ms\r\n  //  */\r\n  // textMeasurementCollectInterval: number; // default 60_000 ms\r\n}\r\n\r\nexport const DefaultGarbageCollectionOptions: GarbageCollectionOptions = {\r\n  textureCollectInterval: 60_000\r\n  // TODO future work to integrate the font and text configuration, refactor existing collection mechanism\r\n  // fontCollectInterval: 60_000,\r\n  // textMeasurementCollectInterval: 60_000,\r\n};\r\n\r\nexport interface GarbageCollectorOptions {\r\n  /**\r\n   * Returns a timestamp in milliseconds representing now\r\n   */\r\n  getTimestamp: () => number;\r\n}\r\n\r\nexport class GarbageCollector {\r\n  private _collectHandle: number;\r\n  private _running = false;\r\n  private _collectionMap = new Map<any, [type: string, time: number]>();\r\n  private _collectors = new Map<string, [(resource: any) => boolean, interval: number]>();\r\n\r\n  constructor(public options: GarbageCollectorOptions) {}\r\n\r\n  /**\r\n   *\r\n   * @param type Resource type\r\n   * @param timeoutInterval If resource type exceeds interval in milliseconds collect() is called\r\n   * @param collect Collection implementation, returns true if collected\r\n   */\r\n  registerCollector(type: string, timeoutInterval: number, collect: (resource: any) => boolean) {\r\n    this._collectors.set(type, [collect, timeoutInterval]);\r\n  }\r\n\r\n  /**\r\n   * Add a resource to be tracked for collection\r\n   * @param type\r\n   * @param resource\r\n   */\r\n  addCollectableResource(type: string, resource: any) {\r\n    this._collectionMap.set(resource, [type, this.options.getTimestamp()]);\r\n  }\r\n\r\n  /**\r\n   * Update the resource last used timestamp preventing collection\r\n   * @param resource\r\n   */\r\n  touch(resource: any) {\r\n    const collectionData = this._collectionMap.get(resource);\r\n    if (collectionData) {\r\n      this._collectionMap.set(resource, [collectionData[0], this.options.getTimestamp()]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Runs the collection loop to cleanup any stale resources given the registered collect handlers\r\n   */\r\n  public collectStaleResources = (deadline?: IdleDeadline) => {\r\n    if (!this._running) {\r\n      return;\r\n    }\r\n    for (const [type, [collector, timeoutInterval]] of this._collectors.entries()) {\r\n      const now = this.options.getTimestamp();\r\n      for (const [resource, [resourceType, time]] of this._collectionMap.entries()) {\r\n        if (type !== resourceType || time + timeoutInterval >= now) {\r\n          continue;\r\n        }\r\n\r\n        const collected = collector(resource);\r\n        if (collected) {\r\n          this._collectionMap.delete(resource);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._collectHandle = requestIdleCallback(this.collectStaleResources);\r\n  };\r\n\r\n  /**\r\n   * Force collect all resources, useful for shutting down a game\r\n   * or if you know that you will not use anything you've allocated before now\r\n   */\r\n  public forceCollectAll() {\r\n    for (const [_, [collector]] of this._collectors.entries()) {\r\n      for (const [resource] of this._collectionMap.entries()) {\r\n        const collected = collector(resource);\r\n        if (collected) {\r\n          this._collectionMap.delete(resource);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Starts the garbage collection loop\r\n   */\r\n  start() {\r\n    this._running = true;\r\n    this.collectStaleResources();\r\n  }\r\n\r\n  /**\r\n   * Stops the garbage collection loop\r\n   */\r\n  stop() {\r\n    this._running = false;\r\n    cancelIdleCallback(this._collectHandle);\r\n  }\r\n}\r\n","import { EX_VERSION } from './';\r\nimport { Future } from './Util/Future';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { PointerScope } from './Input/PointerScope';\r\nimport { Flags } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, Resolution, ViewportDimension } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { DefaultLoader } from './Director/DefaultLoader';\r\nimport { Loader } from './Director/Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene, SceneConstructor, isSceneConstructor } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { DebugConfig, DebugStats } from './Debug/DebugConfig';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport {\r\n  AntialiasOptions,\r\n  DefaultAntialiasOptions,\r\n  DefaultPixelArtOptions,\r\n  ExcaliburGraphicsContext,\r\n  ExcaliburGraphicsContext2DCanvas,\r\n  ExcaliburGraphicsContextWebGL,\r\n  TextureLoader\r\n} from './Graphics';\r\nimport { Clock, StandardClock } from './Util/Clock';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\r\nimport { Toaster } from './Util/Toaster';\r\nimport { InputMapper } from './Input/InputMapper';\r\nimport { GoToOptions, SceneMap, Director, StartOptions, SceneWithOptions, WithRoot } from './Director/Director';\r\nimport { InputHost } from './Input/InputHost';\r\nimport { getDefaultPhysicsConfig, PhysicsConfig } from './Collision/PhysicsConfig';\r\nimport { DeepRequired } from './Util/Required';\r\nimport { Context, createContext, useContext } from './Context';\r\nimport { DefaultGarbageCollectionOptions, GarbageCollectionOptions, GarbageCollector } from './GarbageCollector';\r\nimport { mergeDeep } from './Util/Util';\r\n\r\nexport type EngineEvents = {\r\n  fallbackgraphicscontext: ExcaliburGraphicsContext2DCanvas;\r\n  initialize: InitializeEvent<Engine>;\r\n  visible: VisibleEvent;\r\n  hidden: HiddenEvent;\r\n  start: GameStartEvent;\r\n  stop: GameStopEvent;\r\n  preupdate: PreUpdateEvent<Engine>;\r\n  postupdate: PostUpdateEvent<Engine>;\r\n  preframe: PreFrameEvent;\r\n  postframe: PostFrameEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n};\r\n\r\nexport const EngineEvents = {\r\n  FallbackGraphicsContext: 'fallbackgraphicscontext',\r\n  Initialize: 'initialize',\r\n  Visible: 'visible',\r\n  Hidden: 'hidden',\r\n  Start: 'start',\r\n  Stop: 'stop',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreFrame: 'preframe',\r\n  PostFrame: 'postframe',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw'\r\n} as const;\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions<TKnownScenes extends string = any> {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of {@apilink EngineOptions.width} and {@apilink EngineOptions.height}, or vice versa.\r\n   */\r\n  viewport?: ViewportDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See {@apilink Resolution} for common presets.\r\n   */\r\n  resolution?: Resolution;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   *\r\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\r\n   * with default blending {@apilink ImageFiltering.Blended}\r\n   *\r\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\r\n   * with default blending {@apilink ImageFiltering.Pixel}\r\n   *\r\n   * * {@apilink AntialiasOptions} Optionally deeply configure the different antialiasing settings, **WARNING** thar be dragons here.\r\n   * It is recommended you stick to `true` or `false` unless you understand what you're doing and need to control rendering to\r\n   * a high degree.\r\n   */\r\n  antialiasing?: boolean | AntialiasOptions;\r\n\r\n  /**\r\n   * Optionally specify excalibur garbage collection, by default true.\r\n   *\r\n   * * `true` - garbage collection defaults are enabled (default)\r\n   *\r\n   * * `false` - garbage collection is completely disabled (not recommended)\r\n   *\r\n   * * {@apilink GarbageCollectionOptions} Optionally deeply configure garbage collection settings, **WARNING** thar be dragons here.\r\n   * It is recommended you stick to `true` or `false` unless you understand what you're doing, it is possible to get into a downward\r\n   * spiral if collection timings are set too low where you are stuck in repeated collection.\r\n   */\r\n  garbageCollection?: boolean | GarbageCollectionOptions;\r\n\r\n  /**\r\n   * Quick convenience property to configure Excalibur to use special settings for \"pretty\" anti-aliased pixel art\r\n   *\r\n   * 1. Turns on special shader condition to blend for pixel art and enables various antialiasing settings,\r\n   *  notice blending is ON for this special mode.\r\n   *\r\n   * Equivalent to:\r\n   * ```javascript\r\n   * antialiasing: {\r\n   *  pixelArtSampler: true,\r\n   *  canvasImageRendering: 'auto',\r\n   *  filtering: ImageFiltering.Blended,\r\n   *  webglAntialiasing: true\r\n   * }\r\n   * ```\r\n   */\r\n  pixelArt?: boolean;\r\n\r\n  /**\r\n   * Specify any UV padding you want use in pixels, this brings sampling into the texture if you're using\r\n   * a sprite sheet in one image to prevent sampling bleed.\r\n   *\r\n   * Defaults:\r\n   * * `antialiasing: false` or `filtering: ImageFiltering.Pixel` - 0.0;\r\n   * * `pixelArt: true` - 0.25\r\n   * * All else 0.01\r\n   */\r\n  uvPadding?: number;\r\n\r\n  /**\r\n   * Optionally hint the graphics context into a specific power profile\r\n   *\r\n   * Default \"high-performance\"\r\n   */\r\n  powerPreference?: 'default' | 'high-performance' | 'low-power';\r\n\r\n  /**\r\n   * Optionally upscale the number of pixels in the canvas. Normally only useful if you need a smoother look to your assets, especially\r\n   * {@apilink Text} or Pixel Art assets.\r\n   *\r\n   * **WARNING** It is recommended you try using `antialiasing: true` before adjusting pixel ratio. Pixel ratio will consume more memory\r\n   * and on mobile may break if the internal size of the canvas exceeds 4k pixels in width or height.\r\n   *\r\n   * Default is based the display's pixel ratio, for example a HiDPI screen might have the value 2;\r\n   */\r\n  pixelRatio?: number;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally enable the right click context menu on the canvas\r\n   *\r\n   * Default if unset is false\r\n   */\r\n  enableCanvasContextMenu?: boolean;\r\n\r\n  /**\r\n   * Optionally snap graphics to nearest pixel, default is false\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The {@apilink DisplayMode} of the game, by default {@apilink DisplayMode.FitScreen} with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, {@apilink width} and {@apilink height} may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Sets the focus of the window, this is needed when hosting excalibur in a cross-origin iframe in order for certain events\r\n   * (like keyboard) to work.\r\n   * For example: itch.io or codesandbox.io\r\n   *\r\n   * By default set to true,\r\n   */\r\n  grabWindowFocus?: boolean;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  maxFps?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update timestep in milliseconds, this can be desirable if you need the physics simulation to be very stable. When\r\n   * set the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  fixedUpdateTimestep?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desirable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  fixedUpdateFps?: number;\r\n\r\n  /**\r\n   * Default `true`, optionally configure excalibur to use optimal draw call sorting, to opt out set this to `false`.\r\n   *\r\n   * Excalibur will automatically sort draw calls by z and priority into renderer batches for maximal draw performance,\r\n   * this can disrupt a specific desired painter order.\r\n   *\r\n   */\r\n  useDrawSorting?: boolean;\r\n\r\n  /**\r\n   * Optionally provide a custom handler for the webgl context lost event\r\n   */\r\n  handleContextLost?: (e: Event) => void;\r\n\r\n  /**\r\n   * Optionally provide a custom handler for the webgl context restored event\r\n   */\r\n  handleContextRestored?: (e: Event) => void;\r\n\r\n  /**\r\n   * Optionally configure how excalibur handles poor performance on a player's browser\r\n   */\r\n  configurePerformanceCanvas2DFallback?: {\r\n    /**\r\n     * By default `false`, this will switch the internal graphics context to Canvas2D which can improve performance on non hardware\r\n     * accelerated browsers.\r\n     */\r\n    allow: boolean;\r\n    /**\r\n     * By default `false`, if set to `true` a dialogue will be presented to the player about their browser and how to potentially\r\n     * address any issues.\r\n     */\r\n    showPlayerMessage?: boolean;\r\n    /**\r\n     * Default `{ numberOfFrames: 100, fps: 20 }`, optionally configure excalibur to fallback to the 2D Canvas renderer\r\n     * if bad performance is detected.\r\n     *\r\n     * In this example of the default if excalibur is running at 20fps or less for 100 frames it will trigger the fallback to the 2D\r\n     * Canvas renderer.\r\n     */\r\n    threshold?: { numberOfFrames: number; fps: number };\r\n  };\r\n\r\n  /**\r\n   * Optionally configure the physics simulation in excalibur\r\n   *\r\n   * If false, Excalibur will not produce a physics simulation.\r\n   *\r\n   * Default is configured to use {@apilink SolverStrategy.Arcade} physics simulation\r\n   */\r\n  physics?: boolean | PhysicsConfig;\r\n\r\n  /**\r\n   * Optionally specify scenes with their transitions and loaders to excalibur's scene {@apilink Director}\r\n   *\r\n   * Scene transitions can can overridden dynamically by the `Scene` or by the call to `.goToScene`\r\n   */\r\n  scenes?: SceneMap<TKnownScenes>;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The {@apilink Engine} is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine<TKnownScenes extends string = any> implements CanInitialize, CanUpdate, CanDraw {\r\n  static Context: Context<Engine | null> = createContext<Engine | null>();\r\n  static useEngine(): Engine {\r\n    const value = useContext(Engine.Context);\r\n\r\n    if (!value) {\r\n      throw new Error('Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.');\r\n    }\r\n\r\n    return value;\r\n  }\r\n  static InstanceCount = 0;\r\n\r\n  /**\r\n   * Anything run under scope can use `useEngine()` to inject the current engine\r\n   * @param cb\r\n   */\r\n  scope = <TReturn>(cb: () => TReturn) => Engine.Context.scope(this, cb);\r\n\r\n  private _garbageCollector: GarbageCollector;\r\n\r\n  public readonly garbageCollectorConfig: GarbageCollectionOptions | null;\r\n\r\n  /**\r\n   * Current Excalibur version string\r\n   *\r\n   * Useful for plugins or other tools that need to know what features are available\r\n   */\r\n  public readonly version = EX_VERSION;\r\n\r\n  /**\r\n   * Listen to and emit events on the Engine\r\n   */\r\n  public events = new EventEmitter<EngineEvents>();\r\n\r\n  /**\r\n   * Excalibur browser events abstraction used for wiring to native browser events safely\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Scene director, manages all scenes, scene transitions, and loaders in excalibur\r\n   */\r\n  public director: Director<TKnownScenes>;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\r\n   */\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * Direct access to the physics configuration for excalibur\r\n   */\r\n  public physics: DeepRequired<PhysicsConfig>;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  public maxFps: number = Number.POSITIVE_INFINITY;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desirable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  public readonly fixedUpdateFps?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update timestep in milliseconds, this can be desirable if you need the physics simulation to be very stable. When\r\n   * set the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  public readonly fixedUpdateTimestep?: number;\r\n\r\n  /**\r\n   * Direct access to the excalibur clock\r\n   */\r\n  public clock: Clock;\r\n\r\n  public readonly pointerScope: PointerScope;\r\n  public readonly grabWindowFocus: boolean;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: InputHost;\r\n\r\n  /**\r\n   * Map multiple input sources to specific game actions actions\r\n   */\r\n  public inputMapper: InputMapper;\r\n\r\n  private _inputEnabled: boolean = true;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   *\r\n   * Useful when you want to debug different aspects of built in engine features like\r\n   *   * Transform\r\n   *   * Graphics\r\n   *   * Colliders\r\n   */\r\n  public debug: DebugConfig;\r\n\r\n  /**\r\n   * Access {@apilink stats} that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * The current {@apilink Scene} being drawn and updated on screen\r\n   */\r\n  public get currentScene(): Scene {\r\n    return this.director.currentScene;\r\n  }\r\n\r\n  /**\r\n   * The current {@apilink Scene} being drawn and updated on screen\r\n   */\r\n  public get currentSceneName(): string {\r\n    return this.director.currentSceneName;\r\n  }\r\n\r\n  /**\r\n   * The default {@apilink Scene} of the game, use {@apilink Engine.goToScene} to transition to different scenes.\r\n   */\r\n  public get rootScene(): Scene {\r\n    return this.director.rootScene;\r\n  }\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public get scenes(): { [key: string]: Scene | SceneConstructor | SceneWithOptions } {\r\n    return this.director.scenes;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current {@apilink DisplayMode} of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * Hints the graphics context to truncate fractional world space coordinates\r\n   */\r\n  public get snapToPixel(): boolean {\r\n    return this.graphicsContext.snapToPixel;\r\n  }\r\n\r\n  public set snapToPixel(shouldSnapToPixel: boolean) {\r\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\r\n  }\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e, e.stack);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  private _toaster: Toaster = new Toaster();\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: DefaultLoader;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  public emit<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, event: EngineEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default {@apilink EngineOptions}\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    useDrawSorting: true,\r\n    configurePerformanceCanvas2DFallback: {\r\n      allow: false,\r\n      showPlayerMessage: false,\r\n      threshold: { fps: 20, numberOfFrames: 100 }\r\n    },\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    enableCanvasContextMenu: false,\r\n    snapToPixel: false,\r\n    antialiasing: true,\r\n    pixelArt: false,\r\n    garbageCollection: true,\r\n    powerPreference: 'high-performance',\r\n    pointerScope: PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    grabWindowFocus: true,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  private _originalOptions: EngineOptions = {};\r\n  public readonly _originalDisplayMode: DisplayMode;\r\n\r\n  /**\r\n   * Creates a new game using the given {@apilink EngineOptions}. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through {@apilink EngineOptions}.\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions<TKnownScenes>) {\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n    this._originalOptions = options;\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        '\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n    if (options.garbageCollection === true) {\r\n      this.garbageCollectorConfig = {\r\n        ...DefaultGarbageCollectionOptions\r\n      };\r\n    } else if (options.garbageCollection === false) {\r\n      this._logger.warn(\r\n        'WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted'\r\n      );\r\n      this.garbageCollectorConfig = null;\r\n    } else {\r\n      this.garbageCollectorConfig = {\r\n        ...DefaultGarbageCollectionOptions,\r\n        ...options.garbageCollection\r\n      };\r\n    }\r\n    this._garbageCollector = new GarbageCollector({ getTimestamp: Date.now });\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n\r\n      //test for existence of element\r\n      if (document.getElementById(options.canvasElementId) === null) {\r\n        throw new Error('Cannot find existing element in the DOM, please ensure element is created prior to engine creation.');\r\n      }\r\n\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    if (this.canvas && !options.enableCanvasContextMenu) {\r\n      this.canvas.addEventListener('contextmenu', (evt) => {\r\n        evt.preventDefault();\r\n      });\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    this.grabWindowFocus = options.grabWindowFocus;\r\n    this.pointerScope = options.pointerScope;\r\n\r\n    this._originalDisplayMode = displayMode;\r\n\r\n    let pixelArtSampler: boolean;\r\n    let uvPadding: number;\r\n    let nativeContextAntialiasing: boolean;\r\n    let canvasImageRendering: 'pixelated' | 'auto';\r\n    let filtering: ImageFiltering;\r\n    let multiSampleAntialiasing: boolean | { samples: number };\r\n    if (typeof options.antialiasing === 'object') {\r\n      ({ pixelArtSampler, nativeContextAntialiasing, multiSampleAntialiasing, filtering, canvasImageRendering } = {\r\n        ...(options.pixelArt ? DefaultPixelArtOptions : DefaultAntialiasOptions),\r\n        ...options.antialiasing\r\n      });\r\n    } else {\r\n      pixelArtSampler = !!options.pixelArt;\r\n      nativeContextAntialiasing = false;\r\n      multiSampleAntialiasing = options.antialiasing;\r\n      canvasImageRendering = options.antialiasing ? 'auto' : 'pixelated';\r\n      filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\r\n    }\r\n\r\n    if (nativeContextAntialiasing && multiSampleAntialiasing) {\r\n      this._logger.warnOnce(\r\n        `Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing` +\r\n          ` at the same time, they are incompatible settings. If you aren\\'t sure use multiSampleAntialiasing`\r\n      );\r\n    }\r\n\r\n    if (options.pixelArt) {\r\n      uvPadding = 0.25;\r\n    }\r\n\r\n    if (!options.antialiasing || filtering === ImageFiltering.Pixel) {\r\n      uvPadding = 0;\r\n    }\r\n\r\n    // Override with any user option, if non default to .25 for pixel art, 0.01 for everything else\r\n    uvPadding = options.uvPadding ?? uvPadding ?? 0.01;\r\n\r\n    // Canvas 2D fallback can be flagged on\r\n    let useCanvasGraphicsContext = Flags.isEnabled('use-canvas-context');\r\n    if (!useCanvasGraphicsContext) {\r\n      // Attempt webgl first\r\n      try {\r\n        this.graphicsContext = new ExcaliburGraphicsContextWebGL({\r\n          canvasElement: this.canvas,\r\n          enableTransparency: this.enableCanvasTransparency,\r\n          pixelArtSampler: pixelArtSampler,\r\n          antialiasing: nativeContextAntialiasing,\r\n          multiSampleAntialiasing: multiSampleAntialiasing,\r\n          uvPadding: uvPadding,\r\n          powerPreference: options.powerPreference,\r\n          backgroundColor: options.backgroundColor,\r\n          snapToPixel: options.snapToPixel,\r\n          useDrawSorting: options.useDrawSorting,\r\n          garbageCollector: this.garbageCollectorConfig\r\n            ? {\r\n                garbageCollector: this._garbageCollector,\r\n                collectionInterval: this.garbageCollectorConfig.textureCollectInterval\r\n              }\r\n            : null,\r\n          handleContextLost: options.handleContextLost ?? this._handleWebGLContextLost,\r\n          handleContextRestored: options.handleContextRestored\r\n        });\r\n      } catch (e) {\r\n        this._logger.warn(\r\n          `Excalibur could not load webgl for some reason (${(e as Error).message}) and loaded a Canvas 2D fallback. ` +\r\n            `Some features of Excalibur will not work in this mode. \\n\\n` +\r\n            'Read more about this issue at https://excaliburjs.com/docs/performance'\r\n        );\r\n        // fallback to canvas in case of failure\r\n        useCanvasGraphicsContext = true;\r\n      }\r\n    }\r\n\r\n    if (useCanvasGraphicsContext) {\r\n      this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        antialiasing: nativeContextAntialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel,\r\n        useDrawSorting: options.useDrawSorting\r\n      });\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: nativeContextAntialiasing,\r\n      canvasImageRendering: canvasImageRendering,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : options.pixelRatio ?? null\r\n    });\r\n\r\n    // TODO REMOVE STATIC!!!\r\n    // Set default filtering based on antialiasing\r\n    TextureLoader.filtering = filtering;\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.maxFps = options.maxFps ?? this.maxFps;\r\n\r\n    this.fixedUpdateTimestep = options.fixedUpdateTimestep ?? this.fixedUpdateTimestep;\r\n    this.fixedUpdateFps = options.fixedUpdateFps ?? this.fixedUpdateFps;\r\n    this.fixedUpdateTimestep = this.fixedUpdateTimestep || 1000 / this.fixedUpdateFps;\r\n\r\n    this.clock = new StandardClock({\r\n      maxFps: this.maxFps,\r\n      tick: this._mainloop.bind(this),\r\n      onFatalException: (e) => this.onFatalException(e)\r\n    });\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    if (typeof options.physics === 'boolean') {\r\n      this.physics = {\r\n        ...getDefaultPhysicsConfig(),\r\n        enabled: options.physics\r\n      };\r\n    } else {\r\n      this.physics = {\r\n        ...getDefaultPhysicsConfig()\r\n      };\r\n      mergeDeep(this.physics, options.physics);\r\n    }\r\n\r\n    this.debug = new DebugConfig(this);\r\n\r\n    this.director = new Director(this, options.scenes);\r\n\r\n    this._initialize(options);\r\n\r\n    (window as any).___EXCALIBUR_DEVTOOL = this;\r\n    Engine.InstanceCount++;\r\n  }\r\n\r\n  private _handleWebGLContextLost = (e: Event) => {\r\n    e.preventDefault();\r\n    this.clock.stop();\r\n    this._logger.fatalOnce('WebGL Graphics Lost', e);\r\n    const container = document.createElement('div');\r\n    container.id = 'ex-webgl-graphics-context-lost';\r\n    container.style.position = 'absolute';\r\n    container.style.zIndex = '99';\r\n    container.style.left = '50%';\r\n    container.style.top = '50%';\r\n    container.style.display = 'flex';\r\n    container.style.flexDirection = 'column';\r\n    container.style.transform = 'translate(-50%, -50%)';\r\n    container.style.backgroundColor = 'white';\r\n    container.style.padding = '10px';\r\n    container.style.borderStyle = 'solid 1px';\r\n\r\n    const div = document.createElement('div');\r\n    div.innerHTML = `\r\n      <h1>There was an issue rendering, please refresh the page.</h1>\r\n      <div>\r\n        <p>WebGL Graphics Context Lost</p>\r\n\r\n        <button id=\"ex-webgl-graphics-reload\">Refresh Page</button>\r\n\r\n        <p>There are a few reasons this might happen:</p>\r\n        <ul>\r\n          <li>Two or more pages are placing a high demand on the GPU</li>\r\n          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>\r\n          <li>The computer has multiple GPUs and the user has switched between them</li>\r\n          <li>Graphics driver has crashed or restarted</li>\r\n          <li>Graphics driver was updated</li>\r\n        </ul>\r\n      </div>\r\n    `;\r\n    container.appendChild(div);\r\n    if (this.canvas?.parentElement) {\r\n      this.canvas.parentElement.appendChild(container);\r\n      const button = div.querySelector('#ex-webgl-graphics-reload');\r\n      button?.addEventListener('click', () => location.reload());\r\n    }\r\n  };\r\n\r\n  private _performanceThresholdTriggered = false;\r\n  private _fpsSamples: number[] = [];\r\n  private _monitorPerformanceThresholdAndTriggerFallback() {\r\n    const { allow } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    let { threshold, showPlayerMessage } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    if (threshold === undefined) {\r\n      threshold = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold;\r\n    }\r\n    if (showPlayerMessage === undefined) {\r\n      showPlayerMessage = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage;\r\n    }\r\n    if (!Flags.isEnabled('use-canvas-context') && allow && this.ready && !this._performanceThresholdTriggered) {\r\n      // Calculate Average fps for last X number of frames after start\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        this._fpsSamples.splice(0, 1);\r\n      }\r\n      this._fpsSamples.push(this.clock.fpsSampler.fps);\r\n      let total = 0;\r\n      for (let i = 0; i < this._fpsSamples.length; i++) {\r\n        total += this._fpsSamples[i];\r\n      }\r\n      const average = total / this._fpsSamples.length;\r\n\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        if (average <= threshold.fps) {\r\n          this._performanceThresholdTriggered = true;\r\n          this._logger.warn(\r\n            `Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.\\n` +\r\n              \"this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.\\n\\n\" +\r\n              'If in Chrome:\\n' +\r\n              '  * Visit Settings > Advanced > System, and ensure \"Use Hardware Acceleration\" is checked.\\n' +\r\n              '  * Visit chrome://flags/#ignore-gpu-blocklist and ensure \"Override software rendering list\" is \"enabled\"\\n' +\r\n              'If in Firefox, visit about:config\\n' +\r\n              '  * Ensure webgl.disabled = false\\n' +\r\n              '  * Ensure webgl.force-enabled = true\\n' +\r\n              '  * Ensure layers.acceleration.force-enabled = true\\n\\n' +\r\n              'Read more about this issue at https://excaliburjs.com/docs/performance'\r\n          );\r\n\r\n          if (showPlayerMessage) {\r\n            this._toaster.toast(\r\n              'Excalibur is encountering performance issues. ' +\r\n                \"It's possible that your browser doesn't have hardware acceleration enabled. \" +\r\n                'Visit [LINK] for more information and potential solutions.',\r\n              'https://excaliburjs.com/docs/performance'\r\n            );\r\n          }\r\n          this.useCanvas2DFallback();\r\n          this.emit('fallbackgraphicscontext', this.graphicsContext);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches the engine's graphics context to the 2D Canvas.\r\n   * @warning Some features of Excalibur will not work in this mode.\r\n   */\r\n  public useCanvas2DFallback() {\r\n    // Swap out the canvas\r\n    const newCanvas = this.canvas.cloneNode(false) as HTMLCanvasElement;\r\n    this.canvas.parentNode.replaceChild(newCanvas, this.canvas);\r\n    this.canvas = newCanvas;\r\n\r\n    const options = { ...this._originalOptions, antialiasing: this.screen.antialiasing };\r\n    const displayMode = this._originalDisplayMode;\r\n\r\n    // New graphics context\r\n    this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n      canvasElement: this.canvas,\r\n      enableTransparency: this.enableCanvasTransparency,\r\n      antialiasing: options.antialiasing,\r\n      backgroundColor: options.backgroundColor,\r\n      snapToPixel: options.snapToPixel,\r\n      useDrawSorting: options.useDrawSorting\r\n    });\r\n\r\n    // Reset screen\r\n    if (this.screen) {\r\n      this.screen.dispose();\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : options.pixelRatio ?? null\r\n    });\r\n    this.screen.setCurrentCamera(this.currentScene.camera);\r\n\r\n    // Reset pointers\r\n    this.input.pointers.detach();\r\n    const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\r\n    this.input.pointers = this.input.pointers.recreate(pointerTarget, this);\r\n    this.input.pointers.init();\r\n  }\r\n\r\n  private _disposed = false;\r\n  /**\r\n   * Attempts to completely clean up excalibur resources, including removing the canvas from the dom.\r\n   *\r\n   * To start again you will need to new up an Engine.\r\n   */\r\n  public dispose() {\r\n    if (!this._disposed) {\r\n      this._disposed = true;\r\n      this.stop();\r\n      this._garbageCollector.forceCollectAll();\r\n      this.input.toggleEnabled(false);\r\n      this.canvas.parentNode.removeChild(this.canvas);\r\n      this.canvas = null;\r\n      this.screen.dispose();\r\n      this.graphicsContext.dispose();\r\n      this.graphicsContext = null;\r\n      Engine.InstanceCount--;\r\n    }\r\n  }\r\n\r\n  public isDisposed() {\r\n    return this._disposed;\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value < 0) {\r\n      Logger.getInstance().warnOnce('engine.timescale to a value less than 0 are ignored');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the {@apilink currentScene}.\r\n   * @param timer  The timer to add to the {@apilink currentScene}.\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the {@apilink currentScene}.\r\n   * @param timer  The timer to remove to the {@apilink currentScene}.\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Scene} to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene<TScene extends string>(key: TScene, scene: Scene | SceneConstructor | SceneWithOptions): Engine<TKnownScenes | TScene> {\r\n    this.director.add(key, scene);\r\n    return this as Engine<TKnownScenes | TScene>;\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Scene} instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene | SceneConstructor): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    this.director.remove(entity);\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Scene} to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene | SceneConstructor | SceneWithOptions): void;\r\n  /**\r\n   * Adds a {@apilink Timer} to the {@apilink currentScene}.\r\n   * @param timer  The timer to add to the {@apilink currentScene}.\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a {@apilink TileMap} to the {@apilink currentScene}, once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the {@apilink currentScene} of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the {@apilink currentScene} may be drawn or updated.\r\n   * @param actor  The actor to add to the {@apilink currentScene}\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a {@apilink ScreenElement} to the {@apilink currentScene} of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the {@apilink currentScene}\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.director.add(<string>arguments[0], <Scene | SceneConstructor | SceneWithOptions>arguments[1]);\r\n      return;\r\n    }\r\n    const maybeDeferred = this.director.getDeferredScene();\r\n    if (maybeDeferred instanceof Scene) {\r\n      maybeDeferred.add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene | SceneConstructor): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a {@apilink Timer} from the {@apilink currentScene}.\r\n   * @param timer  The timer to remove to the {@apilink currentScene}.\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a {@apilink TileMap} from the {@apilink currentScene}, it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the {@apilink currentScene} of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the {@apilink currentScene}.\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a {@apilink ScreenElement} to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the {@apilink currentScene}\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene || isSceneConstructor(entity)) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the current scene with optionally supplied:\r\n   * * Activation data\r\n   * * Transitions\r\n   * * Loaders\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * game.goToScene('myScene', {\r\n   *   sceneActivationData: {any: 'thing at all'},\r\n   *   destinationIn: new FadeInOut({duration: 1000, direction: 'in'}),\r\n   *   sourceOut: new FadeInOut({duration: 1000, direction: 'out'}),\r\n   *   loader: MyLoader\r\n   * });\r\n   * ```\r\n   *\r\n   * Scenes are defined in the Engine constructor\r\n   * ```typescript\r\n   * const engine = new ex.Engine({\r\n      scenes: {...}\r\n    });\r\n   * ```\r\n   * Or by adding dynamically\r\n   *\r\n   * ```typescript\r\n   * engine.addScene('myScene', new ex.Scene());\r\n   * ```\r\n   * @param destinationScene\r\n   * @param options\r\n   */\r\n  public async goToScene<TData = undefined>(destinationScene: WithRoot<TKnownScenes>, options?: GoToOptions<TData>): Promise<void> {\r\n    await this.scope(async () => {\r\n      await this.director.goToScene(destinationScene, options);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\r\n    const grabWindowFocus = this._originalOptions?.grabWindowFocus ?? true;\r\n    this.input = new InputHost({\r\n      pointerTarget,\r\n      grabWindowFocus,\r\n      engine: this\r\n    });\r\n    this.inputMapper = this.input.inputMapper;\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    this.browser.document.on('visibilitychange', () => {\r\n      if (document.visibilityState === 'hidden') {\r\n        this.events.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else if (document.visibilityState === 'visible') {\r\n        this.events.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public toggleInputEnabled(enabled: boolean) {\r\n    this._inputEnabled = enabled;\r\n    this.input.toggleEnabled(this._inputEnabled);\r\n  }\r\n\r\n  public onInitialize(engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private async _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      await this.director.onInitialize();\r\n      await this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param elapsed  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(elapsed: number) {\r\n    if (this._isLoading) {\r\n      // suspend updates until loading is finished\r\n      this._loader?.onUpdate(this, elapsed);\r\n      // Update input listeners\r\n      this.input.update();\r\n      return;\r\n    }\r\n\r\n    // Publish preupdate events\r\n    this.clock.__runScheduledCbs('preupdate');\r\n    this._preupdate(elapsed);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, elapsed);\r\n\r\n    // Update graphics postprocessors\r\n    this.graphicsContext.updatePostProcessors(elapsed);\r\n\r\n    // Publish update event\r\n    this.clock.__runScheduledCbs('postupdate');\r\n    this._postupdate(elapsed);\r\n\r\n    // Update input listeners\r\n    this.input.update();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(elapsed: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, elapsed, this));\r\n    this.onPreUpdate(this, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(elapsed: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, elapsed, this));\r\n    this.onPostUpdate(this, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(elapsed: number) {\r\n    // Use scene background color if present, fallback to engine\r\n    this.graphicsContext.backgroundColor = this.currentScene.backgroundColor ?? this.backgroundColor;\r\n    this.graphicsContext.beginDrawLifecycle();\r\n    this.graphicsContext.clear();\r\n    this.clock.__runScheduledCbs('predraw');\r\n    this._predraw(this.graphicsContext, elapsed);\r\n\r\n    // Drawing nothing else while loading\r\n    if (this._isLoading) {\r\n      if (!this._hideLoader) {\r\n        this._loader?.canvas.draw(this.graphicsContext, 0, 0);\r\n        this.clock.__runScheduledCbs('postdraw');\r\n        this.graphicsContext.flush();\r\n        this.graphicsContext.endDrawLifecycle();\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.currentScene.draw(this.graphicsContext, elapsed);\r\n\r\n    this.clock.__runScheduledCbs('postdraw');\r\n    this._postdraw(this.graphicsContext, elapsed);\r\n\r\n    // Flush any pending drawings\r\n    this.graphicsContext.flush();\r\n    this.graphicsContext.endDrawLifecycle();\r\n\r\n    this._checkForScreenShots();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    this.emit('predraw', new PreDrawEvent(ctx, elapsed, this));\r\n    this.onPreDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method to hook into pre draw\r\n   * @param ctx {@link ExcaliburGraphicsContext} for drawing\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    this.emit('postdraw', new PostDrawEvent(ctx, elapsed, this));\r\n    this.onPostDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method to hook into pre draw\r\n   * @param ctx {@link ExcaliburGraphicsContext} for drawing\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return !this._isLoading;\r\n  }\r\n\r\n  private _isLoading = false;\r\n  private _hideLoader = false;\r\n  private _isReadyFuture = new Future<void>();\r\n  public get ready() {\r\n    return this._isReadyFuture.isCompleted;\r\n  }\r\n  public isReady(): Promise<void> {\r\n    return this._isReadyFuture.promise;\r\n  }\r\n\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional {@apilink Loader} to use to load resources. The default loader is {@apilink Loader},\r\n   * override to provide your own custom loader.\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(loader?: DefaultLoader): Promise<void>;\r\n  /**\r\n   * Starts the internal game loop for Excalibur after configuring any routes, loaders, or transitions\r\n   * @param startOptions Optional {@apilink StartOptions} to configure the routes for scenes in Excalibur\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(sceneName: WithRoot<TKnownScenes>, options?: StartOptions): Promise<void>;\r\n  /**\r\n   * Starts the internal game loop after any loader is finished\r\n   * @param loader\r\n   */\r\n  public async start(loader?: DefaultLoader): Promise<void>;\r\n  public async start(sceneNameOrLoader?: WithRoot<TKnownScenes> | DefaultLoader, options?: StartOptions): Promise<void> {\r\n    await this.scope(async () => {\r\n      if (!this._compatible) {\r\n        throw new Error('Excalibur is incompatible with your browser');\r\n      }\r\n      this._isLoading = true;\r\n      let loader: DefaultLoader;\r\n      if (sceneNameOrLoader instanceof DefaultLoader) {\r\n        loader = sceneNameOrLoader;\r\n      } else if (typeof sceneNameOrLoader === 'string') {\r\n        this.director.configureStart(sceneNameOrLoader, options);\r\n        loader = this.director.mainLoader;\r\n      }\r\n\r\n      // Start the excalibur clock which drives the mainloop\r\n      this._logger.debug('Starting game clock...');\r\n      this.browser.resume();\r\n      this.clock.start();\r\n      if (this.garbageCollectorConfig) {\r\n        this._garbageCollector.start();\r\n      }\r\n      this._logger.debug('Game clock started');\r\n\r\n      await this.load(loader ?? new Loader());\r\n\r\n      // Initialize before ready\r\n      await this._overrideInitialize(this);\r\n\r\n      this._isReadyFuture.resolve();\r\n      this.emit('start', new GameStartEvent(this));\r\n      return this._isReadyFuture.promise;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current frames elapsed milliseconds\r\n   */\r\n  public currentFrameElapsedMs = 0;\r\n\r\n  /**\r\n   * Returns the current frame lag when in fixed update mode\r\n   */\r\n  public currentFrameLagMs = 0;\r\n\r\n  private _lagMs = 0;\r\n  private _mainloop(elapsed: number) {\r\n    this.scope(() => {\r\n      this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\r\n      const elapsedMs = elapsed * this.timescale;\r\n      this.currentFrameElapsedMs = elapsedMs;\r\n\r\n      // reset frame stats (reuse existing instances)\r\n      const frameId = this.stats.prevFrame.id + 1;\r\n      this.stats.currFrame.reset();\r\n      this.stats.currFrame.id = frameId;\r\n      this.stats.currFrame.elapsedMs = elapsedMs;\r\n      this.stats.currFrame.fps = this.clock.fpsSampler.fps;\r\n      GraphicsDiagnostics.clear();\r\n\r\n      const beforeUpdate = this.clock.now();\r\n      const fixedTimestepMs = this.fixedUpdateTimestep;\r\n      if (this.fixedUpdateTimestep) {\r\n        this._lagMs += elapsedMs;\r\n        while (this._lagMs >= fixedTimestepMs) {\r\n          this._update(fixedTimestepMs);\r\n          this._lagMs -= fixedTimestepMs;\r\n        }\r\n      } else {\r\n        this._update(elapsedMs);\r\n      }\r\n      const afterUpdate = this.clock.now();\r\n      this.currentFrameLagMs = this._lagMs;\r\n      this._draw(elapsedMs);\r\n      const afterDraw = this.clock.now();\r\n\r\n      this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n      this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n      this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n      this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n\r\n      this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\r\n      this.stats.prevFrame.reset(this.stats.currFrame);\r\n\r\n      this._monitorPerformanceThresholdAndTriggerFallback();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this.clock.isRunning()) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this.clock.stop();\r\n      this._garbageCollector.stop();\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isRunning() {\r\n    return this.clock.isRunning();\r\n  }\r\n\r\n  private _screenShotRequests: { preserveHiDPIResolution: boolean; resolve: (image: HTMLImageElement) => void }[] = [];\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\r\n   */\r\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\r\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\r\n      this._screenShotRequests.push({ preserveHiDPIResolution, resolve });\r\n    });\r\n    return screenShotPromise;\r\n  }\r\n\r\n  private _checkForScreenShots() {\r\n    // We must grab the draw buffer before we yield to the browser\r\n    // the draw buffer is cleared after compositing\r\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\r\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\r\n    for (const request of this._screenShotRequests) {\r\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\r\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\r\n      const screenshot = document.createElement('canvas');\r\n      screenshot.width = finalWidth;\r\n      screenshot.height = finalHeight;\r\n      const ctx = screenshot.getContext('2d');\r\n      ctx.imageSmoothingEnabled = this.screen.antialiasing;\r\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\r\n\r\n      const result = new Image();\r\n      const raw = screenshot.toDataURL('image/png');\r\n      result.onload = () => {\r\n        request.resolve(result);\r\n      };\r\n      result.src = raw;\r\n    }\r\n    // Reset state\r\n    this._screenShotRequests.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some {@apilink Loadable} such as a {@apilink Loader} collection, {@apilink Sound}, or {@apilink Texture}.\r\n   */\r\n  public async load(loader: DefaultLoader, hideLoader = false): Promise<void> {\r\n    await this.scope(async () => {\r\n      try {\r\n        // early exit if loaded\r\n        if (loader.isLoaded()) {\r\n          return;\r\n        }\r\n        this._loader = loader;\r\n        this._isLoading = true;\r\n        this._hideLoader = hideLoader;\r\n\r\n        if (loader instanceof Loader) {\r\n          loader.suppressPlayButton = loader.suppressPlayButton || this._suppressPlayButton;\r\n        }\r\n        this._loader.onInitialize(this);\r\n\r\n        await loader.load();\r\n      } catch (e) {\r\n        this._logger.error('Error loading resources, things may not behave properly', e);\r\n        await Promise.resolve();\r\n      } finally {\r\n        this._isLoading = false;\r\n        this._hideLoader = false;\r\n        this._loader = null;\r\n      }\r\n    });\r\n  }\r\n}\r\n","/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle = 'circle',\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle = 'rectangle'\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from './Actor';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n\r\n  /**\r\n   * Specify a max width for the text in pixels, if specified the text will wrap.\r\n   *\r\n   * **Not supported in SpriteFont**\r\n   */\r\n  maxWidth?: number;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other {@apilink Font}\r\n   */\r\n  spriteFont?: SpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font;\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  private _font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this._font });\r\n\r\n  public set maxWidth(width: number | undefined) {\r\n    this._text.maxWidth = width;\r\n  }\r\n\r\n  public get maxWidth(): number | undefined {\r\n    return this._text.maxWidth;\r\n  }\r\n\r\n  public get font(): Font {\r\n    return this._font;\r\n  }\r\n\r\n  public set font(newFont: Font) {\r\n    this._font = newFont;\r\n    this._text.font = newFont;\r\n  }\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public override get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public override set color(color: Color) {\r\n    if (this._text) {\r\n      this._text.color = color;\r\n    }\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The {@apilink SpriteFont} to use, if any. Overrides {@apilink Font | `font`} if present.\r\n   */\r\n  public get spriteFont(): SpriteFont {\r\n    return this._spriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: SpriteFont) {\r\n    if (sf) {\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const { text, pos, x, y, spriteFont, font, color, maxWidth } = { text: '', ...options };\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.font = font ?? this.font;\r\n    this.maxWidth = maxWidth ?? this.maxWidth;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this._text.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { vec } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { randomInRange } from '../Math/util';\r\nimport { EmitterType } from './EmitterType';\r\nimport { Particle, ParticleTransform, ParticleEmitterArgs, ParticleConfig } from './Particles';\r\nimport { RentalPool } from '../Util/RentalPool';\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend {@apilink Actor} allowing you to use all of the features that come with.\r\n *\r\n * These particles are simulated on the CPU in JavaScript\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  private _particlePool = new RentalPool(\r\n    () => new Particle({}),\r\n    (p) => p,\r\n    500\r\n  );\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the {@apilink emitterType} is {@apilink EmitterType.Circle}\r\n   */\r\n  public radius: number = 0;\r\n\r\n  public particle: ParticleConfig = {\r\n    /**\r\n     * Gets or sets the life of each particle in milliseconds\r\n     */\r\n    life: 2000,\r\n    transform: ParticleTransform.Global,\r\n    graphic: undefined,\r\n    opacity: 1,\r\n    angularVelocity: 0,\r\n    focus: undefined,\r\n    focusAccel: undefined,\r\n    randomRotation: false\r\n  };\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const { particle, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\r\n\r\n    this.particle = { ...this.particle, ...particle };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.z = z ?? 0;\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  private _activeParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    if (particleCount <= 0) {\r\n      return;\r\n    }\r\n    particleCount = particleCount | 0; // coerce to int\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      if (this?.scene?.world) {\r\n        if (this.particle.transform === ParticleTransform.Global) {\r\n          this.scene.world.add(p);\r\n        } else {\r\n          this.addChild(p);\r\n        }\r\n      }\r\n      this._activeParticles.push(p);\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    for (let i = 0; i < this._activeParticles.length; i++) {\r\n      this.removeParticle(this._activeParticles[i]);\r\n    }\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = randomInRange(this.particle.minAngle || 0, this.particle.maxAngle || Math.PI * 2, this.random);\r\n    const vel = randomInRange(this.particle.minSpeed || 0, this.particle.maxSpeed || 0, this.random);\r\n    const size = this.particle.startSize || randomInRange(this.particle.minSize || 5, this.particle.maxSize || 5, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = randomInRange(0, this.width, this.random);\r\n      ranY = randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = this._particlePool.rent();\r\n    p.configure({\r\n      life: this.particle.life,\r\n      opacity: this.particle.opacity,\r\n      beginColor: this.particle.beginColor,\r\n      endColor: this.particle.endColor,\r\n      pos: vec(ranX, ranY),\r\n      vel: vec(dx, dy),\r\n      acc: this.particle.acc,\r\n      angularVelocity: this.particle.angularVelocity,\r\n      startSize: this.particle.startSize,\r\n      endSize: this.particle.endSize,\r\n      size: size,\r\n      graphic: this.particle.graphic,\r\n      fade: this.particle.fade\r\n    });\r\n    p.registerEmitter(this);\r\n    if (this.particle.randomRotation) {\r\n      p.transform.rotation = randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.particle.focus) {\r\n      p.focus = this.particle.focus.add(vec(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.particle.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    super.update(engine, elapsed);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (elapsed / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n        this._particlePool.return(this.deadParticles[i]);\r\n      }\r\n      const index = this._activeParticles.indexOf(this.deadParticles[i]);\r\n      if (index > -1) {\r\n        this._activeParticles.splice(index, 1);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n}\r\n","/**\r\n * Asserts will throw in `process.env.NODE_ENV === 'development'` builds if the expression evaluates false\r\n */\r\nexport function assert(message: string, expression: () => boolean) {\r\n  if (process.env.NODE_ENV === 'development') {\r\n    if (!expression()) {\r\n      throw new Error(message);\r\n    }\r\n  }\r\n}\r\n","import { randomInRange, TwoPI } from '../Math/util';\r\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { GpuParticleEmitter } from './GpuParticleEmitter';\r\nimport { ParticleConfig, ParticleTransform } from './Particles';\r\nimport { Random } from '../Math/Random';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { EmitterType } from './EmitterType';\r\nimport { assert } from '../Util/Assert';\r\nimport { vec } from '../Math/vector';\r\n\r\nexport interface GpuParticleConfig extends ParticleConfig {\r\n  /**\r\n   * Only Sprite graphics are supported in GPU particles at the moment\r\n   */\r\n  graphic?: Sprite;\r\n  /**\r\n   * Set the maximum particles to use for this emitter\r\n   */\r\n  maxParticles?: number;\r\n}\r\n\r\n/**\r\n * Container for the GPU Particle State contains the internal state needed for the GPU\r\n * to render particles and maintain state.\r\n */\r\nexport class GpuParticleRenderer {\r\n  static readonly GPU_MAX_PARTICLES: number = 100_000;\r\n  emitter: GpuParticleEmitter;\r\n  emitRate: number = 1;\r\n  particle: GpuParticleConfig;\r\n\r\n  private _initialized: boolean = false;\r\n  private _vaos: WebGLVertexArrayObject[] = [];\r\n  private _buffers: WebGLBuffer[] = [];\r\n  private _random: Random;\r\n\r\n  private _drawIndex = 0;\r\n  private _currentVao!: WebGLVertexArrayObject;\r\n  private _currentBuffer!: WebGLBuffer;\r\n\r\n  private _numInputFloats = 2 + 2 + 1 + 1 + 1;\r\n  private _particleData: Float32Array;\r\n  private _particleIndex = 0;\r\n  private _uploadIndex: number = 0;\r\n\r\n  private _wrappedLife = 0;\r\n  private _wrappedParticles = 0;\r\n  private _particleLife = 0;\r\n\r\n  constructor(emitter: GpuParticleEmitter, random: Random, options: GpuParticleConfig) {\r\n    this.emitter = emitter;\r\n    this.particle = options;\r\n    this._particleData = new Float32Array(this.emitter.maxParticles * this._numInputFloats);\r\n    this._random = random;\r\n    this._particleLife = this.particle.life ?? 2000;\r\n  }\r\n\r\n  public get isInitialized() {\r\n    return this._initialized;\r\n  }\r\n\r\n  public get maxParticles(): number {\r\n    return this.emitter.maxParticles;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL) {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n\r\n    const numParticles = this.emitter.maxParticles;\r\n    const numInputFloats = this._numInputFloats;\r\n    const particleData = this._particleData;\r\n    const bytesPerFloat = 4;\r\n\r\n    const particleDataBuffer1 = gl.createBuffer()!;\r\n    const vao1 = gl.createVertexArray()!;\r\n    gl.bindVertexArray(vao1);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer1);\r\n    gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, particleData);\r\n    let offset = 0;\r\n    // position\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\r\n    offset += bytesPerFloat * 2;\r\n    // velocity\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 2;\r\n    // rotation\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // angularVelocity\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // life\r\n    gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n\r\n    // enable attributes\r\n    gl.enableVertexAttribArray(0);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.enableVertexAttribArray(4);\r\n\r\n    this._vaos.push(vao1);\r\n    this._buffers.push(particleDataBuffer1);\r\n    // Clean up\r\n    gl.bindVertexArray(null);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    const particleDataBuffer2 = gl.createBuffer()!;\r\n    const vao2 = gl.createVertexArray()!;\r\n    gl.bindVertexArray(vao2);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer2);\r\n    gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\r\n    offset = 0;\r\n    // position\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\r\n    offset += bytesPerFloat * 2;\r\n    // velocity\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 2;\r\n    // rotation\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // angularVelocity\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // life\r\n    gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n\r\n    // enable attributes\r\n    gl.enableVertexAttribArray(0);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.enableVertexAttribArray(4);\r\n\r\n    this._vaos.push(vao2);\r\n    this._buffers.push(particleDataBuffer2);\r\n\r\n    // Clean up\r\n    gl.bindVertexArray(null);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    this._currentVao = this._vaos[this._drawIndex % 2];\r\n    this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\r\n\r\n    this._initialized = true;\r\n  }\r\n\r\n  private _clearRequested = false;\r\n  clearParticles() {\r\n    this._particleData.fill(0);\r\n    this._clearRequested = true;\r\n  }\r\n\r\n  private _emitted: [life: number, index: number][] = [];\r\n  emitParticles(particleCount: number) {\r\n    const startIndex = this._particleIndex;\r\n    const maxSize = this.maxParticles * this._numInputFloats;\r\n    const endIndex = particleCount * this._numInputFloats + startIndex;\r\n    let countParticle = 0;\r\n    for (let i = startIndex; i < endIndex; i += this._numInputFloats) {\r\n      const angle = this._random.floating(this.particle.minAngle || 0, this.particle.maxAngle || TwoPI);\r\n      const speedX = this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0);\r\n      const speedY = this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0);\r\n      const dx = speedX * Math.cos(angle);\r\n      const dy = speedY * Math.sin(angle);\r\n      let ranX: number = 0;\r\n      let ranY: number = 0;\r\n      if (this.emitter.emitterType === EmitterType.Rectangle) {\r\n        ranX = this._random.floating(-0.5, 0.5) * this.emitter.width;\r\n        ranY = this._random.floating(-0.5, 0.5) * this.emitter.height;\r\n      } else {\r\n        const radius = this._random.floating(0, this.emitter.radius);\r\n        ranX = radius * Math.cos(angle);\r\n        ranY = radius * Math.sin(angle);\r\n      }\r\n      const tx = this.emitter.transform.apply(vec(ranX, ranY));\r\n      const data = [\r\n        this.particle.transform === ParticleTransform.Local ? ranX : tx.x,\r\n        this.particle.transform === ParticleTransform.Local ? ranY : tx.y, // pos in world space\r\n        dx,\r\n        dy, // velocity\r\n        this.particle.randomRotation ? randomInRange(0, TwoPI, this._random) : this.particle.rotation || 0, // rotation\r\n        this.particle.angularVelocity || 0, // angular velocity\r\n        this._particleLife // life\r\n      ];\r\n\r\n      countParticle++;\r\n      this._particleData.set(data, i % this._particleData.length);\r\n    }\r\n\r\n    if (endIndex >= maxSize) {\r\n      this._wrappedParticles += (endIndex - maxSize) / this._numInputFloats;\r\n      this._wrappedLife = this._particleLife;\r\n    } else if (this._wrappedLife > 0) {\r\n      this._wrappedParticles += particleCount;\r\n    }\r\n\r\n    this._particleIndex = endIndex % maxSize;\r\n    this._emitted.push([this._particleLife, startIndex]);\r\n  }\r\n\r\n  private _uploadEmitted(gl: WebGL2RenderingContext) {\r\n    // upload index is the index of the previous upload\r\n    // particle index is the current index of modification\r\n    if (this._particleIndex !== this._uploadIndex) {\r\n      // Bind one buffer to ARRAY_BUFFER and the other to TFB\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, this._buffers[(this._drawIndex + 1) % 2]);\r\n      if (this._particleIndex >= this._uploadIndex) {\r\n        gl.bufferSubData(\r\n          gl.ARRAY_BUFFER,\r\n          this._uploadIndex * 4, // dst byte offset 4 bytes per float\r\n          this._particleData,\r\n          this._uploadIndex,\r\n          this._particleIndex - this._uploadIndex\r\n        );\r\n      } else {\r\n        // upload before the wrap\r\n        // prettier-ignore\r\n        gl.bufferSubData(\r\n          gl.ARRAY_BUFFER,\r\n          this._uploadIndex * 4,\r\n          this._particleData,\r\n          this._uploadIndex,\r\n          this._particleData.length - this._uploadIndex\r\n        );\r\n        // upload after the wrap if there are any\r\n        if (this._wrappedParticles) {\r\n          // prettier-ignore\r\n          gl.bufferSubData(\r\n            gl.ARRAY_BUFFER,\r\n            0,\r\n            this._particleData,\r\n            0,\r\n            this._wrappedParticles * this._numInputFloats\r\n          );\r\n        }\r\n        this._wrappedLife = this._particleLife;\r\n      }\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n    this._uploadIndex = this._particleIndex % (this.maxParticles * this._numInputFloats);\r\n  }\r\n\r\n  update(elapsed: number) {\r\n    this._particleLife = this.particle.life ?? this._particleLife;\r\n    if (this._wrappedLife > 0) {\r\n      this._wrappedLife -= elapsed;\r\n    } else {\r\n      this._wrappedLife = 0;\r\n      this._wrappedParticles = 0;\r\n    }\r\n    if (!this._emitted.length) {\r\n      return;\r\n    }\r\n    for (let i = this._emitted.length - 1; i >= 0; i--) {\r\n      const particle = this._emitted[i];\r\n      particle[0] -= elapsed;\r\n      const life = particle[0];\r\n      if (life <= 0) {\r\n        this._emitted.splice(i, 1);\r\n      }\r\n    }\r\n\r\n    this._emitted.sort((a, b) => a[0] - b[0]);\r\n  }\r\n\r\n  draw(gl: WebGL2RenderingContext) {\r\n    if (this._initialized) {\r\n      // Emit\r\n      if (this._clearRequested) {\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._buffers[(this._drawIndex + 1) % 2]);\r\n        gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._particleData);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        this._clearRequested = false;\r\n      } else {\r\n        this._uploadEmitted(gl);\r\n      }\r\n\r\n      // Bind one buffer to ARRAY_BUFFER and the other to transform feedback buffer\r\n      gl.bindVertexArray(this._currentVao);\r\n      gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer);\r\n\r\n      // Perform transform feedback (run the simulation) and the draw call all at once\r\n      if (this._wrappedLife && this._emitted[0] && this._emitted[0][1] > 0) {\r\n        const midpoint = this._emitted[0][1] / this._numInputFloats;\r\n        // draw oldest first (maybe make configurable)\r\n        assert(`midpoint greater than 0, actual: ${midpoint}`, () => midpoint > 0);\r\n        assert(`midpoint is less than max, actual: ${midpoint}`, () => midpoint < this.maxParticles);\r\n        gl.bindBufferRange(\r\n          gl.TRANSFORM_FEEDBACK_BUFFER,\r\n          0,\r\n          this._currentBuffer,\r\n          this._emitted[0][1] * 4,\r\n          (this.maxParticles - midpoint) * this._numInputFloats * 4\r\n        );\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, midpoint, this.maxParticles - midpoint);\r\n        gl.endTransformFeedback();\r\n\r\n        // then draw newer particles\r\n        gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._emitted[0][1] * 4);\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, 0, midpoint);\r\n        gl.endTransformFeedback();\r\n      } else {\r\n        gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._particleData.length * 4);\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, 0, this.maxParticles);\r\n        gl.endTransformFeedback();\r\n      }\r\n\r\n      // Clean up after ourselves to avoid errors.\r\n      gl.bindVertexArray(null);\r\n      gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\r\n\r\n      // flip flop buffers, one will be draw the other simulation\r\n      this._currentVao = this._vaos[this._drawIndex % 2];\r\n      this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\r\n      this._drawIndex = (this._drawIndex + 1) % 2;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { EmitterType } from './EmitterType';\r\nimport { ParticleEmitterArgs, ParticleTransform } from './Particles';\r\nimport { GpuParticleConfig, GpuParticleRenderer } from './GpuParticleRenderer';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Random } from '../Math/Random';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { clamp } from '../Math';\r\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { ParticleRenderer } from '../Graphics/Context/particle-renderer/particle-renderer';\r\n\r\nexport class GpuParticleEmitter extends Actor {\r\n  public particle: GpuParticleConfig = {\r\n    /**\r\n     * Gets or sets the life of each particle in milliseconds\r\n     */\r\n    life: 2000,\r\n    transform: ParticleTransform.Global,\r\n    graphic: undefined,\r\n    opacity: 1,\r\n    angularVelocity: 0,\r\n    focus: undefined,\r\n    focusAccel: undefined,\r\n    randomRotation: false\r\n  };\r\n\r\n  public graphics = new GraphicsComponent();\r\n  public renderer: GpuParticleRenderer;\r\n  public isEmitting: boolean = false;\r\n  public emitRate: number = 1;\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n  public radius: number = 0;\r\n  public readonly maxParticles: number = 2000;\r\n  random: Random;\r\n\r\n  public get pos() {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(pos: Vector) {\r\n    this.transform.pos = pos;\r\n  }\r\n\r\n  public get z() {\r\n    return this.transform.z;\r\n  }\r\n\r\n  public set z(z: number) {\r\n    this.transform.z = z;\r\n  }\r\n\r\n  constructor(config: ParticleEmitterArgs & { maxParticles?: number; particle?: GpuParticleConfig }) {\r\n    super({ name: `GpuParticleEmitter`, width: config.width, height: config.height }); // somewhat goofy way of doing width/height\r\n    this.addComponent(this.graphics, true);\r\n    (this.graphics.onPostDraw as any) = this.draw.bind(this);\r\n\r\n    const { particle, maxParticles, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\r\n\r\n    this.maxParticles = clamp(maxParticles ?? this.maxParticles, 0, GpuParticleRenderer.GPU_MAX_PARTICLES);\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n\r\n    this.z = z ?? 0;\r\n\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n\r\n    this.radius = radius ?? this.radius;\r\n\r\n    this.particle = { ...this.particle, ...particle };\r\n\r\n    this.random = random ?? new Random();\r\n\r\n    this.renderer = new GpuParticleRenderer(this, this.random, this.particle);\r\n  }\r\n\r\n  public _initialize(engine: Engine): void {\r\n    super._initialize(engine);\r\n    const context = engine.graphicsContext as ExcaliburGraphicsContextWebGL;\r\n    this.renderer.initialize(context.__gl, context);\r\n  }\r\n\r\n  private _particlesToEmit = 0;\r\n  public update(engine: Engine, elapsed: number): void {\r\n    super.update(engine, elapsed);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (elapsed / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n    this.renderer.update(elapsed);\r\n  }\r\n\r\n  public emitParticles(particleCount: number) {\r\n    if (particleCount <= 0) {\r\n      return;\r\n    }\r\n    this.renderer.emitParticles(particleCount | 0); // coerce to integer\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.renderer.clearParticles();\r\n  }\r\n\r\n  draw(ctx: ExcaliburGraphicsContextWebGL, elapsed: number) {\r\n    ctx.draw<ParticleRenderer>('ex.particle', this.renderer, elapsed);\r\n  }\r\n}\r\n","import { BodyComponent } from '../Collision/BodyComponent';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Collider } from '../Collision/Colliders/Collider';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity, EntityEvents } from '../EntityComponentSystem/Entity';\r\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\nimport { DebugConfig } from '../Debug';\r\nimport { PointerComponent } from '../Input/PointerComponent';\r\nimport { PointerEvent } from '../Input/PointerEvent';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { HasNestedPointerEvents, PointerEventsToObjectDispatcher } from '../Input/PointerEventsToObjectDispatcher';\r\nimport { PointerEventReceiver } from '../Input/PointerEventReceiver';\r\n\r\nexport type IsometricTilePointerEvents = {\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n};\r\n\r\nexport class IsometricTile extends Entity {\r\n  /**\r\n   * Indicates whether this tile is solid\r\n   */\r\n  public solid: boolean = false;\r\n\r\n  public events = new EventEmitter<EntityEvents & IsometricTilePointerEvents>();\r\n\r\n  private _gfx: GraphicsComponent;\r\n  private _tileBounds = new BoundingBox();\r\n  private _graphics: Graphic[] = [];\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n  /**\r\n   * Tile graphics\r\n   */\r\n  public addGraphic(graphic: Graphic, options?: { offset?: Vector }) {\r\n    this._graphics.push(graphic);\r\n    this._gfx.isVisible = this.map.isVisible;\r\n    this._gfx.opacity = this.map.opacity;\r\n    if (options?.offset) {\r\n      this._gfx.offset = options.offset;\r\n    }\r\n    // TODO detect when this changes on the map and apply to all tiles\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  private _recalculateBounds(): BoundingBox {\r\n    let bounds = this._tileBounds.clone();\r\n    for (const graphic of this._graphics) {\r\n      const offset = vec(\r\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight)\r\n      );\r\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  public removeGraphic(graphic: Graphic) {\r\n    const index = this._graphics.indexOf(graphic);\r\n    if (index > -1) {\r\n      this._graphics.splice(index, 1);\r\n    }\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n    this._gfx.isVisible = false;\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  /**\r\n   * Tile colliders\r\n   */\r\n  private _colliders: Collider[] = [];\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a collider to the IsometricTile\r\n   *\r\n   * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the IsometricTile\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the IsometricTile\r\n   */\r\n  public clearColliders(): void {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Reference to the {@apilink IsometricMap} this tile is part of\r\n   */\r\n  public readonly map: IsometricMap;\r\n\r\n  private _transform: TransformComponent;\r\n  private _isometricEntityComponent: IsometricEntityComponent;\r\n\r\n  /**\r\n   * Returns the top left corner of the {@apilink IsometricTile} in world space\r\n   */\r\n  public get pos(): Vector {\r\n    return this.map.tileToWorld(vec(this.x, this.y));\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the {@apilink IsometricTile}\r\n   */\r\n  public get center(): Vector {\r\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\r\n  }\r\n\r\n  /**\r\n   * Arbitrary data storage per tile, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  /**\r\n   * Construct a new IsometricTile\r\n   * @param x tile coordinate in x (not world position)\r\n   * @param y tile coordinate in y (not world position)\r\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\r\n   * @param map reference to owning IsometricMap\r\n   */\r\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\r\n    super([\r\n      new TransformComponent(),\r\n      new GraphicsComponent({\r\n        offset: graphicsOffset ?? Vector.Zero,\r\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\r\n      }),\r\n      new IsometricEntityComponent(map)\r\n    ]);\r\n    this.x = x;\r\n    this.y = y;\r\n    this.map = map;\r\n    this._transform = this.get(TransformComponent);\r\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\r\n\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    const halfTileHeight = this.map.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    // The x position shifts left with every y step\r\n    const xPos = (this.x - this.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (this.x + this.y) * halfTileHeight;\r\n    this._transform.pos = vec(xPos, yPos);\r\n    this._isometricEntityComponent.elevation = map.elevation;\r\n\r\n    this._gfx = this.get(GraphicsComponent);\r\n    this._gfx.isVisible = false; // start not visible\r\n    const totalWidth = this.map.tileWidth;\r\n    const totalHeight = this.map.tileHeight;\r\n\r\n    // initial guess at gfx bounds based on the tile\r\n    const offset = vec(0, this.map.renderFromTopOfGraphic ? totalHeight : 0);\r\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\r\n      left: -totalWidth / 2,\r\n      top: -totalHeight,\r\n      right: totalWidth / 2,\r\n      bottom: totalHeight\r\n    }).translate(offset);\r\n  }\r\n\r\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    gfx.save();\r\n    // shift left origin to corner of map, not the left corner of the first sprite\r\n    gfx.translate(-halfTileWidth, 0);\r\n    for (const graphic of this._graphics) {\r\n      graphic.draw(\r\n        gfx,\r\n        this.map.graphicsOffset.x,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight)\r\n      );\r\n    }\r\n    gfx.restore();\r\n  }\r\n}\r\n\r\nexport interface IsometricMapOptions {\r\n  /**\r\n   * Optionally name the isometric tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the isometric tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n  /**\r\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\r\n   */\r\n  graphicsOffset?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n\r\n  elevation?: number;\r\n}\r\n\r\n/**\r\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\r\n *\r\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\r\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\r\n *\r\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\r\n * your art assets.\r\n */\r\nexport class IsometricMap extends Entity implements HasNestedPointerEvents {\r\n  public readonly elevation: number = 0;\r\n\r\n  /**\r\n   * Width of individual tile in pixels\r\n   */\r\n  public readonly tileWidth: number;\r\n  /**\r\n   * Height of individual tile in pixels\r\n   */\r\n  public readonly tileHeight: number;\r\n  /**\r\n   * Number of tiles wide\r\n   */\r\n  public readonly columns: number;\r\n  /**\r\n   * Number of tiles high\r\n   */\r\n  public readonly rows: number;\r\n  /**\r\n   * List containing all of the tiles in IsometricMap\r\n   */\r\n  public readonly tiles: IsometricTile[];\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   * @deprecated use isVisible\r\n   */\r\n  public get visible(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   * @deprecated use isVisible\r\n   */\r\n  public set visible(val: boolean) {\r\n    this.isVisible = val;\r\n  }\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   */\r\n  public isVisible = true;\r\n\r\n  /**\r\n   * Opacity of tiles\r\n   */\r\n  public opacity = 1.0;\r\n\r\n  /**\r\n   * Render the tile graphic from the top instead of the bottom\r\n   *\r\n   * default is `false` meaning rendering from the bottom\r\n   */\r\n  public renderFromTopOfGraphic: boolean = false;\r\n  public graphicsOffset: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Isometric map {@apilink TransformComponent}\r\n   */\r\n  public transform: TransformComponent;\r\n\r\n  /**\r\n   * Isometric map {@apilink ColliderComponent}\r\n   */\r\n  public collider: ColliderComponent;\r\n\r\n  public pointer: PointerComponent;\r\n\r\n  private _composite!: CompositeCollider;\r\n  private _pointerEventDispatcher: PointerEventsToObjectDispatcher<IsometricTile>;\r\n\r\n  constructor(options: IsometricMapOptions) {\r\n    super(\r\n      [\r\n        new TransformComponent(),\r\n        new BodyComponent({\r\n          type: CollisionType.Fixed\r\n        }),\r\n        new ColliderComponent(),\r\n        new PointerComponent(),\r\n        new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false)\r\n      ],\r\n      options.name\r\n    );\r\n    const { pos, tileWidth, tileHeight, columns: width, rows: height, renderFromTopOfGraphic, graphicsOffset, elevation } = options;\r\n\r\n    this.transform = this.get(TransformComponent);\r\n    if (pos) {\r\n      this.transform.pos = pos;\r\n    }\r\n\r\n    this.collider = this.get(ColliderComponent);\r\n    if (this.collider) {\r\n      this.collider.set((this._composite = new CompositeCollider([])));\r\n    }\r\n\r\n    this.pointer = this.get(PointerComponent);\r\n\r\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\r\n\r\n    this.elevation = elevation ?? this.elevation;\r\n    this.tileWidth = tileWidth;\r\n    this.tileHeight = tileHeight;\r\n    this.columns = width;\r\n    this.rows = height;\r\n\r\n    this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n    this.tiles = new Array(width * height);\r\n\r\n    // build up tile representation\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\r\n        this.tiles[x + y * width] = tile;\r\n        this.addChild(tile);\r\n        this._pointerEventDispatcher.addObject(\r\n          tile,\r\n          (p) => this.getTileByPoint(p.worldPos) === tile,\r\n          () => true\r\n        );\r\n      }\r\n    }\r\n\r\n    this.pointer.localBounds = BoundingBox.fromDimension(\r\n      tileWidth * width * this.transform.scale.x,\r\n      tileHeight * height * this.transform.scale.y,\r\n      vec(0.5, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _processPointerToObject(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _dispatchPointerEvents(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\r\n  }\r\n\r\n  public update(): void {\r\n    if (this._collidersDirty) {\r\n      this.updateColliders();\r\n      this._collidersDirty = false;\r\n    }\r\n\r\n    this._pointerEventDispatcher.clear();\r\n  }\r\n\r\n  private _collidersDirty = false;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n  }\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider) ?? Vector.Zero;\r\n    }\r\n  }\r\n  public updateColliders() {\r\n    this._composite.clearColliders();\r\n    const pos = this.get(TransformComponent).pos;\r\n    for (const tile of this.tiles) {\r\n      if (tile.solid) {\r\n        for (const collider of tile.getColliders()) {\r\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\r\n            .sub(pos)\r\n            .add(originalOffset)\r\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\r\n          collider.owner = this;\r\n          this._composite.addCollider(collider);\r\n        }\r\n      }\r\n    }\r\n    this.collider.update();\r\n  }\r\n\r\n  /**\r\n   * Convert world space coordinates to the tile x, y coordinate\r\n   * @param worldCoordinate\r\n   */\r\n  public worldToTile(worldCoordinate: Vector): Vector {\r\n    // TODO I don't think this handles parent transform see TileMap\r\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\r\n\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    return vec(\r\n      ~~((worldCoordinate.x / halfTileWidth + worldCoordinate.y / halfTileHeight) / 2),\r\n      ~~((worldCoordinate.y / halfTileHeight - worldCoordinate.x / halfTileWidth) / 2)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Given a tile coordinate, return the top left corner in world space\r\n   * @param tileCoordinate\r\n   */\r\n  public tileToWorld(tileCoordinate: Vector): Vector {\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // The x position shifts left with every y step\r\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\r\n    return vec(xPos, yPos).add(this.transform.pos);\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink IsometricTile} by its x and y coordinates\r\n   */\r\n  public getTile(x: number, y: number): IsometricTile | null {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink IsometricTile} by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): IsometricTile | null {\r\n    const tileCoord = this.worldToTile(point);\r\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\r\n    return tile;\r\n  }\r\n\r\n  private _getMaxZIndex(): number {\r\n    let maxZ = Number.NEGATIVE_INFINITY;\r\n    for (const tile of this.tiles) {\r\n      const currentZ = tile.get(TransformComponent).z;\r\n      if (currentZ > maxZ) {\r\n        maxZ = currentZ;\r\n      }\r\n    }\r\n    return maxZ;\r\n  }\r\n\r\n  /**\r\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\r\n   * @param gfx\r\n   */\r\n  public debug(gfx: ExcaliburGraphicsContext, debugFlags: DebugConfig) {\r\n    const { showAll, showPosition, positionColor, positionSize, showGrid, gridColor, gridWidth, showColliderGeometry } =\r\n      debugFlags.isometric;\r\n\r\n    const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\r\n    gfx.save();\r\n    gfx.z = this._getMaxZIndex() + 0.5;\r\n    if (showAll || showGrid) {\r\n      for (let y = 0; y < this.rows + 1; y++) {\r\n        const left = this.tileToWorld(vec(0, y));\r\n        const right = this.tileToWorld(vec(this.columns, y));\r\n        gfx.drawLine(left, right, gridColor, gridWidth);\r\n      }\r\n\r\n      for (let x = 0; x < this.columns + 1; x++) {\r\n        const top = this.tileToWorld(vec(x, 0));\r\n        const bottom = this.tileToWorld(vec(x, this.rows));\r\n        gfx.drawLine(top, bottom, gridColor, gridWidth);\r\n      }\r\n    }\r\n\r\n    if (showAll || showPosition) {\r\n      for (const tile of this.tiles) {\r\n        gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), positionSize, positionColor);\r\n      }\r\n    }\r\n    if (showAll || showColliderGeometry) {\r\n      for (const tile of this.tiles) {\r\n        if (tile.solid) {\r\n          // only draw solid tiles\r\n          for (const collider of tile.getColliders()) {\r\n            collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    gfx.restore();\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * Action that can represent a sequence of actions, this can be useful in conjunction with\r\n * {@apilink ParallelActions} to run multiple sequences in parallel.\r\n */\r\nexport class ActionSequence implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _sequenceContext: ActionContext;\r\n  private _sequenceBuilder: (actionContext: ActionContext) => any;\r\n  constructor(entity: Entity, actionBuilder: (actionContext: ActionContext) => any) {\r\n    this._sequenceBuilder = actionBuilder;\r\n    this._sequenceContext = new ActionContext(entity);\r\n    this._actionQueue = this._sequenceContext.getQueue();\r\n    this._sequenceBuilder(this._sequenceContext);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._actionQueue.isComplete();\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._stopped = false;\r\n    this._actionQueue.reset();\r\n  }\r\n\r\n  public clone(entity: Entity) {\r\n    return new ActionSequence(entity, this._sequenceBuilder);\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * Action that can run multiple {@apilink Action}s or {@apilink ActionSequence}s at the same time\r\n */\r\nexport class ParallelActions implements Action {\r\n  id = nextActionId();\r\n  private _actions: Action[];\r\n\r\n  constructor(parallelActions: Action[]) {\r\n    this._actions = parallelActions;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    for (let i = 0; i < this._actions.length; i++) {\r\n      this._actions[i].update(elapsed);\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._actions.every((a) => a.isComplete(entity));\r\n  }\r\n  reset(): void {\r\n    this._actions.forEach((a) => a.reset());\r\n  }\r\n  stop(): void {\r\n    this._actions.forEach((a) => a.stop());\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nexport interface QuadTreeItem {\r\n  bounds: BoundingBox;\r\n}\r\n\r\nexport interface QuadTreeOptions {\r\n  maxDepth?: number;\r\n  capacity: number;\r\n  level?: number;\r\n}\r\n\r\n/**\r\n * QuadTree spatial data structure. Useful for quickly retrieving all objects that might\r\n * be in a specific location.\r\n */\r\nexport class QuadTree<TItem extends QuadTreeItem> {\r\n  private _defaultOptions: QuadTreeOptions = {\r\n    maxDepth: 10,\r\n    capacity: 10,\r\n    level: 0\r\n  };\r\n\r\n  public halfWidth: number;\r\n  public halfHeight: number;\r\n  public items: TItem[] = [];\r\n  private _isDivided = false;\r\n\r\n  public topLeft: QuadTree<TItem> | null = null;\r\n  public topRight: QuadTree<TItem> | null = null;\r\n  public bottomLeft: QuadTree<TItem> | null = null;\r\n  public bottomRight: QuadTree<TItem> | null = null;\r\n\r\n  constructor(\r\n    public bounds: BoundingBox,\r\n    public options?: QuadTreeOptions\r\n  ) {\r\n    this.options = { ...this._defaultOptions, ...options };\r\n    this.halfWidth = bounds.width / 2;\r\n    this.halfHeight = bounds.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Splits the quad tree one level deeper\r\n   */\r\n  private _split() {\r\n    this._isDivided = true;\r\n    const newLevelOptions = {\r\n      maxDepth: this.options.maxDepth,\r\n      capacity: this.options.capacity,\r\n      level: this.options.level + 1\r\n    };\r\n    this.topLeft = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left,\r\n        top: this.bounds.top,\r\n        right: this.bounds.left + this.halfWidth,\r\n        bottom: this.bounds.top + this.halfHeight\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.topRight = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left + this.halfWidth,\r\n        top: this.bounds.top,\r\n        right: this.bounds.right,\r\n        bottom: this.bounds.top + this.halfHeight\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.bottomLeft = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left,\r\n        top: this.bounds.top + this.halfHeight,\r\n        right: this.bounds.left + this.halfWidth,\r\n        bottom: this.bounds.bottom\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.bottomRight = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left + this.halfWidth,\r\n        top: this.bounds.top + this.halfHeight,\r\n        right: this.bounds.right,\r\n        bottom: this.bounds.bottom\r\n      }),\r\n      newLevelOptions\r\n    );\r\n  }\r\n\r\n  private _insertIntoSubNodes(item: TItem) {\r\n    if (this.topLeft?.bounds.overlaps(item.bounds)) {\r\n      this.topLeft.insert(item);\r\n    }\r\n\r\n    if (this.topRight?.bounds.overlaps(item.bounds)) {\r\n      this.topRight.insert(item);\r\n    }\r\n\r\n    if (this.bottomLeft?.bounds.overlaps(item.bounds)) {\r\n      this.bottomLeft.insert(item);\r\n    }\r\n\r\n    if (this.bottomRight?.bounds.overlaps(item.bounds)) {\r\n      this.bottomRight.insert(item);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Insert an item to be tracked in the QuadTree\r\n   * @param item\r\n   */\r\n  insert(item: TItem): void {\r\n    // add to subnodes if it matches\r\n    if (this._isDivided) {\r\n      this._insertIntoSubNodes(item);\r\n      return;\r\n    }\r\n\r\n    // leaf case\r\n    this.items.push(item);\r\n\r\n    // capacity\r\n    if (this.items.length > this.options.capacity && this.options.level < this.options.maxDepth) {\r\n      if (!this._isDivided) {\r\n        this._split();\r\n      }\r\n      // divide this level's items into it's subnodes\r\n      for (const item of this.items) {\r\n        this._insertIntoSubNodes(item);\r\n      }\r\n      // clear this level\r\n      this.items.length = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a tracked item in the QuadTree\r\n   * @param item\r\n   */\r\n  remove(item: TItem): void {\r\n    if (!this.bounds.overlaps(item.bounds)) {\r\n      return;\r\n    }\r\n\r\n    if (!this._isDivided) {\r\n      const index = this.items.indexOf(item);\r\n      if (index > -1) {\r\n        this.items.splice(index, 1);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.topLeft?.bounds.overlaps(item.bounds)) {\r\n      this.topLeft.remove(item);\r\n    }\r\n\r\n    if (this.topRight?.bounds.overlaps(item.bounds)) {\r\n      this.topRight.remove(item);\r\n    }\r\n\r\n    if (this.bottomLeft?.bounds.overlaps(item.bounds)) {\r\n      this.bottomLeft.remove(item);\r\n    }\r\n\r\n    if (this.bottomRight?.bounds.overlaps(item.bounds)) {\r\n      this.bottomRight.remove(item);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query the structure for all objects that intersect the bounding box\r\n   * @param boundingBox\r\n   * @returns items\r\n   */\r\n  query(boundingBox: BoundingBox): TItem[] {\r\n    let results = this.items;\r\n\r\n    if (this._isDivided) {\r\n      if (this.topLeft.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.topLeft.query(boundingBox));\r\n      }\r\n      if (this.topRight.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.topRight.query(boundingBox));\r\n      }\r\n      if (this.bottomLeft.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.bottomLeft.query(boundingBox));\r\n      }\r\n      if (this.bottomRight.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.bottomRight.query(boundingBox));\r\n      }\r\n    }\r\n\r\n    results = results.filter((item, index) => {\r\n      return results.indexOf(item) >= index;\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  clear() {\r\n    this.items = [];\r\n    this._isDivided = false;\r\n\r\n    this.topLeft = null;\r\n    this.topRight = null;\r\n    this.bottomLeft = null;\r\n    this.bottomRight = null;\r\n  }\r\n\r\n  getAllItems(): TItem[] {\r\n    let results = this.items;\r\n\r\n    if (this._isDivided) {\r\n      results = results.concat(this.topLeft.getAllItems());\r\n      results = results.concat(this.topRight.getAllItems());\r\n      results = results.concat(this.bottomLeft.getAllItems());\r\n      results = results.concat(this.bottomRight.getAllItems());\r\n    }\r\n\r\n    results = results.filter((item, index) => {\r\n      return results.indexOf(item) >= index;\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  getTreeDepth(): number {\r\n    if (!this._isDivided) {\r\n      return 0;\r\n    }\r\n\r\n    return (\r\n      1 +\r\n      Math.max(this.topLeft.getTreeDepth(), this.topRight.getTreeDepth(), this.bottomLeft.getTreeDepth(), this.bottomRight.getTreeDepth())\r\n    );\r\n  }\r\n\r\n  debug(ctx: ExcaliburGraphicsContext) {\r\n    this.bounds.draw(ctx, Color.Yellow);\r\n    if (this._isDivided) {\r\n      this.topLeft.bounds.draw(ctx, Color.Yellow);\r\n      this.topRight.bounds.draw(ctx, Color.Yellow);\r\n      this.bottomLeft.bounds.draw(ctx, Color.Yellow);\r\n      this.bottomRight.bounds.draw(ctx, Color.Yellow);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\nimport { ExcaliburGraphicsContext } from '../Graphics';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _add {\r\n  onAdd(scene: Scene): void;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _remove {\r\n  onRemove(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_add(a: any): a is _add {\r\n  return !!a.onAdd;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_remove(a: any): a is _remove {\r\n  return !!a.onRemove;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnAdd {\r\n  onAdd(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnAdd(a: any): a is OnAdd {\r\n  return !!a.onAdd;\r\n}\r\n\r\nexport interface CanAdd {\r\n  onAdd(engine: Engine): void;\r\n\r\n  on(eventName: Events.add, handler: (event: Events.AddEvent<any>) => void): void;\r\n  once(eventName: Events.add, handler: (event: Events.AddEvent<any>) => void): void;\r\n  off(eventName: Events.add, handler?: (event: Events.AddEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnRemove {\r\n  onRemove(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnRemove(a: any): a is OnRemove {\r\n  return !!a.onRemove;\r\n}\r\n\r\nexport interface CanRemove {\r\n  onRemove(engine: Engine): void;\r\n\r\n  on(eventName: Events.remove, handler: (event: Events.RemoveEvent<any>) => void): void;\r\n  once(eventName: Events.remove, handler: (event: Events.RemoveEvent<any>) => void): void;\r\n  off(eventName: Events.remove, handler?: (event: Events.RemoveEvent<any>) => void): void;\r\n}\r\n\r\nexport interface SceneActivationContext<TData = undefined> {\r\n  data?: TData;\r\n  previousScene: Scene;\r\n  nextScene: Scene;\r\n  engine: Engine;\r\n}\r\n\r\nexport interface CanActivate<TData = undefined> {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(context: SceneActivationContext<TData>): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(context: SceneActivationContext<never>): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(engine: Engine, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(engine: Engine, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\n/**\r\n * The {@apilink Texture} object allows games built in Excalibur to load image resources.\r\n * {@apilink Texture} is an {@apilink Loadable} which means it can be passed to a {@apilink Loader}\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number = 0;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number = 0;\r\n\r\n  private _stream?: Stream;\r\n  private _gif?: GifParser;\r\n  private _images: ImageSource[] = [];\r\n  private _animation?: Animation;\r\n\r\n  public data: ImageSource[] = [];\r\n  private _sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    bustCache = false\r\n  ) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new GifParser(this._stream);\r\n    const images = this._gif.images.map((i) => new ImageSource(i.src, false));\r\n    // Load all textures\r\n    await Promise.all(images.map((t) => t.load()));\r\n    this.data = this._images = images;\r\n    this._sprites = this._images.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return this.data;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite | null {\r\n    return this._sprites[id] ?? null;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet | null {\r\n    const sprites: Sprite[] = this._sprites;\r\n    if (sprites.length) {\r\n      return new SpriteSheet({ sprites });\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   * @param durationPerFrame Optionally override duration per frame\r\n   */\r\n  public toAnimation(durationPerFrame?: number): Animation | null {\r\n    const images = this._gif?.images;\r\n    if (images?.length) {\r\n      const frames = images.map((image, index) => {\r\n        return {\r\n          graphic: this._sprites[index],\r\n          duration: this._gif?.frames[index].delayMs || undefined\r\n        };\r\n      });\r\n      this._animation = new Animation({\r\n        frames,\r\n        frameDuration: durationPerFrame\r\n      });\r\n\r\n      return this._animation;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif?.checkBytes ?? [];\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  lctBytes: [number, number, number][];\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n  delayTime: number;\r\n  delayMs: number;\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: number) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a as [boolean, boolean, boolean, boolean, boolean, boolean, boolean, boolean];\r\n};\r\n\r\nexport class Stream {\r\n  data: Uint8Array;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code = 0;\r\n  let last = 0;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\ninterface GifBlock {\r\n  sentinel: number;\r\n  type: string;\r\n}\r\n\r\ninterface GifHeader {\r\n  sig: string;\r\n  ver: string;\r\n  width: number;\r\n  height: number;\r\n  colorResolution: number;\r\n  globalColorTableSize: number;\r\n  gctFlag: boolean;\r\n  sortedFlag: boolean;\r\n  globalColorTable: [number, number, number][];\r\n  backgroundColorIndex: number;\r\n  pixelAspectRatio: number; // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n}\r\n\r\ninterface GCExtBlock extends GifBlock {\r\n  type: 'ext';\r\n  label: number;\r\n  extType: string;\r\n  reserved: boolean[];\r\n  disposalMethod: number;\r\n  userInputFlag: boolean;\r\n  transparentColorFlag: boolean;\r\n  delayTime: number;\r\n  transparentColorIndex: number;\r\n  terminator: number;\r\n}\r\n\r\n/**\r\n * GifParser for binary format\r\n *\r\n * Roughly based on the documentation https://giflib.sourceforge.net/whatsinagif/index.html\r\n */\r\nexport class GifParser {\r\n  private _st: Stream;\r\n  private _handler: any = {};\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  private _currentFrameCanvas: HTMLCanvasElement;\r\n  private _currentFrameContext: CanvasRenderingContext2D;\r\n  public globalColorTableBytes: [number, number, number][] = [];\r\n  public checkBytes: number[] = [];\r\n  private _gce?: GCExtBlock;\r\n  private _hdr?: GifHeader;\r\n\r\n  constructor(stream: Stream) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._currentFrameCanvas = document.createElement('canvas');\r\n    this._currentFrameContext = this._currentFrameCanvas.getContext('2d')!;\r\n    this.parseHeader();\r\n    this.parseBlocks();\r\n  }\r\n\r\n  parseColorTableBytes = (entries: number) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const colorTable: [number, number, number][] = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb = this._st.readBytes(3) as [number, number, number];\r\n      colorTable.push(rgb);\r\n    }\r\n    return colorTable;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: GifHeader = {\r\n      sig: '',\r\n      ver: '',\r\n      width: 0,\r\n      height: 0,\r\n      colorResolution: 0,\r\n      globalColorTableSize: 0,\r\n      gctFlag: false,\r\n      sortedFlag: false,\r\n      globalColorTable: [],\r\n      backgroundColorIndex: 0,\r\n      pixelAspectRatio: 0 // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    this._currentFrameCanvas.width = hdr.width;\r\n    this._currentFrameCanvas.height = hdr.height;\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift()!;\r\n    hdr.colorResolution = bitsToNum(bits.splice(0, 3));\r\n    hdr.sortedFlag = bits.shift()!;\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.backgroundColorIndex = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      // hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTableBytes = this.parseColorTableBytes(1 << (hdr.globalColorTableSize + 1));\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: GCExtBlock) => {\r\n    const parseGCExt = (block: GCExtBlock) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInputFlag = bits.shift()!;\r\n      block.transparentColorFlag = bits.shift()!;\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparentColorIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte(); // always 0\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n      return block;\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        this._gce = parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: GifFrame) => {\r\n    const deinterlace = (pixels: number[], width: number) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels: number[] = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: number, fromRow: number) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels) as any);\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift()!;\r\n    img.interlaced = bits.shift()!;\r\n    img.sorted = bits.shift()!;\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lctBytes = this.parseColorTableBytes(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    if (this._gce?.delayTime) {\r\n      img.delayMs = this._gce.delayTime * 10;\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img, img.lctFlag ? img.lctBytes : this.globalColorTableBytes);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlocks = () => {\r\n    const block: GifBlock = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block as GCExtBlock);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block as any);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlocks();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame, colorTable: [number, number, number][]) => {\r\n    const canvas = document.createElement('canvas')!;\r\n    canvas.width = frame.width;\r\n    canvas.height = frame.height;\r\n    const context = canvas.getContext('2d')!;\r\n    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n    let transparentColorIndex = -1;\r\n    if (this._gce?.transparentColorFlag) {\r\n      transparentColorIndex = this._gce.transparentColorIndex;\r\n    }\r\n\r\n    for (let pixel = 0; pixel < frame.pixels.length; pixel++) {\r\n      const colorIndex = frame.pixels[pixel];\r\n      const color = colorTable[colorIndex];\r\n      if (colorIndex === transparentColorIndex) {\r\n        imageData.data.set([0, 0, 0, 0], pixel * 4);\r\n      } else {\r\n        imageData.data.set([...color, 255], pixel * 4);\r\n      }\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    // A value of 1 which tells the decoder to leave the image in place and draw the next image on top of it.\r\n    // A value of 2 would have meant that the canvas should be restored to the background color (as indicated by the logical screen descriptor).\r\n    // A value of 3 is defined to mean that the decoder should restore the canvas to its previous state before the current image was drawn.\r\n    // The behavior for values 4-7 are yet to be defined.\r\n    if (this._gce?.disposalMethod === 1 && this.images.length) {\r\n      this._currentFrameContext.drawImage(this.images[this.images.length - 1]!, 0, 0);\r\n    } else if (this._gce?.disposalMethod === 2 && this._hdr?.gctFlag) {\r\n      const bg = colorTable[this._hdr.backgroundColorIndex];\r\n      this._currentFrameContext.fillStyle = `rgb(${bg[0]}, ${bg[1]}, ${bg[2]})`;\r\n      this._currentFrameContext.fillRect(0, 0, this._hdr.width, this._hdr.height);\r\n    } else {\r\n      this._currentFrameContext.clearRect(0, 0, this._currentFrameCanvas.width, this._currentFrameCanvas.height);\r\n    }\r\n\r\n    this._currentFrameContext.drawImage(canvas, frame.leftPos, frame.topPos, frame.width, frame.height);\r\n\r\n    const img = new Image();\r\n    img.src = this._currentFrameCanvas.toDataURL(); // default is png\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { Font } from '../Graphics/Font';\r\nimport { FontOptions } from '../Graphics/FontCommon';\r\nimport { GraphicOptions, RasterOptions } from '../Graphics';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport { Resource } from './Resource';\r\n\r\nexport interface FontSourceOptions extends Omit<FontOptions, 'family'>, GraphicOptions, RasterOptions {\r\n  /**\r\n   * Whether or not to cache-bust requests\r\n   */\r\n  bustCache?: boolean;\r\n}\r\n\r\nexport class FontSource implements Loadable<FontFace> {\r\n  private _resource: Resource<Blob>;\r\n  private _isLoaded = false;\r\n  private _options: FontSourceOptions;\r\n\r\n  data!: FontFace;\r\n\r\n  constructor(\r\n    /**\r\n     * Path to the font resource relative from the HTML document hosting the game, or absolute\r\n     */\r\n    public readonly path: string,\r\n    /**\r\n     * The font family name\r\n     */\r\n    public readonly family: string,\r\n    { bustCache, ...options }: FontSourceOptions = {}\r\n  ) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._options = options;\r\n  }\r\n\r\n  async load(): Promise<FontFace> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n\r\n    try {\r\n      const blob = await this._resource.load();\r\n      const url = URL.createObjectURL(blob);\r\n\r\n      if (!this.data) {\r\n        this.data = new FontFace(this.family, `url(${url})`);\r\n        document.fonts.add(this.data);\r\n      }\r\n\r\n      await this.data.load();\r\n      this._isLoaded = true;\r\n    } catch (error) {\r\n      throw `Error loading FontSource from path '${this.path}' with error [${(error as Error).message}]`;\r\n    }\r\n    return this.data;\r\n  }\r\n\r\n  isLoaded(): boolean {\r\n    return this._isLoaded;\r\n  }\r\n\r\n  /**\r\n   * Build a font from this FontSource.\r\n   * @param options {FontOptions} Override the font options\r\n   */\r\n  toFont(options?: FontOptions & GraphicOptions & RasterOptions): Font {\r\n    return new Font({ family: this.family, ...this._options, ...options });\r\n  }\r\n}\r\n","import { createContext, useContext } from '../Context';\r\nimport { Engine } from '../Engine';\r\nimport { ScheduledCallbackTiming } from './Clock';\r\nimport { Logger } from './Log';\r\nexport type CoroutineGenerator = () => Generator<any | number | Promise<any> | undefined, void, number>;\r\n\r\nconst InsideCoroutineContext = createContext<boolean>();\r\n\r\nconst generatorFunctionDeclaration = /^\\s*(?:function)?\\*/;\r\n/**\r\n *\r\n */\r\nfunction isCoroutineGenerator(x: any): x is CoroutineGenerator {\r\n  if (typeof x !== 'function') {\r\n    return false;\r\n  }\r\n  if (generatorFunctionDeclaration.test(Function.prototype.toString.call(x))) {\r\n    return true;\r\n  }\r\n  if (!Object.getPrototypeOf) {\r\n    return false;\r\n  }\r\n  return Object.getPrototypeOf(x) === Object.getPrototypeOf(new Function('return function * () {}')());\r\n}\r\n\r\nexport interface CoroutineOptions {\r\n  /**\r\n   * Coroutines run preframe in the clock by default.\r\n   */\r\n  timing?: ScheduledCallbackTiming;\r\n  /**\r\n   * Coroutines auto start by default, set to false to require play();\r\n   */\r\n  autostart?: boolean;\r\n}\r\n\r\ntype Thenable = PromiseLike<void>['then'];\r\n\r\nexport interface CoroutineInstance extends PromiseLike<void> {\r\n  isRunning(): boolean;\r\n  isComplete(): boolean;\r\n  done: Promise<void>;\r\n  generator: Generator<CoroutineInstance | number | Promise<any> | undefined, void, number>;\r\n  start: () => CoroutineInstance;\r\n  cancel: () => void;\r\n  then: Thenable;\r\n  [Symbol.iterator]: () => Generator<CoroutineInstance | number | Promise<any> | undefined, void, number>;\r\n}\r\n\r\n/**\r\n * Excalibur coroutine helper, returns a [[CoroutineInstance]] which is promise-like when complete. Coroutines run before frame update by default.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param thisArg set the \"this\" context of the generator, by default is globalThis\r\n * @param engine pass a specific engine to use for running the coroutine\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(\r\n  thisArg: any,\r\n  engine: Engine,\r\n  coroutineGenerator: CoroutineGenerator,\r\n  options?: CoroutineOptions\r\n): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param engine pass a specific engine to use for running the coroutine\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param thisArg set the \"this\" context of the generator, by default is globalThis\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(thisArg: any, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n *\r\n */\r\nexport function coroutine(...args: any[]): CoroutineInstance {\r\n  const logger = Logger.getInstance();\r\n  let coroutineGenerator: CoroutineGenerator;\r\n  let thisArg: any;\r\n  let options: CoroutineOptions | undefined;\r\n  let passedEngine: Engine | undefined;\r\n\r\n  // coroutine(coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (isCoroutineGenerator(args[0])) {\r\n    thisArg = globalThis;\r\n    coroutineGenerator = args[0];\r\n    options = args[1];\r\n  }\r\n\r\n  // coroutine(thisArg: any, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (isCoroutineGenerator(args[1])) {\r\n    thisArg = args[0];\r\n    coroutineGenerator = args[1];\r\n    options = args[2];\r\n  }\r\n\r\n  // coroutine(thisArg: any, engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (args[1] instanceof Engine) {\r\n    thisArg = args[0];\r\n    passedEngine = args[1];\r\n    coroutineGenerator = args[2];\r\n    options = args[3];\r\n  }\r\n\r\n  // coroutine(engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (args[0] instanceof Engine) {\r\n    thisArg = globalThis;\r\n    passedEngine = args[0];\r\n    coroutineGenerator = args[1];\r\n    options = args[2];\r\n  }\r\n\r\n  const inside = useContext(InsideCoroutineContext);\r\n  const schedule = options?.timing;\r\n  const autostart = inside ? false : options?.autostart ?? true;\r\n  let engine: Engine;\r\n  try {\r\n    engine = passedEngine ?? Engine.useEngine();\r\n  } catch (_) {\r\n    throw Error(\r\n      'Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.\\n' +\r\n        'Pass an engine parameter to ex.coroutine(engine, function * {...})'\r\n    );\r\n  }\r\n\r\n  let started = false;\r\n  let completed = false;\r\n  let cancelled = false;\r\n  const generatorFcn = coroutineGenerator.bind(thisArg) as CoroutineGenerator;\r\n  const generator = generatorFcn();\r\n  let loop: (elapsed: number) => void;\r\n  const complete = new Promise<void>((resolve, reject) => {\r\n    loop = (elapsed: number) => {\r\n      try {\r\n        if (cancelled) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n        const { done, value } = InsideCoroutineContext.scope(true, () => generator.next(elapsed));\r\n        if (done || cancelled) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        if (value instanceof Promise) {\r\n          value.then(() => {\r\n            // schedule next loop\r\n            engine.clock.schedule(loop, 0, schedule);\r\n          });\r\n        } else if (value === undefined || value === void 0) {\r\n          // schedule next frame\r\n          engine.clock.schedule(loop, 0, schedule);\r\n        } else {\r\n          // schedule value milliseconds from now\r\n          engine.clock.schedule(loop, value || 0, schedule);\r\n        }\r\n      } catch (e) {\r\n        reject(e);\r\n        return;\r\n      }\r\n    };\r\n    if (autostart) {\r\n      started = true;\r\n      loop(engine.clock.elapsed()); // run first frame immediately\r\n    }\r\n  });\r\n\r\n  const co: CoroutineInstance = {\r\n    isRunning: () => {\r\n      return started && !cancelled && !completed;\r\n    },\r\n    isComplete: () => {\r\n      return completed;\r\n    },\r\n    cancel: () => {\r\n      cancelled = true;\r\n    },\r\n    start: () => {\r\n      if (!started) {\r\n        started = true;\r\n        loop(engine.clock.elapsed());\r\n      } else {\r\n        logger.warn(\r\n          '.start() was called on a coroutine that was already started, this is probably a bug:\\n',\r\n          Function.prototype.toString.call(generatorFcn)\r\n        );\r\n      }\r\n      return co;\r\n    },\r\n    generator,\r\n    done: complete,\r\n    then: complete.then.bind(complete),\r\n    [Symbol.iterator]: () => {\r\n      // TODO warn if a coroutine is already running\r\n      // TODO warn if a coroutine is cancelled\r\n      return generator;\r\n    }\r\n  };\r\n\r\n  return co;\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Future } from '../Util/Future';\r\nimport { Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { Vector } from '../Math/vector';\r\nimport { clamp } from '../Math/util';\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { coroutine, CoroutineInstance } from '../Util/Coroutine';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport interface TransitionOptions {\r\n  /**\r\n   * Transition duration in milliseconds\r\n   */\r\n  duration: number;\r\n\r\n  /**\r\n   * Optionally hides the loader during the transition\r\n   *\r\n   * If either the out or in transition have this set to true, then the loader will be hidden.\r\n   *\r\n   * Default false\r\n   */\r\n  hideLoader?: boolean;\r\n\r\n  /**\r\n   * Optionally blocks user input during a transition\r\n   *\r\n   * Default false\r\n   */\r\n  blockInput?: boolean;\r\n\r\n  /**\r\n   * Optionally specify a easing function, by default linear\r\n   */\r\n  easing?: EasingFunction;\r\n  /**\r\n   * Optionally specify a transition direction, by default 'out'\r\n   *\r\n   * * For 'in' direction transitions start at 1 and complete is at 0\r\n   * * For 'out' direction transitions start at 0 and complete is at 1\r\n   */\r\n  direction?: 'out' | 'in';\r\n}\r\n\r\n/**\r\n * Base Transition that can be extended to provide custom scene transitions in Excalibur.\r\n */\r\nexport class Transition extends Entity {\r\n  private _logger: Logger = Logger.getInstance();\r\n  transform = new TransformComponent();\r\n  graphics = new GraphicsComponent();\r\n  readonly hideLoader: boolean;\r\n  readonly blockInput: boolean;\r\n  readonly duration: number;\r\n  readonly easing: EasingFunction;\r\n  readonly direction: 'out' | 'in';\r\n  private _completeFuture = new Future<void>();\r\n  protected _engine?: Engine;\r\n  private _co?: CoroutineInstance;\r\n\r\n  // State needs to be reset between uses\r\n  public started = false;\r\n  private _currentDistance: number = 0;\r\n  private _currentProgress: number = 0;\r\n\r\n  public done = this._completeFuture.promise;\r\n\r\n  /**\r\n   * Returns a number between [0, 1] indicating what state the transition is in.\r\n   *\r\n   * * For 'out' direction transitions start at 0 and end at 1\r\n   * * For 'in' direction transitions start at 1 and end at 0\r\n   */\r\n  get progress(): number {\r\n    return this._currentProgress;\r\n  }\r\n\r\n  get complete(): boolean {\r\n    if (this.direction === 'out') {\r\n      return this.progress >= 1;\r\n    } else {\r\n      return this.progress <= 0;\r\n    }\r\n  }\r\n\r\n  constructor(options: TransitionOptions) {\r\n    super();\r\n    this.name = `Transition#${this.id}`;\r\n    this.duration = options.duration;\r\n    this.easing = options.easing ?? EasingFunctions.Linear;\r\n    this.direction = options.direction ?? 'out';\r\n    this.hideLoader = options.hideLoader ?? false;\r\n    this.blockInput = options.blockInput ?? false;\r\n    this.transform.coordPlane = CoordPlane.Screen;\r\n    this.transform.pos = Vector.Zero;\r\n    this.transform.z = Infinity; // Transitions sit on top of everything\r\n    this.graphics.anchor = Vector.Zero;\r\n    this.addComponent(this.transform);\r\n    this.addComponent(this.graphics);\r\n\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = 0;\r\n    } else {\r\n      this._currentProgress = 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called before each update.\r\n   *\r\n   * **WARNING BE SURE** to call `super.updateTransition()` if overriding in your own custom implementation\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  public updateTransition(engine: Engine, elapsed: number): void {\r\n    if (this.complete) {\r\n      return;\r\n    }\r\n\r\n    this._currentDistance += clamp(elapsed / this.duration, 0, 1);\r\n    if (this._currentDistance >= 1) {\r\n      this._currentDistance = 1;\r\n    }\r\n\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = clamp(this.easing(this._currentDistance, 0, 1, 1), 0, 1);\r\n    } else {\r\n      this._currentProgress = clamp(this.easing(this._currentDistance, 1, 0, 1), 0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called right before the previous scene has deactivated.\r\n   *\r\n   * This gives incoming transition a chance to grab info from previous scene if desired\r\n   * @param scene\r\n   */\r\n  async onPreviousSceneDeactivate(scene: Scene) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called once at the beginning of the transition\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onStart(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called every frame of the transition\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onUpdate(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called at the end of the transition,\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onEnd(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called when the transition is reset\r\n   *\r\n   * Use this to override and provide your own reset logic for internal state in custom transition implementations\r\n   */\r\n  onReset() {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * reset() is called by the engine to reset transitions\r\n   */\r\n  reset() {\r\n    this.started = false;\r\n    this._completeFuture = new Future<void>();\r\n    this.done = this._completeFuture.promise;\r\n    this._currentDistance = 0;\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = 0;\r\n    } else {\r\n      this._currentProgress = 1;\r\n    }\r\n    this.onReset();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  _addToTargetScene(engine: Engine, targetScene: Scene): CoroutineInstance {\r\n    const currentScene = targetScene;\r\n    if (this.started) {\r\n      this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`);\r\n    }\r\n\r\n    if (currentScene.world.entityManager.getById(this.id)) {\r\n      return this._co!;\r\n    }\r\n    this._engine = engine;\r\n    currentScene.add(this);\r\n    const self = this;\r\n    this._co = coroutine(\r\n      engine,\r\n      function* () {\r\n        while (!self.complete) {\r\n          const elapsed = yield; // per frame\r\n          self.updateTransition(self._engine!, elapsed);\r\n          self._execute();\r\n        }\r\n      },\r\n      {\r\n        autostart: false\r\n      }\r\n    );\r\n    return this._co;\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur to swap scenes with transition\r\n   * @internal\r\n   */\r\n  async _play() {\r\n    if (this.started) {\r\n      this.reset();\r\n      this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`);\r\n    }\r\n\r\n    if (!this._engine || !this._co) {\r\n      this.reset();\r\n      this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`);\r\n    }\r\n\r\n    if (this._co) {\r\n      await this._co.start();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * execute() is called by the engine every frame to update the Transition lifecycle onStart/onUpdate/onEnd\r\n   * @internal\r\n   */\r\n  _execute() {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n\r\n    if (!this.started) {\r\n      this.started = true;\r\n      this.onStart(this.progress);\r\n    }\r\n\r\n    this.onUpdate(this.progress);\r\n\r\n    if (this.complete && !this._completeFuture.isCompleted) {\r\n      this.onEnd(this.progress);\r\n      this._completeFuture.resolve();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { Rectangle } from '../Graphics';\r\nimport { Transition, TransitionOptions } from './Transition';\r\n\r\nexport interface FadeOptions {\r\n  duration?: number;\r\n  color?: Color;\r\n}\r\n\r\nexport class FadeInOut extends Transition {\r\n  screenCover!: Rectangle;\r\n  color: Color;\r\n  constructor(options: FadeOptions & TransitionOptions) {\r\n    super({\r\n      ...options,\r\n      duration: options.duration ?? 2000\r\n    });\r\n    this.name = `FadeInOut#${this.id}`;\r\n    this.color = options.color ?? Color.Black;\r\n  }\r\n\r\n  public onInitialize(engine: Engine): void {\r\n    this.transform.pos = engine.screen.unsafeArea.topLeft;\r\n    this.screenCover = new Rectangle({\r\n      width: engine.screen.resolution.width,\r\n      height: engine.screen.resolution.height,\r\n      color: this.color\r\n    });\r\n    this.graphics.add(this.screenCover);\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onReset() {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onStart(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onEnd(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n}\r\n","import { ImageSource, Sprite } from '../Graphics';\r\nimport { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Transition, TransitionOptions } from './Transition';\r\nimport { vec } from '../Math/vector';\r\n\r\nexport interface CrossFadeOptions {\r\n  duration: number;\r\n}\r\n\r\n/**\r\n * CrossFades between the previous scene and the destination scene\r\n *\r\n * Note: CrossFade only works as an \"in\" transition\r\n */\r\nexport class CrossFade extends Transition {\r\n  engine!: Engine;\r\n  image!: HTMLImageElement;\r\n  screenCover!: Sprite;\r\n  constructor(options: TransitionOptions & CrossFadeOptions) {\r\n    super({ direction: 'in', ...options }); // default the correct direction\r\n    this.name = `CrossFade#${this.id}`;\r\n  }\r\n\r\n  override async onPreviousSceneDeactivate(scene: Scene<unknown>) {\r\n    this.image = await scene.engine.screenshot(true);\r\n    // Firefox is particularly slow\r\n    // needed in case the image isn't ready yet\r\n    await this.image.decode();\r\n  }\r\n\r\n  override onInitialize(engine: Engine): void {\r\n    this.engine = engine;\r\n    this.transform.pos = engine.screen.unsafeArea.topLeft;\r\n    this.screenCover = ImageSource.fromHtmlImageElement(this.image).toSprite();\r\n    this.graphics.add(this.screenCover);\r\n\r\n    // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\r\n    this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onStart(_progress: number): void {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onReset() {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onEnd(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n}\r\n","import { ImageSource, Sprite } from '../Graphics';\r\nimport { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Transition, TransitionOptions } from './Transition';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { Camera } from '../Camera';\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\n\r\nexport interface SlideOptions {\r\n  /**\r\n   * Duration of the transition in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Slide direction for the previous scene to move: up, down, left, right\r\n   */\r\n  slideDirection: 'up' | 'down' | 'left' | 'right';\r\n  /**\r\n   * Optionally select an easing function, by default linear (aka lerp)\r\n   */\r\n  easingFunction?: EasingFunction;\r\n}\r\n\r\n/**\r\n * Slide`s between the previous scene and the destination scene\r\n *\r\n * Note: Slide` only works as an \"in\" transition\r\n */\r\nexport class Slide extends Transition {\r\n  private _image!: HTMLImageElement;\r\n  private _screenCover!: Sprite;\r\n  private _easing = EasingFunctions.Linear;\r\n  private _vectorEasing: EasingFunction<Vector>;\r\n  readonly slideDirection: 'up' | 'down' | 'left' | 'right';\r\n  constructor(options: TransitionOptions & SlideOptions) {\r\n    super({ direction: 'in', ...options }); // default the correct direction\r\n    this.name = `Slide#${this.id}`;\r\n    this.slideDirection = options.slideDirection;\r\n    this.transform.coordPlane = CoordPlane.World;\r\n    this.graphics.forceOnScreen = true;\r\n    this._easing = options.easingFunction ?? this._easing;\r\n    this._vectorEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n  }\r\n\r\n  override async onPreviousSceneDeactivate(scene: Scene<unknown>) {\r\n    this._image = await scene.engine.screenshot(true);\r\n    // Firefox is particularly slow\r\n    // needed in case the image isn't ready yet\r\n    await this._image.decode();\r\n    this._screenCover = ImageSource.fromHtmlImageElement(this._image).toSprite();\r\n  }\r\n\r\n  private _destinationCameraPosition!: Vector;\r\n  private _startCameraPosition!: Vector;\r\n  private _camera!: Camera;\r\n  private _directionOffset!: Vector;\r\n  override onInitialize(engine: Engine): void {\r\n    this._engine = engine;\r\n    switch (this.slideDirection) {\r\n      case 'up': {\r\n        this._directionOffset = vec(0, -engine.screen.resolution.height);\r\n        break;\r\n      }\r\n      case 'down': {\r\n        this._directionOffset = vec(0, engine.screen.resolution.height);\r\n        break;\r\n      }\r\n      case 'left': {\r\n        this._directionOffset = vec(-engine.screen.resolution.width, 0);\r\n        break;\r\n      }\r\n      case 'right': {\r\n        this._directionOffset = vec(engine.screen.resolution.width, 0);\r\n        break;\r\n      }\r\n    }\r\n\r\n    this._camera = this._engine.currentScene.camera;\r\n    this._destinationCameraPosition = this._camera.pos.clone();\r\n\r\n    // For sliding shift the camera and the transition slide by offset\r\n    this._camera.pos = this._camera.pos.add(this._directionOffset);\r\n    this.transform.pos = this.transform.pos.add(this._directionOffset);\r\n\r\n    this._startCameraPosition = this._camera.pos.clone();\r\n\r\n    this.graphics.use(this._screenCover);\r\n\r\n    // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\r\n    this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    // in-transitions count down from 1 -> 0, so our \"end\" is swapped\r\n    this._camera.pos = this._vectorEasing(progress, this._destinationCameraPosition, this._startCameraPosition, 1);\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Graphic } from './Graphic';\r\n\r\nexport interface LineOptions {\r\n  start: Vector;\r\n  end: Vector;\r\n  color?: Color;\r\n  thickness?: number;\r\n}\r\nexport class Line extends Graphic {\r\n  readonly start: Vector;\r\n  readonly end: Vector;\r\n  color: Color = Color.Black;\r\n  thickness: number = 1;\r\n  private _localBounds: BoundingBox;\r\n  constructor(options: LineOptions) {\r\n    super();\r\n    const { start, end, color, thickness } = options;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.color = color ?? this.color;\r\n    this.thickness = thickness ?? this.thickness;\r\n    this._localBounds = this._calculateBounds();\r\n    const { width, height } = this._localBounds;\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  public get localBounds() {\r\n    return this._localBounds;\r\n  }\r\n\r\n  private _calculateBounds(): BoundingBox {\r\n    const lineNormal = this.end.sub(this.start).normal();\r\n\r\n    const halfThickness = this.thickness / 2;\r\n\r\n    const points = [\r\n      this.start.add(lineNormal.scale(halfThickness)),\r\n      this.end.add(lineNormal.scale(halfThickness)),\r\n      this.end.add(lineNormal.scale(-halfThickness)),\r\n      this.start.add(lineNormal.scale(-halfThickness))\r\n    ];\r\n\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, _x: number, _y: number): void {\r\n    ctx.drawLine(this.start, this.end, this.color, this.thickness);\r\n  }\r\n\r\n  clone(): Line {\r\n    return new Line({\r\n      start: this.start,\r\n      end: this.end,\r\n      color: this.color,\r\n      thickness: this.thickness\r\n    });\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface PolygonOptions {\r\n  points: Vector[];\r\n}\r\n\r\n/**\r\n * A polygon {@apilink Graphic} for drawing arbitrary polygons to the {@apilink ExcaliburGraphicsContext}\r\n *\r\n * Polygons default to {@apilink ImageFiltering.Blended}\r\n */\r\nexport class Polygon extends Raster {\r\n  private _points: Vector[] = [];\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n  public set points(points: Vector[]) {\r\n    this._points = points;\r\n    const min = this.minPoint;\r\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\r\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  public get minPoint() {\r\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\r\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\r\n    return vec(minX, minY);\r\n  }\r\n\r\n  constructor(options: RasterOptions & PolygonOptions) {\r\n    super(options);\r\n    this.points = options.points;\r\n    this.filtering = ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Polygon {\r\n    return new Polygon({\r\n      points: this.points.map((p) => p.clone()),\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.points && this.points.length) {\r\n      ctx.beginPath();\r\n      // Iterate through the supplied points and construct a 'polygon'\r\n      const min = this.minPoint.negate();\r\n      const firstPoint = this.points[0].add(min);\r\n      ctx.moveTo(firstPoint.x, firstPoint.y);\r\n      this.points.forEach((point) => {\r\n        ctx.lineTo(point.x + min.x, point.y + min.y);\r\n      });\r\n      ctx.lineTo(firstPoint.x, firstPoint.y);\r\n      ctx.closePath();\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { ImageSource } from './ImageSource';\r\nimport { Logger } from '../Util/Log';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * Nine slice stretch mode\r\n */\r\nexport enum NineSliceStretch {\r\n  /**\r\n   * Stretch the image across a dimension\r\n   */\r\n  Stretch = 'stretch',\r\n  /**\r\n   * Tile the image across a dimension\r\n   */\r\n  Tile = 'tile',\r\n  /**\r\n   * Tile the image across a dimension but only by whole image amounts\r\n   */\r\n  TileFit = 'tile-fit'\r\n}\r\n\r\nexport type NineSliceConfig = GraphicOptions & {\r\n  /**\r\n   * Final width of the nine slice graphic\r\n   */\r\n  width: number;\r\n  /**\r\n   * Final height of the nine slice graphic\r\n   */\r\n  height: number;\r\n  /**\r\n   *  Image source that's loaded from a Loader or individually\r\n   *\r\n   */\r\n  source: ImageSource;\r\n\r\n  /**\r\n   *  Configuration for the source\r\n   *\r\n   *  Details for the source image, including:\r\n   *\r\n   *  width and height as numbers of the source image\r\n   *\r\n   *  and the 9 slice margins\r\n   */\r\n  sourceConfig: {\r\n    width: number;\r\n    height: number;\r\n    topMargin: number;\r\n    leftMargin: number;\r\n    bottomMargin: number;\r\n    rightMargin: number;\r\n  };\r\n\r\n  /**\r\n   *  Configuration for the destination\r\n   *\r\n   *  Details for the destination image, including:\r\n   *\r\n   *  stretching strategies for horizontal and vertical stretching\r\n   *\r\n   *  and flag for drawing the center tile if desired\r\n   */\r\n  destinationConfig: {\r\n    /**\r\n     * Draw the center part of the nine slice, if false it's a completely transparent gap\r\n     */\r\n    drawCenter: boolean;\r\n    /**\r\n     * Horizontal stretch configuration\r\n     */\r\n    horizontalStretch: NineSliceStretch;\r\n    /**\r\n     * Vertical stretch configuration\r\n     */\r\n    verticalStretch: NineSliceStretch;\r\n  };\r\n};\r\n\r\nexport class NineSlice extends Graphic {\r\n  private _imgSource: ImageSource;\r\n  private _sourceSprite?: HTMLImageElement;\r\n  private _canvasA: HTMLCanvasElement;\r\n  private _canvasB: HTMLCanvasElement;\r\n  private _canvasC: HTMLCanvasElement;\r\n  private _canvasD: HTMLCanvasElement;\r\n  private _canvasE: HTMLCanvasElement;\r\n  private _canvasF: HTMLCanvasElement;\r\n  private _canvasG: HTMLCanvasElement;\r\n  private _canvasH: HTMLCanvasElement;\r\n  private _canvasI: HTMLCanvasElement;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  private _config: NineSliceConfig;\r\n  constructor(config: NineSliceConfig) {\r\n    super(config);\r\n    this._config = config;\r\n    this._imgSource = config.source;\r\n\r\n    this._canvasA = document.createElement('canvas');\r\n    this._canvasB = document.createElement('canvas');\r\n    this._canvasC = document.createElement('canvas');\r\n    this._canvasD = document.createElement('canvas');\r\n    this._canvasE = document.createElement('canvas');\r\n    this._canvasF = document.createElement('canvas');\r\n    this._canvasG = document.createElement('canvas');\r\n    this._canvasH = document.createElement('canvas');\r\n    this._canvasI = document.createElement('canvas');\r\n\r\n    this._initialize();\r\n\r\n    this._imgSource.ready.then(() => {\r\n      this._initialize();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets the target width of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\r\n   * @param newWidth\r\n   * @param auto\r\n   */\r\n  setTargetWidth(newWidth: number, auto: boolean = false) {\r\n    this._config.width = newWidth;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the target height of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\r\n   * @param newHeight\r\n   * @param auto\r\n   */\r\n  setTargetHeight(newHeight: number, auto: boolean = false) {\r\n    this._config.height = newHeight;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Sets the 9 slice margins (pixels), and recalculates the 9 slice if desired (auto)\r\n   */\r\n  setMargins(left: number, top: number, right: number, bottom: number, auto: boolean = false) {\r\n    this._config.sourceConfig.leftMargin = left;\r\n    this._config.sourceConfig.topMargin = top;\r\n    this._config.sourceConfig.rightMargin = right;\r\n    this._config.sourceConfig.bottomMargin = bottom;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Sets the stretching strategy for the 9 slice, and recalculates the 9 slice if desired (auto)\r\n   *\r\n   */\r\n  setStretch(type: 'horizontal' | 'vertical' | 'both', stretch: NineSliceStretch, auto: boolean = false) {\r\n    if (type === 'horizontal') {\r\n      this._config.destinationConfig.horizontalStretch = stretch;\r\n    } else if (type === 'vertical') {\r\n      this._config.destinationConfig.verticalStretch = stretch;\r\n    } else {\r\n      this._config.destinationConfig.horizontalStretch = stretch;\r\n      this._config.destinationConfig.verticalStretch = stretch;\r\n    }\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Returns the config of the 9 slice\r\n   */\r\n  getConfig(): NineSliceConfig {\r\n    return this._config;\r\n  }\r\n\r\n  /**\r\n   * Draws 1 of the 9 tiles based on parameters passed in\r\n   * context is the ExcaliburGraphicsContext from the _drawImage function\r\n   * destinationSize is the size of the destination image as a vector (width,height)\r\n   * targetCanvas is the canvas to draw to\r\n   * horizontalStretch and verticalStretch are the horizontal and vertical stretching strategies\r\n   * marginW and marginH are optional margins for the 9 slice for positioning\r\n   * @param context\r\n   * @param targetCanvas\r\n   * @param destinationSize\r\n   * @param horizontalStretch\r\n   * @param verticalStretch\r\n   * @param marginWidth\r\n   * @param marginHeight\r\n   */\r\n  protected _drawTile(\r\n    context: ExcaliburGraphicsContext,\r\n    targetCanvas: HTMLCanvasElement,\r\n    destinationSize: Vector,\r\n    horizontalStretch: NineSliceStretch,\r\n    verticalStretch: NineSliceStretch,\r\n    marginWidth?: number,\r\n    marginHeight?: number\r\n  ) {\r\n    const tempMarginW = marginWidth || 0;\r\n    const tempMarginH = marginHeight || 0;\r\n    let tempSizeX: number, tempPositionX: number, tempSizeY: number, tempPositionY: number;\r\n    const numTilesX = this._getNumberOfTiles(targetCanvas.width, destinationSize.x, horizontalStretch);\r\n    const numTilesY = this._getNumberOfTiles(targetCanvas.height, destinationSize.y, verticalStretch);\r\n\r\n    for (let i = 0; i < numTilesX; i++) {\r\n      for (let j = 0; j < numTilesY; j++) {\r\n        let { tempSize, tempPosition } = this._calculateParams(\r\n          i,\r\n          numTilesX,\r\n          targetCanvas.width,\r\n          destinationSize.x,\r\n          this._config.destinationConfig.horizontalStretch\r\n        );\r\n        tempSizeX = tempSize;\r\n        tempPositionX = tempPosition;\r\n\r\n        ({ tempSize, tempPosition } = this._calculateParams(\r\n          j,\r\n          numTilesY,\r\n          targetCanvas.height,\r\n          destinationSize.y,\r\n          this._config.destinationConfig.verticalStretch\r\n        ));\r\n        tempSizeY = tempSize;\r\n        tempPositionY = tempPosition;\r\n\r\n        context.drawImage(\r\n          targetCanvas,\r\n          0,\r\n          0,\r\n          targetCanvas.width,\r\n          targetCanvas.height,\r\n          tempMarginW + tempPositionX,\r\n          tempMarginH + tempPositionY,\r\n          tempSizeX,\r\n          tempSizeY\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Draws the 9 slices to the canvas\r\n   */\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this._imgSource.isLoaded()) {\r\n      // Top left, no stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasA,\r\n\r\n        new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.topMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch\r\n      );\r\n\r\n      // Top, middle, horizontal stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasB,\r\n\r\n        new Vector(\r\n          this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n          this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        this._config.sourceConfig.leftMargin,\r\n        0\r\n      );\r\n\r\n      // Top right, no stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasC,\r\n\r\n        new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n        0\r\n      );\r\n\r\n      // middle, left, vertical stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasD,\r\n        new Vector(\r\n          this._config.sourceConfig.leftMargin,\r\n\r\n          this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        0,\r\n        this._config.sourceConfig.topMargin\r\n      );\r\n\r\n      // center, both stretching\r\n      if (this._config.destinationConfig.drawCenter) {\r\n        this._drawTile(\r\n          ex,\r\n          this._canvasE,\r\n          new Vector(\r\n            this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n\r\n            this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n          ),\r\n          this._config.destinationConfig.horizontalStretch,\r\n          this._config.destinationConfig.verticalStretch,\r\n          this._config.sourceConfig.leftMargin,\r\n          this._config.sourceConfig.topMargin\r\n        );\r\n      }\r\n      // middle, right, vertical stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasF,\r\n\r\n        new Vector(\r\n          this._config.sourceConfig.rightMargin,\r\n\r\n          this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n        this._config.sourceConfig.topMargin\r\n      );\r\n\r\n      // bottom left, no stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasG,\r\n        new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.bottomMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        0,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n\r\n      // bottom middle, horizontal stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasH,\r\n\r\n        new Vector(\r\n          this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n          this._config.sourceConfig.bottomMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        this._config.sourceConfig.leftMargin,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n\r\n      // bottom right, no stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasI,\r\n        new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.bottomMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n    } else {\r\n      this._logger.warnOnce(\r\n        `NineSlice ImageSource ${this._imgSource.path}` +\r\n          ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\r\n          `Read https://excaliburjs.com/docs/imagesource for more information.`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Slices the source sprite into the 9 slice canvases internally\r\n   */\r\n  protected _initialize() {\r\n    this._sourceSprite = this._imgSource.image;\r\n\r\n    // top left slice\r\n    this._canvasA.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasA.height = this._config.sourceConfig.topMargin;\r\n    const aCtx = this._canvasA.getContext('2d');\r\n\r\n    aCtx?.drawImage(this._sourceSprite, 0, 0, this._canvasA.width, this._canvasA.height, 0, 0, this._canvasA.width, this._canvasA.height);\r\n\r\n    // top slice\r\n\r\n    this._canvasB.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasB.height = this._config.sourceConfig.topMargin;\r\n\r\n    const bCtx = this._canvasB.getContext('2d');\r\n    bCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      0,\r\n      this._canvasB.width,\r\n      this._canvasB.height,\r\n      0,\r\n      0,\r\n      this._canvasB.width,\r\n      this._canvasB.height\r\n    );\r\n\r\n    // top right slice\r\n    this._canvasC.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasC.height = this._config.sourceConfig.topMargin;\r\n    const cCtx = this._canvasC.getContext('2d');\r\n    cCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._sourceSprite.width - this._config.sourceConfig.rightMargin,\r\n      0,\r\n      this._canvasC.width,\r\n      this._canvasC.height,\r\n      0,\r\n      0,\r\n      this._canvasC.width,\r\n      this._canvasC.height\r\n    );\r\n\r\n    // middle left slice\r\n    this._canvasD.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasD.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const dCtx = this._canvasD.getContext('2d');\r\n    dCtx?.drawImage(\r\n      this._sourceSprite,\r\n      0,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasD.width,\r\n      this._canvasD.height,\r\n      0,\r\n      0,\r\n      this._canvasD.width,\r\n      this._canvasD.height\r\n    );\r\n\r\n    // middle slice\r\n    this._canvasE.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasE.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const eCtx = this._canvasE.getContext('2d');\r\n    eCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasE.width,\r\n      this._canvasE.height,\r\n      0,\r\n      0,\r\n      this._canvasE.width,\r\n      this._canvasE.height\r\n    );\r\n\r\n    // middle right slice\r\n    this._canvasF.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasF.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const fCtx = this._canvasF.getContext('2d');\r\n    fCtx?.drawImage(\r\n      this._sourceSprite,\r\n\r\n      this._config.sourceConfig.width - this._config.sourceConfig.rightMargin,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasF.width,\r\n      this._canvasF.height,\r\n      0,\r\n      0,\r\n      this._canvasF.width,\r\n      this._canvasF.height\r\n    );\r\n\r\n    // bottom left slice\r\n    this._canvasG.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasG.height = this._config.sourceConfig.bottomMargin;\r\n    const gCtx = this._canvasG.getContext('2d');\r\n    gCtx?.drawImage(\r\n      this._sourceSprite,\r\n      0,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasG.width,\r\n      this._canvasG.height,\r\n      0,\r\n      0,\r\n      this._canvasG.width,\r\n      this._canvasG.height\r\n    );\r\n\r\n    // bottom slice\r\n    this._canvasH.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasH.height = this._config.sourceConfig.bottomMargin;\r\n    const hCtx = this._canvasH.getContext('2d');\r\n    hCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasH.width,\r\n      this._canvasH.height,\r\n      0,\r\n      0,\r\n      this._canvasH.width,\r\n      this._canvasH.height\r\n    );\r\n\r\n    // bottom right slice\r\n    this._canvasI.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasI.height = this._config.sourceConfig.bottomMargin;\r\n    const iCtx = this._canvasI.getContext('2d');\r\n    iCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._sourceSprite.width - this._config.sourceConfig.rightMargin,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasI.width,\r\n      this._canvasI.height,\r\n      0,\r\n      0,\r\n      this._canvasI.width,\r\n      this._canvasI.height\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clones the 9 slice\r\n   */\r\n\r\n  clone(): NineSlice {\r\n    return new NineSlice(this._config);\r\n  }\r\n\r\n  /**\r\n   * Returns the number of tiles\r\n   */\r\n  protected _getNumberOfTiles(tileSize: number, destinationSize: number, strategy: NineSliceStretch): number {\r\n    switch (strategy) {\r\n      case NineSliceStretch.Stretch:\r\n        return 1;\r\n      case NineSliceStretch.Tile:\r\n        return Math.ceil(destinationSize / tileSize);\r\n      case NineSliceStretch.TileFit:\r\n        return Math.ceil(destinationSize / tileSize);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the position and size of the tile\r\n   */\r\n  protected _calculateParams(\r\n    tileNum: number,\r\n    numTiles: number,\r\n    tileSize: number,\r\n    destinationSize: number,\r\n    strategy: NineSliceStretch\r\n  ): { tempPosition: number; tempSize: number } {\r\n    switch (strategy) {\r\n      case NineSliceStretch.Stretch:\r\n        return {\r\n          tempPosition: 0,\r\n          tempSize: destinationSize\r\n        };\r\n      case NineSliceStretch.Tile:\r\n        // if last tile, adjust size\r\n        if (tileNum === numTiles - 1) {\r\n          //last tile\r\n          return {\r\n            tempPosition: tileNum * tileSize,\r\n            tempSize: tileSize - (numTiles * tileSize - destinationSize)\r\n          };\r\n        } else {\r\n          return {\r\n            tempPosition: tileNum * tileSize,\r\n            tempSize: tileSize\r\n          };\r\n        }\r\n\r\n      case NineSliceStretch.TileFit:\r\n        const reducedTileSize = destinationSize / numTiles;\r\n        const position = tileNum * reducedTileSize;\r\n        return {\r\n          tempPosition: position,\r\n          tempSize: reducedTileSize\r\n        };\r\n    }\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { ImageWrapConfiguration } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { ImageWrapping } from './Wrapping';\r\nimport { Animation, AnimationOptions } from './Animation';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { TiledSprite } from './TiledSprite';\r\nimport { watch } from '../Util/Watch';\r\nimport { Future } from '../Util/Future';\r\n\r\nexport interface TiledAnimationOptions {\r\n  /**\r\n   * Animation to tile\r\n   */\r\n  animation: Animation;\r\n  /**\r\n   * Optionally override source view on frame graphics\r\n   */\r\n  sourceView?: Partial<SourceView>;\r\n  /**\r\n   * Optionally override filtering options\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Default wrapping is Repeat for TiledAnimation\r\n   */\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  /**\r\n   * Total width in pixels for the tiling to take place\r\n   */\r\n  width: number;\r\n  /**\r\n   * Total height in pixels for the tiling to take place\r\n   */\r\n  height: number;\r\n}\r\n\r\nexport class TiledAnimation extends Animation {\r\n  private _ready = new Future<void>();\r\n  public ready = this._ready.promise;\r\n  private _tiledWidth: number = 0;\r\n  private _tiledHeight: number = 0;\r\n  private _sourceView: Partial<SourceView> = {};\r\n  constructor(options: GraphicOptions & Omit<AnimationOptions, 'frames'> & TiledAnimationOptions) {\r\n    super({\r\n      ...options,\r\n      frames: options.animation.frames.slice(),\r\n      strategy: options.animation.strategy,\r\n      frameDuration: options.animation.frameDuration,\r\n      speed: options.animation.speed,\r\n      reverse: options.animation.isReversed\r\n    });\r\n    this._sourceView = { ...options.sourceView };\r\n    this._tiledWidth = options.width;\r\n    this._tiledHeight = options.height;\r\n\r\n    const promises: Promise<void>[] = [];\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        const tiledSprite = new TiledSprite({\r\n          image: graphic.image,\r\n          width: options.width,\r\n          height: options.height,\r\n          sourceView: { ...graphic.sourceView },\r\n          wrapping: options.wrapping,\r\n          filtering: options.filtering\r\n        });\r\n        this.frames[i].graphic = tiledSprite;\r\n\r\n        // There is a new calc'd sourceView when ready\r\n        tiledSprite.ready.then(() => {\r\n          tiledSprite.sourceView = { ...tiledSprite.sourceView, ...this._sourceView };\r\n        });\r\n        promises.push(tiledSprite.ready);\r\n      }\r\n    }\r\n    Promise.all(promises).then(() => this._ready.resolve());\r\n  }\r\n\r\n  public static fromAnimation(animation: Animation, options?: Omit<TiledAnimationOptions, 'animation'>): TiledAnimation {\r\n    return new TiledAnimation({\r\n      width: animation.width,\r\n      height: animation.height,\r\n      ...options,\r\n      animation\r\n    });\r\n  }\r\n\r\n  private _updateSourceView() {\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        graphic.sourceView = { ...graphic.sourceView, ...this._sourceView };\r\n      }\r\n    }\r\n  }\r\n\r\n  get sourceView(): Partial<SourceView> {\r\n    return watch(this._sourceView, () => this._updateSourceView());\r\n  }\r\n\r\n  set sourceView(sourceView: Partial<SourceView>) {\r\n    this._sourceView = watch(sourceView, () => this._updateSourceView());\r\n    this._updateSourceView();\r\n  }\r\n\r\n  private _updateWidthHeight() {\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        graphic.sourceView.height = this._tiledHeight || graphic.height;\r\n        graphic.destSize.height = this._tiledHeight || graphic.height;\r\n        graphic.sourceView.width = this._tiledWidth || graphic.width;\r\n        graphic.destSize.width = this._tiledWidth || graphic.width;\r\n      }\r\n    }\r\n  }\r\n\r\n  get width() {\r\n    return this._tiledWidth;\r\n  }\r\n\r\n  get height() {\r\n    return this._tiledHeight;\r\n  }\r\n\r\n  override set width(width: number) {\r\n    this._tiledWidth = width;\r\n    this._updateWidthHeight();\r\n  }\r\n\r\n  override set height(height: number) {\r\n    this._tiledHeight = height;\r\n    this._updateWidthHeight();\r\n  }\r\n}\r\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = {\n    message: 'This feature will be removed in future versions of Excalibur.',\n    alternateMethod: null,\n    showStackTrace: false,\n    ...options\n  };\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Future } from './Future';\r\n\r\nclass AsyncWaitQueue<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _queue: Future<T>[] = [];\r\n\r\n  public get length(): number {\r\n    return this._queue.length;\r\n  }\r\n\r\n  public enqueue(): Promise<T> {\r\n    const future = new Future<T>();\r\n    this._queue.push(future);\r\n    return future.promise;\r\n  }\r\n\r\n  public dequeue(value: T): void {\r\n    const future = this._queue.shift();\r\n    future.resolve(value);\r\n  }\r\n}\r\n\r\n/**\r\n * Semaphore allows you to limit the amount of async calls happening between `enter()` and `exit()`\r\n *\r\n * This can be useful when limiting the number of http calls, browser api calls, etc either for performance or to work\r\n * around browser limitations like max Image.decode() calls in chromium being 256.\r\n */\r\nexport class Semaphore {\r\n  private _waitQueue = new AsyncWaitQueue();\r\n  constructor(private _count: number) {}\r\n\r\n  public get count() {\r\n    return this._count;\r\n  }\r\n\r\n  public get waiting() {\r\n    return this._waitQueue.length;\r\n  }\r\n\r\n  // eslint-disable-next-line require-await\r\n  public async enter() {\r\n    if (this._count !== 0) {\r\n      this._count--;\r\n      return Promise.resolve();\r\n    }\r\n    return this._waitQueue.enqueue();\r\n  }\r\n\r\n  public exit(count: number = 1) {\r\n    if (count === 0) {\r\n      return;\r\n    }\r\n    while (count !== 0 && this._waitQueue.length !== 0) {\r\n      this._waitQueue.dequeue(null);\r\n      count--;\r\n    }\r\n    this._count += count;\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './GarbageCollector';\r\nexport * from './Screen';\r\nexport * from './Actor';\r\nexport * from './Math/index';\r\nexport * from './Camera';\r\nexport * from './Debug/index';\r\nexport * from './EventEmitter';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Particles/index';\r\nexport * from './Scene';\r\n\r\nexport * from './TileMap/index';\r\n\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/index';\r\nexport * from './Collision/Index';\r\n\r\nexport * from './Interfaces/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Director/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\nexport { WheelEvent } from './Input/WheelEvent';\r\n\r\nexport { PointerEvent } from './Input/PointerEvent';\r\n\r\nexport { WheelDeltaMode } from './Input/WheelDeltaMode';\r\n\r\nexport { PointerButton } from './Input/PointerButton';\r\n\r\nexport { NativePointerButton } from './Input/NativePointerButton';\r\n\r\nexport { CapturePointerConfig } from './Input/CapturePointerConfig';\r\n\r\nexport {\r\n  NativePointerEvent,\r\n  NativeMouseEvent,\r\n  NativeTouchEvent,\r\n  NativeWheelEvent,\r\n  PointerInitOptions,\r\n  PointerEventReceiver\r\n} from './Input/PointerEventReceiver';\r\n\r\nexport { PointerAbstraction } from './Input/PointerAbstraction';\r\nexport { PointerComponent } from './Input/PointerComponent';\r\nexport { PointerSystem } from './Input/PointerSystem';\r\nexport { PointerType } from './Input/PointerType';\r\nexport { PointerScope } from './Input/PointerScope';\r\n\r\nexport {\r\n  Gamepads,\r\n  Gamepad,\r\n  Buttons,\r\n  Axes,\r\n  NavigatorGamepads,\r\n  NavigatorGamepad,\r\n  NavigatorGamepadButton,\r\n  NavigatorGamepadEvent,\r\n  GamepadConfiguration\r\n} from './Input/Gamepad';\r\n\r\nexport { Keys, KeyEvent, KeyboardInitOptions, Keyboard } from './Input/Keyboard';\r\nexport * from './Input/InputHost';\r\nexport * from './Input/InputMapper';\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/Pool';\r\nexport * from './Util/Fps';\r\nexport * from './Util/Clock';\r\nexport * from './Util/WebAudio';\r\nexport * from './Util/Toaster';\r\nexport * from './Util/StateMachine';\r\nexport * from './Util/Future';\r\nexport * from './Util/Semaphore';\r\nexport * from './Util/Coroutine';\r\nexport * from './Util/Assert';\r\n\r\n// ex.Deprecated\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n","// wester.ts\r\n\r\nimport { Camera, CollisionGroupManager, CollisionType, Color, Engine, Keys, Timer, vec, Vector } from \"excalibur\";\r\nimport { Bullet, getAngleTowards } from \"./bullet\";\r\nimport { LivingEntity } from \"./livingentity\";\r\n\r\nexport const PlayerCollisionGroup = CollisionGroupManager.create('player');\r\n\r\nexport class Wester extends LivingEntity {\r\n    public health: number = 10;\r\n    public maxHealth: number = 10;\r\n    public moveSpeed: number = 300;\r\n\r\n    public ammo: number = 6;\r\n    public maxAmmo: number = 6;\r\n    public canShoot: boolean = true;\r\n\r\n    public INVINCIBILITY_TIME = 1000;\r\n    public GUN_COOLDOWN_TIME = 0.2 * 1000;\r\n\r\n    constructor(engine: Engine) {\r\n        super({\r\n            pos: vec(engine.screen.width / 2, engine.screen.height / 2),\r\n            width: 32,\r\n            height: 32,\r\n            color: Color.Yellow,\r\n            collisionType: CollisionType.Passive,\r\n            collisionGroup: PlayerCollisionGroup\r\n        })\r\n    }\r\n\r\n    public shootGun(engine: Engine) {\r\n        if (this.canShoot) {\r\n            const gunTimer: Timer = new Timer({\r\n                fcn: () => this.canShoot = true,\r\n                repeats: false,\r\n                interval: this.GUN_COOLDOWN_TIME,\r\n            })\r\n\r\n            const bullet = new Bullet(\r\n                this.pos,\r\n                getAngleTowards(\r\n                    this.pos,\r\n                    engine.input.pointers.primary.lastScreenPos\r\n                ),\r\n                PlayerCollisionGroup\r\n            );\r\n\r\n            engine.currentScene.add(bullet);\r\n            engine.currentScene.add(gunTimer);\r\n\r\n            this.canShoot = false;\r\n            gunTimer.start();\r\n        }\r\n    }\r\n\r\n    override onInitialize(engine: Engine) {\r\n        const wester = this;\r\n        wester.addTag(\"player\");\r\n        wester.addTag(\"living\");\r\n\r\n        engine.input.pointers.primary.on('down', function (evt) {\r\n            wester.shootGun(engine);\r\n        });\r\n\r\n        this.on('collisionstart', (event) => {\r\n            if ('DAMAGE' in event.other.owner) {\r\n                wester.dealDamage(engine, event.other.owner.DAMAGE);\r\n            }\r\n        })\r\n    }\r\n\r\n    override onPostUpdate(engine: Engine, dt: number): void {\r\n        const moveVector: Vector = vec(\r\n            (engine.input.keyboard.isHeld(Keys.A) ? -1 : 0) + (engine.input.keyboard.isHeld(Keys.D) ? 1 : 0),\r\n            (engine.input.keyboard.isHeld(Keys.W) ? -1 : 0) + (engine.input.keyboard.isHeld(Keys.S) ? 1 : 0),\r\n        ).normalize().scaleEqual(this.moveSpeed);\r\n\r\n        this.vel = moveVector;\r\n    }\r\n}","import { Actor, Color, Engine, Entity, Timer, vec, Vector } from \"excalibur\";\r\n\r\nexport class Bullet extends Actor {\r\n    public BULLET_SPEED: number = 1000;\r\n    public DAMAGE = 1;\r\n\r\n    constructor(pos: Vector, rotation: number, collisionGroup) {\r\n        super({\r\n            width: 8,\r\n            height: 8,\r\n            color: Color.Black,\r\n            rotation: rotation,\r\n            pos: pos,\r\n            collisionGroup: collisionGroup\r\n        })\r\n    }\r\n\r\n    override onInitialize(engine: Engine) {\r\n        const bullet = this;\r\n\r\n        // bullet despawn timer\r\n        const timer = new Timer({\r\n            fcn: () => {\r\n                engine.currentScene.remove(this)\r\n            },\r\n            repeats: false,\r\n            interval: 2000\r\n        })\r\n\r\n        engine.currentScene.add(timer);\r\n        timer.start();\r\n\r\n        // bullets damage entities that are not the creator\r\n        this.on('collisionstart', (event) => {\r\n            if ('dealDamage' in event.other.owner) {\r\n                event.other.owner.dealDamage(engine, bullet.DAMAGE);\r\n            }\r\n\r\n            engine.currentScene.remove(bullet)\r\n        })\r\n    }\r\n\r\n    override onPostUpdate(engine: Engine, dt: number): void {\r\n        this.vel = Vector.fromAngle(this.rotation).scaleEqual(this.BULLET_SPEED);\r\n    }\r\n}\r\n\r\nexport function getAngleTowards(from: Vector, to: Vector) {\r\n    return Math.atan((to.y - from.y) / (to.x - from.x)) + (to.x > from.x ? 2 * Math.PI : Math.PI) || 0;\r\n}","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","import { Actor, Engine, Timer } from \"excalibur\";\r\n\r\nexport abstract class LivingEntity extends Actor {\r\n    public health: number;\r\n    public maxHealth: number;\r\n    public moveSpeed: number;\r\n    public invincible: boolean = false;\r\n\r\n    public INVINCIBILITY_TIME: number;\r\n\r\n    public dealDamage(engine: Engine, amt: number) {\r\n        if (!this.invincible) {\r\n            this.health -= amt;\r\n\r\n            if (this.INVINCIBILITY_TIME > 0) {\r\n                this.invincible = true;\r\n\r\n                const invincibilityTimer: Timer = new Timer({\r\n                    fcn: () => this.invincible = false,\r\n                    repeats: false,\r\n                    interval: this.INVINCIBILITY_TIME,\r\n                })\r\n\r\n                engine.currentScene.add(invincibilityTimer);\r\n                invincibilityTimer.start();\r\n            }\r\n        }\r\n    }\r\n\r\n    public heal(amt: number) {\r\n        this.health = Math.min(this.health + amt, this.maxHealth);\r\n    }\r\n}","import { CollisionType, Color, Engine, vec } from \"excalibur\";\r\nimport { Enemy } from \"./enemy\";\r\n\r\nexport class Slime extends Enemy {\r\n    public health: number = 2;\r\n    public maxHealth: number = 2;\r\n    public moveSpeed: number = 150;\r\n\r\n    public INVINCIBILITY_TIME: number = 0;\r\n    public DAMAGE: number = 2;\r\n\r\n    constructor(pos: Vector) {\r\n        super({\r\n            pos: pos,\r\n            width: 32,\r\n            height: 32,\r\n            color: Color.Green,\r\n            collisionType: CollisionType.Active,\r\n        })\r\n    }\r\n\r\n    override onInitialize(engine: Engine) {\r\n        this.addTag(\"enemy\");\r\n        this.addTag(\"living\");\r\n    }\r\n\r\n    override onPostUpdate(engine: Engine, dt: number): void {\r\n        const wester = engine.currentScene.world.queryTags([\"player\"]).entities[0];\r\n\r\n        if (wester) {\r\n            this.target = wester.pos;\r\n            this.moving = true;\r\n        } else {\r\n            this.moving = false;\r\n        }\r\n\r\n        this.moveTowardsTarget();\r\n        this.testForDeath(engine);\r\n    }\r\n}","import { Engine, Vector } from \"excalibur\";\r\nimport { getAngleTowards } from \"./bullet\";\r\nimport { LivingEntity } from \"./livingentity\";\r\n\r\nexport abstract class Enemy extends LivingEntity {\r\n    public target: Vector;\r\n    public moving: boolean;\r\n    public DAMAGE: number;\r\n\r\n    public testForDeath(engine: Engine) {\r\n        if (this.health <= 0) {\r\n            engine.currentScene.remove(this);\r\n        }\r\n    }\r\n\r\n    public moveTowardsTarget() {\r\n        if (this.moving) {\r\n            this.vel = Vector.fromAngle(getAngleTowards(this.pos, this.target))\r\n                .scaleEqual(this.moveSpeed);\r\n        }\r\n    }\r\n}"],"names":["root","factory","exports","module","define","amd","self","___CSS_LOADER_EXPORT___","push","id","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","PointerScope","RotationType","polyfill","window","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","requestIdleCallback","cb","start","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","clearTimeout","Flags","useCanvasGraphicsContext","enable","useLegacyImageRenderer","freeze","_FROZEN","_reset","_FLAGS","flagName","Error","disable","isEnabled","show","keys","createId","type","Future","constructor","_isCompleted","promise","_resolver","_rejecter","isCompleted","error","EventEmitter","_paused","_empty","_listeners","_listenersOnce","_pipes","clear","on","eventName","handler","close","off","once","newListeners","filter","h","newOnceListeners","emit","event","listeners","onces","pipe","emitter","indexOf","splice","unpipe","pause","unpause","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Array","s","_index","_twist","mag01","y","nextInt","next","floating","min","integer","floor","bool","likelihood","pickOne","array","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","result","currentPick","tempArray","slice","index","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","x","ceil","sign","val","clamp","approximatelyEqual","val1","val2","tolerance","abs","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","_x","randomInRange","random","randomIntInRange","round","Vector","Zero","One","Half","Up","Down","Left","Right","fromAngle","cos","sin","isValid","vec","isNaN","Infinity","distance","vec1","vec2","sqrt","pow","_y","setTo","equals","vector","EQUALS_EPSILON","v","deltaX","deltaY","squareDistance","clampMagnitude","magnitude","newSize","size","newLength","normalize","scale","newMagnitude","average","add","sizeOrScale","dest","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","angleBetween","rotationType","startAngleRadians","endAngleRadians","rotationClockwise","rotationAntiClockwise","ShortestPath","LongestPath","Clockwise","CounterClockwise","rotate","anchor","sinAngle","cosAngle","clone","fixed","toFixed","Color","g","b","fromRGB","fromRGBString","string","match","parseInt","parseFloat","fromHex","hex","fromHSL","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","c","hexRepresentation","String","fillStyle","Black","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Rose","Pink","Magenta","Violet","Purple","Blue","Azure","Cyan","Viridian","Teal","Green","Chartreuse","Transparent","ExcaliburBlue","Brown","hue2rgb","p","q","t","LogLevel","Side","MatrixLocations","Logger","_appenders","defaultLevel","Info","_logOnceSet","Set","_INSTANCE","addAppender","ConsoleAppender","getInstance","appender","clearAppenders","_log","level","args","len","log","_logOnce","serialized","has","debug","Debug","debugOnce","info","infoOnce","warn","Warn","warnOnce","errorOnce","fatal","Fatal","fatalOnce","console","consoleArgs","unshift","apply","ScreenAppender","options","_messages","_pos","_color","_options","canvas","document","createElement","_ctx","getContext","style","position","zIndex","body","appendChild","_positionScreenAppenderCanvas","engine","events","width","resolution","height","pagePos","screenToPageCoordinates","left","top","xPos","message","clearRect","pos","fillText","getOpposite","side","Top","Bottom","None","fromDirection","direction","BoundingBox","leftOrOptions","right","bottom","_points","reset","getSideFromIntersection","intersection","fromPoints","points","minX","minY","maxX","maxY","fromDimension","hasZeroDimensions","center","topLeft","bottomRight","topRight","bottomLeft","translate","point","getPoints","shifted","transform","matrix","xa1","xa2","xb1","xb2","ya1","ya2","yb1","yb2","matrixPos","getPosition","getPerimeter","_left","_right","_top","_bottom","rayCast","ray","farClipDistance","tMin","tMax","xInv","dir","Number","MAX_VALUE","yInv","tx1","tx2","ty1","ty2","rayCastTime","contains","combine","other","compositeBB","dimensions","overlaps","epsilon","e","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","draw","ex","drawRect","el","getBoundingClientRect","rect","scrollX","scrollY","addItemToArray","removeItemFromArray","fail","delay","milliseconds","clock","future","schedule","bind","omit","object","newObj","includes","isObject","isArray","mergeDeep","target","sources","source","shift","assign","Matrix","Float32Array","_scaleX","_scaleSignX","_scaleY","_scaleSignY","ortho","near","far","mat","toDOMMatrix","DOMMatrix","fromFloat32Array","identity","translation","sx","sy","rotation","vectorOrMatrix","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","AffineMatrix","Float64Array","_scale","determinant","inverse","det","signX","signY","multiplyQuadInPlace","quad","resultTopLeftX","resultTopLeftY","resultTopRightX","resultTopRightY","resultBottomLeftX","resultBottomLeftY","resultBottomRightX","resultBottomRightY","to4x4","xScaleSq","yScaleSq","RentalPool","builder","cleaner","preAllocate","_pool","_size","grow","amount","rent","clean","pop","TransformStack","_transforms","_currentTransform","save","restore","return","current","ContextState","opacity","z","tint","material","StateStack","_states","_cloneState","ResourceEvents","Complete","Load","LoadStart","Progress","Resource","path","responseType","bustCache","logger","isLoaded","_cacheBust","uri","test","load","request","XMLHttpRequest","open","addEventListener","status","response","statusText","Blob","errorText","send","watch","change","__isProxy","Proxy","set","createHandler","typeType","Graphic","isStale","_transformStale","flipHorizontal","_flipHorizontal","flipVertical","_flipVertical","_rotation","origin","_origin","_ID","showDebug","_width","_height","cloneGraphicOptions","localBounds","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","Sprite","image","super","_logger","_dirty","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","drawImage","ImageFiltering","ImageWrapping","parseImageFiltering","Pixel","Blended","parseImageWrapping","Clamp","Repeat","Mirror","TextureLoader","gl","_garbageCollector","_textureMap","Map","_collect","_gl","name","dataset","originalSrc","_LOGGER","delete","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","collectionInterval","garbageCollector","registerCollector","dispose","forceUpdate","filtering","wrapping","wrappingConfig","tex","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","touch","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","xWrap","yWrap","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","REPEAT","MIRRORED_REPEAT","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","NEAREST","LINEAR","TEXTURE_MAG_FILTER","addCollectableResource","texture","deleteTexture","ImageSourceAttributeConstants","Filtering","WrappingX","WrappingY","ImageSource","naturalWidth","naturalHeight","_src","src","pathOrBase64","bustCacheOrOptions","Image","_readyFuture","_resource","endsWith","fromHtmlImageElement","imageSource","setAttribute","fromHtmlCanvasElement","toBlob","blob","url","URL","createObjectURL","onload","revokeObjectURL","fromSvgString","svgSource","loadedFuture","toSprite","unload","SpriteFont","_text","alphabet","shadow","caseInsensitive","spacing","lineHeight","spriteSheet","_getCharacterSprites","text","results","textToRender","toLocaleLowerCase","letterIndex","letter","spriteIndex","letterSprite","sprites","measureText","maxWidth","lines","_getLinesFromText","maxWidthLine","reduce","sprite","xCursor","yCursor","line","render","bounds","offset","_cachedText","_cachedRenderWidth","_cachedLines","split","newLine","TiledSprite","_ready","_applyTiling","fromSprite","spriteCanvas","tiledImageSource","SpriteSheet","rows","columns","getSprite","spriteWithOptions","getTiledSprite","fromImageSourceWithSourceViews","sourceViews","fromImageSource","grid","cols","spriteWidth","spriteHeight","originOffset","margin","offsetDefaults","marginDefaults","DebugText","fontSheet","_imageSource","_spriteSheet","_spriteFont","write","ctx","RenderSource","_texture","use","activeTexture","TEXTURE0","RenderTarget","antialias","samples","transparency","MAX_SAMPLES","drawingBufferFormat","bufferFormat","RGBA8","RGB8","_setupRenderBuffer","_setupFramebuffer","setResolution","_frameTexture","_renderBuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorageMultisample","renderBuffer","renderFrameBuffer","_renderFrameBuffer","frameBuffer","_frameBuffer","frameTexture","createRenderbuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferRenderbuffer","COLOR_ATTACHMENT0","attachmentPoint","framebufferTexture2D","toRenderSource","blitRenderBufferToFrameBuffer","blitToScreen","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","clearBufferfv","COLOR","blitFramebuffer","COLOR_BUFFER_BIT","copyToTexture","copyTexImage2D","viewport","getGlTypeSizeBytes","INT","UNSIGNED_INT","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","isAttributeInSource","variable","matches","RegExp","exec","getGLTypeFromSource","groups","BOOL","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","getAttributePointerType","getMaxShaderComplexity","numIfs","assembleTestShader","testShader","testComplexity","replace","canCompile","shader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","Shader","compiled","_compiled","uniforms","attributes","vertexSource","fragmentSource","onPreLink","onPostCompile","_onPreLink","_onPostCompile","deleteProgram","program","useProgram","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","trySetUniformInt","trySetUniform","setUniformIntArray","trySetUniformIntArray","setUniformBoolean","trySetUniformBoolean","setUniformFloat","trySetUniformFloat","setUniformFloatArray","trySetUniformFloatArray","setUniformFloatVector","trySetUniformFloatVector","setUniformFloatColor","trySetUniformFloatColor","setUniformMatrix","setUniformAffineMatrix","trySetUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","unbind","upload","count","bufferSubData","deleteBuffer","VertexLayout","vertexBuffer","_vertexBuffer","_attributes","_suppressWarnings","_layout","_vertexTotalSizeBytes","_initialized","suppressWarnings","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","_vao","createVertexArray","bindVertexArray","vert","vertexAttribIPointer","vertexAttribPointer","enableVertexAttribArray","uploadBuffer","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_startScratch","_endScratch","context","_context","end","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","snapToPixel","finalPoint","pixelSnapEpsilon","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","onDraw","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","maxUint16","maxUint16Index","bufferGlType","Uint16Array","Uint32Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","_textureIndex","_textureToIndex","_images","_imageToWidth","_imageToHeight","_view","_dest","_quad","_defaultTint","pixelArtSampler","uvPadding","maxTexture","MAX_TEXTURE_IMAGE_UNITS","maxComplexity","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","maybeFiltering","getAttribute","wrapX","wrapY","force","textureLoader","removeAttribute","_bindTextures","_getTextureIdForImage","maybeTexture","_getImageWidth","maybeWidth","_getImageHeight","maybeHeight","swidth","sheight","dx","dy","dwidth","dheight","maybeImageWidth","maybeImageHeight","sw","sh","textureId","imageWidth","imageHeight","uvx0","uvy0","uvx1","uvy1","txWidth","txHeight","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","_transparent","_scratch1","_scratch2","_scratch3","_scratch4","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","Pool","recycler","maxObjects","totalAllocations","objects","disableWarnings","preallocate","using","done","borrow","poolIndex","DrawCall","renderer","state","Material","graphicsContext","images","_name","_vertexSource","_fragmentSource","ExcaliburGraphicsContextWebGL","_graphicsContext","_initialize","addImageSource","graphicsContextWebGL","__gl","_maxTextureSlots","isUsingScreenTexture","update","textureUniformName","removeImageSource","textureName","_loadImageSource","imageElement","uploadAndBind","startingTextureSlot","textureSlot","entries","MaterialRenderer","vertexIndex","view","topLeftScreen","bottomRightScreen","screenUVX0","screenUVY0","screenUVX1","screenUVY1","performance","materialScreenTexture","CoordPlane","AnimationDirection","AnimationStrategy","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","WatchVector","original","newX","newY","_parent","_children","flagDirty","_globalPos","parent","_globalScale","globalScaleX","globalScale","globalScaleY","_z","_isDirty","_isInverseDirty","_matrix","_inverse","_scratch","children","globalPos","localPos","canonRotation","globalRotation","inverseRotation","inverseScale","globalZ","_calculateMatrix","applyInverse","setTransform","isMirrored","cloneWithParent","isComponentCtor","Component","owner","newComponent","Observable","observers","subscriptions","register","observer","subscribe","func","unregister","unsubscribe","notifyAll","observersLength","notify","subscriptionsLength","TransformComponent","_parentComponent","_transform","_addChildTransform","child","childTxComponent","zIndexChanged$","_coordPlane","World","onAdd","childrenAdded$","childrenRemoved$","onRemove","_previousOwner","oldz","coordPlane","component","AnimationEvents","Frame","Loop","End","Animation","frames","strategy","frameDuration","_idempotencyToken","_firstTick","_currentFrame","_timeLeftInFrame","_pingPongDirection","_done","_playing","_speed","_reversed","speed","totalDuration","reverse","goToFrame","f","maybeFrame","currentFrame","graphic","fromSpriteSheet","spriteSheetIndex","durationPerFrame","maxIndex","invalidIndices","duration","fromSpriteSheetCoordinates","frameCoordinates","durationPerFrameMs","defaultDuration","coord","currentFrameIndex","currentFrameTimeLeft","isPlaying","isReversed","Backward","Forward","play","canFinish","Freeze","frameNumber","frameIndex","_nextFrame","PingPong","tick","elapsed","idempotencyToken","GraphicsGroup","useAnchor","members","_updateDimensions","member","useBounds","_isAnimationOrGroup","Raster","lineCap","quality","_smoothing","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","imageSmoothingEnabled","setLineDash","getLineDash","strokeStyle","FontUnit","TextAlign","BaseAlign","FontStyle","Direction","EventTypes","x1","y1","x2","y2","cap","beginPath","moveTo","lineTo","closePath","arc","roundRect","fill","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle","FontTextInstance","font","_textFragments","disposed","_setDimension","_lastHashCode","getHashCode","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","textBounds","bitmap","lineHeightRatio","fontString","textAlign","baseAlign","includeColor","resetTransform","textBaseline","shadowColor","blur","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","strokeText","_splitTextBitmap","textImages","currentX","currentY","_ex","hashCode","frag","FontCache","hash","_MEASURE_CACHE","measurement","measureTextWithoutCache","getTextInstance","textInstance","_TEXT_CACHE","_TEXT_USAGE","checkAndClearCache","deferred","currentHashCodes","time","FONT_TIMEOUT","forEach","newTextMeasurementCache","cacheSize","clearCache","Font","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textMeasurement","colorOverride","Text","_textWidth","_textHeight","_calculateDimension","_font","hasGraphicsTick","GraphicsComponent","visible","isVisible","_offset","recalculateBounds","_anchor","currentGraphic","graphics","_current","_graphics","forceOnScreen","copyGraphics","onPreDraw","onPostDraw","onPreTransformDraw","onPostTransformDraw","graphicOrOptions","getGraphic","getOptions","getNames","currentOptions","nameOrGraphic","optionsToSet","graphicToSet","remove","hide","_localBounds","offsetX","offsetY","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","PostDrawEvent","PreTransformDrawEvent","PostTransformDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","VisibleEvent","HiddenEvent","PreCollisionEvent","contact","PostCollisionEvent","ContactStartEvent","ContactEndEvent","lastContact","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","DeactivateEvent","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","entity","ExitTriggerEvent","ActionStartEvent","action","ActionCompleteEvent","AddEvent","RemoveEvent","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","EntityEvents","Add","Remove","Initialize","PreUpdate","PostUpdate","Kill","Entity","componentsOrOptions","componentsToAdd","nameToAdd","_tags","componentAdded$","componentRemoved$","tagAdded$","tagRemoved$","components","componentValues","_componentsToRemove","scene","isActive","_isInitialized","_isAdded","silence","silenceWarnings","addComponent","active","kill","unparent","isKilled","tags","hasTag","tag","addTag","removeTag","types","getComponents","values","hasAll","requiredTypes","hasAllTags","requiredTags","removeChild","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","componentInstance","addTemplate","templateEntity","_getClassHierarchyRoot","componentType","getPrototypeOf","removeComponent","dependencies","ctor","rootComponent","typeOrInstance","componentToRemove","componentIndex","clearComponents","processComponentRemoval","isInitialized","isAdded","onInitialize","_add","_remove","_preupdate","onPreUpdate","_postupdate","onPostUpdate","MotionComponent","vel","acc","scaleFactor","angularVelocity","torque","inertia","EulerIntegrator","integrate","motion","totalAcc","seconds","_ACC","_VEL","_POS","_VEL_ACC","_SCALE_FACTOR","_SCALE","Particle","beginColor","endColor","life","fade","_rRate","_gRate","_bRate","_aRate","_currentColor","sizeRate","isOffscreen","particleTransform","ParticleTransform","Global","configure","registerEmitter","_emitter","startSize","endSize","drawPoint","removeParticle","accel","focus","focusAccel","DefaultConfig","ParticleRenderer","transformFeedbackVaryings","INTERLEAVED_ATTRIBS","_getTexture","particle","Local","ImageRendererV2","_components","_quadMesh","_meshBuffer","_transformData","totalSize","vertexAttribDivisor","_bindData","drawArraysInstanced","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","pointOptions","drawText","_state","_ortho","checkIfResolutionSupported","dim","supported","_renderers","_lazyRenderersFactory","imageRenderer","_isDrawLifecycle","useDrawSorting","_drawCallPool","_drawCallIndex","_drawCalls","_postProcessTargets","_postprocessors","backgroundColor","multiSampleAntialiasing","_isContextLost","_disposed","_totalPostProcessorTime","canvasElement","enableTransparency","antialiasing","powerPreference","handleContextLost","handleContextRestored","premultipliedAlpha","alpha","depth","_init","clearColor","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","depthMask","lazyRegister","_screenRenderer","_renderTarget","_msaaTarget","rendererName","maybeRenderer","lazyFactory","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","drawCall","updateViewport","trace","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","updatePostProcessors","find","u","onUpdate","createMaterial","currentTarget","originalSort","firstIndex","sort","originalSortOrder","oldTransform","oldState","currentRendererName","currentRenderer","ExcaliburGraphicsContext2DCanvasDebug","__ctx","strokeRect","ExcaliburGraphicsContext2DCanvas","_resolution","globalAlpha","fillRect","_postprocessor","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","ScreenEvents","ScreenResize","PixelRatioChange","FullScreenChange","Screen","_antialiasing","_canvasImageRendering","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullscreen","_isDisposed","_fullscreenChangeHandler","fullscreen","isFullscreen","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","pixelRatio","_resizeHandler","_setResolutionAndViewportByDisplayMode","_contentArea","_unsafeArea","_contentResolution","_displayMode","displayMode","Fixed","_canvas","canvasImageRendering","_browser","browser","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","_resizeObserver","disconnect","removeEventListener","worldToPagePixelRatio","pageOrigin","worldToPageCoordinates","pixelRatioOverride","isHiDpi","FillContainer","FitContainer","FitContainerAndFill","FitContainerAndZoom","parentElement","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","currentPixelRatio","newResolutionSupported","imageRendering","widthUnit","heightUnit","documentElement","setProperty","isSmooth","isFullScreen","goFullScreen","elementId","enterFullscreen","maybeElement","getElementById","requestFullscreen","webkitRequestFullscreen","exitFullScreen","exitFullscreen","_viewportToPixels","offsetWidth","offsetHeight","pageToScreenCoordinates","innerWidth","innerHeight","screenHeight","screenWidth","contentArea","screenMarginY","screenMarginX","screenToWorldCoordinates","worldToScreenCoordinates","pageToWorldCoordinates","getWorldBounds","zoom","drawPos","getScreenBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","drawWidth","halfDrawWidth","drawHeight","halfDrawHeight","unsafeArea","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitScreenAndFill","vw","vh","_computeFitAndFill","_computeFitContainerAndFill","clip","_computeFitScreenAndZoom","_computeFitAndZoom","_computeFitContainerAndZoom","scaleX","scaleY","maxScaleFactor","zoomedWidth","zoomedHeight","_computeFitContainer","clientWidth","clientHeight","Window","ResizeObserver","observe","FillScreen","FitScreen","FitScreenAndFill","FitScreenAndZoom","AudioContextFactory","create","WebAudio","unlock","_UNLOCKED","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","isUnlocked","Canvas","cache","ExResponse","any","json","arraybuffer","StateMachine","states","currentState","_currentState","machineDescription","machine","stateName","transitionState","transitions","startState","go","eventData","potentialNewState","onExit","onEnter","onState","saveKey","localStorage","setItem","parse","getItem","WebAudioInstance","_createNewBufferSource","_instance","_audioContext","loop","playbackRate","_playbackRate","_volumeNode","_handleEnd","_playingFuture","_loop","volume","_volume","_stateMachine","in","gain","setTargetAtTime","_duration","getTotalPlaybackDuration","createGain","PLAYING","pausedAt","startedAt","_playStarted","stop","SEEK","STOPPED","PAUSED","isPaused","isStopped","playStarted","seek","getPlaybackPosition","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","track","NativeSoundProcessedEvent","_processedData","canPlayFile","file","Audio","filetype","canPlayType","SoundEvents","VolumeChange","Processed","Pause","Stop","PlaybackEnd","Resume","PlaybackStart","Sound","_tracks","instances","paths","_isStopped","_wasPlayingOnHidden","audiobuffer","decodeAudio","wireEngine","_engine","pauseAudioWhenHidden","instanceCount","some","_resumePlayback","_startPlayback","trackId","_getTrackInstance","getTrackId","resumed","all","complete","newTrack","LoaderEvents","BeforeLoad","AfterLoad","UserAction","LoadResourceStart","LoadResourceEnd","isLoaderConstructor","DefaultLoader","resources","_resources","_numLoaded","_totalTimeMs","_loadingFuture","loadables","addResources","onUserAction","onBeforeLoad","onAfterLoad","addResource","loadable","markResourceComplete","progress","total","textbox","areResourcesLoaded","async","finally","resource","Loader","_image","_imageElement","_imageLoaded","logo","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","textContent","_playButtonStyles","head","startButtonFactory","loadablesOrOptions","_originalOptions","_playButtonShown","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","playButtonText","buttonElement","display","_DEFAULT_LOADER_OPTIONS","showPlayButton","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","fullscreenAfterLoad","fullscreenContainer","HTMLElement","input","gamepads","Event","decode","buttonWidth","buttonHeight","playButtonPosition","logoY","logoX","logoPosition","oldAntialias","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","feature","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType","SolverStrategy","ContactSolveBias","CollisionGroupManager","mask","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","existingGroup","group","CollisionGroup","_CURRENT_BIT","groupByName","_STARTING_BIT","category","_category","_mask","canCollide","overlap1","overlap2","collisionGroups","combinedName","combinedMask","collidesWith","padStart","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","collisionType","PreventCollision","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","_config","worldBounds","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","boundsPadding","multdx","velocityMultiplier","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","getLength","intersectPoint","getPoint","DynamicTreeCollisionProcessor","_pairs","_collisionPairCache","_colliders","_dynamicCollisionTree","dynamicTree","getColliders","pointOrBounds","maxDistance","collisionGroup","collisionMask","searchAllColliders","maybeBody","ignoreCollisionGroupAll","hit","CompositeCollider","colliders","untrack","_pairExists","broadphase","targets","potentialColliders","j","pair","physics","pairs","continuous","checkForFastBodies","Active","updateDistance","minDimension","disableMinimumSpeedForFastBody","fastBodies","updateVec","oldPos","centerPoint","furthestPoint","getFurthestPoint","minCollider","surfaceEpsilon","minTranslate","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","composite","touching","VerticalFirst","vertical","horizontal","HorizontalFirst","SpatialPartitionStrategy","getDefaultPhysicsConfig","enabled","gravity","solver","Arcade","substep","compositeStrategy","bodies","canSleepByDefault","sleepEpsilon","wakeThreshold","sleepBias","defaultMass","spatialPartition","SparseHashGrid","sparseHashGrid","arcade","contactSolveBias","realistic","positionIterations","velocityIterations","slop","steeringFactor","warmStart","_compositeStrategy","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","hits","minHit","minDistance","project","projections","proj","newProjection","LineSegment","slope","intercept","_normal","_dir","_slope","getEdge","midpoint","flip","below","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","arguments","dxc","dyc","dx1","dy1","ClosestLine","line1","line2","EPSILON","line1Dir","line2Dir","d1Squared","d2Squared","closestPoint","denom","closestPointOnLine1","closestPointOnLine2","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","aSides","getSides","bSides","closestLine","PolygonEdgeClosestLine","polygon","edge","otherDirection","rayTowardsOther","thisPoint","thisFace","getClosestFace","edgeLine","asLine","face","PolygonCircleClosestLine","otherWorldPos","p0","circlex","circley","CircleCircleClosestLine","circleA","circleB","thisDirection","rayTowardsThis","otherPoint","CircleEdgeClosestLine","circleWorldPos","EdgeEdgeClosestLine","edgeA","edgeB","CircleCollider","_globalMatrix","_radius","_naturalRadius","_localBoundsDirty","orig","u1","toi","discriminant","toi1","toi2","positiveToi","minToi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","CollisionContact","mtv","tangent","localPoints","_canceled","colliderAId","colliderBId","matchAwake","isSleeping","sleepMotion","isCanceled","cancel","bias","SeparationInfo","localAxis","localSide","localPoint","SeparatingAxis","findPolygonPolygonSeparation","polyA","polyB","findPolygonPolygonSeparationDegenerate","bestSeparation","bestSideIndex","toPolyBSpace","_SCRATCH_MATRIX","toPolyBSpaceRotation","normalsA","normals","pointsA","pointsB","pointsAIndex","_ZERO","_SCRATCH_NORMAL","_SCRATCH_POINT","smallestLocalPoint","smallestPointDistance","pointsBIndex","_SCRATCH_SUB_POINT","bestSide2","separationInfo","SeparationPool","separation","sideId","findCirclePolygonSeparation","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","bestSide","bestAxis","bestOtherPoint","sides","localSides","getLocalSides","vertB","vertSeparation","ScratchZero","ScratchNormal","ScratchMatrix","circleAPos","circleBPos","combinedRadius","mvt","local","sameDir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","separationB","main","toIncidentFrame","toIncidentFrameRotation","referenceEdgeNormal","minEdge","incidentEdgeIndex","referenceSide","referenceDirection","clipRight","clipLeft","clipPoints","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","registerGraphicsContext","debugDrawCall","drawLines","drawPolygon","firstPoint","drawBounds","boundingBox","drawRay","_localSidesDirty","_transformedPointsDirty","_sidesDirty","_normals","_checkAndUpdateWinding","_calculateNormals","_transformedPoints","_sides","_localSides","isConvex","suppressConvexWarning","_calculateTransformation","_isCounterClockwiseWinding","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","tessellate","polygons","Shape","Polygon","triangulate","triangles","vertices","vertexCount","getPrevIndex","getNextIndex","prev","va","vb","vc","leftArm","rightArm","convexVertices","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","findEarTip","isEar","cutEarTip","getTransformedPoints","currentSide","mostDirection","testRay","intersectCount","sideIndex","pts","POSITIVE_INFINITY","faceIndex","_cachedMass","_cachedInertia","denominator","iplusone","crossTerm","contactSide","minContactTime","contactIndex","contactTime","scalar","Box","Circle","Edge","Capsule","ColliderComponent","$colliderAdded","$colliderRemoved","_collidersToRemove","_collider","processColliderRemoval","flipped","precollision","Actor","onPreCollisionResolve","postcollision","onPostCollisionResolve","onCollisionStart","onCollisionEnd","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","useCompositeCollider","DegreeOfFreedom","__oldTransformCaptured","enableFixedUpdateInterpolate","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","_oldGlobalPos","oldVel","oldAcc","_impulseScratch","_distanceFromCenterScratch","_bodyConfig","config","updatePhysicsConfig","_mass","_DEFAULT_CONFIG","canSleep","updateDefaultPhysicsConfig","newMass","_cachedInverseInertia","inverseMass","sleeping","setSleeping","updateMotion","currentMotion","maybeCollider","inverseInertia","oldGlobalPos","oldRotation","oldScale","applyImpulse","impulse","finalImpulse","X","Y","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","Rectangle","PointerComponent","useColliderShape","useGraphicsBounds","EasingFunctions","CreateReversibleEasingFunction","easing","CreateVectorEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_currentAction","_completedActions","_entity","clearActions","getActions","getIncompleteActions","getCurrentAction","hasNext","isComplete","_ACTION_ID","nextActionId","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","lerp","lerpAngle","startAngle","endAngle","shortestPathIsPositive","distance1","distance2","shortDistance","longDistance","lerpVector","inverseLerp","inverseLerpVector","remap","minSource","maxSource","minDestination","maxDestination","remapVector","isMoveByOptions","MoveByWithOptions","_started","_easing","_tx","_motion","_durationMs","_currentMs","_start","_end","currentPos","newPosX","newPosY","velX","velY","MoveBy","_distance","isMoveToOptions","MoveToWithOptions","MoveTo","destX","destY","isRotateToOptions","RotateToWithOptions","_endAngle","_startAngle","_rotationType","rx","RotateTo","_currentNonCannonAngle","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","distanceTraveled","isRotateByOptions","angleRadiansOffset","RotateByWithOptions","RotateBy","isScaleToOptions","ScaleToWithOptions","_endScale","_startScale","newScale","ScaleTo","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","isScaleByOptions","scaleOffset","ScaleByWithOptions","_scaleOffset","ScaleBy","scaleOffsetX","scaleOffsetY","_directionX","_directionY","CallMethod","method","_hasBeenCalled","_method","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","EaseBy","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","Fade","endOpacity","_multiplier","_endOpacity","_remainingTime","_originalTime","Delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actor","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","Flash","_total","_currentDuration","_material","BezierCurve","_distLookup","controlPoints","_controlPoints","_calculateLookup","arcLength","_arcLength","setControlPoint","totalLength","pt","_getTimeGivenDistance","getTangent","timeSquared","p1","p2","p3","getUniformTangent","desiredDistance","uniformTime","getNormal","getUniformNormal","getUniformPoint","CurveTo","_mode","_curve","mode","CurveBy","_queue","runAction","curveBy","curveTo","easeTo","easeBy","xOrPosOrOptions","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVectorOrOptions","yOffsetOrSpeed","xOffset","yOffset","rotateTo","angleRadiansOrOptions","rotateBy","angleRadiansOffsetOrOptions","scaleTo","sizeXOrVectorOrOptions","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVectorOrOptions","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","flash","die","callMethod","times","repeatForever","follow","meet","toPromise","_getCtx","xOffsetOrVectorOptions","isActor","ActorEvents","CollisionStart","CollisionEnd","PreCollision","PostCollision","PreKill","PostKill","PreDraw","PostDraw","PreTransformDraw","PostTransformDraw","PreDebugDraw","PostDebugDraw","PointerUp","PointerDown","PointerEnter","PointerLeave","PointerMove","PointerCancel","Wheel","PointerDrag","PointerDragEnd","PointerDragEnter","PointerDragLeave","PointerDragMove","EnterViewPort","ExitViewPort","ActionStart","ActionComplete","thePos","theVel","theAcc","theAngle","_handleAnchorChange","_handleOffsetChange","isOffScreen","draggable","_draggable","isDraggable","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","_pointerDragLeaveHandler","_dragging","pe","defaults","_silenceWarnings","pointer","actions","Passive","builtInComponents","_prekill","onPreKill","_postkill","onPostKill","unkill","newZ","getGlobalPos","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","within","otherCollider","me","isScreenElement","ScreenElement","useWorld","coords","Timer","_complete","_totalTimeAlive","_running","_numberOfTicks","interval","repeats","maxNumberOfRepeats","randomRange","_baseInterval","_generateRandomInterval","fcn","numberOfRepeats","_MAX_ID","_callbacks","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","cancelTimer","ParallaxComponent","parallaxFactor","DebugGraphicsComponent","useTransform","hasNestedEvents","_dispatchPointerEvents","_processPointerToObject","PointerTargetObjectProxy","init","PointerEventsToObjectDispatcher","_proxyPool","_objectToProxy","_proxies","_lastFrameObjectToPointers","_currentFrameObjectToPointers","addObject","proxy","_getProxy","removeObject","_objectCurrentlyUnderPointer","pointerId","_objectWasUnderPointer","_entered","addPointerToObject","maybeProxy","_addPointerToProxy","pointers","dispatchEvents","receiver","sortedObjects","lastFrameEntities","currentFrameEntities","lastMovePerPointer","lastUpPerPointer","lastDownPerPointer","_processDownAndEmit","_processUpAndEmit","_processMoveAndEmit","lastUpDownMoveEvents","_processEnterLeaveAndEmit","_processCancelAndEmit","_processWheelAndEmit","processPointerToObject","objectIndex","currentFramePointerCoords","currentFrameDown","isDragStart","currentFrameUp","isDragEnd","currentFrameMove","isDragging","currentFrameCancel","currentFrameWheel","TileMapEvents","TileMap","flagCollidersDirty","_collidersDirty","flagTilesDirty","tiles","tileWidth","tileHeight","_token","_rows","_cols","renderFromTopOfGraphic","meshingLookBehind","_oldRotation","_originalOffsets","WeakMap","debugFlags","_composite","_oldPos","_oldScale","_pointerEventDispatcher","currentCol","tile","Tile","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","shareEdges","checkAndCombine","maxLookBack","solid","defaultGeometry","getTileByIndex","getTile","getTileByPoint","_getTileCoordinates","getRows","getColumns","getOnScreenTiles","maybeParallax","oneMinusFactor","parallaxOffset","currentScene","tileStartX","tileStartY","tileEndX","tileEndY","graphicsIndex","graphicsLen","offsets","getGraphicsOffsets","getGraphics","gfx","showAll","showGrid","gridColor","gridWidth","showSolidBounds","showColliderBounds","solidBoundsColor","colliderBoundsColor","showColliderGeometry","tilemap","geometryColor","geometryLineWidth","geometryPointSize","pointSize","_posDirty","_recalculate","_solid","_offsets","addGraphic","removeGraphic","clearGraphics","geometryPos","_geometry","_bounds","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","Axis","cam","_eng","currentFocus","getFocus","cameraVel","stretch","boundSizeChecked","focusX","focusY","CameraEvents","Camera","_cameraStrategies","dz","az","_angularVelocity","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_halfWidth","_halfHeight","_snapPos","hasChanged","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","res","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","moveEasing","_isDoneShaking","fixedUpdateTimestep","blend","currentFrameLagMs","interpolatedPos","snapPos","newCanvasWidth","newCanvasHeight","cameraPos","TriggerEvents","ExitTrigger","EnterTrigger","Trigger","_matchesTarget","_dispatchAction","SystemPriority","Highest","Higher","Average","Lower","Lowest","SystemType","System","EntityManager","_world","entities","_entityIndex","_childAddedHandlerMap","_childRemovedHandlerMap","_createChildAddedHandler","addEntity","_createChildRemovedHandler","removeEntity","_entitiesToRemove","updateEntities","entityIndex","findEntitiesForRemoval","queryManager","childAdded","childRemoved","idOrEntity","childAddedHandler","childRemovedHandler","currFrame","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","Query","requiredComponents","entityAdded$","entityRemoved$","checkAndAdd","getEntities","TagQuery","QueryManager","_queries","_addComponentHandlers","_removeComponentHandlers","_componentToQueriesIndex","_tagQueries","_addTagHandlers","_removeTagHandlers","_tagToQueriesIndex","_createAddComponentHandler","_createRemoveComponentHandler","_createAddTagHandler","_createRemoveTagHandler","createQuery","queries","createTagQuery","maybeAddComponent","maybeRemoveComponent","maybeAddTag","maybeRemoveTag","tagQuery","isSystemConstructor","SystemManager","systems","initialized","systemType","addSystem","systemOrCtor","system","removeSystem","updateSystems","preupdate","postupdate","entityManager","systemManager","queryTags","Update","entityOrSystem","clearEntities","clearSystems","MotionSystem","world","_physicsConfigDirty","$configUpdate","optionalBody","captureOldTransformWithChildren","ArcadeSolver","directionMap","distanceMap","solve","preSolve","aDir","bDir","aDist","bDist","solvePosition","solveVelocity","postSolve","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","originalVelocityAndRestitution","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","restitution","relativeVelocity","constraints","maxCorrection","steeringForce","impulseForce","impulseDelta","maxFriction","newImpulse","normalVelocity","CollisionSystem","_processor","_physics","collisionProcessor","_configDirty","_lastFrameContacts","_currentFrameContacts","_arcadeSolver","_realisticSolver","_trackCollider","_untrackCollider","colliderComponent","_motionSystem","colliderComp","compositeColliders","getSolver","step","compositeId","substring","runContactStartEnd","Realistic","blendTransform","oldTx","newTx","oldTxWithNewParent","oldGlobalScale","oldGlobalRotation","interpolatedScale","interpolatedRotation","GraphicsSystem","sortedTransforms","_sortedTransforms","Draw","_zHasChanged","_zIndexUpdate","_targetInterpolationTransform","transformIndex","parallax","_applyTransform","_applyOpacity","_drawGraphicsComponent","graphicsComponent","transformComponent","oldFlipHorizontal","oldFlipVertical","isDebug","showBounds","boundsColor","ancestors","ancestor","maybeGraphics","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","debugDraw","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","_pushCameraTransform","debugZIndex","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","showOwner","_popCameraTransform","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","contactSize","collisionContactColor","collisionNormalColor","showFocus","focusColor","showZoom","HashGridProxy","gridSize","cells","hasZeroBounds","leftX","rightX","bottomY","topY","cell","proxies","updateBounds","HashGridCell","calculateHashKey","_hashGridCellPool","instance","objectToProxy","proxyFactory","_buildProxy","boundsOrPoint","xCoord","yCoord","proxyIndex","cellIndex","transparent","PointerSystem","_graphicsHashGrid","_entityToPointer","overrideUseColliderShape","overrideUseGraphicsBounds","_sortedEntities","screenPos","maybeGfx","_scene","_receivers","_engineReceiver","maybePointer","ActionsSystem","IsometricEntityComponent","mapOrOptions","elevation","IsometricEntitySystem","iso","OffscreenSystem","_worldBounds","entityOffscreen","_isOffscreen","transformedBounds","HashColliderProxy","SparseHashGridCollisionProcessor","_nonPairs","_pairPool","hashGrid","unitRay","dydx","dxdy","unitStepX","unitStepY","startXCoord","startYCoord","stepDir","currentXCoord","currentYCoord","currentRayLengthX","currentRayLengthY","collidersVisited","maxIterations","cellHits","colliderIndex","hit1","hit2","compColliders","_canCollide","proxyId","otherIndex","PhysicsWorld","newConfig","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_enabled","_clonePads","toggleEnabled","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","at","timestamp","navigatorGamepad","buttonIndex","getButton","pressed","updateButton","Buttons","Unknown","axesIndex","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_axes","_buttons","_buttonsUp","_buttonsDown","isButtonPressed","isButtonHeld","wasButtonPressed","wasButtonReleased","Boolean","Axes","Keys","InputMapper","inputs","_handlers","command","inputHandler","commandHandler","isCrossOriginIframe","noop","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_releaseAllKeys","ev","code","keyEvent","_handleKeyDown","metaKey","MetaLeft","MetaRight","_handleKeyUp","keyboardOptions","global","grabWindowFocus","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","character","KeyboardEvent","GlobalCoordinates","fromPagePosition","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","coordinates","pointerType","nativeEvent","WheelEvent","screenX","screenY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","_updateWorldPosition","WheelDeltaMode","NativePointerButton","PointerButton","PointerType","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","recreate","eventReceiver","isDown","wasDown","native","isDisposed","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","onmousewheel","grabFocus","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","globalThis","TouchEvent","Touch","changedTouches","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Line","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","NoButton","Middle","Pen","InputHost","pointerTarget","keyboard","inputMapper","PreLoadEvent","SceneEvents","Activate","Deactivate","PreLoad","isSceneConstructor","Scene","triggers","tileMaps","timers","_timers","_cancelQueue","onPreLoad","loader","onTransition","onActivate","onDeactivate","_initializeChildren","pointerScope","director","getSceneName","_activate","_deactivate","_predraw","_postdraw","removeTimer","timer","_collectActorStats","addTimer","transfer","isTimerActive","isCurrentScene","ui","alive","ColorBlindnessMode","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","DebugConfig","FrameStats","prevFrame","isometric","positionSize","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_elapsedMs","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","drawCalls","drawnImages","otherStats","elapsedMs","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","BrowserComponent","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","DefaultAntialiasOptions","nativeContextAntialiasing","DefaultPixelArtOptions","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","timing","scheduledTime","__runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","run","numberOfSteps","Toaster","_toasterCss","_container","_createFragment","toastMessage","innerText","toast","linkTarget","linkName","className","messageFragments","link","href","finalMessage","dismissBtn","keydownHandler","first","firstChild","insertBefore","DirectorEvents","NavigationStart","Navigation","NavigationEnd","Director","isTransitioning","_isTransitioning","scenes","_sceneToInstance","_sceneToLoader","_sceneToTransition","_loadedScenes","rootScene","currentSceneName","sceneKey","sceneOrOptions","getSceneInstance","_deferredGoto","deferredScene","deferredTransition","_deferredTransition","deferredSceneInstance","_addToTargetScene","swapScene","playTransition","configureStart","startScene","maybeLoaderOrCtor","maybeStartTransition","mainLoader","inTransition","startSceneInstance","_getLoader","sceneName","_getInTransition","sceneOrRoute","_getOutTransition","out","getDeferredScene","maybeDeferred","getSceneDefinition","maybeScene","assertAdded","assertRemoved","outTransition","nameOrScene","sceneOrCtor","potentialSceneOrOptions","goToScene","destinationScene","maybeDest","sourceSceneInstance","sourceScene","engineInputEnabled","maybeSourceOut","maybeDestinationIn","sourceOut","destinationIn","sceneActivationData","hideLoader","maybeLoadScene","_emitEvent","onPreviousSceneDeactivate","sceneDefinition","newScene","sceneToLoad","sceneToLoadInstance","transition","targetScene","currentTransition","sceneInputEnabled","blockInput","_play","previousScene","nextScene","destLoader","sourceName","destinationName","createContext","scope","old","useContext","DefaultGarbageCollectionOptions","textureCollectInterval","GarbageCollector","_collectionMap","_collectors","collectStaleResources","deadline","collector","timeoutInterval","getTimestamp","resourceType","_collectHandle","collect","collectionData","forceCollectAll","EngineEvents","FallbackGraphicsContext","Visible","Hidden","Start","PreFrame","PostFrame","EmitterType","Engine","useEngine","Context","_isDebug","shouldSnapToPixel","version","EX_VERSION","_inputEnabled","_suppressPlayButton","enableCanvasTransparency","stack","_toaster","_timescale","_handleWebGLContextLost","container","flexDirection","borderStyle","div","innerHTML","querySelector","reload","_performanceThresholdTriggered","_fpsSamples","_isLoading","_hideLoader","_isReadyFuture","currentFrameElapsedMs","_lagMs","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","detector","suppressMinimumBrowserFeatureDetection","_compatible","testMessage","canvasElementId","suppressConsoleBootMessage","garbageCollection","garbageCollectorConfig","enableCanvasContextMenu","_originalDisplayMode","pixelArt","suppressHiDPIScaling","fixedUpdateFps","_mainloop","___EXCALIBUR_DEVTOOL","InstanceCount","_monitorPerformanceThresholdAndTriggerFallback","allow","configurePerformanceCanvas2DFallback","showPlayerMessage","numberOfFrames","useCanvas2DFallback","newCanvas","cloneNode","parentNode","replaceChild","Document","timescale","addScene","removeScene","scrollPreventionMode","visibilityState","toggleInputEnabled","_overrideInitialize","_update","_loader","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","sceneNameOrLoader","frameId","beforeUpdate","fixedTimestepMs","afterUpdate","afterDraw","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Label","newFont","spriteFont","sf","getTextWidth","ParticleEmitter","_particlesToEmit","_particlePool","numParticles","isEmitting","deadParticles","emitRate","emitterType","randomRotation","_activeParticles","emitParticles","particleCount","_createParticle","clearParticles","ranX","ranY","minAngle","maxAngle","minSpeed","maxSpeed","minSize","maxSize","assert","expression","GpuParticleRenderer","_vaos","_buffers","_drawIndex","_numInputFloats","_particleIndex","_uploadIndex","_wrappedLife","_wrappedParticles","_particleLife","_clearRequested","_emitted","_particleData","maxParticles","_random","numInputFloats","particleData","particleDataBuffer1","vao1","bytesPerFloat","particleDataBuffer2","vao2","_currentVao","_currentBuffer","startIndex","endIndex","_uploadEmitted","bindBufferBase","TRANSFORM_FEEDBACK_BUFFER","bindBufferRange","beginTransformFeedback","endTransformFeedback","GPU_MAX_PARTICLES","GpuParticleEmitter","IsometricTile","_gfx","_recalculateBounds","_tileBounds","graphicsOffset","tileToWorld","_isometricEntityComponent","halfTileWidth","halfTileHeight","yPos","totalWidth","totalHeight","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","_getMaxZIndex","maxZ","NEGATIVE_INFINITY","currentZ","ActionSequence","actionBuilder","_sequenceBuilder","_sequenceContext","ParallelActions","parallelActions","every","QuadTree","_defaultOptions","maxDepth","capacity","items","_isDivided","halfWidth","halfHeight","_split","newLevelOptions","_insertIntoSubNodes","insert","getAllItems","getTreeDepth","has_initialize","has_add","has_remove","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasOnAdd","hasOnRemove","hasPreDraw","hasPostDraw","Gif","_sprites","_stream","Stream","_gif","GifParser","toSpriteSheet","toAnimation","delayMs","_animation","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","Uint8Array","stream","_handler","globalColorTableBytes","parseColorTableBytes","colorTable","rgb","_st","readSubBlocks","parseHeader","hdr","sig","ver","colorResolution","globalColorTableSize","gctFlag","sortedFlag","globalColorTable","backgroundColorIndex","pixelAspectRatio","_currentFrameCanvas","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInputFlag","transparentColorFlag","delayTime","transparentColorIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","_gce","parseImg","img","leftPos","topPos","lctFlag","interlaced","sorted","lctSize","lctBytes","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","charCodeAt","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","steps","pass","deinterlace","arrayToImage","parseBlocks","sentinel","eof","frame","imageData","getImageData","pixel","colorIndex","putImageData","_currentFrameContext","_hdr","bg","FontSource","_isLoaded","FontFace","fonts","toFont","InsideCoroutineContext","generatorFunctionDeclaration","isCoroutineGenerator","Function","coroutine","coroutineGenerator","thisArg","passedEngine","inside","autostart","started","completed","cancelled","generatorFcn","generator","co","iterator","Transition","_currentProgress","_completeFuture","_currentDistance","updateTransition","onStart","onEnd","onReset","_co","_execute","FadeInOut","screenCover","CrossFade","_progress","Slide","slideDirection","easingFunction","_vectorEasing","_screenCover","_directionOffset","_destinationCameraPosition","_startCameraPosition","_calculateBounds","lineNormal","halfThickness","minPoint","NineSliceStretch","NineSlice","_imgSource","_canvasA","_canvasB","_canvasC","_canvasD","_canvasE","_canvasF","_canvasG","_canvasH","_canvasI","setTargetWidth","auto","setTargetHeight","setMargins","sourceConfig","leftMargin","topMargin","rightMargin","bottomMargin","setStretch","destinationConfig","horizontalStretch","verticalStretch","getConfig","_drawTile","targetCanvas","destinationSize","marginWidth","marginHeight","tempMarginW","tempMarginH","tempSizeX","tempPositionX","tempSizeY","tempPositionY","numTilesX","_getNumberOfTiles","numTilesY","tempSize","tempPosition","_calculateParams","drawCenter","_sourceSprite","aCtx","bCtx","cCtx","dCtx","eCtx","fCtx","gCtx","hCtx","iCtx","tileSize","Stretch","TileFit","tileNum","numTiles","reducedTileSize","TiledAnimation","animation","_tiledWidth","_tiledHeight","_sourceView","promises","tiledSprite","fromAnimation","_updateSourceView","_updateWidthHeight","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","showStackTrace","obsolete","alternateMethod","property","descriptor","SyntaxError","DecoratedClass","AsyncWaitQueue","enqueue","dequeue","Semaphore","_count","_waitQueue","waiting","enter","exit"],"version":3,"file":"index.b7a05eb9.js.map","sourceRoot":"/__parcel_source_root/"}